{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/reducers/map.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/reducers/map.js","mtime":1585205045393},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLm1hcCA9IG1hcDsKCnZhciBfbWFwX2FjdGlvbnMgPSByZXF1aXJlKCIuLi9hY3Rpb25zL21hcF9hY3Rpb25zIik7Cgp2YXIgX3V0aWwgPSByZXF1aXJlKCIuL3V0aWwiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vY29tbW9uL2NvbnN0YW50cyIpOwoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIGdldExheWVySW5kZXggPSBmdW5jdGlvbiBnZXRMYXllckluZGV4KGxpc3QsIGxheWVySWQpIHsKICByZXR1cm4gbGlzdC5maW5kSW5kZXgoZnVuY3Rpb24gKF9yZWYpIHsKICAgIHZhciBpZCA9IF9yZWYuaWQ7CiAgICByZXR1cm4gbGF5ZXJJZCA9PT0gaWQ7CiAgfSk7Cn07Cgp2YXIgdXBkYXRlTGF5ZXJJbkxpc3QgPSBmdW5jdGlvbiB1cGRhdGVMYXllckluTGlzdChzdGF0ZSwgbGF5ZXJJZCwgYXR0cmlidXRlLCBuZXdWYWx1ZSkgewogIGlmICghbGF5ZXJJZCkgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgdmFyIGxheWVyTGlzdCA9IHN0YXRlLmxheWVyTGlzdDsKICB2YXIgbGF5ZXJJZHggPSBnZXRMYXllckluZGV4KGxheWVyTGlzdCwgbGF5ZXJJZCk7CgogIHZhciB1cGRhdGVkTGF5ZXIgPSBfb2JqZWN0U3ByZWFkKHt9LCBsYXllckxpc3RbbGF5ZXJJZHhdLCBfZGVmaW5lUHJvcGVydHkoe30sIGF0dHJpYnV0ZSwgbmV3VmFsdWUgfHwgbmV3VmFsdWUgPT09ICcnIHx8IG5ld1ZhbHVlID09PSAwID8gbmV3VmFsdWUgOiAhbGF5ZXJMaXN0W2xheWVySWR4XVthdHRyaWJ1dGVdKSk7CgogIHZhciB1cGRhdGVkTGlzdCA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkobGF5ZXJMaXN0LnNsaWNlKDAsIGxheWVySWR4KSksIFt1cGRhdGVkTGF5ZXJdLCBfdG9Db25zdW1hYmxlQXJyYXkobGF5ZXJMaXN0LnNsaWNlKGxheWVySWR4ICsgMSkpKTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgIGxheWVyTGlzdDogdXBkYXRlZExpc3QKICB9KTsKfTsKCnZhciB1cGRhdGVMYXllclNvdXJjZURlc2NyaXB0b3JQcm9wID0gZnVuY3Rpb24gdXBkYXRlTGF5ZXJTb3VyY2VEZXNjcmlwdG9yUHJvcChzdGF0ZSwgbGF5ZXJJZCwgcHJvcE5hbWUsIHZhbHVlKSB7CiAgdmFyIGxheWVyTGlzdCA9IHN0YXRlLmxheWVyTGlzdDsKICB2YXIgbGF5ZXJJZHggPSBnZXRMYXllckluZGV4KGxheWVyTGlzdCwgbGF5ZXJJZCk7CgogIHZhciB1cGRhdGVkTGF5ZXIgPSBfb2JqZWN0U3ByZWFkKHt9LCBsYXllckxpc3RbbGF5ZXJJZHhdLCB7CiAgICBzb3VyY2VEZXNjcmlwdG9yOiBfb2JqZWN0U3ByZWFkKHt9LCBsYXllckxpc3RbbGF5ZXJJZHhdLnNvdXJjZURlc2NyaXB0b3IsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgcHJvcE5hbWUsIHZhbHVlKSkKICB9KTsKCiAgdmFyIHVwZGF0ZWRMaXN0ID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShsYXllckxpc3Quc2xpY2UoMCwgbGF5ZXJJZHgpKSwgW3VwZGF0ZWRMYXllcl0sIF90b0NvbnN1bWFibGVBcnJheShsYXllckxpc3Quc2xpY2UobGF5ZXJJZHggKyAxKSkpOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgbGF5ZXJMaXN0OiB1cGRhdGVkTGlzdAogIH0pOwp9OwoKdmFyIElOSVRJQUxfU1RBVEUgPSB7CiAgcmVhZHk6IGZhbHNlLAogIG1hcEluaXRFcnJvcjogbnVsbCwKICBnb3RvOiBudWxsLAogIHRvb2x0aXBTdGF0ZTogbnVsbCwKICBtYXBTdGF0ZTogewogICAgem9vbTogNCwKICAgIGNlbnRlcjogewogICAgICBsb246IC0xMDAuNDEsCiAgICAgIGxhdDogMzIuODIKICAgIH0sCiAgICBzY3JvbGxab29tOiB0cnVlLAogICAgZXh0ZW50OiBudWxsLAogICAgbW91c2VDb29yZGluYXRlczogbnVsbCwKICAgIHRpbWVGaWx0ZXJzOiBudWxsLAogICAgcXVlcnk6IG51bGwsCiAgICBmaWx0ZXJzOiBbXSwKICAgIHJlZnJlc2hDb25maWc6IG51bGwsCiAgICByZWZyZXNoVGltZXJMYXN0VHJpZ2dlcmVkQXQ6IG51bGwsCiAgICBkcmF3U3RhdGU6IG51bGwsCiAgICBkaXNhYmxlSW50ZXJhY3RpdmU6IGZhbHNlLAogICAgZGlzYWJsZVRvb2x0aXBDb250cm9sOiBmYWxzZSwKICAgIGhpZGVUb29sYmFyT3ZlcmxheTogZmFsc2UsCiAgICBoaWRlTGF5ZXJDb250cm9sOiBmYWxzZSwKICAgIGhpZGVWaWV3Q29udHJvbDogZmFsc2UKICB9LAogIHNlbGVjdGVkTGF5ZXJJZDogbnVsbCwKICBfX3RyYW5zaWVudExheWVySWQ6IG51bGwsCiAgbGF5ZXJMaXN0OiBbXSwKICB3YWl0aW5nRm9yTWFwUmVhZHlMYXllckxpc3Q6IFtdCn07CgpmdW5jdGlvbiBtYXAoKSB7CiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBJTklUSUFMX1NUQVRFOwogIHZhciBhY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKCiAgc3dpdGNoIChhY3Rpb24udHlwZSkgewogICAgY2FzZSBfbWFwX2FjdGlvbnMuVVBEQVRFX0RSQVdfU1RBVEU6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5tYXBTdGF0ZSwgewogICAgICAgICAgZHJhd1N0YXRlOiBhY3Rpb24uZHJhd1N0YXRlCiAgICAgICAgfSkKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuUkVNT1ZFX1RSQUNLRURfTEFZRVJfU1RBVEU6CiAgICAgIHJldHVybiByZW1vdmVUcmFja2VkTGF5ZXJTdGF0ZShzdGF0ZSwgYWN0aW9uLmxheWVySWQpOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlRSQUNLX0NVUlJFTlRfTEFZRVJfU1RBVEU6CiAgICAgIHJldHVybiB0cmFja0N1cnJlbnRMYXllclN0YXRlKHN0YXRlLCBhY3Rpb24ubGF5ZXJJZCk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuUk9MTEJBQ0tfVE9fVFJBQ0tFRF9MQVlFUl9TVEFURToKICAgICAgcmV0dXJuIHJvbGxiYWNrVHJhY2tlZExheWVyU3RhdGUoc3RhdGUsIGFjdGlvbi5sYXllcklkKTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfVE9PTFRJUF9TVEFURToKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgdG9vbHRpcFN0YXRlOiBhY3Rpb24udG9vbHRpcFN0YXRlCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9NT1VTRV9DT09SRElOQVRFUzoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7CiAgICAgICAgICBtb3VzZUNvb3JkaW5hdGVzOiB7CiAgICAgICAgICAgIGxhdDogYWN0aW9uLmxhdCwKICAgICAgICAgICAgbG9uOiBhY3Rpb24ubG9uCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuQ0xFQVJfTU9VU0VfQ09PUkRJTkFURVM6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5tYXBTdGF0ZSwgewogICAgICAgICAgbW91c2VDb29yZGluYXRlczogbnVsbAogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9HT1RPOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBnb3RvOiB7CiAgICAgICAgICBjZW50ZXI6IGFjdGlvbi5jZW50ZXIsCiAgICAgICAgICBib3VuZHM6IGFjdGlvbi5ib3VuZHMKICAgICAgICB9CiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkNMRUFSX0dPVE86CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIGdvdG86IG51bGwKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuU0VUX0xBWUVSX0VSUk9SX1NUQVRVUzoKICAgICAgdmFyIGxheWVyTGlzdCA9IHN0YXRlLmxheWVyTGlzdDsKICAgICAgdmFyIGxheWVySWR4ID0gZ2V0TGF5ZXJJbmRleChsYXllckxpc3QsIGFjdGlvbi5sYXllcklkKTsKCiAgICAgIGlmIChsYXllcklkeCA9PT0gLTEpIHsKICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgIH0KCiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIGxheWVyTGlzdDogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShsYXllckxpc3Quc2xpY2UoMCwgbGF5ZXJJZHgpKSwgW19vYmplY3RTcHJlYWQoe30sIGxheWVyTGlzdFtsYXllcklkeF0sIHsKICAgICAgICAgIF9faXNJbkVycm9yU3RhdGU6IGFjdGlvbi5pc0luRXJyb3JTdGF0ZSwKICAgICAgICAgIF9fZXJyb3JNZXNzYWdlOiBhY3Rpb24uZXJyb3JNZXNzYWdlCiAgICAgICAgfSldLCBfdG9Db25zdW1hYmxlQXJyYXkobGF5ZXJMaXN0LnNsaWNlKGxheWVySWR4ICsgMSkpKQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5VUERBVEVfU09VUkNFX0RBVEFfUkVRVUVTVDoKICAgICAgcmV0dXJuIHVwZGF0ZVNvdXJjZURhdGFSZXF1ZXN0KHN0YXRlLCBhY3Rpb24pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkxBWUVSX0RBVEFfTE9BRF9TVEFSVEVEOgogICAgICByZXR1cm4gdXBkYXRlV2l0aERhdGFSZXF1ZXN0KHN0YXRlLCBhY3Rpb24pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkxBWUVSX0RBVEFfTE9BRF9FUlJPUjoKICAgICAgcmV0dXJuIHVwZGF0ZVdpdGhEYXRhUmVzcG9uc2Uoc3RhdGUsIGFjdGlvbik7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuTEFZRVJfREFUQV9MT0FEX0VOREVEOgogICAgICByZXR1cm4gdXBkYXRlV2l0aERhdGFSZXNwb25zZShzdGF0ZSwgYWN0aW9uKTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5UT1VDSF9MQVlFUjoKICAgICAgLy9hY3Rpb24gdG8gZW5mb3JjZSBhIHJlZmxvdyBvZiB0aGUgc3R5bGVzCiAgICAgIHZhciBsYXllciA9IHN0YXRlLmxheWVyTGlzdC5maW5kKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBsYXllci5pZCA9PT0gYWN0aW9uLmxheWVySWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKCFsYXllcikgewogICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgfQoKICAgICAgdmFyIGluZGV4T2ZMYXllciA9IHN0YXRlLmxheWVyTGlzdC5pbmRleE9mKGxheWVyKTsKCiAgICAgIHZhciBuZXdMYXllciA9IF9vYmplY3RTcHJlYWQoe30sIGxheWVyKTsKCiAgICAgIHZhciBuZXdMYXllckxpc3QgPSBfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUubGF5ZXJMaXN0KTsKCiAgICAgIG5ld0xheWVyTGlzdFtpbmRleE9mTGF5ZXJdID0gbmV3TGF5ZXI7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIGxheWVyTGlzdDogbmV3TGF5ZXJMaXN0CiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLk1BUF9SRUFEWToKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgcmVhZHk6IHRydWUKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuTUFQX0RFU1RST1lFRDoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgcmVhZHk6IGZhbHNlCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLk1BUF9FWFRFTlRfQ0hBTkdFRDoKICAgICAgdmFyIG5ld01hcFN0YXRlID0gewogICAgICAgIGNlbnRlcjogYWN0aW9uLm1hcFN0YXRlLmNlbnRlciwKICAgICAgICB6b29tOiBhY3Rpb24ubWFwU3RhdGUuem9vbSwKICAgICAgICBleHRlbnQ6IGFjdGlvbi5tYXBTdGF0ZS5leHRlbnQsCiAgICAgICAgYnVmZmVyOiBhY3Rpb24ubWFwU3RhdGUuYnVmZmVyCiAgICAgIH07CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5tYXBTdGF0ZSwge30sIG5ld01hcFN0YXRlKQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfUVVFUlk6CiAgICAgIHZhciBxdWVyeSA9IGFjdGlvbi5xdWVyeSwKICAgICAgICAgIHRpbWVGaWx0ZXJzID0gYWN0aW9uLnRpbWVGaWx0ZXJzLAogICAgICAgICAgZmlsdGVycyA9IGFjdGlvbi5maWx0ZXJzOwogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgIHRpbWVGaWx0ZXJzOiB0aW1lRmlsdGVycywKICAgICAgICAgIGZpbHRlcnM6IGZpbHRlcnMKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfUkVGUkVTSF9DT05GSUc6CiAgICAgIHZhciBpc1BhdXNlZCA9IGFjdGlvbi5pc1BhdXNlZCwKICAgICAgICAgIGludGVydmFsID0gYWN0aW9uLmludGVydmFsOwogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIHJlZnJlc2hDb25maWc6IHsKICAgICAgICAgICAgaXNQYXVzZWQ6IGlzUGF1c2VkLAogICAgICAgICAgICBpbnRlcnZhbDogaW50ZXJ2YWwKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5UUklHR0VSX1JFRlJFU0hfVElNRVI6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5tYXBTdGF0ZSwgewogICAgICAgICAgcmVmcmVzaFRpbWVyTGFzdFRyaWdnZXJlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfU0VMRUNURURfTEFZRVI6CiAgICAgIHZhciBzZWxlY3RlZE1hdGNoID0gc3RhdGUubGF5ZXJMaXN0LmZpbmQoZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIGxheWVyLmlkID09PSBhY3Rpb24uc2VsZWN0ZWRMYXllcklkOwogICAgICB9KTsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgc2VsZWN0ZWRMYXllcklkOiBzZWxlY3RlZE1hdGNoID8gYWN0aW9uLnNlbGVjdGVkTGF5ZXJJZCA6IG51bGwKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuU0VUX1RSQU5TSUVOVF9MQVlFUjoKICAgICAgdmFyIHRyYW5zaWVudE1hdGNoID0gc3RhdGUubGF5ZXJMaXN0LmZpbmQoZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIGxheWVyLmlkID09PSBhY3Rpb24udHJhbnNpZW50TGF5ZXJJZDsKICAgICAgfSk7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIF9fdHJhbnNpZW50TGF5ZXJJZDogdHJhbnNpZW50TWF0Y2ggPyBhY3Rpb24udHJhbnNpZW50TGF5ZXJJZCA6IG51bGwKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuVVBEQVRFX0xBWUVSX09SREVSOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBsYXllckxpc3Q6IGFjdGlvbi5uZXdMYXllck9yZGVyLm1hcChmdW5jdGlvbiAobGF5ZXJOdW1iZXIpIHsKICAgICAgICAgIHJldHVybiBzdGF0ZS5sYXllckxpc3RbbGF5ZXJOdW1iZXJdOwogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlVQREFURV9MQVlFUl9QUk9QOgogICAgICByZXR1cm4gdXBkYXRlTGF5ZXJJbkxpc3Qoc3RhdGUsIGFjdGlvbi5pZCwgYWN0aW9uLnByb3BOYW1lLCBhY3Rpb24ubmV3VmFsdWUpOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlVQREFURV9TT1VSQ0VfUFJPUDoKICAgICAgcmV0dXJuIHVwZGF0ZUxheWVyU291cmNlRGVzY3JpcHRvclByb3Aoc3RhdGUsIGFjdGlvbi5sYXllcklkLCBhY3Rpb24ucHJvcE5hbWUsIGFjdGlvbi52YWx1ZSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuU0VUX0pPSU5TOgogICAgICB2YXIgbGF5ZXJEZXNjcmlwdG9yID0gc3RhdGUubGF5ZXJMaXN0LmZpbmQoZnVuY3Rpb24gKGRlc2NyaXB0b3IpIHsKICAgICAgICByZXR1cm4gZGVzY3JpcHRvci5pZCA9PT0gYWN0aW9uLmxheWVyLmdldElkKCk7CiAgICAgIH0pOwoKICAgICAgaWYgKGxheWVyRGVzY3JpcHRvcikgewogICAgICAgIHZhciBuZXdMYXllckRlc2NyaXB0b3IgPSBfb2JqZWN0U3ByZWFkKHt9LCBsYXllckRlc2NyaXB0b3IsIHsKICAgICAgICAgIGpvaW5zOiBhY3Rpb24uam9pbnMuc2xpY2UoKQogICAgICAgIH0pOwoKICAgICAgICB2YXIgX2luZGV4ID0gc3RhdGUubGF5ZXJMaXN0LmZpbmRJbmRleChmdW5jdGlvbiAoZGVzY3JpcHRvcikgewogICAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3IuaWQgPT09IGFjdGlvbi5sYXllci5nZXRJZCgpOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgX25ld0xheWVyTGlzdCA9IHN0YXRlLmxheWVyTGlzdC5zbGljZSgpOwoKICAgICAgICBfbmV3TGF5ZXJMaXN0W19pbmRleF0gPSBuZXdMYXllckRlc2NyaXB0b3I7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgICBsYXllckxpc3Q6IF9uZXdMYXllckxpc3QKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHN0YXRlOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkFERF9MQVlFUjoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbGF5ZXJMaXN0OiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLmxheWVyTGlzdCksIFthY3Rpb24ubGF5ZXJdKQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5SRU1PVkVfTEFZRVI6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIGxheWVyTGlzdDogX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLmxheWVyTGlzdC5maWx0ZXIoZnVuY3Rpb24gKF9yZWYyKSB7CiAgICAgICAgICB2YXIgaWQgPSBfcmVmMi5pZDsKICAgICAgICAgIHJldHVybiBpZCAhPT0gYWN0aW9uLmlkOwogICAgICAgIH0pKQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5BRERfV0FJVElOR19GT1JfTUFQX1JFQURZX0xBWUVSOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICB3YWl0aW5nRm9yTWFwUmVhZHlMYXllckxpc3Q6IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUud2FpdGluZ0Zvck1hcFJlYWR5TGF5ZXJMaXN0KSwgW2FjdGlvbi5sYXllcl0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkNMRUFSX1dBSVRJTkdfRk9SX01BUF9SRUFEWV9MQVlFUl9MSVNUOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICB3YWl0aW5nRm9yTWFwUmVhZHlMYXllckxpc3Q6IFtdCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9MQVlFUl9WSVNJQklMSVRZOgogICAgICByZXR1cm4gdXBkYXRlTGF5ZXJJbkxpc3Qoc3RhdGUsIGFjdGlvbi5sYXllcklkLCAndmlzaWJsZScsIGFjdGlvbi52aXNpYmlsaXR5KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5VUERBVEVfTEFZRVJfU1RZTEU6CiAgICAgIHZhciBzdHlsZUxheWVySWQgPSBhY3Rpb24ubGF5ZXJJZDsKICAgICAgcmV0dXJuIHVwZGF0ZUxheWVySW5MaXN0KHN0YXRlLCBzdHlsZUxheWVySWQsICdzdHlsZScsIF9vYmplY3RTcHJlYWQoe30sIGFjdGlvbi5zdHlsZSkpOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9MQVlFUl9TVFlMRV9NRVRBOgogICAgICB2YXIgbGF5ZXJJZCA9IGFjdGlvbi5sYXllcklkLAogICAgICAgICAgc3R5bGVNZXRhID0gYWN0aW9uLnN0eWxlTWV0YTsKICAgICAgdmFyIGluZGV4ID0gZ2V0TGF5ZXJJbmRleChzdGF0ZS5sYXllckxpc3QsIGxheWVySWQpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHVwZGF0ZUxheWVySW5MaXN0KHN0YXRlLCBsYXllcklkLCAnc3R5bGUnLCBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5sYXllckxpc3RbaW5kZXhdLnN0eWxlLCB7CiAgICAgICAgX19zdHlsZU1ldGE6IHN0eWxlTWV0YQogICAgICB9KSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuU0VUX1NDUk9MTF9aT09NOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIHNjcm9sbFpvb206IGFjdGlvbi5zY3JvbGxab29tCiAgICAgICAgfSkKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuU0VUX01BUF9JTklUX0VSUk9SOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBJbml0RXJyb3I6IGFjdGlvbi5lcnJvck1lc3NhZ2UKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuU0VUX0lOVEVSQUNUSVZFOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIGRpc2FibGVJbnRlcmFjdGl2ZTogYWN0aW9uLmRpc2FibGVJbnRlcmFjdGl2ZQogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkRJU0FCTEVfVE9PTFRJUF9DT05UUk9MOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIGRpc2FibGVUb29sdGlwQ29udHJvbDogYWN0aW9uLmRpc2FibGVUb29sdGlwQ29udHJvbAogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkhJREVfVE9PTEJBUl9PVkVSTEFZOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIGhpZGVUb29sYmFyT3ZlcmxheTogYWN0aW9uLmhpZGVUb29sYmFyT3ZlcmxheQogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkhJREVfTEFZRVJfQ09OVFJPTDoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7CiAgICAgICAgICBoaWRlTGF5ZXJDb250cm9sOiBhY3Rpb24uaGlkZUxheWVyQ29udHJvbAogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkhJREVfVklFV19DT05UUk9MOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIGhpZGVWaWV3Q29udHJvbDogYWN0aW9uLmhpZGVWaWV3Q29udHJvbAogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9XQUlUSU5HX0ZPUl9SRUFEWV9ISURERU5fTEFZRVJTOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICB3YWl0aW5nRm9yTWFwUmVhZHlMYXllckxpc3Q6IHN0YXRlLndhaXRpbmdGb3JNYXBSZWFkeUxheWVyTGlzdC5tYXAoZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgbGF5ZXIsIHsKICAgICAgICAgICAgdmlzaWJsZTogIWFjdGlvbi5oaWRkZW5MYXllcklkcy5pbmNsdWRlcyhsYXllci5pZCkKICAgICAgICAgIH0pOwogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBzdGF0ZTsKICB9Cn0KCmZ1bmN0aW9uIGZpbmREYXRhUmVxdWVzdChsYXllckRlc2NyaXB0b3IsIGRhdGFSZXF1ZXN0QWN0aW9uKSB7CiAgaWYgKCFsYXllckRlc2NyaXB0b3IuX19kYXRhUmVxdWVzdHMpIHsKICAgIHJldHVybjsKICB9CgogIHJldHVybiBsYXllckRlc2NyaXB0b3IuX19kYXRhUmVxdWVzdHMuZmluZChmdW5jdGlvbiAoZGF0YVJlcXVlc3QpIHsKICAgIHJldHVybiBkYXRhUmVxdWVzdC5kYXRhSWQgPT09IGRhdGFSZXF1ZXN0QWN0aW9uLmRhdGFJZDsKICB9KTsKfQoKZnVuY3Rpb24gdXBkYXRlV2l0aERhdGFSZXF1ZXN0KHN0YXRlLCBhY3Rpb24pIHsKICB2YXIgZGF0YVJlcXVlc3QgPSBnZXRWYWxpZERhdGFSZXF1ZXN0KHN0YXRlLCBhY3Rpb24sIGZhbHNlKTsKICB2YXIgbGF5ZXJSZXF1ZXN0aW5nRGF0YSA9IGZpbmRMYXllckJ5SWQoc3RhdGUsIGFjdGlvbi5sYXllcklkKTsKCiAgaWYgKCFkYXRhUmVxdWVzdCkgewogICAgZGF0YVJlcXVlc3QgPSB7CiAgICAgIGRhdGFJZDogYWN0aW9uLmRhdGFJZAogICAgfTsKICAgIGxheWVyUmVxdWVzdGluZ0RhdGEuX19kYXRhUmVxdWVzdHMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGxheWVyUmVxdWVzdGluZ0RhdGEuX19kYXRhUmVxdWVzdHMgPyBsYXllclJlcXVlc3RpbmdEYXRhLl9fZGF0YVJlcXVlc3RzIDogW10pLCBbZGF0YVJlcXVlc3RdKTsKICB9CgogIGRhdGFSZXF1ZXN0LmRhdGFNZXRhQXRTdGFydCA9IGFjdGlvbi5tZXRhOwogIGRhdGFSZXF1ZXN0LmRhdGFSZXF1ZXN0VG9rZW4gPSBhY3Rpb24ucmVxdWVzdFRva2VuOwoKICB2YXIgbGF5ZXJMaXN0ID0gX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLmxheWVyTGlzdCk7CgogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgbGF5ZXJMaXN0OiBsYXllckxpc3QKICB9KTsKfQoKZnVuY3Rpb24gdXBkYXRlU291cmNlRGF0YVJlcXVlc3Qoc3RhdGUsIGFjdGlvbikgewogIHZhciBsYXllckRlc2NyaXB0b3IgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBhY3Rpb24ubGF5ZXJJZCk7CgogIGlmICghbGF5ZXJEZXNjcmlwdG9yKSB7CiAgICByZXR1cm4gc3RhdGU7CiAgfQoKICB2YXIgZGF0YVJlcXVlc3QgPSBsYXllckRlc2NyaXB0b3IuX19kYXRhUmVxdWVzdHMuZmluZChmdW5jdGlvbiAoZGF0YVJlcXVlc3QpIHsKICAgIHJldHVybiBkYXRhUmVxdWVzdC5kYXRhSWQgPT09IF9jb25zdGFudHMuU09VUkNFX0RBVEFfSURfT1JJR0lOOwogIH0pOwoKICBpZiAoIWRhdGFSZXF1ZXN0KSB7CiAgICByZXR1cm4gc3RhdGU7CiAgfQoKICBkYXRhUmVxdWVzdC5kYXRhID0gYWN0aW9uLm5ld0RhdGE7CiAgcmV0dXJuIHJlc2V0RGF0YVJlcXVlc3Qoc3RhdGUsIGFjdGlvbiwgZGF0YVJlcXVlc3QpOwp9CgpmdW5jdGlvbiB1cGRhdGVXaXRoRGF0YVJlc3BvbnNlKHN0YXRlLCBhY3Rpb24pIHsKICB2YXIgZGF0YVJlcXVlc3QgPSBnZXRWYWxpZERhdGFSZXF1ZXN0KHN0YXRlLCBhY3Rpb24pOwoKICBpZiAoIWRhdGFSZXF1ZXN0KSB7CiAgICByZXR1cm4gc3RhdGU7CiAgfQoKICBkYXRhUmVxdWVzdC5kYXRhID0gYWN0aW9uLmRhdGE7CiAgZGF0YVJlcXVlc3QuZGF0YU1ldGEgPSBfb2JqZWN0U3ByZWFkKHt9LCBkYXRhUmVxdWVzdC5kYXRhTWV0YUF0U3RhcnQsIHt9LCBhY3Rpb24ubWV0YSk7CiAgZGF0YVJlcXVlc3QuZGF0YU1ldGFBdFN0YXJ0ID0gbnVsbDsKICByZXR1cm4gcmVzZXREYXRhUmVxdWVzdChzdGF0ZSwgYWN0aW9uLCBkYXRhUmVxdWVzdCk7Cn0KCmZ1bmN0aW9uIHJlc2V0RGF0YVJlcXVlc3Qoc3RhdGUsIGFjdGlvbiwgcmVxdWVzdCkgewogIHZhciBkYXRhUmVxdWVzdCA9IHJlcXVlc3QgfHwgZ2V0VmFsaWREYXRhUmVxdWVzdChzdGF0ZSwgYWN0aW9uKTsKCiAgaWYgKCFkYXRhUmVxdWVzdCkgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgZGF0YVJlcXVlc3QuZGF0YVJlcXVlc3RUb2tlbiA9IG51bGw7CiAgZGF0YVJlcXVlc3QuZGF0YUlkID0gYWN0aW9uLmRhdGFJZDsKCiAgdmFyIGxheWVyTGlzdCA9IF90b0NvbnN1bWFibGVBcnJheShzdGF0ZS5sYXllckxpc3QpOwoKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgIGxheWVyTGlzdDogbGF5ZXJMaXN0CiAgfSk7Cn0KCmZ1bmN0aW9uIGdldFZhbGlkRGF0YVJlcXVlc3Qoc3RhdGUsIGFjdGlvbikgewogIHZhciBjaGVja1JlcXVlc3RUb2tlbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogdHJ1ZTsKICB2YXIgbGF5ZXIgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBhY3Rpb24ubGF5ZXJJZCk7CgogIGlmICghbGF5ZXIpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBkYXRhUmVxdWVzdCA9IGZpbmREYXRhUmVxdWVzdChsYXllciwgYWN0aW9uKTsKCiAgaWYgKCFkYXRhUmVxdWVzdCkgewogICAgcmV0dXJuOwogIH0KCiAgaWYgKGNoZWNrUmVxdWVzdFRva2VuICYmIGRhdGFSZXF1ZXN0LmRhdGFSZXF1ZXN0VG9rZW4gJiYgZGF0YVJlcXVlc3QuZGF0YVJlcXVlc3RUb2tlbiAhPT0gYWN0aW9uLnJlcXVlc3RUb2tlbikgewogICAgLy8gaWdub3JlIHJlc3BvbnNlcyB0byBvdXRkYXRlZCByZXF1ZXN0cwogICAgcmV0dXJuOwogIH0KCiAgcmV0dXJuIGRhdGFSZXF1ZXN0Owp9CgpmdW5jdGlvbiBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBpZCkgewogIHJldHVybiBzdGF0ZS5sYXllckxpc3QuZmluZChmdW5jdGlvbiAobGF5ZXIpIHsKICAgIHJldHVybiBsYXllci5pZCA9PT0gaWQ7CiAgfSk7Cn0KCmZ1bmN0aW9uIHRyYWNrQ3VycmVudExheWVyU3RhdGUoc3RhdGUsIGxheWVySWQpIHsKICB2YXIgbGF5ZXIgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBsYXllcklkKTsKICB2YXIgbGF5ZXJDb3B5ID0gKDAsIF91dGlsLmNvcHlQZXJzaXN0ZW50U3RhdGUpKGxheWVyKTsKICByZXR1cm4gdXBkYXRlTGF5ZXJJbkxpc3Qoc3RhdGUsIGxheWVySWQsIF91dGlsLlRSQUNLRURfTEFZRVJfREVTQ1JJUFRPUiwgbGF5ZXJDb3B5KTsKfQoKZnVuY3Rpb24gcmVtb3ZlVHJhY2tlZExheWVyU3RhdGUoc3RhdGUsIGxheWVySWQpIHsKICB2YXIgbGF5ZXIgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBsYXllcklkKTsKCiAgaWYgKCFsYXllcikgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgdmFyIGNvcHlMYXllciA9IF9vYmplY3RTcHJlYWQoe30sIGxheWVyKTsKCiAgZGVsZXRlIGNvcHlMYXllcltfdXRpbC5UUkFDS0VEX0xBWUVSX0RFU0NSSVBUT1JdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgbGF5ZXJMaXN0OiByZXBsYWNlSW5MYXllckxpc3Qoc3RhdGUubGF5ZXJMaXN0LCBsYXllcklkLCBjb3B5TGF5ZXIpCiAgfSk7Cn0KCmZ1bmN0aW9uIHJvbGxiYWNrVHJhY2tlZExheWVyU3RhdGUoc3RhdGUsIGxheWVySWQpIHsKICB2YXIgbGF5ZXIgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBsYXllcklkKTsKCiAgaWYgKCFsYXllcikgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgdmFyIHRyYWNrZWRMYXllckRlc2NyaXB0b3IgPSBsYXllcltfdXRpbC5UUkFDS0VEX0xBWUVSX0RFU0NSSVBUT1JdOyAvL3RoaXMgYXNzdW1lcyB0aGF0IGFueSBuZXN0ZWQgdGVtcC1zdGF0ZSBpbiB0aGUgbGF5ZXItZGVzY3JpcHRvciAoZS5nLiBvZiBzdHlsZXMpLCBpcyBub3QgcmVsZXZhbnQgYW5kIGNhbiBiZSByZWNvdmVyZWQgZWFzaWx5IChlLmcuIHRoaXMgaXMgbm90IHRoZSBjYXNlIGZvciBfX2RhdGFSZXF1ZXN0cykKICAvL1RoYXQgYXNzdW1wdGlvbiBpcyB0cnVlIGluIHRoZSBjb250ZXh0IG9mIHRoaXMgYXBwLCBidXQgbm90IGdlbmVyYWxpemFibGUuCiAgLy9jb25zaWRlciByZXdyaXRpbmcgY29weVBlcnNpc3RlbnRTdGF0ZSB0byBvbmx5IHN0cmlwIHRoZSBmaXJzdCBsZXZlbCBvZiB0ZW1wIHN0YXRlLgoKICB2YXIgcm9sbGVkYmFja0xheWVyID0gX29iamVjdFNwcmVhZCh7fSwgbGF5ZXIsIHt9LCB0cmFja2VkTGF5ZXJEZXNjcmlwdG9yKTsKCiAgZGVsZXRlIHJvbGxlZGJhY2tMYXllcltfdXRpbC5UUkFDS0VEX0xBWUVSX0RFU0NSSVBUT1JdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgbGF5ZXJMaXN0OiByZXBsYWNlSW5MYXllckxpc3Qoc3RhdGUubGF5ZXJMaXN0LCBsYXllcklkLCByb2xsZWRiYWNrTGF5ZXIpCiAgfSk7Cn0KCmZ1bmN0aW9uIHJlcGxhY2VJbkxheWVyTGlzdChsYXllckxpc3QsIGxheWVySWQsIG5ld0xheWVyRGVzY3JpcHRvcikgewogIHZhciBsYXllckluZGV4ID0gZ2V0TGF5ZXJJbmRleChsYXllckxpc3QsIGxheWVySWQpOwoKICB2YXIgbmV3TGF5ZXJMaXN0ID0gX3RvQ29uc3VtYWJsZUFycmF5KGxheWVyTGlzdCk7CgogIG5ld0xheWVyTGlzdFtsYXllckluZGV4XSA9IG5ld0xheWVyRGVzY3JpcHRvcjsKICByZXR1cm4gbmV3TGF5ZXJMaXN0Owp9"},null]}