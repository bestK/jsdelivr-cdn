{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/siem/public/pages/detection_engine/rules/create/index.js","dependencies":[{"path":"x-pack/legacy/plugins/siem/public/pages/detection_engine/rules/create/index.js","mtime":1585205047887},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkNyZWF0ZVJ1bGVQYWdlID0gdm9pZCAwOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfcmVhY3RSb3V0ZXJEb20gPSByZXF1aXJlKCJyZWFjdC1yb3V0ZXItZG9tIik7Cgp2YXIgX3N0eWxlZENvbXBvbmVudHMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInN0eWxlZC1jb21wb25lbnRzIikpOwoKdmFyIF9ydWxlcyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvbnRhaW5lcnMvZGV0ZWN0aW9uX2VuZ2luZS9ydWxlcyIpOwoKdmFyIF9yZWRpcmVjdF90b19kZXRlY3Rpb25fZW5naW5lID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tcG9uZW50cy9saW5rX3RvL3JlZGlyZWN0X3RvX2RldGVjdGlvbl9lbmdpbmUiKTsKCnZhciBfd3JhcHBlcl9wYWdlID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tcG9uZW50cy93cmFwcGVyX3BhZ2UiKTsKCnZhciBfdG9hc3RlcnMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL3RvYXN0ZXJzIik7Cgp2YXIgX3NweV9yb3V0ZXMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi91dGlscy9yb3V0ZS9zcHlfcm91dGVzIik7Cgp2YXIgX3VzZXJfaW5mbyA9IHJlcXVpcmUoIi4uLy4uL2NvbXBvbmVudHMvdXNlcl9pbmZvIik7Cgp2YXIgX2FjY29yZGlvbl90aXRsZSA9IHJlcXVpcmUoIi4uL2NvbXBvbmVudHMvYWNjb3JkaW9uX3RpdGxlIik7Cgp2YXIgX3N0ZXBfYWJvdXRfcnVsZSA9IHJlcXVpcmUoIi4uL2NvbXBvbmVudHMvc3RlcF9hYm91dF9ydWxlIik7Cgp2YXIgX3N0ZXBfZGVmaW5lX3J1bGUgPSByZXF1aXJlKCIuLi9jb21wb25lbnRzL3N0ZXBfZGVmaW5lX3J1bGUiKTsKCnZhciBfc3RlcF9zY2hlZHVsZV9ydWxlID0gcmVxdWlyZSgiLi4vY29tcG9uZW50cy9zdGVwX3NjaGVkdWxlX3J1bGUiKTsKCnZhciBfZGV0ZWN0aW9uX2VuZ2luZV9oZWFkZXJfcGFnZSA9IHJlcXVpcmUoIi4uLy4uL2NvbXBvbmVudHMvZGV0ZWN0aW9uX2VuZ2luZV9oZWFkZXJfcGFnZSIpOwoKdmFyIFJ1bGVJMThuID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgiLi4vdHJhbnNsYXRpb25zIikpOwoKdmFyIF9oZWxwZXJzID0gcmVxdWlyZSgiLi4vaGVscGVycyIpOwoKdmFyIF90eXBlcyA9IHJlcXVpcmUoIi4uL3R5cGVzIik7Cgp2YXIgX2hlbHBlcnMyID0gcmVxdWlyZSgiLi9oZWxwZXJzIik7Cgp2YXIgaTE4biA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoIi4vdHJhbnNsYXRpb25zIikpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQoKdmFyIHN0ZXBzUnVsZU9yZGVyID0gW190eXBlcy5SdWxlU3RlcC5kZWZpbmVSdWxlLCBfdHlwZXMuUnVsZVN0ZXAuYWJvdXRSdWxlLCBfdHlwZXMuUnVsZVN0ZXAuc2NoZWR1bGVSdWxlXTsKdmFyIE15RXVpUGFuZWwgPSAoMCwgX3N0eWxlZENvbXBvbmVudHMuZGVmYXVsdCkoX2V1aS5FdWlQYW5lbCkud2l0aENvbmZpZyh7CiAgZGlzcGxheU5hbWU6ICJNeUV1aVBhbmVsIiwKICBjb21wb25lbnRJZDogInl5aDhmZS0wIgp9KShbInBvc2l0aW9uOnJlbGF0aXZlO3otaW5kZXg6IiwgIjs+IC5ldWlBY2NvcmRpb24gPiAuZXVpQWNjb3JkaW9uX190cmlnZ2VyV3JhcHBlcnsuZXVpQWNjb3JkaW9uX19idXR0b257Y3Vyc29yOmRlZmF1bHQgIWltcG9ydGFudDsmOmhvdmVye3RleHQtZGVjb3JhdGlvbjpub25lICFpbXBvcnRhbnQ7fX0uZXVpQWNjb3JkaW9uX19pY29uV3JhcHBlcntkaXNwbGF5Om5vbmU7fX0iXSwgZnVuY3Rpb24gKHByb3BzKSB7CiAgcmV0dXJuIHByb3BzLnppbmRleDsKfSk7Ck15RXVpUGFuZWwuZGlzcGxheU5hbWUgPSAnTXlFdWlQYW5lbCc7CnZhciBTdGVwRGVmaW5lUnVsZUFjY29yZGlvbiA9ICgwLCBfc3R5bGVkQ29tcG9uZW50cy5kZWZhdWx0KShfZXVpLkV1aUFjY29yZGlvbikud2l0aENvbmZpZyh7CiAgZGlzcGxheU5hbWU6ICJTdGVwRGVmaW5lUnVsZUFjY29yZGlvbiIsCiAgY29tcG9uZW50SWQ6ICJ5eWg4ZmUtMSIKfSkoWyIuZXVpQWNjb3JkaW9uX19jaGlsZFdyYXBwZXJ7b3ZlcmZsb3c6dmlzaWJsZTt9Il0pOwpTdGVwRGVmaW5lUnVsZUFjY29yZGlvbi5kaXNwbGF5TmFtZSA9ICdTdGVwRGVmaW5lUnVsZUFjY29yZGlvbic7Cgp2YXIgQ3JlYXRlUnVsZVBhZ2VDb21wb25lbnQgPSBmdW5jdGlvbiBDcmVhdGVSdWxlUGFnZUNvbXBvbmVudCgpIHsKICB2YXIgX3VzZVJlZiwgX3VzZVJlZjIsIF91c2VTdGF0ZTUsIF9yZWYsIF9yZWYyLCBfcmVmMzsKCiAgdmFyIF91c2VVc2VySW5mbyA9ICgwLCBfdXNlcl9pbmZvLnVzZVVzZXJJbmZvKSgpLAogICAgICBsb2FkaW5nID0gX3VzZVVzZXJJbmZvLmxvYWRpbmcsCiAgICAgIGlzU2lnbmFsSW5kZXhFeGlzdHMgPSBfdXNlVXNlckluZm8uaXNTaWduYWxJbmRleEV4aXN0cywKICAgICAgaXNBdXRoZW50aWNhdGVkID0gX3VzZVVzZXJJbmZvLmlzQXV0aGVudGljYXRlZCwKICAgICAgaGFzRW5jcnlwdGlvbktleSA9IF91c2VVc2VySW5mby5oYXNFbmNyeXB0aW9uS2V5LAogICAgICBjYW5Vc2VyQ1JVRCA9IF91c2VVc2VySW5mby5jYW5Vc2VyQ1JVRCwKICAgICAgaGFzTWFuYWdlQXBpS2V5ID0gX3VzZVVzZXJJbmZvLmhhc01hbmFnZUFwaUtleTsKCiAgdmFyIF91c2VTdGF0ZVRvYXN0ZXIgPSAoMCwgX3RvYXN0ZXJzLnVzZVN0YXRlVG9hc3RlcikoKSwKICAgICAgX3VzZVN0YXRlVG9hc3RlcjIgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGVUb2FzdGVyLCAyKSwKICAgICAgZGlzcGF0Y2hUb2FzdGVyID0gX3VzZVN0YXRlVG9hc3RlcjJbMV07CgogIHZhciBfdXNlU3RhdGUgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKShfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSksCiAgICAgIF91c2VTdGF0ZTIgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLAogICAgICBvcGVuQWNjb3JkaW9uSWQgPSBfdXNlU3RhdGUyWzBdLAogICAgICBzZXRPcGVuQWNjb3JkaW9uSWQgPSBfdXNlU3RhdGUyWzFdOwoKICB2YXIgZGVmaW5lUnVsZVJlZiA9ICgwLCBfcmVhY3QudXNlUmVmKShudWxsKTsKICB2YXIgYWJvdXRSdWxlUmVmID0gKDAsIF9yZWFjdC51c2VSZWYpKG51bGwpOwogIHZhciBzY2hlZHVsZVJ1bGVSZWYgPSAoMCwgX3JlYWN0LnVzZVJlZikobnVsbCk7CiAgdmFyIHN0ZXBzRm9ybSA9ICgwLCBfcmVhY3QudXNlUmVmKSgoX3VzZVJlZiA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX3VzZVJlZiwgX3R5cGVzLlJ1bGVTdGVwLmRlZmluZVJ1bGUsIG51bGwpLCBfZGVmaW5lUHJvcGVydHkoX3VzZVJlZiwgX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZSwgbnVsbCksIF9kZWZpbmVQcm9wZXJ0eShfdXNlUmVmLCBfdHlwZXMuUnVsZVN0ZXAuc2NoZWR1bGVSdWxlLCBudWxsKSwgX3VzZVJlZikpOwogIHZhciBzdGVwc0RhdGEgPSAoMCwgX3JlYWN0LnVzZVJlZikoKF91c2VSZWYyID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfdXNlUmVmMiwgX3R5cGVzLlJ1bGVTdGVwLmRlZmluZVJ1bGUsIHsKICAgIGlzVmFsaWQ6IGZhbHNlLAogICAgZGF0YToge30KICB9KSwgX2RlZmluZVByb3BlcnR5KF91c2VSZWYyLCBfdHlwZXMuUnVsZVN0ZXAuYWJvdXRSdWxlLCB7CiAgICBpc1ZhbGlkOiBmYWxzZSwKICAgIGRhdGE6IHt9CiAgfSksIF9kZWZpbmVQcm9wZXJ0eShfdXNlUmVmMiwgX3R5cGVzLlJ1bGVTdGVwLnNjaGVkdWxlUnVsZSwgewogICAgaXNWYWxpZDogZmFsc2UsCiAgICBkYXRhOiB7fQogIH0pLCBfdXNlUmVmMikpOwoKICB2YXIgX3VzZVN0YXRlMyA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKChfdXNlU3RhdGU1ID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfdXNlU3RhdGU1LCBfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSwgZmFsc2UpLCBfZGVmaW5lUHJvcGVydHkoX3VzZVN0YXRlNSwgX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZSwgZmFsc2UpLCBfZGVmaW5lUHJvcGVydHkoX3VzZVN0YXRlNSwgX3R5cGVzLlJ1bGVTdGVwLnNjaGVkdWxlUnVsZSwgZmFsc2UpLCBfdXNlU3RhdGU1KSksCiAgICAgIF91c2VTdGF0ZTQgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUzLCAyKSwKICAgICAgaXNTdGVwUnVsZUluUmVhZE9ubHlWaWV3ID0gX3VzZVN0YXRlNFswXSwKICAgICAgc2V0SXNTdGVwUnVsZUluRWRpdFZpZXcgPSBfdXNlU3RhdGU0WzFdOwoKICB2YXIgX3VzZVBlcnNpc3RSdWxlID0gKDAsIF9ydWxlcy51c2VQZXJzaXN0UnVsZSkoKSwKICAgICAgX3VzZVBlcnNpc3RSdWxlMiA9IF9zbGljZWRUb0FycmF5KF91c2VQZXJzaXN0UnVsZSwgMiksCiAgICAgIF91c2VQZXJzaXN0UnVsZTIkID0gX3VzZVBlcnNpc3RSdWxlMlswXSwKICAgICAgaXNMb2FkaW5nID0gX3VzZVBlcnNpc3RSdWxlMiQuaXNMb2FkaW5nLAogICAgICBpc1NhdmVkID0gX3VzZVBlcnNpc3RSdWxlMiQuaXNTYXZlZCwKICAgICAgc2V0UnVsZSA9IF91c2VQZXJzaXN0UnVsZTJbMV07CgogIHZhciB1c2VySGFzTm9QZXJtaXNzaW9ucyA9IGNhblVzZXJDUlVEICE9IG51bGwgJiYgaGFzTWFuYWdlQXBpS2V5ICE9IG51bGwgPyAhY2FuVXNlckNSVUQgfHwgIWhhc01hbmFnZUFwaUtleSA6IGZhbHNlOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvcnVsZXMtb2YtaG9va3MKCiAgdmFyIHNldFN0ZXBEYXRhID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKHN0ZXAsIGRhdGEsIGlzVmFsaWQpIHsKICAgIHN0ZXBzRGF0YS5jdXJyZW50W3N0ZXBdID0gX29iamVjdFNwcmVhZCh7fSwgc3RlcHNEYXRhLmN1cnJlbnRbc3RlcF0sIHsKICAgICAgZGF0YTogZGF0YSwKICAgICAgaXNWYWxpZDogaXNWYWxpZAogICAgfSk7CgogICAgaWYgKGlzVmFsaWQpIHsKICAgICAgdmFyIHN0ZXBSdWxlSWR4ID0gc3RlcHNSdWxlT3JkZXIuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIHN0ZXAgPT09IGl0ZW07CiAgICAgIH0pOwoKICAgICAgaWYgKFswLCAxXS5pbmNsdWRlcyhzdGVwUnVsZUlkeCkpIHsKICAgICAgICBpZiAoaXNTdGVwUnVsZUluUmVhZE9ubHlWaWV3W3N0ZXBzUnVsZU9yZGVyW3N0ZXBSdWxlSWR4ICsgMV1dKSB7CiAgICAgICAgICB2YXIgX29iamVjdFNwcmVhZDI7CgogICAgICAgICAgc2V0T3BlbkFjY29yZGlvbklkKHN0ZXBzUnVsZU9yZGVyW3N0ZXBSdWxlSWR4ICsgMV0pOwogICAgICAgICAgc2V0SXNTdGVwUnVsZUluRWRpdFZpZXcoX29iamVjdFNwcmVhZCh7fSwgaXNTdGVwUnVsZUluUmVhZE9ubHlWaWV3LCAoX29iamVjdFNwcmVhZDIgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9vYmplY3RTcHJlYWQyLCBzdGVwLCB0cnVlKSwgX2RlZmluZVByb3BlcnR5KF9vYmplY3RTcHJlYWQyLCBzdGVwc1J1bGVPcmRlcltzdGVwUnVsZUlkeCArIDFdLCBmYWxzZSksIF9vYmplY3RTcHJlYWQyKSkpOwogICAgICAgIH0gZWxzZSBpZiAob3BlbkFjY29yZGlvbklkICE9PSBzdGVwc1J1bGVPcmRlcltzdGVwUnVsZUlkeCArIDFdKSB7CiAgICAgICAgICBzZXRJc1N0ZXBSdWxlSW5FZGl0Vmlldyhfb2JqZWN0U3ByZWFkKHt9LCBpc1N0ZXBSdWxlSW5SZWFkT25seVZpZXcsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgc3RlcCwgdHJ1ZSkpKTsKICAgICAgICAgIG9wZW5DbG9zZUFjY29yZGlvbihzdGVwc1J1bGVPcmRlcltzdGVwUnVsZUlkeCArIDFdKTsKICAgICAgICAgIHNldE9wZW5BY2NvcmRpb25JZChzdGVwc1J1bGVPcmRlcltzdGVwUnVsZUlkeCArIDFdKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoc3RlcFJ1bGVJZHggPT09IDIgJiYgc3RlcHNEYXRhLmN1cnJlbnRbX3R5cGVzLlJ1bGVTdGVwLmRlZmluZVJ1bGVdLmlzVmFsaWQgJiYgc3RlcHNEYXRhLmN1cnJlbnRbX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZV0uaXNWYWxpZCkgewogICAgICAgIHNldFJ1bGUoKDAsIF9oZWxwZXJzMi5mb3JtYXRSdWxlKShzdGVwc0RhdGEuY3VycmVudFtfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZV0uZGF0YSwgc3RlcHNEYXRhLmN1cnJlbnRbX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZV0uZGF0YSwgc3RlcHNEYXRhLmN1cnJlbnRbX3R5cGVzLlJ1bGVTdGVwLnNjaGVkdWxlUnVsZV0uZGF0YSkpOwogICAgICB9CiAgICB9CiAgfSwgW2lzU3RlcFJ1bGVJblJlYWRPbmx5Vmlldywgb3BlbkFjY29yZGlvbklkLCBzdGVwc0RhdGEuY3VycmVudCwgc2V0UnVsZV0pOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvcnVsZXMtb2YtaG9va3MKCiAgdmFyIHNldFN0ZXBzRm9ybSA9ICgwLCBfcmVhY3QudXNlQ2FsbGJhY2spKGZ1bmN0aW9uIChzdGVwLCBmb3JtKSB7CiAgICBzdGVwc0Zvcm0uY3VycmVudFtzdGVwXSA9IGZvcm07CiAgfSwgW10pOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvcnVsZXMtb2YtaG9va3MKCiAgdmFyIGdldEFjY29yZGlvblR5cGUgPSAoMCwgX3JlYWN0LnVzZUNhbGxiYWNrKShmdW5jdGlvbiAoYWNjb3JkaW9uSWQpIHsKICAgIGlmIChhY2NvcmRpb25JZCA9PT0gb3BlbkFjY29yZGlvbklkKSB7CiAgICAgIHJldHVybiAnYWN0aXZlJzsKICAgIH0gZWxzZSBpZiAoc3RlcHNEYXRhLmN1cnJlbnRbYWNjb3JkaW9uSWRdLmlzVmFsaWQpIHsKICAgICAgcmV0dXJuICd2YWxpZCc7CiAgICB9CgogICAgcmV0dXJuICdwYXNzaXZlJzsKICB9LCBbb3BlbkFjY29yZGlvbklkLCBzdGVwc0RhdGEuY3VycmVudF0pOwoKICB2YXIgZGVmaW5lUnVsZUJ1dHRvbiA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2FjY29yZGlvbl90aXRsZS5BY2NvcmRpb25UaXRsZSwgewogICAgbmFtZTogIjEiLAogICAgdGl0bGU6IFJ1bGVJMThuLkRFRklORV9SVUxFLAogICAgdHlwZTogZ2V0QWNjb3JkaW9uVHlwZShfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSkKICB9KTsKCiAgdmFyIGFib3V0UnVsZUJ1dHRvbiA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2FjY29yZGlvbl90aXRsZS5BY2NvcmRpb25UaXRsZSwgewogICAgbmFtZTogIjIiLAogICAgdGl0bGU6IFJ1bGVJMThuLkFCT1VUX1JVTEUsCiAgICB0eXBlOiBnZXRBY2NvcmRpb25UeXBlKF90eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGUpCiAgfSk7CgogIHZhciBzY2hlZHVsZVJ1bGVCdXR0b24gPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9hY2NvcmRpb25fdGl0bGUuQWNjb3JkaW9uVGl0bGUsIHsKICAgIG5hbWU6ICIzIiwKICAgIHRpdGxlOiBSdWxlSTE4bi5TQ0hFRFVMRV9SVUxFLAogICAgdHlwZTogZ2V0QWNjb3JkaW9uVHlwZShfdHlwZXMuUnVsZVN0ZXAuc2NoZWR1bGVSdWxlKQogIH0pOwoKICB2YXIgb3BlbkNsb3NlQWNjb3JkaW9uID0gZnVuY3Rpb24gb3BlbkNsb3NlQWNjb3JkaW9uKGFjY29yZGlvbklkKSB7CiAgICBpZiAoYWNjb3JkaW9uSWQgIT0gbnVsbCkgewogICAgICBpZiAoYWNjb3JkaW9uSWQgPT09IF90eXBlcy5SdWxlU3RlcC5kZWZpbmVSdWxlICYmIGRlZmluZVJ1bGVSZWYuY3VycmVudCAhPSBudWxsKSB7CiAgICAgICAgZGVmaW5lUnVsZVJlZi5jdXJyZW50Lm9uVG9nZ2xlKCk7CiAgICAgIH0gZWxzZSBpZiAoYWNjb3JkaW9uSWQgPT09IF90eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGUgJiYgYWJvdXRSdWxlUmVmLmN1cnJlbnQgIT0gbnVsbCkgewogICAgICAgIGFib3V0UnVsZVJlZi5jdXJyZW50Lm9uVG9nZ2xlKCk7CiAgICAgIH0gZWxzZSBpZiAoYWNjb3JkaW9uSWQgPT09IF90eXBlcy5SdWxlU3RlcC5zY2hlZHVsZVJ1bGUgJiYgc2NoZWR1bGVSdWxlUmVmLmN1cnJlbnQgIT0gbnVsbCkgewogICAgICAgIHNjaGVkdWxlUnVsZVJlZi5jdXJyZW50Lm9uVG9nZ2xlKCk7CiAgICAgIH0KICAgIH0KICB9OyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvcnVsZXMtb2YtaG9va3MKCgogIHZhciBtYW5hZ2VBY2NvcmRpb25zID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKGlkLCBpc09wZW4pIHsKICAgIHZhciBhY3RpdmVSdWxlSWR4ID0gc3RlcHNSdWxlT3JkZXIuZmluZEluZGV4KGZ1bmN0aW9uIChzdGVwKSB7CiAgICAgIHJldHVybiBzdGVwID09PSBvcGVuQWNjb3JkaW9uSWQ7CiAgICB9KTsKICAgIHZhciBzdGVwUnVsZUlkeCA9IHN0ZXBzUnVsZU9yZGVyLmZpbmRJbmRleChmdW5jdGlvbiAoc3RlcCkgewogICAgICByZXR1cm4gc3RlcCA9PT0gaWQ7CiAgICB9KTsKCiAgICBpZiAoKGlkID09PSBvcGVuQWNjb3JkaW9uSWQgfHwgc3RlcFJ1bGVJZHggPCBhY3RpdmVSdWxlSWR4KSAmJiAhaXNPcGVuKSB7CiAgICAgIG9wZW5DbG9zZUFjY29yZGlvbihpZCk7CiAgICB9IGVsc2UgaWYgKHN0ZXBSdWxlSWR4ID49IGFjdGl2ZVJ1bGVJZHgpIHsKICAgICAgaWYgKG9wZW5BY2NvcmRpb25JZCAhPT0gaWQgJiYgIXN0ZXBzRGF0YS5jdXJyZW50W29wZW5BY2NvcmRpb25JZF0uaXNWYWxpZCAmJiAhaXNTdGVwUnVsZUluUmVhZE9ubHlWaWV3W2lkXSAmJiBpc09wZW4pIHsKICAgICAgICBvcGVuQ2xvc2VBY2NvcmRpb24oaWQpOwogICAgICB9CiAgICB9CiAgfSwgW2lzU3RlcFJ1bGVJblJlYWRPbmx5Vmlldywgb3BlbkFjY29yZGlvbklkLCBzdGVwc0RhdGFdKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL3J1bGVzLW9mLWhvb2tzCgogIHZhciBtYW5hZ2VJc0VkaXRhYmxlID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gX2NhbGxlZShpZCkgewogICAgdmFyIF9zdGVwc0Zvcm0kY3VycmVudCRvcDsKCiAgICB2YXIgYWN0aXZlRm9ybSwgX29iamVjdFNwcmVhZDQ7CgogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKF9zdGVwc0Zvcm0kY3VycmVudCRvcCA9IHN0ZXBzRm9ybS5jdXJyZW50W29wZW5BY2NvcmRpb25JZF0pID09PSBudWxsIHx8IF9zdGVwc0Zvcm0kY3VycmVudCRvcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0ZXBzRm9ybSRjdXJyZW50JG9wLnN1Ym1pdCgpKTsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIGFjdGl2ZUZvcm0gPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgaWYgKGFjdGl2ZUZvcm0gIT0gbnVsbCAmJiAoYWN0aXZlRm9ybSA9PT0gbnVsbCB8fCBhY3RpdmVGb3JtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVGb3JtLmlzVmFsaWQpKSB7CiAgICAgICAgICAgICAgc3RlcHNEYXRhLmN1cnJlbnRbb3BlbkFjY29yZGlvbklkXSA9IF9vYmplY3RTcHJlYWQoe30sIHN0ZXBzRGF0YS5jdXJyZW50W29wZW5BY2NvcmRpb25JZF0sIHsKICAgICAgICAgICAgICAgIGRhdGE6IGFjdGl2ZUZvcm0uZGF0YSwKICAgICAgICAgICAgICAgIGlzVmFsaWQ6IGFjdGl2ZUZvcm0uaXNWYWxpZAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHNldE9wZW5BY2NvcmRpb25JZChpZCk7CiAgICAgICAgICAgICAgc2V0SXNTdGVwUnVsZUluRWRpdFZpZXcoX29iamVjdFNwcmVhZCh7fSwgaXNTdGVwUnVsZUluUmVhZE9ubHlWaWV3LCAoX29iamVjdFNwcmVhZDQgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9vYmplY3RTcHJlYWQ0LCBvcGVuQWNjb3JkaW9uSWQsIHRydWUpLCBfZGVmaW5lUHJvcGVydHkoX29iamVjdFNwcmVhZDQsIGlkLCBmYWxzZSksIF9vYmplY3RTcHJlYWQ0KSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0sIFtpc1N0ZXBSdWxlSW5SZWFkT25seVZpZXcsIG9wZW5BY2NvcmRpb25JZF0pOwoKICBpZiAoaXNTYXZlZCkgewogICAgdmFyIHJ1bGVOYW1lID0gc3RlcHNEYXRhLmN1cnJlbnRbX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZV0uZGF0YS5uYW1lOwogICAgKDAsIF90b2FzdGVycy5kaXNwbGF5U3VjY2Vzc1RvYXN0KShpMThuLlNVQ0NFU1NGVUxMWV9DUkVBVEVEX1JVTEVTKHJ1bGVOYW1lKSwgZGlzcGF0Y2hUb2FzdGVyKTsKICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdFJvdXRlckRvbS5SZWRpcmVjdCwgewogICAgICB0bzogIi8iLmNvbmNhdChfcmVkaXJlY3RfdG9fZGV0ZWN0aW9uX2VuZ2luZS5ERVRFQ1RJT05fRU5HSU5FX1BBR0VfTkFNRSwgIi9ydWxlcyIpCiAgICB9KTsKICB9CgogIGlmICgoMCwgX2hlbHBlcnMucmVkaXJlY3RUb0RldGVjdGlvbnMpKGlzU2lnbmFsSW5kZXhFeGlzdHMsIGlzQXV0aGVudGljYXRlZCwgaGFzRW5jcnlwdGlvbktleSkpIHsKICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdFJvdXRlckRvbS5SZWRpcmVjdCwgewogICAgICB0bzogIi8iLmNvbmNhdChfcmVkaXJlY3RfdG9fZGV0ZWN0aW9uX2VuZ2luZS5ERVRFQ1RJT05fRU5HSU5FX1BBR0VfTkFNRSkKICAgIH0pOwogIH0gZWxzZSBpZiAodXNlckhhc05vUGVybWlzc2lvbnMpIHsKICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdFJvdXRlckRvbS5SZWRpcmVjdCwgewogICAgICB0bzogIi8iLmNvbmNhdChfcmVkaXJlY3RfdG9fZGV0ZWN0aW9uX2VuZ2luZS5ERVRFQ1RJT05fRU5HSU5FX1BBR0VfTkFNRSwgIi9ydWxlcyIpCiAgICB9KTsKICB9CgogIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF93cmFwcGVyX3BhZ2UuV3JhcHBlclBhZ2UsIHsKICAgIHJlc3RyaWN0V2lkdGg6IHRydWUKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9kZXRlY3Rpb25fZW5naW5lX2hlYWRlcl9wYWdlLkRldGVjdGlvbkVuZ2luZUhlYWRlclBhZ2UsIHsKICAgIGJhY2tPcHRpb25zOiB7CiAgICAgIGhyZWY6ICcjZGV0ZWN0aW9ucy9ydWxlcycsCiAgICAgIHRleHQ6IGkxOG4uQkFDS19UT19SVUxFUwogICAgfSwKICAgIGJvcmRlcjogdHJ1ZSwKICAgIGlzTG9hZGluZzogaXNMb2FkaW5nIHx8IGxvYWRpbmcsCiAgICB0aXRsZTogaTE4bi5QQUdFX1RJVExFCiAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoTXlFdWlQYW5lbCwgewogICAgemluZGV4OiAzCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChTdGVwRGVmaW5lUnVsZUFjY29yZGlvbiwgewogICAgaW5pdGlhbElzT3BlbjogdHJ1ZSwKICAgIGlkOiBfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSwKICAgIGJ1dHRvbkNvbnRlbnQ6IGRlZmluZVJ1bGVCdXR0b24sCiAgICBwYWRkaW5nU2l6ZTogInhzIiwKICAgIHJlZjogZGVmaW5lUnVsZVJlZiwKICAgIG9uVG9nZ2xlOiBtYW5hZ2VBY2NvcmRpb25zLmJpbmQobnVsbCwgX3R5cGVzLlJ1bGVTdGVwLmRlZmluZVJ1bGUpLAogICAgZXh0cmFBY3Rpb246IHN0ZXBzRGF0YS5jdXJyZW50W190eXBlcy5SdWxlU3RlcC5kZWZpbmVSdWxlXS5pc1ZhbGlkICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25FbXB0eSwgewogICAgICBpY29uVHlwZTogInBlbmNpbCIsCiAgICAgIHNpemU6ICJ4cyIsCiAgICAgIG9uQ2xpY2s6IG1hbmFnZUlzRWRpdGFibGUuYmluZChudWxsLCBfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSkKICAgIH0sIGkxOG4uRURJVF9SVUxFKQogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlIb3Jpem9udGFsUnVsZSwgewogICAgbWFyZ2luOiAibSIKICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc3RlcF9kZWZpbmVfcnVsZS5TdGVwRGVmaW5lUnVsZSwgewogICAgYWRkUGFkZGluZzogdHJ1ZSwKICAgIGRlZmF1bHRWYWx1ZXM6IChfcmVmID0gc3RlcHNEYXRhLmN1cnJlbnRbX3R5cGVzLlJ1bGVTdGVwLmRlZmluZVJ1bGVdLmRhdGEpICE9PSBudWxsICYmIF9yZWYgIT09IHZvaWQgMCA/IF9yZWYgOiBudWxsLAogICAgaXNSZWFkT25seVZpZXc6IGlzU3RlcFJ1bGVJblJlYWRPbmx5Vmlld1tfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZV0sCiAgICBpc0xvYWRpbmc6IGlzTG9hZGluZyB8fCBsb2FkaW5nLAogICAgc2V0Rm9ybTogc2V0U3RlcHNGb3JtLAogICAgc2V0U3RlcERhdGE6IHNldFN0ZXBEYXRhLAogICAgZGVzY3JpcHRpb25EaXJlY3Rpb246ICJyb3ciCiAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgc2l6ZTogImwiCiAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoTXlFdWlQYW5lbCwgewogICAgemluZGV4OiAyCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUFjY29yZGlvbiwgewogICAgaW5pdGlhbElzT3BlbjogZmFsc2UsCiAgICBpZDogX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZSwKICAgIGJ1dHRvbkNvbnRlbnQ6IGFib3V0UnVsZUJ1dHRvbiwKICAgIHBhZGRpbmdTaXplOiAieHMiLAogICAgcmVmOiBhYm91dFJ1bGVSZWYsCiAgICBvblRvZ2dsZTogbWFuYWdlQWNjb3JkaW9ucy5iaW5kKG51bGwsIF90eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGUpLAogICAgZXh0cmFBY3Rpb246IHN0ZXBzRGF0YS5jdXJyZW50W190eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGVdLmlzVmFsaWQgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgIGljb25UeXBlOiAicGVuY2lsIiwKICAgICAgc2l6ZTogInhzIiwKICAgICAgb25DbGljazogbWFuYWdlSXNFZGl0YWJsZS5iaW5kKG51bGwsIF90eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGUpCiAgICB9LCBpMThuLkVESVRfUlVMRSkKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSG9yaXpvbnRhbFJ1bGUsIHsKICAgIG1hcmdpbjogIm0iCiAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBfYWJvdXRfcnVsZS5TdGVwQWJvdXRSdWxlLCB7CiAgICBhZGRQYWRkaW5nOiB0cnVlLAogICAgZGVmYXVsdFZhbHVlczogKF9yZWYyID0gc3RlcHNEYXRhLmN1cnJlbnRbX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZV0uZGF0YSkgIT09IG51bGwgJiYgX3JlZjIgIT09IHZvaWQgMCA/IF9yZWYyIDogbnVsbCwKICAgIGRlc2NyaXB0aW9uRGlyZWN0aW9uOiAicm93IiwKICAgIGlzUmVhZE9ubHlWaWV3OiBpc1N0ZXBSdWxlSW5SZWFkT25seVZpZXdbX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZV0sCiAgICBpc0xvYWRpbmc6IGlzTG9hZGluZyB8fCBsb2FkaW5nLAogICAgc2V0Rm9ybTogc2V0U3RlcHNGb3JtLAogICAgc2V0U3RlcERhdGE6IHNldFN0ZXBEYXRhCiAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgc2l6ZTogImwiCiAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoTXlFdWlQYW5lbCwgewogICAgemluZGV4OiAxCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUFjY29yZGlvbiwgewogICAgaW5pdGlhbElzT3BlbjogZmFsc2UsCiAgICBpZDogX3R5cGVzLlJ1bGVTdGVwLnNjaGVkdWxlUnVsZSwKICAgIGJ1dHRvbkNvbnRlbnQ6IHNjaGVkdWxlUnVsZUJ1dHRvbiwKICAgIHBhZGRpbmdTaXplOiAieHMiLAogICAgcmVmOiBzY2hlZHVsZVJ1bGVSZWYsCiAgICBvblRvZ2dsZTogbWFuYWdlQWNjb3JkaW9ucy5iaW5kKG51bGwsIF90eXBlcy5SdWxlU3RlcC5zY2hlZHVsZVJ1bGUpLAogICAgZXh0cmFBY3Rpb246IHN0ZXBzRGF0YS5jdXJyZW50W190eXBlcy5SdWxlU3RlcC5zY2hlZHVsZVJ1bGVdLmlzVmFsaWQgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgIGljb25UeXBlOiAicGVuY2lsIiwKICAgICAgc2l6ZTogInhzIiwKICAgICAgb25DbGljazogbWFuYWdlSXNFZGl0YWJsZS5iaW5kKG51bGwsIF90eXBlcy5SdWxlU3RlcC5zY2hlZHVsZVJ1bGUpCiAgICB9LCBpMThuLkVESVRfUlVMRSkKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSG9yaXpvbnRhbFJ1bGUsIHsKICAgIG1hcmdpbjogIm0iCiAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBfc2NoZWR1bGVfcnVsZS5TdGVwU2NoZWR1bGVSdWxlLCB7CiAgICBhZGRQYWRkaW5nOiB0cnVlLAogICAgZGVmYXVsdFZhbHVlczogKF9yZWYzID0gc3RlcHNEYXRhLmN1cnJlbnRbX3R5cGVzLlJ1bGVTdGVwLnNjaGVkdWxlUnVsZV0uZGF0YSkgIT09IG51bGwgJiYgX3JlZjMgIT09IHZvaWQgMCA/IF9yZWYzIDogbnVsbCwKICAgIGRlc2NyaXB0aW9uRGlyZWN0aW9uOiAicm93IiwKICAgIGlzUmVhZE9ubHlWaWV3OiBpc1N0ZXBSdWxlSW5SZWFkT25seVZpZXdbX3R5cGVzLlJ1bGVTdGVwLnNjaGVkdWxlUnVsZV0sCiAgICBpc0xvYWRpbmc6IGlzTG9hZGluZyB8fCBsb2FkaW5nLAogICAgc2V0Rm9ybTogc2V0U3RlcHNGb3JtLAogICAgc2V0U3RlcERhdGE6IHNldFN0ZXBEYXRhCiAgfSkpKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3NweV9yb3V0ZXMuU3B5Um91dGUsIG51bGwpKTsKfTsKCnZhciBDcmVhdGVSdWxlUGFnZSA9IF9yZWFjdC5kZWZhdWx0Lm1lbW8oQ3JlYXRlUnVsZVBhZ2VDb21wb25lbnQpOwoKZXhwb3J0cy5DcmVhdGVSdWxlUGFnZSA9IENyZWF0ZVJ1bGVQYWdlOw=="},null]}