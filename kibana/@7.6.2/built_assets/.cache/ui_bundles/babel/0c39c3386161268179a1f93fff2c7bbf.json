{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/visualize_embeddable/visualize_embeddable.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/visualize_embeddable/visualize_embeddable.js","mtime":1585205039931},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuVmlzdWFsaXplRW1iZWRkYWJsZSA9IHZvaWQgMDsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIF9wZXJzaXN0ZWRfc3RhdGUgPSByZXF1aXJlKCJ1aS9wZXJzaXN0ZWRfc3RhdGUiKTsKCnZhciBSeCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJ4anMiKSk7Cgp2YXIgX3BpcGVsaW5lX2hlbHBlcnMgPSByZXF1aXJlKCJ1aS92aXN1YWxpemUvbG9hZGVyL3BpcGVsaW5lX2hlbHBlcnMiKTsKCnZhciBfdXRpbHMgPSByZXF1aXJlKCJ1aS92aXN1YWxpemUvbG9hZGVyL3V0aWxzIik7Cgp2YXIgX3V0aWxpdGllcyA9IHJlcXVpcmUoInVpL3Zpc3VhbGl6ZS9sb2FkZXIvcGlwZWxpbmVfaGVscGVycy91dGlsaXRpZXMiKTsKCnZhciBfbmV3X3BsYXRmb3JtID0gcmVxdWlyZSgidWkvbmV3X3BsYXRmb3JtIik7Cgp2YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4vY29uc3RhbnRzIik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL3BsdWdpbnMvZGF0YS9wdWJsaWMiKTsKCnZhciBfcHVibGljMiA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL3BsdWdpbnMvZW1iZWRkYWJsZS9wdWJsaWMiKTsKCnZhciBfcHVibGljMyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL3BsdWdpbnMva2liYW5hX3V0aWxzL3B1YmxpYyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgcmV0dXJuIGNhbGw7CiAgfQoKICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyKSB7CiAgaWYgKHR5cGVvZiBSZWZsZWN0ICE9PSAidW5kZWZpbmVkIiAmJiBSZWZsZWN0LmdldCkgewogICAgX2dldCA9IFJlZmxlY3QuZ2V0OwogIH0gZWxzZSB7CiAgICBfZ2V0ID0gZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogICAgICB2YXIgYmFzZSA9IF9zdXBlclByb3BCYXNlKHRhcmdldCwgcHJvcGVydHkpOwoKICAgICAgaWYgKCFiYXNlKSByZXR1cm47CiAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihiYXNlLCBwcm9wZXJ0eSk7CgogICAgICBpZiAoZGVzYy5nZXQpIHsKICAgICAgICByZXR1cm4gZGVzYy5nZXQuY2FsbChyZWNlaXZlcik7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXNjLnZhbHVlOwogICAgfTsKICB9CgogIHJldHVybiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyIHx8IHRhcmdldCk7Cn0KCmZ1bmN0aW9uIF9zdXBlclByb3BCYXNlKG9iamVjdCwgcHJvcGVydHkpIHsKICB3aGlsZSAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KSkgewogICAgb2JqZWN0ID0gX2dldFByb3RvdHlwZU9mKG9iamVjdCk7CiAgICBpZiAob2JqZWN0ID09PSBudWxsKSBicmVhazsKICB9CgogIHJldHVybiBvYmplY3Q7Cn0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgfTsKICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIGdldEtleXMgPSBmdW5jdGlvbiBnZXRLZXlzKG8pIHsKICByZXR1cm4gT2JqZWN0LmtleXMobyk7Cn07Cgp2YXIgVmlzdWFsaXplRW1iZWRkYWJsZSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9FbWJlZGRhYmxlKSB7CiAgX2luaGVyaXRzKFZpc3VhbGl6ZUVtYmVkZGFibGUsIF9FbWJlZGRhYmxlKTsKCiAgZnVuY3Rpb24gVmlzdWFsaXplRW1iZWRkYWJsZSh0aW1lZmlsdGVyLCBfcmVmLCBpbml0aWFsSW5wdXQsIHBhcmVudCkgewogICAgdmFyIF90aGlzOwoKICAgIHZhciBzYXZlZFZpc3VhbGl6YXRpb24gPSBfcmVmLnNhdmVkVmlzdWFsaXphdGlvbiwKICAgICAgICBlZGl0VXJsID0gX3JlZi5lZGl0VXJsLAogICAgICAgIGluZGV4UGF0dGVybnMgPSBfcmVmLmluZGV4UGF0dGVybnMsCiAgICAgICAgZWRpdGFibGUgPSBfcmVmLmVkaXRhYmxlLAogICAgICAgIGFwcFN0YXRlID0gX3JlZi5hcHBTdGF0ZSwKICAgICAgICB1aVN0YXRlID0gX3JlZi51aVN0YXRlOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBWaXN1YWxpemVFbWJlZGRhYmxlKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihWaXN1YWxpemVFbWJlZGRhYmxlKS5jYWxsKHRoaXMsIGluaXRpYWxJbnB1dCwgewogICAgICBkZWZhdWx0VGl0bGU6IHNhdmVkVmlzdWFsaXphdGlvbi50aXRsZSwKICAgICAgZWRpdFVybDogZWRpdFVybCwKICAgICAgaW5kZXhQYXR0ZXJuczogaW5kZXhQYXR0ZXJucywKICAgICAgZWRpdGFibGU6IGVkaXRhYmxlLAogICAgICBzYXZlZE9iamVjdElkOiBzYXZlZFZpc3VhbGl6YXRpb24uaWQsCiAgICAgIHZpc1R5cGVOYW1lOiBzYXZlZFZpc3VhbGl6YXRpb24udmlzLnR5cGUubmFtZQogICAgfSwgcGFyZW50KSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlciIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2F2ZWRWaXN1YWxpemF0aW9uIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJhcHBTdGF0ZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidWlTdGF0ZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidGltZVJhbmdlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJxdWVyeSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidGl0bGUiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImZpbHRlcnMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInZpc0N1c3RvbWl6YXRpb25zIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdWJzY3JpcHRpb25zIiwgW10pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImV4cHJlc3Npb24iLCAnJyk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiYWN0aW9ucyIsIHt9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ2aXMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRvbU5vZGUiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInR5cGUiLCBfY29uc3RhbnRzLlZJU1VBTElaRV9FTUJFRERBQkxFX1RZUEUpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImF1dG9SZWZyZXNoRmV0Y2hTdWJzY3JpcHRpb24iLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldEluc3BlY3RvckFkYXB0ZXJzIiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoIV90aGlzLmhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CgogICAgICByZXR1cm4gX3RoaXMuaGFuZGxlci5pbnNwZWN0KCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvcGVuSW5zcGVjdG9yIiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoX3RoaXMuaGFuZGxlcikgewogICAgICAgIHJldHVybiBfdGhpcy5oYW5kbGVyLm9wZW5JbnNwZWN0b3IoX3RoaXMuZ2V0VGl0bGUoKSB8fCAnJyk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbG9hZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuaGFuZGxlVmlzVXBkYXRlKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJoYW5kbGVWaXNVcGRhdGUiLCBmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGlmIChfdGhpcy5hcHBTdGF0ZSkgewogICAgICAgICAgICAgICAgX3RoaXMuYXBwU3RhdGUudmlzID0gX3RoaXMuc2F2ZWRWaXN1YWxpemF0aW9uLnZpcy5nZXRTdGF0ZSgpOwoKICAgICAgICAgICAgICAgIF90aGlzLmFwcFN0YXRlLnNhdmUoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUhhbmRsZXIoKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ1aVN0YXRlQ2hhbmdlSGFuZGxlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMudXBkYXRlSW5wdXQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXMudWlTdGF0ZS50b0pTT04oKSkpOwogICAgfSk7CgogICAgX3RoaXMuYXBwU3RhdGUgPSBhcHBTdGF0ZTsKICAgIF90aGlzLnNhdmVkVmlzdWFsaXphdGlvbiA9IHNhdmVkVmlzdWFsaXphdGlvbjsKICAgIF90aGlzLnZpcyA9IF90aGlzLnNhdmVkVmlzdWFsaXphdGlvbi52aXM7CgogICAgX3RoaXMudmlzLm9uKCd1cGRhdGUnLCBfdGhpcy5oYW5kbGVWaXNVcGRhdGUpOwoKICAgIF90aGlzLnZpcy5vbigncmVsb2FkJywgX3RoaXMucmVsb2FkKTsKCiAgICBpZiAodWlTdGF0ZSkgewogICAgICBfdGhpcy51aVN0YXRlID0gdWlTdGF0ZTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBwYXJzZWRVaVN0YXRlID0gc2F2ZWRWaXN1YWxpemF0aW9uLnVpU3RhdGVKU09OID8gSlNPTi5wYXJzZShzYXZlZFZpc3VhbGl6YXRpb24udWlTdGF0ZUpTT04pIDoge307CiAgICAgIF90aGlzLnVpU3RhdGUgPSBuZXcgX3BlcnNpc3RlZF9zdGF0ZS5QZXJzaXN0ZWRTdGF0ZShwYXJzZWRVaVN0YXRlKTsKCiAgICAgIF90aGlzLnVpU3RhdGUub24oJ2NoYW5nZScsIF90aGlzLnVpU3RhdGVDaGFuZ2VIYW5kbGVyKTsKICAgIH0KCiAgICBfdGhpcy52aXMuX3NldFVpU3RhdGUoX3RoaXMudWlTdGF0ZSk7CgogICAgX3RoaXMuYXV0b1JlZnJlc2hGZXRjaFN1YnNjcmlwdGlvbiA9IHRpbWVmaWx0ZXIuZ2V0QXV0b1JlZnJlc2hGZXRjaCQoKS5zdWJzY3JpYmUoX3RoaXMudXBkYXRlSGFuZGxlci5iaW5kKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKSk7CgogICAgX3RoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKFJ4Lm1lcmdlKF90aGlzLmdldE91dHB1dCQoKSwgX3RoaXMuZ2V0SW5wdXQkKCkpLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmhhbmRsZUNoYW5nZXMoKTsKICAgIH0pKTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoVmlzdWFsaXplRW1iZWRkYWJsZSwgW3sKICAgIGtleTogImdldFZpc3VhbGl6YXRpb25EZXNjcmlwdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VmlzdWFsaXphdGlvbkRlc2NyaXB0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5zYXZlZFZpc3VhbGl6YXRpb24uZGVzY3JpcHRpb247CiAgICB9CiAgfSwgewogICAga2V5OiAidHJhbnNmZXJDdXN0b21pemF0aW9uc1RvVWlTdGF0ZSIsCgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYWxsIGNoYW5nZXMgaW4gdGhlIGNvbnRhaW5lclN0YXRlLmN1c3RvbWl6YXRpb24gaW50bwogICAgICogdGhlIHVpU3RhdGUgb2YgdGhpcyB2aXN1YWxpemF0aW9uLgogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gdHJhbnNmZXJDdXN0b21pemF0aW9uc1RvVWlTdGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7IC8vIENoZWNrIGZvciBjaGFuZ2VzIHRoYXQgbmVlZCB0byBiZSBmb3J3YXJkZWQgdG8gdGhlIHVpU3RhdGUKICAgICAgLy8gU2luY2UgdGhlIHZpcyBoYXMgYW4gb3duIGxpc3RlbmVyIG9uIHRoZSB1aVN0YXRlIHdlIGRvbid0IG5lZWQgdG8KICAgICAgLy8gcGFzcyBhbnl0aGluZyBmcm9tIGhlcmUgdG8gdGhlIGhhbmRsZXIudXBkYXRlIG1ldGhvZAoKCiAgICAgIHZhciB2aXNDdXN0b21pemF0aW9ucyA9IHRoaXMuaW5wdXQudmlzOwoKICAgICAgaWYgKHZpc0N1c3RvbWl6YXRpb25zKSB7CiAgICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbCh2aXNDdXN0b21pemF0aW9ucywgdGhpcy52aXNDdXN0b21pemF0aW9ucykpIHsKICAgICAgICAgIHRoaXMudmlzQ3VzdG9taXphdGlvbnMgPSB2aXNDdXN0b21pemF0aW9uczsgLy8gVHVybiB0aGlzIG9mZiBvciB0aGUgdWlTdGF0ZUNoYW5nZUhhbmRsZXIgd2lsbCBmaXJlIGZvciBldmVyeSBtb2RpZmljYXRpb24uCgogICAgICAgICAgdGhpcy51aVN0YXRlLm9mZignY2hhbmdlJywgdGhpcy51aVN0YXRlQ2hhbmdlSGFuZGxlcik7CiAgICAgICAgICB0aGlzLnVpU3RhdGUuY2xlYXJBbGxLZXlzKCk7CiAgICAgICAgICB0aGlzLnVpU3RhdGUuc2V0KCd2aXMnLCB2aXNDdXN0b21pemF0aW9ucyk7CiAgICAgICAgICBnZXRLZXlzKHZpc0N1c3RvbWl6YXRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgX3RoaXMyLnVpU3RhdGUuc2V0KGtleSwgdmlzQ3VzdG9taXphdGlvbnNba2V5XSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMudWlTdGF0ZS5vbignY2hhbmdlJywgdGhpcy51aVN0YXRlQ2hhbmdlSGFuZGxlcik7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCF0aGlzLmFwcFN0YXRlKSB7CiAgICAgICAgdGhpcy51aVN0YXRlLmNsZWFyQWxsS2V5cygpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiaGFuZGxlQ2hhbmdlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlQ2hhbmdlcygpIHsKICAgICAgdmFyIGRpcnR5OwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGhhbmRsZUNoYW5nZXMkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMudHJhbnNmZXJDdXN0b21pemF0aW9uc1RvVWlTdGF0ZSgpOwogICAgICAgICAgICAgIGRpcnR5ID0gZmFsc2U7IC8vIENoZWNrIGlmIHRpbWVyYW5nZSBoYXMgY2hhbmdlZAoKICAgICAgICAgICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHRoaXMuaW5wdXQudGltZVJhbmdlLCB0aGlzLnRpbWVSYW5nZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMudGltZVJhbmdlID0gX2xvZGFzaC5kZWZhdWx0LmNsb25lRGVlcCh0aGlzLmlucHV0LnRpbWVSYW5nZSk7CiAgICAgICAgICAgICAgICBkaXJ0eSA9IHRydWU7CiAgICAgICAgICAgICAgfSAvLyBDaGVjayBpZiBmaWx0ZXJzIGhhcyBjaGFuZ2VkCgoKICAgICAgICAgICAgICBpZiAoISgwLCBfcHVibGljLm9ubHlEaXNhYmxlZEZpbHRlcnNDaGFuZ2VkKSh0aGlzLmlucHV0LmZpbHRlcnMsIHRoaXMuZmlsdGVycykpIHsKICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVycyA9IHRoaXMuaW5wdXQuZmlsdGVyczsKICAgICAgICAgICAgICAgIGRpcnR5ID0gdHJ1ZTsKICAgICAgICAgICAgICB9IC8vIENoZWNrIGlmIHF1ZXJ5IGhhcyBjaGFuZ2VkCgoKICAgICAgICAgICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHRoaXMuaW5wdXQucXVlcnksIHRoaXMucXVlcnkpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gdGhpcy5pbnB1dC5xdWVyeTsKICAgICAgICAgICAgICAgIGRpcnR5ID0gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLm91dHB1dC50aXRsZSAhPT0gdGhpcy50aXRsZSkgewogICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMub3V0cHV0LnRpdGxlOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvbU5vZGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5kb21Ob2RlLnNldEF0dHJpYnV0ZSgnZGF0YS10aXRsZScsIHRoaXMudGl0bGUgfHwgJycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZWRWaXN1YWxpemF0aW9uLmRlc2NyaXB0aW9uICYmIHRoaXMuZG9tTm9kZSkgewogICAgICAgICAgICAgICAgdGhpcy5kb21Ob2RlLnNldEF0dHJpYnV0ZSgnZGF0YS1kZXNjcmlwdGlvbicsIHRoaXMuc2F2ZWRWaXN1YWxpemF0aW9uLmRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLmhhbmRsZXIgJiYgZGlydHkpIHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSGFuZGxlcigpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKgogICAgICogQHBhcmFtIHtFbGVtZW50fSBkb21Ob2RlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoZG9tTm9kZSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBkaXY7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gcmVuZGVyJChfY29udGV4dDQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLnRpbWVSYW5nZSA9IF9sb2Rhc2guZGVmYXVsdC5jbG9uZURlZXAodGhpcy5pbnB1dC50aW1lUmFuZ2UpOwogICAgICAgICAgICAgIHRoaXMudHJhbnNmZXJDdXN0b21pemF0aW9uc1RvVWlTdGF0ZSgpOwoKICAgICAgICAgICAgICB0aGlzLnNhdmVkVmlzdWFsaXphdGlvbi52aXMuX3NldFVpU3RhdGUodGhpcy51aVN0YXRlKTsKCiAgICAgICAgICAgICAgdGhpcy51aVN0YXRlID0gdGhpcy5zYXZlZFZpc3VhbGl6YXRpb24udmlzLmdldFVpU3RhdGUoKTsgLy8gaW5pdCBkZWZhdWx0IGFjdGlvbnMKCiAgICAgICAgICAgICAgKDAsIF9sb2Rhc2guZm9yRWFjaCkodGhpcy52aXMudHlwZS5ldmVudHMsIGZ1bmN0aW9uIChldmVudCwgZXZlbnROYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZGlzYWJsZWQgfHwgIWV2ZW50TmFtZSkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczMuYWN0aW9uc1tldmVudE5hbWVdID0gZXZlbnQuZGVmYXVsdEFjdGlvbjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsgLy8gVGhpcyBpcyBhIGhhY2sgdG8gZ2l2ZSBtYXBzIHZpc3VhbGl6YXRpb25zIGFjY2VzcyB0byBkYXRhIGluIHRoZQogICAgICAgICAgICAgIC8vIGdsb2JhbFN0YXRlLCBzaW5jZSB0aGV5IGNhbiBubyBsb25nZXIgYWNjZXNzIGl0IHZpYSBzZWFyY2hTb3VyY2UuCiAgICAgICAgICAgICAgLy8gVE9ETzogUmVtb3ZlIHRoaXMgYXMgYSBwYXJ0IG9mIGVsYXN0aWMva2liYW5hIzMwNTkzCgogICAgICAgICAgICAgIHRoaXMudmlzLkFQSS5nZXRHZW9oYXNoQm91bmRzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfdXRpbHMucXVlcnlHZW9oYXNoQm91bmRzKShfdGhpczMuc2F2ZWRWaXN1YWxpemF0aW9uLnZpcywgewogICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBfdGhpczMuZmlsdGVycywKICAgICAgICAgICAgICAgICAgcXVlcnk6IF90aGlzMy5xdWVyeSwKICAgICAgICAgICAgICAgICAgc2VhcmNoU291cmNlOiBfdGhpczMuc2F2ZWRWaXN1YWxpemF0aW9uLnNlYXJjaFNvdXJjZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfTsgLy8gdGhpcyBpcyBhIGhhY2sgdG8gbWFrZSBlZGl0b3Igc3RpbGwgd29yaywgd2lsbCBiZSByZW1vdmVkIG9uY2Ugd2UgY2xlYW4gdXAgZWRpdG9yCgoKICAgICAgICAgICAgICB0aGlzLnZpcy5oYXNJbnNwZWN0b3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgdmlzVHlwZXNXaXRob3V0SW5zcGVjdG9yID0gWydtYXJrZG93bicsICdpbnB1dF9jb250cm9sX3ZpcycsICdtZXRyaWNzJywgJ3ZlZ2EnLCAndGltZWxpb24nXTsKCiAgICAgICAgICAgICAgICBpZiAodmlzVHlwZXNXaXRob3V0SW5zcGVjdG9yLmluY2x1ZGVzKF90aGlzMy52aXMudHlwZS5uYW1lKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMy5nZXRJbnNwZWN0b3JBZGFwdGVycygpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIHRoaXMudmlzLm9wZW5JbnNwZWN0b3IgPSB0aGlzLm9wZW5JbnNwZWN0b3I7CiAgICAgICAgICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICJ2aXN1YWxpemUgcGFuZWwtY29udGVudCBwYW5lbC1jb250ZW50LS1mdWxsV2lkdGgiOwogICAgICAgICAgICAgIGRvbU5vZGUuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgICAgICAgICB0aGlzLmRvbU5vZGUgPSBkaXY7CiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVyID0gbmV3IF9uZXdfcGxhdGZvcm0ubnBTdGFydC5wbHVnaW5zLmV4cHJlc3Npb25zLkV4cHJlc3Npb25Mb2FkZXIodGhpcy5kb21Ob2RlKTsKICAgICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmhhbmRsZXIuZXZlbnRzJC5zdWJzY3JpYmUoZnVuY3Rpb24gX2NhbGxlZTIoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJzLCBtYXBwZWRGaWx0ZXJzLCB0aW1lRmllbGROYW1lOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpczMuYWN0aW9uc1tldmVudC5uYW1lXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmRhdGEuYWdnQ29uZmlncyA9ICgwLCBfdXRpbGl0aWVzLmdldFRhYmxlQWdncykoX3RoaXMzLnZpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVycyA9IF90aGlzMy5hY3Rpb25zW2V2ZW50Lm5hbWVdKGV2ZW50LmRhdGEpIHx8IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZEZpbHRlcnMgPSAoMCwgX3B1YmxpYy5tYXBBbmRGbGF0dGVuRmlsdGVycykoZmlsdGVycyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZUZpZWxkTmFtZSA9IF90aGlzMy52aXMuaW5kZXhQYXR0ZXJuLnRpbWVGaWVsZE5hbWU7CgogICAgICAgICAgICAgICAgICAgICAgICAgIF9uZXdfcGxhdGZvcm0ubnBTdGFydC5wbHVnaW5zLnVpQWN0aW9ucy5leGVjdXRlVHJpZ2dlckFjdGlvbnMoX3B1YmxpYzIuQVBQTFlfRklMVEVSX1RSSUdHRVIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYmVkZGFibGU6IF90aGlzMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IG1hcHBlZEZpbHRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lRmllbGROYW1lOiB0aW1lRmllbGROYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLXRpdGxlJywgdGhpcy5vdXRwdXQudGl0bGUgfHwgJycpOwoKICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlZFZpc3VhbGl6YXRpb24uZGVzY3JpcHRpb24pIHsKICAgICAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtZGVzY3JpcHRpb24nLCB0aGlzLnNhdmVkVmlzdWFsaXphdGlvbi5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLXRlc3Qtc3ViaicsICd2aXN1YWxpemF0aW9uTG9hZGVyJyk7CiAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1zaGFyZWQtaXRlbScsICcnKTsKICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLXJlbmRlcmluZy1jb3VudCcsICcwJyk7CiAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1yZW5kZXItY29tcGxldGUnLCAnZmFsc2UnKTsKICAgICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmhhbmRsZXIubG9hZGluZyQuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcmVuZGVyLWNvbXBsZXRlJywgJ2ZhbHNlJyk7CiAgICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLWxvYWRpbmcnLCAnJyk7CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuaGFuZGxlci5yZW5kZXIkLnN1YnNjcmliZShmdW5jdGlvbiAoY291bnQpIHsKICAgICAgICAgICAgICAgIGRpdi5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtbG9hZGluZycpOwogICAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1yZW5kZXItY29tcGxldGUnLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1yZW5kZXJpbmctY291bnQnLCBjb3VudC50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICgwLCBfcHVibGljMy5kaXNwYXRjaFJlbmRlckNvbXBsZXRlKShkaXYpOwogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUhhbmRsZXIoKTsKCiAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihWaXN1YWxpemVFbWJlZGRhYmxlLnByb3RvdHlwZSksICJkZXN0cm95IiwgdGhpcykuY2FsbCh0aGlzKTsKCiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgcmV0dXJuIHMudW5zdWJzY3JpYmUoKTsKICAgICAgfSk7CiAgICAgIHRoaXMudWlTdGF0ZS5vZmYoJ2NoYW5nZScsIHRoaXMudWlTdGF0ZUNoYW5nZUhhbmRsZXIpOwogICAgICB0aGlzLnNhdmVkVmlzdWFsaXphdGlvbi52aXMucmVtb3ZlTGlzdGVuZXIoJ3JlbG9hZCcsIHRoaXMucmVsb2FkKTsKICAgICAgdGhpcy5zYXZlZFZpc3VhbGl6YXRpb24udmlzLnJlbW92ZUxpc3RlbmVyKCd1cGRhdGUnLCB0aGlzLmhhbmRsZVZpc1VwZGF0ZSk7CiAgICAgIHRoaXMuc2F2ZWRWaXN1YWxpemF0aW9uLmRlc3Ryb3koKTsKCiAgICAgIGlmICh0aGlzLmhhbmRsZXIpIHsKICAgICAgICB0aGlzLmhhbmRsZXIuZGVzdHJveSgpOwogICAgICAgIHRoaXMuaGFuZGxlci5nZXRFbGVtZW50KCkucmVtb3ZlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuYXV0b1JlZnJlc2hGZXRjaFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZUhhbmRsZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUhhbmRsZXIoKSB7CiAgICAgIHZhciBleHByZXNzaW9uUGFyYW1zOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIHVwZGF0ZUhhbmRsZXIkKF9jb250ZXh0NSkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGV4cHJlc3Npb25QYXJhbXMgPSB7CiAgICAgICAgICAgICAgICBzZWFyY2hDb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICdraWJhbmFfY29udGV4dCcsCiAgICAgICAgICAgICAgICAgIHRpbWVSYW5nZTogdGhpcy50aW1lUmFuZ2UsCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiB0aGlzLmlucHV0LnF1ZXJ5LAogICAgICAgICAgICAgICAgICBmaWx0ZXJzOiB0aGlzLmlucHV0LmZpbHRlcnMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBleHRyYUhhbmRsZXJzOiB7CiAgICAgICAgICAgICAgICAgIHZpczogdGhpcy52aXMsCiAgICAgICAgICAgICAgICAgIHVpU3RhdGU6IHRoaXMudWlTdGF0ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAzOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9waXBlbGluZV9oZWxwZXJzLmJ1aWxkUGlwZWxpbmUpKHRoaXMudmlzLCB7CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2U6IHRoaXMuc2F2ZWRWaXN1YWxpemF0aW9uLnNlYXJjaFNvdXJjZSwKICAgICAgICAgICAgICAgIHRpbWVSYW5nZTogdGhpcy50aW1lUmFuZ2UsCiAgICAgICAgICAgICAgICBzYXZlZE9iamVjdElkOiB0aGlzLnNhdmVkVmlzdWFsaXphdGlvbi5pZAogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICB0aGlzLmV4cHJlc3Npb24gPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICB0aGlzLnZpcy5maWx0ZXJzID0gewogICAgICAgICAgICAgICAgdGltZVJhbmdlOiB0aGlzLnRpbWVSYW5nZQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmICh0aGlzLmhhbmRsZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlci51cGRhdGUodGhpcy5leHByZXNzaW9uLCBleHByZXNzaW9uUGFyYW1zKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMudmlzLmVtaXQoJ2FwcGx5Jyk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBWaXN1YWxpemVFbWJlZGRhYmxlOwp9KF9wdWJsaWMyLkVtYmVkZGFibGUpOwoKZXhwb3J0cy5WaXN1YWxpemVFbWJlZGRhYmxlID0gVmlzdWFsaXplRW1iZWRkYWJsZTs="},null]}