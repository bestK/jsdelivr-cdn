{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/ml/public/application/explorer/explorer_charts/explorer_chart_distribution.js","dependencies":[{"path":"x-pack/legacy/plugins/ml/public/application/explorer/explorer_charts/explorer_chart_distribution.js","mtime":1585205045724},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkV4cGxvcmVyQ2hhcnREaXN0cmlidXRpb24gPSB2b2lkIDA7Cgp2YXIgX3Byb3BUeXBlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicHJvcC10eXBlcyIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfZCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiZDMiKSk7Cgp2YXIgX2pxdWVyeSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgianF1ZXJ5IikpOwoKdmFyIF9tb21lbnQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIm1vbWVudCIpKTsKCnZhciBfZGF0ZV91dGlscyA9IHJlcXVpcmUoIi4uLy4uL3V0aWwvZGF0ZV91dGlscyIpOwoKdmFyIF9mb3JtYXRfdmFsdWUgPSByZXF1aXJlKCIuLi8uLi9mb3JtYXR0ZXJzL2Zvcm1hdF92YWx1ZSIpOwoKdmFyIF9hbm9tYWx5X3V0aWxzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tbW9uL3V0aWwvYW5vbWFseV91dGlscyIpOwoKdmFyIF9jaGFydF91dGlscyA9IHJlcXVpcmUoIi4uLy4uL3V0aWwvY2hhcnRfdXRpbHMiKTsKCnZhciBfbG9hZGluZ19pbmRpY2F0b3IgPSByZXF1aXJlKCIuLi8uLi9jb21wb25lbnRzL2xvYWRpbmdfaW5kaWNhdG9yL2xvYWRpbmdfaW5kaWNhdG9yIik7Cgp2YXIgX3RpbWVfYnVja2V0cyA9IHJlcXVpcmUoIi4uLy4uL3V0aWwvdGltZV9idWNrZXRzIik7Cgp2YXIgX2ZpZWxkX2Zvcm1hdF9zZXJ2aWNlID0gcmVxdWlyZSgiLi4vLi4vc2VydmljZXMvZmllbGRfZm9ybWF0X3NlcnZpY2UiKTsKCnZhciBfY2hhcnRfdG9vbHRpcF9zZXJ2aWNlID0gcmVxdWlyZSgiLi4vLi4vY29tcG9uZW50cy9jaGFydF90b29sdGlwL2NoYXJ0X3Rvb2x0aXBfc2VydmljZSIpOwoKdmFyIF9leHBsb3Jlcl9jb25zdGFudHMgPSByZXF1aXJlKCIuLi9leHBsb3Jlcl9jb25zdGFudHMiKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2NsYXNzLCBfdGVtcDsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIENPTlRFTlRfV1JBUFBFUl9IRUlHSFQgPSAyMTU7IC8vIElmIGEgcmFyZS9ldmVudC1kaXN0cmlidXRpb24gY2hhcnQgaGFzIGEgY2FyZGluYWxpdHkgb2YgMTAgb3IgbGVzcywKLy8gdGhlbiB0aGUgY2hhcnQgd2lsbCBkaXNwbGF5IHRoZSB5IGF4aXMgbGFiZWxzIGZvciBlYWNoIGxhbmUgb2YgZXZlbnRzLgovLyBJZiBjYXJkaW5hbGl0eSBpcyBoaWdoZXIsIHRoZW4gdGhlIGF4aXMgd2lsbCBqdXN0IGJlIGhpZGRlbi4KLy8gQ2FyZGluYWxpdHkgaW4gdGhpcyBjYXNlIHJlZmVycyB0byB0aGUgYXZhaWxhYmxlIGZvciBkaXNwbGF5LAovLyBub3QgdGhlIGNhcmRpbmFsaXR5IG9mIHRoZSBmdWxsIHNvdXJjZSBkYXRhIHNldC4KCnZhciBZX0FYSVNfTEFCRUxfVEhSRVNIT0xEID0gMTA7CnZhciBFeHBsb3JlckNoYXJ0RGlzdHJpYnV0aW9uID0gKDAsIF9yZWFjdDIuaW5qZWN0STE4bikoKF90ZW1wID0gX2NsYXNzID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkgewogIF9pbmhlcml0cyhFeHBsb3JlckNoYXJ0RGlzdHJpYnV0aW9uLCBfUmVhY3QkQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gRXhwbG9yZXJDaGFydERpc3RyaWJ1dGlvbigpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFeHBsb3JlckNoYXJ0RGlzdHJpYnV0aW9uKTsKCiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEV4cGxvcmVyQ2hhcnREaXN0cmlidXRpb24pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEV4cGxvcmVyQ2hhcnREaXN0cmlidXRpb24sIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIHRoaXMucmVuZGVyQ2hhcnQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnREaWRVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZSgpIHsKICAgICAgdGhpcy5yZW5kZXJDaGFydCgpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckNoYXJ0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJDaGFydCgpIHsKICAgICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgIHRvb01hbnlCdWNrZXRzID0gX3RoaXMkcHJvcHMudG9vTWFueUJ1Y2tldHMsCiAgICAgICAgICBpbnRsID0gX3RoaXMkcHJvcHMuaW50bDsKICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLnJvb3ROb2RlOwogICAgICB2YXIgY29uZmlnID0gdGhpcy5wcm9wcy5zZXJpZXNDb25maWc7CiAgICAgIHZhciBzZXZlcml0eSA9IHRoaXMucHJvcHMuc2V2ZXJpdHk7CgogICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3VuZGVmaW5lZCcgfHwgQXJyYXkuaXNBcnJheShjb25maWcuY2hhcnREYXRhKSA9PT0gZmFsc2UpIHsKICAgICAgICAvLyBqdXN0IHJldHVybiBzbyB0aGUgZW1wdHkgZGlyZWN0aXZlIHJlbmRlcnMgd2l0aG91dCBhbiBlcnJvciBsYXRlciBvbgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGZpZWxkRm9ybWF0ID0gX2ZpZWxkX2Zvcm1hdF9zZXJ2aWNlLm1sRmllbGRGb3JtYXRTZXJ2aWNlLmdldEZpZWxkRm9ybWF0KGNvbmZpZy5qb2JJZCwgY29uZmlnLmRldGVjdG9ySW5kZXgpOwoKICAgICAgdmFyIHZpeldpZHRoID0gMDsKICAgICAgdmFyIGNoYXJ0SGVpZ2h0ID0gMTcwOwogICAgICB2YXIgTElORV9DSEFSVF9BTk9NQUxZX1JBRElVUyA9IDc7CiAgICAgIHZhciBTQ0hFRFVMRURfRVZFTlRfTUFSS0VSX0hFSUdIVCA9IDU7CiAgICAgIHZhciBjaGFydFR5cGUgPSAoMCwgX2NoYXJ0X3V0aWxzLmdldENoYXJ0VHlwZSkoY29uZmlnKTsgLy8gTGVmdCBtYXJnaW4gaXMgYWRqdXN0ZWQgbGF0ZXIgZm9yIGxvbmdlc3QgeS1heGlzIGxhYmVsLgoKICAgICAgdmFyIG1hcmdpbiA9IHsKICAgICAgICB0b3A6IDEwLAogICAgICAgIHJpZ2h0OiAwLAogICAgICAgIGJvdHRvbTogMzAsCiAgICAgICAgbGVmdDogMAogICAgICB9OwoKICAgICAgaWYgKGNoYXJ0VHlwZSA9PT0gX2V4cGxvcmVyX2NvbnN0YW50cy5DSEFSVF9UWVBFLlBPUFVMQVRJT05fRElTVFJJQlVUSU9OKSB7CiAgICAgICAgbWFyZ2luLmxlZnQgPSA2MDsKICAgICAgfQoKICAgICAgdmFyIGxpbmVDaGFydFhTY2FsZSA9IG51bGw7CiAgICAgIHZhciBsaW5lQ2hhcnRZU2NhbGUgPSBudWxsOwogICAgICB2YXIgbGluZUNoYXJ0R3JvdXA7CiAgICAgIHZhciBsaW5lQ2hhcnRWYWx1ZXNMaW5lID0gbnVsbDsKICAgICAgdmFyIENIQVJUX1lfQVRUUklCVVRFID0gY2hhcnRUeXBlID09PSBfZXhwbG9yZXJfY29uc3RhbnRzLkNIQVJUX1RZUEUuRVZFTlRfRElTVFJJQlVUSU9OID8gJ2VudGl0eScgOiAndmFsdWUnOwogICAgICB2YXIgaGlnaGxpZ2h0ID0gY29uZmlnLmNoYXJ0RGF0YS5maW5kKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgcmV0dXJuIGQuYW5vbWFseVNjb3JlICE9PSB1bmRlZmluZWQ7CiAgICAgIH0pOwogICAgICBoaWdobGlnaHQgPSBoaWdobGlnaHQgJiYgaGlnaGxpZ2h0LmVudGl0eTsKICAgICAgdmFyIGZpbHRlcmVkQ2hhcnREYXRhID0gaW5pdChjb25maWcpOwogICAgICBkcmF3UmFyZUNoYXJ0KGZpbHRlcmVkQ2hhcnREYXRhKTsKCiAgICAgIGZ1bmN0aW9uIGluaXQoX3JlZikgewogICAgICAgIHZhciBjaGFydERhdGEgPSBfcmVmLmNoYXJ0RGF0YTsKICAgICAgICB2YXIgJGVsID0gKDAsIF9qcXVlcnkuZGVmYXVsdCkoJy5tbC1leHBsb3Jlci1jaGFydCcpOyAvLyBDbGVhciBhbnkgZXhpc3RpbmcgZWxlbWVudHMgZnJvbSB0aGUgdmlzdWFsaXphdGlvbiwKICAgICAgICAvLyB0aGVuIGJ1aWxkIHRoZSBzdmcgZWxlbWVudHMgZm9yIHRoZSBjaGFydC4KCiAgICAgICAgdmFyIGNoYXJ0RWxlbWVudCA9IF9kLmRlZmF1bHQuc2VsZWN0KGVsZW1lbnQpLnNlbGVjdCgnLmNvbnRlbnQtd3JhcHBlcicpOwoKICAgICAgICBjaGFydEVsZW1lbnQuc2VsZWN0KCdzdmcnKS5yZW1vdmUoKTsKICAgICAgICB2YXIgc3ZnV2lkdGggPSAkZWwud2lkdGgoKTsKICAgICAgICB2YXIgc3ZnSGVpZ2h0ID0gY2hhcnRIZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbTsKICAgICAgICB2YXIgc3ZnID0gY2hhcnRFbGVtZW50LmFwcGVuZCgnc3ZnJykuY2xhc3NlZCgnbWwtZXhwbG9yZXItY2hhcnQtc3ZnJywgdHJ1ZSkuYXR0cignd2lkdGgnLCBzdmdXaWR0aCkuYXR0cignaGVpZ2h0Jywgc3ZnSGVpZ2h0KTsKICAgICAgICB2YXIgY2F0ZWdvcnlMaW1pdCA9IDMwOwoKICAgICAgICB2YXIgc2NhbGVDYXRlZ29yaWVzID0gX2QuZGVmYXVsdC5uZXN0KCkua2V5KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gZC5lbnRpdHk7CiAgICAgICAgfSkuZW50cmllcyhjaGFydERhdGEpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBiLnZhbHVlcy5sZW5ndGggLSBhLnZhbHVlcy5sZW5ndGg7CiAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAvLyBvbmx5IGZpbHRlciBmb3IgcmFyZSBjaGFydHMKICAgICAgICAgIGlmIChjaGFydFR5cGUgPT09IF9leHBsb3Jlcl9jb25zdGFudHMuQ0hBUlRfVFlQRS5FVkVOVF9ESVNUUklCVVRJT04pIHsKICAgICAgICAgICAgcmV0dXJuIGkgPCBjYXRlZ29yeUxpbWl0IHx8IGQua2V5ID09PSBoaWdobGlnaHQ7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gZC5rZXk7CiAgICAgICAgfSk7CgogICAgICAgIGNoYXJ0RGF0YSA9IGNoYXJ0RGF0YS5maWx0ZXIoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgIHJldHVybiBzY2FsZUNhdGVnb3JpZXMuaW5jbHVkZXMoZC5lbnRpdHkpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY2hhcnRUeXBlID09PSBfZXhwbG9yZXJfY29uc3RhbnRzLkNIQVJUX1RZUEUuUE9QVUxBVElPTl9ESVNUUklCVVRJT04pIHsKICAgICAgICAgIHZhciBmb2N1c0RhdGEgPSBjaGFydERhdGEuZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgIHJldHVybiBkLmVudGl0eSA9PT0gaGlnaGxpZ2h0OwogICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgIHJldHVybiBkLnZhbHVlOwogICAgICAgICAgfSk7CgogICAgICAgICAgdmFyIGZvY3VzRXh0ZW50ID0gX2QuZGVmYXVsdC5leHRlbnQoZm9jdXNEYXRhKTsgLy8gbm93IGFnYWluIGZpbHRlciBjaGFydERhdGEgdG8gaW5jbHVkZSBvbmx5IHRoZSBkYXRhIHBvaW50cyB3aXRoaW4gdGhlIGRvbWFpbgoKCiAgICAgICAgICBjaGFydERhdGEgPSBjaGFydERhdGEuZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgIHJldHVybiBkLnZhbHVlIDw9IGZvY3VzRXh0ZW50WzFdOwogICAgICAgICAgfSk7CiAgICAgICAgICBsaW5lQ2hhcnRZU2NhbGUgPSBfZC5kZWZhdWx0LnNjYWxlLmxpbmVhcigpLnJhbmdlKFtjaGFydEhlaWdodCwgMF0pLmRvbWFpbihbMCwgZm9jdXNFeHRlbnRbMV1dKS5uaWNlKCk7CiAgICAgICAgfSBlbHNlIGlmIChjaGFydFR5cGUgPT09IF9leHBsb3Jlcl9jb25zdGFudHMuQ0hBUlRfVFlQRS5FVkVOVF9ESVNUUklCVVRJT04pIHsKICAgICAgICAgIC8vIGF2b2lkIG92ZXJmbG93aW5nIHRoZSBib3JkZXIgb2YgdGhlIGhpZ2hsaWdodGVkIGFyZWEKICAgICAgICAgIHZhciByb3dNYXJnaW4gPSA1OwogICAgICAgICAgbGluZUNoYXJ0WVNjYWxlID0gX2QuZGVmYXVsdC5zY2FsZS5vcmRpbmFsKCkucmFuZ2VQb2ludHMoW3Jvd01hcmdpbiwgY2hhcnRIZWlnaHQgLSByb3dNYXJnaW5dKS5kb21haW4oc2NhbGVDYXRlZ29yaWVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgImNoYXJ0VHlwZSAnIi5jb25jYXQoY2hhcnRUeXBlLCAiJyBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgfQoKICAgICAgICB2YXIgeUF4aXMgPSBfZC5kZWZhdWx0LnN2Zy5heGlzKCkuc2NhbGUobGluZUNoYXJ0WVNjYWxlKS5vcmllbnQoJ2xlZnQnKS5pbm5lclRpY2tTaXplKDApLm91dGVyVGlja1NpemUoMCkudGlja1BhZGRpbmcoMTApOwoKICAgICAgICB2YXIgbWF4WUF4aXNMYWJlbFdpZHRoID0gMDsKICAgICAgICB2YXIgdGVtcExhYmVsVGV4dCA9IHN2Zy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd0ZW1wLWF4aXMtbGFiZWwgdGljaycpOwogICAgICAgIHZhciB0ZW1wTGFiZWxUZXh0RGF0YSA9IGNoYXJ0VHlwZSA9PT0gX2V4cGxvcmVyX2NvbnN0YW50cy5DSEFSVF9UWVBFLlBPUFVMQVRJT05fRElTVFJJQlVUSU9OID8gbGluZUNoYXJ0WVNjYWxlLnRpY2tzKCkgOiBzY2FsZUNhdGVnb3JpZXM7CiAgICAgICAgdGVtcExhYmVsVGV4dC5zZWxlY3RBbGwoJ3RleHQudGVtcC5heGlzJykuZGF0YSh0ZW1wTGFiZWxUZXh0RGF0YSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS50ZXh0KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICBpZiAoZmllbGRGb3JtYXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gZmllbGRGb3JtYXQuY29udmVydChkLCAndGV4dCcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGNoYXJ0VHlwZSA9PT0gX2V4cGxvcmVyX2NvbnN0YW50cy5DSEFSVF9UWVBFLlBPUFVMQVRJT05fRElTVFJJQlVUSU9OKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGxpbmVDaGFydFlTY2FsZS50aWNrRm9ybWF0KCkoZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgfQogICAgICAgIH0pIC8vIERvbid0IHVzZSBhbiBhcnJvdyBmdW5jdGlvbiBzaW5jZSB3ZSBuZWVkIGFjY2VzcyB0byBgdGhpc2AuCiAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgbWF4WUF4aXNMYWJlbFdpZHRoID0gTWF0aC5tYXgodGhpcy5nZXRCQm94KCkud2lkdGggKyB5QXhpcy50aWNrUGFkZGluZygpLCBtYXhZQXhpc0xhYmVsV2lkdGgpOwogICAgICAgIH0pLnJlbW92ZSgpOwoKICAgICAgICBfZC5kZWZhdWx0LnNlbGVjdCgnLnRlbXAtYXhpcy1sYWJlbCcpLnJlbW92ZSgpOyAvLyBTZXQgdGhlIHNpemUgb2YgdGhlIGxlZnQgbWFyZ2luIGFjY29yZGluZyB0byB0aGUgd2lkdGggb2YgdGhlIGxhcmdlc3QgeSBheGlzIHRpY2sgbGFiZWwKICAgICAgICAvLyBpZiB0aGUgY2hhcnQgaXMgZWl0aGVyIGEgcG9wdWxhdGlvbiBjaGFydCBvciBhIHJhcmUgY2hhcnQgYmVsb3cgdGhlIGNhcmRpbmFsaXR5IHRocmVzaG9sZC4KCgogICAgICAgIGlmIChjaGFydFR5cGUgPT09IF9leHBsb3Jlcl9jb25zdGFudHMuQ0hBUlRfVFlQRS5QT1BVTEFUSU9OX0RJU1RSSUJVVElPTiB8fCBjaGFydFR5cGUgPT09IF9leHBsb3Jlcl9jb25zdGFudHMuQ0hBUlRfVFlQRS5FVkVOVF9ESVNUUklCVVRJT04gJiYgc2NhbGVDYXRlZ29yaWVzLmxlbmd0aCA8PSBZX0FYSVNfTEFCRUxfVEhSRVNIT0xEKSB7CiAgICAgICAgICBtYXJnaW4ubGVmdCA9IE1hdGgubWF4KG1heFlBeGlzTGFiZWxXaWR0aCwgNDApOwogICAgICAgIH0KCiAgICAgICAgdml6V2lkdGggPSBzdmdXaWR0aCAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0OyAvLyBTZXQgdGhlIHggYXhpcyBkb21haW4gdG8gbWF0Y2ggdGhlIHJlcXVlc3QgcGxvdCByYW5nZS4KICAgICAgICAvLyBUaGlzIGVuc3VyZXMgcmFuZ2VzIG9uIGRpZmZlcmVudCBjaGFydHMgd2lsbCBtYXRjaCwgZXZlbiB3aGVuIHRoZXJlIGFyZW4ndAogICAgICAgIC8vIGRhdGEgcG9pbnRzIGFjcm9zcyB0aGUgZnVsbCByYW5nZSwgYW5kIHRoZSBzZWxlY3RlZCBhbm9tYWxvdXMgcmVnaW9uIGlzIGNlbnRyZWQuCgogICAgICAgIGxpbmVDaGFydFhTY2FsZSA9IF9kLmRlZmF1bHQudGltZS5zY2FsZSgpLnJhbmdlKFswLCB2aXpXaWR0aF0pLmRvbWFpbihbY29uZmlnLnBsb3RFYXJsaWVzdCwgY29uZmlnLnBsb3RMYXRlc3RdKTsKICAgICAgICBsaW5lQ2hhcnRWYWx1ZXNMaW5lID0gX2QuZGVmYXVsdC5zdmcubGluZSgpLngoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgIHJldHVybiBsaW5lQ2hhcnRYU2NhbGUoZC5kYXRlKTsKICAgICAgICB9KS55KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gbGluZUNoYXJ0WVNjYWxlKGRbQ0hBUlRfWV9BVFRSSUJVVEVdKTsKICAgICAgICB9KS5kZWZpbmVkKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gZC52YWx1ZSAhPT0gbnVsbDsKICAgICAgICB9KTsKICAgICAgICBsaW5lQ2hhcnRHcm91cCA9IHN2Zy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdsaW5lLWNoYXJ0JykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgbWFyZ2luLmxlZnQgKyAnLCcgKyBtYXJnaW4udG9wICsgJyknKTsKICAgICAgICByZXR1cm4gY2hhcnREYXRhOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkcmF3UmFyZUNoYXJ0KGRhdGEpIHsKICAgICAgICAvLyBBZGQgYm9yZGVyIHJvdW5kIHBsb3QgYXJlYS4KICAgICAgICBsaW5lQ2hhcnRHcm91cC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCd4JywgMCkuYXR0cigneScsIDApLmF0dHIoJ2hlaWdodCcsIGNoYXJ0SGVpZ2h0KS5hdHRyKCd3aWR0aCcsIHZpeldpZHRoKS5zdHlsZSgnc3Ryb2tlJywgJyNjY2NjY2MnKS5zdHlsZSgnZmlsbCcsICdub25lJykuc3R5bGUoJ3N0cm9rZS13aWR0aCcsIDEpOwogICAgICAgIGRyYXdSYXJlQ2hhcnRBeGVzKCk7CiAgICAgICAgZHJhd1JhcmVDaGFydEhpZ2hsaWdodGVkU3BhbigpOwogICAgICAgIGRyYXdSYXJlQ2hhcnREb3RzKGRhdGEsIGxpbmVDaGFydEdyb3VwLCBsaW5lQ2hhcnRWYWx1ZXNMaW5lKTsKICAgICAgICBkcmF3UmFyZUNoYXJ0TWFya2VycyhkYXRhKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZHJhd1JhcmVDaGFydEF4ZXMoKSB7CiAgICAgICAgLy8gR2V0IHRoZSBzY2FsZWQgZGF0ZSBmb3JtYXQgdG8gdXNlIGZvciB4IGF4aXMgdGljayBsYWJlbHMuCiAgICAgICAgdmFyIHRpbWVCdWNrZXRzID0gbmV3IF90aW1lX2J1Y2tldHMuVGltZUJ1Y2tldHMoKTsKICAgICAgICB2YXIgYm91bmRzID0gewogICAgICAgICAgbWluOiAoMCwgX21vbWVudC5kZWZhdWx0KShjb25maWcucGxvdEVhcmxpZXN0KSwKICAgICAgICAgIG1heDogKDAsIF9tb21lbnQuZGVmYXVsdCkoY29uZmlnLnBsb3RMYXRlc3QpCiAgICAgICAgfTsKICAgICAgICB0aW1lQnVja2V0cy5zZXRCb3VuZHMoYm91bmRzKTsKICAgICAgICB0aW1lQnVja2V0cy5zZXRJbnRlcnZhbCgnYXV0bycpOwogICAgICAgIHZhciB4QXhpc1RpY2tGb3JtYXQgPSB0aW1lQnVja2V0cy5nZXRTY2FsZWREYXRlRm9ybWF0KCk7CiAgICAgICAgdmFyIHRpY2tWYWx1ZXNTdGFydCA9IE1hdGgubWF4KGNvbmZpZy5zZWxlY3RlZEVhcmxpZXN0LCBjb25maWcucGxvdEVhcmxpZXN0KTsgLy8gKzEgbXMgdG8gYWNjb3VudCBmb3IgdGhlIG1zIHRoYXQgd2FzIHN1YnRyYWN0ZWQgZm9yIHF1ZXJ5IGFnZ3JlZ2F0aW9ucy4KCiAgICAgICAgdmFyIGludGVydmFsID0gY29uZmlnLnNlbGVjdGVkTGF0ZXN0IC0gY29uZmlnLnNlbGVjdGVkRWFybGllc3QgKyAxOwogICAgICAgIHZhciB0aWNrVmFsdWVzID0gKDAsIF9jaGFydF91dGlscy5nZXRUaWNrVmFsdWVzKSh0aWNrVmFsdWVzU3RhcnQsIGludGVydmFsLCBjb25maWcucGxvdEVhcmxpZXN0LCBjb25maWcucGxvdExhdGVzdCk7CgogICAgICAgIHZhciB4QXhpcyA9IF9kLmRlZmF1bHQuc3ZnLmF4aXMoKS5zY2FsZShsaW5lQ2hhcnRYU2NhbGUpLm9yaWVudCgnYm90dG9tJykuaW5uZXJUaWNrU2l6ZSgtY2hhcnRIZWlnaHQpLm91dGVyVGlja1NpemUoMCkudGlja1BhZGRpbmcoMTApLnRpY2tGb3JtYXQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgIHJldHVybiAoMCwgX21vbWVudC5kZWZhdWx0KShkKS5mb3JtYXQoeEF4aXNUaWNrRm9ybWF0KTsKICAgICAgICB9KTsgLy8gV2l0aCB0b29NYW55QnVja2V0cyB0aGUgY2hhcnQgd291bGQgZW5kIHVwIHdpdGggbm8geC1heGlzIGxhYmVscwogICAgICAgIC8vIGJlY2F1c2UgdGhlIHRpY2tzIGFyZSBiYXNlZCBvbiB0aGUgc3BhbiBvZiB0aGUgZW1waGFzaXMgc2VjdGlvbiwKICAgICAgICAvLyBhbmQgdGhlIGhpZ2hsaWdodGVkIGFyZWEgc3BhbnMgdGhlIHdob2xlIGNoYXJ0LgoKCiAgICAgICAgaWYgKHRvb01hbnlCdWNrZXRzID09PSBmYWxzZSkgewogICAgICAgICAgeEF4aXMudGlja1ZhbHVlcyh0aWNrVmFsdWVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgeEF4aXMudGlja3MoKDAsIF9jaGFydF91dGlscy5udW1UaWNrc0ZvckRhdGVGb3JtYXQpKHZpeldpZHRoLCB4QXhpc1RpY2tGb3JtYXQpKTsKICAgICAgICB9CgogICAgICAgIHZhciB5QXhpcyA9IF9kLmRlZmF1bHQuc3ZnLmF4aXMoKS5zY2FsZShsaW5lQ2hhcnRZU2NhbGUpLm9yaWVudCgnbGVmdCcpLmlubmVyVGlja1NpemUoMCkub3V0ZXJUaWNrU2l6ZSgwKS50aWNrUGFkZGluZygxMCk7CgogICAgICAgIGlmIChmaWVsZEZvcm1hdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB5QXhpcy50aWNrRm9ybWF0KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgIHJldHVybiBmaWVsZEZvcm1hdC5jb252ZXJ0KGQsICd0ZXh0Jyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBheGVzID0gbGluZUNoYXJ0R3JvdXAuYXBwZW5kKCdnJyk7CiAgICAgICAgdmFyIGdBeGlzID0gYXhlcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd4IGF4aXMnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIGNoYXJ0SGVpZ2h0ICsgJyknKS5jYWxsKHhBeGlzKTsKICAgICAgICBheGVzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3kgYXhpcycpLmNhbGwoeUF4aXMpOyAvLyBlbXBoYXNpemUgdGhlIHkgYXhpcyBsYWJlbCB0aGlzIHJhcmUgY2hhcnQgaXMgYWN0dWFsbHkgYWJvdXQKCiAgICAgICAgaWYgKGNoYXJ0VHlwZSA9PT0gX2V4cGxvcmVyX2NvbnN0YW50cy5DSEFSVF9UWVBFLkVWRU5UX0RJU1RSSUJVVElPTikgewogICAgICAgICAgYXhlcy5zZWxlY3QoJy55Jykuc2VsZWN0QWxsKCd0ZXh0JykuZWFjaChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICBfZC5kZWZhdWx0LnNlbGVjdCh0aGlzKS5jbGFzc2VkKCdtbC1leHBsb3Jlci1jaGFydC1heGlzLWVtcGhhc2lzJywgZCA9PT0gaGlnaGxpZ2h0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRvb01hbnlCdWNrZXRzID09PSBmYWxzZSkgewogICAgICAgICAgKDAsIF9jaGFydF91dGlscy5yZW1vdmVMYWJlbE92ZXJsYXApKGdBeGlzLCB0aWNrVmFsdWVzU3RhcnQsIGludGVydmFsLCB2aXpXaWR0aCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBkcmF3UmFyZUNoYXJ0RG90cyhkb3RzRGF0YSwgcmFyZUNoYXJ0R3JvdXAsIHJhcmVDaGFydFZhbHVlc0xpbmUpIHsKICAgICAgICB2YXIgcmFkaXVzID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiAxLjU7CiAgICAgICAgLy8gY2hlY2sgaWYgYGcudmFsdWVzLWRvdHNgIGFscmVhZHkgZXhpc3RzLCBpZiBub3QgY3JlYXRlIGl0CiAgICAgICAgLy8gaW4gYm90aCBjYXNlcyBhc3NpZ24gdGhlIGVsZW1lbnQgdG8gYGRvdEdyb3VwYAogICAgICAgIHZhciBkb3RHcm91cCA9IHJhcmVDaGFydEdyb3VwLnNlbGVjdCgnLnZhbHVlcy1kb3RzJykuZW1wdHkoKSA/IHJhcmVDaGFydEdyb3VwLmFwcGVuZCgnZycpLmNsYXNzZWQoJ3ZhbHVlcy1kb3RzJywgdHJ1ZSkgOiByYXJlQ2hhcnRHcm91cC5zZWxlY3QoJy52YWx1ZXMtZG90cycpOyAvLyB1c2UgZDMncyBlbnRlci91cGRhdGUvZXhpdCBwYXR0ZXJuIHRvIHJlbmRlciB0aGUgZG90cwoKICAgICAgICB2YXIgZG90cyA9IGRvdEdyb3VwLnNlbGVjdEFsbCgnY2lyY2xlJykuZGF0YShkb3RzRGF0YSk7CiAgICAgICAgZG90cy5lbnRlcigpLmFwcGVuZCgnY2lyY2xlJykuY2xhc3NlZCgndmFsdWVzLWRvdHMtY2lyY2xlJywgdHJ1ZSkuY2xhc3NlZCgndmFsdWVzLWRvdHMtY2lyY2xlLWJsdXInLCBmdW5jdGlvbiAoZCkgewogICAgICAgICAgcmV0dXJuIGQuZW50aXR5ICE9PSBoaWdobGlnaHQ7CiAgICAgICAgfSkuYXR0cigncicsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gZC5lbnRpdHkgPT09IGhpZ2hsaWdodCA/IHJhZGl1cyAqIDEuNSA6IHJhZGl1czsKICAgICAgICB9KTsKICAgICAgICBkb3RzLmF0dHIoJ2N4JywgcmFyZUNoYXJ0VmFsdWVzTGluZS54KCkpLmF0dHIoJ2N5JywgcmFyZUNoYXJ0VmFsdWVzTGluZS55KCkpOwogICAgICAgIGRvdHMuZXhpdCgpLnJlbW92ZSgpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkcmF3UmFyZUNoYXJ0SGlnaGxpZ2h0ZWRTcGFuKCkgewogICAgICAgIC8vIERyYXdzIGEgcmVjdGFuZ2xlIHdoaWNoIGhpZ2hsaWdodHMgdGhlIHRpbWUgc3BhbiB0aGF0IGhhcyBiZWVuIHNlbGVjdGVkIGZvciB2aWV3LgogICAgICAgIC8vIE5vdGUgZGVwZW5kaW5nIG9uIHRoZSBvdmVyYWxsIHRpbWUgcmFuZ2UgYW5kIHRoZSBidWNrZXQgc3BhbiwgdGhlIHNlbGVjdGVkIHRpbWUKICAgICAgICAvLyBzcGFuIG1heSBiZSBsb25nZXIgdGhhbiB0aGUgcmFuZ2UgYWN0dWFsbHkgYmVpbmcgcGxvdHRlZC4KICAgICAgICB2YXIgcmVjdFN0YXJ0ID0gTWF0aC5tYXgoY29uZmlnLnNlbGVjdGVkRWFybGllc3QsIGNvbmZpZy5wbG90RWFybGllc3QpOwogICAgICAgIHZhciByZWN0RW5kID0gTWF0aC5taW4oY29uZmlnLnNlbGVjdGVkTGF0ZXN0LCBjb25maWcucGxvdExhdGVzdCk7CiAgICAgICAgdmFyIHJlY3RXaWR0aCA9IGxpbmVDaGFydFhTY2FsZShyZWN0RW5kKSAtIGxpbmVDaGFydFhTY2FsZShyZWN0U3RhcnQpOwogICAgICAgIGxpbmVDaGFydEdyb3VwLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ3NlbGVjdGVkLWludGVydmFsJykuYXR0cigneCcsIGxpbmVDaGFydFhTY2FsZShuZXcgRGF0ZShyZWN0U3RhcnQpKSArIDIpLmF0dHIoJ3knLCAyKS5hdHRyKCdyeCcsIDMpLmF0dHIoJ3J5JywgMykuYXR0cignd2lkdGgnLCByZWN0V2lkdGggLSA0KS5hdHRyKCdoZWlnaHQnLCBjaGFydEhlaWdodCAtIDQpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkcmF3UmFyZUNoYXJ0TWFya2VycyhkYXRhKSB7CiAgICAgICAgLy8gUmVuZGVyIGNpcmNsZSBtYXJrZXJzIGZvciB0aGUgcG9pbnRzLgogICAgICAgIC8vIFRoZXNlIGFyZSB1c2VkIGZvciBkaXNwbGF5aW5nIHRvb2x0aXBzIG9uIG1vdXNlb3Zlci4KICAgICAgICAvLyBEb24ndCByZW5kZXIgZG90cyB3aGVyZSB2YWx1ZT1udWxsIChkYXRhIGdhcHMpCiAgICAgICAgdmFyIGRvdHMgPSBsaW5lQ2hhcnRHcm91cC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdjaGFydC1tYXJrZXJzJykuc2VsZWN0QWxsKCcubWV0cmljLXZhbHVlJykuZGF0YShkYXRhLmZpbHRlcihmdW5jdGlvbiAoZCkgewogICAgICAgICAgcmV0dXJuIGQudmFsdWUgIT09IG51bGw7CiAgICAgICAgfSkpOyAvLyBSZW1vdmUgZG90cyB0aGF0IGFyZSBubyBsb25nZXIgbmVlZGVkIGkuZS4gaWYgbnVtYmVyIG9mIGNoYXJ0IHBvaW50cyBoYXMgZGVjcmVhc2VkLgoKICAgICAgICBkb3RzLmV4aXQoKS5yZW1vdmUoKTsgLy8gQ3JlYXRlIGFueSBuZXcgZG90cyB0aGF0IGFyZSBuZWVkZWQgaS5lLiBpZiBudW1iZXIgb2YgY2hhcnQgcG9pbnRzIGhhcyBpbmNyZWFzZWQuCgogICAgICAgIGRvdHMuZW50ZXIoKS5hcHBlbmQoJ2NpcmNsZScpLmF0dHIoJ3InLCBMSU5FX0NIQVJUX0FOT01BTFlfUkFESVVTKSAvLyBEb24ndCB1c2UgYW4gYXJyb3cgZnVuY3Rpb24gc2luY2Ugd2UgbmVlZCBhY2Nlc3MgdG8gYHRoaXNgLgogICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgIHNob3dMaW5lQ2hhcnRUb29sdGlwKGQsIHRoaXMpOwogICAgICAgIH0pLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfY2hhcnRfdG9vbHRpcF9zZXJ2aWNlLm1sQ2hhcnRUb29sdGlwU2VydmljZS5oaWRlKCk7CiAgICAgICAgfSk7IC8vIFVwZGF0ZSBhbGwgZG90cyB0byBuZXcgcG9zaXRpb25zLgoKICAgICAgICBkb3RzLmF0dHIoJ2N4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgIHJldHVybiBsaW5lQ2hhcnRYU2NhbGUoZC5kYXRlKTsKICAgICAgICB9KS5hdHRyKCdjeScsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gbGluZUNoYXJ0WVNjYWxlKGRbQ0hBUlRfWV9BVFRSSUJVVEVdKTsKICAgICAgICB9KS5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICB2YXIgbWFya2VyQ2xhc3MgPSAnbWV0cmljLXZhbHVlJzsKCiAgICAgICAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmhhcyhkLCAnYW5vbWFseVNjb3JlJykgJiYgTnVtYmVyKGQuYW5vbWFseVNjb3JlKSA+PSBzZXZlcml0eSkgewogICAgICAgICAgICBtYXJrZXJDbGFzcyArPSAnIGFub21hbHktbWFya2VyICc7CiAgICAgICAgICAgIG1hcmtlckNsYXNzICs9ICgwLCBfYW5vbWFseV91dGlscy5nZXRTZXZlcml0eVdpdGhMb3cpKGQuYW5vbWFseVNjb3JlKS5pZDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbWFya2VyQ2xhc3M7CiAgICAgICAgfSk7IC8vIEFkZCByZWN0YW5ndWxhciBtYXJrZXJzIGZvciBhbnkgc2NoZWR1bGVkIGV2ZW50cy4KCiAgICAgICAgdmFyIHNjaGVkdWxlZEV2ZW50TWFya2VycyA9IGxpbmVDaGFydEdyb3VwLnNlbGVjdCgnLmNoYXJ0LW1hcmtlcnMnKS5zZWxlY3RBbGwoJy5zY2hlZHVsZWQtZXZlbnQtbWFya2VyJykuZGF0YShkYXRhLmZpbHRlcihmdW5jdGlvbiAoZCkgewogICAgICAgICAgcmV0dXJuIGQuc2NoZWR1bGVkRXZlbnRzICE9PSB1bmRlZmluZWQ7CiAgICAgICAgfSkpOyAvLyBSZW1vdmUgbWFya2VycyB0aGF0IGFyZSBubyBsb25nZXIgbmVlZGVkIGkuZS4gaWYgbnVtYmVyIG9mIGNoYXJ0IHBvaW50cyBoYXMgZGVjcmVhc2VkLgoKICAgICAgICBzY2hlZHVsZWRFdmVudE1hcmtlcnMuZXhpdCgpLnJlbW92ZSgpOyAvLyBDcmVhdGUgYW55IG5ldyBtYXJrZXJzIHRoYXQgYXJlIG5lZWRlZCBpLmUuIGlmIG51bWJlciBvZiBjaGFydCBwb2ludHMgaGFzIGluY3JlYXNlZC4KCiAgICAgICAgc2NoZWR1bGVkRXZlbnRNYXJrZXJzLmVudGVyKCkuYXBwZW5kKCdyZWN0JykuYXR0cignd2lkdGgnLCBMSU5FX0NIQVJUX0FOT01BTFlfUkFESVVTICogMikuYXR0cignaGVpZ2h0JywgU0NIRURVTEVEX0VWRU5UX01BUktFUl9IRUlHSFQpLmF0dHIoJ2NsYXNzJywgJ3NjaGVkdWxlZC1ldmVudC1tYXJrZXInKS5hdHRyKCdyeCcsIDEpLmF0dHIoJ3J5JywgMSk7IC8vIFVwZGF0ZSBhbGwgbWFya2VycyB0byBuZXcgcG9zaXRpb25zLgoKICAgICAgICBzY2hlZHVsZWRFdmVudE1hcmtlcnMuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gbGluZUNoYXJ0WFNjYWxlKGQuZGF0ZSkgLSBMSU5FX0NIQVJUX0FOT01BTFlfUkFESVVTOwogICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkgewogICAgICAgICAgcmV0dXJuIGxpbmVDaGFydFlTY2FsZShkW0NIQVJUX1lfQVRUUklCVVRFXSkgLSBTQ0hFRFVMRURfRVZFTlRfTUFSS0VSX0hFSUdIVCAvIDI7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNob3dMaW5lQ2hhcnRUb29sdGlwKG1hcmtlciwgY2lyY2xlKSB7CiAgICAgICAgLy8gU2hvdyB0aGUgdGltZSBhbmQgbWV0cmljIHZhbHVlcyBpbiB0aGUgdG9vbHRpcC4KICAgICAgICAvLyBVc2VzIGRhdGUsIHZhbHVlLCB1cHBlciwgbG93ZXIgYW5kIGFub21hbHlTY29yZSAob3B0aW9uYWwpIG1hcmtlciBwcm9wZXJ0aWVzLgogICAgICAgIHZhciBmb3JtYXR0ZWREYXRlID0gKDAsIF9kYXRlX3V0aWxzLmZvcm1hdEh1bWFuUmVhZGFibGVEYXRlVGltZSkobWFya2VyLmRhdGUpOwogICAgICAgIHZhciB0b29sdGlwRGF0YSA9IFt7CiAgICAgICAgICBuYW1lOiBmb3JtYXR0ZWREYXRlCiAgICAgICAgfV07CiAgICAgICAgdmFyIHNlcmllc0tleSA9IGNvbmZpZy5kZXRlY3RvckxhYmVsOwoKICAgICAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmhhcyhtYXJrZXIsICdlbnRpdHknKSkgewogICAgICAgICAgdG9vbHRpcERhdGEucHVzaCh7CiAgICAgICAgICAgIG5hbWU6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgICAgaWQ6ICd4cGFjay5tbC5leHBsb3Jlci5kaXN0cmlidXRpb25DaGFydC5lbnRpdHlMYWJlbCcsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdlbnRpdHknCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICB2YWx1ZTogbWFya2VyLmVudGl0eSwKICAgICAgICAgICAgc2VyaWVzS2V5OiBzZXJpZXNLZXkKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5oYXMobWFya2VyLCAnYW5vbWFseVNjb3JlJykpIHsKICAgICAgICAgIHZhciBzY29yZSA9IHBhcnNlSW50KG1hcmtlci5hbm9tYWx5U2NvcmUpOwogICAgICAgICAgdmFyIGRpc3BsYXlTY29yZSA9IHNjb3JlID4gMCA/IHNjb3JlIDogJzwgMSc7CiAgICAgICAgICB0b29sdGlwRGF0YS5wdXNoKHsKICAgICAgICAgICAgbmFtZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgICBpZDogJ3hwYWNrLm1sLmV4cGxvcmVyLmRpc3RyaWJ1dGlvbkNoYXJ0LmFub21hbHlTY29yZUxhYmVsJywKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ2Fub21hbHkgc2NvcmUnCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICB2YWx1ZTogZGlzcGxheVNjb3JlLAogICAgICAgICAgICBjb2xvcjogKDAsIF9hbm9tYWx5X3V0aWxzLmdldFNldmVyaXR5Q29sb3IpKHNjb3JlKSwKICAgICAgICAgICAgc2VyaWVzS2V5OiBzZXJpZXNLZXksCiAgICAgICAgICAgIHlBY2Nlc3NvcjogJ2Fub21hbHlfc2NvcmUnCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoY2hhcnRUeXBlICE9PSBfZXhwbG9yZXJfY29uc3RhbnRzLkNIQVJUX1RZUEUuRVZFTlRfRElTVFJJQlVUSU9OKSB7CiAgICAgICAgICAgIHRvb2x0aXBEYXRhLnB1c2goewogICAgICAgICAgICAgIG5hbWU6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBpZDogJ3hwYWNrLm1sLmV4cGxvcmVyLmRpc3RyaWJ1dGlvbkNoYXJ0LnZhbHVlTGFiZWwnLAogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd2YWx1ZScKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICB2YWx1ZTogKDAsIF9mb3JtYXRfdmFsdWUuZm9ybWF0VmFsdWUpKG1hcmtlci52YWx1ZSwgY29uZmlnLmZ1bmN0aW9uRGVzY3JpcHRpb24sIGZpZWxkRm9ybWF0KSwKICAgICAgICAgICAgICBzZXJpZXNLZXk6IHNlcmllc0tleSwKICAgICAgICAgICAgICB5QWNjZXNzb3I6ICd2YWx1ZScKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAodHlwZW9mIG1hcmtlci5udW1iZXJPZkNhdXNlcyA9PT0gJ3VuZGVmaW5lZCcgfHwgbWFya2VyLm51bWJlck9mQ2F1c2VzID09PSAxKSB7CiAgICAgICAgICAgICAgdG9vbHRpcERhdGEucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBpZDogJ3hwYWNrLm1sLmV4cGxvcmVyLmRpc3RyaWJ1dGlvbkNoYXJ0LnR5cGljYWxMYWJlbCcsCiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAndHlwaWNhbCcKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgdmFsdWU6ICgwLCBfZm9ybWF0X3ZhbHVlLmZvcm1hdFZhbHVlKShtYXJrZXIudHlwaWNhbCwgY29uZmlnLmZ1bmN0aW9uRGVzY3JpcHRpb24sIGZpZWxkRm9ybWF0KSwKICAgICAgICAgICAgICAgIHNlcmllc0tleTogc2VyaWVzS2V5LAogICAgICAgICAgICAgICAgeUFjY2Vzc29yOiAndHlwaWNhbCcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHR5cGVvZiBtYXJrZXIuYnlGaWVsZE5hbWUgIT09ICd1bmRlZmluZWQnICYmIF9sb2Rhc2guZGVmYXVsdC5oYXMobWFya2VyLCAnbnVtYmVyT2ZDYXVzZXMnKSkgewogICAgICAgICAgICAgIHRvb2x0aXBEYXRhLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgaWQ6ICd4cGFjay5tbC5leHBsb3Jlci5kaXN0cmlidXRpb25DaGFydC51bnVzdWFsQnlGaWVsZFZhbHVlc0xhYmVsJywKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7IG51bWJlck9mQ2F1c2VzLCBwbHVyYWwsIG9uZSB7IyB1bnVzdWFsIHtieUZpZWxkTmFtZX0gdmFsdWV9IG90aGVyIHsje3BsdXNTaWdufSB1bnVzdWFsIHtieUZpZWxkTmFtZX0gdmFsdWVzfX0nCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIG51bWJlck9mQ2F1c2VzOiBtYXJrZXIubnVtYmVyT2ZDYXVzZXMsCiAgICAgICAgICAgICAgICAgIGJ5RmllbGROYW1lOiBtYXJrZXIuYnlGaWVsZE5hbWUsCiAgICAgICAgICAgICAgICAgIC8vIE1heGltdW0gb2YgMTAgY2F1c2VzIGFyZSBzdG9yZWQgaW4gdGhlIHJlY29yZCwgc28gJzEwJyBtYXkgbWVhbiBtb3JlIHRoYW4gMTAuCiAgICAgICAgICAgICAgICAgIHBsdXNTaWduOiBtYXJrZXIubnVtYmVyT2ZDYXVzZXMgPCAxMCA/ICcnIDogJysnCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHNlcmllc0tleTogc2VyaWVzS2V5LAogICAgICAgICAgICAgICAgeUFjY2Vzc29yOiAnbnVtYmVyT2ZDYXVzZXMnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGNoYXJ0VHlwZSAhPT0gX2V4cGxvcmVyX2NvbnN0YW50cy5DSEFSVF9UWVBFLkVWRU5UX0RJU1RSSUJVVElPTikgewogICAgICAgICAgdG9vbHRpcERhdGEucHVzaCh7CiAgICAgICAgICAgIG5hbWU6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgICAgaWQ6ICd4cGFjay5tbC5leHBsb3Jlci5kaXN0cmlidXRpb25DaGFydC52YWx1ZVdpdGhvdXRBbm9tYWx5U2NvcmVMYWJlbCcsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd2YWx1ZScKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHZhbHVlOiAoMCwgX2Zvcm1hdF92YWx1ZS5mb3JtYXRWYWx1ZSkobWFya2VyLnZhbHVlLCBjb25maWcuZnVuY3Rpb25EZXNjcmlwdGlvbiwgZmllbGRGb3JtYXQpLAogICAgICAgICAgICBzZXJpZXNLZXk6IHNlcmllc0tleSwKICAgICAgICAgICAgeUFjY2Vzc29yOiAndmFsdWUnCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChfbG9kYXNoLmRlZmF1bHQuaGFzKG1hcmtlciwgJ3NjaGVkdWxlZEV2ZW50cycpKSB7CiAgICAgICAgICBtYXJrZXIuc2NoZWR1bGVkRXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKHNjaGVkdWxlZEV2ZW50LCBpKSB7CiAgICAgICAgICAgIHRvb2x0aXBEYXRhLnB1c2goewogICAgICAgICAgICAgIG5hbWU6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBpZDogJ3hwYWNrLm1sLnRpbWVTZXJpZXNFeHBsb3Jlci50aW1lU2VyaWVzQ2hhcnQuc2NoZWR1bGVkRXZlbnRzTGFiZWwnLAogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdzY2hlZHVsZWQgZXZlbnR7Y291bnRlcn0nCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgY291bnRlcjogbWFya2VyLnNjaGVkdWxlZEV2ZW50cy5sZW5ndGggPiAxID8gIiAjIi5jb25jYXQoaSArIDEpIDogJycKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICB2YWx1ZTogc2NoZWR1bGVkRXZlbnQsCiAgICAgICAgICAgICAgc2VyaWVzS2V5OiBzZXJpZXNLZXksCiAgICAgICAgICAgICAgeUFjY2Vzc29yOiAic2NoZWR1bGVkX2V2ZW50c18iLmNvbmNhdChpICsgMSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF9jaGFydF90b29sdGlwX3NlcnZpY2UubWxDaGFydFRvb2x0aXBTZXJ2aWNlLnNob3codG9vbHRpcERhdGEsIGNpcmNsZSwgewogICAgICAgICAgeDogTElORV9DSEFSVF9BTk9NQUxZX1JBRElVUyAqIDMsCiAgICAgICAgICB5OiBMSU5FX0NIQVJUX0FOT01BTFlfUkFESVVTICogMgogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRDb21wb25lbnRVcGRhdGUoKSB7CiAgICAgIC8vIEFsd2F5cyByZXR1cm4gdHJ1ZSwgZDMgd2lsbCB0YWtlIGNhcmUgb2YgYXBwcm9wcmlhdGUgcmUtcmVuZGVyaW5nLgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRSZWYiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFJlZihjb21wb25lbnROb2RlKSB7CiAgICAgIHRoaXMucm9vdE5vZGUgPSBjb21wb25lbnROb2RlOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgc2VyaWVzQ29uZmlnID0gdGhpcy5wcm9wcy5zZXJpZXNDb25maWc7CgogICAgICBpZiAodHlwZW9mIHNlcmllc0NvbmZpZyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAvLyBqdXN0IHJldHVybiBzbyB0aGUgZW1wdHkgZGlyZWN0aXZlIHJlbmRlcnMgd2l0aG91dCBhbiBlcnJvciBsYXRlciBvbgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9IC8vIGNyZWF0ZSBhIGNoYXJ0IGxvYWRpbmcgcGxhY2Vob2xkZXIKCgogICAgICB2YXIgaXNMb2FkaW5nID0gc2VyaWVzQ29uZmlnLmxvYWRpbmc7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgY2xhc3NOYW1lOiAibWwtZXhwbG9yZXItY2hhcnQiLAogICAgICAgIHJlZjogdGhpcy5zZXRSZWYuYmluZCh0aGlzKQogICAgICB9LCBpc0xvYWRpbmcgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfbG9hZGluZ19pbmRpY2F0b3IuTG9hZGluZ0luZGljYXRvciwgewogICAgICAgIGhlaWdodDogQ09OVEVOVF9XUkFQUEVSX0hFSUdIVAogICAgICB9KSwgIWlzTG9hZGluZyAmJiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgY2xhc3NOYW1lOiAiY29udGVudC13cmFwcGVyIgogICAgICB9KSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRXhwbG9yZXJDaGFydERpc3RyaWJ1dGlvbjsKfShfcmVhY3QuZGVmYXVsdC5Db21wb25lbnQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzLCAicHJvcFR5cGVzIiwgewogIHNlcmllc0NvbmZpZzogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdCwKICBzZXZlcml0eTogX3Byb3BUeXBlcy5kZWZhdWx0Lm51bWJlcgp9KSwgX3RlbXApKTsKZXhwb3J0cy5FeHBsb3JlckNoYXJ0RGlzdHJpYnV0aW9uID0gRXhwbG9yZXJDaGFydERpc3RyaWJ1dGlvbjs="},null]}