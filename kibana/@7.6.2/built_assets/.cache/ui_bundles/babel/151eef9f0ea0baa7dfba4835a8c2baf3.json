{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/vis_type_vega/public/vega_view/vega_base_view.js","dependencies":[{"path":"src/legacy/core_plugins/vis_type_vega/public/vega_view/vega_base_view.js","mtime":1585205040487},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmJ5cGFzc0V4dGVybmFsVXJsQ2hlY2sgPSBieXBhc3NFeHRlcm5hbFVybENoZWNrOwpleHBvcnRzLlZlZ2FCYXNlVmlldyA9IHZvaWQgMDsKCnZhciBfY2hyb21lID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1aS9jaHJvbWUiKSk7Cgp2YXIgX2pxdWVyeSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgianF1ZXJ5IikpOwoKdmFyIF9tb21lbnQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIm1vbWVudCIpKTsKCnZhciBfZGF0ZW1hdGggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIkBlbGFzdGljL2RhdGVtYXRoIikpOwoKdmFyIHZlZ2EgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJ2ZWdhLWxpYiIpKTsKCnZhciB2ZWdhTGl0ZSA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInZlZ2EtbGl0ZSIpKTsKCnZhciBfdXRpbHMgPSByZXF1aXJlKCIuLi9kYXRhX21vZGVsL3V0aWxzIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3ZlZ2FfdG9vbHRpcCA9IHJlcXVpcmUoIi4vdmVnYV90b29sdGlwIik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL3BsdWdpbnMvZGF0YS9wdWJsaWMiKTsKCnZhciBfdmVnYV9jb25maWdfcHJvdmlkZXIgPSByZXF1aXJlKCIuLi9oZWxwZXJzL3ZlZ2FfY29uZmlnX3Byb3ZpZGVyIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCnZlZ2Euc2NoZW1lKCdlbGFzdGljJywgX2V1aS5WSVNVQUxJWkFUSU9OX0NPTE9SUyk7IC8vIFZlZ2EncyBleHRlbnNpb24gZnVuY3Rpb25zIGFyZSBnbG9iYWwuIFdoZW4gY2FsbGVkLAovLyB3ZSBmb3J3YXJkIGV4ZWN1dGlvbiB0byB0aGUgaW5zdGFuY2Utc3BlY2lmaWMgaGFuZGxlcgovLyBUaGlzIGZ1bmN0aW9ucyBtdXN0IGJlIGRlY2xhcmVkIGluIHRoZSBWZWdhQmFzZVZpZXcgY2xhc3MKCnZhciB2ZWdhRnVuY3Rpb25zID0gewogIGtpYmFuYUFkZEZpbHRlcjogJ2FkZEZpbHRlckhhbmRsZXInLAogIGtpYmFuYVJlbW92ZUZpbHRlcjogJ3JlbW92ZUZpbHRlckhhbmRsZXInLAogIGtpYmFuYVJlbW92ZUFsbEZpbHRlcnM6ICdyZW1vdmVBbGxGaWx0ZXJzSGFuZGxlcicsCiAga2liYW5hU2V0VGltZUZpbHRlcjogJ3NldFRpbWVGaWx0ZXJIYW5kbGVyJwp9OwoKdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7CiAgdmFyIGZ1bmNOYW1lID0gX09iamVjdCRrZXlzW19pXTsKCiAgaWYgKCF2ZWdhLmV4cHJlc3Npb25GdW5jdGlvbihmdW5jTmFtZSkpIHsKICAgIHZlZ2EuZXhwcmVzc2lvbkZ1bmN0aW9uKGZ1bmNOYW1lLCBmdW5jdGlvbiBoYW5kbGVyRndkKCkgewogICAgICBmb3IgKHZhciBfbGVuMiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbjIpLCBfa2V5MiA9IDA7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHsKICAgICAgICBhcmdzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07CiAgICAgIH0KCiAgICAgIHZhciB2aWV3ID0gdGhpcy5jb250ZXh0LmRhdGFmbG93OwogICAgICB2aWV3LnJ1bkFmdGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3ZpZXckX2tpYmFuYVZpZXc7CgogICAgICAgIHJldHVybiAoX3ZpZXckX2tpYmFuYVZpZXcgPSB2aWV3Ll9raWJhbmFWaWV3KS52ZWdhRnVuY3Rpb25zSGFuZGxlci5hcHBseShfdmlldyRfa2liYW5hVmlldywgW2Z1bmNOYW1lXS5jb25jYXQoYXJncykpOwogICAgICB9KTsKICAgIH0pOwogIH0KfTsKCmZvciAodmFyIF9pID0gMCwgX09iamVjdCRrZXlzID0gT2JqZWN0LmtleXModmVnYUZ1bmN0aW9ucyk7IF9pIDwgX09iamVjdCRrZXlzLmxlbmd0aDsgX2krKykgewogIF9sb29wKCk7Cn0KCnZhciBieXBhc3NUb2tlbiA9IFN5bWJvbCgpOwoKZnVuY3Rpb24gYnlwYXNzRXh0ZXJuYWxVcmxDaGVjayh1cmwpIHsKICAvLyBwcm9jZXNzZWQgaW4gdGhlICBsb2FkZXIuc2FuaXRpemUgIGJlbG93CiAgcmV0dXJuIHsKICAgIHVybDogdXJsLAogICAgYnlwYXNzVG9rZW46IGJ5cGFzc1Rva2VuCiAgfTsKfQoKdmFyIFZlZ2FCYXNlVmlldyA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFZlZ2FCYXNlVmlldyhvcHRzKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmVnYUJhc2VWaWV3KTsKCiAgICB0aGlzLl8kcGFyZW50RWwgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KShvcHRzLnBhcmVudEVsKTsKICAgIHRoaXMuX3BhcnNlciA9IG9wdHMudmVnYVBhcnNlcjsKICAgIHRoaXMuX3NlcnZpY2VTZXR0aW5ncyA9IG9wdHMuc2VydmljZVNldHRpbmdzOwogICAgdGhpcy5fZmlsdGVyTWFuYWdlciA9IG9wdHMuZmlsdGVyTWFuYWdlcjsKICAgIHRoaXMuX3RpbWVmaWx0ZXIgPSBvcHRzLnRpbWVmaWx0ZXI7CiAgICB0aGlzLl9maW5kSW5kZXggPSBvcHRzLmZpbmRJbmRleDsKICAgIHRoaXMuX3ZpZXcgPSBudWxsOwogICAgdGhpcy5fdmVnYVZpZXdDb25maWcgPSBudWxsOwogICAgdGhpcy5fJG1lc3NhZ2VzID0gbnVsbDsKICAgIHRoaXMuX2Rlc3Ryb3lIYW5kbGVycyA9IFtdOwogICAgdGhpcy5faW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgIHRoaXMuX2VuYWJsZUV4dGVybmFsVXJscyA9ICgwLCBfdmVnYV9jb25maWdfcHJvdmlkZXIuZ2V0RW5hYmxlRXh0ZXJuYWxVcmxzKSgpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFZlZ2FCYXNlVmlldywgW3sKICAgIGtleTogImluaXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiwgX2RpZEl0ZXJhdG9yRXJyb3IsIF9pdGVyYXRvckVycm9yLCBfaXRlcmF0b3IsIF9zdGVwLCB3YXJuOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBpbml0JChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoIXRoaXMuX2luaXRpYWxpemVkKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgLy8gc2FmZXR5CiAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzOwoKICAgICAgICAgICAgICB0aGlzLl8kcGFyZW50RWwuZW1wdHkoKS5hZGRDbGFzcygidmdhVmlzIikuY3NzKCdmbGV4LWRpcmVjdGlvbicsIHRoaXMuX3BhcnNlci5jb250YWluZXJEaXIpOyAvLyBieXBhc3MgdGhlIG9uV2FybiB3YXJuaW5nIGNoZWNrcyAtIGluIHNvbWUgY2FzZXMgd2FybmluZ3MgbWF5IHN0aWxsIG5lZWQgdG8gYmUgc2hvd24gZGVzcGl0ZSBiZWluZyBkaXNhYmxlZAoKCiAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gODsKCiAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IgPSB0aGlzLl9wYXJzZXIud2FybmluZ3NbU3ltYm9sLml0ZXJhdG9yXSgpOyAhKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKTsgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWUpIHsKICAgICAgICAgICAgICAgIHdhcm4gPSBfc3RlcC52YWx1ZTsKCiAgICAgICAgICAgICAgICB0aGlzLl9hZGRNZXNzYWdlKCd3YXJuJywgd2Fybik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxMjsKICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDgpOwogICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IF9jb250ZXh0LnQwOwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTY7CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE3OwoKICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IucmV0dXJuKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTk7CgogICAgICAgICAgICAgIGlmICghX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CgogICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMTkpOwoKICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuZmluaXNoKDE2KTsKCiAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wYXJzZXIuZXJyb3IpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhpcy5fYWRkTWVzc2FnZSgnZXJyJywgdGhpcy5fcGFyc2VyLmVycm9yKTsKCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgIHRoaXMuXyRjb250YWluZXIgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KSgnPGRpdiBjbGFzcz0idmdhVmlzX192aWV3Ij4nKSAvLyBGb3JjZSBhIGhlaWdodCBoZXJlIGJlY2F1c2UgY3NzIGlzIG5vdCBsb2FkZWQgaW4gbW9jaGEgdGVzdAogICAgICAgICAgICAgIC5jc3MoJ2hlaWdodCcsICcxMDAlJykuYXBwZW5kVG8odGhpcy5fJHBhcmVudEVsKTsKICAgICAgICAgICAgICB0aGlzLl8kY29udHJvbHMgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KSgiPGRpdiBjbGFzcz1cInZnYVZpc19fY29udHJvbHMgdmdhVmlzX19jb250cm9scy0tIi5jb25jYXQodGhpcy5fcGFyc2VyLmNvbnRyb2xzRGlyLCAiXCI+IikpLmFwcGVuZFRvKHRoaXMuXyRwYXJlbnRFbCk7CgogICAgICAgICAgICAgIHRoaXMuX2FkZERlc3Ryb3lIYW5kbGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fJGNvbnRhaW5lcikgewogICAgICAgICAgICAgICAgICBfdGhpcy5fJGNvbnRhaW5lci5yZW1vdmUoKTsKCiAgICAgICAgICAgICAgICAgIF90aGlzLl8kY29udGFpbmVyID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuXyRjb250cm9scykgewogICAgICAgICAgICAgICAgICBfdGhpcy5fJGNvbnRyb2xzLnJlbW92ZSgpOwoKICAgICAgICAgICAgICAgICAgX3RoaXMuXyRjb250cm9scyA9IG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzLl8kbWVzc2FnZXMpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMuXyRtZXNzYWdlcy5yZW1vdmUoKTsKCiAgICAgICAgICAgICAgICAgIF90aGlzLl8kbWVzc2FnZXMgPSBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fdmlldykgewogICAgICAgICAgICAgICAgICBfdGhpcy5fdmlldy5maW5hbGl6ZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzLl92aWV3ID0gbnVsbDsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgdGhpcy5fdmVnYVZpZXdDb25maWcgPSB0aGlzLmNyZWF0ZVZpZXdDb25maWcoKTsgLy8gVGhlIGRlcml2ZWQgY2xhc3Mgc2hvdWxkIGNyZWF0ZSB0aGlzIG1ldGhvZAoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzM7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9pbml0Vmlld0N1c3RvbWl6YXRpb25zKCkpOwoKICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzg7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAzNTsKICAgICAgICAgICAgICBfY29udGV4dC50MSA9IF9jb250ZXh0WyJjYXRjaCJdKDMpOwogICAgICAgICAgICAgIHRoaXMub25FcnJvcihfY29udGV4dC50MSk7CgogICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzLCBbWzMsIDM1XSwgWzgsIDEyLCAxNiwgMjRdLCBbMTcsLCAxOSwgMjNdXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlVmlld0NvbmZpZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlVmlld0NvbmZpZygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgY29uZmlnID0gewogICAgICAgIGxvZ0xldmVsOiB2ZWdhLldhcm4sCiAgICAgICAgcmVuZGVyZXI6IHRoaXMuX3BhcnNlci5yZW5kZXJlcgogICAgICB9OyAvLyBPdmVycmlkZSBVUkwgc2FuaXRpemVyIHRvIHByZXZlbnQgZXh0ZXJuYWwgZGF0YSBsb2FkaW5nIChpZiBkaXNhYmxlZCkKCiAgICAgIHZhciBsb2FkZXIgPSB2ZWdhLmxvYWRlcigpOwogICAgICB2YXIgb3JpZ2luYWxTYW5pdGl6ZSA9IGxvYWRlci5zYW5pdGl6ZS5iaW5kKGxvYWRlcik7CgogICAgICBsb2FkZXIuc2FuaXRpemUgPSBmdW5jdGlvbiAodXJpLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKHVyaS5ieXBhc3NUb2tlbiA9PT0gYnlwYXNzVG9rZW4pIHsKICAgICAgICAgIC8vIElmIHVyaSBoYXMgYSBieXBhc3MgdG9rZW4sIHRoZSB1cmkgd2FzIGVuY29kZWQgYnkgYnlwYXNzRXh0ZXJuYWxVcmxDaGVjaygpIGFib3ZlLgogICAgICAgICAgLy8gYmVjYXVzZSB1c2VyIGNhbiBvbmx5IHN1cHBseSBwdXJlIEpTT04gZGF0YSBzdHJ1Y3R1cmUuCiAgICAgICAgICB1cmkgPSB1cmkudXJsOwogICAgICAgIH0gZWxzZSBpZiAoIV90aGlzMi5fZW5hYmxlRXh0ZXJuYWxVcmxzKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuYmFzZVZpZXcuZXh0ZXJuYWxVcmxzQXJlTm90RW5hYmxlZEVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFeHRlcm5hbCBVUkxzIGFyZSBub3QgZW5hYmxlZC4gQWRkICAge2VuYWJsZUV4dGVybmFsVXJsc30gICB0byB7a2liYW5hQ29uZmlnRmlsZU5hbWV9JywKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgZW5hYmxlRXh0ZXJuYWxVcmxzOiAndmVnYS5lbmFibGVFeHRlcm5hbFVybHM6IHRydWUnLAogICAgICAgICAgICAgIGtpYmFuYUNvbmZpZ0ZpbGVOYW1lOiAna2liYW5hLnltbCcKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yaWdpbmFsU2FuaXRpemUodXJpLCBvcHRpb25zKTsKICAgICAgfTsKCiAgICAgIGNvbmZpZy5sb2FkZXIgPSBsb2FkZXI7CiAgICAgIHJldHVybiBjb25maWc7CiAgICB9CiAgfSwgewogICAga2V5OiAib25FcnJvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25FcnJvcigpIHsKICAgICAgdGhpcy5fYWRkTWVzc2FnZSgnZXJyJywgX3V0aWxzLlV0aWxzLmZvcm1hdEVycm9yVG9TdHIuYXBwbHkoX3V0aWxzLlV0aWxzLCBhcmd1bWVudHMpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbldhcm4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uV2FybigpIHsKICAgICAgaWYgKCF0aGlzLl9wYXJzZXIgfHwgIXRoaXMuX3BhcnNlci5oaWRlV2FybmluZ3MpIHsKICAgICAgICB0aGlzLl9hZGRNZXNzYWdlKCd3YXJuJywgX3V0aWxzLlV0aWxzLmZvcm1hdFdhcm5pbmdUb1N0ci5hcHBseShfdXRpbHMuVXRpbHMsIGFyZ3VtZW50cykpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX2FkZE1lc3NhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRNZXNzYWdlKHR5cGUsIHRleHQpIHsKICAgICAgaWYgKCF0aGlzLl8kbWVzc2FnZXMpIHsKICAgICAgICB0aGlzLl8kbWVzc2FnZXMgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KSgiPHVsIGNsYXNzPVwidmdhVmlzX19tZXNzYWdlc1wiPiIpLmFwcGVuZFRvKHRoaXMuXyRwYXJlbnRFbCk7CiAgICAgIH0KCiAgICAgIHRoaXMuXyRtZXNzYWdlcy5hcHBlbmQoKDAsIF9qcXVlcnkuZGVmYXVsdCkoIjxsaSBjbGFzcz1cInZnYVZpc19fbWVzc2FnZSB2Z2FWaXNfX21lc3NhZ2UtLSIuY29uY2F0KHR5cGUsICJcIj4iKSkuYXBwZW5kKCgwLCBfanF1ZXJ5LmRlZmF1bHQpKCI8cHJlIGNsYXNzPVwidmdhVmlzX19tZXNzYWdlQ29kZVwiPiIpLnRleHQodGV4dCkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNpemUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2l6ZSgpIHsKICAgICAgaWYgKHRoaXMuX3BhcnNlci51c2VSZXNpemUgJiYgdGhpcy5fdmlldyAmJiB0aGlzLnVwZGF0ZVZlZ2FTaXplKHRoaXMuX3ZpZXcpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXcucnVuQXN5bmMoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVZlZ2FTaXplIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVWZWdhU2l6ZSh2aWV3KSB7CiAgICAgIC8vIEZvciBzb21lIHJlYXNvbiB0aGUgb2JqZWN0IGlzIHNsaWdodGx5IHNjcm9sbGFibGUgd2l0aG91dCB0aGUgZXh0cmEgcGFkZGluZy4KICAgICAgLy8gVGhpcyBtaWdodCBiZSBkdWUgdG8gaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnkvaXNzdWVzLzM4MDgKICAgICAgLy8gV2hpY2ggaXMgYmVpbmcgZml4ZWQgYXMgcGFydCBvZiBqUXVlcnkgMy4zLjAKICAgICAgdmFyIGhlaWdodEV4dHJhUGFkZGluZyA9IDY7CiAgICAgIHZhciB3aWR0aCA9IE1hdGgubWF4KDAsIHRoaXMuXyRjb250YWluZXIud2lkdGgoKSAtIHRoaXMuX3BhcnNlci5wYWRkaW5nV2lkdGgpOwogICAgICB2YXIgaGVpZ2h0ID0gTWF0aC5tYXgoMCwgdGhpcy5fJGNvbnRhaW5lci5oZWlnaHQoKSAtIHRoaXMuX3BhcnNlci5wYWRkaW5nSGVpZ2h0KSAtIGhlaWdodEV4dHJhUGFkZGluZzsgLy8gU29tZWhvdyB0aGUgYGhlaWdodGAgc2lnbmFsIGluIHZlZ2EgYmVjb21lcyB6ZXJvIGlmIHRoZSBoZWlnaHQgaXMgc2V0IGV4YWN0bHkgdG8KICAgICAgLy8gYW4gZXZlbiBudW1iZXIuIFRoaXMgaXMgYSBkaXJ0eSB3b3JrYXJvdW5kIGZvciB0aGlzLgogICAgICAvLyB3aGVuIHZlZ2EgaXRzZWxmIGlzIHVwZGF0ZWQgYWdhaW4sIGl0IHNob3VsZCBiZSBjaGVja2VkIHdoZXRoZXIgdGhpcyBpcyBzdGlsbAogICAgICAvLyBuZWNlc3NhcnkuCgogICAgICB2YXIgYWRqdXN0ZWRIZWlnaHQgPSBoZWlnaHQgKyAwLjAwMDAwMDAxOwoKICAgICAgaWYgKHZpZXcud2lkdGgoKSAhPT0gd2lkdGggfHwgdmlldy5oZWlnaHQoKSAhPT0gYWRqdXN0ZWRIZWlnaHQpIHsKICAgICAgICB2aWV3LndpZHRoKHdpZHRoKS5oZWlnaHQoYWRqdXN0ZWRIZWlnaHQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Vmlldyh2aWV3KSB7CiAgICAgIGlmICh0aGlzLl92aWV3ID09PSB2aWV3KSByZXR1cm47CgogICAgICBpZiAodGhpcy5fdmlldykgewogICAgICAgIHRoaXMuX3ZpZXcuZmluYWxpemUoKTsKICAgICAgfQoKICAgICAgdGhpcy5fdmlldyA9IHZpZXc7CgogICAgICBpZiAodmlldykgewogICAgICAgIC8vIEdsb2JhbCB2ZWdhIGV4cHJlc3Npb24gaGFuZGxlciB1c2VzIGl0IHRvIGNhbGwgY3VzdG9tIGZ1bmN0aW9ucwogICAgICAgIHZpZXcuX2tpYmFuYVZpZXcgPSB0aGlzOwoKICAgICAgICBpZiAodGhpcy5fcGFyc2VyLnRvb2x0aXBzKSB7CiAgICAgICAgICAvLyBwb3NpdGlvbiBhbmQgcGFkZGluZyBjYW4gYmUgc3BlY2lmaWVkIHdpdGgKICAgICAgICAgIC8vIHtjb25maWc6e2tpYmFuYTp7dG9vbHRpcHM6IHtwb3NpdGlvbjogJ3RvcCcsIHBhZGRpbmc6IDE1IH0gfX19CiAgICAgICAgICB2YXIgdHRoYW5kbGVyID0gbmV3IF92ZWdhX3Rvb2x0aXAuVG9vbHRpcEhhbmRsZXIodGhpcy5fJGNvbnRhaW5lclswXSwgdmlldywgdGhpcy5fcGFyc2VyLnRvb2x0aXBzKTsgLy8gVmVnYSBidWcgd29ya2Fyb3VuZCAtIG5lZWQgdG8gZGVzdHJveSB0b29sdGlwIGJ5IGhhbmQKCiAgICAgICAgICB0aGlzLl9hZGREZXN0cm95SGFuZGxlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0dGhhbmRsZXIuaGlkZVRvb2x0aXAoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZpZXcucnVuQXN5bmMoKTsgLy8gQWxsb3dzIGNhbGxlcnMgdG8gYXdhaXQgcmVuZGVyaW5nCiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogSGFuZGxlCiAgICAgKiBAcGFyYW0gZnVuY05hbWUKICAgICAqIEBwYXJhbSBhcmdzCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ2ZWdhRnVuY3Rpb25zSGFuZGxlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmVnYUZ1bmN0aW9uc0hhbmRsZXIoZnVuY05hbWUpIHsKICAgICAgdmFyIGhhbmRsZXJGdW5jLAogICAgICAgICAgX2xlbiwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBfa2V5LAogICAgICAgICAgX2FyZ3MyID0gYXJndW1lbnRzOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiB2ZWdhRnVuY3Rpb25zSGFuZGxlciQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAwOwogICAgICAgICAgICAgIGhhbmRsZXJGdW5jID0gdmVnYUZ1bmN0aW9uc1tmdW5jTmFtZV07CgogICAgICAgICAgICAgIGlmICghKCFoYW5kbGVyRnVuYyB8fCAhdGhpc1toYW5kbGVyRnVuY10pKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5iYXNlVmlldy5mdW5jdGlvbklzTm90RGVmaW5lZEZvckdyYXBoRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7ZnVuY05hbWV9IGlzIG5vdCBkZWZpbmVkIGZvciB0aGlzIGdyYXBoJywKICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICBmdW5jTmFtZTogIiIuY29uY2F0KGZ1bmNOYW1lLCAiKCkiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBmb3IgKF9sZW4gPSBfYXJnczIubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgICAgICAgIGFyZ3NbX2tleSAtIDFdID0gX2FyZ3MyW19rZXldOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGhpc1toYW5kbGVyRnVuY10uYXBwbHkodGhpcywgYXJncykpOwoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA5OwogICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoX2NvbnRleHQyLnQwKTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzLCBbWzAsIDldXSk7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBxdWVyeSBFbGFzdGljIFF1ZXJ5IERTTCBzbmlwcGV0LCBhcyB1c2VkIGluIHRoZSBxdWVyeSBEU0wgZWRpdG9yCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2luZGV4XSBhcyBkZWZpbmVkIGluIEtpYmFuYSwgb3IgZGVmYXVsdCBpZiBtaXNzaW5nCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWRkRmlsdGVySGFuZGxlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRmlsdGVySGFuZGxlcihxdWVyeSwgaW5kZXgpIHsKICAgICAgdmFyIGluZGV4SWQsIGZpbHRlcjsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBhZGRGaWx0ZXJIYW5kbGVyJChfY29udGV4dDMpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9maW5kSW5kZXgoaW5kZXgpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpbmRleElkID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgZmlsdGVyID0gX3B1YmxpYy5lc0ZpbHRlcnMuYnVpbGRRdWVyeUZpbHRlcihxdWVyeSwgaW5kZXhJZCk7CgogICAgICAgICAgICAgIHRoaXMuX2ZpbHRlck1hbmFnZXIuYWRkRmlsdGVycyhmaWx0ZXIpOwoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBxdWVyeSBFbGFzdGljIFF1ZXJ5IERTTCBzbmlwcGV0LCBhcyB1c2VkIGluIHRoZSBxdWVyeSBEU0wgZWRpdG9yCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2luZGV4XSBhcyBkZWZpbmVkIGluIEtpYmFuYSwgb3IgZGVmYXVsdCBpZiBtaXNzaW5nCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlRmlsdGVySGFuZGxlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRmlsdGVySGFuZGxlcihxdWVyeSwgaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgJGluamVjdG9yLCBpbmRleElkLCBmaWx0ZXI7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gcmVtb3ZlRmlsdGVySGFuZGxlciQoX2NvbnRleHQ0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX2Nocm9tZS5kZWZhdWx0LmRhbmdlcm91c2x5R2V0QWN0aXZlSW5qZWN0b3IoKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgJGluamVjdG9yID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA1OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGhpcy5fZmluZEluZGV4KGluZGV4KSk7CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgaW5kZXhJZCA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgIGZpbHRlciA9IF9wdWJsaWMuZXNGaWx0ZXJzLmJ1aWxkUXVlcnlGaWx0ZXIocXVlcnksIGluZGV4SWQpOyAvLyBUaGlzIGlzIGEgd29ya2Fyb3VuZCBmb3IgdGhlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGFzdGljL2tpYmFuYS9pc3N1ZXMvMTg4NjMKICAgICAgICAgICAgICAvLyBPbmNlIGZpeGVkLCByZXBsYWNlIHdpdGggYSBkaXJlY3QgY2FsbCAobm8gYXdhaXQgaXMgbmVlZGVkIGJlY2F1c2UgaXRzIG5vdCBhc3luYykKICAgICAgICAgICAgICAvLyAgdGhpcy5fcXVlcnlmaWx0ZXIucmVtb3ZlRmlsdGVyKGZpbHRlcik7CgogICAgICAgICAgICAgICRpbmplY3Rvci5nZXQoJyRyb290U2NvcGUnKS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMy5fZmlsdGVyTWFuYWdlci5yZW1vdmVGaWx0ZXIoZmlsdGVyKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICBfdGhpczMub25FcnJvcihlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlQWxsRmlsdGVyc0hhbmRsZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFsbEZpbHRlcnNIYW5kbGVyKCkgewogICAgICB0aGlzLl9maWx0ZXJNYW5hZ2VyLnJlbW92ZUFsbCgpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgZGFzaGJvYXJkIHRpbWUgZmlsdGVyIHRvIHRoZSBuZXcgdmFsdWVzCiAgICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd8RGF0ZX0gc3RhcnQKICAgICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ3xEYXRlfSBlbmQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXRUaW1lRmlsdGVySGFuZGxlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VGltZUZpbHRlckhhbmRsZXIoc3RhcnQsIGVuZCkgewogICAgICB0aGlzLl90aW1lZmlsdGVyLnNldFRpbWUoVmVnYUJhc2VWaWV3Ll9wYXJzZVRpbWVSYW5nZShzdGFydCwgZW5kKSk7CiAgICB9CiAgICAvKioKICAgICAqIFBhcnNlIHN0YXJ0IGFuZCBlbmQgdmFsdWVzLCBkZXRlcm1pbmluZyB0aGUgbW9kZSwgYW5kIGlmIG9yZGVyIHNob3VsZCBiZSByZXZlcnNlZAogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXREZWJ1Z1ZhbHVlcyIsCgogICAgLyoqCiAgICAgKiBTZXQgZ2xvYmFsIGRlYnVnIHZhcmlhYmxlIHRvIHNpbXBsaWZ5IHZlZ2EgZGVidWdnaW5nIGluIGNvbnNvbGUuIFNob3cgaW5mbyBtZXNzYWdlIGZpcnN0IHRpbWUKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIHNldERlYnVnVmFsdWVzKHZpZXcsIHNwZWMsIHZsc3BlYykgewogICAgICBpZiAod2luZG93KSB7CiAgICAgICAgaWYgKHdpbmRvdy5WRUdBX0RFQlVHID09PSB1bmRlZmluZWQgJiYgY29uc29sZSkgewogICAgICAgICAgY29uc29sZS5sb2coJyVjV2VsY29tZSB0byBLaWJhbmEgVmVnYSBQbHVnaW4hJywgJ2ZvbnQtc2l6ZTogMTZweDsgZm9udC13ZWlnaHQ6IGJvbGQ7Jyk7CiAgICAgICAgICBjb25zb2xlLmxvZygnWW91IGNhbiBhY2Nlc3MgdGhlIFZlZ2EgdmlldyB3aXRoIFZFR0FfREVCVUcuICcgKyAnTGVhcm4gbW9yZSBhdCBodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EvZG9jcy9hcGkvZGVidWdnaW5nLy4nKTsKICAgICAgICB9CgogICAgICAgIHZhciBkZWJ1Z09iaiA9IHt9OwogICAgICAgIHdpbmRvdy5WRUdBX0RFQlVHID0gZGVidWdPYmo7CiAgICAgICAgd2luZG93LlZFR0FfREVCVUcuVkVHQV9WRVJTSU9OID0gdmVnYS52ZXJzaW9uOwogICAgICAgIHdpbmRvdy5WRUdBX0RFQlVHLlZFR0FfTElURV9WRVJTSU9OID0gdmVnYUxpdGUudmVyc2lvbjsKICAgICAgICB3aW5kb3cuVkVHQV9ERUJVRy52aWV3ID0gdmlldzsKICAgICAgICB3aW5kb3cuVkVHQV9ERUJVRy52ZWdhX3NwZWMgPSBzcGVjOwogICAgICAgIHdpbmRvdy5WRUdBX0RFQlVHLnZlZ2FsaXRlX3NwZWMgPSB2bHNwZWM7IC8vIE9uIGRpc3Bvc2UsIGNsZWFuIHVwLCBidXQgZG9uJ3QgdXNlIHVuZGVmaW5lZCB0byBwcmV2ZW50IHJlcGVhdGVkIGRlYnVnIHN0YXRlbWVudHMKCiAgICAgICAgdGhpcy5fYWRkRGVzdHJveUhhbmRsZXIoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKGRlYnVnT2JqID09PSB3aW5kb3cuVkVHQV9ERUJVRykgewogICAgICAgICAgICB3aW5kb3cuVkVHQV9ERUJVRyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAvLyBwcm9wZXJseSBoYW5kbGUgbXVsdGlwbGUgZGVzdHJveSgpIGNhbGxzIGJ5IGNvbnZlcnRpbmcgdGhpcy5fZGVzdHJveUhhbmRsZXJzCiAgICAgIC8vIGludG8gdGhlIF9vbmdvaW5nRGVzdHJveSBwcm9taXNlLCB3aGlsZSBoYW5kbGVycyBhcmUgYmVpbmcgZGlzcG9zZWQKICAgICAgaWYgKHRoaXMuX2Rlc3Ryb3lIYW5kbGVycykgewogICAgICAgIC8vIElmIG5vIGRlc3Ryb3kgaXMgeWV0IHJ1bm5pbmcsIGV4ZWN1dGUgYWxsIGhhbmRsZXJzIGFuZCB3YWl0IGZvciBhbGwgb2YgdGhlbSB0byByZXNvbHZlLgogICAgICAgIHRoaXMuX29uZ29pbmdEZXN0cm95ID0gUHJvbWlzZS5hbGwodGhpcy5fZGVzdHJveUhhbmRsZXJzLm1hcChmdW5jdGlvbiAodikgewogICAgICAgICAgcmV0dXJuIHYoKTsKICAgICAgICB9KSk7CiAgICAgICAgdGhpcy5fZGVzdHJveUhhbmRsZXJzID0gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuX29uZ29pbmdEZXN0cm95OwogICAgfQogIH0sIHsKICAgIGtleTogIl9hZGREZXN0cm95SGFuZGxlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZERlc3Ryb3lIYW5kbGVyKGhhbmRsZXIpIHsKICAgICAgLy8gSWYgZGlzcG9zaW5nIGhhc24ndCBzdGFydGVkIHlldCwgZW5xdWV1ZSBpdCwgb3RoZXJ3aXNlIGRpc3Bvc2UgcmlnaHQgYXdheQogICAgICAvLyBUaGlzIGNyZWF0ZXMgYSBtaW5vciBpc3N1ZSAtIGlmIGRpc3Bvc2luZyBoYXMgc3RhcnRlZCBidXQgbm90IHlldCBmaW5pc2hlZCwKICAgICAgLy8gYW5kIHdlIGRpc3Bvc2UgdGhlIG5ldyBoYW5kbGVyIHJpZ2h0IGF3YXksIHRoZSBkZXN0cm95KCkgZG9lcyBub3Qgd2FpdCBmb3IgaXQuCiAgICAgIC8vIFRoaXMgYmVoYXZpb3IgaXMgbm8gZGlmZmVyZW50IGZyb20gdGhlIGNhc2Ugd2hlbiBkaXNwb3NpbmcgaGFzIGFscmVhZHkgY29tcGxldGVkLAogICAgICAvLyBzbyBpdCBzaG91bGRuJ3QgY3JlYXRlIGFueSBpc3N1ZXMuCiAgICAgIGlmICh0aGlzLl9kZXN0cm95SGFuZGxlcnMpIHsKICAgICAgICB0aGlzLl9kZXN0cm95SGFuZGxlcnMucHVzaChoYW5kbGVyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBoYW5kbGVyKCk7CiAgICAgIH0KICAgIH0KICB9XSwgW3sKICAgIGtleTogIl9wYXJzZVRpbWVSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlVGltZVJhbmdlKHN0YXJ0LCBlbmQpIHsKICAgICAgdmFyIGFic1N0YXJ0ID0gKDAsIF9tb21lbnQuZGVmYXVsdCkoc3RhcnQpOwogICAgICB2YXIgYWJzRW5kID0gKDAsIF9tb21lbnQuZGVmYXVsdCkoZW5kKTsKICAgICAgdmFyIGlzVmFsaWRBYnNTdGFydCA9IGFic1N0YXJ0LmlzVmFsaWQoKTsKICAgICAgdmFyIGlzVmFsaWRBYnNFbmQgPSBhYnNFbmQuaXNWYWxpZCgpOwogICAgICB2YXIgbW9kZSA9ICdhYnNvbHV0ZSc7CiAgICAgIHZhciBmcm9tOwogICAgICB2YXIgdG87CiAgICAgIHZhciByZXZlcnNlOwoKICAgICAgaWYgKGlzVmFsaWRBYnNTdGFydCAmJiBpc1ZhbGlkQWJzRW5kKSB7CiAgICAgICAgLy8gQm90aCBhcmUgdmFsaWQgYWJzb2x1dGUgZGF0ZXMuCiAgICAgICAgZnJvbSA9IGFic1N0YXJ0OwogICAgICAgIHRvID0gYWJzRW5kOwogICAgICAgIHJldmVyc2UgPSBhYnNTdGFydC5pc0FmdGVyKGFic0VuZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIGFzIHJlbGF0aXZlIGRhdGVzIHRvbyAoYWJzb2x1dGUgZGF0ZXMgd2lsbCBhbHNvIGJlIGFjY2VwdGVkKQogICAgICAgIHZhciBzdGFydERhdGUgPSBfZGF0ZW1hdGguZGVmYXVsdC5wYXJzZShzdGFydCk7CgogICAgICAgIHZhciBlbmREYXRlID0gX2RhdGVtYXRoLmRlZmF1bHQucGFyc2UoZW5kKTsKCiAgICAgICAgaWYgKCFzdGFydERhdGUgfHwgIWVuZERhdGUgfHwgIXN0YXJ0RGF0ZS5pc1ZhbGlkKCkgfHwgIWVuZERhdGUuaXNWYWxpZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuYmFzZVZpZXcudGltZVZhbHVlc1R5cGVFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXJyb3Igc2V0dGluZyB0aW1lIGZpbHRlcjogYm90aCB0aW1lIHZhbHVlcyBtdXN0IGJlIGVpdGhlciByZWxhdGl2ZSBvciBhYnNvbHV0ZSBkYXRlcy4ge3N0YXJ0fSwge2VuZH0nLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBzdGFydDogInN0YXJ0PSIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHN0YXJ0KSksCiAgICAgICAgICAgICAgZW5kOiAiZW5kPSIuY29uY2F0KEpTT04uc3RyaW5naWZ5KGVuZCkpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIHJldmVyc2UgPSBzdGFydERhdGUuaXNBZnRlcihlbmREYXRlKTsKCiAgICAgICAgaWYgKGlzVmFsaWRBYnNTdGFydCB8fCBpc1ZhbGlkQWJzRW5kKSB7CiAgICAgICAgICAvLyBNaXhpbmcgcmVsYXRpdmUgYW5kIGFic29sdXRlIC0gdHJlYXQgdGhlbSBhcyBhYnNvbHV0ZQogICAgICAgICAgZnJvbSA9IHN0YXJ0RGF0ZTsKICAgICAgICAgIHRvID0gZW5kRGF0ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gQm90aCBkYXRlcyBhcmUgcmVsYXRpdmUKICAgICAgICAgIG1vZGUgPSAncmVsYXRpdmUnOwogICAgICAgICAgZnJvbSA9IHN0YXJ0OwogICAgICAgICAgdG8gPSBlbmQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAocmV2ZXJzZSkgewogICAgICAgIHZhciBfcmVmID0gW3RvLCBmcm9tXTsKICAgICAgICBmcm9tID0gX3JlZlswXTsKICAgICAgICB0byA9IF9yZWZbMV07CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgZnJvbTogZnJvbSwKICAgICAgICB0bzogdG8sCiAgICAgICAgbW9kZTogbW9kZQogICAgICB9OwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFZlZ2FCYXNlVmlldzsKfSgpOwoKZXhwb3J0cy5WZWdhQmFzZVZpZXcgPSBWZWdhQmFzZVZpZXc7"},null]}