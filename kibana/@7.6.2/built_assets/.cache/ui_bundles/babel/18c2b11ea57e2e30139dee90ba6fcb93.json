{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/console/public/np_ready/application/models/sense_editor/sense_editor.js","dependencies":[{"path":"src/legacy/core_plugins/console/public/np_ready/application/models/sense_editor/sense_editor.js","mtime":1585205039196},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlNlbnNlRWRpdG9yID0gdm9pZCAwOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfcm93X3BhcnNlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiLi4vLi4vLi4vbGliL3Jvd19wYXJzZXIiKSk7Cgp2YXIgdXRpbHMgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCIuLi8uLi8uLi9saWIvdXRpbHMvdXRpbHMiKSk7Cgp2YXIgZXMgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCIuLi8uLi8uLi9saWIvZXMvZXMiKSk7Cgp2YXIgX2ZhY3RvcmllcyA9IHJlcXVpcmUoIi4uLy4uL2ZhY3RvcmllcyIpOwoKdmFyIF9hdXRvY29tcGxldGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIi4uLy4uLy4uL2xpYi9hdXRvY29tcGxldGUvYXV0b2NvbXBsZXRlIikpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIFNlbnNlRWRpdG9yID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgLy8gQHRzLWlnbm9yZQogIGZ1bmN0aW9uIFNlbnNlRWRpdG9yKGNvcmVFZGl0b3IpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFNlbnNlRWRpdG9yKTsKCiAgICB0aGlzLmNvcmVFZGl0b3IgPSBjb3JlRWRpdG9yOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY3VycmVudFJlcVJhbmdlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInBhcnNlciIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJhdXRvY29tcGxldGUiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAicHJldlJlcXVlc3RTdGFydCIsIGZ1bmN0aW9uIChyb3dPclBvcykgewogICAgICB2YXIgY3VyUm93OwoKICAgICAgaWYgKHJvd09yUG9zID09IG51bGwpIHsKICAgICAgICBjdXJSb3cgPSBfdGhpcy5jb3JlRWRpdG9yLmdldEN1cnJlbnRQb3NpdGlvbigpLmxpbmVOdW1iZXI7CiAgICAgIH0gZWxzZSBpZiAoX2xvZGFzaC5kZWZhdWx0LmlzT2JqZWN0KHJvd09yUG9zKSkgewogICAgICAgIGN1clJvdyA9IHJvd09yUG9zLmxpbmVOdW1iZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3VyUm93ID0gcm93T3JQb3M7CiAgICAgIH0KCiAgICAgIHdoaWxlIChjdXJSb3cgPiAwICYmICFfdGhpcy5wYXJzZXIuaXNTdGFydFJlcXVlc3RSb3coY3VyUm93LCBfdGhpcy5jb3JlRWRpdG9yKSkgewogICAgICAgIGN1clJvdy0tOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGxpbmVOdW1iZXI6IGN1clJvdywKICAgICAgICBjb2x1bW46IDEKICAgICAgfTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibmV4dFJlcXVlc3RTdGFydCIsIGZ1bmN0aW9uIChyb3dPclBvcykgewogICAgICB2YXIgY3VyUm93OwoKICAgICAgaWYgKHJvd09yUG9zID09IG51bGwpIHsKICAgICAgICBjdXJSb3cgPSBfdGhpcy5jb3JlRWRpdG9yLmdldEN1cnJlbnRQb3NpdGlvbigpLmxpbmVOdW1iZXI7CiAgICAgIH0gZWxzZSBpZiAoX2xvZGFzaC5kZWZhdWx0LmlzT2JqZWN0KHJvd09yUG9zKSkgewogICAgICAgIGN1clJvdyA9IHJvd09yUG9zLmxpbmVOdW1iZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3VyUm93ID0gcm93T3JQb3M7CiAgICAgIH0KCiAgICAgIHZhciBtYXhMaW5lcyA9IF90aGlzLmNvcmVFZGl0b3IuZ2V0TGluZUNvdW50KCk7CgogICAgICBmb3IgKDsgY3VyUm93IDwgbWF4TGluZXMgLSAxOyBjdXJSb3crKykgewogICAgICAgIGlmIChfdGhpcy5wYXJzZXIuaXNTdGFydFJlcXVlc3RSb3coY3VyUm93LCBfdGhpcy5jb3JlRWRpdG9yKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIHJvdzogY3VyUm93LAogICAgICAgIGNvbHVtbjogMAogICAgICB9OwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJhdXRvSW5kZW50IiwgX2xvZGFzaC5kZWZhdWx0LmRlYm91bmNlKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHZhciByZXFSYW5nZSwgcGFyc2VkUmVxLCBpbmRlbnQsIGZvcm1hdHRlZERhdGE7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5jb3JlRWRpdG9yLndhaXRGb3JMYXRlc3RUb2tlbnMoKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5nZXRSZXF1ZXN0UmFuZ2UoKSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgcmVxUmFuZ2UgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICBpZiAocmVxUmFuZ2UpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmdldFJlcXVlc3QoKSk7CgogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgcGFyc2VkUmVxID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICAgICAgaWYgKHBhcnNlZFJlcSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgaWYgKHBhcnNlZFJlcS5kYXRhICYmIHBhcnNlZFJlcS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGluZGVudCA9IHBhcnNlZFJlcS5kYXRhLmxlbmd0aCA9PT0gMTsgLy8gdW5pbmRlbnQgbXVsdGkgZG9jcyBieSBkZWZhdWx0CgogICAgICAgICAgICAgICAgZm9ybWF0dGVkRGF0YSA9IHV0aWxzLmZvcm1hdFJlcXVlc3RCb2R5RG9jKHBhcnNlZFJlcS5kYXRhLCBpbmRlbnQpOwoKICAgICAgICAgICAgICAgIGlmICghZm9ybWF0dGVkRGF0YS5jaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICAgIC8vIHRvZ2dsZS4KICAgICAgICAgICAgICAgICAgaW5kZW50ID0gIWluZGVudDsKICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkRGF0YSA9IHV0aWxzLmZvcm1hdFJlcXVlc3RCb2R5RG9jKHBhcnNlZFJlcS5kYXRhLCBpbmRlbnQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHBhcnNlZFJlcS5kYXRhID0gZm9ybWF0dGVkRGF0YS5kYXRhOwoKICAgICAgICAgICAgICAgIF90aGlzLnJlcGxhY2VSZXF1ZXN0UmFuZ2UocGFyc2VkUmVxLCByZXFSYW5nZSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LCAyNSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAidXBkYXRlIiwgZnVuY3Rpb24gX2NhbGxlZTIoZGF0YSkgewogICAgICB2YXIgcmVUb2tlbml6ZUFsbCwKICAgICAgICAgIF9hcmdzMiA9IGFyZ3VtZW50czsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgcmVUb2tlbml6ZUFsbCA9IF9hcmdzMi5sZW5ndGggPiAxICYmIF9hcmdzMlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyWzFdIDogZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIF90aGlzLmNvcmVFZGl0b3Iuc2V0VmFsdWUoZGF0YSwgcmVUb2tlbml6ZUFsbCkpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInJlcGxhY2VSZXF1ZXN0UmFuZ2UiLCBmdW5jdGlvbiAobmV3UmVxdWVzdCwgcmVxdWVzdFJhbmdlKSB7CiAgICAgIHZhciB0ZXh0ID0gdXRpbHMudGV4dEZyb21SZXF1ZXN0KG5ld1JlcXVlc3QpOwoKICAgICAgaWYgKHJlcXVlc3RSYW5nZSkgewogICAgICAgIF90aGlzLmNvcmVFZGl0b3IucmVwbGFjZVJhbmdlKHJlcXVlc3RSYW5nZSwgdGV4dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8ganVzdCBpbnNlcnQgd2hlcmUgd2UgYXJlCiAgICAgICAgX3RoaXMuY29yZUVkaXRvci5pbnNlcnQoX3RoaXMuY29yZUVkaXRvci5nZXRDdXJyZW50UG9zaXRpb24oKSwgdGV4dCk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZ2V0UmVxdWVzdFJhbmdlIiwgZnVuY3Rpb24gX2NhbGxlZTMobGluZU51bWJlcikgewogICAgICB2YXIgcmVxU3RhcnQsIHJlcUVuZDsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX3RoaXMuY29yZUVkaXRvci53YWl0Rm9yTGF0ZXN0VG9rZW5zKCkpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGlmICghX3RoaXMucGFyc2VyLmlzSW5CZXR3ZWVuUmVxdWVzdHNSb3cobGluZU51bWJlcikpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHJlcVN0YXJ0ID0gX3RoaXMucHJldlJlcXVlc3RTdGFydChsaW5lTnVtYmVyKTsKICAgICAgICAgICAgICByZXFFbmQgPSBfdGhpcy5uZXh0UmVxdWVzdEVuZChyZXFTdGFydCk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgIHN0YXJ0OiBfb2JqZWN0U3ByZWFkKHt9LCByZXFTdGFydCksCiAgICAgICAgICAgICAgICBlbmQ6IF9vYmplY3RTcHJlYWQoe30sIHJlcUVuZCkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJleHBhbmRSYW5nZVRvUmVxdWVzdEVkZ2VzIiwgZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgIHZhciByYW5nZSwKICAgICAgICAgIHN0YXJ0TGluZU51bWJlciwKICAgICAgICAgIGVuZExpbmVOdW1iZXIsCiAgICAgICAgICBtYXhMaW5lLAogICAgICAgICAgZW5kQ29sdW1uLAogICAgICAgICAgX2FyZ3M0ID0gYXJndW1lbnRzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICByYW5nZSA9IF9hcmdzNC5sZW5ndGggPiAwICYmIF9hcmdzNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M0WzBdIDogX3RoaXMuY29yZUVkaXRvci5nZXRTZWxlY3Rpb25SYW5nZSgpOwogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmNvcmVFZGl0b3Iud2FpdEZvckxhdGVzdFRva2VucygpKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBzdGFydExpbmVOdW1iZXIgPSByYW5nZS5zdGFydC5saW5lTnVtYmVyOwogICAgICAgICAgICAgIGVuZExpbmVOdW1iZXIgPSByYW5nZS5lbmQubGluZU51bWJlcjsKICAgICAgICAgICAgICBtYXhMaW5lID0gTWF0aC5tYXgoMSwgX3RoaXMuY29yZUVkaXRvci5nZXRMaW5lQ291bnQoKSk7CgogICAgICAgICAgICAgIGlmICghX3RoaXMucGFyc2VyLmlzSW5CZXR3ZWVuUmVxdWVzdHNSb3coc3RhcnRMaW5lTnVtYmVyKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE1OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGlmICghKHN0YXJ0TGluZU51bWJlciA+PSAxKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCFfdGhpcy5wYXJzZXIuaXNTdGFydFJlcXVlc3RSb3coc3RhcnRMaW5lTnVtYmVyKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoImJyZWFrIiwgMTUpOwoKICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBzdGFydExpbmVOdW1iZXItLTsKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIGlmICghKHN0YXJ0TGluZU51bWJlciA8IDEgfHwgc3RhcnRMaW5lTnVtYmVyID4gZW5kTGluZU51bWJlcikpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgaWYgKCFfdGhpcy5wYXJzZXIuaXNJbkJldHdlZW5SZXF1ZXN0c1JvdyhlbmRMaW5lTnVtYmVyKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgaWYgKCEoZW5kTGluZU51bWJlciA+PSBzdGFydExpbmVOdW1iZXIpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIV90aGlzLnBhcnNlci5pc0VuZFJlcXVlc3RSb3coZW5kTGluZU51bWJlcikpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJicmVhayIsIDI0KTsKCiAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgZW5kTGluZU51bWJlci0tOwogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzI7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgIGlmICghKGVuZExpbmVOdW1iZXIgPD0gbWF4TGluZSkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghX3RoaXMucGFyc2VyLmlzRW5kUmVxdWVzdFJvdyhlbmRMaW5lTnVtYmVyKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoImJyZWFrIiwgMzIpOwoKICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICBlbmRMaW5lTnVtYmVyKys7CiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyNjsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgICAgaWYgKCEoZW5kTGluZU51bWJlciA8IHN0YXJ0TGluZU51bWJlciB8fCBlbmRMaW5lTnVtYmVyID4gbWF4TGluZSkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgZW5kQ29sdW1uID0gKF90aGlzLmNvcmVFZGl0b3IuZ2V0TGluZVZhbHVlKGVuZExpbmVOdW1iZXIpIHx8ICcnKS5yZXBsYWNlKC9ccyskLywgJycpLmxlbmd0aCArIDE7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgICAgIGxpbmVOdW1iZXI6IHN0YXJ0TGluZU51bWJlciwKICAgICAgICAgICAgICAgICAgY29sdW1uOiAxCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgICAgIGxpbmVOdW1iZXI6IGVuZExpbmVOdW1iZXIsCiAgICAgICAgICAgICAgICAgIGNvbHVtbjogZW5kQ29sdW1uCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImdldFJlcXVlc3RJblJhbmdlIiwgZnVuY3Rpb24gX2NhbGxlZTUocmFuZ2UpIHsKICAgICAgdmFyIHJlcXVlc3QsIHBvcywgdG9rZW5JdGVyLCB0LCBib2R5U3RhcnRMaW5lTnVtYmVyLCBkYXRhRW5kUG9zLCBib2R5UmFuZ2UsIGRhdGE7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmNvcmVFZGl0b3Iud2FpdEZvckxhdGVzdFRva2VucygpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpZiAocmFuZ2UpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHJlcXVlc3QgPSB7CiAgICAgICAgICAgICAgICBtZXRob2Q6ICcnLAogICAgICAgICAgICAgICAgZGF0YTogW10sCiAgICAgICAgICAgICAgICB1cmw6IG51bGwsCiAgICAgICAgICAgICAgICByYW5nZTogcmFuZ2UKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHBvcyA9IHJhbmdlLnN0YXJ0OwogICAgICAgICAgICAgIHRva2VuSXRlciA9ICgwLCBfZmFjdG9yaWVzLmNyZWF0ZVRva2VuSXRlcmF0b3IpKHsKICAgICAgICAgICAgICAgIGVkaXRvcjogX3RoaXMuY29yZUVkaXRvciwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3MKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0ID0gdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlbigpOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMucGFyc2VyLmlzRW1wdHlUb2tlbih0KSkgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHJvdyBzdGFydHMgd2l0aCBzb21lIHNwYWNlcywgc2tpcCB0aGVtLgogICAgICAgICAgICAgICAgdCA9IF90aGlzLnBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCEodCA9PSBudWxsKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICByZXF1ZXN0Lm1ldGhvZCA9IHQudmFsdWU7CiAgICAgICAgICAgICAgdCA9IF90aGlzLnBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwoKICAgICAgICAgICAgICBpZiAoISghdCB8fCB0LnR5cGUgPT09ICdtZXRob2QnKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxNTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICByZXF1ZXN0LnVybCA9ICcnOwoKICAgICAgICAgICAgICB3aGlsZSAodCAmJiB0LnR5cGUgJiYgdC50eXBlLmluZGV4T2YoJ3VybCcpID09PSAwKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0LnVybCArPSB0LnZhbHVlOwogICAgICAgICAgICAgICAgdCA9IHRva2VuSXRlci5zdGVwRm9yd2FyZCgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzLnBhcnNlci5pc0VtcHR5VG9rZW4odCkpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB1cmwgcm93IGVuZHMgd2l0aCBzb21lIHNwYWNlcywgc2tpcCB0aGVtLgogICAgICAgICAgICAgICAgdCA9IF90aGlzLnBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYm9keVN0YXJ0TGluZU51bWJlciA9ICh0ID8gMCA6IDEpICsgdG9rZW5JdGVyLmdldEN1cnJlbnRQb3NpdGlvbigpLmxpbmVOdW1iZXI7IC8vIGFydGlmaWNpYWxseSBpbmNyZWFzZSBlbmQgb2YgZG9jcy4KCiAgICAgICAgICAgICAgd2hpbGUgKGJvZHlTdGFydExpbmVOdW1iZXIgPCByYW5nZS5lbmQubGluZU51bWJlciB8fCBib2R5U3RhcnRMaW5lTnVtYmVyID09PSByYW5nZS5lbmQubGluZU51bWJlciAmJiAxIDwgcmFuZ2UuZW5kLmNvbHVtbikgewogICAgICAgICAgICAgICAgZGF0YUVuZFBvcyA9IF90aGlzLm5leHREYXRhRG9jRW5kKHsKICAgICAgICAgICAgICAgICAgbGluZU51bWJlcjogYm9keVN0YXJ0TGluZU51bWJlciwKICAgICAgICAgICAgICAgICAgY29sdW1uOiAxCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJvZHlSYW5nZSA9IHsKICAgICAgICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICAgICAgICBsaW5lTnVtYmVyOiBib2R5U3RhcnRMaW5lTnVtYmVyLAogICAgICAgICAgICAgICAgICAgIGNvbHVtbjogMQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBlbmQ6IGRhdGFFbmRQb3MKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBkYXRhID0gX3RoaXMuY29yZUVkaXRvci5nZXRWYWx1ZUluUmFuZ2UoYm9keVJhbmdlKTsKICAgICAgICAgICAgICAgIHJlcXVlc3QuZGF0YS5wdXNoKGRhdGEudHJpbSgpKTsKICAgICAgICAgICAgICAgIGJvZHlTdGFydExpbmVOdW1iZXIgPSBkYXRhRW5kUG9zLmxpbmVOdW1iZXIgKyAxOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHJlcXVlc3QpOwoKICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJnZXRSZXF1ZXN0c0luUmFuZ2UiLCBmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgdmFyIHJhbmdlLAogICAgICAgICAgaW5jbHVkZU5vblJlcXVlc3RCbG9ja3MsCiAgICAgICAgICBleHBhbmRlZFJhbmdlLAogICAgICAgICAgcmVxdWVzdHMsCiAgICAgICAgICByYW5nZVN0YXJ0Q3Vyc29yLAogICAgICAgICAgZW5kTGluZU51bWJlciwKICAgICAgICAgIGN1cnJlbnRMaW5lTnVtYmVyLAogICAgICAgICAgZmx1c2hOb25SZXF1ZXN0QmxvY2ssCiAgICAgICAgICBfcmVxdWVzdCwKICAgICAgICAgIF9hcmdzNiA9IGFyZ3VtZW50czsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHJhbmdlID0gX2FyZ3M2Lmxlbmd0aCA+IDAgJiYgX2FyZ3M2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczZbMF0gOiBfdGhpcy5jb3JlRWRpdG9yLmdldFNlbGVjdGlvblJhbmdlKCk7CiAgICAgICAgICAgICAgaW5jbHVkZU5vblJlcXVlc3RCbG9ja3MgPSBfYXJnczYubGVuZ3RoID4gMSAmJiBfYXJnczZbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNlsxXSA6IGZhbHNlOwogICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmNvcmVFZGl0b3Iud2FpdEZvckxhdGVzdFRva2VucygpKTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBpZiAocmFuZ2UpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIFtdKTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDg7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5leHBhbmRSYW5nZVRvUmVxdWVzdEVkZ2VzKHJhbmdlKSk7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgZXhwYW5kZWRSYW5nZSA9IF9jb250ZXh0Ni5zZW50OwoKICAgICAgICAgICAgICBpZiAoZXhwYW5kZWRSYW5nZSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIFtdKTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgcmVxdWVzdHMgPSBbXTsKICAgICAgICAgICAgICByYW5nZVN0YXJ0Q3Vyc29yID0gZXhwYW5kZWRSYW5nZS5zdGFydC5saW5lTnVtYmVyOwogICAgICAgICAgICAgIGVuZExpbmVOdW1iZXIgPSBleHBhbmRlZFJhbmdlLmVuZC5saW5lTnVtYmVyOyAvLyBtb3ZlIHRvIHRoZSBuZXh0IHJlcXVlc3Qgc3RhcnQgKGR1cmluZyB0aGUgc2Vjb25kIGl0ZXJhdGlvbnMgdGhpcyBtYXkgbm90IGJlIGV4YWN0bHkgb24gYSByZXF1ZXN0CgogICAgICAgICAgICAgIGN1cnJlbnRMaW5lTnVtYmVyID0gZXhwYW5kZWRSYW5nZS5zdGFydC5saW5lTnVtYmVyOwoKICAgICAgICAgICAgICBmbHVzaE5vblJlcXVlc3RCbG9jayA9IGZ1bmN0aW9uIGZsdXNoTm9uUmVxdWVzdEJsb2NrKCkgewogICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVOb25SZXF1ZXN0QmxvY2tzKSB7CiAgICAgICAgICAgICAgICAgIHZhciBub25SZXF1ZXN0UHJlZml4QmxvY2sgPSBfdGhpcy5jb3JlRWRpdG9yLmdldExpbmVzKHJhbmdlU3RhcnRDdXJzb3IsIGN1cnJlbnRMaW5lTnVtYmVyIC0gMSkuam9pbignXG4nKTsKCiAgICAgICAgICAgICAgICAgIGlmIChub25SZXF1ZXN0UHJlZml4QmxvY2spIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0cy5wdXNoKG5vblJlcXVlc3RQcmVmaXhCbG9jayk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBpZiAoIShjdXJyZW50TGluZU51bWJlciA8PSBlbmRMaW5lTnVtYmVyKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCFfdGhpcy5wYXJzZXIuaXNTdGFydFJlcXVlc3RSb3coY3VycmVudExpbmVOdW1iZXIpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmbHVzaE5vblJlcXVlc3RCbG9jaygpOwogICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5nZXRSZXF1ZXN0KGN1cnJlbnRMaW5lTnVtYmVyKSk7CgogICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgIF9yZXF1ZXN0ID0gX2NvbnRleHQ2LnNlbnQ7CgogICAgICAgICAgICAgIGlmIChfcmVxdWVzdCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHJlcXVlc3RzKTsKCiAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgcmVxdWVzdHMucHVzaChfcmVxdWVzdCk7CiAgICAgICAgICAgICAgcmFuZ2VTdGFydEN1cnNvciA9IGN1cnJlbnRMaW5lTnVtYmVyID0gX3JlcXVlc3QucmFuZ2UuZW5kLmxpbmVOdW1iZXIgKyAxOwoKICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDMxOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICArK2N1cnJlbnRMaW5lTnVtYmVyOwoKICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE2OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICBmbHVzaE5vblJlcXVlc3RCbG9jaygpOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCByZXF1ZXN0cyk7CgogICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImdldFJlcXVlc3QiLCBmdW5jdGlvbiBfY2FsbGVlNyhyb3cpIHsKICAgICAgdmFyIHJhbmdlOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5jb3JlRWRpdG9yLndhaXRGb3JMYXRlc3RUb2tlbnMoKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgaWYgKCFfdGhpcy5wYXJzZXIuaXNJbkJldHdlZW5SZXF1ZXN0c1Jvdyhyb3cpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDY7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5nZXRSZXF1ZXN0UmFuZ2Uocm93KSk7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgcmFuZ2UgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgX3RoaXMuZ2V0UmVxdWVzdEluUmFuZ2UocmFuZ2UpKTsKCiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJtb3ZlVG9QcmV2aW91c1JlcXVlc3RFZGdlIiwgZnVuY3Rpb24gX2NhbGxlZTgoKSB7CiAgICAgIHZhciBwb3M7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmNvcmVFZGl0b3Iud2FpdEZvckxhdGVzdFRva2VucygpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBwb3MgPSBfdGhpcy5jb3JlRWRpdG9yLmdldEN1cnJlbnRQb3NpdGlvbigpOwoKICAgICAgICAgICAgICBmb3IgKHBvcy5saW5lTnVtYmVyLS07IHBvcy5saW5lTnVtYmVyID4gMSAmJiAhX3RoaXMucGFyc2VyLmlzUmVxdWVzdEVkZ2UocG9zLmxpbmVOdW1iZXIpOyBwb3MubGluZU51bWJlci0tKSB7Ly8gbG9vcCBmb3Igc2lkZSBlZmZlY3RzCiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpcy5jb3JlRWRpdG9yLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKHsKICAgICAgICAgICAgICAgIGxpbmVOdW1iZXI6IHBvcy5saW5lTnVtYmVyLAogICAgICAgICAgICAgICAgY29sdW1uOiAxCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibW92ZVRvTmV4dFJlcXVlc3RFZGdlIiwgZnVuY3Rpb24gX2NhbGxlZTkobW92ZU9ubHlJZk5vdE9uRWRnZSkgewogICAgICB2YXIgcG9zLCBtYXhSb3c7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmNvcmVFZGl0b3Iud2FpdEZvckxhdGVzdFRva2VucygpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBwb3MgPSBfdGhpcy5jb3JlRWRpdG9yLmdldEN1cnJlbnRQb3NpdGlvbigpOwogICAgICAgICAgICAgIG1heFJvdyA9IF90aGlzLmNvcmVFZGl0b3IuZ2V0TGluZUNvdW50KCk7CgogICAgICAgICAgICAgIGlmICghbW92ZU9ubHlJZk5vdE9uRWRnZSkgewogICAgICAgICAgICAgICAgcG9zLmxpbmVOdW1iZXIrKzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvciAoOyBwb3MubGluZU51bWJlciA8IG1heFJvdyAmJiAhX3RoaXMucGFyc2VyLmlzUmVxdWVzdEVkZ2UocG9zLmxpbmVOdW1iZXIpOyBwb3MubGluZU51bWJlcisrKSB7Ly8gbG9vcCBmb3Igc2lkZSBlZmZlY3RzCiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpcy5jb3JlRWRpdG9yLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKHsKICAgICAgICAgICAgICAgIGxpbmVOdW1iZXI6IHBvcy5saW5lTnVtYmVyLAogICAgICAgICAgICAgICAgY29sdW1uOiAxCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibmV4dFJlcXVlc3RFbmQiLCBmdW5jdGlvbiAocG9zKSB7CiAgICAgIHBvcyA9IHBvcyB8fCBfdGhpcy5jb3JlRWRpdG9yLmdldEN1cnJlbnRQb3NpdGlvbigpOwoKICAgICAgdmFyIG1heExpbmVzID0gX3RoaXMuY29yZUVkaXRvci5nZXRMaW5lQ291bnQoKTsKCiAgICAgIHZhciBjdXJMaW5lTnVtYmVyID0gcG9zLmxpbmVOdW1iZXI7CgogICAgICBmb3IgKDsgY3VyTGluZU51bWJlciA8PSBtYXhMaW5lczsgKytjdXJMaW5lTnVtYmVyKSB7CiAgICAgICAgdmFyIGN1clJvd01vZGUgPSBfdGhpcy5wYXJzZXIuZ2V0Um93UGFyc2VNb2RlKGN1ckxpbmVOdW1iZXIpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQoKCiAgICAgICAgaWYgKChjdXJSb3dNb2RlICYgX3RoaXMucGFyc2VyLk1PREUuUkVRVUVTVF9FTkQpID4gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQoKCiAgICAgICAgaWYgKGN1ckxpbmVOdW1iZXIgIT09IHBvcy5saW5lTnVtYmVyICYmIChjdXJSb3dNb2RlICYgX3RoaXMucGFyc2VyLk1PREUuUkVRVUVTVF9TVEFSVCkgPiAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBjb2x1bW4gPSAoX3RoaXMuY29yZUVkaXRvci5nZXRMaW5lVmFsdWUoY3VyTGluZU51bWJlcikgfHwgJycpLnJlcGxhY2UoL1xzKyQvLCAnJykubGVuZ3RoICsgMTsKICAgICAgcmV0dXJuIHsKICAgICAgICBsaW5lTnVtYmVyOiBjdXJMaW5lTnVtYmVyLAogICAgICAgIGNvbHVtbjogY29sdW1uCiAgICAgIH07CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIm5leHREYXRhRG9jRW5kIiwgZnVuY3Rpb24gKHBvcykgewogICAgICBwb3MgPSBwb3MgfHwgX3RoaXMuY29yZUVkaXRvci5nZXRDdXJyZW50UG9zaXRpb24oKTsKICAgICAgdmFyIGN1ckxpbmVOdW1iZXIgPSBwb3MubGluZU51bWJlcjsKCiAgICAgIHZhciBtYXhMaW5lcyA9IF90aGlzLmNvcmVFZGl0b3IuZ2V0TGluZUNvdW50KCk7CgogICAgICBmb3IgKDsgY3VyTGluZU51bWJlciA8IG1heExpbmVzOyBjdXJMaW5lTnVtYmVyKyspIHsKICAgICAgICB2YXIgY3VyUm93TW9kZSA9IF90aGlzLnBhcnNlci5nZXRSb3dQYXJzZU1vZGUoY3VyTGluZU51bWJlcik7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlCgoKICAgICAgICBpZiAoKGN1clJvd01vZGUgJiBfdGhpcy5wYXJzZXIuTU9ERS5SRVFVRVNUX0VORCkgPiAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlCgoKICAgICAgICBpZiAoKGN1clJvd01vZGUgJiBfdGhpcy5wYXJzZXIuTU9ERS5NVUxUSV9ET0NfQ1VSX0RPQ19FTkQpID4gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQoKCiAgICAgICAgaWYgKGN1ckxpbmVOdW1iZXIgIT09IHBvcy5saW5lTnVtYmVyICYmIChjdXJSb3dNb2RlICYgX3RoaXMucGFyc2VyLk1PREUuUkVRVUVTVF9TVEFSVCkgPiAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBjb2x1bW4gPSAoX3RoaXMuY29yZUVkaXRvci5nZXRMaW5lVmFsdWUoY3VyTGluZU51bWJlcikgfHwgJycpLmxlbmd0aCArIDEKICAgICAgLyogUmFuZ2UgZ29lcyB0byAxIGFmdGVyIGxhc3QgY2hhciAqLwogICAgICA7CiAgICAgIHJldHVybiB7CiAgICAgICAgbGluZU51bWJlcjogY3VyTGluZU51bWJlciwKICAgICAgICBjb2x1bW46IGNvbHVtbgogICAgICB9OwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJoaWdobGlnaHRDdXJyZW50UmVxdWVzdHNBbmRVcGRhdGVBY3Rpb25CYXIiLCBfbG9kYXNoLmRlZmF1bHQuZGVib3VuY2UoZnVuY3Rpb24gX2NhbGxlZTEwKCkgewogICAgICB2YXIgZXhwYW5kZWRSYW5nZSwgY3Vyc29yTGluZU51bWJlcjsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTApIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5jb3JlRWRpdG9yLndhaXRGb3JMYXRlc3RUb2tlbnMoKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmV4cGFuZFJhbmdlVG9SZXF1ZXN0RWRnZXMoKSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgZXhwYW5kZWRSYW5nZSA9IF9jb250ZXh0MTAuc2VudDsKCiAgICAgICAgICAgICAgaWYgKCEoZXhwYW5kZWRSYW5nZSA9PT0gbnVsbCAmJiBfdGhpcy5jdXJyZW50UmVxUmFuZ2UgPT09IG51bGwpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGlmICghKGV4cGFuZGVkUmFuZ2UgIT09IG51bGwgJiYgX3RoaXMuY3VycmVudFJlcVJhbmdlICE9PSBudWxsICYmIGV4cGFuZGVkUmFuZ2Uuc3RhcnQubGluZU51bWJlciA9PT0gX3RoaXMuY3VycmVudFJlcVJhbmdlLnN0YXJ0LmxpbmVOdW1iZXIgJiYgZXhwYW5kZWRSYW5nZS5lbmQubGluZU51bWJlciA9PT0gX3RoaXMuY3VycmVudFJlcVJhbmdlLmVuZC5saW5lTnVtYmVyKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9IC8vIHNhbWUgcmVxdWVzdCwgbm93IHNlZSBpZiB3ZSBhcmUgb24gdGhlIGZpcnN0IGxpbmUgYW5kIHVwZGF0ZSB0aGUgYWN0aW9uIGJhcgoKCiAgICAgICAgICAgICAgY3Vyc29yTGluZU51bWJlciA9IF90aGlzLmNvcmVFZGl0b3IuZ2V0Q3VycmVudFBvc2l0aW9uKCkubGluZU51bWJlcjsKCiAgICAgICAgICAgICAgaWYgKGN1cnNvckxpbmVOdW1iZXIgPT09IF90aGlzLmN1cnJlbnRSZXFSYW5nZS5zdGFydC5saW5lTnVtYmVyKSB7CiAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVBY3Rpb25zQmFyKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBpZiAoX3RoaXMuY3VycmVudFJlcVJhbmdlKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5jb3JlRWRpdG9yLnJlbW92ZU1hcmtlcihfdGhpcy5jdXJyZW50UmVxUmFuZ2UubWFya2VyUmVmKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzLmN1cnJlbnRSZXFSYW5nZSA9IGV4cGFuZGVkUmFuZ2U7CgogICAgICAgICAgICAgIGlmIChfdGhpcy5jdXJyZW50UmVxUmFuZ2UpIHsKICAgICAgICAgICAgICAgIF90aGlzLmN1cnJlbnRSZXFSYW5nZS5tYXJrZXJSZWYgPSBfdGhpcy5jb3JlRWRpdG9yLmFkZE1hcmtlcihfdGhpcy5jdXJyZW50UmVxUmFuZ2UpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMudXBkYXRlQWN0aW9uc0JhcigpOwoKICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sIDI1KSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJnZXRSZXF1ZXN0c0FzQ1VSTCIsIGZ1bmN0aW9uIF9jYWxsZWUxMShlbGFzdGljc2VhcmNoQmFzZVVybCwgcmFuZ2UpIHsKICAgICAgdmFyIHJlcXVlc3RzLCByZXN1bHQ7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX3RoaXMuZ2V0UmVxdWVzdHNJblJhbmdlKHJhbmdlLCB0cnVlKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgcmVxdWVzdHMgPSBfY29udGV4dDExLnNlbnQ7CiAgICAgICAgICAgICAgcmVzdWx0ID0gX2xvZGFzaC5kZWZhdWx0Lm1hcChyZXF1ZXN0cywgZnVuY3Rpb24gKHJlcSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXEgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgIC8vIG5vIHJlcXVlc3QgYmxvY2sKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgZXNQYXRoID0gcmVxLnVybDsKICAgICAgICAgICAgICAgIHZhciBlc01ldGhvZCA9IHJlcS5tZXRob2Q7CiAgICAgICAgICAgICAgICB2YXIgZXNEYXRhID0gcmVxLmRhdGE7IC8vIHRoaXMgaXMgdGhlIGZpcnN0IHVybCBkZWZpbmVkIGluIGVsYXN0aWNzZWFyY2guaG9zdHMKCiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZXMuY29uc3RydWN0RVNVcmwoZWxhc3RpY3NlYXJjaEJhc2VVcmwsIGVzUGF0aCk7CiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gJ2N1cmwgLVgnICsgZXNNZXRob2QgKyAnICInICsgdXJsICsgJyInOwoKICAgICAgICAgICAgICAgIGlmIChlc0RhdGEgJiYgZXNEYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICByZXQgKz0gIiAtSCAnQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uJyAtZCdcbiI7CiAgICAgICAgICAgICAgICAgIHZhciBkYXRhQXNTdHJpbmcgPSB1dGlscy5jb2xsYXBzZUxpdGVyYWxTdHJpbmdzKGVzRGF0YS5qb2luKCdcbicpKTsgLy8gc2luY2UgU2Vuc2UgZG9lc24ndCBhbGxvdyBzaW5nbGUgcXVvdGUganNvbiBzdHJpbmcgYW55IHNpbmdsZSBxb3V0ZSBpcyB3aXRoaW4gYSBzdHJpbmcuCgogICAgICAgICAgICAgICAgICByZXQgKz0gZGF0YUFzU3RyaW5nLnJlcGxhY2UoLycvZywgJ1xcIicpOwoKICAgICAgICAgICAgICAgICAgaWYgKGVzRGF0YS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0ICs9ICdcbic7CiAgICAgICAgICAgICAgICAgIH0gLy8gZW5kIHdpdGggYSBuZXcgbGluZQoKCiAgICAgICAgICAgICAgICAgIHJldCArPSAiJyI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIHJlc3VsdC5qb2luKCdcbicpKTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAidXBkYXRlQWN0aW9uc0JhciIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzLmNvcmVFZGl0b3IubGVnYWN5VXBkYXRlVUkoX3RoaXMuY3VycmVudFJlcVJhbmdlKTsKICAgIH0pOwoKICAgIHRoaXMuY3VycmVudFJlcVJhbmdlID0gbnVsbDsKICAgIHRoaXMucGFyc2VyID0gbmV3IF9yb3dfcGFyc2VyLmRlZmF1bHQodGhpcy5jb3JlRWRpdG9yKTsKICAgIHRoaXMuYXV0b2NvbXBsZXRlID0gbmV3IF9hdXRvY29tcGxldGUuZGVmYXVsdCh7CiAgICAgIGNvcmVFZGl0b3I6IGNvcmVFZGl0b3IsCiAgICAgIHBhcnNlcjogdGhpcy5wYXJzZXIKICAgIH0pOwogICAgdGhpcy5jb3JlRWRpdG9yLm9uKCd0b2tlbml6ZXJVcGRhdGUnLCB0aGlzLmhpZ2hsaWdodEN1cnJlbnRSZXF1ZXN0c0FuZFVwZGF0ZUFjdGlvbkJhci5iaW5kKHRoaXMpKTsKICAgIHRoaXMuY29yZUVkaXRvci5vbignY2hhbmdlQ3Vyc29yJywgdGhpcy5oaWdobGlnaHRDdXJyZW50UmVxdWVzdHNBbmRVcGRhdGVBY3Rpb25CYXIuYmluZCh0aGlzKSk7CiAgICB0aGlzLmNvcmVFZGl0b3Iub24oJ2NoYW5nZVNjcm9sbFRvcCcsIHRoaXMudXBkYXRlQWN0aW9uc0Jhci5iaW5kKHRoaXMpKTsKICB9CgogIF9jcmVhdGVDbGFzcyhTZW5zZUVkaXRvciwgW3sKICAgIGtleTogImdldENvcmVFZGl0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvcmVFZGl0b3IoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvcmVFZGl0b3I7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU2Vuc2VFZGl0b3I7Cn0oKTsKCmV4cG9ydHMuU2Vuc2VFZGl0b3IgPSBTZW5zZUVkaXRvcjs="},null]}