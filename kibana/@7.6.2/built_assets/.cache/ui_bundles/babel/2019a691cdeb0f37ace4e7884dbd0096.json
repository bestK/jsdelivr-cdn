{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/lens/public/indexpattern_plugin/datapanel.js","dependencies":[{"path":"x-pack/legacy/plugins/lens/public/indexpattern_plugin/datapanel.js","mtime":1585205045009},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkluZGV4UGF0dGVybkRhdGFQYW5lbCA9IEluZGV4UGF0dGVybkRhdGFQYW5lbDsKZXhwb3J0cy5NZW1vaXplZERhdGFQYW5lbCA9IGV4cG9ydHMuSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWwgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfZHJhZ19kcm9wID0gcmVxdWlyZSgiLi4vZHJhZ19kcm9wIik7Cgp2YXIgX2ZpZWxkX2l0ZW0gPSByZXF1aXJlKCIuL2ZpZWxkX2l0ZW0iKTsKCnZhciBfbGVuc191aV90ZWxlbWV0cnkgPSByZXF1aXJlKCIuLi9sZW5zX3VpX3RlbGVtZXRyeSIpOwoKdmFyIF9sb2FkZXIgPSByZXF1aXJlKCIuL2xvYWRlciIpOwoKdmFyIF9wdXJlX2hlbHBlcnMgPSByZXF1aXJlKCIuL3B1cmVfaGVscGVycyIpOwoKdmFyIF9sb2FkZXIyID0gcmVxdWlyZSgiLi4vbG9hZGVyIik7Cgp2YXIgX2xlbnNfZmllbGRfaWNvbiA9IHJlcXVpcmUoIi4vbGVuc19maWVsZF9pY29uIik7Cgp2YXIgX2NoYW5nZV9pbmRleHBhdHRlcm4gPSByZXF1aXJlKCIuL2NoYW5nZV9pbmRleHBhdHRlcm4iKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfSAvLyBUT0RPIHRoZSB0eXBpbmdzIGZvciBFdWlDb250ZXh0TWVudVBhbmVsIGFyZSBpbmNvcnJlY3QgLSB3YXRjaGVkSXRlbVByb3BzIGlzIG1pc3NpbmcuIFRoaXMgY2FuIGJlIHJlbW92ZWQgd2hlbiB0aGUgdHlwZXMgYXJlIGFkanVzdGVkCgoKdmFyIEZpeGVkRXVpQ29udGV4dE1lbnVQYW5lbCA9IF9ldWkuRXVpQ29udGV4dE1lbnVQYW5lbDsKCmZ1bmN0aW9uIHNvcnRGaWVsZHMoZmllbGRBLCBmaWVsZEIpIHsKICByZXR1cm4gZmllbGRBLm5hbWUubG9jYWxlQ29tcGFyZShmaWVsZEIubmFtZSwgdW5kZWZpbmVkLCB7CiAgICBzZW5zaXRpdml0eTogJ2Jhc2UnCiAgfSk7Cn0KCnZhciBzdXBwb3J0ZWRGaWVsZFR5cGVzID0gbmV3IFNldChbJ3N0cmluZycsICdudW1iZXInLCAnYm9vbGVhbicsICdkYXRlJywgJ2lwJywgJ2RvY3VtZW50J10pOwp2YXIgUEFHSU5BVElPTl9TSVpFID0gNTA7CnZhciBmaWVsZFR5cGVOYW1lcyA9IHsKICBkb2N1bWVudDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuZGF0YXR5cGVzLnJlY29yZCcsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAncmVjb3JkJwogIH0pLAogIHN0cmluZzogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuZGF0YXR5cGVzLnN0cmluZycsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnc3RyaW5nJwogIH0pLAogIG51bWJlcjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuZGF0YXR5cGVzLm51bWJlcicsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnbnVtYmVyJwogIH0pLAogIGJvb2xlYW46IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmRhdGF0eXBlcy5ib29sZWFuJywgewogICAgZGVmYXVsdE1lc3NhZ2U6ICdib29sZWFuJwogIH0pLAogIGRhdGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmRhdGF0eXBlcy5kYXRlJywgewogICAgZGVmYXVsdE1lc3NhZ2U6ICdkYXRlJwogIH0pLAogIGlwOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5kYXRhdHlwZXMuaXBBZGRyZXNzJywgewogICAgZGVmYXVsdE1lc3NhZ2U6ICdJUCcKICB9KQp9OwoKZnVuY3Rpb24gSW5kZXhQYXR0ZXJuRGF0YVBhbmVsKF9yZWYpIHsKICB2YXIgc2V0U3RhdGUgPSBfcmVmLnNldFN0YXRlLAogICAgICBzdGF0ZSA9IF9yZWYuc3RhdGUsCiAgICAgIGRyYWdEcm9wQ29udGV4dCA9IF9yZWYuZHJhZ0Ryb3BDb250ZXh0LAogICAgICBjb3JlID0gX3JlZi5jb3JlLAogICAgICBxdWVyeSA9IF9yZWYucXVlcnksCiAgICAgIGZpbHRlcnMgPSBfcmVmLmZpbHRlcnMsCiAgICAgIGRhdGVSYW5nZSA9IF9yZWYuZGF0ZVJhbmdlLAogICAgICBjaGFuZ2VJbmRleFBhdHRlcm4gPSBfcmVmLmNoYW5nZUluZGV4UGF0dGVybjsKICB2YXIgaW5kZXhQYXR0ZXJuUmVmcyA9IHN0YXRlLmluZGV4UGF0dGVyblJlZnMsCiAgICAgIGluZGV4UGF0dGVybnMgPSBzdGF0ZS5pbmRleFBhdHRlcm5zLAogICAgICBjdXJyZW50SW5kZXhQYXR0ZXJuSWQgPSBzdGF0ZS5jdXJyZW50SW5kZXhQYXR0ZXJuSWQ7CiAgdmFyIG9uQ2hhbmdlSW5kZXhQYXR0ZXJuID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKGlkKSB7CiAgICByZXR1cm4gY2hhbmdlSW5kZXhQYXR0ZXJuKGlkLCBzdGF0ZSwgc2V0U3RhdGUpOwogIH0sIFtzdGF0ZSwgc2V0U3RhdGVdKTsKICB2YXIgb25Ub2dnbGVFbXB0eUZpZWxkcyA9ICgwLCBfcmVhY3QudXNlQ2FsbGJhY2spKGZ1bmN0aW9uIChzaG93RW1wdHlGaWVsZHMpIHsKICAgIHNldFN0YXRlKGZ1bmN0aW9uIChwcmV2U3RhdGUpIHsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZSwgewogICAgICAgIHNob3dFbXB0eUZpZWxkczogc2hvd0VtcHR5RmllbGRzID09PSB1bmRlZmluZWQgPyAhcHJldlN0YXRlLnNob3dFbXB0eUZpZWxkcyA6IHNob3dFbXB0eUZpZWxkcwogICAgICB9KTsKICAgIH0pOwogIH0sIFtzZXRTdGF0ZV0pOwogIHZhciBpbmRleFBhdHRlcm5MaXN0ID0gKDAsIF9sb2Rhc2gudW5pcSkoT2JqZWN0LnZhbHVlcyhzdGF0ZS5sYXllcnMpLm1hcChmdW5jdGlvbiAobCkgewogICAgcmV0dXJuIGwuaW5kZXhQYXR0ZXJuSWQ7CiAgfSkuY29uY2F0KGN1cnJlbnRJbmRleFBhdHRlcm5JZCkpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgIHJldHVybiBhLmxvY2FsZUNvbXBhcmUoYik7CiAgfSkuZmlsdGVyKGZ1bmN0aW9uIChpZCkgewogICAgcmV0dXJuICEhaW5kZXhQYXR0ZXJuc1tpZF07CiAgfSkubWFwKGZ1bmN0aW9uIChpZCkgewogICAgcmV0dXJuIHsKICAgICAgaWQ6IGlkLAogICAgICB0aXRsZTogaW5kZXhQYXR0ZXJuc1tpZF0udGl0bGUsCiAgICAgIHRpbWVGaWVsZE5hbWU6IGluZGV4UGF0dGVybnNbaWRdLnRpbWVGaWVsZE5hbWUKICAgIH07CiAgfSk7CiAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2xvYWRlcjIuTG9hZGVyLCB7CiAgICBsb2FkOiBmdW5jdGlvbiBsb2FkKCkgewogICAgICByZXR1cm4gKDAsIF9sb2FkZXIuc3luY0V4aXN0aW5nRmllbGRzKSh7CiAgICAgICAgZGF0ZVJhbmdlOiBkYXRlUmFuZ2UsCiAgICAgICAgc2V0U3RhdGU6IHNldFN0YXRlLAogICAgICAgIGluZGV4UGF0dGVybnM6IGluZGV4UGF0dGVybkxpc3QsCiAgICAgICAgZmV0Y2hKc29uOiBjb3JlLmh0dHAuZ2V0CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWREZXBzOiBbZGF0ZVJhbmdlLmZyb21EYXRlLCBkYXRlUmFuZ2UudG9EYXRlLCBpbmRleFBhdHRlcm5MaXN0Lm1hcChmdW5jdGlvbiAoeCkgewogICAgICByZXR1cm4gIiIuY29uY2F0KHgudGl0bGUsICI6IikuY29uY2F0KHgudGltZUZpZWxkTmFtZSk7CiAgICB9KS5qb2luKCcsJyldCiAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoTWVtb2l6ZWREYXRhUGFuZWwsIHsKICAgIGN1cnJlbnRJbmRleFBhdHRlcm5JZDogY3VycmVudEluZGV4UGF0dGVybklkLAogICAgaW5kZXhQYXR0ZXJuUmVmczogaW5kZXhQYXR0ZXJuUmVmcywKICAgIGluZGV4UGF0dGVybnM6IGluZGV4UGF0dGVybnMsCiAgICBxdWVyeTogcXVlcnksCiAgICBkYXRlUmFuZ2U6IGRhdGVSYW5nZSwKICAgIGZpbHRlcnM6IGZpbHRlcnMsCiAgICBkcmFnRHJvcENvbnRleHQ6IGRyYWdEcm9wQ29udGV4dCwKICAgIHNob3dFbXB0eUZpZWxkczogc3RhdGUuc2hvd0VtcHR5RmllbGRzLAogICAgb25Ub2dnbGVFbXB0eUZpZWxkczogb25Ub2dnbGVFbXB0eUZpZWxkcywKICAgIGNvcmU6IGNvcmUsCiAgICBvbkNoYW5nZUluZGV4UGF0dGVybjogb25DaGFuZ2VJbmRleFBhdHRlcm4sCiAgICBleGlzdGluZ0ZpZWxkczogc3RhdGUuZXhpc3RpbmdGaWVsZHMKICB9KSk7Cn0KCnZhciBJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbCA9IGZ1bmN0aW9uIElubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsKF9yZWYyKSB7CiAgdmFyIGN1cnJlbnRJbmRleFBhdHRlcm5JZCA9IF9yZWYyLmN1cnJlbnRJbmRleFBhdHRlcm5JZCwKICAgICAgaW5kZXhQYXR0ZXJuUmVmcyA9IF9yZWYyLmluZGV4UGF0dGVyblJlZnMsCiAgICAgIGluZGV4UGF0dGVybnMgPSBfcmVmMi5pbmRleFBhdHRlcm5zLAogICAgICBxdWVyeSA9IF9yZWYyLnF1ZXJ5LAogICAgICBkYXRlUmFuZ2UgPSBfcmVmMi5kYXRlUmFuZ2UsCiAgICAgIGZpbHRlcnMgPSBfcmVmMi5maWx0ZXJzLAogICAgICBkcmFnRHJvcENvbnRleHQgPSBfcmVmMi5kcmFnRHJvcENvbnRleHQsCiAgICAgIF9vbkNoYW5nZUluZGV4UGF0dGVybiA9IF9yZWYyLm9uQ2hhbmdlSW5kZXhQYXR0ZXJuLAogICAgICBzaG93RW1wdHlGaWVsZHMgPSBfcmVmMi5zaG93RW1wdHlGaWVsZHMsCiAgICAgIG9uVG9nZ2xlRW1wdHlGaWVsZHMgPSBfcmVmMi5vblRvZ2dsZUVtcHR5RmllbGRzLAogICAgICBjb3JlID0gX3JlZjIuY29yZSwKICAgICAgZXhpc3RpbmdGaWVsZHMgPSBfcmVmMi5leGlzdGluZ0ZpZWxkczsKCiAgaWYgKE9iamVjdC5rZXlzKGluZGV4UGF0dGVybnMpLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgZ3V0dGVyU2l6ZTogIm0iLAogICAgICBjbGFzc05hbWU6ICJsbnNJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbCIsCiAgICAgIGRpcmVjdGlvbjogImNvbHVtbiIsCiAgICAgIHJlc3BvbnNpdmU6IGZhbHNlCiAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgZ3JvdzogbnVsbAogICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgImRhdGEtdGVzdC1zdWJqIjogImluZGV4UGF0dGVybi1uby1pbmRleHBhdHRlcm5zIiwKICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybi5ub1BhdHRlcm5zTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdObyBpbmRleCBwYXR0ZXJucycKICAgICAgfSksCiAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgIGljb25UeXBlOiAiYWxlcnQiCiAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgaWQ6ICJ4cGFjay5sZW5zLmluZGV4UGF0dGVybi5ub1BhdHRlcm5zRGVzY3JpcHRpb24iLAogICAgICBkZWZhdWx0TWVzc2FnZTogIlBsZWFzZSBjcmVhdGUgYW4gaW5kZXggcGF0dGVybiBvciBzd2l0Y2ggdG8gYW5vdGhlciBkYXRhIHNvdXJjZSIKICAgIH0pKSkpKTsKICB9CgogIHZhciBfdXNlU3RhdGUgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKSh7CiAgICBuYW1lRmlsdGVyOiAnJywKICAgIHR5cGVGaWx0ZXI6IFtdLAogICAgaXNUeXBlRmlsdGVyT3BlbjogZmFsc2UKICB9KSwKICAgICAgX3VzZVN0YXRlMiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksCiAgICAgIGxvY2FsU3RhdGUgPSBfdXNlU3RhdGUyWzBdLAogICAgICBzZXRMb2NhbFN0YXRlID0gX3VzZVN0YXRlMlsxXTsKCiAgdmFyIF91c2VTdGF0ZTMgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKShQQUdJTkFUSU9OX1NJWkUpLAogICAgICBfdXNlU3RhdGU0ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMywgMiksCiAgICAgIHBhZ2VTaXplID0gX3VzZVN0YXRlNFswXSwKICAgICAgc2V0UGFnZVNpemUgPSBfdXNlU3RhdGU0WzFdOwoKICB2YXIgX3VzZVN0YXRlNSA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKHVuZGVmaW5lZCksCiAgICAgIF91c2VTdGF0ZTYgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU1LCAyKSwKICAgICAgc2Nyb2xsQ29udGFpbmVyID0gX3VzZVN0YXRlNlswXSwKICAgICAgc2V0U2Nyb2xsQ29udGFpbmVyID0gX3VzZVN0YXRlNlsxXTsKCiAgdmFyIGN1cnJlbnRJbmRleFBhdHRlcm4gPSBpbmRleFBhdHRlcm5zW2N1cnJlbnRJbmRleFBhdHRlcm5JZF07CiAgdmFyIGFsbEZpZWxkcyA9IGN1cnJlbnRJbmRleFBhdHRlcm4uZmllbGRzOwogIHZhciBmaWVsZEJ5TmFtZSA9ICgwLCBfbG9kYXNoLmluZGV4QnkpKGFsbEZpZWxkcywgJ25hbWUnKTsKCiAgdmFyIGNsZWFyTG9jYWxTdGF0ZSA9IGZ1bmN0aW9uIGNsZWFyTG9jYWxTdGF0ZSgpIHsKICAgIHJldHVybiBzZXRMb2NhbFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgbmFtZUZpbHRlcjogJycsCiAgICAgICAgdHlwZUZpbHRlcjogW10KICAgICAgfSk7CiAgICB9KTsKICB9OwoKICB2YXIgbGF6eVNjcm9sbCA9IGZ1bmN0aW9uIGxhenlTY3JvbGwoKSB7CiAgICBpZiAoc2Nyb2xsQ29udGFpbmVyKSB7CiAgICAgIHZhciBuZWFyQm90dG9tID0gc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcCArIHNjcm9sbENvbnRhaW5lci5jbGllbnRIZWlnaHQgPiBzY3JvbGxDb250YWluZXIuc2Nyb2xsSGVpZ2h0ICogMC45OwoKICAgICAgaWYgKG5lYXJCb3R0b20pIHsKICAgICAgICBzZXRQYWdlU2l6ZShNYXRoLm1heChQQUdJTkFUSU9OX1NJWkUsIE1hdGgubWluKHBhZ2VTaXplICogMS41LCBhbGxGaWVsZHMubGVuZ3RoKSkpOwogICAgICB9CiAgICB9CiAgfTsKCiAgKDAsIF9yZWFjdC51c2VFZmZlY3QpKGZ1bmN0aW9uICgpIHsKICAgIC8vIFJlc2V0IHRoZSBzY3JvbGwgaWYgd2UgaGF2ZSBtYWRlIG1hdGVyaWFsIGNoYW5nZXMgdG8gdGhlIGZpZWxkIGxpc3QKICAgIGlmIChzY3JvbGxDb250YWluZXIpIHsKICAgICAgc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcCA9IDA7CiAgICAgIHNldFBhZ2VTaXplKFBBR0lOQVRJT05fU0laRSk7CiAgICAgIGxhenlTY3JvbGwoKTsKICAgIH0KICB9LCBbbG9jYWxTdGF0ZS5uYW1lRmlsdGVyLCBsb2NhbFN0YXRlLnR5cGVGaWx0ZXIsIGN1cnJlbnRJbmRleFBhdHRlcm5JZCwgc2hvd0VtcHR5RmllbGRzXSk7CiAgdmFyIGF2YWlsYWJsZUZpZWxkVHlwZXMgPSAoMCwgX2xvZGFzaC51bmlxKShhbGxGaWVsZHMubWFwKGZ1bmN0aW9uIChfcmVmMykgewogICAgdmFyIHR5cGUgPSBfcmVmMy50eXBlOwogICAgcmV0dXJuIHR5cGU7CiAgfSkpLmZpbHRlcihmdW5jdGlvbiAodHlwZSkgewogICAgcmV0dXJuIHR5cGUgaW4gZmllbGRUeXBlTmFtZXM7CiAgfSk7CiAgdmFyIGRpc3BsYXllZEZpZWxkcyA9IGFsbEZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICBpZiAoIXN1cHBvcnRlZEZpZWxkVHlwZXMuaGFzKGZpZWxkLnR5cGUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAobG9jYWxTdGF0ZS5uYW1lRmlsdGVyLmxlbmd0aCAmJiAhZmllbGQubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvY2FsU3RhdGUubmFtZUZpbHRlci50b0xvd2VyQ2FzZSgpKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKCFzaG93RW1wdHlGaWVsZHMpIHsKICAgICAgdmFyIGluZGV4RmllbGQgPSBjdXJyZW50SW5kZXhQYXR0ZXJuICYmIGZpZWxkQnlOYW1lW2ZpZWxkLm5hbWVdOwogICAgICB2YXIgZXhpc3RzID0gZmllbGQudHlwZSA9PT0gJ2RvY3VtZW50JyB8fCBpbmRleEZpZWxkICYmICgwLCBfcHVyZV9oZWxwZXJzLmZpZWxkRXhpc3RzKShleGlzdGluZ0ZpZWxkcywgY3VycmVudEluZGV4UGF0dGVybi50aXRsZSwgaW5kZXhGaWVsZC5uYW1lKTsKCiAgICAgIGlmIChsb2NhbFN0YXRlLnR5cGVGaWx0ZXIubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiBleGlzdHMgJiYgbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmluY2x1ZGVzKGZpZWxkLnR5cGUpOwogICAgICB9CgogICAgICByZXR1cm4gZXhpc3RzOwogICAgfQoKICAgIGlmIChsb2NhbFN0YXRlLnR5cGVGaWx0ZXIubGVuZ3RoID4gMCkgewogICAgICByZXR1cm4gbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmluY2x1ZGVzKGZpZWxkLnR5cGUpOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogIHZhciBzcGVjaWFsRmllbGRzID0gZGlzcGxheWVkRmllbGRzLmZpbHRlcihmdW5jdGlvbiAoZikgewogICAgcmV0dXJuIGYudHlwZSA9PT0gJ2RvY3VtZW50JzsKICB9KTsKICB2YXIgcGFnaW5hdGVkRmllbGRzID0gZGlzcGxheWVkRmllbGRzLmZpbHRlcihmdW5jdGlvbiAoZikgewogICAgcmV0dXJuIGYudHlwZSAhPT0gJ2RvY3VtZW50JzsKICB9KS5zb3J0KHNvcnRGaWVsZHMpLnNsaWNlKDAsIHBhZ2VTaXplKTsKICB2YXIgaGlsaWdodCA9IGxvY2FsU3RhdGUubmFtZUZpbHRlci50b0xvd2VyQ2FzZSgpOwogIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9kcmFnX2Ryb3AuQ2hpbGREcmFnRHJvcFByb3ZpZGVyLCBkcmFnRHJvcENvbnRleHQsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgIGd1dHRlclNpemU6ICJub25lIiwKICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsIiwKICAgIGRpcmVjdGlvbjogImNvbHVtbiIsCiAgICByZXNwb25zaXZlOiBmYWxzZQogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgZ3JvdzogbnVsbAogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsX19oZWFkZXIiCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY2hhbmdlX2luZGV4cGF0dGVybi5DaGFuZ2VJbmRleFBhdHRlcm4sIHsKICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbmRleFBhdHRlcm4tc3dpdGNoZXIiLAogICAgdHJpZ2dlcjogewogICAgICBsYWJlbDogY3VycmVudEluZGV4UGF0dGVybi50aXRsZSwKICAgICAgdGl0bGU6IGN1cnJlbnRJbmRleFBhdHRlcm4udGl0bGUsCiAgICAgICdkYXRhLXRlc3Qtc3Viaic6ICdpbmRleFBhdHRlcm4tc3dpdGNoLWxpbmsnLAogICAgICBjbGFzc05hbWU6ICdsbnNJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbF9fdHJpZ2dlckJ1dHRvbicKICAgIH0sCiAgICBpbmRleFBhdHRlcm5JZDogY3VycmVudEluZGV4UGF0dGVybklkLAogICAgaW5kZXhQYXR0ZXJuUmVmczogaW5kZXhQYXR0ZXJuUmVmcywKICAgIG9uQ2hhbmdlSW5kZXhQYXR0ZXJuOiBmdW5jdGlvbiBvbkNoYW5nZUluZGV4UGF0dGVybihuZXdJZCkgewogICAgICBfb25DaGFuZ2VJbmRleFBhdHRlcm4obmV3SWQpOwoKICAgICAgY2xlYXJMb2NhbFN0YXRlKCk7CiAgICB9CiAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICBjbGFzc05hbWU6ICJsbnNJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbF9fZmlsdGVyV3JhcHBlciIKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybUNvbnRyb2xMYXlvdXQsIHsKICAgIGljb246ICJzZWFyY2giLAogICAgZnVsbFdpZHRoOiB0cnVlLAogICAgY2xlYXI6IHsKICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMuY2xlYXJGaWx0ZXJzTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDbGVhciBuYW1lIGFuZCB0eXBlIGZpbHRlcnMnCiAgICAgIH0pLAogICAgICAnYXJpYS1sYWJlbCc6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMuY2xlYXJGaWx0ZXJzTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDbGVhciBuYW1lIGFuZCB0eXBlIGZpbHRlcnMnCiAgICAgIH0pLAogICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICgwLCBfbGVuc191aV90ZWxlbWV0cnkudHJhY2tVaUV2ZW50KSgnaW5kZXhwYXR0ZXJuX2ZpbHRlcnNfY2xlYXJlZCcpOwogICAgICAgIGNsZWFyTG9jYWxTdGF0ZSgpOwogICAgICB9CiAgICB9CiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICBjbGFzc05hbWU6ICJldWlGaWVsZFRleHQgZXVpRmllbGRUZXh0LS1mdWxsV2lkdGggbG5zSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWxfX3RleHRGaWVsZCIsCiAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zSW5kZXhQYXR0ZXJuRmllbGRTZWFyY2giLAogICAgcGxhY2Vob2xkZXI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMuZmlsdGVyQnlOYW1lTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2VhcmNoIGZpZWxkIG5hbWVzJywKICAgICAgZGVzY3JpcHRpb246ICdTZWFyY2ggdGhlIGxpc3Qgb2YgZmllbGRzIGluIHRoZSBpbmRleCBwYXR0ZXJuIGZvciB0aGUgcHJvdmlkZWQgdGV4dCcKICAgIH0pLAogICAgdmFsdWU6IGxvY2FsU3RhdGUubmFtZUZpbHRlciwKICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgIHNldExvY2FsU3RhdGUoX29iamVjdFNwcmVhZCh7fSwgbG9jYWxTdGF0ZSwgewogICAgICAgIG5hbWVGaWx0ZXI6IGUudGFyZ2V0LnZhbHVlCiAgICAgIH0pKTsKICAgIH0sCiAgICAiYXJpYS1sYWJlbCI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMuZmlsdGVyQnlOYW1lQXJpYUxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ1NlYXJjaCBmaWVsZHMnCiAgICB9KQogIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsX19maWx0ZXJzV3JhcHBlciIKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUG9wb3ZlciwgewogICAgaWQ6ICJkYXRhUGFuZWxUeXBlRmlsdGVyIiwKICAgIHBhbmVsQ2xhc3NOYW1lOiAiZXVpRmlsdGVyR3JvdXBfX3BvcG92ZXJQYW5lbCIsCiAgICBwYW5lbFBhZGRpbmdTaXplOiAibm9uZSIsCiAgICBhbmNob3JQb3NpdGlvbjogInJpZ2h0RG93biIsCiAgICBkaXNwbGF5OiAiYmxvY2siLAogICAgaXNPcGVuOiBsb2NhbFN0YXRlLmlzVHlwZUZpbHRlck9wZW4sCiAgICBjbG9zZVBvcG92ZXI6IGZ1bmN0aW9uIGNsb3NlUG9wb3ZlcigpIHsKICAgICAgcmV0dXJuIHNldExvY2FsU3RhdGUoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBsb2NhbFN0YXRlLCB7CiAgICAgICAgICBpc1R5cGVGaWx0ZXJPcGVuOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBidXR0b246IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGYWNldEJ1dHRvbiwgewogICAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zSW5kZXhQYXR0ZXJuRmlsdGVyc1RvZ2dsZSIsCiAgICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsX19maWx0ZXJCdXR0b24iLAogICAgICBxdWFudGl0eTogbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmxlbmd0aCwKICAgICAgaWNvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUljb24sIHsKICAgICAgICB0eXBlOiAiZmlsdGVyIgogICAgICB9KSwKICAgICAgaXNTZWxlY3RlZDogbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmxlbmd0aCA/IHRydWUgOiBmYWxzZSwKICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICBzZXRMb2NhbFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcywgewogICAgICAgICAgICBpc1R5cGVGaWx0ZXJPcGVuOiAhbG9jYWxTdGF0ZS5pc1R5cGVGaWx0ZXJPcGVuCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgaWQ6ICJ4cGFjay5sZW5zLmluZGV4UGF0dGVybnMudG9nZ2xlRmlsdGVyc1BvcG92ZXIiLAogICAgICBkZWZhdWx0TWVzc2FnZTogIkZpbHRlciBieSB0eXBlIgogICAgfSkpCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBvcG92ZXJUaXRsZSwgbnVsbCwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJucy5maWx0ZXJCeVR5cGVMYWJlbCcsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnRmlsdGVyIGJ5IHR5cGUnCiAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KEZpeGVkRXVpQ29udGV4dE1lbnVQYW5lbCwgewogICAgd2F0Y2hlZEl0ZW1Qcm9wczogWydpY29uJywgJ2Rpc2FibGVkJ10sCiAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zSW5kZXhQYXR0ZXJuVHlwZUZpbHRlck9wdGlvbnMiLAogICAgaXRlbXM6IGF2YWlsYWJsZUZpZWxkVHlwZXMubWFwKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29udGV4dE1lbnVJdGVtLCB7CiAgICAgICAga2V5OiB0eXBlLAogICAgICAgIGljb246IGxvY2FsU3RhdGUudHlwZUZpbHRlci5pbmNsdWRlcyh0eXBlKSA/ICdjaGVjaycgOiAnZW1wdHknLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJ0eXBlRmlsdGVyLSIuY29uY2F0KHR5cGUpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAoMCwgX2xlbnNfdWlfdGVsZW1ldHJ5LnRyYWNrVWlFdmVudCkoJ2luZGV4cGF0dGVybl90eXBlX2ZpbHRlcl90b2dnbGVkJyk7CiAgICAgICAgICBzZXRMb2NhbFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgICAgICAgdHlwZUZpbHRlcjogbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmluY2x1ZGVzKHR5cGUpID8gbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmZpbHRlcihmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQgIT09IHR5cGU7CiAgICAgICAgICAgICAgfSkgOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGxvY2FsU3RhdGUudHlwZUZpbHRlciksIFt0eXBlXSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2xlbnNfZmllbGRfaWNvbi5MZW5zRmllbGRJY29uLCB7CiAgICAgICAgdHlwZTogdHlwZQogICAgICB9KSwgIiAiLCBmaWVsZFR5cGVOYW1lc1t0eXBlXSk7CiAgICB9KQogIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUG9wb3ZlckZvb3RlciwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVN3aXRjaCwgewogICAgY29tcHJlc3NlZDogdHJ1ZSwKICAgIGNoZWNrZWQ6ICFzaG93RW1wdHlGaWVsZHMsCiAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoKSB7CiAgICAgICgwLCBfbGVuc191aV90ZWxlbWV0cnkudHJhY2tVaUV2ZW50KSgnaW5kZXhwYXR0ZXJuX2V4aXN0ZW5jZV90b2dnbGVkJyk7CiAgICAgIG9uVG9nZ2xlRW1wdHlGaWVsZHMoKTsKICAgIH0sCiAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJucy50b2dnbGVFbXB0eUZpZWxkc1N3aXRjaCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdPbmx5IHNob3cgZmllbGRzIHdpdGggZGF0YScKICAgIH0pLAogICAgImRhdGEtdGVzdC1zdWJqIjogImxuc0VtcHR5RmlsdGVyIgogIH0pKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICBjbGFzc05hbWU6ICJsbnNJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbF9fbGlzdFdyYXBwZXIiLAogICAgcmVmOiBmdW5jdGlvbiByZWYoZWwpIHsKICAgICAgaWYgKGVsICYmICFlbC5kYXRhc2V0LmR5bmFtaWNTY3JvbGwpIHsKICAgICAgICBlbC5kYXRhc2V0LmR5bmFtaWNTY3JvbGwgPSAndHJ1ZSc7CiAgICAgICAgc2V0U2Nyb2xsQ29udGFpbmVyKGVsKTsKICAgICAgfQogICAgfSwKICAgIG9uU2Nyb2xsOiBsYXp5U2Nyb2xsCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgY2xhc3NOYW1lOiAibG5zSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWxfX2xpc3QiCiAgfSwgc3BlY2lhbEZpZWxkcy5tYXAoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZmllbGRfaXRlbS5GaWVsZEl0ZW0sIHsKICAgICAgY29yZTogY29yZSwKICAgICAga2V5OiBmaWVsZC5uYW1lLAogICAgICBpbmRleFBhdHRlcm46IGN1cnJlbnRJbmRleFBhdHRlcm4sCiAgICAgIGZpZWxkOiBmaWVsZCwKICAgICAgaGlnaGxpZ2h0OiBoaWxpZ2h0LAogICAgICBleGlzdHM6IHBhZ2luYXRlZEZpZWxkcy5sZW5ndGggPiAwLAogICAgICBkYXRlUmFuZ2U6IGRhdGVSYW5nZSwKICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICBmaWx0ZXJzOiBmaWx0ZXJzLAogICAgICBoaWRlRGV0YWlsczogdHJ1ZQogICAgfSk7CiAgfSksIHNwZWNpYWxGaWVsZHMubGVuZ3RoID4gMCAmJiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICBzaXplOiAicyIKICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1MYWJlbCwgbnVsbCwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJuLmluZGl2aWR1YWxGaWVsZHNMYWJlbCcsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnSW5kaXZpZHVhbCBmaWVsZHMnCiAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICBzaXplOiAicyIKICB9KSksIHBhZ2luYXRlZEZpZWxkcy5tYXAoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICB2YXIgb3ZlcmFsbEZpZWxkID0gZmllbGRCeU5hbWVbZmllbGQubmFtZV07CiAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZmllbGRfaXRlbS5GaWVsZEl0ZW0sIHsKICAgICAgY29yZTogY29yZSwKICAgICAgaW5kZXhQYXR0ZXJuOiBjdXJyZW50SW5kZXhQYXR0ZXJuLAogICAgICBrZXk6IGZpZWxkLm5hbWUsCiAgICAgIGZpZWxkOiBmaWVsZCwKICAgICAgaGlnaGxpZ2h0OiBoaWxpZ2h0LAogICAgICBleGlzdHM6IG92ZXJhbGxGaWVsZCAmJiAoMCwgX3B1cmVfaGVscGVycy5maWVsZEV4aXN0cykoZXhpc3RpbmdGaWVsZHMsIGN1cnJlbnRJbmRleFBhdHRlcm4udGl0bGUsIG92ZXJhbGxGaWVsZC5uYW1lKSwKICAgICAgZGF0ZVJhbmdlOiBkYXRlUmFuZ2UsCiAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgZmlsdGVyczogZmlsdGVycwogICAgfSk7CiAgfSksIHBhZ2luYXRlZEZpZWxkcy5sZW5ndGggPT09IDAgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgIHNpemU6ICJzIiwKICAgIGNvbG9yOiAid2FybmluZyIsCiAgICB0aXRsZTogc2hvd0VtcHR5RmllbGRzID8gbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmxlbmd0aCB8fCBsb2NhbFN0YXRlLm5hbWVGaWx0ZXIubGVuZ3RoID8gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJucy5ub0ZpbHRlcmVkRmllbGRzTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTm8gZmllbGRzIG1hdGNoIHRoZSBjdXJyZW50IGZpbHRlcnMuIFRyeSBjaGFuZ2luZyB5b3VyIGZpbHRlcnMgb3IgdGltZSByYW5nZS4nCiAgICB9KSA6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMubm9GaWVsZHNMYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdObyBmaWVsZHMgZXhpc3QgaW4gdGhpcyBpbmRleCBwYXR0ZXJuLicKICAgIH0pIDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJucy5lbXB0eUZpZWxkc1dpdGhEYXRhTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTm8gZmllbGRzIGhhdmUgZGF0YSB3aXRoIHRoZSBjdXJyZW50IGZpbHRlcnMgYW5kIHRpbWUgcmFuZ2UuIFRyeSBjaGFuZ2luZyB5b3VyIGZpbHRlcnMgb3IgdGltZSByYW5nZS4nCiAgICB9KQogIH0sICghc2hvd0VtcHR5RmllbGRzIHx8IGxvY2FsU3RhdGUudHlwZUZpbHRlci5sZW5ndGggfHwgbG9jYWxTdGF0ZS5uYW1lRmlsdGVyLmxlbmd0aCkgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICBzaXplOiAieHMiLAogICAgY29sb3I6ICJwcmltYXJ5IiwKICAgIGZsdXNoOiAibGVmdCIsCiAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zRGF0YVBhbmVsU2hvd0FsbEZpZWxkcyIsCiAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAoMCwgX2xlbnNfdWlfdGVsZW1ldHJ5LnRyYWNrVWlFdmVudCkoJ2luZGV4cGF0dGVybl9zaG93X2FsbF9maWVsZHNfY2xpY2tlZCcpOwogICAgICBjbGVhckxvY2FsU3RhdGUoKTsKICAgICAgb25Ub2dnbGVFbXB0eUZpZWxkcyh0cnVlKTsKICAgIH0KICB9LCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5pbmRleFBhdHRlcm5zLnNob3dBbGxGaWVsZHMuYnV0dG9uVGV4dCcsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnU2hvdyBhbGwgZmllbGRzJwogIH0pKSkpKSkpKTsKfTsKCmV4cG9ydHMuSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWwgPSBJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbDsKdmFyIE1lbW9pemVkRGF0YVBhbmVsID0gKDAsIF9yZWFjdC5tZW1vKShJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbCk7CmV4cG9ydHMuTWVtb2l6ZWREYXRhUGFuZWwgPSBNZW1vaXplZERhdGFQYW5lbDs="},null]}