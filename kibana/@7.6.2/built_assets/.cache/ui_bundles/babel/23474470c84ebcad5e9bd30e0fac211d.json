{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/console/public/np_ready/lib/autocomplete/autocomplete.js","dependencies":[{"path":"src/legacy/core_plugins/console/public/np_ready/lib/autocomplete/autocomplete.js","mtime":1585205039204},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuZ2V0Q3VycmVudE1ldGhvZEFuZFRva2VuUGF0aHMgPSBnZXRDdXJyZW50TWV0aG9kQW5kVG9rZW5QYXRoczsKZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIF9icmFjZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiYnJhY2UiKSk7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfa2IgPSByZXF1aXJlKCIuLi9rYi9rYiIpOwoKdmFyIHV0aWxzID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgiLi4vdXRpbHMvdXRpbHMiKSk7Cgp2YXIgX2VuZ2luZSA9IHJlcXVpcmUoIi4vZW5naW5lIik7Cgp2YXIgX2luZGV4ID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL2luZGV4Iik7Cgp2YXIgX2ZhY3RvcmllcyA9IHJlcXVpcmUoIi4uLy4uL2FwcGxpY2F0aW9uL2ZhY3RvcmllcyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKdmFyIExBU1RfRVZBTFVBVEVEX1RPS0VOID0gbnVsbDsKCmZ1bmN0aW9uIGlzVXJsUGFyYW1zVG9rZW4odG9rZW4pIHsKICBzd2l0Y2ggKCh0b2tlbiB8fCB7fSkudHlwZSkgewogICAgY2FzZSAndXJsLnBhcmFtJzoKICAgIGNhc2UgJ3VybC5lcXVhbCc6CiAgICBjYXNlICd1cmwudmFsdWUnOgogICAgY2FzZSAndXJsLnF1ZXN0aW9ubWFyayc6CiAgICBjYXNlICd1cmwuYW1wJzoKICAgICAgcmV0dXJuIHRydWU7CgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlOwogIH0KfQovKioKICogR2V0IHRoZSBtZXRob2QgYW5kIHRva2VuIHBhdGhzIGZvciBhIHNwZWNpZmljIHBvc2l0aW9uIGluIHRoZSBjdXJyZW50IGVkaXRvciBidWZmZXIuCiAqCiAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIHVzZWQgZm9yIGdldHRpbmcgYXV0b2NvbXBsZXRlIGluZm9ybWF0aW9uIG9yIGZvciBnZXR0aW5nIG1vcmUgaW5mb3JtYXRpb24KICogYWJvdXQgdGhlIGVuZHBvaW50IGFzc29jaWF0ZWQgd2l0aCBhdXRvY29tcGxldGUuIEluIGZ1dHVyZSwgdGhlc2UgY29uY2VybnMgc2hvdWxkIGJlIGJldHRlcgogKiBzZXBhcmF0ZWQuCiAqCiAqLwoKCmZ1bmN0aW9uIGdldEN1cnJlbnRNZXRob2RBbmRUb2tlblBhdGhzKGVkaXRvciwgcG9zLCBwYXJzZXIsIGZvcmNlRW5kT2ZVcmwpCi8qIEZsYWcgZm9yIGluZGljYXRpbmcgd2hldGhlciB3ZSB3YW50IHRvIGF2b2lkIGVhcmx5IGVzY2FwZSBvcHRpbWl6YXRpb24uICovCnsKICB2YXIgdG9rZW5JdGVyID0gKDAsIF9mYWN0b3JpZXMuY3JlYXRlVG9rZW5JdGVyYXRvcikoewogICAgZWRpdG9yOiBlZGl0b3IsCiAgICBwb3NpdGlvbjogcG9zCiAgfSk7CiAgdmFyIHN0YXJ0UG9zID0gcG9zOwogIHZhciBib2R5VG9rZW5QYXRoID0gW107CiAgdmFyIHJldCA9IHt9OwogIHZhciBTVEFURVMgPSB7CiAgICBsb29raW5nX2Zvcl9rZXk6IDAsCiAgICAvLyBsb29raW5nIGZvciBhIGtleSBidXQgd2l0aG91dCBqdW1waW5nIG92ZXIgYW55dGhpbmcgYnV0IHdoaXRlIHNwYWNlIGFuZCBjb2xvbi4KICAgIGxvb2tpbmdfZm9yX3Njb3BlX3N0YXJ0OiAxLAogICAgLy8gc2tpcCBldmVyeXRoaW5nIHVudGlsIHNjb3BlIHN0YXJ0CiAgICBzdGFydDogMwogIH07CiAgdmFyIHN0YXRlID0gU1RBVEVTLnN0YXJ0OyAvLyBpbml0aWFsaXphdGlvbiBwcm9ibGVtcyAtCgogIHZhciB0ID0gdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlbigpOwoKICBpZiAodCkgewogICAgaWYgKHN0YXJ0UG9zLmNvbHVtbiA9PT0gMSkgewogICAgICAvLyBpZiB3ZSBhcmUgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgbGluZSwgdGhlIGN1cnJlbnQgdG9rZW4gaXMgdGhlIG9uZSBhZnRlciBjdXJzb3IsIG5vdCBiZWZvcmUgd2hpY2gKICAgICAgLy8gZGV2aWF0ZXMgZnJvbSB0aGUgc3RhbmRhcmQuCiAgICAgIHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7CiAgICAgIHN0YXRlID0gU1RBVEVTLmxvb2tpbmdfZm9yX3Njb3BlX3N0YXJ0OwogICAgfQogIH0gZWxzZSB7CiAgICBpZiAoc3RhcnRQb3MuY29sdW1uID09PSAxKSB7CiAgICAgIC8vIGVtcHR5IGxpbmVzIGRvIG5vIGhhdmUgdG9rZW5zLCBtb3ZlIG9uZSBiYWNrCiAgICAgIHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7CiAgICAgIHN0YXRlID0gU1RBVEVTLnN0YXJ0OwogICAgfQogIH0KCiAgdmFyIHdhbGtlZFNvbWVCb2R5ID0gZmFsc2U7IC8vIGNsaW1iIG9uZSBzY29wZSBhdCBhIHRpbWUgYW5kIGdldCB0aGUgc2NvcGUga2V5CgogIGZvciAoOyB0ICYmIHQudHlwZS5pbmRleE9mKCd1cmwnKSA9PT0gLTEgJiYgdC50eXBlICE9PSAnbWV0aG9kJzsgdCA9IHRva2VuSXRlci5zdGVwQmFja3dhcmQoKSkgewogICAgaWYgKHQudHlwZSAhPT0gJ3doaXRlc3BhY2UnKSB7CiAgICAgIHdhbGtlZFNvbWVCb2R5ID0gdHJ1ZTsKICAgIH0gLy8gbWFya3Mgd2Ugc2F3IHNvbWV0aGluZwoKCiAgICBzd2l0Y2ggKHQudHlwZSkgewogICAgICBjYXNlICd2YXJpYWJsZSc6CiAgICAgICAgaWYgKHN0YXRlID09PSBTVEFURVMubG9va2luZ19mb3Jfa2V5KSB7CiAgICAgICAgICBib2R5VG9rZW5QYXRoLnVuc2hpZnQodC52YWx1ZS50cmltKCkucmVwbGFjZSgvIi9nLCAnJykpOwogICAgICAgIH0KCiAgICAgICAgc3RhdGUgPSBTVEFURVMubG9va2luZ19mb3Jfc2NvcGVfc3RhcnQ7IC8vIHNraXAgZXZlcnl0aGluZyB1bnRpbCB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgc2NvcGUKCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdwYXJlbi5scGFyZW4nOgogICAgICAgIGJvZHlUb2tlblBhdGgudW5zaGlmdCh0LnZhbHVlKTsKCiAgICAgICAgaWYgKHN0YXRlID09PSBTVEFURVMubG9va2luZ19mb3Jfc2NvcGVfc3RhcnQpIHsKICAgICAgICAgIC8vIGZvdW5kIGl0LiBnbyBsb29rIGZvciB0aGUgcmVsZXZhbnQga2V5CiAgICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9rZXk7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3BhcmVuLnJwYXJlbic6CiAgICAgICAgLy8gcmVzZXQgaGUgc2VhcmNoIGZvciBrZXkKICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9zY29wZV9zdGFydDsgLy8gYW5kIGlnbm9yZSB0aGlzIHN1YiBzY29wZS4uCgogICAgICAgIHZhciBwYXJlbkNvdW50ID0gMTsKICAgICAgICB0ID0gdG9rZW5JdGVyLnN0ZXBCYWNrd2FyZCgpOwoKICAgICAgICB3aGlsZSAodCAmJiBwYXJlbkNvdW50ID4gMCkgewogICAgICAgICAgc3dpdGNoICh0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAncGFyZW4ubHBhcmVuJzoKICAgICAgICAgICAgICBwYXJlbkNvdW50LS07CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdwYXJlbi5ycGFyZW4nOgogICAgICAgICAgICAgIHBhcmVuQ291bnQrKzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocGFyZW5Db3VudCA+IDApIHsKICAgICAgICAgICAgdCA9IHRva2VuSXRlci5zdGVwQmFja3dhcmQoKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghdCkgewogICAgICAgICAgLy8gb29wcyB3ZSBydW4gb3V0Li4gd2UgZG9uJ3Qga25vdyB3aGF0J3MgdXAgcmV0dXJuIG51bGw7CiAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKCiAgICAgIGNhc2UgJ3B1bmN0dWF0aW9uLmVuZF90cmlwbGVfcXVvdGUnOgogICAgICAgIC8vIHJlc2V0IHRoZSBzZWFyY2ggZm9yIGtleQogICAgICAgIHN0YXRlID0gU1RBVEVTLmxvb2tpbmdfZm9yX3Njb3BlX3N0YXJ0OwoKICAgICAgICBmb3IgKHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7IHQ7IHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCkpIHsKICAgICAgICAgIGlmICh0LnR5cGUgPT09ICdwdW5jdHVhdGlvbi5zdGFydF90cmlwbGVfcXVvdGUnKSB7CiAgICAgICAgICAgIHQgPSB0b2tlbkl0ZXIuc3RlcEJhY2t3YXJkKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCF0KSB7CiAgICAgICAgICAvLyBvb3BzIHdlIHJ1biBvdXQuLiB3ZSBkb24ndCBrbm93IHdoYXQncyB1cCByZXR1cm4gbnVsbDsKICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICB9CgogICAgICAgIGNvbnRpbnVlOwoKICAgICAgY2FzZSAncHVuY3R1YXRpb24uc3RhcnRfdHJpcGxlX3F1b3RlJzoKICAgICAgICBpZiAoc3RhdGUgPT09IFNUQVRFUy5zdGFydCkgewogICAgICAgICAgc3RhdGUgPSBTVEFURVMubG9va2luZ19mb3Jfa2V5OwogICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IFNUQVRFUy5sb29raW5nX2Zvcl9rZXkpIHsKICAgICAgICAgIHN0YXRlID0gU1RBVEVTLmxvb2tpbmdfZm9yX3Njb3BlX3N0YXJ0OwogICAgICAgIH0KCiAgICAgICAgYm9keVRva2VuUGF0aC51bnNoaWZ0KCciIiInKTsKICAgICAgICBjb250aW51ZTsKCiAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgIGNhc2UgJ2NvbnN0YW50Lm51bWVyaWMnOgogICAgICBjYXNlICdjb25zdGFudC5sYW5ndWFnZS5ib29sZWFuJzoKICAgICAgY2FzZSAndGV4dCc6CiAgICAgICAgaWYgKHN0YXRlID09PSBTVEFURVMuc3RhcnQpIHsKICAgICAgICAgIHN0YXRlID0gU1RBVEVTLmxvb2tpbmdfZm9yX2tleTsKICAgICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSBTVEFURVMubG9va2luZ19mb3Jfa2V5KSB7CiAgICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9zY29wZV9zdGFydDsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29tbWEnOgogICAgICAgIGlmIChzdGF0ZSA9PT0gU1RBVEVTLnN0YXJ0KSB7CiAgICAgICAgICBzdGF0ZSA9IFNUQVRFUy5sb29raW5nX2Zvcl9zY29wZV9zdGFydDsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29sb24nOgogICAgICBjYXNlICd3aGl0ZXNwYWNlJzoKICAgICAgICBpZiAoc3RhdGUgPT09IFNUQVRFUy5zdGFydCkgewogICAgICAgICAgc3RhdGUgPSBTVEFURVMubG9va2luZ19mb3Jfa2V5OwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CiAgICAgIC8vIHNraXAgd2hpdGUgc3BhY2UKICAgIH0KICB9CgogIGlmICh3YWxrZWRTb21lQm9keSAmJiAoIWJvZHlUb2tlblBhdGggfHwgYm9keVRva2VuUGF0aC5sZW5ndGggPT09IDApICYmICFmb3JjZUVuZE9mVXJsKSB7CiAgICAvLyB3ZSBoYWQgc29tZSBjb250ZW50IGFuZCBzdGlsbCBubyBwYXRoIC0+IHRoZSBjdXJzb3IgaXMgcG9zaXRpb24gYWZ0ZXIgYSBjbG9zZWQgYm9keSAtPiBubyBhdXRvIGNvbXBsZXRlCiAgICByZXR1cm4ge307CiAgfQoKICByZXQudXJsVG9rZW5QYXRoID0gW107CgogIGlmICh0b2tlbkl0ZXIuZ2V0Q3VycmVudFBvc2l0aW9uKCkubGluZU51bWJlciA9PT0gc3RhcnRQb3MubGluZU51bWJlcikgewogICAgaWYgKHQgJiYgKHQudHlwZSA9PT0gJ3VybC5wYXJ0JyB8fCB0LnR5cGUgPT09ICd1cmwucGFyYW0nIHx8IHQudHlwZSA9PT0gJ3VybC52YWx1ZScpKSB7CiAgICAgIC8vIHdlIGFyZSBmb3JjaW5nIHRoZSBlbmQgb2YgdGhlIHVybCBmb3IgdGhlIHB1cnBvc2VzIG9mIGRldGVybWluaW5nIGFuIGVuZHBvaW50CiAgICAgIGlmIChmb3JjZUVuZE9mVXJsICYmIHQudHlwZSA9PT0gJ3VybC5wYXJ0JykgewogICAgICAgIHJldC51cmxUb2tlblBhdGgucHVzaCh0LnZhbHVlKTsKICAgICAgICByZXQudXJsVG9rZW5QYXRoLnB1c2goX2luZGV4LlVSTF9QQVRIX0VORF9NQVJLRVIpOwogICAgICB9IC8vIHdlIGFyZSBvbiB0aGUgc2FtZSBsaW5lIGFzIGN1cnNvciBhbmQgZGVhbGluZyB3aXRoIGEgdXJsLiBDdXJyZW50IHRva2VuIGlzIG5vdCBwYXJ0IG9mIHRoZSBjb250ZXh0CgoKICAgICAgdCA9IHRva2VuSXRlci5zdGVwQmFja3dhcmQoKTsgLy8gVGhpcyB3aWxsIGZvcmNlIG1ldGhvZCBwYXJzaW5nCgogICAgICB3aGlsZSAodC50eXBlID09PSAnd2hpdGVzcGFjZScpIHsKICAgICAgICB0ID0gdG9rZW5JdGVyLnN0ZXBCYWNrd2FyZCgpOwogICAgICB9CiAgICB9CgogICAgYm9keVRva2VuUGF0aCA9IG51bGw7IC8vIG5vIG5vdCBvbiBhIGJvZHkgbGluZS4KICB9CgogIHJldC5ib2R5VG9rZW5QYXRoID0gYm9keVRva2VuUGF0aDsKICByZXQudXJsUGFyYW1zVG9rZW5QYXRoID0gbnVsbDsKICByZXQucmVxdWVzdFN0YXJ0Um93ID0gdG9rZW5JdGVyLmdldEN1cnJlbnRQb3NpdGlvbigpLmxpbmVOdW1iZXI7CiAgdmFyIGN1clVybFBhcnQ7CgogIHdoaWxlICh0ICYmIGlzVXJsUGFyYW1zVG9rZW4odCkpIHsKICAgIHN3aXRjaCAodC50eXBlKSB7CiAgICAgIGNhc2UgJ3VybC52YWx1ZSc6CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY3VyVXJsUGFydCkpIHsKICAgICAgICAgIGN1clVybFBhcnQudW5zaGlmdCh0LnZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKGN1clVybFBhcnQpIHsKICAgICAgICAgIGN1clVybFBhcnQgPSBbdC52YWx1ZSwgY3VyVXJsUGFydF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1clVybFBhcnQgPSB0LnZhbHVlOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICd1cmwuY29tbWEnOgogICAgICAgIGlmICghY3VyVXJsUGFydCkgewogICAgICAgICAgY3VyVXJsUGFydCA9IFtdOwogICAgICAgIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkoY3VyVXJsUGFydCkpIHsKICAgICAgICAgIGN1clVybFBhcnQgPSBbY3VyVXJsUGFydF07CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3VybC5wYXJhbSc6CiAgICAgICAgdmFyIHYgPSBjdXJVcmxQYXJ0OwogICAgICAgIGN1clVybFBhcnQgPSB7fTsKICAgICAgICBjdXJVcmxQYXJ0W3QudmFsdWVdID0gdjsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3VybC5hbXAnOgogICAgICBjYXNlICd1cmwucXVlc3Rpb25tYXJrJzoKICAgICAgICBpZiAoIXJldC51cmxQYXJhbXNUb2tlblBhdGgpIHsKICAgICAgICAgIHJldC51cmxQYXJhbXNUb2tlblBhdGggPSBbXTsKICAgICAgICB9CgogICAgICAgIHJldC51cmxQYXJhbXNUb2tlblBhdGgudW5zaGlmdChjdXJVcmxQYXJ0IHx8IHt9KTsKICAgICAgICBjdXJVcmxQYXJ0ID0gbnVsbDsKICAgICAgICBicmVhazsKICAgIH0KCiAgICB0ID0gdG9rZW5JdGVyLnN0ZXBCYWNrd2FyZCgpOwogIH0KCiAgY3VyVXJsUGFydCA9IG51bGw7CgogIHdoaWxlICh0ICYmIHQudHlwZS5pbmRleE9mKCd1cmwnKSAhPT0gLTEpIHsKICAgIHN3aXRjaCAodC50eXBlKSB7CiAgICAgIGNhc2UgJ3VybC5wYXJ0JzoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjdXJVcmxQYXJ0KSkgewogICAgICAgICAgY3VyVXJsUGFydC51bnNoaWZ0KHQudmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoY3VyVXJsUGFydCkgewogICAgICAgICAgY3VyVXJsUGFydCA9IFt0LnZhbHVlLCBjdXJVcmxQYXJ0XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VyVXJsUGFydCA9IHQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3VybC5jb21tYSc6CiAgICAgICAgaWYgKCFjdXJVcmxQYXJ0KSB7CiAgICAgICAgICBjdXJVcmxQYXJ0ID0gW107CiAgICAgICAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShjdXJVcmxQYXJ0KSkgewogICAgICAgICAgY3VyVXJsUGFydCA9IFtjdXJVcmxQYXJ0XTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAndXJsLnNsYXNoJzoKICAgICAgICBpZiAoY3VyVXJsUGFydCkgewogICAgICAgICAgcmV0LnVybFRva2VuUGF0aC51bnNoaWZ0KGN1clVybFBhcnQpOwogICAgICAgICAgY3VyVXJsUGFydCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKICAgIH0KCiAgICB0ID0gcGFyc2VyLnByZXZOb25FbXB0eVRva2VuKHRva2VuSXRlcik7CiAgfQoKICBpZiAoY3VyVXJsUGFydCkgewogICAgcmV0LnVybFRva2VuUGF0aC51bnNoaWZ0KGN1clVybFBhcnQpOwogIH0KCiAgaWYgKCFyZXQuYm9keVRva2VuUGF0aCAmJiAhcmV0LnVybFBhcmFtc1Rva2VuUGF0aCkgewogICAgaWYgKHJldC51cmxUb2tlblBhdGgubGVuZ3RoID4gMCkgewogICAgICAvLyAgIC8vIHN0YXJ0ZWQgb24gdGhlIHVybCwgZmlyc3QgdG9rZW4gaXMgY3VycmVudCB0b2tlbgogICAgICByZXQub3RoZXJUb2tlblZhbHVlcyA9IHJldC51cmxUb2tlblBhdGhbMF07CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIG1hcmsgdGhlIHVybCBhcyBjb21wbGV0ZWQuCiAgICByZXQudXJsVG9rZW5QYXRoLnB1c2goX2luZGV4LlVSTF9QQVRIX0VORF9NQVJLRVIpOwogIH0KCiAgaWYgKHQgJiYgdC50eXBlID09PSAnbWV0aG9kJykgewogICAgcmV0Lm1ldGhvZCA9IHQudmFsdWU7CiAgfQoKICByZXR1cm4gcmV0Owp9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQoKCmZ1bmN0aW9uIF9kZWZhdWx0KF9yZWYpIHsKICB2YXIgZWRpdG9yID0gX3JlZi5jb3JlRWRpdG9yLAogICAgICBwYXJzZXIgPSBfcmVmLnBhcnNlcjsKCiAgZnVuY3Rpb24gaXNVcmxQYXRoVG9rZW4odG9rZW4pIHsKICAgIHN3aXRjaCAoKHRva2VuIHx8IHt9KS50eXBlKSB7CiAgICAgIGNhc2UgJ3VybC5zbGFzaCc6CiAgICAgIGNhc2UgJ3VybC5jb21tYSc6CiAgICAgIGNhc2UgJ3VybC5wYXJ0JzoKICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYWRkTWV0YVRvVGVybXNMaXN0KGxpc3QsIG1ldGEsIHRlbXBsYXRlKSB7CiAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0Lm1hcChsaXN0LCBmdW5jdGlvbiAodCkgewogICAgICBpZiAoX3R5cGVvZih0KSAhPT0gJ29iamVjdCcpIHsKICAgICAgICB0ID0gewogICAgICAgICAgbmFtZTogdAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuZGVmYXVsdHModCwgewogICAgICAgIG1ldGE6IG1ldGEsCiAgICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlCiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBhcHBseVRlcm0odGVybSkgewogICAgdmFyIGNvbnRleHQgPSB0ZXJtLmNvbnRleHQ7IC8vIG1ha2Ugc3VyZSB3ZSBnZXQgdXAgdG8gZGF0ZSByZXBsYWNlbWVudCBpbmZvLgoKICAgIGFkZFJlcGxhY2VtZW50SW5mb1RvQ29udGV4dChjb250ZXh0LCBlZGl0b3IuZ2V0Q3VycmVudFBvc2l0aW9uKCksIHRlcm0uaW5zZXJ0VmFsdWUpOwogICAgdmFyIHRlcm1Bc1N0cmluZzsKCiAgICBpZiAoY29udGV4dC5hdXRvQ29tcGxldGVUeXBlID09PSAnYm9keScpIHsKICAgICAgdGVybUFzU3RyaW5nID0gdHlwZW9mIHRlcm0uaW5zZXJ0VmFsdWUgPT09ICdzdHJpbmcnID8gJyInICsgdGVybS5pbnNlcnRWYWx1ZSArICciJyA6IHRlcm0uaW5zZXJ0VmFsdWUgKyAnJzsKCiAgICAgIGlmICh0ZXJtLmluc2VydFZhbHVlID09PSAnWycgfHwgdGVybS5pbnNlcnRWYWx1ZSA9PT0gJ3snKSB7CiAgICAgICAgdGVybUFzU3RyaW5nID0gJyc7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRlcm1Bc1N0cmluZyA9IHRlcm0uaW5zZXJ0VmFsdWUgKyAnJzsKICAgIH0KCiAgICB2YXIgdmFsdWVUb0luc2VydCA9IHRlcm1Bc1N0cmluZzsKICAgIHZhciB0ZW1wbGF0ZUluc2VydGVkID0gZmFsc2U7CgogICAgaWYgKGNvbnRleHQuYWRkVGVtcGxhdGUgJiYgIV9sb2Rhc2guZGVmYXVsdC5pc1VuZGVmaW5lZCh0ZXJtLnRlbXBsYXRlKSAmJiAhX2xvZGFzaC5kZWZhdWx0LmlzTnVsbCh0ZXJtLnRlbXBsYXRlKSkgewogICAgICB2YXIgaW5kZW50ZWRUZW1wbGF0ZUxpbmVzOyAvLyBJbiBvcmRlciB0byBhbGxvdyB0cmlwbGUgcXVvdGVkIHN0cmluZ3MgaW4gdGVtcGxhdGUgY29tcGxldGlvbiB3ZSBjaGVjayB0aGUgYF9fcmF3X2AKICAgICAgLy8gYXR0cmlidXRlIHRvIGRldGVybWluZSB3aGV0aGVyIHRoaXMgdGVtcGxhdGUgc2hvdWxkIGdvIHRocm91Z2ggSlNPTiBmb3JtYXR0aW5nLgoKICAgICAgaWYgKHRlcm0udGVtcGxhdGUuX19yYXcgJiYgdGVybS50ZW1wbGF0ZS52YWx1ZSkgewogICAgICAgIGluZGVudGVkVGVtcGxhdGVMaW5lcyA9IHRlcm0udGVtcGxhdGUudmFsdWUuc3BsaXQoJ1xuJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW5kZW50ZWRUZW1wbGF0ZUxpbmVzID0gdXRpbHMuanNvblRvU3RyaW5nKHRlcm0udGVtcGxhdGUsIHRydWUpLnNwbGl0KCdcbicpOwogICAgICB9CgogICAgICB2YXIgY3VycmVudEluZGVudGF0aW9uID0gZWRpdG9yLmdldExpbmVWYWx1ZShjb250ZXh0LnJhbmdlVG9SZXBsYWNlLnN0YXJ0LmxpbmVOdW1iZXIpOwogICAgICBjdXJyZW50SW5kZW50YXRpb24gPSBjdXJyZW50SW5kZW50YXRpb24ubWF0Y2goL15ccyovKVswXTsKCiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgaW5kZW50ZWRUZW1wbGF0ZUxpbmVzLmxlbmd0aDsgaSsrIC8vIHNraXAgZmlyc3QgbGluZQogICAgICApIHsKICAgICAgICBpbmRlbnRlZFRlbXBsYXRlTGluZXNbaV0gPSBjdXJyZW50SW5kZW50YXRpb24gKyBpbmRlbnRlZFRlbXBsYXRlTGluZXNbaV07CiAgICAgIH0KCiAgICAgIHZhbHVlVG9JbnNlcnQgKz0gJzogJyArIGluZGVudGVkVGVtcGxhdGVMaW5lcy5qb2luKCdcbicpOwogICAgICB0ZW1wbGF0ZUluc2VydGVkID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHRlbXBsYXRlSW5zZXJ0ZWQgPSB0cnVlOwoKICAgICAgaWYgKHRlcm0udmFsdWUgPT09ICdbJykgewogICAgICAgIHZhbHVlVG9JbnNlcnQgKz0gJ1tdJzsKICAgICAgfSBlbHNlIGlmICh0ZXJtLnZhbHVlID09PSAneycpIHsKICAgICAgICB2YWx1ZVRvSW5zZXJ0ICs9ICd7fSc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGVtcGxhdGVJbnNlcnRlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogICAgdmFsdWVUb0luc2VydCA9IGNvbnRleHQucHJlZml4VG9BZGQgKyB2YWx1ZVRvSW5zZXJ0ICsgY29udGV4dC5zdWZmaXhUb0FkZDsgLy8gZGlzYWJsZSBsaXN0ZW5pbmcgdG8gdGhlIGNoYW5nZXMgd2UgYXJlIG1ha2luZy4KCiAgICBlZGl0b3Iub2ZmKCdjaGFuZ2VTZWxlY3Rpb24nLCBlZGl0b3JDaGFuZ2VMaXN0ZW5lcik7CgogICAgaWYgKGNvbnRleHQucmFuZ2VUb1JlcGxhY2Uuc3RhcnQuY29sdW1uICE9PSBjb250ZXh0LnJhbmdlVG9SZXBsYWNlLmVuZC5jb2x1bW4pIHsKICAgICAgZWRpdG9yLnJlcGxhY2UoY29udGV4dC5yYW5nZVRvUmVwbGFjZSwgdmFsdWVUb0luc2VydCk7CiAgICB9IGVsc2UgewogICAgICBlZGl0b3IuaW5zZXJ0KHZhbHVlVG9JbnNlcnQpOwogICAgfQoKICAgIGVkaXRvci5jbGVhclNlbGVjdGlvbigpOyAvLyBmb3Igc29tZSByZWFzb24gdGhlIGFib3ZlIGNoYW5nZXMgc2VsZWN0aW9uCiAgICAvLyBnbyBiYWNrIHRvIHNlZSB3aGV0aGVyIHdlIGhhdmUgb25lIG9mICggOiB7ICYgWyBkbyBub3QgcmVxdWlyZSBhIGNvbW1hLiBBbGwgdGhlIHJlc3QgZG8uCgogICAgdmFyIG5ld1BvcyA9IHsKICAgICAgbGluZU51bWJlcjogY29udGV4dC5yYW5nZVRvUmVwbGFjZS5zdGFydC5saW5lTnVtYmVyLAogICAgICBjb2x1bW46IGNvbnRleHQucmFuZ2VUb1JlcGxhY2Uuc3RhcnQuY29sdW1uICsgdGVybUFzU3RyaW5nLmxlbmd0aCArIGNvbnRleHQucHJlZml4VG9BZGQubGVuZ3RoICsgKHRlbXBsYXRlSW5zZXJ0ZWQgPyAwIDogY29udGV4dC5zdWZmaXhUb0FkZC5sZW5ndGgpCiAgICB9OwogICAgdmFyIHRva2VuSXRlciA9ICgwLCBfZmFjdG9yaWVzLmNyZWF0ZVRva2VuSXRlcmF0b3IpKHsKICAgICAgZWRpdG9yOiBlZGl0b3IsCiAgICAgIHBvc2l0aW9uOiBuZXdQb3MKICAgIH0pOwoKICAgIGlmIChjb250ZXh0LmF1dG9Db21wbGV0ZVR5cGUgPT09ICdib2R5JykgewogICAgICAvLyBsb29rIGZvciB0aGUgbmV4dCBwbGFjZSBzdGFuZCwganVzdCBhZnRlciBhIGNvbW1hLCB7CiAgICAgIHZhciBub25FbXB0eVRva2VuID0gcGFyc2VyLm5leHROb25FbXB0eVRva2VuKHRva2VuSXRlcik7CgogICAgICBzd2l0Y2ggKG5vbkVtcHR5VG9rZW4gPyBub25FbXB0eVRva2VuLnR5cGUgOiAnTk9UT0tFTicpIHsKICAgICAgICBjYXNlICdwYXJlbi5ycGFyZW4nOgogICAgICAgICAgbmV3UG9zID0gdG9rZW5JdGVyLmdldEN1cnJlbnRQb3NpdGlvbigpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ3B1bmN0dWF0aW9uLmNvbG9uJzoKICAgICAgICAgIG5vbkVtcHR5VG9rZW4gPSBwYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKCiAgICAgICAgICBpZiAoKG5vbkVtcHR5VG9rZW4gfHwge30pLnR5cGUgPT09ICdwYXJlbi5scGFyZW4nKSB7CiAgICAgICAgICAgIG5vbkVtcHR5VG9rZW4gPSBwYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKICAgICAgICAgICAgbmV3UG9zID0gdG9rZW5JdGVyLmdldEN1cnJlbnRQb3NpdGlvbigpOwoKICAgICAgICAgICAgaWYgKG5vbkVtcHR5VG9rZW4gJiYgbm9uRW1wdHlUb2tlbi52YWx1ZS5pbmRleE9mKCciJykgPT09IDApIHsKICAgICAgICAgICAgICBuZXdQb3MuY29sdW1uKys7CiAgICAgICAgICAgIH0gLy8gZG9uJ3Qgc3RhbmQgb24gIgoKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAncGFyZW4ubHBhcmVuJzoKICAgICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb21tYSc6CiAgICAgICAgICB0b2tlbkl0ZXIuc3RlcEZvcndhcmQoKTsKICAgICAgICAgIG5ld1BvcyA9IHRva2VuSXRlci5nZXRDdXJyZW50UG9zaXRpb24oKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICBlZGl0b3IubW92ZUN1cnNvclRvUG9zaXRpb24obmV3UG9zKTsKICAgIH0gLy8gcmUtZW5hYmxlIGxpc3RlbmluZyB0byB0eXBpbmcKCgogICAgZWRpdG9yLm9uKCdjaGFuZ2VTZWxlY3Rpb24nLCBlZGl0b3JDaGFuZ2VMaXN0ZW5lcik7CiAgfQoKICBmdW5jdGlvbiBnZXRBdXRvQ29tcGxldGVDb250ZXh0KGN0eEVkaXRvciwgcG9zKSB7CiAgICAvLyBkZWR1Y2VzIGFsbCB0aGUgcGFyYW1ldGVycyBuZWVkIHRvIHBvc2l0aW9uIGFuZCBpbnNlcnQgdGhlIGF1dG8gY29tcGxldGUKICAgIHZhciBjb250ZXh0ID0gewogICAgICBhdXRvQ29tcGxldGVTZXQ6IG51bGwsCiAgICAgIC8vIGluc3RydWN0aW9ucyBmb3Igd2hhdCBjYW4gYmUgaGVyZQogICAgICBlbmRwb2ludDogbnVsbCwKICAgICAgdXJsUGF0aDogbnVsbCwKICAgICAgbWV0aG9kOiBudWxsLAogICAgICBhY3RpdmVTY2hlbWU6IG51bGwsCiAgICAgIGVkaXRvcjogY3R4RWRpdG9yCiAgICB9OyAvLyAgY29udGV4dC51cGRhdGVkRm9yVG9rZW4gPSBzZXNzaW9uLmdldFRva2VuQXQocG9zLnJvdywgcG9zLmNvbHVtbik7CiAgICAvLwogICAgLy8gIGlmICghY29udGV4dC51cGRhdGVkRm9yVG9rZW4pCiAgICAvLyAgICBjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbiA9IHsgdmFsdWU6ICIiLCBzdGFydDogcG9zLmNvbHVtbiB9OyAvLyBlbXB0eSBsaW5lCiAgICAvLwogICAgLy8gIGNvbnRleHQudXBkYXRlZEZvclRva2VuLnJvdyA9IHBvcy5yb3c7IC8vIGV4dGVuZAoKICAgIGNvbnRleHQuYXV0b0NvbXBsZXRlVHlwZSA9IGdldEF1dG9Db21wbGV0ZVR5cGUocG9zKTsKCiAgICBzd2l0Y2ggKGNvbnRleHQuYXV0b0NvbXBsZXRlVHlwZSkgewogICAgICBjYXNlICdwYXRoJzoKICAgICAgICBhZGRQYXRoQXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQsIHBvcyk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICd1cmxfcGFyYW1zJzoKICAgICAgICBhZGRVcmxQYXJhbXNBdXRvQ29tcGxldGVTZXRUb0NvbnRleHQoY29udGV4dCwgcG9zKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ21ldGhvZCc6CiAgICAgICAgYWRkTWV0aG9kQXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYm9keSc6CiAgICAgICAgYWRkQm9keUF1dG9Db21wbGV0ZVNldFRvQ29udGV4dChjb250ZXh0LCBwb3MpOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBpZiAoIWNvbnRleHQuYXV0b0NvbXBsZXRlU2V0KSB7CiAgICAgIHJldHVybiBudWxsOyAvLyBub3RoaW5nIHRvIGRvLi4KICAgIH0KCiAgICBhZGRSZXBsYWNlbWVudEluZm9Ub0NvbnRleHQoY29udGV4dCwgcG9zKTsKICAgIGNvbnRleHQuY3JlYXRlZFdpdGhUb2tlbiA9IF9sb2Rhc2guZGVmYXVsdC5jbG9uZShjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbik7CiAgICByZXR1cm4gY29udGV4dDsKICB9CgogIGZ1bmN0aW9uIGdldEF1dG9Db21wbGV0ZVR5cGUocG9zKSB7CiAgICAvLyByZXR1cm4gIm1ldGhvZCIsICJwYXRoIiBvciAiYm9keSIgdG8gZGV0ZXJtaW5lIGF1dG8gY29tcGxldGUgdHlwZS4KICAgIHZhciByb3dNb2RlID0gcGFyc2VyLmdldFJvd1BhcnNlTW9kZSgpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQoKICAgIGlmIChyb3dNb2RlICYgcGFyc2VyLk1PREUuSU5fUkVRVUVTVCkgewogICAgICByZXR1cm4gJ2JvZHknOwogICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQoKCiAgICBpZiAocm93TW9kZSAmIHBhcnNlci5NT0RFLlJFUVVFU1RfU1RBUlQpIHsKICAgICAgLy8gb24gdXJsIHBhdGgsIHVybCBwYXJhbXMgb3IgbWV0aG9kLgogICAgICB2YXIgdG9rZW5JdGVyID0gKDAsIF9mYWN0b3JpZXMuY3JlYXRlVG9rZW5JdGVyYXRvcikoewogICAgICAgIGVkaXRvcjogZWRpdG9yLAogICAgICAgIHBvc2l0aW9uOiBwb3MKICAgICAgfSk7CiAgICAgIHZhciB0ID0gdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlbigpOwoKICAgICAgd2hpbGUgKHQudHlwZSA9PT0gJ3VybC5jb21tYScpIHsKICAgICAgICB0ID0gdG9rZW5JdGVyLnN0ZXBCYWNrd2FyZCgpOwogICAgICB9CgogICAgICBzd2l0Y2ggKHQudHlwZSkgewogICAgICAgIGNhc2UgJ21ldGhvZCc6CiAgICAgICAgICByZXR1cm4gJ21ldGhvZCc7CgogICAgICAgIGNhc2UgJ3doaXRlc3BhY2UnOgogICAgICAgICAgdCA9IHBhcnNlci5wcmV2Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwoKICAgICAgICAgIHN3aXRjaCAoKHQgfHwge30pLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnbWV0aG9kJzoKICAgICAgICAgICAgICAvLyB3ZSBtb3ZlZCBvbmUgYmFjawogICAgICAgICAgICAgIHJldHVybiAncGF0aCc7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGlmIChpc1VybFBhdGhUb2tlbih0KSkgewogICAgICAgICAgICAgICAgcmV0dXJuICdwYXRoJzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChpc1VybFBhcmFtc1Rva2VuKHQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJ3VybF9wYXJhbXMnOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAoaXNVcmxQYXRoVG9rZW4odCkpIHsKICAgICAgICAgICAgcmV0dXJuICdwYXRoJzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaXNVcmxQYXJhbXNUb2tlbih0KSkgewogICAgICAgICAgICByZXR1cm4gJ3VybF9wYXJhbXMnOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9IC8vIGFmdGVyIHN0YXJ0IHRvIGF2b2lkIHNpbmdsZSBsaW5lIHVybCBvbmx5IHJlcXVlc3RzCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQoKCiAgICBpZiAocm93TW9kZSAmIHBhcnNlci5NT0RFLlJFUVVFU1RfRU5EKSB7CiAgICAgIHJldHVybiAnYm9keSc7CiAgICB9IC8vIGluIGJldHdlZW4gcmVxdWVzdCBvbiBhbiBlbXB0eQoKCiAgICBpZiAoZWRpdG9yLmdldExpbmVWYWx1ZShwb3MubGluZU51bWJlcikudHJpbSgpID09PSAnJykgewogICAgICAvLyBjaGVjayBpZiB0aGUgcHJldmlvdXMgbGluZSBpcyBhIHNpbmdsZSBsaW5lIGJlZ2lubmluZyBvZiBhIG5ldyByZXF1ZXN0CiAgICAgIHJvd01vZGUgPSBwYXJzZXIuZ2V0Um93UGFyc2VNb2RlKHBvcy5saW5lTnVtYmVyIC0gMSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlCgogICAgICBpZiAoIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlCiAgICAgIHJvd01vZGUgJiBwYXJzZXIuTU9ERS5SRVFVRVNUX1NUQVJUICYmIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1iaXR3aXNlCiAgICAgIHJvd01vZGUgJiBwYXJzZXIuTU9ERS5SRVFVRVNUX0VORCkgewogICAgICAgIHJldHVybiAnYm9keSc7CiAgICAgIH0gLy8gby53IHN1Z2dlc3QgYSBtZXRob2QKCgogICAgICByZXR1cm4gJ21ldGhvZCc7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmdW5jdGlvbiBhZGRSZXBsYWNlbWVudEluZm9Ub0NvbnRleHQoY29udGV4dCwgcG9zLCByZXBsYWNpbmdUZXJtKSB7CiAgICAvLyBleHRyYWN0IHRoZSBpbml0aWFsIHZhbHVlLCByYW5nZVRvUmVwbGFjZSAmIHRleHRCb3hQb3NpdGlvbgogICAgLy8gU2NlbmFyaW9zIGZvciBjdXJyZW50IHRva2VuOgogICAgLy8gICAtICBOaWNlIHRva2VuIHsgImJsYXwiCiAgICAvLyAgIC0gIEJyb2tlbiB0ZXh0IHRva2VuIHsgICBibGF8CiAgICAvLyAgIC0gIE5vIHRva2VuIDogeyB8CiAgICAvLyAgIC0gQnJva2VuIHNjZW5hcmlvIHsgLCBibGF8CiAgICAvLyAgIC0gTmljZSB0b2tlbiwgYnJva2VuIGJlZm9yZTogeywgImJsYSIKICAgIGNvbnRleHQudXBkYXRlZEZvclRva2VuID0gX2xvZGFzaC5kZWZhdWx0LmNsb25lKGVkaXRvci5nZXRUb2tlbkF0KHsKICAgICAgbGluZU51bWJlcjogcG9zLmxpbmVOdW1iZXIsCiAgICAgIGNvbHVtbjogcG9zLmNvbHVtbgogICAgfSkpOwoKICAgIGlmICghY29udGV4dC51cGRhdGVkRm9yVG9rZW4pIHsKICAgICAgY29udGV4dC51cGRhdGVkRm9yVG9rZW4gPSB7CiAgICAgICAgdmFsdWU6ICcnLAogICAgICAgIHR5cGU6ICcnLAogICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICBjb2x1bW46IHBvcy5jb2x1bW4sCiAgICAgICAgICBsaW5lTnVtYmVyOiBwb3MubGluZU51bWJlcgogICAgICAgIH0KICAgICAgfTsKICAgIH0gLy8gZW1wdHkgbGluZQoKCiAgICB2YXIgYW5jaG9yVG9rZW4gPSBjb250ZXh0LmNyZWF0ZWRXaXRoVG9rZW47CgogICAgaWYgKCFhbmNob3JUb2tlbikgewogICAgICBhbmNob3JUb2tlbiA9IGNvbnRleHQudXBkYXRlZEZvclRva2VuOwogICAgfQoKICAgIHN3aXRjaCAoY29udGV4dC51cGRhdGVkRm9yVG9rZW4udHlwZSkgewogICAgICBjYXNlICd2YXJpYWJsZSc6CiAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgIGNhc2UgJ3RleHQnOgogICAgICBjYXNlICdjb25zdGFudC5udW1lcmljJzoKICAgICAgY2FzZSAnY29uc3RhbnQubGFuZ3VhZ2UuYm9vbGVhbic6CiAgICAgIGNhc2UgJ21ldGhvZCc6CiAgICAgIGNhc2UgJ3VybC5pbmRleCc6CiAgICAgIGNhc2UgJ3VybC50eXBlJzoKICAgICAgY2FzZSAndXJsLmlkJzoKICAgICAgY2FzZSAndXJsLm1ldGhvZCc6CiAgICAgIGNhc2UgJ3VybC5lbmRwb2ludCc6CiAgICAgIGNhc2UgJ3VybC5wYXJ0JzoKICAgICAgY2FzZSAndXJsLnBhcmFtJzoKICAgICAgY2FzZSAndXJsLnZhbHVlJzoKICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlID0gewogICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgbGluZU51bWJlcjogcG9zLmxpbmVOdW1iZXIsCiAgICAgICAgICAgIGNvbHVtbjogYW5jaG9yVG9rZW4ucG9zaXRpb24uY29sdW1uCiAgICAgICAgICB9LAogICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgIGxpbmVOdW1iZXI6IHBvcy5saW5lTnVtYmVyLAogICAgICAgICAgICBjb2x1bW46IGNvbnRleHQudXBkYXRlZEZvclRva2VuLnBvc2l0aW9uLmNvbHVtbiArIGNvbnRleHQudXBkYXRlZEZvclRva2VuLnZhbHVlLmxlbmd0aAogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29udGV4dC5yZXBsYWNpbmdUb2tlbiA9IHRydWU7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGlmIChyZXBsYWNpbmdUZXJtICYmIGNvbnRleHQudXBkYXRlZEZvclRva2VuLnZhbHVlID09PSByZXBsYWNpbmdUZXJtKSB7CiAgICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlID0gewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmVOdW1iZXI6IHBvcy5saW5lTnVtYmVyLAogICAgICAgICAgICAgIGNvbHVtbjogYW5jaG9yVG9rZW4uY29sdW1uCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmVOdW1iZXI6IHBvcy5saW5lTnVtYmVyLAogICAgICAgICAgICAgIGNvbHVtbjogY29udGV4dC51cGRhdGVkRm9yVG9rZW4ucG9zaXRpb24uY29sdW1uICsgY29udGV4dC51cGRhdGVkRm9yVG9rZW4udmFsdWUubGVuZ3RoCiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICBjb250ZXh0LnJlcGxhY2luZ1Rva2VuID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gc3RhbmRpbmcgb24gd2hpdGUgc3BhY2UsIHF1b3RlcyBvciBhbm90aGVyIHB1bmN0dWF0aW9uIC0gbm8gcmVwbGFjaW5nCiAgICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlID0gewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmVOdW1iZXI6IHBvcy5saW5lTnVtYmVyLAogICAgICAgICAgICAgIGNvbHVtbjogcG9zLmNvbHVtbgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lTnVtYmVyOiBwb3MubGluZU51bWJlciwKICAgICAgICAgICAgICBjb2x1bW46IHBvcy5jb2x1bW4KICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIGNvbnRleHQucmVwbGFjaW5nVG9rZW4gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwogICAgfQoKICAgIGNvbnRleHQudGV4dEJveFBvc2l0aW9uID0gewogICAgICBsaW5lTnVtYmVyOiBjb250ZXh0LnJhbmdlVG9SZXBsYWNlLnN0YXJ0LmxpbmVOdW1iZXIsCiAgICAgIGNvbHVtbjogY29udGV4dC5yYW5nZVRvUmVwbGFjZS5zdGFydC5jb2x1bW4KICAgIH07CgogICAgc3dpdGNoIChjb250ZXh0LmF1dG9Db21wbGV0ZVR5cGUpIHsKICAgICAgY2FzZSAncGF0aCc6CiAgICAgICAgYWRkUGF0aFByZWZpeFN1ZmZpeFRvQ29udGV4dChjb250ZXh0KTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3VybF9wYXJhbXMnOgogICAgICAgIGFkZFVybFBhcmFtc1ByZWZpeFN1ZmZpeFRvQ29udGV4dChjb250ZXh0KTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ21ldGhvZCc6CiAgICAgICAgYWRkTWV0aG9kUHJlZml4U3VmZml4VG9Db250ZXh0KGNvbnRleHQpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYm9keSc6CiAgICAgICAgYWRkQm9keVByZWZpeFN1ZmZpeFRvQ29udGV4dChjb250ZXh0KTsKICAgICAgICBicmVhazsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFkZEJvZHlQcmVmaXhTdWZmaXhUb0NvbnRleHQoY29udGV4dCkgewogICAgLy8gRmlndXJlIG91dCB3aGF0IGhhcHBlbnMgbmV4dCB0byB0aGUgdG9rZW4gdG8gc2VlIHdoZXRoZXIgaXQgbmVlZHMgdHJhaWxpbmcgY29tbWFzIGV0Yy4KICAgIC8vIFRlbXBsYXRlcyB3aWxsIGJlIHVzZWQgaWYgbm90IGRlc3Ryb3lpbmcgZXhpc3Rpbmcgc3RydWN0dXJlLgogICAgLy8gLT4gdG9rZW4gOiB7fSBvciB0b2tlbiBdL30gb3IgdG9rZW4gLCBidXQgbm90IHRva2VuIDogU09NRVRISU5HIEVMU0UKICAgIGNvbnRleHQucHJlZml4VG9BZGQgPSAnJzsKICAgIGNvbnRleHQuc3VmZml4VG9BZGQgPSAnJzsKICAgIHZhciB0b2tlbkl0ZXIgPSAoMCwgX2ZhY3Rvcmllcy5jcmVhdGVUb2tlbkl0ZXJhdG9yKSh7CiAgICAgIGVkaXRvcjogZWRpdG9yLAogICAgICBwb3NpdGlvbjogZWRpdG9yLmdldEN1cnJlbnRQb3NpdGlvbigpCiAgICB9KTsKICAgIHZhciBub25FbXB0eVRva2VuID0gcGFyc2VyLm5leHROb25FbXB0eVRva2VuKHRva2VuSXRlcik7CgogICAgc3dpdGNoIChub25FbXB0eVRva2VuID8gbm9uRW1wdHlUb2tlbi50eXBlIDogJ05PVE9LRU4nKSB7CiAgICAgIGNhc2UgJ05PVE9LRU4nOgogICAgICBjYXNlICdwYXJlbi5scGFyZW4nOgogICAgICBjYXNlICdwYXJlbi5ycGFyZW4nOgogICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb21tYSc6CiAgICAgICAgY29udGV4dC5hZGRUZW1wbGF0ZSA9IHRydWU7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb2xvbic6CiAgICAgICAgLy8gdGVzdCBpZiB0aGVyZSBpcyBhbiBlbXB0eSBvYmplY3QgLSBpZiBzbyB3ZSByZXBsYWNlIGl0CiAgICAgICAgY29udGV4dC5hZGRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICAgIG5vbkVtcHR5VG9rZW4gPSBwYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKCiAgICAgICAgaWYgKCEobm9uRW1wdHlUb2tlbiAmJiBub25FbXB0eVRva2VuLnZhbHVlID09PSAneycpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIG5vbkVtcHR5VG9rZW4gPSBwYXJzZXIubmV4dE5vbkVtcHR5VG9rZW4odG9rZW5JdGVyKTsKCiAgICAgICAgaWYgKCEobm9uRW1wdHlUb2tlbiAmJiBub25FbXB0eVRva2VuLnZhbHVlID09PSAnfScpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGNvbnRleHQuYWRkVGVtcGxhdGUgPSB0cnVlOyAvLyBleHRlbmQgcmFuZ2UgdG8gcmVwbGFjZSB0byBpbmNsdWRlIGFsbCB1cCB0byB0b2tlbgoKICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlLmVuZC5saW5lTnVtYmVyID0gdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlbkxpbmVOdW1iZXIoKTsKICAgICAgICBjb250ZXh0LnJhbmdlVG9SZXBsYWNlLmVuZC5jb2x1bW4gPSB0b2tlbkl0ZXIuZ2V0Q3VycmVudFRva2VuQ29sdW1uKCkgKyBub25FbXB0eVRva2VuLnZhbHVlLmxlbmd0aDsgLy8gbW92ZSBvbmUgbW9yZSB0aW1lIHRvIGNoZWNrIGlmIHdlIG5lZWQgYSB0cmFpbGluZyBjb21tYQoKICAgICAgICBub25FbXB0eVRva2VuID0gcGFyc2VyLm5leHROb25FbXB0eVRva2VuKHRva2VuSXRlcik7CgogICAgICAgIHN3aXRjaCAobm9uRW1wdHlUb2tlbiA/IG5vbkVtcHR5VG9rZW4udHlwZSA6ICdOT1RPS0VOJykgewogICAgICAgICAgY2FzZSAnTk9UT0tFTic6CiAgICAgICAgICBjYXNlICdwYXJlbi5ycGFyZW4nOgogICAgICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29tbWEnOgogICAgICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29sb24nOgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBjb250ZXh0LnN1ZmZpeFRvQWRkID0gJywgJzsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICBjb250ZXh0LmFkZFRlbXBsYXRlID0gdHJ1ZTsKICAgICAgICBjb250ZXh0LnN1ZmZpeFRvQWRkID0gJywgJzsKICAgICAgICBicmVhazsKICAgICAgLy8gZm9yIG5vdyBwbGF5IHNhZmUgYW5kIGRvIG5vdGhpbmcuIE1heSBiZSBtYWRlIHNtYXJ0ZXIuCiAgICB9IC8vIGdvIGJhY2sgdG8gc2VlIHdoZXRoZXIgd2UgaGF2ZSBvbmUgb2YgKCA6IHsgJiBbIGRvIG5vdCByZXF1aXJlIGEgY29tbWEuIEFsbCB0aGUgcmVzdCBkby4KCgogICAgdG9rZW5JdGVyID0gKDAsIF9mYWN0b3JpZXMuY3JlYXRlVG9rZW5JdGVyYXRvcikoewogICAgICBlZGl0b3I6IGVkaXRvciwKICAgICAgcG9zaXRpb246IGVkaXRvci5nZXRDdXJyZW50UG9zaXRpb24oKQogICAgfSk7CiAgICBub25FbXB0eVRva2VuID0gdG9rZW5JdGVyLmdldEN1cnJlbnRUb2tlbigpOwogICAgdmFyIGluc2VydGluZ1JlbGF0aXZlVG9Ub2tlbjsgLy8gLTEgaXMgYmVmb3JlIHRva2VuLCAwIG1pZGRsZSwgKzEgYWZ0ZXIgdG9rZW4KCiAgICBpZiAoY29udGV4dC5yZXBsYWNpbmdUb2tlbikgewogICAgICBpbnNlcnRpbmdSZWxhdGl2ZVRvVG9rZW4gPSAwOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHBvcyA9IGVkaXRvci5nZXRDdXJyZW50UG9zaXRpb24oKTsKCiAgICAgIGlmIChwb3MuY29sdW1uID09PSBjb250ZXh0LnVwZGF0ZWRGb3JUb2tlbi5wb3NpdGlvbi5jb2x1bW4pIHsKICAgICAgICBpbnNlcnRpbmdSZWxhdGl2ZVRvVG9rZW4gPSAtMTsKICAgICAgfSBlbHNlIGlmIChwb3MuY29sdW1uIDwgY29udGV4dC51cGRhdGVkRm9yVG9rZW4ucG9zaXRpb24uY29sdW1uICsgY29udGV4dC51cGRhdGVkRm9yVG9rZW4udmFsdWUubGVuZ3RoKSB7CiAgICAgICAgaW5zZXJ0aW5nUmVsYXRpdmVUb1Rva2VuID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpbnNlcnRpbmdSZWxhdGl2ZVRvVG9rZW4gPSAxOwogICAgICB9CiAgICB9IC8vIHdlIHNob3VsZCBhY3R1YWxseSBsb29rIGF0IHdoYXQncyBoYXBwZW5pbmcgYmVmb3JlIHRoaXMgdG9rZW4KCgogICAgaWYgKHBhcnNlci5pc0VtcHR5VG9rZW4obm9uRW1wdHlUb2tlbikgfHwgaW5zZXJ0aW5nUmVsYXRpdmVUb1Rva2VuIDw9IDApIHsKICAgICAgbm9uRW1wdHlUb2tlbiA9IHBhcnNlci5wcmV2Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwogICAgfQoKICAgIHN3aXRjaCAobm9uRW1wdHlUb2tlbiA/IG5vbkVtcHR5VG9rZW4udHlwZSA6ICdOT1RPS0VOJykgewogICAgICBjYXNlICdOT1RPS0VOJzoKICAgICAgY2FzZSAncGFyZW4ubHBhcmVuJzoKICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29tbWEnOgogICAgICBjYXNlICdwdW5jdHVhdGlvbi5jb2xvbic6CiAgICAgIGNhc2UgJ21ldGhvZCc6CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGlmIChub25FbXB0eVRva2VuICYmIG5vbkVtcHR5VG9rZW4udHlwZS5pbmRleE9mKCd1cmwnKSA8IDApIHsKICAgICAgICAgIGNvbnRleHQucHJlZml4VG9BZGQgPSAnLCAnOwogICAgICAgIH0KCiAgICB9CgogICAgcmV0dXJuIGNvbnRleHQ7CiAgfQoKICBmdW5jdGlvbiBhZGRVcmxQYXJhbXNQcmVmaXhTdWZmaXhUb0NvbnRleHQoY29udGV4dCkgewogICAgY29udGV4dC5wcmVmaXhUb0FkZCA9ICcnOwogICAgY29udGV4dC5zdWZmaXhUb0FkZCA9ICcnOwogIH0KCiAgZnVuY3Rpb24gYWRkTWV0aG9kUHJlZml4U3VmZml4VG9Db250ZXh0KGNvbnRleHQpIHsKICAgIGNvbnRleHQucHJlZml4VG9BZGQgPSAnJzsKICAgIGNvbnRleHQuc3VmZml4VG9BZGQgPSAnJzsKICAgIHZhciB0b2tlbkl0ZXIgPSAoMCwgX2ZhY3Rvcmllcy5jcmVhdGVUb2tlbkl0ZXJhdG9yKSh7CiAgICAgIGVkaXRvcjogZWRpdG9yLAogICAgICBwb3NpdGlvbjogZWRpdG9yLmdldEN1cnJlbnRQb3NpdGlvbigpCiAgICB9KTsKICAgIHZhciBsaW5lTnVtYmVyID0gdG9rZW5JdGVyLmdldEN1cnJlbnRQb3NpdGlvbigpLmxpbmVOdW1iZXI7CiAgICB2YXIgdCA9IHBhcnNlci5uZXh0Tm9uRW1wdHlUb2tlbih0b2tlbkl0ZXIpOwoKICAgIGlmICh0b2tlbkl0ZXIuZ2V0Q3VycmVudFBvc2l0aW9uKCkubGluZU51bWJlciAhPT0gbGluZU51bWJlciB8fCAhdCkgewogICAgICAvLyB3ZSBzdGlsbCBoYXZlIG5vdGhpbmcgbmV4dCB0byB0aGUgbWV0aG9kLCBhZGQgYSBzcGFjZS4uCiAgICAgIGNvbnRleHQuc3VmZml4VG9BZGQgPSAnICc7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhZGRQYXRoUHJlZml4U3VmZml4VG9Db250ZXh0KGNvbnRleHQpIHsKICAgIGNvbnRleHQucHJlZml4VG9BZGQgPSAnJzsKICAgIGNvbnRleHQuc3VmZml4VG9BZGQgPSAnJzsKICB9CgogIGZ1bmN0aW9uIGFkZE1ldGhvZEF1dG9Db21wbGV0ZVNldFRvQ29udGV4dChjb250ZXh0KSB7CiAgICBjb250ZXh0LmF1dG9Db21wbGV0ZVNldCA9IFsnR0VUJywgJ1BVVCcsICdQT1NUJywgJ0RFTEVURScsICdIRUFEJ10ubWFwKGZ1bmN0aW9uIChtLCBpKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogbSwKICAgICAgICBzY29yZTogLWksCiAgICAgICAgbWV0YTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbnNvbGUuYXV0b2NvbXBsZXRlLmFkZE1ldGhvZE1ldGFUZXh0JywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdtZXRob2QnCiAgICAgICAgfSkKICAgICAgfTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gYWRkUGF0aEF1dG9Db21wbGV0ZVNldFRvQ29udGV4dChjb250ZXh0LCBwb3MpIHsKICAgIHZhciByZXQgPSBnZXRDdXJyZW50TWV0aG9kQW5kVG9rZW5QYXRocyhlZGl0b3IsIHBvcywgcGFyc2VyKTsKICAgIGNvbnRleHQubWV0aG9kID0gcmV0Lm1ldGhvZDsKICAgIGNvbnRleHQudG9rZW4gPSByZXQudG9rZW47CiAgICBjb250ZXh0Lm90aGVyVG9rZW5WYWx1ZXMgPSByZXQub3RoZXJUb2tlblZhbHVlczsKICAgIGNvbnRleHQudXJsVG9rZW5QYXRoID0gcmV0LnVybFRva2VuUGF0aDsKICAgIHZhciBjb21wb25lbnRzID0gKDAsIF9rYi5nZXRUb3BMZXZlbFVybENvbXBsZXRlQ29tcG9uZW50cykoY29udGV4dC5tZXRob2QpOwogICAgKDAsIF9lbmdpbmUucG9wdWxhdGVDb250ZXh0KShyZXQudXJsVG9rZW5QYXRoLCBjb250ZXh0LCBlZGl0b3IsIHRydWUsIGNvbXBvbmVudHMpOwogICAgY29udGV4dC5hdXRvQ29tcGxldGVTZXQgPSBhZGRNZXRhVG9UZXJtc0xpc3QoY29udGV4dC5hdXRvQ29tcGxldGVTZXQsICdlbmRwb2ludCcpOwogIH0KCiAgZnVuY3Rpb24gYWRkVXJsUGFyYW1zQXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQsIHBvcykgewogICAgdmFyIHJldCA9IGdldEN1cnJlbnRNZXRob2RBbmRUb2tlblBhdGhzKGVkaXRvciwgcG9zLCBwYXJzZXIpOwogICAgY29udGV4dC5tZXRob2QgPSByZXQubWV0aG9kOwogICAgY29udGV4dC5vdGhlclRva2VuVmFsdWVzID0gcmV0Lm90aGVyVG9rZW5WYWx1ZXM7CiAgICBjb250ZXh0LnVybFRva2VuUGF0aCA9IHJldC51cmxUb2tlblBhdGg7CgogICAgaWYgKCFyZXQudXJsVG9rZW5QYXRoKSB7CiAgICAgIC8vIHplcm8gbGVuZ3RoIHRva2VuUGF0aCBpcyB0cnVlCiAgICAgIHJldHVybiBjb250ZXh0OwogICAgfQoKICAgICgwLCBfZW5naW5lLnBvcHVsYXRlQ29udGV4dCkocmV0LnVybFRva2VuUGF0aCwgY29udGV4dCwgZWRpdG9yLCBmYWxzZSwgKDAsIF9rYi5nZXRUb3BMZXZlbFVybENvbXBsZXRlQ29tcG9uZW50cykoY29udGV4dC5tZXRob2QpKTsKCiAgICBpZiAoIWNvbnRleHQuZW5kcG9pbnQpIHsKICAgICAgcmV0dXJuIGNvbnRleHQ7CiAgICB9CgogICAgaWYgKCFyZXQudXJsUGFyYW1zVG9rZW5QYXRoKSB7CiAgICAgIC8vIHplcm8gbGVuZ3RoIHRva2VuUGF0aCBpcyB0cnVlCiAgICAgIHJldHVybiBjb250ZXh0OwogICAgfQoKICAgIHZhciB0b2tlblBhdGggPSBbXTsKICAgIHZhciBjdXJyZW50UGFyYW0gPSByZXQudXJsUGFyYW1zVG9rZW5QYXRoLnBvcCgpOwoKICAgIGlmIChjdXJyZW50UGFyYW0pIHsKICAgICAgdG9rZW5QYXRoID0gT2JqZWN0LmtleXMoY3VycmVudFBhcmFtKTsgLy8gc2luZ2xlIGtleSBvYmplY3QKCiAgICAgIGNvbnRleHQub3RoZXJUb2tlblZhbHVlcyA9IGN1cnJlbnRQYXJhbVt0b2tlblBhdGhbMF1dOwogICAgfQoKICAgICgwLCBfZW5naW5lLnBvcHVsYXRlQ29udGV4dCkodG9rZW5QYXRoLCBjb250ZXh0LCBlZGl0b3IsIHRydWUsIGNvbnRleHQuZW5kcG9pbnQucGFyYW1zQXV0b2NvbXBsZXRlLmdldFRvcExldmVsQ29tcG9uZW50cyhjb250ZXh0Lm1ldGhvZCkpOwogICAgcmV0dXJuIGNvbnRleHQ7CiAgfQoKICBmdW5jdGlvbiBhZGRCb2R5QXV0b0NvbXBsZXRlU2V0VG9Db250ZXh0KGNvbnRleHQsIHBvcykgewogICAgdmFyIHJldCA9IGdldEN1cnJlbnRNZXRob2RBbmRUb2tlblBhdGhzKGVkaXRvciwgcG9zLCBwYXJzZXIpOwogICAgY29udGV4dC5tZXRob2QgPSByZXQubWV0aG9kOwogICAgY29udGV4dC5vdGhlclRva2VuVmFsdWVzID0gcmV0Lm90aGVyVG9rZW5WYWx1ZXM7CiAgICBjb250ZXh0LnVybFRva2VuUGF0aCA9IHJldC51cmxUb2tlblBhdGg7CiAgICBjb250ZXh0LnJlcXVlc3RTdGFydFJvdyA9IHJldC5yZXF1ZXN0U3RhcnRSb3c7CgogICAgaWYgKCFyZXQudXJsVG9rZW5QYXRoKSB7CiAgICAgIC8vIHplcm8gbGVuZ3RoIHRva2VuUGF0aCBpcyB0cnVlCiAgICAgIHJldHVybiBjb250ZXh0OwogICAgfQoKICAgICgwLCBfZW5naW5lLnBvcHVsYXRlQ29udGV4dCkocmV0LnVybFRva2VuUGF0aCwgY29udGV4dCwgZWRpdG9yLCBmYWxzZSwgKDAsIF9rYi5nZXRUb3BMZXZlbFVybENvbXBsZXRlQ29tcG9uZW50cykoY29udGV4dC5tZXRob2QpKTsKICAgIGNvbnRleHQuYm9keVRva2VuUGF0aCA9IHJldC5ib2R5VG9rZW5QYXRoOwoKICAgIGlmICghcmV0LmJvZHlUb2tlblBhdGgpIHsKICAgICAgLy8gemVybyBsZW5ndGggdG9rZW5QYXRoIGlzIHRydWUKICAgICAgcmV0dXJuIGNvbnRleHQ7CiAgICB9IC8vIG5lZWRlZCBmb3Igc2NvcGUgbGlua2luZyArIGdsb2JhbCB0ZXJtIHJlc29sdmluZwoKCiAgICBjb250ZXh0LmVuZHBvaW50Q29tcG9uZW50UmVzb2x2ZXIgPSBfa2IuZ2V0RW5kcG9pbnRCb2R5Q29tcGxldGVDb21wb25lbnRzOwogICAgY29udGV4dC5nbG9iYWxDb21wb25lbnRSZXNvbHZlciA9IF9rYi5nZXRHbG9iYWxBdXRvY29tcGxldGVDb21wb25lbnRzOwogICAgdmFyIGNvbXBvbmVudHM7CgogICAgaWYgKGNvbnRleHQuZW5kcG9pbnQpIHsKICAgICAgY29tcG9uZW50cyA9IGNvbnRleHQuZW5kcG9pbnQuYm9keUF1dG9jb21wbGV0ZVJvb3RDb21wb25lbnRzOwogICAgfSBlbHNlIHsKICAgICAgY29tcG9uZW50cyA9ICgwLCBfa2IuZ2V0VW5tYXRjaGVkRW5kcG9pbnRDb21wb25lbnRzKSgpOwogICAgfQoKICAgICgwLCBfZW5naW5lLnBvcHVsYXRlQ29udGV4dCkocmV0LmJvZHlUb2tlblBhdGgsIGNvbnRleHQsIGVkaXRvciwgdHJ1ZSwgY29tcG9uZW50cyk7CiAgICByZXR1cm4gY29udGV4dDsKICB9CgogIHZhciBldmFsdWF0ZUN1cnJlbnRUb2tlbkFmdGVyQUNoYW5nZSA9IF9sb2Rhc2guZGVmYXVsdC5kZWJvdW5jZShmdW5jdGlvbiBldmFsdWF0ZUN1cnJlbnRUb2tlbkFmdGVyQUNoYW5nZShwb3MpIHsKICAgIHZhciBjdXJyZW50VG9rZW4gPSBlZGl0b3IuZ2V0VG9rZW5BdChwb3MpOwoKICAgIGlmICghY3VycmVudFRva2VuKSB7CiAgICAgIGlmIChwb3MubGluZU51bWJlciA9PT0gMSkgewogICAgICAgIExBU1RfRVZBTFVBVEVEX1RPS0VOID0gbnVsbDsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGN1cnJlbnRUb2tlbiA9IHsKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgY29sdW1uOiAwLAogICAgICAgICAgbGluZU51bWJlcjogMAogICAgICAgIH0sCiAgICAgICAgdmFsdWU6ICcnLAogICAgICAgIHR5cGU6ICcnCiAgICAgIH07IC8vIGVtcHR5IHJvdwogICAgfQoKICAgIGN1cnJlbnRUb2tlbi5wb3NpdGlvbi5saW5lTnVtYmVyID0gcG9zLmxpbmVOdW1iZXI7IC8vIGV4dGVuZCB0b2tlbiB3aXRoIHJvdy4gQWNlIGRvZXNuJ3Qgc3VwcGx5IGl0IGJ5IGRlZmF1bHQKCiAgICBpZiAocGFyc2VyLmlzRW1wdHlUb2tlbihjdXJyZW50VG9rZW4pKSB7CiAgICAgIC8vIGVtcHR5IHRva2VuLiBjaGVjayB3aGF0J3MgY29taW5nIG5leHQKICAgICAgdmFyIG5leHRUb2tlbiA9IGVkaXRvci5nZXRUb2tlbkF0KF9vYmplY3RTcHJlYWQoe30sIHBvcywgewogICAgICAgIGNvbHVtbjogcG9zLmNvbHVtbiArIDEKICAgICAgfSkpOwoKICAgICAgaWYgKHBhcnNlci5pc0VtcHR5VG9rZW4obmV4dFRva2VuKSkgewogICAgICAgIC8vIEVtcHR5IGxpbmUsIG9yIHdlJ3JlIG5vdCBvbiB0aGUgZWRnZSBvZiBjdXJyZW50IHRva2VuLiBTYXZlIHRoZSBjdXJyZW50IHBvc2l0aW9uIGFzIGJhc2UKICAgICAgICBjdXJyZW50VG9rZW4ucG9zaXRpb24uY29sdW1uID0gcG9zLmNvbHVtbjsKICAgICAgICBMQVNUX0VWQUxVQVRFRF9UT0tFTiA9IGN1cnJlbnRUb2tlbjsKICAgICAgfSBlbHNlIHsKICAgICAgICBuZXh0VG9rZW4ucG9zaXRpb24ubGluZU51bWJlciA9IHBvcy5saW5lTnVtYmVyOwogICAgICAgIExBU1RfRVZBTFVBVEVEX1RPS0VOID0gbmV4dFRva2VuOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCFMQVNUX0VWQUxVQVRFRF9UT0tFTikgewogICAgICBMQVNUX0VWQUxVQVRFRF9UT0tFTiA9IGN1cnJlbnRUb2tlbjsKICAgICAgcmV0dXJuOyAvLyB3YWl0IGZvciB0aGUgbmV4dCB0eXBpbmcuCiAgICB9CgogICAgaWYgKExBU1RfRVZBTFVBVEVEX1RPS0VOLnBvc2l0aW9uLmNvbHVtbiAhPT0gY3VycmVudFRva2VuLnBvc2l0aW9uLmNvbHVtbiB8fCBMQVNUX0VWQUxVQVRFRF9UT0tFTi5wb3NpdGlvbi5saW5lTnVtYmVyICE9PSBjdXJyZW50VG9rZW4ucG9zaXRpb24ubGluZU51bWJlciB8fCBMQVNUX0VWQUxVQVRFRF9UT0tFTi52YWx1ZSA9PT0gY3VycmVudFRva2VuLnZhbHVlKSB7CiAgICAgIC8vIG5vdCBvbiB0aGUgc2FtZSBwbGFjZSBvciBub3RoaW5nIGNoYW5nZWQsIGNhY2hlIGFuZCB3YWl0IGZvciB0aGUgbmV4dCB0aW1lCiAgICAgIExBU1RfRVZBTFVBVEVEX1RPS0VOID0gY3VycmVudFRva2VuOwogICAgICByZXR1cm47CiAgICB9IC8vIGRvbid0IGF1dG9tYXRpY2FsbHkgb3BlbiB0aGUgYXV0byBjb21wbGV0ZSBpZiBzb21lIGp1c3QgaGl0IGVudGVyIChuZXcgbGluZSkgb3Igb3BlbiBhIHBhcmVudGhlc2VzCgoKICAgIHN3aXRjaCAoY3VycmVudFRva2VuLnR5cGUgfHwgJ1VOS05PV04nKSB7CiAgICAgIGNhc2UgJ3BhcmVuLmxwYXJlbic6CiAgICAgIGNhc2UgJ3BhcmVuLnJwYXJlbic6CiAgICAgIGNhc2UgJ3B1bmN0dWF0aW9uLmNvbG9uJzoKICAgICAgY2FzZSAncHVuY3R1YXRpb24uY29tbWEnOgogICAgICBjYXNlICdVTktOT1dOJzoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgTEFTVF9FVkFMVUFURURfVE9LRU4gPSBjdXJyZW50VG9rZW47CiAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ3N0YXJ0QXV0b2NvbXBsZXRlJyk7CiAgfSwgMTAwKTsKCiAgZnVuY3Rpb24gZWRpdG9yQ2hhbmdlTGlzdGVuZXIoKSB7CiAgICB2YXIgcG9zaXRpb24gPSBlZGl0b3IuZ2V0Q3VycmVudFBvc2l0aW9uKCk7CgogICAgaWYgKHBvc2l0aW9uICYmICFlZGl0b3IuaXNDb21wbGV0ZXJBY3RpdmUoKSkgewogICAgICBldmFsdWF0ZUN1cnJlbnRUb2tlbkFmdGVyQUNoYW5nZShwb3NpdGlvbik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRDb21wbGV0aW9ucyhET19OT1RfVVNFLCBET19OT1RfVVNFX1NFU1NJT04sIHBvcywgcHJlZml4LCBjYWxsYmFjaykgewogICAgdmFyIHBvc2l0aW9uID0gewogICAgICBsaW5lTnVtYmVyOiBwb3Mucm93ICsgMSwKICAgICAgY29sdW1uOiBwb3MuY29sdW1uICsgMQogICAgfTsKCiAgICB0cnkgewogICAgICB2YXIgY29udGV4dCA9IGdldEF1dG9Db21wbGV0ZUNvbnRleHQoZWRpdG9yLCBwb3NpdGlvbik7CgogICAgICBpZiAoIWNvbnRleHQpIHsKICAgICAgICBjYWxsYmFjayhudWxsLCBbXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHRlcm1zID0gX2xvZGFzaC5kZWZhdWx0Lm1hcChjb250ZXh0LmF1dG9Db21wbGV0ZVNldC5maWx0ZXIoZnVuY3Rpb24gKHRlcm0pIHsKICAgICAgICAgIHJldHVybiBCb29sZWFuKHRlcm0pICYmIHRlcm0ubmFtZSAhPSBudWxsOwogICAgICAgIH0pLCBmdW5jdGlvbiAodGVybSkgewogICAgICAgICAgaWYgKF90eXBlb2YodGVybSkgIT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIHRlcm0gPSB7CiAgICAgICAgICAgICAgbmFtZTogdGVybQogICAgICAgICAgICB9OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGVybSA9IF9sb2Rhc2guZGVmYXVsdC5jbG9uZSh0ZXJtKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgICAgIHZhbHVlOiB0ZXJtLm5hbWUsCiAgICAgICAgICAgIG1ldGE6ICdBUEknLAogICAgICAgICAgICBzY29yZTogMCwKICAgICAgICAgICAgY29udGV4dDogY29udGV4dAogICAgICAgICAgfTsgLy8gd2Ugb25seSBuZWVkIG91ciBjdXN0b20gaW5zZXJ0TWF0Y2ggYmVoYXZpb3IgZm9yIHRoZSBib2R5CgogICAgICAgICAgaWYgKGNvbnRleHQuYXV0b0NvbXBsZXRlVHlwZSA9PT0gJ2JvZHknKSB7CiAgICAgICAgICAgIGRlZmF1bHRzLmNvbXBsZXRlciA9IHsKICAgICAgICAgICAgICBpbnNlcnRNYXRjaDogZnVuY3Rpb24gaW5zZXJ0TWF0Y2goKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXBwbHlUZXJtKHRlcm0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LmRlZmF1bHRzKHRlcm0sIGRlZmF1bHRzKTsKICAgICAgICB9KTsKCiAgICAgICAgdGVybXMuc29ydChmdW5jdGlvbiAodDEsIHQyKSB7CiAgICAgICAgICAvKiBzY29yZSBzb3J0cyBmcm9tIGhpZ2ggdG8gbG93ICovCiAgICAgICAgICBpZiAodDEuc2NvcmUgPiB0Mi5zY29yZSkgewogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHQxLnNjb3JlIDwgdDIuc2NvcmUpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICB9CiAgICAgICAgICAvKiBuYW1lcyBzb3J0IGZyb20gbG93IHRvIGhpZ2ggKi8KCgogICAgICAgICAgaWYgKHQxLm5hbWUgPCB0Mi5uYW1lKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodDEubmFtZSA9PT0gdDIubmFtZSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9KTsKICAgICAgICBjYWxsYmFjayhudWxsLCBfbG9kYXNoLmRlZmF1bHQubWFwKHRlcm1zLCBmdW5jdGlvbiAodCwgaSkgewogICAgICAgICAgdC5pbnNlcnRWYWx1ZSA9IHQuaW5zZXJ0VmFsdWUgfHwgdC52YWx1ZTsKICAgICAgICAgIHQudmFsdWUgPSAnJyArIHQudmFsdWU7IC8vIG5vcm1hbGl6ZSB0byBzdHJpbmdzCgogICAgICAgICAgdC5zY29yZSA9IC1pOwogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSkpOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgIGNhbGxiYWNrKGUsIG51bGwpOwogICAgfQogIH0KCiAgZWRpdG9yLm9uKCdjaGFuZ2VTZWxlY3Rpb24nLCBlZGl0b3JDaGFuZ2VMaXN0ZW5lcik7IC8vIEhvb2sgaW50byBBY2UKICAvLyBkaXNhYmxlIHN0YW5kYXJkIGNvbnRleHQgYmFzZWQgYXV0b2NvbXBsZXRpb24uCiAgLy8gQHRzLWlnbm9yZQoKICBfYnJhY2UuZGVmYXVsdC5kZWZpbmUoJ2FjZS9hdXRvY29tcGxldGUvdGV4dF9jb21wbGV0ZXInLCBbJ3JlcXVpcmUnLCAnZXhwb3J0cycsICdtb2R1bGUnXSwgZnVuY3Rpb24gKHJlcXVpcmUsIGV4cG9ydHMpIHsKICAgIGV4cG9ydHMuZ2V0Q29tcGxldGlvbnMgPSBmdW5jdGlvbiAoaW5uZXJFZGl0b3IsIHNlc3Npb24sIHBvcywgcHJlZml4LCBjYWxsYmFjaykgewogICAgICBjYWxsYmFjayhudWxsLCBbXSk7CiAgICB9OwogIH0pOwoKICB2YXIgbGFuZ1Rvb2xzID0gX2JyYWNlLmRlZmF1bHQuYWNlcXVpcmUoJ2FjZS9leHQvbGFuZ3VhZ2VfdG9vbHMnKTsKCiAgbGFuZ1Rvb2xzLnNldENvbXBsZXRlcnMoW3sKICAgIGlkZW50aWZpZXJSZWdleHBzOiBbL1thLXpBLVpfMC05XC5cJFwtXHUwMEEyLVx1RkZGRl0vXSwKICAgIGdldENvbXBsZXRpb25zOiBnZXRDb21wbGV0aW9ucwogIH1dKTsKICByZXR1cm4gewogICAgX3Rlc3Q6IHsKICAgICAgZ2V0Q29tcGxldGlvbnM6IGdldENvbXBsZXRpb25zLAogICAgICBhZGRSZXBsYWNlbWVudEluZm9Ub0NvbnRleHQ6IGFkZFJlcGxhY2VtZW50SW5mb1RvQ29udGV4dCwKICAgICAgYWRkQ2hhbmdlTGlzdGVuZXI6IGZ1bmN0aW9uIGFkZENoYW5nZUxpc3RlbmVyKCkgewogICAgICAgIHJldHVybiBlZGl0b3Iub24oJ2NoYW5nZVNlbGVjdGlvbicsIGVkaXRvckNoYW5nZUxpc3RlbmVyKTsKICAgICAgfSwKICAgICAgcmVtb3ZlQ2hhbmdlTGlzdGVuZXI6IGZ1bmN0aW9uIHJlbW92ZUNoYW5nZUxpc3RlbmVyKCkgewogICAgICAgIHJldHVybiBlZGl0b3Iub2ZmKCdjaGFuZ2VTZWxlY3Rpb24nLCBlZGl0b3JDaGFuZ2VMaXN0ZW5lcik7CiAgICAgIH0KICAgIH0KICB9Owp9"},null]}