{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/data/public/ui/query_string_input/query_string_input.js","dependencies":[{"path":"src/plugins/data/public/ui/query_string_input/query_string_input.js","mtime":1585205041598},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuUXVlcnlTdHJpbmdJbnB1dCA9IGV4cG9ydHMuUXVlcnlTdHJpbmdJbnB1dFVJID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfbG9kYXNoID0gcmVxdWlyZSgibG9kYXNoIik7Cgp2YXIgXyA9IHJlcXVpcmUoIi4uLy4uIik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2tpYmFuYV9yZWFjdC9wdWJsaWMiKTsKCnZhciBfZmV0Y2hfaW5kZXhfcGF0dGVybnMgPSByZXF1aXJlKCIuL2ZldGNoX2luZGV4X3BhdHRlcm5zIik7Cgp2YXIgX2xhbmd1YWdlX3N3aXRjaGVyID0gcmVxdWlyZSgiLi9sYW5ndWFnZV9zd2l0Y2hlciIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfZXh0ZW5kcygpIHsKICBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgewogICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGFyZ2V0OwogIH07CgogIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgewogIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogIH0KfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICByZXR1cm4gQ29uc3RydWN0b3I7Cn0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CiAgICByZXR1cm4gY2FsbDsKICB9CgogIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOwp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIEtFWV9DT0RFUyA9IHsKICBMRUZUOiAzNywKICBVUDogMzgsCiAgUklHSFQ6IDM5LAogIERPV046IDQwLAogIEVOVEVSOiAxMywKICBFU0M6IDI3LAogIFRBQjogOSwKICBIT01FOiAzNiwKICBFTkQ6IDM1Cn07CnZhciByZWNlbnRTZWFyY2hUeXBlID0gJ3JlY2VudFNlYXJjaCc7Cgp2YXIgUXVlcnlTdHJpbmdJbnB1dFVJID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhRdWVyeVN0cmluZ0lucHV0VUksIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBRdWVyeVN0cmluZ0lucHV0VUkoKSB7CiAgICB2YXIgX2dldFByb3RvdHlwZU9mMjsKCiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFF1ZXJ5U3RyaW5nSW5wdXRVSSk7CgogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoX2dldFByb3RvdHlwZU9mMiA9IF9nZXRQcm90b3R5cGVPZihRdWVyeVN0cmluZ0lucHV0VUkpKS5jYWxsLmFwcGx5KF9nZXRQcm90b3R5cGVPZjIsIFt0aGlzXS5jb25jYXQoYXJncykpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHsKICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGU6IGZhbHNlLAogICAgICBpbmRleDogbnVsbCwKICAgICAgc3VnZ2VzdGlvbnM6IFtdLAogICAgICBzdWdnZXN0aW9uTGltaXQ6IDUwLAogICAgICBzZWxlY3Rpb25TdGFydDogbnVsbCwKICAgICAgc2VsZWN0aW9uRW5kOiBudWxsLAogICAgICBpbmRleFBhdHRlcm5zOiBbXQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW5wdXRSZWYiLCBudWxsKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwZXJzaXN0ZWRMb2ciLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImFib3J0Q29udHJvbGxlciIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2VydmljZXMiLCBfdGhpcy5wcm9wcy5raWJhbmEuc2VydmljZXMpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNvbXBvbmVudElzVW5tb3VudGluZyIsIGZhbHNlKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRRdWVyeVN0cmluZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICgwLCBfLnRvVXNlcikoX3RoaXMucHJvcHMucXVlcnkucXVlcnkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmV0Y2hJbmRleFBhdHRlcm5zIiwgZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgdmFyIHN0cmluZ1BhdHRlcm5zLCBvYmplY3RQYXR0ZXJucywgb2JqZWN0UGF0dGVybnNGcm9tU3RyaW5nczsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBzdHJpbmdQYXR0ZXJucyA9IF90aGlzLnByb3BzLmluZGV4UGF0dGVybnMuZmlsdGVyKGZ1bmN0aW9uIChpbmRleFBhdHRlcm4pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgaW5kZXhQYXR0ZXJuID09PSAnc3RyaW5nJzsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBvYmplY3RQYXR0ZXJucyA9IF90aGlzLnByb3BzLmluZGV4UGF0dGVybnMuZmlsdGVyKGZ1bmN0aW9uIChpbmRleFBhdHRlcm4pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgaW5kZXhQYXR0ZXJuICE9PSAnc3RyaW5nJzsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKCgwLCBfZmV0Y2hfaW5kZXhfcGF0dGVybnMuZmV0Y2hJbmRleFBhdHRlcm5zKShfdGhpcy5zZXJ2aWNlcy5zYXZlZE9iamVjdHMuY2xpZW50LCBzdHJpbmdQYXR0ZXJucywgX3RoaXMuc2VydmljZXMudWlTZXR0aW5ncykpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIG9iamVjdFBhdHRlcm5zRnJvbVN0cmluZ3MgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm5zOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KG9iamVjdFBhdHRlcm5zKSwgX3RvQ29uc3VtYWJsZUFycmF5KG9iamVjdFBhdHRlcm5zRnJvbVN0cmluZ3MpKQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldFN1Z2dlc3Rpb25zIiwgZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciB1aVNldHRpbmdzLCBsYW5ndWFnZSwgcXVlcnlTdHJpbmcsIHJlY2VudFNlYXJjaFN1Z2dlc3Rpb25zLCBhdXRvY29tcGxldGVQcm92aWRlciwgaW5kZXhQYXR0ZXJucywgZ2V0QXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMsIF90aGlzJGlucHV0UmVmLCBzZWxlY3Rpb25TdGFydCwgc2VsZWN0aW9uRW5kLCBzdWdnZXN0aW9uczsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGlmIChfdGhpcy5pbnB1dFJlZikgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgdWlTZXR0aW5ncyA9IF90aGlzLnNlcnZpY2VzLnVpU2V0dGluZ3M7CiAgICAgICAgICAgICAgbGFuZ3VhZ2UgPSBfdGhpcy5wcm9wcy5xdWVyeS5sYW5ndWFnZTsKICAgICAgICAgICAgICBxdWVyeVN0cmluZyA9IF90aGlzLmdldFF1ZXJ5U3RyaW5nKCk7CiAgICAgICAgICAgICAgcmVjZW50U2VhcmNoU3VnZ2VzdGlvbnMgPSBfdGhpcy5nZXRSZWNlbnRTZWFyY2hTdWdnZXN0aW9ucyhxdWVyeVN0cmluZyk7CiAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlUHJvdmlkZXIgPSBfdGhpcy5zZXJ2aWNlcy5kYXRhLmF1dG9jb21wbGV0ZS5nZXRQcm92aWRlcihsYW5ndWFnZSk7CgogICAgICAgICAgICAgIGlmICghKCFhdXRvY29tcGxldGVQcm92aWRlciB8fCAhQXJyYXkuaXNBcnJheShfdGhpcy5zdGF0ZS5pbmRleFBhdHRlcm5zKSB8fCAoMCwgX2xvZGFzaC5jb21wYWN0KShfdGhpcy5zdGF0ZS5pbmRleFBhdHRlcm5zKS5sZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZWNlbnRTZWFyY2hTdWdnZXN0aW9ucyk7CgogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJucyA9IF90aGlzLnN0YXRlLmluZGV4UGF0dGVybnM7CiAgICAgICAgICAgICAgZ2V0QXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMgPSBhdXRvY29tcGxldGVQcm92aWRlcih7CiAgICAgICAgICAgICAgICBjb25maWc6IHVpU2V0dGluZ3MsCiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm5zOiBpbmRleFBhdHRlcm5zCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX3RoaXMkaW5wdXRSZWYgPSBfdGhpcy5pbnB1dFJlZiwgc2VsZWN0aW9uU3RhcnQgPSBfdGhpcyRpbnB1dFJlZi5zZWxlY3Rpb25TdGFydCwgc2VsZWN0aW9uRW5kID0gX3RoaXMkaW5wdXRSZWYuc2VsZWN0aW9uRW5kOwoKICAgICAgICAgICAgICBpZiAoIShzZWxlY3Rpb25TdGFydCA9PT0gbnVsbCB8fCBzZWxlY3Rpb25FbmQgPT09IG51bGwpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMTQ7CiAgICAgICAgICAgICAgaWYgKF90aGlzLmFib3J0Q29udHJvbGxlcikgX3RoaXMuYWJvcnRDb250cm9sbGVyLmFib3J0KCk7CiAgICAgICAgICAgICAgX3RoaXMuYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChnZXRBdXRvY29tcGxldGVTdWdnZXN0aW9ucyh7CiAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnlTdHJpbmcsCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25TdGFydDogc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25FbmQ6IHNlbGVjdGlvbkVuZCwKICAgICAgICAgICAgICAgIHNpZ25hbDogX3RoaXMuYWJvcnRDb250cm9sbGVyLnNpZ25hbAogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdWdnZXN0aW9ucyksIF90b0NvbnN1bWFibGVBcnJheShyZWNlbnRTZWFyY2hTdWdnZXN0aW9ucykpKTsKCiAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAyMzsKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMTQpOwoKICAgICAgICAgICAgICBpZiAoIShfY29udGV4dDIudDAubWVzc2FnZSA9PT0gJ1RoZSB1c2VyIGFib3J0ZWQgYSByZXF1ZXN0LicpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgIHRocm93IF9jb250ZXh0Mi50MDsKCiAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCBudWxsLCBbWzE0LCAyM11dKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldFJlY2VudFNlYXJjaFN1Z2dlc3Rpb25zIiwgZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICAgIGlmICghX3RoaXMucGVyc2lzdGVkTG9nKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CgogICAgICB2YXIgcmVjZW50U2VhcmNoZXMgPSBfdGhpcy5wZXJzaXN0ZWRMb2cuZ2V0KCk7CgogICAgICB2YXIgbWF0Y2hpbmdSZWNlbnRTZWFyY2hlcyA9IHJlY2VudFNlYXJjaGVzLmZpbHRlcihmdW5jdGlvbiAocmVjZW50UXVlcnkpIHsKICAgICAgICB2YXIgcmVjZW50UXVlcnlTdHJpbmcgPSBfdHlwZW9mKHJlY2VudFF1ZXJ5KSA9PT0gJ29iamVjdCcgPyAoMCwgXy50b1VzZXIpKHJlY2VudFF1ZXJ5KSA6IHJlY2VudFF1ZXJ5OwogICAgICAgIHJldHVybiByZWNlbnRRdWVyeVN0cmluZy5pbmNsdWRlcyhxdWVyeSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gbWF0Y2hpbmdSZWNlbnRTZWFyY2hlcy5tYXAoZnVuY3Rpb24gKHJlY2VudFNlYXJjaCkgewogICAgICAgIHZhciB0ZXh0ID0gKDAsIF8udG9Vc2VyKShyZWNlbnRTZWFyY2gpOwogICAgICAgIHZhciBzdGFydCA9IDA7CiAgICAgICAgdmFyIGVuZCA9IHF1ZXJ5Lmxlbmd0aDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogcmVjZW50U2VhcmNoVHlwZSwKICAgICAgICAgIHRleHQ6IHRleHQsCiAgICAgICAgICBzdGFydDogc3RhcnQsCiAgICAgICAgICBlbmQ6IGVuZAogICAgICAgIH07CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidXBkYXRlU3VnZ2VzdGlvbnMiLCAoMCwgX2xvZGFzaC5kZWJvdW5jZSkoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgIHZhciBzdWdnZXN0aW9uczsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX3RoaXMuZ2V0U3VnZ2VzdGlvbnMoKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgIGlmIChfY29udGV4dDMudDApIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gW107CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMgPSBfY29udGV4dDMudDA7CgogICAgICAgICAgICAgIGlmICghX3RoaXMuY29tcG9uZW50SXNVbm1vdW50aW5nKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25zOiBzdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LCAxMDApKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblN1Ym1pdCIsIGZ1bmN0aW9uIChxdWVyeSkgewogICAgICBpZiAoX3RoaXMucHJvcHMub25TdWJtaXQpIHsKICAgICAgICBpZiAoX3RoaXMucGVyc2lzdGVkTG9nKSB7CiAgICAgICAgICBfdGhpcy5wZXJzaXN0ZWRMb2cuYWRkKHF1ZXJ5LnF1ZXJ5KTsKICAgICAgICB9CgogICAgICAgIF90aGlzLnByb3BzLm9uU3VibWl0KHsKICAgICAgICAgIHF1ZXJ5OiAoMCwgXy5mcm9tVXNlcikocXVlcnkucXVlcnkpLAogICAgICAgICAgbGFuZ3VhZ2U6IHF1ZXJ5Lmxhbmd1YWdlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ2hhbmdlIiwgZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICAgIF90aGlzLnVwZGF0ZVN1Z2dlc3Rpb25zKCk7CgogICAgICBpZiAoX3RoaXMucHJvcHMub25DaGFuZ2UpIHsKICAgICAgICBfdGhpcy5wcm9wcy5vbkNoYW5nZSh7CiAgICAgICAgICBxdWVyeTogKDAsIF8uZnJvbVVzZXIpKHF1ZXJ5LnF1ZXJ5KSwKICAgICAgICAgIGxhbmd1YWdlOiBxdWVyeS5sYW5ndWFnZQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblF1ZXJ5U3RyaW5nQ2hhbmdlIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogdHJ1ZSwKICAgICAgICBpbmRleDogbnVsbCwKICAgICAgICBzdWdnZXN0aW9uTGltaXQ6IDUwCiAgICAgIH0pOwoKICAgICAgX3RoaXMub25DaGFuZ2UoewogICAgICAgIHF1ZXJ5OiB2YWx1ZSwKICAgICAgICBsYW5ndWFnZTogX3RoaXMucHJvcHMucXVlcnkubGFuZ3VhZ2UKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbklucHV0Q2hhbmdlIiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UoZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ2xpY2tJbnB1dCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoZXZlbnQudGFyZ2V0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UoZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25LZXlVcCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoW0tFWV9DT0RFUy5MRUZULCBLRVlfQ09ERVMuUklHSFQsIEtFWV9DT0RFUy5IT01FLCBLRVlfQ09ERVMuRU5EXS5pbmNsdWRlcyhldmVudC5rZXlDb2RlKSkgewogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiB0cnVlCiAgICAgICAgfSk7CgogICAgICAgIGlmIChldmVudC50YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgICBfdGhpcy5vblF1ZXJ5U3RyaW5nQ2hhbmdlKGV2ZW50LnRhcmdldC52YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbktleURvd24iLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LnRhcmdldCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICB2YXIgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGUgPSBfdGhpcyRzdGF0ZS5pc1N1Z2dlc3Rpb25zVmlzaWJsZSwKICAgICAgICAgICAgaW5kZXggPSBfdGhpcyRzdGF0ZS5pbmRleDsKICAgICAgICB2YXIgcHJldmVudERlZmF1bHQgPSBldmVudC5wcmV2ZW50RGVmYXVsdC5iaW5kKGV2ZW50KTsKICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LAogICAgICAgICAgICBrZXkgPSBldmVudC5rZXksCiAgICAgICAgICAgIG1ldGFLZXkgPSBldmVudC5tZXRhS2V5OwogICAgICAgIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZSwKICAgICAgICAgICAgX3NlbGVjdGlvblN0YXJ0ID0gdGFyZ2V0LnNlbGVjdGlvblN0YXJ0LAogICAgICAgICAgICBfc2VsZWN0aW9uRW5kID0gdGFyZ2V0LnNlbGVjdGlvbkVuZDsKCiAgICAgICAgdmFyIHVwZGF0ZVF1ZXJ5ID0gZnVuY3Rpb24gdXBkYXRlUXVlcnkocXVlcnksIG5ld1NlbGVjdGlvblN0YXJ0LCBuZXdTZWxlY3Rpb25FbmQpIHsKICAgICAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UocXVlcnkpOwoKICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgc2VsZWN0aW9uU3RhcnQ6IG5ld1NlbGVjdGlvblN0YXJ0LAogICAgICAgICAgICBzZWxlY3Rpb25FbmQ6IG5ld1NlbGVjdGlvbkVuZAogICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgc3dpdGNoIChldmVudC5rZXlDb2RlKSB7CiAgICAgICAgICBjYXNlIEtFWV9DT0RFUy5ET1dOOgogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKGlzU3VnZ2VzdGlvbnNWaXNpYmxlICYmIGluZGV4ICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgX3RoaXMuaW5jcmVtZW50SW5kZXgoaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgaW5kZXg6IDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBLRVlfQ09ERVMuVVA6CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICBpZiAoaXNTdWdnZXN0aW9uc1Zpc2libGUgJiYgaW5kZXggIT09IG51bGwpIHsKICAgICAgICAgICAgICBfdGhpcy5kZWNyZW1lbnRJbmRleChpbmRleCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgS0VZX0NPREVTLkVOVEVSOgogICAgICAgICAgICBpZiAoIV90aGlzLnByb3BzLmJ1YmJsZVN1Ym1pdEV2ZW50KSB7CiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzU3VnZ2VzdGlvbnNWaXNpYmxlICYmIGluZGV4ICE9PSBudWxsICYmIF90aGlzLnN0YXRlLnN1Z2dlc3Rpb25zW2luZGV4XSkgewogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgIF90aGlzLnNlbGVjdFN1Z2dlc3Rpb24oX3RoaXMuc3RhdGUuc3VnZ2VzdGlvbnNbaW5kZXhdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpcy5vblN1Ym1pdChfdGhpcy5wcm9wcy5xdWVyeSk7CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiBmYWxzZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIEtFWV9DT0RFUy5FU0M6CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGU6IGZhbHNlLAogICAgICAgICAgICAgIGluZGV4OiBudWxsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBLRVlfQ09ERVMuVEFCOgogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGU6IGZhbHNlLAogICAgICAgICAgICAgIGluZGV4OiBudWxsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgaWYgKF9zZWxlY3Rpb25TdGFydCAhPT0gbnVsbCAmJiBfc2VsZWN0aW9uRW5kICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgKDAsIF8ubWF0Y2hQYWlycykoewogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgc2VsZWN0aW9uU3RhcnQ6IF9zZWxlY3Rpb25TdGFydCwKICAgICAgICAgICAgICAgIHNlbGVjdGlvbkVuZDogX3NlbGVjdGlvbkVuZCwKICAgICAgICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgICAgICAgbWV0YUtleTogbWV0YUtleSwKICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5OiB1cGRhdGVRdWVyeSwKICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0OiBwcmV2ZW50RGVmYXVsdAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlbGVjdFN1Z2dlc3Rpb24iLCBmdW5jdGlvbiAoc3VnZ2VzdGlvbikgewogICAgICBpZiAoIV90aGlzLmlucHV0UmVmKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdHlwZSA9IHN1Z2dlc3Rpb24udHlwZSwKICAgICAgICAgIHRleHQgPSBzdWdnZXN0aW9uLnRleHQsCiAgICAgICAgICBzdGFydCA9IHN1Z2dlc3Rpb24uc3RhcnQsCiAgICAgICAgICBlbmQgPSBzdWdnZXN0aW9uLmVuZCwKICAgICAgICAgIGN1cnNvckluZGV4ID0gc3VnZ2VzdGlvbi5jdXJzb3JJbmRleDsKCiAgICAgIF90aGlzLmhhbmRsZU5lc3RlZEZpZWxkU3ludGF4Tm90aWZpY2F0aW9uKHN1Z2dlc3Rpb24pOwoKICAgICAgdmFyIHF1ZXJ5ID0gX3RoaXMuZ2V0UXVlcnlTdHJpbmcoKTsKCiAgICAgIHZhciBfdGhpcyRpbnB1dFJlZjIgPSBfdGhpcy5pbnB1dFJlZiwKICAgICAgICAgIHNlbGVjdGlvblN0YXJ0ID0gX3RoaXMkaW5wdXRSZWYyLnNlbGVjdGlvblN0YXJ0LAogICAgICAgICAgc2VsZWN0aW9uRW5kID0gX3RoaXMkaW5wdXRSZWYyLnNlbGVjdGlvbkVuZDsKCiAgICAgIGlmIChzZWxlY3Rpb25TdGFydCA9PT0gbnVsbCB8fCBzZWxlY3Rpb25FbmQgPT09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB2YWx1ZSA9IHF1ZXJ5LnN1YnN0cigwLCBzZWxlY3Rpb25TdGFydCkgKyBxdWVyeS5zdWJzdHIoc2VsZWN0aW9uRW5kKTsKICAgICAgdmFyIG5ld1F1ZXJ5U3RyaW5nID0gdmFsdWUuc3Vic3RyKDAsIHN0YXJ0KSArIHRleHQgKyB2YWx1ZS5zdWJzdHIoZW5kKTsKCiAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UobmV3UXVlcnlTdHJpbmcpOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHNlbGVjdGlvblN0YXJ0OiBzdGFydCArIChjdXJzb3JJbmRleCA/IGN1cnNvckluZGV4IDogdGV4dC5sZW5ndGgpLAogICAgICAgIHNlbGVjdGlvbkVuZDogc3RhcnQgKyAoY3Vyc29ySW5kZXggPyBjdXJzb3JJbmRleCA6IHRleHQubGVuZ3RoKQogICAgICB9KTsKCiAgICAgIGlmICh0eXBlID09PSByZWNlbnRTZWFyY2hUeXBlKSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGU6IGZhbHNlLAogICAgICAgICAgaW5kZXg6IG51bGwKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMub25TdWJtaXQoewogICAgICAgICAgcXVlcnk6IG5ld1F1ZXJ5U3RyaW5nLAogICAgICAgICAgbGFuZ3VhZ2U6IF90aGlzLnByb3BzLnF1ZXJ5Lmxhbmd1YWdlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZU5lc3RlZEZpZWxkU3ludGF4Tm90aWZpY2F0aW9uIiwgZnVuY3Rpb24gKHN1Z2dlc3Rpb24pIHsKICAgICAgaWYgKCdmaWVsZCcgaW4gc3VnZ2VzdGlvbiAmJiBzdWdnZXN0aW9uLmZpZWxkLnN1YlR5cGUgJiYgc3VnZ2VzdGlvbi5maWVsZC5zdWJUeXBlLm5lc3RlZCAmJiAhX3RoaXMuc2VydmljZXMuc3RvcmFnZS5nZXQoJ2tpYmFuYS5LUUxOZXN0ZWRRdWVyeVN5bnRheEluZm9PcHRPdXQnKSkgewogICAgICAgIHZhciBfdGhpcyRzZXJ2aWNlcyA9IF90aGlzLnNlcnZpY2VzLAogICAgICAgICAgICBub3RpZmljYXRpb25zID0gX3RoaXMkc2VydmljZXMubm90aWZpY2F0aW9ucywKICAgICAgICAgICAgZG9jTGlua3MgPSBfdGhpcyRzZXJ2aWNlcy5kb2NMaW5rczsKCiAgICAgICAgdmFyIG9uS1FMTmVzdGVkUXVlcnlTeW50YXhJbmZvT3B0T3V0ID0gZnVuY3Rpb24gb25LUUxOZXN0ZWRRdWVyeVN5bnRheEluZm9PcHRPdXQodG9hc3QpIHsKICAgICAgICAgIGlmICghX3RoaXMuc2VydmljZXMuc3RvcmFnZSkgcmV0dXJuOwoKICAgICAgICAgIF90aGlzLnNlcnZpY2VzLnN0b3JhZ2Uuc2V0KCdraWJhbmEuS1FMTmVzdGVkUXVlcnlTeW50YXhJbmZvT3B0T3V0JywgdHJ1ZSk7CgogICAgICAgICAgbm90aWZpY2F0aW9ucy50b2FzdHMucmVtb3ZlKHRvYXN0KTsKICAgICAgICB9OwoKICAgICAgICBpZiAobm90aWZpY2F0aW9ucyAmJiBkb2NMaW5rcykgewogICAgICAgICAgdmFyIHRvYXN0ID0gbm90aWZpY2F0aW9ucy50b2FzdHMuYWRkKHsKICAgICAgICAgICAgdGl0bGU6IF90aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgICAgaWQ6ICdkYXRhLnF1ZXJ5LnF1ZXJ5QmFyLktRTE5lc3RlZFF1ZXJ5U3ludGF4SW5mb1RpdGxlJywKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0tRTCBuZXN0ZWQgcXVlcnkgc3ludGF4JwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgdGV4dDogKDAsIF9wdWJsaWMudG9Nb3VudFBvaW50KShfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogImRhdGEucXVlcnkucXVlcnlCYXIuS1FMTmVzdGVkUXVlcnlTeW50YXhJbmZvVGV4dCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJdCBsb29rcyBsaWtlIHlvdSdyZSBxdWVyeWluZyBvbiBhIG5lc3RlZCBmaWVsZC4gWW91IGNhbiBjb25zdHJ1Y3QgS1FMIHN5bnRheCBmb3IgbmVzdGVkIHF1ZXJpZXMgaW4gZGlmZmVyZW50IHdheXMsIGRlcGVuZGluZyBvbiB0aGUgcmVzdWx0cyB5b3Ugd2FudC4gTGVhcm4gbW9yZSBpbiBvdXIge2xpbmt9LiIsCiAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICBsaW5rOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgICAgICAgICAgICBocmVmOiBkb2NMaW5rcy5saW5rcy5xdWVyeS5rdWVyeVF1ZXJ5U3ludGF4LAogICAgICAgICAgICAgICAgICB0YXJnZXQ6ICJfYmxhbmsiCiAgICAgICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgICAgICBpZDogImRhdGEucXVlcnkucXVlcnlCYXIuS1FMTmVzdGVkUXVlcnlTeW50YXhJbmZvRG9jTGlua1RleHQiLAogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogImRvY3MiCiAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAiZmxleEVuZCIsCiAgICAgICAgICAgICAgZ3V0dGVyU2l6ZTogInMiCiAgICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICAgICAgICBzaXplOiAicyIsCiAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBvbktRTE5lc3RlZFF1ZXJ5U3ludGF4SW5mb09wdE91dCh0b2FzdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAiZGF0YS5xdWVyeS5xdWVyeUJhci5LUUxOZXN0ZWRRdWVyeVN5bnRheEluZm9PcHRPdXRUZXh0IiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRvbid0IHNob3cgYWdhaW4iCiAgICAgICAgICAgIH0pKSkpKSkKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW5jcmVhc2VMaW1pdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHN1Z2dlc3Rpb25MaW1pdDogX3RoaXMuc3RhdGUuc3VnZ2VzdGlvbkxpbWl0ICsgNTAKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJpbmNyZW1lbnRJbmRleCIsIGZ1bmN0aW9uIChjdXJyZW50SW5kZXgpIHsKICAgICAgdmFyIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIDE7CgogICAgICBpZiAoY3VycmVudEluZGV4ID09PSBudWxsIHx8IG5leHRJbmRleCA+PSBfdGhpcy5zdGF0ZS5zdWdnZXN0aW9ucy5sZW5ndGgpIHsKICAgICAgICBuZXh0SW5kZXggPSAwOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaW5kZXg6IG5leHRJbmRleAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRlY3JlbWVudEluZGV4IiwgZnVuY3Rpb24gKGN1cnJlbnRJbmRleCkgewogICAgICB2YXIgcHJldmlvdXNJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7CgogICAgICBpZiAocHJldmlvdXNJbmRleCA8IDApIHsKICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBpbmRleDogX3RoaXMuc3RhdGUuc3VnZ2VzdGlvbnMubGVuZ3RoIC0gMQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGluZGV4OiBwcmV2aW91c0luZGV4CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2VsZWN0TGFuZ3VhZ2UiLCBmdW5jdGlvbiAobGFuZ3VhZ2UpIHsKICAgICAgLy8gU2VuZCB0ZWxlbWV0cnkgaW5mbyBldmVyeSB0aW1lIHRoZSB1c2VyIG9wdHMgaW4gb3Igb3V0IG9mIGt1ZXJ5CiAgICAgIC8vIEFzIGEgcmVzdWx0IGl0IGlzIGltcG9ydGFudCB0aGlzIGZ1bmN0aW9uIG9ubHkgZXZlciBnZXRzIGNhbGxlZCBpbiB0aGUKICAgICAgLy8gVUkgY29tcG9uZW50J3MgY2hhbmdlIGhhbmRsZXIuCiAgICAgIF90aGlzLnNlcnZpY2VzLmh0dHAucG9zdCgnL2FwaS9raWJhbmEva3FsX29wdF9pbl90ZWxlbWV0cnknLCB7CiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgb3B0X2luOiBsYW5ndWFnZSA9PT0gJ2t1ZXJ5JwogICAgICAgIH0pCiAgICAgIH0pOwoKICAgICAgX3RoaXMuc2VydmljZXMuc3RvcmFnZS5zZXQoJ2tpYmFuYS51c2VyUXVlcnlMYW5ndWFnZScsIGxhbmd1YWdlKTsKCiAgICAgIHZhciBuZXdRdWVyeSA9IHsKICAgICAgICBxdWVyeTogJycsCiAgICAgICAgbGFuZ3VhZ2U6IGxhbmd1YWdlCiAgICAgIH07CgogICAgICBfdGhpcy5vbkNoYW5nZShuZXdRdWVyeSk7CgogICAgICBfdGhpcy5vblN1Ym1pdChuZXdRdWVyeSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbk91dHNpZGVDbGljayIsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKF90aGlzLnN0YXRlLmlzU3VnZ2VzdGlvbnNWaXNpYmxlKSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGU6IGZhbHNlLAogICAgICAgICAgaW5kZXg6IG51bGwKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25DbGlja1N1Z2dlc3Rpb24iLCBmdW5jdGlvbiAoc3VnZ2VzdGlvbikgewogICAgICBpZiAoIV90aGlzLmlucHV0UmVmKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBfdGhpcy5zZWxlY3RTdWdnZXN0aW9uKHN1Z2dlc3Rpb24pOwoKICAgICAgX3RoaXMuaW5wdXRSZWYuZm9jdXMoKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImluaXRQZXJzaXN0ZWRMb2ciLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRzZXJ2aWNlczIgPSBfdGhpcy5zZXJ2aWNlcywKICAgICAgICAgIHVpU2V0dGluZ3MgPSBfdGhpcyRzZXJ2aWNlczIudWlTZXR0aW5ncywKICAgICAgICAgIHN0b3JhZ2UgPSBfdGhpcyRzZXJ2aWNlczIuc3RvcmFnZSwKICAgICAgICAgIGFwcE5hbWUgPSBfdGhpcyRzZXJ2aWNlczIuYXBwTmFtZTsKICAgICAgX3RoaXMucGVyc2lzdGVkTG9nID0gX3RoaXMucHJvcHMucGVyc2lzdGVkTG9nID8gX3RoaXMucHJvcHMucGVyc2lzdGVkTG9nIDogKDAsIF8uZ2V0UXVlcnlMb2cpKHVpU2V0dGluZ3MsIHN0b3JhZ2UsIGFwcE5hbWUsIF90aGlzLnByb3BzLnF1ZXJ5Lmxhbmd1YWdlKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uTW91c2VFbnRlclN1Z2dlc3Rpb24iLCBmdW5jdGlvbiAoaW5kZXgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGluZGV4OiBpbmRleAogICAgICB9KTsKICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhRdWVyeVN0cmluZ0lucHV0VUksIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIHZhciBwYXJzZWRRdWVyeSA9ICgwLCBfLmZyb21Vc2VyKSgoMCwgXy50b1VzZXIpKHRoaXMucHJvcHMucXVlcnkucXVlcnkpKTsKCiAgICAgIGlmICghKDAsIF9sb2Rhc2guaXNFcXVhbCkodGhpcy5wcm9wcy5xdWVyeS5xdWVyeSwgcGFyc2VkUXVlcnkpKSB7CiAgICAgICAgdGhpcy5vbkNoYW5nZShfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLnByb3BzLnF1ZXJ5LCB7CiAgICAgICAgICBxdWVyeTogcGFyc2VkUXVlcnkKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdFBlcnNpc3RlZExvZygpOwogICAgICB0aGlzLmZldGNoSW5kZXhQYXR0ZXJucygpLnRoZW4odGhpcy51cGRhdGVTdWdnZXN0aW9ucyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50RGlkVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7CiAgICAgIHZhciBwYXJzZWRRdWVyeSA9ICgwLCBfLmZyb21Vc2VyKSgoMCwgXy50b1VzZXIpKHRoaXMucHJvcHMucXVlcnkucXVlcnkpKTsKCiAgICAgIGlmICghKDAsIF9sb2Rhc2guaXNFcXVhbCkodGhpcy5wcm9wcy5xdWVyeS5xdWVyeSwgcGFyc2VkUXVlcnkpKSB7CiAgICAgICAgdGhpcy5vbkNoYW5nZShfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLnByb3BzLnF1ZXJ5LCB7CiAgICAgICAgICBxdWVyeTogcGFyc2VkUXVlcnkKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdFBlcnNpc3RlZExvZygpOwoKICAgICAgaWYgKCEoMCwgX2xvZGFzaC5pc0VxdWFsKShwcmV2UHJvcHMuaW5kZXhQYXR0ZXJucywgdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zKSkgewogICAgICAgIHRoaXMuZmV0Y2hJbmRleFBhdHRlcm5zKCkudGhlbih0aGlzLnVwZGF0ZVN1Z2dlc3Rpb25zKTsKICAgICAgfSBlbHNlIGlmICghKDAsIF9sb2Rhc2guaXNFcXVhbCkocHJldlByb3BzLnF1ZXJ5LCB0aGlzLnByb3BzLnF1ZXJ5KSkgewogICAgICAgIHRoaXMudXBkYXRlU3VnZ2VzdGlvbnMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3RhdGUuc2VsZWN0aW9uU3RhcnQgIT09IG51bGwgJiYgdGhpcy5zdGF0ZS5zZWxlY3Rpb25FbmQgIT09IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5pbnB1dFJlZikgewogICAgICAgICAgLy8gRm9yIHNvbWUgcmVhc29uIHRoZSB0eXBlIGd1YXJkIGFib3ZlIGRvZXMgbm90IG1ha2UgdGhlIGNvbXBpbGVyIGhhcHB5CiAgICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgICB0aGlzLmlucHV0UmVmLnNldFNlbGVjdGlvblJhbmdlKHRoaXMuc3RhdGUuc2VsZWN0aW9uU3RhcnQsIHRoaXMuc3RhdGUuc2VsZWN0aW9uRW5kKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgc2VsZWN0aW9uU3RhcnQ6IG51bGwsCiAgICAgICAgICBzZWxlY3Rpb25FbmQ6IG51bGwKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxVbm1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHsKICAgICAgdGhpcy51cGRhdGVTdWdnZXN0aW9ucy5jYW5jZWwoKTsKICAgICAgdGhpcy5jb21wb25lbnRJc1VubW91bnRpbmcgPSB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBpc1N1Z2dlc3Rpb25zVmlzaWJsZSA9IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUgJiYgewogICAgICAgICdhcmlhLWNvbnRyb2xzJzogJ2tiblR5cGVhaGVhZF9faXRlbXMnLAogICAgICAgICdhcmlhLW93bnMnOiAna2JuVHlwZWFoZWFkX19pdGVtcycKICAgICAgfTsKCiAgICAgIHZhciBhcmlhQ29tYm9ib3ggPSBfb2JqZWN0U3ByZWFkKHt9LCBpc1N1Z2dlc3Rpb25zVmlzaWJsZSwgewogICAgICAgIHJvbGU6ICdjb21ib2JveCcKICAgICAgfSk7CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aU91dHNpZGVDbGlja0RldGVjdG9yLCB7CiAgICAgICAgb25PdXRzaWRlQ2xpY2s6IHRoaXMub25PdXRzaWRlQ2xpY2sKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgX2V4dGVuZHMoe30sIGFyaWFDb21ib2JveCwgewogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJwogICAgICAgIH0sCiAgICAgICAgImFyaWEtbGFiZWwiOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnZGF0YS5xdWVyeS5xdWVyeUJhci5jb21ib2JveEFyaWFMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2VhcmNoIGFuZCBmaWx0ZXIgdGhlIHtwYWdlVHlwZX0gcGFnZScsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgcGFnZVR5cGU6IHRoaXMuc2VydmljZXMuYXBwTmFtZQogICAgICAgICAgfQogICAgICAgIH0pLAogICAgICAgICJhcmlhLWhhc3BvcHVwIjogInRydWUiLAogICAgICAgICJhcmlhLWV4cGFuZGVkIjogdGhpcy5zdGF0ZS5pc1N1Z2dlc3Rpb25zVmlzaWJsZQogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgIHJvbGU6ICJzZWFyY2giCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJrdWlMb2NhbFNlYXJjaEFzc2lzdGVkSW5wdXQiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZFRleHQsIHsKICAgICAgICBwbGFjZWhvbGRlcjogdGhpcy5wcm9wcy5wbGFjZWhvbGRlciB8fCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnZGF0YS5xdWVyeS5xdWVyeUJhci5zZWFyY2hJbnB1dFBsYWNlaG9sZGVyJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTZWFyY2gnCiAgICAgICAgfSksCiAgICAgICAgdmFsdWU6IHRoaXMuZ2V0UXVlcnlTdHJpbmcoKSwKICAgICAgICBvbktleURvd246IHRoaXMub25LZXlEb3duLAogICAgICAgIG9uS2V5VXA6IHRoaXMub25LZXlVcCwKICAgICAgICBvbkNoYW5nZTogdGhpcy5vbklucHV0Q2hhbmdlLAogICAgICAgIG9uQ2xpY2s6IHRoaXMub25DbGlja0lucHV0LAogICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICBhdXRvRm9jdXM6ICF0aGlzLnByb3BzLmRpc2FibGVBdXRvRm9jdXMsCiAgICAgICAgaW5wdXRSZWY6IGZ1bmN0aW9uIGlucHV0UmVmKG5vZGUpIHsKICAgICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgIF90aGlzMi5pbnB1dFJlZiA9IG5vZGU7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhdXRvQ29tcGxldGU6ICJvZmYiLAogICAgICAgIHNwZWxsQ2hlY2s6IGZhbHNlLAogICAgICAgICJhcmlhLWxhYmVsIjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2RhdGEucXVlcnkucXVlcnlCYXIuc2VhcmNoSW5wdXRBcmlhTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1N0YXJ0IHR5cGluZyB0byBzZWFyY2ggYW5kIGZpbHRlciB0aGUge3BhZ2VUeXBlfSBwYWdlJywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBwYWdlVHlwZTogdGhpcy5zZXJ2aWNlcy5hcHBOYW1lCiAgICAgICAgICB9CiAgICAgICAgfSksCiAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgICJhcmlhLWF1dG9jb21wbGV0ZSI6ICJsaXN0IiwKICAgICAgICAiYXJpYS1jb250cm9scyI6IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUgPyAna2JuVHlwZWFoZWFkX19pdGVtcycgOiB1bmRlZmluZWQsCiAgICAgICAgImFyaWEtYWN0aXZlZGVzY2VuZGFudCI6IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUgJiYgdHlwZW9mIHRoaXMuc3RhdGUuaW5kZXggPT09ICdudW1iZXInID8gInN1Z2dlc3Rpb24tIi5jb25jYXQodGhpcy5zdGF0ZS5pbmRleCkgOiB1bmRlZmluZWQsCiAgICAgICAgcm9sZTogInRleHRib3giLAogICAgICAgIHByZXBlbmQ6IHRoaXMucHJvcHMucHJlcGVuZCwKICAgICAgICBhcHBlbmQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2xhbmd1YWdlX3N3aXRjaGVyLlF1ZXJ5TGFuZ3VhZ2VTd2l0Y2hlciwgewogICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMucHJvcHMucXVlcnkubGFuZ3VhZ2UsCiAgICAgICAgICBhbmNob3JQb3NpdGlvbjogdGhpcy5wcm9wcy5sYW5ndWFnZVN3aXRjaGVyUG9wb3ZlckFuY2hvclBvc2l0aW9uLAogICAgICAgICAgb25TZWxlY3RMYW5ndWFnZTogdGhpcy5vblNlbGVjdExhbmd1YWdlCiAgICAgICAgfSksCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogdGhpcy5wcm9wcy5kYXRhVGVzdFN1YmogfHwgJ3F1ZXJ5SW5wdXQnCiAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXy5TdWdnZXN0aW9uc0NvbXBvbmVudCwgewogICAgICAgIHNob3c6IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUsCiAgICAgICAgc3VnZ2VzdGlvbnM6IHRoaXMuc3RhdGUuc3VnZ2VzdGlvbnMuc2xpY2UoMCwgdGhpcy5zdGF0ZS5zdWdnZXN0aW9uTGltaXQpLAogICAgICAgIGluZGV4OiB0aGlzLnN0YXRlLmluZGV4LAogICAgICAgIG9uQ2xpY2s6IHRoaXMub25DbGlja1N1Z2dlc3Rpb24sCiAgICAgICAgb25Nb3VzZUVudGVyOiB0aGlzLm9uTW91c2VFbnRlclN1Z2dlc3Rpb24sCiAgICAgICAgbG9hZE1vcmU6IHRoaXMuaW5jcmVhc2VMaW1pdAogICAgICB9KSkpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFF1ZXJ5U3RyaW5nSW5wdXRVSTsKfShfcmVhY3QuQ29tcG9uZW50KTsKCmV4cG9ydHMuUXVlcnlTdHJpbmdJbnB1dFVJID0gUXVlcnlTdHJpbmdJbnB1dFVJOwp2YXIgUXVlcnlTdHJpbmdJbnB1dCA9ICgwLCBfcmVhY3QyLmluamVjdEkxOG4pKCgwLCBfcHVibGljLndpdGhLaWJhbmEpKFF1ZXJ5U3RyaW5nSW5wdXRVSSkpOwpleHBvcnRzLlF1ZXJ5U3RyaW5nSW5wdXQgPSBRdWVyeVN0cmluZ0lucHV0Ow=="},null]}