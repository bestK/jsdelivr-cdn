{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/angular/map_controller.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/angular/map_controller.js","mtime":1585205045221},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfY2hyb21lID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1aS9jaHJvbWUiKSk7CgpyZXF1aXJlKCJ1aS9kaXJlY3RpdmVzL2xpc3RlbiIpOwoKcmVxdWlyZSgidWkvZGlyZWN0aXZlcy9zdG9yYWdlIik7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfY2FwYWJpbGl0aWVzID0gcmVxdWlyZSgidWkvY2FwYWJpbGl0aWVzIik7Cgp2YXIgX3JlYWN0RG9tID0gcmVxdWlyZSgicmVhY3QtZG9tIik7Cgp2YXIgX21vZHVsZXMgPSByZXF1aXJlKCJ1aS9tb2R1bGVzIik7Cgp2YXIgX3RpbWVmaWx0ZXIgPSByZXF1aXJlKCJ1aS90aW1lZmlsdGVyIik7Cgp2YXIgX3JlYWN0UmVkdXggPSByZXF1aXJlKCJyZWFjdC1yZWR1eCIpOwoKdmFyIF9zdG9yZSA9IHJlcXVpcmUoIi4uL3JlZHVjZXJzL3N0b3JlIik7Cgp2YXIgX2dpc19tYXAgPSByZXF1aXJlKCIuLi9jb25uZWN0ZWRfY29tcG9uZW50cy9naXNfbWFwIik7Cgp2YXIgX2hlbHBfbWVudV91dGlsID0gcmVxdWlyZSgiLi4vaGVscF9tZW51X3V0aWwiKTsKCnZhciBfbWFwX2FjdGlvbnMgPSByZXF1aXJlKCIuLi9hY3Rpb25zL21hcF9hY3Rpb25zIik7Cgp2YXIgX3VpID0gcmVxdWlyZSgiLi4vcmVkdWNlcnMvdWkiKTsKCnZhciBfdWlfYWN0aW9ucyA9IHJlcXVpcmUoIi4uL2FjdGlvbnMvdWlfYWN0aW9ucyIpOwoKdmFyIF91aV9zZWxlY3RvcnMgPSByZXF1aXJlKCIuLi9zZWxlY3RvcnMvdWlfc2VsZWN0b3JzIik7Cgp2YXIgX3V0aWwgPSByZXF1aXJlKCIuLi9yZWR1Y2Vycy91dGlsIik7Cgp2YXIgX21hcF9zZWxlY3RvcnMgPSByZXF1aXJlKCIuLi9zZWxlY3RvcnMvbWFwX3NlbGVjdG9ycyIpOwoKdmFyIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcyA9IHJlcXVpcmUoIi4uL3JlZHVjZXJzL25vbl9zZXJpYWxpemFibGVfaW5zdGFuY2VzIik7Cgp2YXIgX2luc3BlY3RvciA9IHJlcXVpcmUoInVpL2luc3BlY3RvciIpOwoKdmFyIF9kb2NfdGl0bGUgPSByZXF1aXJlKCJ1aS9kb2NfdGl0bGUiKTsKCnZhciBfa2liYW5hX3NlcnZpY2VzID0gcmVxdWlyZSgiLi4va2liYW5hX3NlcnZpY2VzIik7Cgp2YXIgX3NhdmVkX29iamVjdF9zYXZlX21vZGFsID0gcmVxdWlyZSgidWkvc2F2ZWRfb2JqZWN0cy9jb21wb25lbnRzL3NhdmVkX29iamVjdF9zYXZlX21vZGFsIik7Cgp2YXIgX3Nob3dfc2F2ZWRfb2JqZWN0X3NhdmVfbW9kYWwgPSByZXF1aXJlKCJ1aS9zYXZlZF9vYmplY3RzL3Nob3dfc2F2ZWRfb2JqZWN0X3NhdmVfbW9kYWwiKTsKCnZhciBfbm90aWZ5ID0gcmVxdWlyZSgidWkvbm90aWZ5Iik7Cgp2YXIgX2dldF9pbml0aWFsX2xheWVycyA9IHJlcXVpcmUoIi4vZ2V0X2luaXRpYWxfbGF5ZXJzIik7Cgp2YXIgX2dldF9pbml0aWFsX3F1ZXJ5ID0gcmVxdWlyZSgiLi9nZXRfaW5pdGlhbF9xdWVyeSIpOwoKdmFyIF9nZXRfaW5pdGlhbF90aW1lX2ZpbHRlcnMgPSByZXF1aXJlKCIuL2dldF9pbml0aWFsX3RpbWVfZmlsdGVycyIpOwoKdmFyIF9nZXRfaW5pdGlhbF9yZWZyZXNoX2NvbmZpZyA9IHJlcXVpcmUoIi4vZ2V0X2luaXRpYWxfcmVmcmVzaF9jb25maWciKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vY29tbW9uL2NvbnN0YW50cyIpOwoKdmFyIF9uZXdfcGxhdGZvcm0gPSByZXF1aXJlKCJ1aS9uZXdfcGxhdGZvcm0iKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsdWdpbnMvZGF0YS9wdWJsaWMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9Cgp2YXIgc2F2ZWRRdWVyeVNlcnZpY2UgPSBfbmV3X3BsYXRmb3JtLm5wU3RhcnQucGx1Z2lucy5kYXRhLnF1ZXJ5LnNhdmVkUXVlcmllczsKdmFyIFJFQUNUX0FOQ0hPUl9ET01fRUxFTUVOVF9JRCA9ICdyZWFjdC1tYXBzLXJvb3QnOwoKdmFyIGFwcCA9IF9tb2R1bGVzLnVpTW9kdWxlcy5nZXQoX2NvbnN0YW50cy5NQVBfQVBQX1BBVEgsIFtdKTsKCmFwcC5jb250cm9sbGVyKCdHaXNNYXBDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJHJvdXRlLCBrYm5VcmwsIGxvY2FsU3RvcmFnZSwgQXBwU3RhdGUsIGdsb2JhbFN0YXRlKSB7CiAgdmFyIGZpbHRlck1hbmFnZXIgPSBfbmV3X3BsYXRmb3JtLm5wU3RhcnQucGx1Z2lucy5kYXRhLnF1ZXJ5LmZpbHRlck1hbmFnZXI7CiAgdmFyIHNhdmVkTWFwID0gJHJvdXRlLmN1cnJlbnQubG9jYWxzLm1hcDsKICAkc2NvcGUuc2NyZWVuVGl0bGUgPSBzYXZlZE1hcC50aXRsZTsKICB2YXIgdW5zdWJzY3JpYmU7CiAgdmFyIGluaXRpYWxMYXllckxpc3RDb25maWc7CiAgdmFyICRzdGF0ZSA9IG5ldyBBcHBTdGF0ZSgpOwogIHZhciBzdG9yZSA9ICgwLCBfc3RvcmUuY3JlYXRlTWFwU3RvcmUpKCk7CgogIGZ1bmN0aW9uIGdldEFwcFN0YXRlRmlsdGVycygpIHsKICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuZ2V0KCRzdGF0ZSwgJ2ZpbHRlcnMnLCBbXSk7CiAgfQoKICAkc2NvcGUuJGxpc3RlbihnbG9iYWxTdGF0ZSwgJ2ZldGNoX3dpdGhfY2hhbmdlcycsIGZ1bmN0aW9uIChkaWZmKSB7CiAgICBpZiAoZGlmZi5pbmNsdWRlcygndGltZScpIHx8IGRpZmYuaW5jbHVkZXMoJ2ZpbHRlcnMnKSkgewogICAgICBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgICBmaWx0ZXJzOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGdsb2JhbFN0YXRlLmZpbHRlcnMpLCBfdG9Db25zdW1hYmxlQXJyYXkoZ2V0QXBwU3RhdGVGaWx0ZXJzKCkpKSwKICAgICAgICB0aW1lOiBnbG9iYWxTdGF0ZS50aW1lCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChkaWZmLmluY2x1ZGVzKCdyZWZyZXNoSW50ZXJ2YWwnKSkgewogICAgICAkc2NvcGUub25SZWZyZXNoQ2hhbmdlKHsKICAgICAgICBpc1BhdXNlZDogZ2xvYmFsU3RhdGUucGF1c2UsCiAgICAgICAgcmVmcmVzaEludGVydmFsOiBnbG9iYWxTdGF0ZS52YWx1ZQogICAgICB9KTsKICAgIH0KICB9KTsKICAkc2NvcGUuJGxpc3Rlbigkc3RhdGUsICdmZXRjaF93aXRoX2NoYW5nZXMnLCBmdW5jdGlvbiAoZGlmZikgewogICAgaWYgKChkaWZmLmluY2x1ZGVzKCdxdWVyeScpIHx8IGRpZmYuaW5jbHVkZXMoJ2ZpbHRlcnMnKSkgJiYgJHN0YXRlLnF1ZXJ5KSB7CiAgICAgIG9uUXVlcnlDaGFuZ2UoewogICAgICAgIGZpbHRlcnM6IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZ2xvYmFsU3RhdGUuZmlsdGVycyksIF90b0NvbnN1bWFibGVBcnJheShnZXRBcHBTdGF0ZUZpbHRlcnMoKSkpLAogICAgICAgIHF1ZXJ5OiAkc3RhdGUucXVlcnkKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIGZ1bmN0aW9uIHN5bmNBcHBBbmRHbG9iYWxTdGF0ZSgpIHsKICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgLy8gYXBwU3RhdGUKICAgICAgJHN0YXRlLnF1ZXJ5ID0gJHNjb3BlLnF1ZXJ5OwogICAgICAkc3RhdGUuZmlsdGVycyA9IGZpbHRlck1hbmFnZXIuZ2V0QXBwRmlsdGVycygpOwogICAgICAkc3RhdGUuc2F2ZSgpOyAvLyBnbG9iYWxTdGF0ZQoKICAgICAgZ2xvYmFsU3RhdGUudGltZSA9ICRzY29wZS50aW1lOwogICAgICBnbG9iYWxTdGF0ZS5yZWZyZXNoSW50ZXJ2YWwgPSB7CiAgICAgICAgcGF1c2U6ICRzY29wZS5yZWZyZXNoQ29uZmlnLmlzUGF1c2VkLAogICAgICAgIHZhbHVlOiAkc2NvcGUucmVmcmVzaENvbmZpZy5pbnRlcnZhbAogICAgICB9OwogICAgICBnbG9iYWxTdGF0ZS5maWx0ZXJzID0gZmlsdGVyTWFuYWdlci5nZXRHbG9iYWxGaWx0ZXJzKCk7CiAgICAgIGdsb2JhbFN0YXRlLnNhdmUoKTsKICAgIH0pOwogIH0KCiAgJHNjb3BlLnF1ZXJ5ID0gKDAsIF9nZXRfaW5pdGlhbF9xdWVyeS5nZXRJbml0aWFsUXVlcnkpKHsKICAgIG1hcFN0YXRlSlNPTjogc2F2ZWRNYXAubWFwU3RhdGVKU09OLAogICAgYXBwU3RhdGU6ICRzdGF0ZSwKICAgIHVzZXJRdWVyeUxhbmd1YWdlOiBsb2NhbFN0b3JhZ2UuZ2V0KCdraWJhbmEudXNlclF1ZXJ5TGFuZ3VhZ2UnKQogIH0pOwogICRzY29wZS50aW1lID0gKDAsIF9nZXRfaW5pdGlhbF90aW1lX2ZpbHRlcnMuZ2V0SW5pdGlhbFRpbWVGaWx0ZXJzKSh7CiAgICBtYXBTdGF0ZUpTT046IHNhdmVkTWFwLm1hcFN0YXRlSlNPTiwKICAgIGdsb2JhbFN0YXRlOiBnbG9iYWxTdGF0ZQogIH0pOwogICRzY29wZS5yZWZyZXNoQ29uZmlnID0gKDAsIF9nZXRfaW5pdGlhbF9yZWZyZXNoX2NvbmZpZy5nZXRJbml0aWFsUmVmcmVzaENvbmZpZykoewogICAgbWFwU3RhdGVKU09OOiBzYXZlZE1hcC5tYXBTdGF0ZUpTT04sCiAgICBnbG9iYWxTdGF0ZTogZ2xvYmFsU3RhdGUKICB9KTsKICAvKiBTYXZlZCBRdWVyaWVzICovCgogICRzY29wZS5zaG93U2F2ZVF1ZXJ5ID0gX2NhcGFiaWxpdGllcy5jYXBhYmlsaXRpZXMuZ2V0KCkubWFwcy5zYXZlUXVlcnk7CiAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gX2NhcGFiaWxpdGllcy5jYXBhYmlsaXRpZXMuZ2V0KCkubWFwcy5zYXZlUXVlcnk7CiAgfSwgZnVuY3Rpb24gKG5ld0NhcGFiaWxpdHkpIHsKICAgICRzY29wZS5zaG93U2F2ZVF1ZXJ5ID0gbmV3Q2FwYWJpbGl0eTsKICB9KTsKCiAgJHNjb3BlLm9uUXVlcnlTYXZlZCA9IGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHNhdmVkUXVlcnk7CiAgfTsKCiAgJHNjb3BlLm9uU2F2ZWRRdWVyeVVwZGF0ZWQgPSBmdW5jdGlvbiAoc2F2ZWRRdWVyeSkgewogICAgJHNjb3BlLnNhdmVkUXVlcnkgPSBfb2JqZWN0U3ByZWFkKHt9LCBzYXZlZFF1ZXJ5KTsKICB9OwoKICAkc2NvcGUub25DbGVhclNhdmVkUXVlcnkgPSBmdW5jdGlvbiAoKSB7CiAgICBkZWxldGUgJHNjb3BlLnNhdmVkUXVlcnk7CiAgICBkZWxldGUgJHN0YXRlLnNhdmVkUXVlcnk7CiAgICBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgZmlsdGVyczogW10sCiAgICAgIHF1ZXJ5OiB7CiAgICAgICAgcXVlcnk6ICcnLAogICAgICAgIGxhbmd1YWdlOiBsb2NhbFN0b3JhZ2UuZ2V0KCdraWJhbmEudXNlclF1ZXJ5TGFuZ3VhZ2UnKQogICAgICB9CiAgICB9KTsKICB9OwoKICBmdW5jdGlvbiB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KHNhdmVkUXVlcnkpIHsKICAgIGlmIChzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlcikgewogICAgICBpZiAoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIucmVmcmVzaEludGVydmFsKSB7CiAgICAgICAgJHNjb3BlLm9uUmVmcmVzaENoYW5nZSh7CiAgICAgICAgICBpc1BhdXNlZDogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIucmVmcmVzaEludGVydmFsLnBhdXNlLAogICAgICAgICAgcmVmcmVzaEludGVydmFsOiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5yZWZyZXNoSW50ZXJ2YWwudmFsdWUKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgb25RdWVyeUNoYW5nZSh7CiAgICAgICAgZmlsdGVyczogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLmZpbHRlcnMgfHwgW10sCiAgICAgICAgcXVlcnk6IHNhdmVkUXVlcnkuYXR0cmlidXRlcy5xdWVyeSwKICAgICAgICB0aW1lOiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlcgogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIG9uUXVlcnlDaGFuZ2UoewogICAgICAgIGZpbHRlcnM6IHNhdmVkUXVlcnkuYXR0cmlidXRlcy5maWx0ZXJzIHx8IFtdLAogICAgICAgIHF1ZXJ5OiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMucXVlcnkKICAgICAgfSk7CiAgICB9CiAgfQoKICAkc2NvcGUuJHdhdGNoKCdzYXZlZFF1ZXJ5JywgZnVuY3Rpb24gKG5ld1NhdmVkUXVlcnkpIHsKICAgIGlmICghbmV3U2F2ZWRRdWVyeSkgcmV0dXJuOwogICAgJHN0YXRlLnNhdmVkUXVlcnkgPSBuZXdTYXZlZFF1ZXJ5LmlkOwogICAgdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShuZXdTYXZlZFF1ZXJ5KTsKICB9KTsKICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAkc3RhdGUuc2F2ZWRRdWVyeTsKICB9LCBmdW5jdGlvbiAobmV3U2F2ZWRRdWVyeUlkKSB7CiAgICBpZiAoIW5ld1NhdmVkUXVlcnlJZCkgewogICAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHVuZGVmaW5lZDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICgkc2NvcGUuc2F2ZWRRdWVyeSAmJiBuZXdTYXZlZFF1ZXJ5SWQgIT09ICRzY29wZS5zYXZlZFF1ZXJ5LmlkKSB7CiAgICAgIHNhdmVkUXVlcnlTZXJ2aWNlLmdldFNhdmVkUXVlcnkobmV3U2F2ZWRRdWVyeUlkKS50aGVuKGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICAgJHNjb3BlLnNhdmVkUXVlcnkgPSBzYXZlZFF1ZXJ5OwogICAgICAgICAgdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShzYXZlZFF1ZXJ5KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSk7CiAgLyogRW5kIG9mIFNhdmVkIFF1ZXJpZXMgKi8KCiAgZnVuY3Rpb24gb25RdWVyeUNoYW5nZShfcmVmKSB7CiAgICB2YXIgZmlsdGVycywgcXVlcnksIHRpbWUsIHJlZnJlc2g7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIG9uUXVlcnlDaGFuZ2UkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBmaWx0ZXJzID0gX3JlZi5maWx0ZXJzLCBxdWVyeSA9IF9yZWYucXVlcnksIHRpbWUgPSBfcmVmLnRpbWUsIHJlZnJlc2ggPSBfcmVmLnJlZnJlc2g7CgogICAgICAgICAgICBpZiAoZmlsdGVycykgewogICAgICAgICAgICAgIGZpbHRlck1hbmFnZXIuc2V0RmlsdGVycyhmaWx0ZXJzKTsgLy8gTWFwcyBhbmQgbWVyZ2VzIGZpbHRlcnMKCiAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlcnMgPSBmaWx0ZXJNYW5hZ2VyLmdldEZpbHRlcnMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHF1ZXJ5KSB7CiAgICAgICAgICAgICAgJHNjb3BlLnF1ZXJ5ID0gcXVlcnk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aW1lKSB7CiAgICAgICAgICAgICAgJHNjb3BlLnRpbWUgPSB0aW1lOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzeW5jQXBwQW5kR2xvYmFsU3RhdGUoKTsKICAgICAgICAgICAgZGlzcGF0Y2hTZXRRdWVyeShyZWZyZXNoKTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBkaXNwYXRjaFNldFF1ZXJ5KHJlZnJlc2gpIHsKICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfbWFwX2FjdGlvbnMuc2V0UXVlcnkpKHsKICAgICAgZmlsdGVyczogJHNjb3BlLmZpbHRlcnMsCiAgICAgIHF1ZXJ5OiAkc2NvcGUucXVlcnksCiAgICAgIHRpbWVGaWx0ZXJzOiAkc2NvcGUudGltZSwKICAgICAgcmVmcmVzaDogcmVmcmVzaAogICAgfSkpOwogIH0KCiAgJHNjb3BlLmluZGV4UGF0dGVybnMgPSBbXTsKCiAgJHNjb3BlLm9uUXVlcnlTdWJtaXQgPSBmdW5jdGlvbiAoX3JlZjIpIHsKICAgIHZhciBkYXRlUmFuZ2UgPSBfcmVmMi5kYXRlUmFuZ2UsCiAgICAgICAgcXVlcnkgPSBfcmVmMi5xdWVyeTsKICAgIG9uUXVlcnlDaGFuZ2UoewogICAgICBxdWVyeTogcXVlcnksCiAgICAgIHRpbWU6IGRhdGVSYW5nZSwKICAgICAgcmVmcmVzaDogdHJ1ZQogICAgfSk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUZpbHRlcnNBbmREaXNwYXRjaCA9IGZ1bmN0aW9uIChmaWx0ZXJzKSB7CiAgICBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgZmlsdGVyczogZmlsdGVycwogICAgfSk7CiAgfTsKCiAgJHNjb3BlLm9uUmVmcmVzaENoYW5nZSA9IGZ1bmN0aW9uIChfcmVmMykgewogICAgdmFyIGlzUGF1c2VkID0gX3JlZjMuaXNQYXVzZWQsCiAgICAgICAgcmVmcmVzaEludGVydmFsID0gX3JlZjMucmVmcmVzaEludGVydmFsOwogICAgJHNjb3BlLnJlZnJlc2hDb25maWcgPSB7CiAgICAgIGlzUGF1c2VkOiBpc1BhdXNlZCwKICAgICAgaW50ZXJ2YWw6IHJlZnJlc2hJbnRlcnZhbCA/IHJlZnJlc2hJbnRlcnZhbCA6ICRzY29wZS5yZWZyZXNoQ29uZmlnLmludGVydmFsCiAgICB9OwogICAgc3luY0FwcEFuZEdsb2JhbFN0YXRlKCk7CiAgICBzdG9yZS5kaXNwYXRjaCgoMCwgX21hcF9hY3Rpb25zLnNldFJlZnJlc2hDb25maWcpKCRzY29wZS5yZWZyZXNoQ29uZmlnKSk7CiAgfTsKCiAgZnVuY3Rpb24gYWRkRmlsdGVycyhuZXdGaWx0ZXJzKSB7CiAgICBuZXdGaWx0ZXJzLmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikgewogICAgICBmaWx0ZXIuJHN0YXRlID0gX3B1YmxpYy5lc0ZpbHRlcnMuRmlsdGVyU3RhdGVTdG9yZS5BUFBfU1RBVEU7CiAgICB9KTsKICAgICRzY29wZS51cGRhdGVGaWx0ZXJzQW5kRGlzcGF0Y2goW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSgkc2NvcGUuZmlsdGVycyksIF90b0NvbnN1bWFibGVBcnJheShuZXdGaWx0ZXJzKSkpOwogIH0KCiAgZnVuY3Rpb24gaGFzVW5zYXZlZENoYW5nZXMoKSB7CiAgICB2YXIgc3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpOwogICAgdmFyIGxheWVyTGlzdCA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRMYXllckxpc3RSYXcpKHN0YXRlKTsKICAgIHZhciBsYXllckxpc3RDb25maWdPbmx5ID0gKDAsIF91dGlsLmNvcHlQZXJzaXN0ZW50U3RhdGUpKGxheWVyTGlzdCk7CiAgICB2YXIgc2F2ZWRMYXllckxpc3QgPSBzYXZlZE1hcC5nZXRMYXllckxpc3QoKTsKICAgIHZhciBvbGRDb25maWcgPSBzYXZlZExheWVyTGlzdCA/IHNhdmVkTGF5ZXJMaXN0IDogaW5pdGlhbExheWVyTGlzdENvbmZpZzsKICAgIHJldHVybiAhX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwobGF5ZXJMaXN0Q29uZmlnT25seSwgb2xkQ29uZmlnKTsKICB9CgogIGZ1bmN0aW9uIGlzT25NYXBOb3coKSB7CiAgICByZXR1cm4gd2luZG93LmxvY2F0aW9uLmhhc2guc3RhcnRzV2l0aCgiIy8iLmNvbmNhdChfY29uc3RhbnRzLk1BUF9TQVZFRF9PQkpFQ1RfVFlQRSkpOwogIH0KCiAgZnVuY3Rpb24gYmVmb3JlVW5sb2FkKGV2ZW50KSB7CiAgICBpZiAoIWlzT25NYXBOb3coKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGhhc0NoYW5nZWQgPSBoYXNVbnNhdmVkQ2hhbmdlcygpOwoKICAgIGlmIChoYXNDaGFuZ2VkKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gJ2Zvb2Jhcic7IC8vdGhpcyBpcyByZXF1aXJlZCBmb3IgQ2hyb21lCiAgICB9CiAgfQoKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgYmVmb3JlVW5sb2FkKTsKCiAgZnVuY3Rpb24gcmVuZGVyTWFwKCkgewogICAgdmFyIHNhdmVkT2JqZWN0RmlsdGVycywgbWFwU3RhdGUsIHVpU3RhdGUsIGxheWVyTGlzdCwgaW5pdGlhbEZpbHRlcnMsIHJvb3Q7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIHJlbmRlck1hcCQoX2NvbnRleHQyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIC8vIGNsZWFyIG9sZCBVSSBzdGF0ZQogICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgoMCwgX21hcF9hY3Rpb25zLnNldFNlbGVjdGVkTGF5ZXIpKG51bGwpKTsKICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF91aV9hY3Rpb25zLnVwZGF0ZUZseW91dCkoX3VpLkZMWU9VVF9TVEFURS5OT05FKSk7CiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfdWlfYWN0aW9ucy5zZXRSZWFkT25seSkoIV9jYXBhYmlsaXRpZXMuY2FwYWJpbGl0aWVzLmdldCgpLm1hcHMuc2F2ZSkpOwogICAgICAgICAgICBoYW5kbGVTdG9yZUNoYW5nZXMoc3RvcmUpOwogICAgICAgICAgICB1bnN1YnNjcmliZSA9IHN0b3JlLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaGFuZGxlU3RvcmVDaGFuZ2VzKHN0b3JlKTsKICAgICAgICAgICAgfSk7IC8vIHN5bmMgc3RvcmUgd2l0aCBzYXZlZE1hcCBtYXBTdGF0ZQoKICAgICAgICAgICAgc2F2ZWRPYmplY3RGaWx0ZXJzID0gW107CgogICAgICAgICAgICBpZiAoc2F2ZWRNYXAubWFwU3RhdGVKU09OKSB7CiAgICAgICAgICAgICAgbWFwU3RhdGUgPSBKU09OLnBhcnNlKHNhdmVkTWFwLm1hcFN0YXRlSlNPTik7CiAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF9tYXBfYWN0aW9ucy5zZXRHb3RvV2l0aENlbnRlcikoewogICAgICAgICAgICAgICAgbGF0OiBtYXBTdGF0ZS5jZW50ZXIubGF0LAogICAgICAgICAgICAgICAgbG9uOiBtYXBTdGF0ZS5jZW50ZXIubG9uLAogICAgICAgICAgICAgICAgem9vbTogbWFwU3RhdGUuem9vbQogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgaWYgKG1hcFN0YXRlLmZpbHRlcnMpIHsKICAgICAgICAgICAgICAgIHNhdmVkT2JqZWN0RmlsdGVycyA9IG1hcFN0YXRlLmZpbHRlcnM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2F2ZWRNYXAudWlTdGF0ZUpTT04pIHsKICAgICAgICAgICAgICB1aVN0YXRlID0gSlNPTi5wYXJzZShzYXZlZE1hcC51aVN0YXRlSlNPTik7CiAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF91aV9hY3Rpb25zLnNldElzTGF5ZXJUT0NPcGVuKShfbG9kYXNoLmRlZmF1bHQuZ2V0KHVpU3RhdGUsICdpc0xheWVyVE9DT3BlbicsIF91aS5ERUZBVUxUX0lTX0xBWUVSX1RPQ19PUEVOKSkpOwogICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfdWlfYWN0aW9ucy5zZXRPcGVuVE9DRGV0YWlscykoX2xvZGFzaC5kZWZhdWx0LmdldCh1aVN0YXRlLCAnb3BlblRPQ0RldGFpbHMnLCBbXSkpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGF5ZXJMaXN0ID0gKDAsIF9nZXRfaW5pdGlhbF9sYXllcnMuZ2V0SW5pdGlhbExheWVycykoc2F2ZWRNYXAubGF5ZXJMaXN0SlNPTik7CiAgICAgICAgICAgIGluaXRpYWxMYXllckxpc3RDb25maWcgPSAoMCwgX3V0aWwuY29weVBlcnNpc3RlbnRTdGF0ZSkobGF5ZXJMaXN0KTsKICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF9tYXBfYWN0aW9ucy5yZXBsYWNlTGF5ZXJMaXN0KShsYXllckxpc3QpKTsKICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF9tYXBfYWN0aW9ucy5zZXRSZWZyZXNoQ29uZmlnKSgkc2NvcGUucmVmcmVzaENvbmZpZykpOwogICAgICAgICAgICBpbml0aWFsRmlsdGVycyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoX2xvZGFzaC5kZWZhdWx0LmdldChnbG9iYWxTdGF0ZSwgJ2ZpbHRlcnMnLCBbXSkpLCBfdG9Db25zdW1hYmxlQXJyYXkoZ2V0QXBwU3RhdGVGaWx0ZXJzKCkpLCBfdG9Db25zdW1hYmxlQXJyYXkoc2F2ZWRPYmplY3RGaWx0ZXJzKSk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTU7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAob25RdWVyeUNoYW5nZSh7CiAgICAgICAgICAgICAgZmlsdGVyczogaW5pdGlhbEZpbHRlcnMKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgIHJvb3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChSRUFDVF9BTkNIT1JfRE9NX0VMRU1FTlRfSUQpOwogICAgICAgICAgICAoMCwgX3JlYWN0RG9tLnJlbmRlcikoX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3RSZWR1eC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHN0b3JlOiBzdG9yZQogICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuSTE4blByb3ZpZGVyLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9naXNfbWFwLkdpc01hcCwgewogICAgICAgICAgICAgIGFkZEZpbHRlcnM6IGFkZEZpbHRlcnMKICAgICAgICAgICAgfSkpKSwgcm9vdCk7CgogICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQoKICByZW5kZXJNYXAoKTsKICB2YXIgcHJldkluZGV4UGF0dGVybklkczsKCiAgZnVuY3Rpb24gdXBkYXRlSW5kZXhQYXR0ZXJucyhuZXh0SW5kZXhQYXR0ZXJuSWRzKSB7CiAgICB2YXIgaW5kZXhQYXR0ZXJucywgZ2V0SW5kZXhQYXR0ZXJuUHJvbWlzZXM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIHVwZGF0ZUluZGV4UGF0dGVybnMkKF9jb250ZXh0NCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBpbmRleFBhdHRlcm5zID0gW107CiAgICAgICAgICAgIGdldEluZGV4UGF0dGVyblByb21pc2VzID0gbmV4dEluZGV4UGF0dGVybklkcy5tYXAoZnVuY3Rpb24gX2NhbGxlZShpbmRleFBhdHRlcm5JZCkgewogICAgICAgICAgICAgIHZhciBpbmRleFBhdHRlcm47CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dDMpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMDsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX2tpYmFuYV9zZXJ2aWNlcy5pbmRleFBhdHRlcm5TZXJ2aWNlLmdldChpbmRleFBhdHRlcm5JZCkpOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybnMucHVzaChpbmRleFBhdHRlcm4pOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA5OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gNzsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My50MCA9IF9jb250ZXh0M1siY2F0Y2giXSgwKTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIG51bGwsIG51bGwsIFtbMCwgN11dKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNDsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChQcm9taXNlLmFsbChnZXRJbmRleFBhdHRlcm5Qcm9taXNlcykpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgaWYgKCEocHJldkluZGV4UGF0dGVybklkcyAhPT0gbmV4dEluZGV4UGF0dGVybklkcykpIHsKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICRzY29wZS5pbmRleFBhdHRlcm5zID0gaW5kZXhQYXR0ZXJuczsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCiAgJHNjb3BlLmlzRnVsbFNjcmVlbiA9IGZhbHNlOwogICRzY29wZS5pc1NhdmVEaXNhYmxlZCA9IGZhbHNlOwoKICBmdW5jdGlvbiBoYW5kbGVTdG9yZUNoYW5nZXMoc3RvcmUpIHsKICAgIHZhciBuZXh0SXNGdWxsU2NyZWVuID0gKDAsIF91aV9zZWxlY3RvcnMuZ2V0SXNGdWxsU2NyZWVuKShzdG9yZS5nZXRTdGF0ZSgpKTsKCiAgICBpZiAobmV4dElzRnVsbFNjcmVlbiAhPT0gJHNjb3BlLmlzRnVsbFNjcmVlbikgewogICAgICAvLyBNdXN0IHRyaWdnZXIgZGlnZXN0IGN5Y2xlIGZvciBhbmd1bGFyIHRvcCBuYXYgdG8gcmVkcmF3IGl0c2VsZiB3aGVuIGlzRnVsbFNjcmVlbiBjaGFuZ2VzCiAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICAkc2NvcGUuaXNGdWxsU2NyZWVuID0gbmV4dElzRnVsbFNjcmVlbjsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIG5leHRJbmRleFBhdHRlcm5JZHMgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0UXVlcnlhYmxlVW5pcXVlSW5kZXhQYXR0ZXJuSWRzKShzdG9yZS5nZXRTdGF0ZSgpKTsKCiAgICBpZiAobmV4dEluZGV4UGF0dGVybklkcyAhPT0gcHJldkluZGV4UGF0dGVybklkcykgewogICAgICBwcmV2SW5kZXhQYXR0ZXJuSWRzID0gbmV4dEluZGV4UGF0dGVybklkczsKICAgICAgdXBkYXRlSW5kZXhQYXR0ZXJucyhuZXh0SW5kZXhQYXR0ZXJuSWRzKTsKICAgIH0KCiAgICB2YXIgbmV4dElzU2F2ZURpc2FibGVkID0gKDAsIF9tYXBfc2VsZWN0b3JzLmhhc0RpcnR5U3RhdGUpKHN0b3JlLmdldFN0YXRlKCkpOwoKICAgIGlmIChuZXh0SXNTYXZlRGlzYWJsZWQgIT09ICRzY29wZS5pc1NhdmVEaXNhYmxlZCkgewogICAgICAkc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgJHNjb3BlLmlzU2F2ZURpc2FibGVkID0gbmV4dElzU2F2ZURpc2FibGVkOwogICAgICB9KTsKICAgIH0KICB9CgogICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkgewogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIGJlZm9yZVVubG9hZCk7CgogICAgaWYgKHVuc3Vic2NyaWJlKSB7CiAgICAgIHVuc3Vic2NyaWJlKCk7CiAgICB9CgogICAgdmFyIG5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChSRUFDVF9BTkNIT1JfRE9NX0VMRU1FTlRfSUQpOwoKICAgIGlmIChub2RlKSB7CiAgICAgICgwLCBfcmVhY3REb20udW5tb3VudENvbXBvbmVudEF0Tm9kZSkobm9kZSk7CiAgICB9CiAgfSk7CgogIHZhciB1cGRhdGVCcmVhZGNydW1icyA9IGZ1bmN0aW9uIHVwZGF0ZUJyZWFkY3J1bWJzKCkgewogICAgX2Nocm9tZS5kZWZhdWx0LmJyZWFkY3J1bWJzLnNldChbewogICAgICB0ZXh0OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLm1hcHNCcmVhZGNydW1iTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdNYXBzJwogICAgICB9KSwKICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICBpZiAoaXNPbk1hcE5vdygpICYmIGhhc1Vuc2F2ZWRDaGFuZ2VzKCkpIHsKICAgICAgICAgIHZhciBuYXZpZ2F0ZUF3YXkgPSB3aW5kb3cuY29uZmlybShfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLnVuc2F2ZWRDaGFuZ2VzV2FybmluZycsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJZb3VyIHVuc2F2ZWQgY2hhbmdlcyBtaWdodCBub3QgYmUgc2F2ZWQiCiAgICAgICAgICB9KSk7CgogICAgICAgICAgaWYgKG5hdmlnYXRlQXdheSkgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9ICcjJzsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnIyc7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIHRleHQ6IHNhdmVkTWFwLnRpdGxlCiAgICB9XSk7CiAgfTsKCiAgdXBkYXRlQnJlYWRjcnVtYnMoKTsKICAoMCwgX2hlbHBfbWVudV91dGlsLmFkZEhlbHBNZW51VG9BcHBDaHJvbWUpKF9jaHJvbWUuZGVmYXVsdCk7CgogIGZ1bmN0aW9uIGRvU2F2ZShzYXZlT3B0aW9ucykgewogICAgdmFyIGlkOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBkb1NhdmUkKF9jb250ZXh0NSkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoc3RvcmUuZGlzcGF0Y2goKDAsIF9tYXBfYWN0aW9ucy5jbGVhclRyYW5zaWVudExheWVyU3RhdGVBbmRDbG9zZUZseW91dCkoKSkpOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgc2F2ZWRNYXAuc3luY1dpdGhTdG9yZShzdG9yZS5nZXRTdGF0ZSgpKTsKICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAzOwogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDY7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoc2F2ZWRNYXAuc2F2ZShzYXZlT3B0aW9ucykpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgaWQgPSBfY29udGV4dDUuc2VudDsKCiAgICAgICAgICAgIF9kb2NfdGl0bGUuZG9jVGl0bGUuY2hhbmdlKHNhdmVkTWFwLnRpdGxlKTsKCiAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTQ7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMTA7CiAgICAgICAgICAgIF9jb250ZXh0NS50MCA9IF9jb250ZXh0NVsiY2F0Y2giXSgzKTsKCiAgICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcih7CiAgICAgICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLm1hcENvbnRyb2xsZXIuc2F2ZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXJyb3Igb24gc2F2aW5nICd7dGl0bGV9JyIsCiAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHNhdmVkTWFwLnRpdGxlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgdGV4dDogX2NvbnRleHQ1LnQwLm1lc3NhZ2UsCiAgICAgICAgICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogJ3NhdmVNYXBFcnJvcicKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgIGVycm9yOiBfY29udGV4dDUudDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkU3VjY2Vzcyh7CiAgICAgICAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMubWFwQ29udHJvbGxlci5zYXZlU3VjY2Vzc01lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZWQgJ3t0aXRsZX0nIiwKICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHNhdmVkTWFwLnRpdGxlCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogJ3NhdmVNYXBTdWNjZXNzJwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB1cGRhdGVCcmVhZGNydW1icygpOwoKICAgICAgICAgICAgICBpZiAoc2F2ZWRNYXAuaWQgIT09ICRyb3V0ZS5jdXJyZW50LnBhcmFtcy5pZCkgewogICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBrYm5VcmwuY2hhbmdlKCJtYXAve3tpZH19IiwgewogICAgICAgICAgICAgICAgICAgIGlkOiBzYXZlZE1hcC5pZAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICBpZDogaWQKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgbnVsbCwgbnVsbCwgW1szLCAxMF1dKTsKICB9IC8vIEhpZGUgYW5ndWxhciB0aW1lcGljZXIvcmVmcmVzaCBVSSBmcm9tIHRvcCBuYXYKCgogIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZGlzYWJsZVRpbWVSYW5nZVNlbGVjdG9yKCk7CgogIF90aW1lZmlsdGVyLnRpbWVmaWx0ZXIuZGlzYWJsZUF1dG9SZWZyZXNoU2VsZWN0b3IoKTsKCiAgJHNjb3BlLnNob3dEYXRlUGlja2VyID0gdHJ1ZTsgLy8gdXNlZCBieSBxdWVyeS1iYXIgZGlyZWN0aXZlIHRvIGVuYWJsZSB0aW1lcGlrY2VyIGluIHF1ZXJ5IGJhcgoKICAkc2NvcGUudG9wTmF2TWVudSA9IFt7CiAgICBpZDogJ2Z1bGwtc2NyZWVuJywKICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLmZ1bGxTY3JlZW5CdXR0b25MYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJmdWxsIHNjcmVlbiIKICAgIH0pLAogICAgZGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLm1hcENvbnRyb2xsZXIuZnVsbFNjcmVlbkRlc2NyaXB0aW9uJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogImZ1bGwgc2NyZWVuIgogICAgfSksCiAgICB0ZXN0SWQ6ICdtYXBzRnVsbFNjcmVlbk1vZGUnLAogICAgcnVuOiBmdW5jdGlvbiBydW4oKSB7CiAgICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfdWlfYWN0aW9ucy5lbmFibGVGdWxsU2NyZWVuKSgpKTsKICAgIH0KICB9LCB7CiAgICBpZDogJ2luc3BlY3QnLAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLm1hcENvbnRyb2xsZXIub3Blbkluc3BlY3RvckJ1dHRvbkxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogImluc3BlY3QiCiAgICB9KSwKICAgIGRlc2NyaXB0aW9uOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLm9wZW5JbnNwZWN0b3JEZXNjcmlwdGlvbicsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJPcGVuIEluc3BlY3RvciIKICAgIH0pLAogICAgdGVzdElkOiAnb3Blbkluc3BlY3RvckJ1dHRvbicsCiAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgdmFyIGluc3BlY3RvckFkYXB0ZXJzID0gKDAsIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcy5nZXRJbnNwZWN0b3JBZGFwdGVycykoc3RvcmUuZ2V0U3RhdGUoKSk7CgogICAgICBfaW5zcGVjdG9yLkluc3BlY3Rvci5vcGVuKGluc3BlY3RvckFkYXB0ZXJzLCB7fSk7CiAgICB9CiAgfV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfY2FwYWJpbGl0aWVzLmNhcGFiaWxpdGllcy5nZXQoKS5tYXBzLnNhdmUgPyBbewogICAgaWQ6ICdzYXZlJywKICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLnNhdmVNYXBCdXR0b25MYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJzYXZlIgogICAgfSksCiAgICBkZXNjcmlwdGlvbjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMubWFwQ29udHJvbGxlci5zYXZlTWFwRGVzY3JpcHRpb24nLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSBtYXAiCiAgICB9KSwKICAgIHRlc3RJZDogJ21hcFNhdmVCdXR0b24nLAogICAgZGlzYWJsZUJ1dHRvbjogZnVuY3Rpb24gZGlzYWJsZUJ1dHRvbigpIHsKICAgICAgcmV0dXJuICRzY29wZS5pc1NhdmVEaXNhYmxlZDsKICAgIH0sCiAgICB0b29sdGlwOiBmdW5jdGlvbiB0b29sdGlwKCkgewogICAgICBpZiAoJHNjb3BlLmlzU2F2ZURpc2FibGVkKSB7CiAgICAgICAgcmV0dXJuIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLm1hcENvbnRyb2xsZXIuc2F2ZU1hcERpc2FibGVkQnV0dG9uVG9vbHRpcCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2F2ZSBvciBDYW5jZWwgeW91ciBsYXllciBjaGFuZ2VzIGJlZm9yZSBzYXZpbmcnCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgdmFyIG9uU2F2ZSwgc2F2ZU1vZGFsOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIHJ1biQoX2NvbnRleHQ2KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgb25TYXZlID0gZnVuY3Rpb24gb25TYXZlKF9yZWY0KSB7CiAgICAgICAgICAgICAgICB2YXIgbmV3VGl0bGUgPSBfcmVmNC5uZXdUaXRsZSwKICAgICAgICAgICAgICAgICAgICBuZXdDb3B5T25TYXZlID0gX3JlZjQubmV3Q29weU9uU2F2ZSwKICAgICAgICAgICAgICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkID0gX3JlZjQuaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZCwKICAgICAgICAgICAgICAgICAgICBvblRpdGxlRHVwbGljYXRlID0gX3JlZjQub25UaXRsZUR1cGxpY2F0ZTsKICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGl0bGUgPSBzYXZlZE1hcC50aXRsZTsKICAgICAgICAgICAgICAgIHNhdmVkTWFwLnRpdGxlID0gbmV3VGl0bGU7CiAgICAgICAgICAgICAgICBzYXZlZE1hcC5jb3B5T25TYXZlID0gbmV3Q29weU9uU2F2ZTsKICAgICAgICAgICAgICAgIHZhciBzYXZlT3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgY29uZmlybU92ZXJ3cml0ZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQ6IGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQsCiAgICAgICAgICAgICAgICAgIG9uVGl0bGVEdXBsaWNhdGU6IG9uVGl0bGVEdXBsaWNhdGUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gZG9TYXZlKHNhdmVPcHRpb25zKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc2F2ZSB3YXNuJ3Qgc3VjY2Vzc2Z1bCwgcHV0IHRoZSBvcmlnaW5hbCB2YWx1ZXMgYmFjay4KICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5pZCB8fCByZXNwb25zZS5lcnJvcikgewogICAgICAgICAgICAgICAgICAgIHNhdmVkTWFwLnRpdGxlID0gY3VycmVudFRpdGxlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBzYXZlTW9kYWwgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zYXZlZF9vYmplY3Rfc2F2ZV9tb2RhbC5TYXZlZE9iamVjdFNhdmVNb2RhbCwgewogICAgICAgICAgICAgICAgb25TYXZlOiBvblNhdmUsCiAgICAgICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiBvbkNsb3NlKCkge30sCiAgICAgICAgICAgICAgICB0aXRsZTogc2F2ZWRNYXAudGl0bGUsCiAgICAgICAgICAgICAgICBzaG93Q29weU9uU2F2ZTogc2F2ZWRNYXAuaWQgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiBfY29uc3RhbnRzLk1BUF9TQVZFRF9PQkpFQ1RfVFlQRQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICgwLCBfc2hvd19zYXZlZF9vYmplY3Rfc2F2ZV9tb2RhbC5zaG93U2F2ZU1vZGFsKShzYXZlTW9kYWwpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfV0gOiBbXSkpOwp9KTs="},null]}