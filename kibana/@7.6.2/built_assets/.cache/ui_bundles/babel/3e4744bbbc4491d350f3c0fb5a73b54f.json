{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/security/public/views/management/role_mappings/edit_role_mapping/components/rule_editor_panel/field_rule_editor.js","dependencies":[{"path":"x-pack/legacy/plugins/security/public/views/management/role_mappings/edit_role_mapping/components/rule_editor_panel/field_rule_editor.js","mtime":1585205047244},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuRmllbGRSdWxlRWRpdG9yID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9tb2RlbCA9IHJlcXVpcmUoIi4uLy4uLy4uL21vZGVsIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgX3R5cGVvZjIoU3ltYm9sLml0ZXJhdG9yKSA9PT0gInN5bWJvbCIpIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfSBlbHNlIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9CgogIHJldHVybiBfdHlwZW9mKG9iaik7Cn0KCmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgewogIHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7CiAgdmFyIF9hcnIgPSBbXTsKICB2YXIgX24gPSB0cnVlOwogIHZhciBfZCA9IGZhbHNlOwogIHZhciBfZSA9IHVuZGVmaW5lZDsKCiAgdHJ5IHsKICAgIGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgX2Fyci5wdXNoKF9zLnZhbHVlKTsKCiAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsKICAgIH0KICB9IGNhdGNoIChlcnIpIHsKICAgIF9kID0gdHJ1ZTsKICAgIF9lID0gZXJyOwogIH0gZmluYWxseSB7CiAgICB0cnkgewogICAgICBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSAhPSBudWxsKSBfaVsicmV0dXJuIl0oKTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmIChfZCkgdGhyb3cgX2U7CiAgICB9CiAgfQoKICByZXR1cm4gX2FycjsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQoKZnVuY3Rpb24gX2V4dGVuZHMoKSB7CiAgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICByZXR1cm4gX2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgfTsKICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwp9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsKICBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7CiAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwogIH0KCiAgcmV0dXJuIHNlbGY7Cn0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgewogIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOwogIH0KCiAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICBjb25zdHJ1Y3RvcjogewogICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0KICB9KTsKICBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsKfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICAgIG8uX19wcm90b19fID0gcDsKICAgIHJldHVybiBvOwogIH07CgogIHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9Cgp2YXIgdXNlckZpZWxkcyA9IFt7CiAgbmFtZTogJ3VzZXJuYW1lJwp9LCB7CiAgbmFtZTogJ2RuJwp9LCB7CiAgbmFtZTogJ2dyb3VwcycKfSwgewogIG5hbWU6ICdyZWFsbS5uYW1lJwp9XTsKdmFyIGZpZWxkT3B0aW9ucyA9IHVzZXJGaWVsZHMubWFwKGZ1bmN0aW9uIChmKSB7CiAgcmV0dXJuIHsKICAgIGxhYmVsOiBmLm5hbWUKICB9Owp9KTsKdmFyIGNvbXBhcmlzb25PcHRpb25zID0gewogIHRleHQ6IHsKICAgIGlkOiAndGV4dCcsCiAgICBkZWZhdWx0VmFsdWU6ICcqJwogIH0sCiAgbnVtYmVyOiB7CiAgICBpZDogJ251bWJlcicsCiAgICBkZWZhdWx0VmFsdWU6IDAKICB9LAogIG51bGw6IHsKICAgIGlkOiAnbnVsbCcsCiAgICBkZWZhdWx0VmFsdWU6IG51bGwKICB9LAogIGJvb2xlYW46IHsKICAgIGlkOiAnYm9vbGVhbicsCiAgICBkZWZhdWx0VmFsdWU6IHRydWUKICB9Cn07Cgp2YXIgRmllbGRSdWxlRWRpdG9yID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhGaWVsZFJ1bGVFZGl0b3IsIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBGaWVsZFJ1bGVFZGl0b3IoKSB7CiAgICB2YXIgX2dldFByb3RvdHlwZU9mMjsKCiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZpZWxkUnVsZUVkaXRvcik7CgogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoX2dldFByb3RvdHlwZU9mMiA9IF9nZXRQcm90b3R5cGVPZihGaWVsZFJ1bGVFZGl0b3IpKS5jYWxsLmFwcGx5KF9nZXRQcm90b3R5cGVPZjIsIFt0aGlzXS5jb25jYXQoYXJncykpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZW5kZXJGaWVsZFJvdyIsIGZ1bmN0aW9uIChmaWVsZCwgcnVsZVZhbHVlLCB2YWx1ZUluZGV4KSB7CiAgICAgIHZhciBpc1ByaW1hcnlSb3cgPSB2YWx1ZUluZGV4ID09PSAwOwogICAgICB2YXIgcmVuZGVyQWRkVmFsdWVCdXR0b24gPSB0cnVlOwogICAgICB2YXIgcm93UnVsZVZhbHVlID0gcnVsZVZhbHVlOwoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocnVsZVZhbHVlKSkgewogICAgICAgIHJlbmRlckFkZFZhbHVlQnV0dG9uID0gcnVsZVZhbHVlLmxlbmd0aCAtIDEgPT09IHZhbHVlSW5kZXg7CiAgICAgICAgcm93UnVsZVZhbHVlID0gcnVsZVZhbHVlW3ZhbHVlSW5kZXhdOwogICAgICB9CgogICAgICB2YXIgY29tcGFyaXNvblR5cGUgPSBfdGhpcy5nZXRDb21wYXJpc29uVHlwZShyb3dSdWxlVmFsdWUpOwoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBndXR0ZXJTaXplOiAicyIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogMQogICAgICB9LCBpc1ByaW1hcnlSb3cgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5lZGl0Um9sZU1hcHBpbmcuZmllbGRSdWxlRWRpdG9yLnVzZXJGaWVsZExhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdVc2VyIGZpZWxkJwogICAgICAgIH0pCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb21ib0JveCwgewogICAgICAgIGlzQ2xlYXJhYmxlOiBmYWxzZSwKICAgICAgICBzZWxlY3RlZE9wdGlvbnM6IFt7CiAgICAgICAgICBsYWJlbDogZmllbGQKICAgICAgICB9XSwKICAgICAgICBzaW5nbGVTZWxlY3Rpb246IHsKICAgICAgICAgIGFzUGxhaW5UZXh0OiB0cnVlCiAgICAgICAgfSwKICAgICAgICBvbkNoYW5nZTogX3RoaXMub25GaWVsZENoYW5nZSwKICAgICAgICBvbkNyZWF0ZU9wdGlvbjogX3RoaXMub25BZGRGaWVsZCwKICAgICAgICBvcHRpb25zOiBmaWVsZE9wdGlvbnMsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImZpZWxkUnVsZUVkaXRvckZpZWxkLSIuY29uY2F0KHZhbHVlSW5kZXgsICIgZmllbGRSdWxlRWRpdG9yRmllbGQtIikuY29uY2F0KHZhbHVlSW5kZXgsICItY29tYm8iKQogICAgICB9KSkgOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGhhc0VtcHR5TGFiZWxTcGFjZTogdHJ1ZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRXhwcmVzc2lvbiwgewogICAgICAgIGRlc2NyaXB0aW9uOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5lZGl0Um9sZU1hcHBpbmcuZmllbGRSdWxlRWRpdG9yLm9yTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ29yJwogICAgICAgIH0pLAogICAgICAgIHZhbHVlOiBmaWVsZCwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZmllbGRSdWxlRWRpdG9yRmllbGQtIi5jb25jYXQodmFsdWVJbmRleCwgIiBmaWVsZFJ1bGVFZGl0b3JGaWVsZC0iKS5jb25jYXQodmFsdWVJbmRleCwgIi1leHByZXNzaW9uIikKICAgICAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3RoaXMucmVuZGVyRmllbGRUeXBlSW5wdXQoY29tcGFyaXNvblR5cGUuaWQsIHZhbHVlSW5kZXgpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogMQogICAgICB9LCBfdGhpcy5yZW5kZXJGaWVsZFZhbHVlSW5wdXQoY29tcGFyaXNvblR5cGUuaWQsIHJvd1J1bGVWYWx1ZSwgdmFsdWVJbmRleCkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGhhc0VtcHR5TGFiZWxTcGFjZTogdHJ1ZQogICAgICB9LCByZW5kZXJBZGRWYWx1ZUJ1dHRvbiA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25JY29uLCB7CiAgICAgICAgaWNvblNpemU6ICJzIiwKICAgICAgICBpY29uVHlwZTogInBsdXNJbkNpcmNsZSIsCiAgICAgICAgb25DbGljazogX3RoaXMub25BZGRBbHRlcm5hdGVWYWx1ZSwKICAgICAgICBjb2xvcjogInByaW1hcnkiLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZGRBbHRlcm5hdGVWYWx1ZUJ1dHRvbiIsCiAgICAgICAgImFyaWEtbGFiZWwiOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5lZGl0Um9sZU1hcHBpbmcuZmllbGRSdWxlRWRpdG9yLmFkZEFsdGVybmF0ZVZhbHVlQnV0dG9uJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdBZGQgYWx0ZXJuYXRlIHZhbHVlJwogICAgICAgIH0pCiAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUljb24sIHsKICAgICAgICBzaXplOiAibCIsCiAgICAgICAgdHlwZTogImVtcHR5IiwKICAgICAgICAiYXJpYS1oaWRkZW4iOiB0cnVlCiAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IDEKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBoYXNFbXB0eUxhYmVsU3BhY2U6IHRydWUKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkljb24sIHsKICAgICAgICBpY29uVHlwZTogInRyYXNoIiwKICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgaWNvblNpemU6ICJzIiwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZmllbGRSdWxlRWRpdG9yRGVsZXRlVmFsdWUgZmllbGRSdWxlRWRpdG9yRGVsZXRlVmFsdWUtIi5jb25jYXQodmFsdWVJbmRleCksCiAgICAgICAgImFyaWEtbGFiZWwiOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5lZGl0Um9sZU1hcHBpbmcuZmllbGRSdWxlRWRpdG9yLmRlbGV0ZVZhbHVlTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0RlbGV0ZSB2YWx1ZScKICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzLm9uUmVtb3ZlQWx0ZXJuYXRlVmFsdWUodmFsdWVJbmRleCk7CiAgICAgICAgfQogICAgICB9KSkpKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbmRlckZpZWxkVHlwZUlucHV0IiwgZnVuY3Rpb24gKGlucHV0VHlwZSwgdmFsdWVJbmRleCkgewogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuZWRpdFJvbGVNYXBwaW5nLmZpZWxkUnVsZUVkaXRvci50eXBlRm9ybVJvdycsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVHlwZScKICAgICAgICB9KSwKICAgICAgICBrZXk6IHZhbHVlSW5kZXgKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNlbGVjdCwgewogICAgICAgIG9wdGlvbnM6IFt7CiAgICAgICAgICB2YWx1ZTogJ3RleHQnLAogICAgICAgICAgdGV4dDogJ3RleHQnCiAgICAgICAgfSwgewogICAgICAgICAgdmFsdWU6ICdudW1iZXInLAogICAgICAgICAgdGV4dDogJ251bWJlcicKICAgICAgICB9LCB7CiAgICAgICAgICB2YWx1ZTogJ251bGwnLAogICAgICAgICAgdGV4dDogJ2lzIG51bGwnCiAgICAgICAgfSwgewogICAgICAgICAgdmFsdWU6ICdib29sZWFuJywKICAgICAgICAgIHRleHQ6ICdib29sZWFuJwogICAgICAgIH1dLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJmaWVsZFJ1bGVFZGl0b3JWYWx1ZVR5cGUtIi5jb25jYXQodmFsdWVJbmRleCksCiAgICAgICAgdmFsdWU6IGlucHV0VHlwZSwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgcmV0dXJuIF90aGlzLm9uQ29tcGFyaXNvblR5cGVDaGFuZ2UodmFsdWVJbmRleCwgZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0KICAgICAgfSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyRmllbGRWYWx1ZUlucHV0IiwgZnVuY3Rpb24gKGZpZWxkVHlwZSwgcm93UnVsZVZhbHVlLCB2YWx1ZUluZGV4KSB7CiAgICAgIHZhciBpbnB1dEZpZWxkID0gX3RoaXMuZ2V0SW5wdXRGaWVsZEZvclR5cGUoZmllbGRUeXBlLCByb3dSdWxlVmFsdWUsIHZhbHVlSW5kZXgpOwoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmVkaXRSb2xlTWFwcGluZy5maWVsZFJ1bGVFZGl0b3IudmFsdWVGb3JtUm93JywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdWYWx1ZScKICAgICAgICB9KSwKICAgICAgICBrZXk6IHZhbHVlSW5kZXgKICAgICAgfSwgaW5wdXRGaWVsZCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRJbnB1dEZpZWxkRm9yVHlwZSIsIGZ1bmN0aW9uIChmaWVsZFR5cGUsIHJvd1J1bGVWYWx1ZSwgdmFsdWVJbmRleCkgewogICAgICB2YXIgaXNOdWxsVmFsdWUgPSByb3dSdWxlVmFsdWUgPT09IG51bGw7CiAgICAgIHZhciBjb21tb25Qcm9wcyA9IHsKICAgICAgICAnZGF0YS10ZXN0LXN1YmonOiAiZmllbGRSdWxlRWRpdG9yVmFsdWUtIi5jb25jYXQodmFsdWVJbmRleCkKICAgICAgfTsKCiAgICAgIHN3aXRjaCAoZmllbGRUeXBlKSB7CiAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNlbGVjdCwgX2V4dGVuZHMoe30sIGNvbW1vblByb3BzLCB7CiAgICAgICAgICAgIHZhbHVlOiByb3dSdWxlVmFsdWUgPT09IG51bGwgfHwgcm93UnVsZVZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByb3dSdWxlVmFsdWUudG9TdHJpbmcoKSwKICAgICAgICAgICAgb25DaGFuZ2U6IF90aGlzLm9uQm9vbGVhblZhbHVlQ2hhbmdlKHZhbHVlSW5kZXgpLAogICAgICAgICAgICBvcHRpb25zOiBbewogICAgICAgICAgICAgIHZhbHVlOiAndHJ1ZScsCiAgICAgICAgICAgICAgdGV4dDogJ3RydWUnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICB2YWx1ZTogJ2ZhbHNlJywKICAgICAgICAgICAgICB0ZXh0OiAnZmFsc2UnCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9KSk7CgogICAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgIGNhc2UgJ251bGwnOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZFRleHQsIF9leHRlbmRzKHt9LCBjb21tb25Qcm9wcywgewogICAgICAgICAgICB2YWx1ZTogaXNOdWxsVmFsdWUgPyAnLS0gbnVsbCAtLScgOiByb3dSdWxlVmFsdWUsCiAgICAgICAgICAgIG9uQ2hhbmdlOiBfdGhpcy5vblZhbHVlQ2hhbmdlKHZhbHVlSW5kZXgpLAogICAgICAgICAgICBkaXNhYmxlZDogaXNOdWxsVmFsdWUKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAnbnVtYmVyJzoKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGROdW1iZXIsIHsKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImZpZWxkUnVsZUVkaXRvclZhbHVlLSIuY29uY2F0KHZhbHVlSW5kZXgpLAogICAgICAgICAgICB2YWx1ZTogcm93UnVsZVZhbHVlLAogICAgICAgICAgICBvbkNoYW5nZTogX3RoaXMub25OdW1lcmljVmFsdWVDaGFuZ2UodmFsdWVJbmRleCkKICAgICAgICAgIH0pOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbnN1cHBvcnRlZCBpbnB1dCBmaWVsZCB0eXBlOiAiLmNvbmNhdChmaWVsZFR5cGUpKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25BZGRBbHRlcm5hdGVWYWx1ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHByb3BzJHJ1bGUgPSBfdGhpcy5wcm9wcy5ydWxlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRwcm9wcyRydWxlLmZpZWxkLAogICAgICAgICAgdmFsdWUgPSBfdGhpcyRwcm9wcyRydWxlLnZhbHVlOwogICAgICB2YXIgbmV4dFZhbHVlID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUpIDogW3ZhbHVlXTsKICAgICAgbmV4dFZhbHVlLnB1c2goJyonKTsKCiAgICAgIF90aGlzLnByb3BzLm9uQ2hhbmdlKG5ldyBfbW9kZWwuRmllbGRSdWxlKGZpZWxkLCBuZXh0VmFsdWUpKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uUmVtb3ZlQWx0ZXJuYXRlVmFsdWUiLCBmdW5jdGlvbiAoaW5kZXgpIHsKICAgICAgdmFyIF90aGlzJHByb3BzJHJ1bGUyID0gX3RoaXMucHJvcHMucnVsZSwKICAgICAgICAgIGZpZWxkID0gX3RoaXMkcHJvcHMkcnVsZTIuZmllbGQsCiAgICAgICAgICB2YWx1ZSA9IF90aGlzJHByb3BzJHJ1bGUyLnZhbHVlOwoKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSB8fCB2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgICAvLyBPbmx5IG9uZSB2YWx1ZSBsZWZ0LiBEZWxldGUgZW50aXJlIHJ1bGUgaW5zdGVhZC4KICAgICAgICBfdGhpcy5wcm9wcy5vbkRlbGV0ZSgpOwoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBuZXh0VmFsdWUgPSBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUpOwoKICAgICAgbmV4dFZhbHVlLnNwbGljZShpbmRleCwgMSk7CgogICAgICBfdGhpcy5wcm9wcy5vbkNoYW5nZShuZXcgX21vZGVsLkZpZWxkUnVsZShmaWVsZCwgbmV4dFZhbHVlKSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZpZWxkQ2hhbmdlIiwgZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMSksCiAgICAgICAgICBuZXdGaWVsZCA9IF9yZWYyWzBdOwoKICAgICAgaWYgKCFuZXdGaWVsZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHZhbHVlID0gX3RoaXMucHJvcHMucnVsZS52YWx1ZTsKCiAgICAgIF90aGlzLnByb3BzLm9uQ2hhbmdlKG5ldyBfbW9kZWwuRmllbGRSdWxlKG5ld0ZpZWxkLmxhYmVsLCB2YWx1ZSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25BZGRGaWVsZCIsIGZ1bmN0aW9uIChuZXdGaWVsZCkgewogICAgICB2YXIgdmFsdWUgPSBfdGhpcy5wcm9wcy5ydWxlLnZhbHVlOwoKICAgICAgX3RoaXMucHJvcHMub25DaGFuZ2UobmV3IF9tb2RlbC5GaWVsZFJ1bGUobmV3RmllbGQsIHZhbHVlKSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblZhbHVlQ2hhbmdlIiwgZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBfdGhpcyRwcm9wcyRydWxlMyA9IF90aGlzLnByb3BzLnJ1bGUsCiAgICAgICAgICAgIGZpZWxkID0gX3RoaXMkcHJvcHMkcnVsZTMuZmllbGQsCiAgICAgICAgICAgIHZhbHVlID0gX3RoaXMkcHJvcHMkcnVsZTMudmFsdWU7CiAgICAgICAgdmFyIG5leHRWYWx1ZTsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICBuZXh0VmFsdWUgPSBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUpOwogICAgICAgICAgbmV4dFZhbHVlLnNwbGljZShpbmRleCwgMSwgZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuZXh0VmFsdWUgPSBlLnRhcmdldC52YWx1ZTsKICAgICAgICB9CgogICAgICAgIF90aGlzLnByb3BzLm9uQ2hhbmdlKG5ldyBfbW9kZWwuRmllbGRSdWxlKGZpZWxkLCBuZXh0VmFsdWUpKTsKICAgICAgfTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uTnVtZXJpY1ZhbHVlQ2hhbmdlIiwgZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBfdGhpcyRwcm9wcyRydWxlNCA9IF90aGlzLnByb3BzLnJ1bGUsCiAgICAgICAgICAgIGZpZWxkID0gX3RoaXMkcHJvcHMkcnVsZTQuZmllbGQsCiAgICAgICAgICAgIHZhbHVlID0gX3RoaXMkcHJvcHMkcnVsZTQudmFsdWU7CiAgICAgICAgdmFyIG5leHRWYWx1ZTsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICBuZXh0VmFsdWUgPSBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUpOwogICAgICAgICAgbmV4dFZhbHVlLnNwbGljZShpbmRleCwgMSwgcGFyc2VGbG9hdChlLnRhcmdldC52YWx1ZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuZXh0VmFsdWUgPSBwYXJzZUZsb2F0KGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9CgogICAgICAgIF90aGlzLnByb3BzLm9uQ2hhbmdlKG5ldyBfbW9kZWwuRmllbGRSdWxlKGZpZWxkLCBuZXh0VmFsdWUpKTsKICAgICAgfTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQm9vbGVhblZhbHVlQ2hhbmdlIiwgZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBib29sVmFsdWUgPSBlLnRhcmdldC52YWx1ZSA9PT0gJ3RydWUnOwogICAgICAgIHZhciBfdGhpcyRwcm9wcyRydWxlNSA9IF90aGlzLnByb3BzLnJ1bGUsCiAgICAgICAgICAgIGZpZWxkID0gX3RoaXMkcHJvcHMkcnVsZTUuZmllbGQsCiAgICAgICAgICAgIHZhbHVlID0gX3RoaXMkcHJvcHMkcnVsZTUudmFsdWU7CiAgICAgICAgdmFyIG5leHRWYWx1ZTsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICBuZXh0VmFsdWUgPSBfdG9Db25zdW1hYmxlQXJyYXkodmFsdWUpOwogICAgICAgICAgbmV4dFZhbHVlLnNwbGljZShpbmRleCwgMSwgYm9vbFZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV4dFZhbHVlID0gYm9vbFZhbHVlOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMucHJvcHMub25DaGFuZ2UobmV3IF9tb2RlbC5GaWVsZFJ1bGUoZmllbGQsIG5leHRWYWx1ZSkpOwogICAgICB9OwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Db21wYXJpc29uVHlwZUNoYW5nZSIsIGZ1bmN0aW9uIChpbmRleCwgbmV3VHlwZSkgewogICAgICB2YXIgY29tcGFyaXNvbiA9IGNvbXBhcmlzb25PcHRpb25zW25ld1R5cGVdOwoKICAgICAgaWYgKCFjb21wYXJpc29uKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIGNvbXBhcmlzb24gdHlwZTogIi5jb25jYXQobmV3VHlwZSkpOwogICAgICB9CgogICAgICB2YXIgX3RoaXMkcHJvcHMkcnVsZTYgPSBfdGhpcy5wcm9wcy5ydWxlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRwcm9wcyRydWxlNi5maWVsZCwKICAgICAgICAgIHZhbHVlID0gX3RoaXMkcHJvcHMkcnVsZTYudmFsdWU7CiAgICAgIHZhciBuZXh0VmFsdWUgPSB2YWx1ZTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgIG5leHRWYWx1ZSA9IF90b0NvbnN1bWFibGVBcnJheSh2YWx1ZSk7CiAgICAgICAgbmV4dFZhbHVlLnNwbGljZShpbmRleCwgMSwgY29tcGFyaXNvbi5kZWZhdWx0VmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIG5leHRWYWx1ZSA9IGNvbXBhcmlzb24uZGVmYXVsdFZhbHVlOwogICAgICB9CgogICAgICBfdGhpcy5wcm9wcy5vbkNoYW5nZShuZXcgX21vZGVsLkZpZWxkUnVsZShmaWVsZCwgbmV4dFZhbHVlKSk7CiAgICB9KTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRmllbGRSdWxlRWRpdG9yLCBbewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHByb3BzJHJ1bGU3ID0gdGhpcy5wcm9wcy5ydWxlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRwcm9wcyRydWxlNy5maWVsZCwKICAgICAgICAgIHZhbHVlID0gX3RoaXMkcHJvcHMkcnVsZTcudmFsdWU7CiAgICAgIHZhciBjb250ZW50ID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAoZnVuY3Rpb24gKHYsIGluZGV4KSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5yZW5kZXJGaWVsZFJvdyhmaWVsZCwgdmFsdWUsIGluZGV4KTsKICAgICAgfSkgOiBbdGhpcy5yZW5kZXJGaWVsZFJvdyhmaWVsZCwgdmFsdWUsIDApXTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBkaXJlY3Rpb246ICJjb2x1bW4iCiAgICAgIH0sIGNvbnRlbnQubWFwKGZ1bmN0aW9uIChyb3csIGluZGV4KSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAga2V5OiBpbmRleAogICAgICAgIH0sIHJvdyk7CiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRDb21wYXJpc29uVHlwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29tcGFyaXNvblR5cGUocnVsZVZhbHVlKSB7CiAgICAgIHZhciB2YWx1ZVR5cGUgPSBfdHlwZW9mKHJ1bGVWYWx1ZSk7CgogICAgICBpZiAodmFsdWVUeXBlID09PSAnc3RyaW5nJyB8fCB2YWx1ZVR5cGUgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgcmV0dXJuIGNvbXBhcmlzb25PcHRpb25zLnRleHQ7CiAgICAgIH0KCiAgICAgIGlmICh2YWx1ZVR5cGUgPT09ICdudW1iZXInKSB7CiAgICAgICAgcmV0dXJuIGNvbXBhcmlzb25PcHRpb25zLm51bWJlcjsKICAgICAgfQoKICAgICAgaWYgKHZhbHVlVHlwZSA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgcmV0dXJuIGNvbXBhcmlzb25PcHRpb25zLmJvb2xlYW47CiAgICAgIH0KCiAgICAgIGlmIChydWxlVmFsdWUgPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gY29tcGFyaXNvbk9wdGlvbnMubnVsbDsKICAgICAgfQoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gZGV0ZWN0IGNvbXBhcmlzb24gdHlwZSBmb3IgcnVsZSB2YWx1ZSBbIi5jb25jYXQocnVsZVZhbHVlLCAiXSIpKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBGaWVsZFJ1bGVFZGl0b3I7Cn0oX3JlYWN0LkNvbXBvbmVudCk7CgpleHBvcnRzLkZpZWxkUnVsZUVkaXRvciA9IEZpZWxkUnVsZUVkaXRvcjs="},null]}