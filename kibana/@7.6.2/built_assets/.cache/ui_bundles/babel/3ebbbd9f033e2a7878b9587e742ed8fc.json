{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/management/sections/settings/components/field/field.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/management/sections/settings/components/field/field.js","mtime":1585205039879},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkZpZWxkID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInByb3AtdHlwZXMiKSk7Cgp2YXIgX25ld19wbGF0Zm9ybSA9IHJlcXVpcmUoInVpL25ld19wbGF0Zm9ybSIpOwoKcmVxdWlyZSgiYnJhY2UvdGhlbWUvdGV4dG1hdGUiKTsKCnJlcXVpcmUoImJyYWNlL21vZGUvbWFya2Rvd24iKTsKCnZhciBfbm90aWZ5ID0gcmVxdWlyZSgidWkvbm90aWZ5Iik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3JlYWN0MiA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9saWIgPSByZXF1aXJlKCIuLi8uLi9saWIiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIEZpZWxkID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1B1cmVDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoRmllbGQsIF9QdXJlQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gRmllbGQocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRmllbGQpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZpZWxkKS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Db2RlRWRpdG9yQ2hhbmdlIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIHZhciB0eXBlID0gX3RoaXMucHJvcHMuc2V0dGluZy50eXBlOwogICAgICB2YXIgaXNKc29uQXJyYXkgPSBfdGhpcy5zdGF0ZS5pc0pzb25BcnJheTsKICAgICAgdmFyIG5ld1Vuc2F2ZWRWYWx1ZSA9IHVuZGVmaW5lZDsKICAgICAgdmFyIGlzSW52YWxpZCA9IGZhbHNlOwogICAgICB2YXIgZXJyb3IgPSBudWxsOwoKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAnanNvbic6CiAgICAgICAgICBuZXdVbnNhdmVkVmFsdWUgPSB2YWx1ZS50cmltKCkgfHwgKGlzSnNvbkFycmF5ID8gJ1tdJyA6ICd7fScpOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIEpTT04ucGFyc2UobmV3VW5zYXZlZFZhbHVlKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaXNJbnZhbGlkID0gdHJ1ZTsKICAgICAgICAgICAgZXJyb3IgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuY29kZUVkaXRvclN5bnRheEVycm9yTWVzc2FnZSIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJbnZhbGlkIEpTT04gc3ludGF4IgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIG5ld1Vuc2F2ZWRWYWx1ZSA9IHZhbHVlOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZXJyb3I6IGVycm9yLAogICAgICAgIGlzSW52YWxpZDogaXNJbnZhbGlkLAogICAgICAgIHVuc2F2ZWRWYWx1ZTogbmV3VW5zYXZlZFZhbHVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZENoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB2YWx1ZSA9IGUudGFyZ2V0LnZhbHVlOwogICAgICB2YXIgX3RoaXMkcHJvcHMkc2V0dGluZyA9IF90aGlzLnByb3BzLnNldHRpbmcsCiAgICAgICAgICB0eXBlID0gX3RoaXMkcHJvcHMkc2V0dGluZy50eXBlLAogICAgICAgICAgdmFsaWRhdGlvbiA9IF90aGlzJHByb3BzJHNldHRpbmcudmFsaWRhdGlvbjsKICAgICAgdmFyIHVuc2F2ZWRWYWx1ZSA9IF90aGlzLnN0YXRlLnVuc2F2ZWRWYWx1ZTsKICAgICAgdmFyIG5ld1Vuc2F2ZWRWYWx1ZSA9IHVuZGVmaW5lZDsKCiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgICAgICAgbmV3VW5zYXZlZFZhbHVlID0gIXVuc2F2ZWRWYWx1ZTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgICAgbmV3VW5zYXZlZFZhbHVlID0gTnVtYmVyKHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgbmV3VW5zYXZlZFZhbHVlID0gdmFsdWU7CiAgICAgIH0KCiAgICAgIHZhciBpc0ludmFsaWQgPSBmYWxzZTsKICAgICAgdmFyIGVycm9yID0gdW5kZWZpbmVkOwoKICAgICAgaWYgKHZhbGlkYXRpb24gJiYgdmFsaWRhdGlvbi5yZWdleCkgewogICAgICAgIGlmICghdmFsaWRhdGlvbi5yZWdleC50ZXN0KG5ld1Vuc2F2ZWRWYWx1ZSkpIHsKICAgICAgICAgIGVycm9yID0gdmFsaWRhdGlvbi5tZXNzYWdlOwogICAgICAgICAgaXNJbnZhbGlkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICB1bnNhdmVkVmFsdWU6IG5ld1Vuc2F2ZWRWYWx1ZSwKICAgICAgICBpc0ludmFsaWQ6IGlzSW52YWxpZCwKICAgICAgICBlcnJvcjogZXJyb3IKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZpZWxkS2V5RG93biIsIGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgIHZhciBrZXlDb2RlID0gX3JlZi5rZXlDb2RlOwoKICAgICAgaWYgKGtleUNvZGUgPT09IF9ldWkua2V5Q29kZXMuRU5URVIpIHsKICAgICAgICBfdGhpcy5zYXZlRWRpdCgpOwogICAgICB9CgogICAgICBpZiAoa2V5Q29kZSA9PT0gX2V1aS5rZXlDb2Rlcy5FU0NBUEUpIHsKICAgICAgICBfdGhpcy5jYW5jZWxFZGl0KCk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uRmllbGRFc2NhcGUiLCBmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgdmFyIGtleUNvZGUgPSBfcmVmMi5rZXlDb2RlOwoKICAgICAgaWYgKGtleUNvZGUgPT09IF9ldWkua2V5Q29kZXMuRVNDQVBFKSB7CiAgICAgICAgX3RoaXMuY2FuY2VsRWRpdCgpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkltYWdlQ2hhbmdlIiwgZnVuY3Rpb24gX2NhbGxlZShmaWxlcykgewogICAgICB2YXIgZmlsZSwgbWF4U2l6ZSwgYmFzZTY0SW1hZ2UsIGlzSW52YWxpZDsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMuY2xlYXJFcnJvcigpOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICB1bnNhdmVkVmFsdWU6IG51bGwKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgZmlsZSA9IGZpbGVzWzBdOwogICAgICAgICAgICAgIG1heFNpemUgPSBfdGhpcy5wcm9wcy5zZXR0aW5nLnZhbGlkYXRpb24ubWF4U2l6ZTsKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNjsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmdldEltYWdlQXNCYXNlNjQoZmlsZSkpOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGJhc2U2NEltYWdlID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICBpc0ludmFsaWQgPSAhIShtYXhTaXplICYmIG1heFNpemUubGVuZ3RoICYmIGJhc2U2NEltYWdlLmxlbmd0aCA+IG1heFNpemUubGVuZ3RoKTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQsCiAgICAgICAgICAgICAgICBlcnJvcjogaXNJbnZhbGlkID8gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLmltYWdlVG9vTGFyZ2VFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnSW1hZ2UgaXMgdG9vIGxhcmdlLCBtYXhpbXVtIHNpemUgaXMge21heFNpemVEZXNjcmlwdGlvbn0nLAogICAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgICBtYXhTaXplRGVzY3JpcHRpb246IG1heFNpemUuZGVzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkgOiBudWxsLAogICAgICAgICAgICAgICAgY2hhbmdlSW1hZ2U6IHRydWUsCiAgICAgICAgICAgICAgICB1bnNhdmVkVmFsdWU6IGJhc2U2NEltYWdlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE0OwogICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oNik7CgogICAgICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuaW1hZ2VDaGFuZ2VFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0ltYWdlIGNvdWxkIG5vdCBiZSBzYXZlZCcKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIF90aGlzLmNhbmNlbENoYW5nZUltYWdlKCk7CgogICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCBudWxsLCBbWzYsIDE0XV0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiY2hhbmdlSW1hZ2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBjaGFuZ2VJbWFnZTogdHJ1ZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNhbmNlbENoYW5nZUltYWdlIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgc2F2ZWRWYWx1ZSA9IF90aGlzLnN0YXRlLnNhdmVkVmFsdWU7CgogICAgICBpZiAoX3RoaXMuY2hhbmdlSW1hZ2VGb3JtKSB7CiAgICAgICAgX3RoaXMuY2hhbmdlSW1hZ2VGb3JtLmZpbGVJbnB1dC52YWx1ZSA9IG51bGw7CgogICAgICAgIF90aGlzLmNoYW5nZUltYWdlRm9ybS5oYW5kbGVDaGFuZ2UoKTsKICAgICAgfQoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGNoYW5nZUltYWdlOiBmYWxzZSwKICAgICAgICB1bnNhdmVkVmFsdWU6IHNhdmVkVmFsdWUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjYW5jZWxFZGl0IiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgc2F2ZWRWYWx1ZSA9IF90aGlzLnN0YXRlLnNhdmVkVmFsdWU7CgogICAgICBfdGhpcy5jbGVhckVycm9yKCk7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdW5zYXZlZFZhbHVlOiBzYXZlZFZhbHVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2hvd1BhZ2VSZWxvYWRUb2FzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKF90aGlzLnByb3BzLnNldHRpbmcucmVxdWlyZXNQYWdlUmVsb2FkKSB7CiAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkKHsKICAgICAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQucmVxdWlyZXNQYWdlUmVsb2FkVG9hc3REZXNjcmlwdGlvbicsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQbGVhc2UgcmVsb2FkIHRoZSBwYWdlIGZvciB0aGUgIntzZXR0aW5nTmFtZX0iIHNldHRpbmcgdG8gdGFrZSBlZmZlY3QuJywKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgc2V0dGluZ05hbWU6IF90aGlzLnByb3BzLnNldHRpbmcuZGlzcGxheU5hbWUgfHwgX3RoaXMucHJvcHMuc2V0dGluZy5uYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgdGV4dDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogImZsZXhFbmQiLAogICAgICAgICAgICBndXR0ZXJTaXplOiAicyIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgICBncm93OiBmYWxzZQogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgICAgICBzaXplOiAicyIsCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLnJlcXVpcmVzUGFnZVJlbG9hZFRvYXN0QnV0dG9uTGFiZWwnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVsb2FkIHBhZ2UnCiAgICAgICAgICB9KSkpKSksCiAgICAgICAgICBjb2xvcjogJ3N1Y2Nlc3MnCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNhdmVFZGl0IiwgZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wcyRzZXR0aW5nMiwgbmFtZSwgZGVmVmFsLCB0eXBlLCBfdGhpcyRzdGF0ZSwgY2hhbmdlSW1hZ2UsIHNhdmVkVmFsdWUsIHVuc2F2ZWRWYWx1ZSwgaXNKc29uQXJyYXksIHZhbHVlVG9TYXZlLCBpc1NhbWVWYWx1ZTsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF90aGlzJHByb3BzJHNldHRpbmcyID0gX3RoaXMucHJvcHMuc2V0dGluZywgbmFtZSA9IF90aGlzJHByb3BzJHNldHRpbmcyLm5hbWUsIGRlZlZhbCA9IF90aGlzJHByb3BzJHNldHRpbmcyLmRlZlZhbCwgdHlwZSA9IF90aGlzJHByb3BzJHNldHRpbmcyLnR5cGU7CiAgICAgICAgICAgICAgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwgY2hhbmdlSW1hZ2UgPSBfdGhpcyRzdGF0ZS5jaGFuZ2VJbWFnZSwgc2F2ZWRWYWx1ZSA9IF90aGlzJHN0YXRlLnNhdmVkVmFsdWUsIHVuc2F2ZWRWYWx1ZSA9IF90aGlzJHN0YXRlLnVuc2F2ZWRWYWx1ZSwgaXNKc29uQXJyYXkgPSBfdGhpcyRzdGF0ZS5pc0pzb25BcnJheTsKCiAgICAgICAgICAgICAgaWYgKCEoc2F2ZWRWYWx1ZSA9PT0gdW5zYXZlZFZhbHVlKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgdmFsdWVUb1NhdmUgPSB1bnNhdmVkVmFsdWU7CiAgICAgICAgICAgICAgaXNTYW1lVmFsdWUgPSBmYWxzZTsKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSB0eXBlOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gX2NvbnRleHQyLnQwID09PSAnYXJyYXknID8gOSA6IF9jb250ZXh0Mi50MCA9PT0gJ2pzb24nID8gMTIgOiAxNDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICB2YWx1ZVRvU2F2ZSA9IHZhbHVlVG9TYXZlLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWwudHJpbSgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlzU2FtZVZhbHVlID0gdmFsdWVUb1NhdmUuam9pbignLCcpID09PSBkZWZWYWwuam9pbignLCcpOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJicmVhayIsIDE1KTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgdmFsdWVUb1NhdmUgPSB2YWx1ZVRvU2F2ZS50cmltKCk7CiAgICAgICAgICAgICAgdmFsdWVUb1NhdmUgPSB2YWx1ZVRvU2F2ZSB8fCAoaXNKc29uQXJyYXkgPyAnW10nIDogJ3t9Jyk7CgogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGlzU2FtZVZhbHVlID0gdmFsdWVUb1NhdmUgPT09IGRlZlZhbDsKCiAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgX3RoaXMuc2V0TG9hZGluZyh0cnVlKTsKCiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxNjsKCiAgICAgICAgICAgICAgaWYgKCFpc1NhbWVWYWx1ZSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyMDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLnByb3BzLmNsZWFyKG5hbWUpKTsKCiAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyNDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyNDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLnByb3BzLnNhdmUobmFtZSwgdmFsdWVUb1NhdmUpKTsKCiAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgX3RoaXMuc2hvd1BhZ2VSZWxvYWRUb2FzdCgpOwoKICAgICAgICAgICAgICBpZiAoY2hhbmdlSW1hZ2UpIHsKICAgICAgICAgICAgICAgIF90aGlzLmNhbmNlbENoYW5nZUltYWdlKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDMxOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDI4OwogICAgICAgICAgICAgIF9jb250ZXh0Mi50MSA9IF9jb250ZXh0MlsiY2F0Y2giXSgxNik7CgogICAgICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuc2F2ZUZpZWxkRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdVbmFibGUgdG8gc2F2ZSB7bmFtZX0nLAogICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgIF90aGlzLnNldExvYWRpbmcoZmFsc2UpOwoKICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIG51bGwsIFtbMTYsIDI4XV0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVzZXRGaWVsZCIsIGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICB2YXIgbmFtZTsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgbmFtZSA9IF90aGlzLnByb3BzLnNldHRpbmcubmFtZTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0TG9hZGluZyh0cnVlKTsKCiAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAyOwogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLnByb3BzLmNsZWFyKG5hbWUpKTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBfdGhpcy5zaG93UGFnZVJlbG9hZFRvYXN0KCk7CgogICAgICAgICAgICAgIF90aGlzLmNhbmNlbENoYW5nZUltYWdlKCk7CgogICAgICAgICAgICAgIF90aGlzLmNsZWFyRXJyb3IoKTsKCiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMzsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAxMDsKICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oMik7CgogICAgICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQucmVzZXRGaWVsZEVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5hYmxlIHRvIHJlc2V0IHtuYW1lfScsCiAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgX3RoaXMuc2V0TG9hZGluZyhmYWxzZSk7CgogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgbnVsbCwgW1syLCAxMF1dKTsKICAgIH0pOwoKICAgIHZhciBfdGhpcyRwcm9wcyRzZXR0aW5nMyA9IF90aGlzLnByb3BzLnNldHRpbmcsCiAgICAgICAgX3R5cGUgPSBfdGhpcyRwcm9wcyRzZXR0aW5nMy50eXBlLAogICAgICAgIF92YWx1ZSA9IF90aGlzJHByb3BzJHNldHRpbmczLnZhbHVlLAogICAgICAgIF9kZWZWYWwgPSBfdGhpcyRwcm9wcyRzZXR0aW5nMy5kZWZWYWw7CgogICAgdmFyIGVkaXRhYmxlVmFsdWUgPSBfdGhpcy5nZXRFZGl0YWJsZVZhbHVlKF90eXBlLCBfdmFsdWUsIF9kZWZWYWwpOwoKICAgIF90aGlzLnN0YXRlID0gewogICAgICBpc0ludmFsaWQ6IGZhbHNlLAogICAgICBlcnJvcjogbnVsbCwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGNoYW5nZUltYWdlOiBmYWxzZSwKICAgICAgc2F2ZWRWYWx1ZTogZWRpdGFibGVWYWx1ZSwKICAgICAgdW5zYXZlZFZhbHVlOiBlZGl0YWJsZVZhbHVlLAogICAgICBpc0pzb25BcnJheTogX3R5cGUgPT09ICdqc29uJyA/IEFycmF5LmlzQXJyYXkoSlNPTi5wYXJzZShfZGVmVmFsIHx8ICd7fScpKSA6IGZhbHNlCiAgICB9OwogICAgX3RoaXMuY2hhbmdlSW1hZ2VGb3JtID0gbnVsbDsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhGaWVsZCwgW3sKICAgIGtleTogIlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHsKICAgICAgdmFyIHVuc2F2ZWRWYWx1ZSA9IHRoaXMuc3RhdGUudW5zYXZlZFZhbHVlOwogICAgICB2YXIgX25leHRQcm9wcyRzZXR0aW5nID0gbmV4dFByb3BzLnNldHRpbmcsCiAgICAgICAgICB0eXBlID0gX25leHRQcm9wcyRzZXR0aW5nLnR5cGUsCiAgICAgICAgICB2YWx1ZSA9IF9uZXh0UHJvcHMkc2V0dGluZy52YWx1ZSwKICAgICAgICAgIGRlZlZhbCA9IF9uZXh0UHJvcHMkc2V0dGluZy5kZWZWYWw7CiAgICAgIHZhciBlZGl0YWJsZVZhbHVlID0gdGhpcy5nZXRFZGl0YWJsZVZhbHVlKHR5cGUsIHZhbHVlLCBkZWZWYWwpOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBzYXZlZFZhbHVlOiBlZGl0YWJsZVZhbHVlLAogICAgICAgIHVuc2F2ZWRWYWx1ZTogdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/IGVkaXRhYmxlVmFsdWUgOiB1bnNhdmVkVmFsdWUKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RWRpdGFibGVWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RWRpdGFibGVWYWx1ZSh0eXBlLCB2YWx1ZSwgZGVmVmFsKSB7CiAgICAgIHZhciB2YWwgPSB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gZGVmVmFsIDogdmFsdWU7CgogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICdhcnJheSc6CiAgICAgICAgICByZXR1cm4gdmFsLmpvaW4oJywgJyk7CgogICAgICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgICAgICAgcmV0dXJuICEhdmFsOwoKICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgICAgcmV0dXJuIE51bWJlcih2YWwpOwoKICAgICAgICBjYXNlICdpbWFnZSc6CiAgICAgICAgICByZXR1cm4gdmFsOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIHZhbCB8fCAnJzsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldERpc3BsYXllZERlZmF1bHRWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGlzcGxheWVkRGVmYXVsdFZhbHVlKHR5cGUsIGRlZlZhbCkgewogICAgICB2YXIgb3B0aW9uTGFiZWxzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKCiAgICAgIGlmIChkZWZWYWwgPT09IHVuZGVmaW5lZCB8fCBkZWZWYWwgPT09IG51bGwgfHwgZGVmVmFsID09PSAnJykgewogICAgICAgIHJldHVybiAnbnVsbCc7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgJ2FycmF5JzoKICAgICAgICAgIHJldHVybiBkZWZWYWwuam9pbignLCAnKTsKCiAgICAgICAgY2FzZSAnc2VsZWN0JzoKICAgICAgICAgIHJldHVybiBvcHRpb25MYWJlbHMuaGFzT3duUHJvcGVydHkoZGVmVmFsKSA/IG9wdGlvbkxhYmVsc1tkZWZWYWxdIDogU3RyaW5nKGRlZlZhbCk7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gU3RyaW5nKGRlZlZhbCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRMb2FkaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRMb2FkaW5nKGxvYWRpbmcpIHsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgbG9hZGluZzogbG9hZGluZwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjbGVhckVycm9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhckVycm9yKCkgewogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBpc0ludmFsaWQ6IGZhbHNlLAogICAgICAgIGVycm9yOiBudWxsCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEltYWdlQXNCYXNlNjQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEltYWdlQXNCYXNlNjQoZmlsZSkgewogICAgICBpZiAoIWZpbGUgaW5zdGFuY2VvZiBGaWxlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVzb2x2ZShyZWFkZXIucmVzdWx0KTsKICAgICAgICB9OwoKICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIHJlamVjdChlcnIpOwogICAgICAgIH07CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckZpZWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJGaWVsZChzZXR0aW5nKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGVuYWJsZVNhdmluZyA9IHRoaXMucHJvcHMuZW5hYmxlU2F2aW5nOwogICAgICB2YXIgX3RoaXMkc3RhdGUyID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGxvYWRpbmcgPSBfdGhpcyRzdGF0ZTIubG9hZGluZywKICAgICAgICAgIGNoYW5nZUltYWdlID0gX3RoaXMkc3RhdGUyLmNoYW5nZUltYWdlLAogICAgICAgICAgdW5zYXZlZFZhbHVlID0gX3RoaXMkc3RhdGUyLnVuc2F2ZWRWYWx1ZTsKICAgICAgdmFyIG5hbWUgPSBzZXR0aW5nLm5hbWUsCiAgICAgICAgICB2YWx1ZSA9IHNldHRpbmcudmFsdWUsCiAgICAgICAgICB0eXBlID0gc2V0dGluZy50eXBlLAogICAgICAgICAgb3B0aW9ucyA9IHNldHRpbmcub3B0aW9ucywKICAgICAgICAgIF9zZXR0aW5nJG9wdGlvbkxhYmVscyA9IHNldHRpbmcub3B0aW9uTGFiZWxzLAogICAgICAgICAgb3B0aW9uTGFiZWxzID0gX3NldHRpbmckb3B0aW9uTGFiZWxzID09PSB2b2lkIDAgPyB7fSA6IF9zZXR0aW5nJG9wdGlvbkxhYmVscywKICAgICAgICAgIGlzT3ZlcnJpZGRlbiA9IHNldHRpbmcuaXNPdmVycmlkZGVuLAogICAgICAgICAgYXJpYU5hbWUgPSBzZXR0aW5nLmFyaWFOYW1lOwoKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVN3aXRjaCwgewogICAgICAgICAgICBsYWJlbDogISF1bnNhdmVkVmFsdWUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQub25MYWJlbCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJPbiIKICAgICAgICAgICAgfSkgOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQub2ZmTGFiZWwiLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiT2ZmIgogICAgICAgICAgICB9KSwKICAgICAgICAgICAgY2hlY2tlZDogISF1bnNhdmVkVmFsdWUsCiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uRmllbGRDaGFuZ2UsCiAgICAgICAgICAgIGRpc2FibGVkOiBsb2FkaW5nIHx8IGlzT3ZlcnJpZGRlbiB8fCAhZW5hYmxlU2F2aW5nLAogICAgICAgICAgICBvbktleURvd246IHRoaXMub25GaWVsZEtleURvd24sCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmctZWRpdEZpZWxkLSIuY29uY2F0KG5hbWUpLAogICAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFOYW1lCiAgICAgICAgICB9KTsKCiAgICAgICAgY2FzZSAnbWFya2Rvd24nOgogICAgICAgIGNhc2UgJ2pzb24nOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1lZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2RlRWRpdG9yLCB7CiAgICAgICAgICAgICJhcmlhLWxhYmVsIjogYXJpYU5hbWUsCiAgICAgICAgICAgIG1vZGU6IHR5cGUsCiAgICAgICAgICAgIHRoZW1lOiAidGV4dG1hdGUiLAogICAgICAgICAgICB2YWx1ZTogdW5zYXZlZFZhbHVlLAogICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkNvZGVFZGl0b3JDaGFuZ2UsCiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgIGhlaWdodDogImF1dG8iLAogICAgICAgICAgICBtaW5MaW5lczogNiwKICAgICAgICAgICAgbWF4TGluZXM6IDMwLAogICAgICAgICAgICBpc1JlYWRPbmx5OiBpc092ZXJyaWRkZW4gfHwgIWVuYWJsZVNhdmluZywKICAgICAgICAgICAgc2V0T3B0aW9uczogewogICAgICAgICAgICAgIHNob3dMaW5lTnVtYmVyczogZmFsc2UsCiAgICAgICAgICAgICAgdGFiU2l6ZTogMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlZGl0b3JQcm9wczogewogICAgICAgICAgICAgICRibG9ja1Njcm9sbGluZzogSW5maW5pdHkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2hvd0d1dHRlcjogZmFsc2UKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAnaW1hZ2UnOgogICAgICAgICAgaWYgKCEoMCwgX2xpYi5pc0RlZmF1bHRWYWx1ZSkoc2V0dGluZykgJiYgIWNoYW5nZUltYWdlKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSW1hZ2UsIHsKICAgICAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFOYW1lLAogICAgICAgICAgICAgIGFsbG93RnVsbFNjcmVlbjogdHJ1ZSwKICAgICAgICAgICAgICB1cmw6IHZhbHVlLAogICAgICAgICAgICAgIGFsdDogbmFtZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmlsZVBpY2tlciwgewogICAgICAgICAgICAgIGRpc2FibGVkOiBsb2FkaW5nIHx8IGlzT3ZlcnJpZGRlbiB8fCAhZW5hYmxlU2F2aW5nLAogICAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uSW1hZ2VDaGFuZ2UsCiAgICAgICAgICAgICAgYWNjZXB0OiAiLmpwZywuanBlZywucG5nIiwKICAgICAgICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihpbnB1dCkgewogICAgICAgICAgICAgICAgX3RoaXMyLmNoYW5nZUltYWdlRm9ybSA9IGlucHV0OwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb25LZXlEb3duOiB0aGlzLm9uRmllbGRFc2NhcGUsCiAgICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1lZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgIGNhc2UgJ3NlbGVjdCc6CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNlbGVjdCwgewogICAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFOYW1lLAogICAgICAgICAgICB2YWx1ZTogdW5zYXZlZFZhbHVlLAogICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLm1hcChmdW5jdGlvbiAob3B0aW9uKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHRleHQ6IG9wdGlvbkxhYmVscy5oYXNPd25Qcm9wZXJ0eShvcHRpb24pID8gb3B0aW9uTGFiZWxzW29wdGlvbl0gOiBvcHRpb24sCiAgICAgICAgICAgICAgICB2YWx1ZTogb3B0aW9uCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uRmllbGRDaGFuZ2UsCiAgICAgICAgICAgIGlzTG9hZGluZzogbG9hZGluZywKICAgICAgICAgICAgZGlzYWJsZWQ6IGxvYWRpbmcgfHwgaXNPdmVycmlkZGVuIHx8ICFlbmFibGVTYXZpbmcsCiAgICAgICAgICAgIG9uS2V5RG93bjogdGhpcy5vbkZpZWxkS2V5RG93biwKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1lZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgICAgIH0pOwoKICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZE51bWJlciwgewogICAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFOYW1lLAogICAgICAgICAgICB2YWx1ZTogdW5zYXZlZFZhbHVlLAogICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkZpZWxkQ2hhbmdlLAogICAgICAgICAgICBpc0xvYWRpbmc6IGxvYWRpbmcsCiAgICAgICAgICAgIGRpc2FibGVkOiBsb2FkaW5nIHx8IGlzT3ZlcnJpZGRlbiB8fCAhZW5hYmxlU2F2aW5nLAogICAgICAgICAgICBvbktleURvd246IHRoaXMub25GaWVsZEtleURvd24sCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmctZWRpdEZpZWxkLSIuY29uY2F0KG5hbWUpCiAgICAgICAgICB9KTsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGRUZXh0LCB7CiAgICAgICAgICAgICJhcmlhLWxhYmVsIjogYXJpYU5hbWUsCiAgICAgICAgICAgIHZhbHVlOiB1bnNhdmVkVmFsdWUsCiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uRmllbGRDaGFuZ2UsCiAgICAgICAgICAgIGlzTG9hZGluZzogbG9hZGluZywKICAgICAgICAgICAgZGlzYWJsZWQ6IGxvYWRpbmcgfHwgaXNPdmVycmlkZGVuIHx8ICFlbmFibGVTYXZpbmcsCiAgICAgICAgICAgIG9uS2V5RG93bjogdGhpcy5vbkZpZWxkS2V5RG93biwKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1lZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyTGFiZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckxhYmVsKHNldHRpbmcpIHsKICAgICAgcmV0dXJuIHNldHRpbmcubmFtZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJIZWxwVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVySGVscFRleHQoc2V0dGluZykgewogICAgICBpZiAoc2V0dGluZy5pc092ZXJyaWRkZW4pIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIHsKICAgICAgICAgIHNpemU6ICJ4cyIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5oZWxwVGV4dCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoaXMgc2V0dGluZyBpcyBvdmVycmlkZGVuIGJ5IHRoZSBLaWJhbmEgc2VydmVyIGFuZCBjYW4gbm90IGJlIGNoYW5nZWQuIgogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgdmFyIGNhblVwZGF0ZVNldHRpbmcgPSB0aGlzLnByb3BzLmVuYWJsZVNhdmluZzsKICAgICAgdmFyIGRlZmF1bHRMaW5rID0gdGhpcy5yZW5kZXJSZXNldFRvRGVmYXVsdExpbmsoc2V0dGluZyk7CiAgICAgIHZhciBpbWFnZUxpbmsgPSB0aGlzLnJlbmRlckNoYW5nZUltYWdlTGluayhzZXR0aW5nKTsKCiAgICAgIGlmIChjYW5VcGRhdGVTZXR0aW5nICYmIChkZWZhdWx0TGluayB8fCBpbWFnZUxpbmspKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBkZWZhdWx0TGluaywgaW1hZ2VMaW5rKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyVGl0bGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclRpdGxlKHNldHRpbmcpIHsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgzIiwgbnVsbCwgc2V0dGluZy5kaXNwbGF5TmFtZSB8fCBzZXR0aW5nLm5hbWUsIHNldHRpbmcuaXNDdXN0b20gPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvblRpcCwgewogICAgICAgIHR5cGU6ICJhc3RlcmlzayIsCiAgICAgICAgY29sb3I6ICJwcmltYXJ5IiwKICAgICAgICAiYXJpYS1sYWJlbCI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5jdXN0b21TZXR0aW5nQXJpYUxhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDdXN0b20gc2V0dGluZycKICAgICAgICB9KSwKICAgICAgICBjb250ZW50OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5jdXN0b21TZXR0aW5nVG9vbHRpcCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkN1c3RvbSBzZXR0aW5nIgogICAgICAgIH0pCiAgICAgIH0pIDogJycpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckRlc2NyaXB0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJEZXNjcmlwdGlvbihzZXR0aW5nKSB7CiAgICAgIHZhciBkZXNjcmlwdGlvbjsKICAgICAgdmFyIGRlcHJlY2F0aW9uOwoKICAgICAgaWYgKHNldHRpbmcuZGVwcmVjYXRpb24pIHsKICAgICAgICB2YXIgbGlua3MgPSBfbmV3X3BsYXRmb3JtLm5wU3RhcnQuY29yZS5kb2NMaW5rcy5saW5rczsKICAgICAgICBkZXByZWNhdGlvbiA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUb29sVGlwLCB7CiAgICAgICAgICBjb250ZW50OiBzZXR0aW5nLmRlcHJlY2F0aW9uLm1lc3NhZ2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQmFkZ2UsIHsKICAgICAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICB3aW5kb3cub3BlbihsaW5rcy5tYW5hZ2VtZW50W3NldHRpbmcuZGVwcmVjYXRpb24uZG9jTGlua3NLZXldLCAnX2JsYW5rJyk7CiAgICAgICAgICB9LAogICAgICAgICAgb25DbGlja0FyaWFMYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLmRlcHJlY2F0aW9uQ2xpY2tBcmVhTGFiZWwnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ2xpY2sgdG8gdmlldyBkZXByZWNhdGlvbiBkb2N1bWVudGF0aW9uIGZvciB7c2V0dGluZ05hbWV9LicsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIHNldHRpbmdOYW1lOiBzZXR0aW5nLm5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICB9LCAiRGVwcmVjYXRlZCIpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgICAgc2l6ZTogInMiCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICBpZiAoX3JlYWN0LmRlZmF1bHQuaXNWYWxpZEVsZW1lbnQoc2V0dGluZy5kZXNjcmlwdGlvbikpIHsKICAgICAgICBkZXNjcmlwdGlvbiA9IHNldHRpbmcuZGVzY3JpcHRpb247CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVzY3JpcHRpb24gPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAvKgogICAgICAgICAgICogSnVzdGlmaWNhdGlvbiBmb3IgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw6CiAgICAgICAgICAgKiBTZXR0aW5nIGRlc2NyaXB0aW9uIG1heSBjb250YWluIGZvcm1hdHRpbmcgYW5kIGxpbmtzIHRvIGRvY3VtZW50YXRpb24uCiAgICAgICAgICAgKi8KICAgICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiB7CiAgICAgICAgICAgIF9faHRtbDogc2V0dGluZy5kZXNjcmlwdGlvbgogICAgICAgICAgfSAvL2VzbGludC1kaXNhYmxlLWxpbmUgcmVhY3Qvbm8tZGFuZ2VyCgogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIGRlcHJlY2F0aW9uLCBkZXNjcmlwdGlvbiwgdGhpcy5yZW5kZXJEZWZhdWx0VmFsdWUoc2V0dGluZykpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckRlZmF1bHRWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyRGVmYXVsdFZhbHVlKHNldHRpbmcpIHsKICAgICAgdmFyIHR5cGUgPSBzZXR0aW5nLnR5cGUsCiAgICAgICAgICBkZWZWYWwgPSBzZXR0aW5nLmRlZlZhbCwKICAgICAgICAgIG9wdGlvbkxhYmVscyA9IHNldHRpbmcub3B0aW9uTGFiZWxzOwoKICAgICAgaWYgKCgwLCBfbGliLmlzRGVmYXVsdFZhbHVlKShzZXR0aW5nKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogInMiCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgewogICAgICAgIHNpemU6ICJ4cyIKICAgICAgfSwgdHlwZSA9PT0gJ2pzb24nID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5kZWZhdWx0VmFsdWVUeXBlSnNvblRleHQiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVmYXVsdDoge3ZhbHVlfSIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICB2YWx1ZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvZGVCbG9jaywgewogICAgICAgICAgICBsYW5ndWFnZTogImpzb24iLAogICAgICAgICAgICBwYWRkaW5nU2l6ZTogInMiLAogICAgICAgICAgICBvdmVyZmxvd0hlaWdodDogZGVmVmFsLmxlbmd0aCA+PSA1MDAgPyAzMDAgOiBudWxsCiAgICAgICAgICB9LCB0aGlzLmdldERpc3BsYXllZERlZmF1bHRWYWx1ZSh0eXBlLCBkZWZWYWwpKQogICAgICAgIH0KICAgICAgfSkpIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5kZWZhdWx0VmFsdWVUZXh0IiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlZmF1bHQ6IHt2YWx1ZX0iLAogICAgICAgIHZhbHVlczogewogICAgICAgICAgdmFsdWU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2RlLCBudWxsLCB0aGlzLmdldERpc3BsYXllZERlZmF1bHRWYWx1ZSh0eXBlLCBkZWZWYWwsIG9wdGlvbkxhYmVscykpCiAgICAgICAgfQogICAgICB9KSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJSZXNldFRvRGVmYXVsdExpbmsiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclJlc2V0VG9EZWZhdWx0TGluayhzZXR0aW5nKSB7CiAgICAgIHZhciBhcmlhTmFtZSA9IHNldHRpbmcuYXJpYU5hbWUsCiAgICAgICAgICBuYW1lID0gc2V0dGluZy5uYW1lOwoKICAgICAgaWYgKCgwLCBfbGliLmlzRGVmYXVsdFZhbHVlKShzZXR0aW5nKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgICJhcmlhLWxhYmVsIjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLnJlc2V0VG9EZWZhdWx0TGlua0FyaWFMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVzZXQge2FyaWFOYW1lfSB0byBkZWZhdWx0JywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBhcmlhTmFtZTogYXJpYU5hbWUKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiB0aGlzLnJlc2V0RmllbGQsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1yZXNldEZpZWxkLSIuY29uY2F0KG5hbWUpCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5yZXNldFRvRGVmYXVsdExpbmtUZXh0IiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlJlc2V0IHRvIGRlZmF1bHQiCiAgICAgIH0pKSwgIlx4QTBceEEwXHhBMCIpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckNoYW5nZUltYWdlTGluayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyQ2hhbmdlSW1hZ2VMaW5rKHNldHRpbmcpIHsKICAgICAgdmFyIGNoYW5nZUltYWdlID0gdGhpcy5zdGF0ZS5jaGFuZ2VJbWFnZTsKICAgICAgdmFyIHR5cGUgPSBzZXR0aW5nLnR5cGUsCiAgICAgICAgICB2YWx1ZSA9IHNldHRpbmcudmFsdWUsCiAgICAgICAgICBhcmlhTmFtZSA9IHNldHRpbmcuYXJpYU5hbWUsCiAgICAgICAgICBuYW1lID0gc2V0dGluZy5uYW1lOwoKICAgICAgaWYgKHR5cGUgIT09ICdpbWFnZScgfHwgIXZhbHVlIHx8IGNoYW5nZUltYWdlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMaW5rLCB7CiAgICAgICAgImFyaWEtbGFiZWwiOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuY2hhbmdlSW1hZ2VMaW5rQXJpYUxhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDaGFuZ2Uge2FyaWFOYW1lfScsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgYXJpYU5hbWU6IGFyaWFOYW1lCiAgICAgICAgICB9CiAgICAgICAgfSksCiAgICAgICAgb25DbGljazogdGhpcy5jaGFuZ2VJbWFnZSwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiYWR2YW5jZWRTZXR0aW5nLWNoYW5nZUltYWdlLSIuY29uY2F0KG5hbWUpCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5jaGFuZ2VJbWFnZUxpbmtUZXh0IiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNoYW5nZSBpbWFnZSIKICAgICAgfSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJBY3Rpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJBY3Rpb25zKHNldHRpbmcpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgYXJpYU5hbWUgPSBzZXR0aW5nLmFyaWFOYW1lLAogICAgICAgICAgbmFtZSA9IHNldHRpbmcubmFtZTsKICAgICAgdmFyIF90aGlzJHN0YXRlMyA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBsb2FkaW5nID0gX3RoaXMkc3RhdGUzLmxvYWRpbmcsCiAgICAgICAgICBpc0ludmFsaWQgPSBfdGhpcyRzdGF0ZTMuaXNJbnZhbGlkLAogICAgICAgICAgY2hhbmdlSW1hZ2UgPSBfdGhpcyRzdGF0ZTMuY2hhbmdlSW1hZ2UsCiAgICAgICAgICBzYXZlZFZhbHVlID0gX3RoaXMkc3RhdGUzLnNhdmVkVmFsdWUsCiAgICAgICAgICB1bnNhdmVkVmFsdWUgPSBfdGhpcyRzdGF0ZTMudW5zYXZlZFZhbHVlOwogICAgICB2YXIgaXNEaXNhYmxlZCA9IGxvYWRpbmcgfHwgc2V0dGluZy5pc092ZXJyaWRkZW47CgogICAgICBpZiAoc2F2ZWRWYWx1ZSA9PT0gdW5zYXZlZFZhbHVlICYmICFjaGFuZ2VJbWFnZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgY2xhc3NOYW1lOiAibWd0QWR2YW5jZWRTZXR0aW5nc19fZmllbGRBY3Rpb25zIiwKICAgICAgICBoYXNFbXB0eUxhYmVsU3BhY2U6IHRydWUKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgImFyaWEtbGFiZWwiOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQuc2V0dGluZ3MuZmllbGQuc2F2ZUJ1dHRvbkFyaWFMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2F2ZSB7YXJpYU5hbWV9JywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBhcmlhTmFtZTogYXJpYU5hbWUKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiB0aGlzLnNhdmVFZGl0LAogICAgICAgIGRpc2FibGVkOiBpc0Rpc2FibGVkIHx8IGlzSW52YWxpZCwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiYWR2YW5jZWRTZXR0aW5nLXNhdmVFZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLnNhdmVCdXR0b25MYWJlbCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlIgogICAgICB9KSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICAiYXJpYS1sYWJlbCI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5zZXR0aW5ncy5maWVsZC5jYW5jZWxFZGl0aW5nQnV0dG9uQXJpYUxhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDYW5jZWwgZWRpdGluZyB7YXJpYU5hbWV9JywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBhcmlhTmFtZTogYXJpYU5hbWUKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgcmV0dXJuIGNoYW5nZUltYWdlID8gX3RoaXMzLmNhbmNlbENoYW5nZUltYWdlKCkgOiBfdGhpczMuY2FuY2VsRWRpdCgpOwogICAgICAgIH0sCiAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFkdmFuY2VkU2V0dGluZy1jYW5jZWxFZGl0RmllbGQtIi5jb25jYXQobmFtZSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50LnNldHRpbmdzLmZpZWxkLmNhbmNlbEVkaXRpbmdCdXR0b25MYWJlbCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDYW5jZWwiCiAgICAgIH0pKSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIHNldHRpbmcgPSB0aGlzLnByb3BzLnNldHRpbmc7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTQgPSB0aGlzLnN0YXRlLAogICAgICAgICAgZXJyb3IgPSBfdGhpcyRzdGF0ZTQuZXJyb3IsCiAgICAgICAgICBpc0ludmFsaWQgPSBfdGhpcyRzdGF0ZTQuaXNJbnZhbGlkOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgIGNsYXNzTmFtZTogIm1ndEFkdmFuY2VkU2V0dGluZ3NfX2ZpZWxkIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRGVzY3JpYmVkRm9ybUdyb3VwLCB7CiAgICAgICAgY2xhc3NOYW1lOiAibWd0QWR2YW5jZWRTZXR0aW5nc19fZmllbGRXcmFwcGVyIiwKICAgICAgICB0aXRsZTogdGhpcy5yZW5kZXJUaXRsZShzZXR0aW5nKSwKICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5yZW5kZXJEZXNjcmlwdGlvbihzZXR0aW5nKSwKICAgICAgICBpZEFyaWE6ICIiLmNvbmNhdChzZXR0aW5nLm5hbWUsICItYXJpYSIpCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQsCiAgICAgICAgZXJyb3I6IGVycm9yLAogICAgICAgIGxhYmVsOiB0aGlzLnJlbmRlckxhYmVsKHNldHRpbmcpLAogICAgICAgIGhlbHBUZXh0OiB0aGlzLnJlbmRlckhlbHBUZXh0KHNldHRpbmcpLAogICAgICAgIGRlc2NyaWJlZEJ5SWRzOiBbIiIuY29uY2F0KHNldHRpbmcubmFtZSwgIi1hcmlhIildLAogICAgICAgIGNsYXNzTmFtZTogIm1ndEFkdmFuY2VkU2V0dGluZ3NfX2ZpZWxkUm93IiwKICAgICAgICBoYXNDaGlsZExhYmVsOiBzZXR0aW5nLnR5cGUgIT09ICdib29sZWFuJwogICAgICB9LCB0aGlzLnJlbmRlckZpZWxkKHNldHRpbmcpKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCB0aGlzLnJlbmRlckFjdGlvbnMoc2V0dGluZykpKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBGaWVsZDsKfShfcmVhY3QuUHVyZUNvbXBvbmVudCk7CgpleHBvcnRzLkZpZWxkID0gRmllbGQ7CgpfZGVmaW5lUHJvcGVydHkoRmllbGQsICJwcm9wVHlwZXMiLCB7CiAgc2V0dGluZzogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdC5pc1JlcXVpcmVkLAogIHNhdmU6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQsCiAgY2xlYXI6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQsCiAgZW5hYmxlU2F2aW5nOiBfcHJvcFR5cGVzLmRlZmF1bHQuYm9vbC5pc1JlcXVpcmVkCn0pOw=="},null]}