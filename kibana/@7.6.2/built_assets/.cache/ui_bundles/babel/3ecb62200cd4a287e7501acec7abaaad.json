{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/management/sections/objects/lib/resolve_saved_objects.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/management/sections/objects/lib/resolve_saved_objects.js","mtime":1585205039863},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLnJlc29sdmVJbmRleFBhdHRlcm5Db25mbGljdHMgPSByZXNvbHZlSW5kZXhQYXR0ZXJuQ29uZmxpY3RzOwpleHBvcnRzLnNhdmVPYmplY3RzID0gc2F2ZU9iamVjdHM7CmV4cG9ydHMuc2F2ZU9iamVjdCA9IHNhdmVPYmplY3Q7CmV4cG9ydHMucmVzb2x2ZVNhdmVkU2VhcmNoZXMgPSByZXNvbHZlU2F2ZWRTZWFyY2hlczsKZXhwb3J0cy5yZXNvbHZlU2F2ZWRPYmplY3RzID0gcmVzb2x2ZVNhdmVkT2JqZWN0czsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKZnVuY3Rpb24gZ2V0U2F2ZWRPYmplY3QoZG9jLCBzZXJ2aWNlcykgewogIHZhciBzZXJ2aWNlLCBvYmo7CiAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBnZXRTYXZlZE9iamVjdCQoX2NvbnRleHQpIHsKICAgIHdoaWxlICgxKSB7CiAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBzZXJ2aWNlID0gc2VydmljZXMuZmluZChmdW5jdGlvbiAoc2VydmljZSkgewogICAgICAgICAgICByZXR1cm4gc2VydmljZS50eXBlID09PSBkb2MuX3R5cGU7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoc2VydmljZSkgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgIGNhc2UgMzoKICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChzZXJ2aWNlLmdldCgpKTsKCiAgICAgICAgY2FzZSA1OgogICAgICAgICAgb2JqID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgIG9iai5pZCA9IGRvYy5faWQ7CiAgICAgICAgICBvYmoubWlncmF0aW9uVmVyc2lvbiA9IGRvYy5fbWlncmF0aW9uVmVyc2lvbjsKICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG9iaik7CgogICAgICAgIGNhc2UgOToKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBhZGRKc29uRmllbGRUb0luZGV4UGF0dGVybih0YXJnZXQsIHNvdXJjZVN0cmluZywgZmllbGROYW1lLCBpbmRleE5hbWUpIHsKICBpZiAoc291cmNlU3RyaW5nKSB7CiAgICB0cnkgewogICAgICB0YXJnZXRbZmllbGROYW1lXSA9IEpTT04ucGFyc2Uoc291cmNlU3RyaW5nKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQub2JqZWN0cy5wYXJzaW5nRmllbGRFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFcnJvciBlbmNvdW50ZXJlZCBwYXJzaW5nIHtmaWVsZE5hbWV9IGZvciBpbmRleCBwYXR0ZXJuIHtpbmRleE5hbWV9OiB7ZXJyb3JNZXNzYWdlfScsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBmaWVsZE5hbWU6IGZpZWxkTmFtZSwKICAgICAgICAgIGluZGV4TmFtZTogaW5kZXhOYW1lLAogICAgICAgICAgZXJyb3JNZXNzYWdlOiBlcnJvci5tZXNzYWdlCiAgICAgICAgfQogICAgICB9KSk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpbXBvcnRJbmRleFBhdHRlcm4oZG9jLCBpbmRleFBhdHRlcm5zLCBvdmVyd3JpdGVBbGwsIGNvbmZpcm1Nb2RhbFByb21pc2UpIHsKICB2YXIgZW1wdHlQYXR0ZXJuLCBfZG9jJF9zb3VyY2UsIHRpdGxlLCB0aW1lRmllbGROYW1lLCBmaWVsZHMsIGZpZWxkRm9ybWF0TWFwLCBzb3VyY2VGaWx0ZXJzLCB0eXBlLCB0eXBlTWV0YSwgaW1wb3J0ZWRJbmRleFBhdHRlcm4sIG5ld0lkOwoKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGltcG9ydEluZGV4UGF0dGVybiQoX2NvbnRleHQyKSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGluZGV4UGF0dGVybnMubWFrZSgpKTsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgZW1wdHlQYXR0ZXJuID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICBfZG9jJF9zb3VyY2UgPSBkb2MuX3NvdXJjZSwgdGl0bGUgPSBfZG9jJF9zb3VyY2UudGl0bGUsIHRpbWVGaWVsZE5hbWUgPSBfZG9jJF9zb3VyY2UudGltZUZpZWxkTmFtZSwgZmllbGRzID0gX2RvYyRfc291cmNlLmZpZWxkcywgZmllbGRGb3JtYXRNYXAgPSBfZG9jJF9zb3VyY2UuZmllbGRGb3JtYXRNYXAsIHNvdXJjZUZpbHRlcnMgPSBfZG9jJF9zb3VyY2Uuc291cmNlRmlsdGVycywgdHlwZSA9IF9kb2MkX3NvdXJjZS50eXBlLCB0eXBlTWV0YSA9IF9kb2MkX3NvdXJjZS50eXBlTWV0YTsKICAgICAgICAgIGltcG9ydGVkSW5kZXhQYXR0ZXJuID0gewogICAgICAgICAgICBpZDogZG9jLl9pZCwKICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICB0aW1lRmllbGROYW1lOiB0aW1lRmllbGROYW1lCiAgICAgICAgICB9OwoKICAgICAgICAgIGlmICh0eXBlKSB7CiAgICAgICAgICAgIGltcG9ydGVkSW5kZXhQYXR0ZXJuLnR5cGUgPSB0eXBlOwogICAgICAgICAgfQoKICAgICAgICAgIGFkZEpzb25GaWVsZFRvSW5kZXhQYXR0ZXJuKGltcG9ydGVkSW5kZXhQYXR0ZXJuLCBmaWVsZHMsICdmaWVsZHMnLCB0aXRsZSk7CiAgICAgICAgICBhZGRKc29uRmllbGRUb0luZGV4UGF0dGVybihpbXBvcnRlZEluZGV4UGF0dGVybiwgZmllbGRGb3JtYXRNYXAsICdmaWVsZEZvcm1hdE1hcCcsIHRpdGxlKTsKICAgICAgICAgIGFkZEpzb25GaWVsZFRvSW5kZXhQYXR0ZXJuKGltcG9ydGVkSW5kZXhQYXR0ZXJuLCBzb3VyY2VGaWx0ZXJzLCAnc291cmNlRmlsdGVycycsIHRpdGxlKTsKICAgICAgICAgIGFkZEpzb25GaWVsZFRvSW5kZXhQYXR0ZXJuKGltcG9ydGVkSW5kZXhQYXR0ZXJuLCB0eXBlTWV0YSwgJ3R5cGVNZXRhJywgdGl0bGUpOwogICAgICAgICAgT2JqZWN0LmFzc2lnbihlbXB0eVBhdHRlcm4sIGltcG9ydGVkSW5kZXhQYXR0ZXJuKTsKICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTM7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGVtcHR5UGF0dGVybi5jcmVhdGUob3ZlcndyaXRlQWxsKSk7CgogICAgICAgIGNhc2UgMTM6CiAgICAgICAgICBuZXdJZCA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgIGlmIChuZXdJZCkgewogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI2OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBfY29udGV4dDIucHJldiA9IDE1OwogICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxODsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoY29uZmlybU1vZGFsUHJvbWlzZShfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQuaW5kZXhQYXR0ZXJuLmNvbmZpcm1PdmVyd3JpdGVMYWJlbCcsIHsKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGl0bGUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gb3ZlcndyaXRlICd7dGl0bGV9Jz8iCiAgICAgICAgICB9KSwgewogICAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50LmluZGV4UGF0dGVybi5jb25maXJtT3ZlcndyaXRlVGl0bGUnLCB7CiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdPdmVyd3JpdGUge3R5cGV9PycsCiAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5pbmRleFBhdHRlcm4uY29uZmlybU92ZXJ3cml0ZUJ1dHRvbicsIHsKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ092ZXJ3cml0ZScKICAgICAgICAgICAgfSkKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAxODoKICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjA7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGVtcHR5UGF0dGVybi5jcmVhdGUodHJ1ZSkpOwoKICAgICAgICBjYXNlIDIwOgogICAgICAgICAgbmV3SWQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjY7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAyMzoKICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMjM7CiAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMTUpOwogICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICBjYXNlIDI2OgogICAgICAgICAgaW5kZXhQYXR0ZXJucy5jbGVhckNhY2hlKG5ld0lkKTsKICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBuZXdJZCk7CgogICAgICAgIGNhc2UgMjg6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSwgbnVsbCwgdGhpcywgW1sxNSwgMjNdXSk7Cn0KCmZ1bmN0aW9uIGltcG9ydERvY3VtZW50KG9iaiwgZG9jLCBvdmVyd3JpdGVBbGwpIHsKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGltcG9ydERvY3VtZW50JChfY29udGV4dDMpIHsKICAgIHdoaWxlICgxKSB7CiAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAob2JqLmFwcGx5RVNSZXNwKF9vYmplY3RTcHJlYWQoewogICAgICAgICAgICByZWZlcmVuY2VzOiBkb2MuX3JlZmVyZW5jZXMgfHwgW10KICAgICAgICAgIH0sIGRvYykpKTsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA0OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChvYmouc2F2ZSh7CiAgICAgICAgICAgIGNvbmZpcm1PdmVyd3JpdGU6ICFvdmVyd3JpdGVBbGwKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSA0OgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0My5zZW50KTsKCiAgICAgICAgY2FzZSA1OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBncm91cEJ5VHlwZShkb2NzKSB7CiAgdmFyIGRlZmF1bHREb2NUeXBlcyA9IHsKICAgIHNlYXJjaGVzOiBbXSwKICAgIGluZGV4UGF0dGVybnM6IFtdLAogICAgb3RoZXI6IFtdCiAgfTsKICByZXR1cm4gZG9jcy5yZWR1Y2UoZnVuY3Rpb24gKHR5cGVzLCBkb2MpIHsKICAgIHN3aXRjaCAoZG9jLl90eXBlKSB7CiAgICAgIGNhc2UgJ3NlYXJjaCc6CiAgICAgICAgdHlwZXMuc2VhcmNoZXMucHVzaChkb2MpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnaW5kZXgtcGF0dGVybic6CiAgICAgICAgdHlwZXMuaW5kZXhQYXR0ZXJucy5wdXNoKGRvYyk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIHR5cGVzLm90aGVyLnB1c2goZG9jKTsKICAgIH0KCiAgICByZXR1cm4gdHlwZXM7CiAgfSwgZGVmYXVsdERvY1R5cGVzKTsKfQoKZnVuY3Rpb24gYXdhaXRFYWNoSXRlbUluUGFyYWxsZWwobGlzdCwgb3ApIHsKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGF3YWl0RWFjaEl0ZW1JblBhcmFsbGVsJChfY29udGV4dDQpIHsKICAgIHdoaWxlICgxKSB7CiAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoUHJvbWlzZS5hbGwobGlzdC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIG9wKGl0ZW0pOwogICAgICAgICAgfSkpKTsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0NC5zZW50KTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9CgpmdW5jdGlvbiByZXNvbHZlSW5kZXhQYXR0ZXJuQ29uZmxpY3RzKHJlc29sdXRpb25zLCBjb25mbGljdGVkSW5kZXhQYXR0ZXJucywgb3ZlcndyaXRlQWxsKSB7CiAgdmFyIGltcG9ydENvdW50OwogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gcmVzb2x2ZUluZGV4UGF0dGVybkNvbmZsaWN0cyQoX2NvbnRleHQ2KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBpbXBvcnRDb3VudCA9IDA7CiAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGF3YWl0RWFjaEl0ZW1JblBhcmFsbGVsKGNvbmZsaWN0ZWRJbmRleFBhdHRlcm5zLCBmdW5jdGlvbiBfY2FsbGVlKF9yZWYpIHsKICAgICAgICAgICAgdmFyIG9iaiwgb2xkSW5kZXhJZCwgcmVzb2x1dGlvbiwgbmV3SW5kZXhJZCwgZmlsdGVyOwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0NSkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIG9iaiA9IF9yZWYub2JqOwogICAgICAgICAgICAgICAgICAgIC8vIFJlc29sdmUgc2VhcmNoIGluZGV4IHJlZmVyZW5jZToKICAgICAgICAgICAgICAgICAgICBvbGRJbmRleElkID0gb2JqLnNlYXJjaFNvdXJjZS5nZXRPd25GaWVsZCgnaW5kZXgnKTsgLy8gRGVwZW5kaW5nIG9uIHRoZSBvYmplY3QsIHRoaXMgY2FuIGVpdGhlciBiZSB0aGUgcmF3IGlkIG9yIHRoZSBhY3R1YWwgaW5kZXggcGF0dGVybiBvYmplY3QKCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvbGRJbmRleElkICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgb2xkSW5kZXhJZCA9IG9sZEluZGV4SWQuaWQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uID0gcmVzb2x1dGlvbnMuZmluZChmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBvbGRJZCA9IF9yZWYyLm9sZElkOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sZElkID09PSBvbGRJbmRleElkOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc29sdXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbmV3SW5kZXhJZCA9IHJlc29sdXRpb24ubmV3SWQ7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAob2JqLmh5ZHJhdGVJbmRleFBhdHRlcm4obmV3SW5kZXhJZCkpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgIC8vIFJlc29sdmUgZmlsdGVyIGluZGV4IHJlZmVyZW5jZToKICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSAob2JqLnNlYXJjaFNvdXJjZS5nZXRPd25GaWVsZCgnZmlsdGVyJykgfHwgW10pLm1hcChmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShmaWx0ZXIubWV0YSAmJiBmaWx0ZXIubWV0YS5pbmRleCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlcjsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uID0gcmVzb2x1dGlvbnMuZmluZChmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9sZElkID0gX3JlZjMub2xkSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvbGRJZCA9PT0gZmlsdGVyLm1ldGEuaW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHV0aW9uID8gX29iamVjdFNwcmVhZCh7fSwgZmlsdGVyLCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICBtZXRhOiBfb2JqZWN0U3ByZWFkKHt9LCBmaWx0ZXIubWV0YSwgewogICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiByZXNvbHV0aW9uLm5ld0lkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICB9KSA6IGZpbHRlcjsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBvYmouc2VhcmNoU291cmNlLnNldEZpZWxkKCdmaWx0ZXInLCBmaWx0ZXIpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc29sdXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHNhdmVPYmplY3Qob2JqLCBvdmVyd3JpdGVBbGwpKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDUuc2VudCkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0Q291bnQrKzsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIGltcG9ydENvdW50KTsKCiAgICAgICAgY2FzZSA0OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBzYXZlT2JqZWN0cyhvYmpzLCBvdmVyd3JpdGVBbGwpIHsKICB2YXIgaW1wb3J0Q291bnQ7CiAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBzYXZlT2JqZWN0cyQoX2NvbnRleHQ4KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBpbXBvcnRDb3VudCA9IDA7CiAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDM7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGF3YWl0RWFjaEl0ZW1JblBhcmFsbGVsKG9ianMsIGZ1bmN0aW9uIF9jYWxsZWUyKG9iaikgewogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDcpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChzYXZlT2JqZWN0KG9iaiwgb3ZlcndyaXRlQWxsKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDcuc2VudCkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpbXBvcnRDb3VudCsrOwoKICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSk7CgogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBpbXBvcnRDb3VudCk7CgogICAgICAgIGNhc2UgNDoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgIH0KICAgIH0KICB9KTsKfQoKZnVuY3Rpb24gc2F2ZU9iamVjdChvYmosIG92ZXJ3cml0ZUFsbCkgewogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gc2F2ZU9iamVjdCQoX2NvbnRleHQ5KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDI7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKG9iai5zYXZlKHsKICAgICAgICAgICAgY29uZmlybU92ZXJ3cml0ZTogIW92ZXJ3cml0ZUFsbAogICAgICAgICAgfSkpOwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ5LnNlbnQpOwoKICAgICAgICBjYXNlIDM6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIHJlc29sdmVTYXZlZFNlYXJjaGVzKHNhdmVkU2VhcmNoZXMsIHNlcnZpY2VzLCBpbmRleFBhdHRlcm5zLCBvdmVyd3JpdGVBbGwpIHsKICB2YXIgaW1wb3J0Q291bnQ7CiAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiByZXNvbHZlU2F2ZWRTZWFyY2hlcyQoX2NvbnRleHQxMSkgewogICAgd2hpbGUgKDEpIHsKICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBpbXBvcnRDb3VudCA9IDA7CiAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAzOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChhd2FpdEVhY2hJdGVtSW5QYXJhbGxlbChzYXZlZFNlYXJjaGVzLCBmdW5jdGlvbiBfY2FsbGVlMyhzZWFyY2hEb2MpIHsKICAgICAgICAgICAgdmFyIG9iajsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQxMCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGdldFNhdmVkT2JqZWN0KHNlYXJjaERvYywgc2VydmljZXMpKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBvYmogPSBfY29udGV4dDEwLnNlbnQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChvYmopIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGltcG9ydERvY3VtZW50KG9iaiwgc2VhcmNoRG9jLCBvdmVyd3JpdGVBbGwpKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICBpZiAoIV9jb250ZXh0MTAuc2VudCkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0Q291bnQrKzsKCiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCBpbXBvcnRDb3VudCk7CgogICAgICAgIGNhc2UgNDoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIHJlc29sdmVTYXZlZE9iamVjdHMoc2F2ZWRPYmplY3RzLCBvdmVyd3JpdGVBbGwsIHNlcnZpY2VzLCBpbmRleFBhdHRlcm5zLCBjb25maXJtTW9kYWxQcm9taXNlKSB7CiAgdmFyIGRvY1R5cGVzLCBpbXBvcnRlZE9iamVjdENvdW50LCBmYWlsZWRJbXBvcnRzLCBjb25mbGljdGVkU2VhcmNoRG9jcywgY29uZmxpY3RlZEluZGV4UGF0dGVybnMsIGNvbmZsaWN0ZWRTYXZlZE9iamVjdHNMaW5rZWRUb1NhdmVkU2VhcmNoZXM7CiAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiByZXNvbHZlU2F2ZWRPYmplY3RzJChfY29udGV4dDE1KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGRvY1R5cGVzID0gZ3JvdXBCeVR5cGUoc2F2ZWRPYmplY3RzKTsgLy8gS2VlcCB0cmFjayBvZiBob3cgbWFueSB3ZSBhY3R1YWxseSBpbXBvcnQgYmVjYXVzZSB0aGUgdXNlcgogICAgICAgICAgLy8gY2FuIGNhbmNlbCBhbiBvdmVycmlkZQoKICAgICAgICAgIGltcG9ydGVkT2JqZWN0Q291bnQgPSAwOwogICAgICAgICAgZmFpbGVkSW1wb3J0cyA9IFtdOyAvLyBTdGFydCB3aXRoIHRoZSBpbmRleCBwYXR0ZXJucyBzaW5jZSBldmVyeXRoaW5nIGlzIGRlcGVuZGVudCBvbiB0aGVtCgogICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gNTsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoYXdhaXRFYWNoSXRlbUluUGFyYWxsZWwoZG9jVHlwZXMuaW5kZXhQYXR0ZXJucywgZnVuY3Rpb24gX2NhbGxlZTQoaW5kZXhQYXR0ZXJuRG9jKSB7CiAgICAgICAgICAgIHZhciBpbXBvcnRlZEluZGV4UGF0dGVybklkOwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDEyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEyLnByZXYgPSAwOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChpbXBvcnRJbmRleFBhdHRlcm4oaW5kZXhQYXR0ZXJuRG9jLCBpbmRleFBhdHRlcm5zLCBvdmVyd3JpdGVBbGwsIGNvbmZpcm1Nb2RhbFByb21pc2UpKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICBpbXBvcnRlZEluZGV4UGF0dGVybklkID0gX2NvbnRleHQxMi5zZW50OwoKICAgICAgICAgICAgICAgICAgICBpZiAoaW1wb3J0ZWRJbmRleFBhdHRlcm5JZCkgewogICAgICAgICAgICAgICAgICAgICAgaW1wb3J0ZWRPYmplY3RDb3VudCsrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMi5wcmV2ID0gNzsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEyLnQwID0gX2NvbnRleHQxMlsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgICAgICAgICBmYWlsZWRJbXBvcnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuRG9jOiBpbmRleFBhdHRlcm5Eb2MsCiAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQxMi50MAogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBudWxsLCBudWxsLCBbWzAsIDddXSk7CiAgICAgICAgICB9KSk7CgogICAgICAgIGNhc2UgNToKICAgICAgICAgIC8vIFdlIHdhbnQgdG8gZG8gdGhlIHNhbWUgZm9yIHNhdmVkIHNlYXJjaGVzLCBidXQgd2Ugd2FudCB0byBrZWVwIHRoZW0gc2VwYXJhdGUgYmVjYXVzZSB0aGV5IG5lZWQKICAgICAgICAgIC8vIHRvIGJlIGFwcGxpZWQgX2ZpcnN0XyBiZWNhdXNlIG90aGVyIHNhdmVkIG9iamVjdHMgY2FuIGJlIGRlcGVuZGVudCBvbiB0aG9zZSBzYXZlZCBzZWFyY2hlcyBleGlzdGluZwogICAgICAgICAgY29uZmxpY3RlZFNlYXJjaERvY3MgPSBbXTsgLy8gS2VlcCBhIHJlY29yZCBvZiB0aGUgaW5kZXggcGF0dGVybnMgYXNzaWduZWQgdG8gb3VyIGltcG9ydGVkIHNhdmVkIG9iamVjdHMgdGhhdCBkbyBub3QKICAgICAgICAgIC8vIGV4aXN0LiBXZSB3aWxsIHByb3ZpZGUgYSB3YXkgZm9yIHRoZSB1c2VyIHRvIG1hbnVhbGx5IHNlbGVjdCBhIG5ldyBpbmRleCBwYXR0ZXJuIGZvciB0aG9zZQogICAgICAgICAgLy8gc2F2ZWQgb2JqZWN0cy4KCiAgICAgICAgICBjb25mbGljdGVkSW5kZXhQYXR0ZXJucyA9IFtdOyAvLyBLZWVwIGEgcmVjb3JkIG9mIGFueSBvYmplY3RzIHdoaWNoIGZhaWwgdG8gaW1wb3J0IGZvciB1bmtub3duIHJlYXNvbnMuCiAgICAgICAgICAvLyBJdCdzIHBvc3NpYmxlIHRvIGhhdmUgc2F2ZWQgb2JqZWN0cyB0aGF0IGxpbmsgdG8gc2F2ZWQgc2VhcmNoZXMgd2hpY2ggdGhlbiBsaW5rIHRvIGluZGV4IHBhdHRlcm5zCiAgICAgICAgICAvLyBhbmQgdGhvc2UgY291bGQgZXJyb3Igb3V0LCBidXQgdGhlIGVycm9yIGNvbWVzIGFzIGFuIGluZGV4IHBhdHRlcm4gbm90IGZvdW5kIGVycm9yLiBXZSBjYW4ndCByZXNvbHZlCiAgICAgICAgICAvLyB0aG9zZSB0aGUgc2FtZSBhcyB3YXkgYXMgbm9ybWFsIGluZGV4IHBhdHRlcm4gbm90IGZvdW5kIGVycm9ycywgYnV0IHdoZW4gdGhvc2UgYXJlIGZpeGVkLCBpdCdzIHZlcnkKICAgICAgICAgIC8vIGxpa2VseSB0aGF0IHRoZXNlIHNhdmVkIG9iamVjdHMgd2lsbCB3b3JrIG9uY2UgcmVzYXZlZCBzbyBrZWVwIHRoZW0gYXJvdW5kIHRvIHJlc2F2ZSB0aGVtLgoKICAgICAgICAgIGNvbmZsaWN0ZWRTYXZlZE9iamVjdHNMaW5rZWRUb1NhdmVkU2VhcmNoZXMgPSBbXTsKICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDEwOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChhd2FpdEVhY2hJdGVtSW5QYXJhbGxlbChkb2NUeXBlcy5zZWFyY2hlcywgZnVuY3Rpb24gX2NhbGxlZTUoc2VhcmNoRG9jKSB7CiAgICAgICAgICAgIHZhciBvYmo7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0MTMpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEzLnByZXYgPSBfY29udGV4dDEzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChnZXRTYXZlZE9iamVjdChzZWFyY2hEb2MsIHNlcnZpY2VzKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgb2JqID0gX2NvbnRleHQxMy5zZW50OwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTMucHJldiA9IDM7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGltcG9ydERvY3VtZW50KG9iaiwgc2VhcmNoRG9jLCBvdmVyd3JpdGVBbGwpKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICBpZiAoIV9jb250ZXh0MTMuc2VudCkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0ZWRPYmplY3RDb3VudCsrOwoKICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEzLnByZXYgPSAxMDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEzLnQwID0gX2NvbnRleHQxM1siY2F0Y2giXSgzKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKF9jb250ZXh0MTMudDAuY29uc3RydWN0b3IubmFtZSA9PT0gJ1NhdmVkT2JqZWN0Tm90Rm91bmQnKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoX2NvbnRleHQxMy50MC5zYXZlZE9iamVjdFR5cGUgPT09ICdpbmRleC1wYXR0ZXJuJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25mbGljdGVkSW5kZXhQYXR0ZXJucy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICBvYmo6IG9iaiwKICAgICAgICAgICAgICAgICAgICAgICAgICBkb2M6IHNlYXJjaERvYwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0ZWRTZWFyY2hEb2NzLnB1c2goc2VhcmNoRG9jKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZmFpbGVkSW1wb3J0cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgb2JqOiBvYmosCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBfY29udGV4dDEzLnQwCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIG51bGwsIG51bGwsIFtbMywgMTBdXSk7CiAgICAgICAgICB9KSk7CgogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICBfY29udGV4dDE1Lm5leHQgPSAxMjsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoYXdhaXRFYWNoSXRlbUluUGFyYWxsZWwoZG9jVHlwZXMub3RoZXIsIGZ1bmN0aW9uIF9jYWxsZWU2KG90aGVyRG9jKSB7CiAgICAgICAgICAgIHZhciBvYmosIGlzSW5kZXhQYXR0ZXJuTm90Rm91bmQ7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0MTQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE0LnByZXYgPSBfY29udGV4dDE0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChnZXRTYXZlZE9iamVjdChvdGhlckRvYywgc2VydmljZXMpKTsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBvYmogPSBfY29udGV4dDE0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNC5wcmV2ID0gMzsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoaW1wb3J0RG9jdW1lbnQob2JqLCBvdGhlckRvYywgb3ZlcndyaXRlQWxsKSk7CgogICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDE0LnNlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTQubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGltcG9ydGVkT2JqZWN0Q291bnQrKzsKCiAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE0Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNC5wcmV2ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNC50MCA9IF9jb250ZXh0MTRbImNhdGNoIl0oMyk7CiAgICAgICAgICAgICAgICAgICAgaXNJbmRleFBhdHRlcm5Ob3RGb3VuZCA9IF9jb250ZXh0MTQudDAuY29uc3RydWN0b3IubmFtZSA9PT0gJ1NhdmVkT2JqZWN0Tm90Rm91bmQnICYmIF9jb250ZXh0MTQudDAuc2F2ZWRPYmplY3RUeXBlID09PSAnaW5kZXgtcGF0dGVybic7CgogICAgICAgICAgICAgICAgICAgIGlmIChpc0luZGV4UGF0dGVybk5vdEZvdW5kICYmIG9iai5zYXZlZFNlYXJjaElkKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb25mbGljdGVkU2F2ZWRPYmplY3RzTGlua2VkVG9TYXZlZFNlYXJjaGVzLnB1c2gob2JqKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzSW5kZXhQYXR0ZXJuTm90Rm91bmQpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0ZWRJbmRleFBhdHRlcm5zLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBvYmo6IG9iaiwKICAgICAgICAgICAgICAgICAgICAgICAgZG9jOiBvdGhlckRvYwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZEltcG9ydHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG9iajogb2JqLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQxNC50MAogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBudWxsLCBudWxsLCBbWzMsIDEwXV0pOwogICAgICAgICAgfSkpOwoKICAgICAgICBjYXNlIDEyOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgIGNvbmZsaWN0ZWRJbmRleFBhdHRlcm5zOiBjb25mbGljdGVkSW5kZXhQYXR0ZXJucywKICAgICAgICAgICAgY29uZmxpY3RlZFNhdmVkT2JqZWN0c0xpbmtlZFRvU2F2ZWRTZWFyY2hlczogY29uZmxpY3RlZFNhdmVkT2JqZWN0c0xpbmtlZFRvU2F2ZWRTZWFyY2hlcywKICAgICAgICAgICAgY29uZmxpY3RlZFNlYXJjaERvY3M6IGNvbmZsaWN0ZWRTZWFyY2hEb2NzLAogICAgICAgICAgICBpbXBvcnRlZE9iamVjdENvdW50OiBpbXBvcnRlZE9iamVjdENvdW50LAogICAgICAgICAgICBmYWlsZWRJbXBvcnRzOiBmYWlsZWRJbXBvcnRzCiAgICAgICAgICB9KTsKCiAgICAgICAgY2FzZSAxMzoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn0="},null]}