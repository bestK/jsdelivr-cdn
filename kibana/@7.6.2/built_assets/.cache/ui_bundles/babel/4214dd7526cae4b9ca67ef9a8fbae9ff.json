{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/logstash/public/components/pipeline_editor/pipeline_editor.js","dependencies":[{"path":"x-pack/legacy/plugins/logstash/public/components/pipeline_editor/pipeline_editor.js","mtime":1585205045133},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlBpcGVsaW5lRWRpdG9yID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX3Byb3BUeXBlcyA9IHJlcXVpcmUoInByb3AtdHlwZXMiKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnJlcXVpcmUoImJyYWNlL21vZGUvcGxhaW5fdGV4dCIpOwoKcmVxdWlyZSgiYnJhY2UvdGhlbWUvZ2l0aHViIik7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIF90b29sdGlwcyA9IHJlcXVpcmUoIi4uLy4uLy4uL2NvbW1vbi9jb25zdGFudHMvdG9vbHRpcHMiKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2NvbmZpcm1fZGVsZXRlX3BpcGVsaW5lX21vZGFsID0gcmVxdWlyZSgiLi9jb25maXJtX2RlbGV0ZV9waXBlbGluZV9tb2RhbCIpOwoKdmFyIF9mbGV4X2l0ZW1fc2V0dGluZyA9IHJlcXVpcmUoIi4vZmxleF9pdGVtX3NldHRpbmciKTsKCnZhciBfZm9ybV9sYWJlbF93aXRoX2ljb25fdGlwID0gcmVxdWlyZSgiLi9mb3JtX2xhYmVsX3dpdGhfaWNvbl90aXAiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi9jb25zdGFudHMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9Cgp2YXIgUGlwZWxpbmVFZGl0b3JVaSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoUGlwZWxpbmVFZGl0b3JVaSwgX1JlYWN0JENvbXBvbmVudCk7CgogIGZ1bmN0aW9uIFBpcGVsaW5lRWRpdG9yVWkocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGlwZWxpbmVFZGl0b3JVaSk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoUGlwZWxpbmVFZGl0b3JVaSkuY2FsbCh0aGlzLCBwcm9wcykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNvbXBvbmVudERpZE1vdW50IiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkcHJvcHMgPSBfdGhpcy5wcm9wcywKICAgICAgICAgIF90aGlzJHByb3BzJGxpY2Vuc2VTZSA9IF90aGlzJHByb3BzLmxpY2Vuc2VTZXJ2aWNlLAogICAgICAgICAgaXNSZWFkT25seSA9IF90aGlzJHByb3BzJGxpY2Vuc2VTZS5pc1JlYWRPbmx5LAogICAgICAgICAgbWVzc2FnZSA9IF90aGlzJHByb3BzJGxpY2Vuc2VTZS5tZXNzYWdlLAogICAgICAgICAgdG9hc3ROb3RpZmljYXRpb25zID0gX3RoaXMkcHJvcHMudG9hc3ROb3RpZmljYXRpb25zOwoKICAgICAgaWYgKGlzUmVhZE9ubHkpIHsKICAgICAgICB0b2FzdE5vdGlmaWNhdGlvbnMuYWRkV2FybmluZyhtZXNzYWdlKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGlkZUNvbmZpcm1EZWxldGVNb2RhbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHNob3dDb25maXJtRGVsZXRlTW9kYWw6IGZhbHNlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2hvd0NvbmZpcm1EZWxldGVNb2RhbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHNob3dDb25maXJtRGVsZXRlTW9kYWw6IHRydWUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblBpcGVsaW5lSWRDaGFuZ2UiLCBmdW5jdGlvbiAoX3JlZikgewogICAgICB2YXIgdmFsdWUgPSBfcmVmLnRhcmdldC52YWx1ZTsKICAgICAgdmFyIHBpcGVsaW5lSWRFcnJvcnMgPSBbXTsKCiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICBwaXBlbGluZUlkRXJyb3JzLnB1c2goX2NvbnN0YW50cy5QSVBFTElORV9FRElUT1IuSURfUkVRVUlSRURfRVJSX01TRyk7CiAgICAgIH0KCiAgICAgIGlmICghX3RoaXMuc3RhdGUucGlwZWxpbmVJZFBhdHRlcm4udGVzdCh2YWx1ZSkpIHsKICAgICAgICBwaXBlbGluZUlkRXJyb3JzLnB1c2goX2NvbnN0YW50cy5QSVBFTElORV9FRElUT1IuSURfRk9STUFUX0VSUl9NU0cpOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcGlwZWxpbmVJZEVycm9yczogcGlwZWxpbmVJZEVycm9ycywKICAgICAgICBzaG93UGlwZWxpbmVJZEVycm9yOiAhIXBpcGVsaW5lSWRFcnJvcnMubGVuZ3RoLAogICAgICAgIHBpcGVsaW5lOiBfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5zdGF0ZS5waXBlbGluZSwgewogICAgICAgICAgaWQ6IHZhbHVlCiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJpc1NhdmVEaXNhYmxlZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzLnN0YXRlLnNob3dQaXBlbGluZUlkRXJyb3IgfHwgKDAsIF9sb2Rhc2guaXNFbXB0eSkoX3RoaXMuc3RhdGUucGlwZWxpbmUuaWQpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25DbG9zZSIsIGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5wcm9wcy5jbG9zZSgpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvcGVuIiwgZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciBpZDsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWQgPSBfdGhpcy5zdGF0ZS5waXBlbGluZS5pZDsKCiAgICAgICAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5wcm9wcy5vcGVuKGlkKSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uUGlwZWxpbmVTYXZlIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkcHJvcHMyID0gX3RoaXMucHJvcHMsCiAgICAgICAgICBwaXBlbGluZVNlcnZpY2UgPSBfdGhpcyRwcm9wczIucGlwZWxpbmVTZXJ2aWNlLAogICAgICAgICAgdG9hc3ROb3RpZmljYXRpb25zID0gX3RoaXMkcHJvcHMyLnRvYXN0Tm90aWZpY2F0aW9ucywKICAgICAgICAgIGludGwgPSBfdGhpcyRwcm9wczIuaW50bDsKICAgICAgdmFyIGlkID0gX3RoaXMuc3RhdGUucGlwZWxpbmUuaWQ7CiAgICAgIHJldHVybiBwaXBlbGluZVNlcnZpY2Uuc2F2ZVBpcGVsaW5lKHsKICAgICAgICBpZDogaWQsCiAgICAgICAgdXBzdHJlYW1KU09OOiBfdGhpcy5zdGF0ZS5waXBlbGluZQogICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICB0b2FzdE5vdGlmaWNhdGlvbnMuYWRkU3VjY2VzcyhpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICd4cGFjay5sb2dzdGFzaC5waXBlbGluZUVkaXRvci5waXBlbGluZVN1Y2Nlc3NmdWxseVNhdmVkTWVzc2FnZScsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NhdmVkICJ7aWR9IicKICAgICAgICB9LCB7CiAgICAgICAgICBpZDogaWQKICAgICAgICB9KSk7CgogICAgICAgIF90aGlzLm9uQ2xvc2UoKTsKICAgICAgfSkuY2F0Y2goX3RoaXMubm90aWZ5T25FcnJvcik7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblBpcGVsaW5lRGVzY3JpcHRpb25DaGFuZ2UiLCBmdW5jdGlvbiAoX3JlZjIpIHsKICAgICAgdmFyIHZhbHVlID0gX3JlZjIudGFyZ2V0LnZhbHVlOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHBpcGVsaW5lOiBfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5zdGF0ZS5waXBlbGluZSwgewogICAgICAgICAgZGVzY3JpcHRpb246IHZhbHVlCiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblBpcGVsaW5lQ2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHBpcGVsaW5lOiBfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5zdGF0ZS5waXBlbGluZSwgewogICAgICAgICAgcGlwZWxpbmU6IGUKICAgICAgICB9KQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZU51bWJlckNoYW5nZSIsIGZ1bmN0aW9uIChzZXR0aW5nTmFtZSwgdmFsdWUpIHsKICAgICAgdmFyIG51bWJlclZhbHVlID0gcGFyc2VJbnQodmFsdWUsIDEwKTsKCiAgICAgIF90aGlzLmhhbmRsZVNldHRpbmdDaGFuZ2Uoc2V0dGluZ05hbWUsIGlzTmFOKG51bWJlclZhbHVlKSA/IHZhbHVlIDogbnVtYmVyVmFsdWUpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlTWF4Qnl0ZU51bWJlckNoYW5nZSIsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgbWF4Qnl0ZXNOdW1iZXI6IHBhcnNlSW50KHZhbHVlLCAxMCkKICAgICAgfSk7CgogICAgICBfdGhpcy5oYW5kbGVTZXR0aW5nQ2hhbmdlKCdxdWV1ZS5tYXhfYnl0ZXMnLCB2YWx1ZSArIF90aGlzLnN0YXRlLm1heEJ5dGVzVW5pdCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJoYW5kbGVNYXhCeXRlVW5pdENoYW5nZSIsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgbWF4Qnl0ZXNVbml0OiB2YWx1ZQogICAgICB9KTsKCiAgICAgIF90aGlzLmhhbmRsZVNldHRpbmdDaGFuZ2UoJ3F1ZXVlLm1heF9ieXRlcycsIF90aGlzLnN0YXRlLm1heEJ5dGVzTnVtYmVyICsgdmFsdWUpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlU2V0dGluZ0NoYW5nZSIsIGZ1bmN0aW9uIChzZXR0aW5nTmFtZSwgdmFsdWUpIHsKICAgICAgdmFyIHNldHRpbmdzID0gX29iamVjdFNwcmVhZCh7fSwgX3RoaXMuc3RhdGUucGlwZWxpbmUuc2V0dGluZ3MpOwoKICAgICAgc2V0dGluZ3Nbc2V0dGluZ05hbWVdID0gdmFsdWU7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcGlwZWxpbmU6IF9vYmplY3RTcHJlYWQoe30sIF90aGlzLnN0YXRlLnBpcGVsaW5lLCB7CiAgICAgICAgICBzZXR0aW5nczogc2V0dGluZ3MKICAgICAgICB9KQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm5vdGlmeU9uRXJyb3IiLCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczMgPSBfdGhpcy5wcm9wcywKICAgICAgICAgIGxpY2Vuc2VTZXJ2aWNlID0gX3RoaXMkcHJvcHMzLmxpY2Vuc2VTZXJ2aWNlLAogICAgICAgICAgdG9hc3ROb3RpZmljYXRpb25zID0gX3RoaXMkcHJvcHMzLnRvYXN0Tm90aWZpY2F0aW9uczsKICAgICAgcmV0dXJuIGxpY2Vuc2VTZXJ2aWNlLmNoZWNrVmFsaWRpdHkoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICB0b2FzdE5vdGlmaWNhdGlvbnMuYWRkRXJyb3IoZXJyLCB7CiAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxvZ3N0YXNoLnBpcGVsaW5lRWRpdG9yLmVycm9ySGFuZGxlclRvYXN0VGl0bGUnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUGlwZWxpbmUgZXJyb3InCiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRlbGV0ZVBpcGVsaW5lIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkcHJvcHM0ID0gX3RoaXMucHJvcHMsCiAgICAgICAgICBpZCA9IF90aGlzJHByb3BzNC5waXBlbGluZS5pZCwKICAgICAgICAgIHBpcGVsaW5lU2VydmljZSA9IF90aGlzJHByb3BzNC5waXBlbGluZVNlcnZpY2UsCiAgICAgICAgICB0b2FzdE5vdGlmaWNhdGlvbnMgPSBfdGhpcyRwcm9wczQudG9hc3ROb3RpZmljYXRpb25zLAogICAgICAgICAgaW50bCA9IF90aGlzJHByb3BzNC5pbnRsOwoKICAgICAgX3RoaXMuaGlkZUNvbmZpcm1EZWxldGVNb2RhbCgpOwoKICAgICAgcmV0dXJuIHBpcGVsaW5lU2VydmljZS5kZWxldGVQaXBlbGluZShpZCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgdG9hc3ROb3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MoaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2subG9nc3Rhc2gucGlwZWxpbmVFZGl0b3IucGlwZWxpbmVTdWNjZXNzZnVsbHlEZWxldGVkTWVzc2FnZScsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0RlbGV0ZWQgIntpZH0iJwogICAgICAgIH0sIHsKICAgICAgICAgIGlkOiBpZAogICAgICAgIH0pKTsKCiAgICAgICAgX3RoaXMub25DbG9zZSgpOwogICAgICB9KS5jYXRjaChfdGhpcy5ub3RpZnlPbkVycm9yKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldFBpcGVsaW5lSGVhZGluZ1RleHQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczUgPSBfdGhpcy5wcm9wcywKICAgICAgICAgIF90aGlzJHByb3BzNSRyb3V0ZVNlciA9IF90aGlzJHByb3BzNS5yb3V0ZVNlcnZpY2UuY3VycmVudC5wYXJhbXMsCiAgICAgICAgICBjbG9uZSA9IF90aGlzJHByb3BzNSRyb3V0ZVNlci5jbG9uZSwKICAgICAgICAgIGlkID0gX3RoaXMkcHJvcHM1JHJvdXRlU2VyLmlkLAogICAgICAgICAgaXNOZXdQaXBlbGluZSA9IF90aGlzJHByb3BzNS5pc05ld1BpcGVsaW5lLAogICAgICAgICAgaW50bCA9IF90aGlzJHByb3BzNS5pbnRsOwoKICAgICAgaWYgKCEhY2xvbmUgJiYgaWQpIHsKICAgICAgICByZXR1cm4gaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2subG9nc3Rhc2gucGlwZWxpbmVFZGl0b3IuY2xvbmVQaXBlbGluZVRpdGxlJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ2xvbmUgUGlwZWxpbmUgIntpZH0iJwogICAgICAgIH0sIHsKICAgICAgICAgIGlkOiBpZAogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAoIWlzTmV3UGlwZWxpbmUpIHsKICAgICAgICByZXR1cm4gaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2subG9nc3Rhc2gucGlwZWxpbmVFZGl0b3IuZWRpdFBpcGVsaW5lVGl0bGUnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFZGl0IFBpcGVsaW5lICJ7aWR9IicKICAgICAgICB9LCB7CiAgICAgICAgICBpZDogX3RoaXMuc3RhdGUucGlwZWxpbmUuaWQKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgaWQ6ICd4cGFjay5sb2dzdGFzaC5waXBlbGluZUVkaXRvci5jcmVhdGVQaXBlbGluZVRpdGxlJywKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0NyZWF0ZSBQaXBlbGluZScKICAgICAgfSk7CiAgICB9KTsKCiAgICB2YXIgX3RoaXMkcHJvcHM2ID0gX3RoaXMucHJvcHMsCiAgICAgICAgX3RoaXMkcHJvcHM2JHBpcGVsaW5lID0gX3RoaXMkcHJvcHM2LnBpcGVsaW5lLAogICAgICAgIF9pZCA9IF90aGlzJHByb3BzNiRwaXBlbGluZS5pZCwKICAgICAgICBkZXNjcmlwdGlvbiA9IF90aGlzJHByb3BzNiRwaXBlbGluZS5kZXNjcmlwdGlvbiwKICAgICAgICBwaXBlbGluZSA9IF90aGlzJHByb3BzNiRwaXBlbGluZS5waXBlbGluZSwKICAgICAgICBfc2V0dGluZ3MgPSBfdGhpcyRwcm9wczYkcGlwZWxpbmUuc2V0dGluZ3MsCiAgICAgICAgdXNlcm5hbWUgPSBfdGhpcyRwcm9wczYudXNlcm5hbWU7CiAgICB2YXIgcGlwZWxpbmVXb3JrZXJzU2V0ID0gdHlwZW9mIF9zZXR0aW5nc1sncGlwZWxpbmUud29ya2VycyddID09PSAnbnVtYmVyJzsKICAgIHZhciBwaXBlbGluZVdvcmtlcnMgPSBwaXBlbGluZVdvcmtlcnNTZXQgPyBfc2V0dGluZ3NbJ3BpcGVsaW5lLndvcmtlcnMnXSA6IDE7CiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgbWF4Qnl0ZXNOdW1iZXI6IF9zZXR0aW5nc1sncXVldWUubWF4X2J5dGVzLm51bWJlciddLAogICAgICBtYXhCeXRlc1VuaXQ6IF9zZXR0aW5nc1sncXVldWUubWF4X2J5dGVzLnVuaXRzJ10sCiAgICAgIHBpcGVsaW5lOiB7CiAgICAgICAgaWQ6IF9pZCwKICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sCiAgICAgICAgcGlwZWxpbmU6IHBpcGVsaW5lLAogICAgICAgIHNldHRpbmdzOiB7CiAgICAgICAgICAncGlwZWxpbmUuYmF0Y2guZGVsYXknOiBfc2V0dGluZ3NbJ3BpcGVsaW5lLmJhdGNoLmRlbGF5J10sCiAgICAgICAgICAncGlwZWxpbmUuYmF0Y2guc2l6ZSc6IF9zZXR0aW5nc1sncGlwZWxpbmUuYmF0Y2guc2l6ZSddLAogICAgICAgICAgJ3BpcGVsaW5lLndvcmtlcnMnOiBwaXBlbGluZVdvcmtlcnMsCiAgICAgICAgICAncXVldWUuY2hlY2twb2ludC53cml0ZXMnOiBfc2V0dGluZ3NbJ3F1ZXVlLmNoZWNrcG9pbnQud3JpdGVzJ10sCiAgICAgICAgICAncXVldWUubWF4X2J5dGVzJzogX3NldHRpbmdzWydxdWV1ZS5tYXhfYnl0ZXMubnVtYmVyJ10gKyBfc2V0dGluZ3NbJ3F1ZXVlLm1heF9ieXRlcy51bml0cyddLAogICAgICAgICAgJ3F1ZXVlLnR5cGUnOiBfc2V0dGluZ3NbJ3F1ZXVlLnR5cGUnXQogICAgICAgIH0sCiAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lCiAgICAgIH0sCiAgICAgIHBpcGVsaW5lSWRFcnJvcnM6IFtdLAogICAgICBwaXBlbGluZUlkUGF0dGVybjogL15bQS1aYS16XF9dW0EtWmEtejAtOVwtXF9dKiQvLAogICAgICBzaG93Q29uZmlybURlbGV0ZU1vZGFsOiBmYWxzZSwKICAgICAgc2hvd1BpcGVsaW5lSWRFcnJvcjogZmFsc2UKICAgIH07CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoUGlwZWxpbmVFZGl0b3JVaSwgW3sKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBpbnRsID0gdGhpcy5wcm9wcy5pbnRsOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJwaXBlbGluZUVkaXQgcGlwZWxpbmVFZGl0LSIuY29uY2F0KHRoaXMuc3RhdGUucGlwZWxpbmUuaWQpCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQYWdlQ29udGVudCwgewogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICB3aWR0aDogMTEwMAogICAgICAgIH0sCiAgICAgICAgdmVydGljYWxQb3NpdGlvbjogImNlbnRlciIsCiAgICAgICAgaG9yaXpvbnRhbFBvc2l0aW9uOiAiY2VudGVyIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaDIiLCBudWxsLCB0aGlzLmdldFBpcGVsaW5lSGVhZGluZ1RleHQoKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybSwgewogICAgICAgIGlzSW52YWxpZDogdGhpcy5zdGF0ZS5zaG93UGlwZWxpbmVJZEVycm9yLAogICAgICAgIGVycm9yOiB0aGlzLnN0YXRlLnBpcGVsaW5lSWRFcnJvcnMKICAgICAgfSwgdGhpcy5wcm9wcy5pc05ld1BpcGVsaW5lICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgIGxhYmVsOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5sb2dzdGFzaC5waXBlbGluZUVkaXRvci5waXBlbGluZUlkRm9ybVJvd0xhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUGlwZWxpbmUgSUQiCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkVGV4dCwgewogICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiaW5wdXRJZCIsCiAgICAgICAgaXNJbnZhbGlkOiB0aGlzLnN0YXRlLnNob3dQaXBlbGluZUlkRXJyb3IsCiAgICAgICAgbmFtZTogInBpcGVsaW5lSWQiLAogICAgICAgIG9uQmx1cjogdGhpcy5vblBpcGVsaW5lSWRDaGFuZ2UsCiAgICAgICAgb25DaGFuZ2U6IHRoaXMub25QaXBlbGluZUlkQ2hhbmdlLAogICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnBpcGVsaW5lLmlkIHx8ICcnCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBmdWxsV2lkdGg6IHRydWUsCiAgICAgICAgbGFiZWw6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLmxvZ3N0YXNoLnBpcGVsaW5lRWRpdG9yLmRlc2NyaXB0aW9uRm9ybVJvd0xhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVzY3JpcHRpb24iCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkVGV4dCwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbnB1dERlc2NyaXB0aW9uIiwKICAgICAgICBmdWxsV2lkdGg6IHRydWUsCiAgICAgICAgbmFtZTogInBpcGVsaW5lRGVzY3JpcHRpb24iLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uUGlwZWxpbmVEZXNjcmlwdGlvbkNoYW5nZSwKICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS5waXBlbGluZS5kZXNjcmlwdGlvbiB8fCAnJwogICAgICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgIGxhYmVsOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5sb2dzdGFzaC5waXBlbGluZUVkaXRvci5waXBlbGluZUZvcm1Sb3dMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlBpcGVsaW5lIgogICAgICAgIH0pCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiYWNlUGlwZWxpbmUiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2RlRWRpdG9yLCB7CiAgICAgICAgbW9kZTogInBsYWluX3RleHQiLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uUGlwZWxpbmVDaGFuZ2UsCiAgICAgICAgc2V0T3B0aW9uczogewogICAgICAgICAgbWluTGluZXM6IDI1LAogICAgICAgICAgbWF4TGluZXM6IEluZmluaXR5LAogICAgICAgICAgcmVhZE9ubHk6IHRoaXMucHJvcHMubGljZW5zZVNlcnZpY2UuaXNSZWFkT25seQogICAgICAgIH0sCiAgICAgICAgdGhlbWU6ICJnaXRodWIiLAogICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnBpcGVsaW5lLnBpcGVsaW5lLAogICAgICAgIHdpZHRoOiAnMTAxNycKICAgICAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZm9ybV9sYWJlbF93aXRoX2ljb25fdGlwLkZvcm1MYWJlbFdpdGhJY29uVGlwLCB7CiAgICAgICAgICBmb3JtUm93TGFiZWxUZXh0OiBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgICBpZDogJ3hwYWNrLmxvZ3N0YXNoLnBpcGVsaW5lRWRpdG9yLnBpcGVsaW5lV29ya2Vyc0Zvcm1Sb3dMYWJlbCcsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUGlwZWxpbmUgd29ya2VycycKICAgICAgICAgIH0pLAogICAgICAgICAgZm9ybVJvd1Rvb2x0aXBUZXh0OiBfdG9vbHRpcHMuVE9PTFRJUFMuc2V0dGluZ3NbJ3BpcGVsaW5lLndvcmtlcnMnXQogICAgICAgIH0pCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZE51bWJlciwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbnB1dFdvcmtlcnMiLAogICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMyLmhhbmRsZU51bWJlckNoYW5nZSgncGlwZWxpbmUud29ya2VycycsIGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9LAogICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnBpcGVsaW5lLnNldHRpbmdzWydwaXBlbGluZS53b3JrZXJzJ10KICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCBudWxsKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZmxleF9pdGVtX3NldHRpbmcuRmxleEl0ZW1TZXR0aW5nLCB7CiAgICAgICAgZm9ybVJvd0xhYmVsVGV4dDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2subG9nc3Rhc2gucGlwZWxpbmVFZGl0b3IucGlwZWxpbmVCYXRjaFNpemVGb3JtUm93TGFiZWwnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQaXBlbGluZSBiYXRjaCBzaXplJwogICAgICAgIH0pLAogICAgICAgIGZvcm1Sb3dUb29sdGlwVGV4dDogX3Rvb2x0aXBzLlRPT0xUSVBTLnNldHRpbmdzWydwaXBlbGluZS5iYXRjaC5zaXplJ10KICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkTnVtYmVyLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImlucHV0QmF0Y2hTaXplIiwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgcmV0dXJuIF90aGlzMi5oYW5kbGVOdW1iZXJDaGFuZ2UoJ3BpcGVsaW5lLmJhdGNoLnNpemUnLCBlLnRhcmdldC52YWx1ZSk7CiAgICAgICAgfSwKICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS5waXBlbGluZS5zZXR0aW5nc1sncGlwZWxpbmUuYmF0Y2guc2l6ZSddCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZmxleF9pdGVtX3NldHRpbmcuRmxleEl0ZW1TZXR0aW5nLCB7CiAgICAgICAgZm9ybVJvd0xhYmVsVGV4dDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2subG9nc3Rhc2gucGlwZWxpbmVFZGl0b3IucGlwZWxpbmVCYXRjaERlbGF5Rm9ybVJvd0xhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUGlwZWxpbmUgYmF0Y2ggZGVsYXknCiAgICAgICAgfSksCiAgICAgICAgZm9ybVJvd1Rvb2x0aXBUZXh0OiBfdG9vbHRpcHMuVE9PTFRJUFMuc2V0dGluZ3NbJ3BpcGVsaW5lLmJhdGNoLmRlbGF5J10KICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkTnVtYmVyLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImlucHV0QmF0Y2hEZWxheSIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIHJldHVybiBfdGhpczIuaGFuZGxlTnVtYmVyQ2hhbmdlKCdwaXBlbGluZS5iYXRjaC5kZWxheScsIGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9LAogICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnBpcGVsaW5lLnNldHRpbmdzWydwaXBlbGluZS5iYXRjaC5kZWxheSddCiAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2ZsZXhfaXRlbV9zZXR0aW5nLkZsZXhJdGVtU2V0dGluZywgewogICAgICAgIGZvcm1Sb3dMYWJlbFRleHQ6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ3hwYWNrLmxvZ3N0YXNoLnBpcGVsaW5lRWRpdG9yLnF1ZXVlVHlwZUZvcm1Sb3dMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1F1ZXVlIHR5cGUnCiAgICAgICAgfSksCiAgICAgICAgZm9ybVJvd1Rvb2x0aXBUZXh0OiBfdG9vbHRpcHMuVE9PTFRJUFMuc2V0dGluZ3NbJ3F1ZXVlLnR5cGUnXQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU2VsZWN0LCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInNlbGVjdFF1ZXVlVHlwZSIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIHJldHVybiBfdGhpczIuaGFuZGxlU2V0dGluZ0NoYW5nZSgncXVldWUudHlwZScsIGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9LAogICAgICAgIG9wdGlvbnM6IF9jb25zdGFudHMuUElQRUxJTkVfRURJVE9SLlFVRVVFX1RZUEVTLAogICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnBpcGVsaW5lLnNldHRpbmdzWydxdWV1ZS50eXBlJ10KICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9mbGV4X2l0ZW1fc2V0dGluZy5GbGV4SXRlbVNldHRpbmcsIHsKICAgICAgICBmb3JtUm93TGFiZWxUZXh0OiBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICd4cGFjay5sb2dzdGFzaC5waXBlbGluZUVkaXRvci5xdWV1ZU1heEJ5dGVzRm9ybVJvd0xhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUXVldWUgbWF4IGJ5dGVzJwogICAgICAgIH0pLAogICAgICAgIGZvcm1Sb3dUb29sdGlwVGV4dDogX3Rvb2x0aXBzLlRPT0xUSVBTLnNldHRpbmdzWydxdWV1ZS5tYXhfYnl0ZXMnXQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGROdW1iZXIsIHsKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiaW5wdXRRdWV1ZU1heEJ5dGVzTnVtYmVyIiwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgcmV0dXJuIF90aGlzMi5oYW5kbGVNYXhCeXRlTnVtYmVyQ2hhbmdlKGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9LAogICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLm1heEJ5dGVzTnVtYmVyCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZmxleF9pdGVtX3NldHRpbmcuRmxleEl0ZW1TZXR0aW5nLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU2VsZWN0LCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInNlbGVjdFF1ZXVlTWF4Qnl0ZXNVbml0cyIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIHJldHVybiBfdGhpczIuaGFuZGxlTWF4Qnl0ZVVuaXRDaGFuZ2UoZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0sCiAgICAgICAgb3B0aW9uczogX2NvbnN0YW50cy5QSVBFTElORV9FRElUT1IuVU5JVFMsCiAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUubWF4Qnl0ZXNVbml0CiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZmxleF9pdGVtX3NldHRpbmcuRmxleEl0ZW1TZXR0aW5nLCB7CiAgICAgICAgZm9ybVJvd0xhYmVsVGV4dDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2subG9nc3Rhc2gucGlwZWxpbmVFZGl0b3IucXVldWVDaGVja3BvaW50V3JpdGVzRm9ybVJvd0xhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUXVldWUgY2hlY2twb2ludCB3cml0ZXMnCiAgICAgICAgfSksCiAgICAgICAgZm9ybVJvd1Rvb2x0aXBUZXh0OiBfdG9vbHRpcHMuVE9PTFRJUFMuc2V0dGluZ3NbJ3F1ZXVlLmNoZWNrcG9pbnQud3JpdGVzJ10KICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkTnVtYmVyLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImlucHV0UXVldWVDaGVja3BvaW50V3JpdGVzIiwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgcmV0dXJuIF90aGlzMi5oYW5kbGVOdW1iZXJDaGFuZ2UoJ3F1ZXVlLmNoZWNrcG9pbnQud3JpdGVzJywgZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0sCiAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUucGlwZWxpbmUuc2V0dGluZ3NbJ3F1ZXVlLmNoZWNrcG9pbnQud3JpdGVzJ10KICAgICAgfSkpKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibCIKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBqdXN0aWZ5Q29udGVudDogImZsZXhTdGFydCIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJidG5TYXZlUGlwZWxpbmUiLAogICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgaXNEaXNhYmxlZDogdGhpcy5pc1NhdmVEaXNhYmxlZCgpLAogICAgICAgIG9uQ2xpY2s6IHRoaXMub25QaXBlbGluZVNhdmUKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLmxvZ3N0YXNoLnBpcGVsaW5lRWRpdG9yLmNyZWF0ZUFuZERlcGxveUJ1dHRvbkxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNyZWF0ZSBhbmQgZGVwbG95IgogICAgICB9KSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImJ0bkNhbmNlbCIsCiAgICAgICAgb25DbGljazogdGhpcy5vbkNsb3NlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5sb2dzdGFzaC5waXBlbGluZUVkaXRvci5jYW5jZWxCdXR0b25MYWJlbCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDYW5jZWwiCiAgICAgIH0pKSksICF0aGlzLnByb3BzLmlzTmV3UGlwZWxpbmUgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgICAgY29sb3I6ICJkYW5nZXIiLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJidG5EZWxldGVQaXBlbGluZSIsCiAgICAgICAgb25DbGljazogdGhpcy5zaG93Q29uZmlybURlbGV0ZU1vZGFsCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5sb2dzdGFzaC5waXBlbGluZUVkaXRvci5kZWxldGVQaXBlbGluZUJ1dHRvbkxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlbGV0ZSBwaXBlbGluZSIKICAgICAgfSkpKSkpLCB0aGlzLnN0YXRlLnNob3dDb25maXJtRGVsZXRlTW9kYWwgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY29uZmlybV9kZWxldGVfcGlwZWxpbmVfbW9kYWwuQ29uZmlybURlbGV0ZVBpcGVsaW5lTW9kYWwsIHsKICAgICAgICBpZDogdGhpcy5wcm9wcy5waXBlbGluZS5pZCwKICAgICAgICBjYW5jZWxEZWxldGVNb2RhbDogdGhpcy5oaWRlQ29uZmlybURlbGV0ZU1vZGFsLAogICAgICAgIGNvbmZpcm1EZWxldGVQaXBlbGluZTogdGhpcy5kZWxldGVQaXBlbGluZQogICAgICB9KSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gUGlwZWxpbmVFZGl0b3JVaTsKfShfcmVhY3QuZGVmYXVsdC5Db21wb25lbnQpOwoKUGlwZWxpbmVFZGl0b3JVaS5wcm9wVHlwZXMgPSB7CiAgY2xvc2U6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICBpc05ld1BpcGVsaW5lOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCiAgbGljZW5zZVNlcnZpY2U6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLnNoYXBlKHsKICAgIGNoZWNrVmFsaWRpdHk6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAgIGlzUmVhZE9ubHk6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICAgIG1lc3NhZ2U6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLnN0cmluZwogIH0pLmlzUmVxdWlyZWQsCiAgb3BlbjogX3Byb3BUeXBlcy5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogIHBpcGVsaW5lOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5zaGFwZSh7CiAgICBpZDogX3Byb3BUeXBlcy5Qcm9wVHlwZXMuc3RyaW5nLAogICAgZGVzY3JpcHRpb246IF9wcm9wVHlwZXMuUHJvcFR5cGVzLnN0cmluZywKICAgIHBpcGVsaW5lOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5hbnksCiAgICBzZXR0aW5nczogX3Byb3BUeXBlcy5Qcm9wVHlwZXMuc2hhcGUoewogICAgICAncGlwZWxpbmUuYmF0Y2guZGVsYXknOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCwKICAgICAgJ3BpcGVsaW5lLmJhdGNoLnNpemUnOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCwKICAgICAgJ3BpcGVsaW5lLndvcmtlcnMnOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5udW1iZXIsCiAgICAgICdxdWV1ZS5jaGVja3BvaW50LndyaXRlcyc6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLAogICAgICAncXVldWUubWF4X2J5dGVzJzogX3Byb3BUeXBlcy5Qcm9wVHlwZXMubnVtYmVyLAogICAgICAncXVldWUudHlwZSc6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkCiAgICB9KQogIH0pLmlzUmVxdWlyZWQsCiAgcGlwZWxpbmVTZXJ2aWNlOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5zaGFwZSh7CiAgICBkZWxldGVQaXBlbGluZTogX3Byb3BUeXBlcy5Qcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogICAgc2F2ZVBpcGVsaW5lOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQKICB9KS5pc1JlcXVpcmVkLAogIHJvdXRlU2VydmljZTogX3Byb3BUeXBlcy5Qcm9wVHlwZXMuc2hhcGUoewogICAgY3VycmVudDogX3Byb3BUeXBlcy5Qcm9wVHlwZXMuc2hhcGUoewogICAgICBwYXJhbXM6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLnNoYXBlKHsKICAgICAgICBjbG9uZTogX3Byb3BUeXBlcy5Qcm9wVHlwZXMub25lT2YoW3RydWUsIHVuZGVmaW5lZF0pLAogICAgICAgIGlkOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5zdHJpbmcKICAgICAgfSkKICAgIH0pCiAgfSkuaXNSZXF1aXJlZCwKICB0b2FzdE5vdGlmaWNhdGlvbnM6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLnNoYXBlKHsKICAgIGFkZFdhcm5pbmc6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAgIGFkZFN1Y2Nlc3M6IF9wcm9wVHlwZXMuUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAgIGFkZEVycm9yOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQKICB9KS5pc1JlcXVpcmVkLAogIHVzZXJuYW1lOiBfcHJvcFR5cGVzLlByb3BUeXBlcy5zdHJpbmcKfTsKdmFyIFBpcGVsaW5lRWRpdG9yID0gKDAsIF9yZWFjdDIuaW5qZWN0STE4bikoUGlwZWxpbmVFZGl0b3JVaSk7CmV4cG9ydHMuUGlwZWxpbmVFZGl0b3IgPSBQaXBlbGluZUVkaXRvcjs="},null]}