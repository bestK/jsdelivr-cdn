{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/reporting/public/components/report_listing.js","dependencies":[{"path":"x-pack/legacy/plugins/reporting/public/components/report_listing.js","mtime":1585205046920},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuUmVwb3J0TGlzdGluZyA9IHZvaWQgMDsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9yZWFjdCA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9tb21lbnQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIm1vbWVudCIpKTsKCnZhciBfbG9kYXNoID0gcmVxdWlyZSgibG9kYXNoIik7Cgp2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9jaHJvbWUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInVpL2Nocm9tZSIpKTsKCnZhciBfbm90aWZ5ID0gcmVxdWlyZSgidWkvbm90aWZ5Iik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9wb2xsZXIgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vcG9sbGVyIik7Cgp2YXIgX2pvYl9zdGF0dXNlcyA9IHJlcXVpcmUoIi4uL2NvbnN0YW50cy9qb2Jfc3RhdHVzZXMiKTsKCnZhciBfZG93bmxvYWRfcmVwb3J0ID0gcmVxdWlyZSgiLi4vbGliL2Rvd25sb2FkX3JlcG9ydCIpOwoKdmFyIF9qb2JfcXVldWVfY2xpZW50ID0gcmVxdWlyZSgiLi4vbGliL2pvYl9xdWV1ZV9jbGllbnQiKTsKCnZhciBfcmVwb3J0X2Vycm9yX2J1dHRvbiA9IHJlcXVpcmUoIi4vcmVwb3J0X2Vycm9yX2J1dHRvbiIpOwoKdmFyIF9yZXBvcnRfaW5mb19idXR0b24gPSByZXF1aXJlKCIuL3JlcG9ydF9pbmZvX2J1dHRvbiIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgcmV0dXJuIGNhbGw7CiAgfQoKICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsKfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsKICB9OwogIHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBqb2JTdGF0dXNMYWJlbHNNYXAgPSBuZXcgTWFwKFtbX2pvYl9zdGF0dXNlcy5Kb2JTdGF0dXNlcy5QRU5ESU5HLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2sucmVwb3J0aW5nLmpvYlN0YXR1c2VzLnBlbmRpbmdUZXh0JywgewogIGRlZmF1bHRNZXNzYWdlOiAnUGVuZGluZycKfSldLCBbX2pvYl9zdGF0dXNlcy5Kb2JTdGF0dXNlcy5QUk9DRVNTSU5HLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2sucmVwb3J0aW5nLmpvYlN0YXR1c2VzLnByb2Nlc3NpbmdUZXh0JywgewogIGRlZmF1bHRNZXNzYWdlOiAnUHJvY2Vzc2luZycKfSldLCBbX2pvYl9zdGF0dXNlcy5Kb2JTdGF0dXNlcy5DT01QTEVURUQsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yZXBvcnRpbmcuam9iU3RhdHVzZXMuY29tcGxldGVkVGV4dCcsIHsKICBkZWZhdWx0TWVzc2FnZTogJ0NvbXBsZXRlZCcKfSldLCBbX2pvYl9zdGF0dXNlcy5Kb2JTdGF0dXNlcy5GQUlMRUQsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yZXBvcnRpbmcuam9iU3RhdHVzZXMuZmFpbGVkVGV4dCcsIHsKICBkZWZhdWx0TWVzc2FnZTogJ0ZhaWxlZCcKfSldLCBbX2pvYl9zdGF0dXNlcy5Kb2JTdGF0dXNlcy5DQU5DRUxMRUQsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yZXBvcnRpbmcuam9iU3RhdHVzZXMuY2FuY2VsbGVkVGV4dCcsIHsKICBkZWZhdWx0TWVzc2FnZTogJ0NhbmNlbGxlZCcKfSldXSk7Cgp2YXIgUmVwb3J0TGlzdGluZ1VpID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhSZXBvcnRMaXN0aW5nVWksIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBSZXBvcnRMaXN0aW5nVWkocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmVwb3J0TGlzdGluZ1VpKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihSZXBvcnRMaXN0aW5nVWkpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJtb3VudGVkIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwb2xsZXIiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImlzSW5pdGlhbEpvYnNGZXRjaCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyRG93bmxvYWRCdXR0b24iLCBmdW5jdGlvbiAocmVjb3JkKSB7CiAgICAgIGlmIChyZWNvcmQuc3RhdHVzICE9PSBfam9iX3N0YXR1c2VzLkpvYlN0YXR1c2VzLkNPTVBMRVRFRCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGludGwgPSBfdGhpcy5wcm9wcy5pbnRsOwoKICAgICAgdmFyIGJ1dHRvbiA9IF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uSWNvbiwgewogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICByZXR1cm4gKDAsIF9kb3dubG9hZF9yZXBvcnQuZG93bmxvYWRSZXBvcnQpKHJlY29yZC5pZCk7CiAgICAgICAgfSwKICAgICAgICBpY29uVHlwZTogImltcG9ydEFjdGlvbiIsCiAgICAgICAgImFyaWEtbGFiZWwiOiBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICd4cGFjay5yZXBvcnRpbmcubGlzdGluZy50YWJsZS5kb3dubG9hZFJlcG9ydEFyaWFMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Rvd25sb2FkIHJlcG9ydCcKICAgICAgICB9KQogICAgICB9KTsKCiAgICAgIGlmIChyZWNvcmQuY3N2X2NvbnRhaW5zX2Zvcm11bGFzKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVG9vbFRpcCwgewogICAgICAgICAgcG9zaXRpb246ICJ0b3AiLAogICAgICAgICAgY29udGVudDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgaWQ6ICd4cGFjay5yZXBvcnRpbmcubGlzdGluZy50YWJsZS5jc3ZDb250YWluc0Zvcm11bGFzJywKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdZb3VyIENTViBjb250YWlucyBjaGFyYWN0ZXJzIHdoaWNoIHNwcmVhZHNoZWV0IGFwcGxpY2F0aW9ucyBjYW4gaW50ZXJwcmV0IGFzIGZvcm11bGFzLicKICAgICAgICAgIH0pCiAgICAgICAgfSwgYnV0dG9uKTsKICAgICAgfQoKICAgICAgaWYgKHJlY29yZC5tYXhfc2l6ZV9yZWFjaGVkKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVG9vbFRpcCwgewogICAgICAgICAgcG9zaXRpb246ICJ0b3AiLAogICAgICAgICAgY29udGVudDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgaWQ6ICd4cGFjay5yZXBvcnRpbmcubGlzdGluZy50YWJsZS5tYXhTaXplUmVhY2hlZFRvb2x0aXAnLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ01heCBzaXplIHJlYWNoZWQsIGNvbnRhaW5zIHBhcnRpYWwgZGF0YS4nCiAgICAgICAgICB9KQogICAgICAgIH0sIGJ1dHRvbik7CiAgICAgIH0KCiAgICAgIHJldHVybiBidXR0b247CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZW5kZXJSZXBvcnRFcnJvckJ1dHRvbiIsIGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgaWYgKHJlY29yZC5zdGF0dXMgIT09IF9qb2Jfc3RhdHVzZXMuSm9iU3RhdHVzZXMuRkFJTEVEKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlcG9ydF9lcnJvcl9idXR0b24uUmVwb3J0RXJyb3JCdXR0b24sIHsKICAgICAgICBqb2JJZDogcmVjb3JkLmlkCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVySW5mb0J1dHRvbiIsIGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZXBvcnRfaW5mb19idXR0b24uUmVwb3J0SW5mb0J1dHRvbiwgewogICAgICAgIGpvYklkOiByZWNvcmQuaWQKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblRhYmxlQ2hhbmdlIiwgZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgdmFyIHBhZ2UgPSBfcmVmLnBhZ2U7CiAgICAgIHZhciBwYWdlSW5kZXggPSBwYWdlLmluZGV4OwoKICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwYWdlOiBwYWdlSW5kZXgKICAgICAgICB9OwogICAgICB9LCBfdGhpcy5mZXRjaEpvYnMpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmV0Y2hKb2JzIiwgZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgdmFyIGpvYnMsIHRvdGFsOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIC8vIGF2b2lkIHBhZ2UgZmxpY2tlciB3aGVuIHBvbGxlciBpcyB1cGRhdGluZyB0YWJsZSAtIG9ubHkgZGlzcGxheSBsb2FkaW5nIHNjcmVlbiBvbiBmaXJzdCBsb2FkCiAgICAgICAgICAgICAgaWYgKF90aGlzLmlzSW5pdGlhbEpvYnNGZXRjaCkgewogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlzTG9hZGluZzogdHJ1ZQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF9qb2JfcXVldWVfY2xpZW50LmpvYlF1ZXVlQ2xpZW50Lmxpc3QoX3RoaXMuc3RhdGUucGFnZSkpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGpvYnMgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX2pvYl9xdWV1ZV9jbGllbnQuam9iUXVldWVDbGllbnQudG90YWwoKSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgdG90YWwgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgIF90aGlzLmlzSW5pdGlhbEpvYnNGZXRjaCA9IGZhbHNlOwogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDExOwogICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMSk7CgogICAgICAgICAgICAgIGlmIChfdGhpcy5saWNlbnNlQWxsb3dzVG9TaG93VGhpc1BhZ2UoKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGREYW5nZXIoX3RoaXMucHJvcHMuYmFkTGljZW5zZU1lc3NhZ2UpOwoKICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5yZWRpcmVjdCgnL21hbmFnZW1lbnQnKTsKCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgIGlmIChfY29udGV4dC50MC5yZXMuc3RhdHVzICE9PSA0MDEgJiYgX2NvbnRleHQudDAucmVzLnN0YXR1cyAhPT0gNDAzKSB7CiAgICAgICAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGREYW5nZXIoX2NvbnRleHQudDAucmVzLnN0YXR1c1RleHQgfHwgX3RoaXMucHJvcHMuaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgaWQ6ICd4cGFjay5yZXBvcnRpbmcubGlzdGluZy50YWJsZS5yZXF1ZXN0RmFpbGVkRXJyb3JNZXNzYWdlJywKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZXF1ZXN0IGZhaWxlZCcKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChfdGhpcy5tb3VudGVkKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBqb2JzOiBbXSwKICAgICAgICAgICAgICAgICAgICB0b3RhbDogMAogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgaWYgKF90aGlzLm1vdW50ZWQpIHsKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbCwKICAgICAgICAgICAgICAgICAgICBqb2JzOiBqb2JzLm1hcChmdW5jdGlvbiAoam9iKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gam9iLl9zb3VyY2U7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBpZDogam9iLl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogc291cmNlLmpvYnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdF90eXBlOiBzb3VyY2UucGF5bG9hZC50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RfdGl0bGU6IHNvdXJjZS5wYXlsb2FkLnRpdGxlLAogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkX2J5OiBzb3VyY2UuY3JlYXRlZF9ieSwKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZF9hdDogc291cmNlLmNyZWF0ZWRfYXQsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWRfYXQ6IHNvdXJjZS5zdGFydGVkX2F0LAogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWRfYXQ6IHNvdXJjZS5jb21wbGV0ZWRfYXQsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogc291cmNlLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzTGFiZWw6IGpvYlN0YXR1c0xhYmVsc01hcC5nZXQoc291cmNlLnN0YXR1cykgfHwgc291cmNlLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3NpemVfcmVhY2hlZDogc291cmNlLm91dHB1dCA/IHNvdXJjZS5vdXRwdXQubWF4X3NpemVfcmVhY2hlZCA6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBhdHRlbXB0czogc291cmNlLmF0dGVtcHRzLAogICAgICAgICAgICAgICAgICAgICAgICBtYXhfYXR0ZW1wdHM6IHNvdXJjZS5tYXhfYXR0ZW1wdHMsCiAgICAgICAgICAgICAgICAgICAgICAgIGNzdl9jb250YWluc19mb3JtdWxhczogKDAsIF9sb2Rhc2guZ2V0KShzb3VyY2UsICdvdXRwdXQuY3N2X2NvbnRhaW5zX2Zvcm11bGFzJykKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIG51bGwsIFtbMSwgMTFdXSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJsaWNlbnNlQWxsb3dzVG9TaG93VGhpc1BhZ2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpcy5wcm9wcy5zaG93TGlua3MgJiYgX3RoaXMucHJvcHMuZW5hYmxlTGlua3M7CiAgICB9KTsKCiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgcGFnZTogMCwKICAgICAgdG90YWw6IDAsCiAgICAgIGpvYnM6IFtdLAogICAgICBpc0xvYWRpbmc6IGZhbHNlCiAgICB9OwogICAgX3RoaXMuaXNJbml0aWFsSm9ic0ZldGNoID0gdHJ1ZTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhSZXBvcnRMaXN0aW5nVWksIFt7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnQsIHsKICAgICAgICBob3Jpem9udGFsUG9zaXRpb246ICJjZW50ZXIiLAogICAgICAgIGNsYXNzTmFtZTogImV1aVBhZ2VCb2R5LS1yZXN0cmljdFdpZHRoLWRlZmF1bHQiCiAgICAgIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMSIsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5yZXBvcnRpbmcubGlzdGluZy5yZXBvcnRzdGl0bGUiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUmVwb3J0cyIKICAgICAgfSkpKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUZXh0LCB7CiAgICAgICAgY29sb3I6ICJzdWJkdWVkIiwKICAgICAgICBzaXplOiAicyIKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAieHBhY2sucmVwb3J0aW5nLmxpc3RpbmcucmVwb3J0cy5zdWJ0aXRsZSIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJGaW5kIHJlcG9ydHMgZ2VuZXJhdGVkIGluIEtpYmFuYSBhcHBsaWNhdGlvbnMgaGVyZSIKICAgICAgfSkpKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIG51bGwpLCB0aGlzLnJlbmRlclRhYmxlKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxVbm1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHsKICAgICAgdGhpcy5tb3VudGVkID0gZmFsc2U7CiAgICAgIHRoaXMucG9sbGVyLnN0b3AoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy5tb3VudGVkID0gdHJ1ZTsKCiAgICAgIHZhciBfY2hyb21lJGdldEluamVjdGVkID0gX2Nocm9tZS5kZWZhdWx0LmdldEluamVjdGVkKCdyZXBvcnRpbmdQb2xsQ29uZmlnJyksCiAgICAgICAgICBqb2JzUmVmcmVzaCA9IF9jaHJvbWUkZ2V0SW5qZWN0ZWQuam9ic1JlZnJlc2g7CgogICAgICB0aGlzLnBvbGxlciA9IG5ldyBfcG9sbGVyLlBvbGxlcih7CiAgICAgICAgZnVuY3Rpb25Ub1BvbGw6IGZ1bmN0aW9uIGZ1bmN0aW9uVG9Qb2xsKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMi5mZXRjaEpvYnMoKTsKICAgICAgICB9LAogICAgICAgIHBvbGxGcmVxdWVuY3lJbk1pbGxpczogam9ic1JlZnJlc2guaW50ZXJ2YWwsCiAgICAgICAgdHJhaWxpbmc6IGZhbHNlLAogICAgICAgIGNvbnRpbnVlUG9sbGluZ09uRXJyb3I6IHRydWUsCiAgICAgICAgcG9sbEZyZXF1ZW5jeUVycm9yTXVsdGlwbGllcjogam9ic1JlZnJlc2guaW50ZXJ2YWxFcnJvck11bHRpcGxpZXIKICAgICAgfSk7CiAgICAgIHRoaXMucG9sbGVyLnN0YXJ0KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyVGFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclRhYmxlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBpbnRsID0gdGhpcy5wcm9wcy5pbnRsOwogICAgICB2YXIgdGFibGVDb2x1bW5zID0gW3sKICAgICAgICBmaWVsZDogJ29iamVjdF90aXRsZScsCiAgICAgICAgbmFtZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2sucmVwb3J0aW5nLmxpc3RpbmcudGFibGVDb2x1bW5zLnJlcG9ydFRpdGxlJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVwb3J0JwogICAgICAgIH0pLAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKG9iamVjdFRpdGxlLCByZWNvcmQpIHsKICAgICAgICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIG9iamVjdFRpdGxlKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUZXh0LCB7CiAgICAgICAgICAgIHNpemU6ICJzIgogICAgICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUZXh0Q29sb3IsIHsKICAgICAgICAgICAgY29sb3I6ICJzdWJkdWVkIgogICAgICAgICAgfSwgcmVjb3JkLm9iamVjdF90eXBlKSkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGZpZWxkOiAnY3JlYXRlZF9hdCcsCiAgICAgICAgbmFtZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2sucmVwb3J0aW5nLmxpc3RpbmcudGFibGVDb2x1bW5zLmNyZWF0ZWRBdFRpdGxlJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ3JlYXRlZCBhdCcKICAgICAgICB9KSwKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihjcmVhdGVkQXQsIHJlY29yZCkgewogICAgICAgICAgaWYgKHJlY29yZC5jcmVhdGVkX2J5KSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIF90aGlzMy5mb3JtYXREYXRlKGNyZWF0ZWRBdCkpLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIHJlY29yZC5jcmVhdGVkX2J5KSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF90aGlzMy5mb3JtYXREYXRlKGNyZWF0ZWRBdCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZmllbGQ6ICdzdGF0dXMnLAogICAgICAgIG5hbWU6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ3hwYWNrLnJlcG9ydGluZy5saXN0aW5nLnRhYmxlQ29sdW1ucy5zdGF0dXNUaXRsZScsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1N0YXR1cycKICAgICAgICB9KSwKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihzdGF0dXMsIHJlY29yZCkgewogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLnJlcG9ydGluZy5saXN0aW5nLnRhYmxlVmFsdWUuY3JlYXRlZEF0RGV0YWlsLnBlbmRpbmdTdGF0dXNSZWFjaGVkVGV4dCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJQZW5kaW5nIC0gd2FpdGluZyBmb3Igam9iIHRvIGJlIHByb2Nlc3NlZCIKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBtYXhTaXplUmVhY2hlZDsKCiAgICAgICAgICBpZiAocmVjb3JkLm1heF9zaXplX3JlYWNoZWQpIHsKICAgICAgICAgICAgbWF4U2l6ZVJlYWNoZWQgPSBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgaWQ6ICJ4cGFjay5yZXBvcnRpbmcubGlzdGluZy50YWJsZVZhbHVlLmNyZWF0ZWRBdERldGFpbC5tYXhTaXplUmVhY2hlZFRleHQiLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiIC0gTWF4IHNpemUgcmVhY2hlZCIKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzdGF0dXNUaW1lc3RhbXA7CgogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gX2pvYl9zdGF0dXNlcy5Kb2JTdGF0dXNlcy5QUk9DRVNTSU5HICYmIHJlY29yZC5zdGFydGVkX2F0KSB7CiAgICAgICAgICAgIHN0YXR1c1RpbWVzdGFtcCA9IF90aGlzMy5mb3JtYXREYXRlKHJlY29yZC5zdGFydGVkX2F0KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkLmNvbXBsZXRlZF9hdCAmJiAoc3RhdHVzID09PSBfam9iX3N0YXR1c2VzLkpvYlN0YXR1c2VzLkNPTVBMRVRFRCB8fCBzdGF0dXMgPT09IF9qb2Jfc3RhdHVzZXMuSm9iU3RhdHVzZXMuRkFJTEVEKSkgewogICAgICAgICAgICBzdGF0dXNUaW1lc3RhbXAgPSBfdGhpczMuZm9ybWF0RGF0ZShyZWNvcmQuY29tcGxldGVkX2F0KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc3RhdHVzTGFiZWwgPSBqb2JTdGF0dXNMYWJlbHNNYXAuZ2V0KHN0YXR1cykgfHwgc3RhdHVzOwoKICAgICAgICAgIGlmIChzdGF0dXMgPT09IF9qb2Jfc3RhdHVzZXMuSm9iU3RhdHVzZXMuUFJPQ0VTU0lORykgewogICAgICAgICAgICBzdGF0dXNMYWJlbCA9IHN0YXR1c0xhYmVsICsgIiAoYXR0ZW1wdCAiLmNvbmNhdChyZWNvcmQuYXR0ZW1wdHMsICIgb2YgIikuY29uY2F0KHJlY29yZC5tYXhfYXR0ZW1wdHMsICIpIik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHN0YXR1c1RpbWVzdGFtcCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgaWQ6ICJ4cGFjay5yZXBvcnRpbmcubGlzdGluZy50YWJsZVZhbHVlLmNyZWF0ZWRBdERldGFpbC5zdGF0dXNUaW1lc3RhbXBUZXh0IiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIntzdGF0dXNMYWJlbH0gYXQge3N0YXR1c1RpbWVzdGFtcH0iLAogICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgc3RhdHVzTGFiZWw6IHN0YXR1c0xhYmVsLAogICAgICAgICAgICAgICAgc3RhdHVzVGltZXN0YW1wOiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiZXVpLXRleHROb1dyYXAiCiAgICAgICAgICAgICAgICB9LCBzdGF0dXNUaW1lc3RhbXApCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwgbWF4U2l6ZVJlYWNoZWQpOwogICAgICAgICAgfSAvLyB1bmtub3duIHN0YXR1cwoKCiAgICAgICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIHN0YXR1c0xhYmVsLCBtYXhTaXplUmVhY2hlZCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgbmFtZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2sucmVwb3J0aW5nLmxpc3RpbmcudGFibGVDb2x1bW5zLmFjdGlvbnNUaXRsZScsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0FjdGlvbnMnCiAgICAgICAgfSksCiAgICAgICAgYWN0aW9uczogW3sKICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKHJlY29yZCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIF90aGlzMy5yZW5kZXJEb3dubG9hZEJ1dHRvbihyZWNvcmQpLCBfdGhpczMucmVuZGVyUmVwb3J0RXJyb3JCdXR0b24ocmVjb3JkKSwgX3RoaXMzLnJlbmRlckluZm9CdXR0b24ocmVjb3JkKSk7CiAgICAgICAgICB9CiAgICAgICAgfV0KICAgICAgfV07CiAgICAgIHZhciBwYWdpbmF0aW9uID0gewogICAgICAgIHBhZ2VJbmRleDogdGhpcy5zdGF0ZS5wYWdlLAogICAgICAgIHBhZ2VTaXplOiAxMCwKICAgICAgICB0b3RhbEl0ZW1Db3VudDogdGhpcy5zdGF0ZS50b3RhbCwKICAgICAgICBoaWRlUGVyUGFnZU9wdGlvbnM6IHRydWUKICAgICAgfTsKICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQmFzaWNUYWJsZSwgewogICAgICAgIGl0ZW1JZDogJ2lkJywKICAgICAgICBpdGVtczogdGhpcy5zdGF0ZS5qb2JzLAogICAgICAgIGxvYWRpbmc6IHRoaXMuc3RhdGUuaXNMb2FkaW5nLAogICAgICAgIGNvbHVtbnM6IHRhYmxlQ29sdW1ucywKICAgICAgICBub0l0ZW1zTWVzc2FnZTogdGhpcy5zdGF0ZS5pc0xvYWRpbmcgPyBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICd4cGFjay5yZXBvcnRpbmcubGlzdGluZy50YWJsZS5sb2FkaW5nUmVwb3J0c0Rlc2NyaXB0aW9uJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTG9hZGluZyByZXBvcnRzJwogICAgICAgIH0pIDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2sucmVwb3J0aW5nLmxpc3RpbmcudGFibGUubm9DcmVhdGVkUmVwb3J0c0Rlc2NyaXB0aW9uJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTm8gcmVwb3J0cyBoYXZlIGJlZW4gY3JlYXRlZCcKICAgICAgICB9KSwKICAgICAgICBwYWdpbmF0aW9uOiBwYWdpbmF0aW9uLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uVGFibGVDaGFuZ2UsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInJlcG9ydEpvYkxpc3RpbmciCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImZvcm1hdERhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvcm1hdERhdGUodGltZXN0YW1wKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuICgwLCBfbW9tZW50LmRlZmF1bHQpKHRpbWVzdGFtcCkuZm9ybWF0KCdZWVlZLU1NLUREIEAgaGg6bW0gQScpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIC8vIGlnbm9yZSBwYXJzZSBlcnJvciBhbmQgZGlzcGxheSB1bmZvcm1hdHRlZCB2YWx1ZQogICAgICAgIHJldHVybiB0aW1lc3RhbXA7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBSZXBvcnRMaXN0aW5nVWk7Cn0oX3JlYWN0Mi5Db21wb25lbnQpOwoKdmFyIFJlcG9ydExpc3RpbmcgPSAoMCwgX3JlYWN0LmluamVjdEkxOG4pKFJlcG9ydExpc3RpbmdVaSk7CmV4cG9ydHMuUmVwb3J0TGlzdGluZyA9IFJlcG9ydExpc3Rpbmc7"},null]}