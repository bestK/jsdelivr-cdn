{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/ml/public/application/services/results_service/results_service.js","dependencies":[{"path":"x-pack/legacy/plugins/ml/public/application/services/results_service/results_service.js","mtime":1585205045952},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmdldFNjb3Jlc0J5QnVja2V0ID0gZ2V0U2NvcmVzQnlCdWNrZXQ7CmV4cG9ydHMuZ2V0VG9wSW5mbHVlbmNlcnMgPSBnZXRUb3BJbmZsdWVuY2VyczsKZXhwb3J0cy5nZXRUb3BJbmZsdWVuY2VyVmFsdWVzID0gZ2V0VG9wSW5mbHVlbmNlclZhbHVlczsKZXhwb3J0cy5nZXRPdmVyYWxsQnVja2V0U2NvcmVzID0gZ2V0T3ZlcmFsbEJ1Y2tldFNjb3JlczsKZXhwb3J0cy5nZXRJbmZsdWVuY2VyVmFsdWVNYXhTY29yZUJ5VGltZSA9IGdldEluZmx1ZW5jZXJWYWx1ZU1heFNjb3JlQnlUaW1lOwpleHBvcnRzLmdldFJlY29yZEluZmx1ZW5jZXJzID0gZ2V0UmVjb3JkSW5mbHVlbmNlcnM7CmV4cG9ydHMuZ2V0UmVjb3Jkc0ZvckluZmx1ZW5jZXIgPSBnZXRSZWNvcmRzRm9ySW5mbHVlbmNlcjsKZXhwb3J0cy5nZXRSZWNvcmRzRm9yRGV0ZWN0b3IgPSBnZXRSZWNvcmRzRm9yRGV0ZWN0b3I7CmV4cG9ydHMuZ2V0UmVjb3JkcyA9IGdldFJlY29yZHM7CmV4cG9ydHMuZ2V0RXZlbnRSYXRlRGF0YSA9IGdldEV2ZW50UmF0ZURhdGE7CmV4cG9ydHMuZ2V0RXZlbnREaXN0cmlidXRpb25EYXRhID0gZ2V0RXZlbnREaXN0cmlidXRpb25EYXRhOwpleHBvcnRzLmdldFJlY29yZE1heFNjb3JlQnlUaW1lID0gZ2V0UmVjb3JkTWF4U2NvcmVCeVRpbWU7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIF9qb2JfdXRpbHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vdXRpbC9qb2JfdXRpbHMiKTsKCnZhciBfc3RyaW5nX3V0aWxzID0gcmVxdWlyZSgiLi4vLi4vdXRpbC9zdHJpbmdfdXRpbHMiKTsKCnZhciBfaW5kZXhfcGF0dGVybnMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vY29uc3RhbnRzL2luZGV4X3BhdHRlcm5zIik7Cgp2YXIgX21sX2FwaV9zZXJ2aWNlID0gcmVxdWlyZSgiLi4vbWxfYXBpX3NlcnZpY2UiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKLy8gT2J0YWlucyB0aGUgbWF4aW11bSBidWNrZXQgYW5vbWFseSBzY29yZXMgYnkgam9iIElEIGFuZCB0aW1lLgovLyBQYXNzIGFuIGVtcHR5IGFycmF5IG9yIFsnKiddIHRvIHNlYXJjaCBvdmVyIGFsbCBqb2IgSURzLgovLyBSZXR1cm5lZCByZXNwb25zZSBjb250YWlucyBhIHJlc3VsdHMgcHJvcGVydHksIHdpdGggYSBrZXkgZm9yIGpvYgovLyB3aGljaCBoYXMgcmVzdWx0cyBmb3IgdGhlIHNwZWNpZmllZCB0aW1lIHJhbmdlLgpmdW5jdGlvbiBnZXRTY29yZXNCeUJ1Y2tldChqb2JJZHMsIGVhcmxpZXN0TXMsIGxhdGVzdE1zLCBpbnRlcnZhbCwgbWF4UmVzdWx0cykgewogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICB2YXIgb2JqID0gewogICAgICBzdWNjZXNzOiB0cnVlLAogICAgICByZXN1bHRzOiB7fQogICAgfTsgLy8gQnVpbGQgdGhlIGNyaXRlcmlhIHRvIHVzZSBpbiB0aGUgYm9vbCBmaWx0ZXIgcGFydCBvZiB0aGUgcmVxdWVzdC4KICAgIC8vIEFkZHMgY3JpdGVyaWEgZm9yIHRoZSB0aW1lIHJhbmdlIHBsdXMgYW55IHNwZWNpZmllZCBqb2IgSURzLgoKICAgIHZhciBib29sQ3JpdGVyaWEgPSBbewogICAgICByYW5nZTogewogICAgICAgIHRpbWVzdGFtcDogewogICAgICAgICAgZ3RlOiBlYXJsaWVzdE1zLAogICAgICAgICAgbHRlOiBsYXRlc3RNcywKICAgICAgICAgIGZvcm1hdDogJ2Vwb2NoX21pbGxpcycKICAgICAgICB9CiAgICAgIH0KICAgIH1dOwoKICAgIGlmIChqb2JJZHMgJiYgam9iSWRzLmxlbmd0aCA+IDAgJiYgIShqb2JJZHMubGVuZ3RoID09PSAxICYmIGpvYklkc1swXSA9PT0gJyonKSkgewogICAgICB2YXIgam9iSWRGaWx0ZXJTdHIgPSAnJzsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGpvYklkcywgZnVuY3Rpb24gKGpvYklkLCBpKSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICBqb2JJZEZpbHRlclN0ciArPSAnIE9SICc7CiAgICAgICAgfQoKICAgICAgICBqb2JJZEZpbHRlclN0ciArPSAnam9iX2lkOic7CiAgICAgICAgam9iSWRGaWx0ZXJTdHIgKz0gam9iSWQ7CiAgICAgIH0pOwoKICAgICAgYm9vbENyaXRlcmlhLnB1c2goewogICAgICAgIHF1ZXJ5X3N0cmluZzogewogICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UsCiAgICAgICAgICBxdWVyeTogam9iSWRGaWx0ZXJTdHIKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIF9tbF9hcGlfc2VydmljZS5tbC5lc1NlYXJjaCh7CiAgICAgIGluZGV4OiBfaW5kZXhfcGF0dGVybnMuTUxfUkVTVUxUU19JTkRFWF9QQVRURVJOLAogICAgICBzaXplOiAwLAogICAgICBib2R5OiB7CiAgICAgICAgcXVlcnk6IHsKICAgICAgICAgIGJvb2w6IHsKICAgICAgICAgICAgZmlsdGVyOiBbewogICAgICAgICAgICAgIHF1ZXJ5X3N0cmluZzogewogICAgICAgICAgICAgICAgcXVlcnk6ICdyZXN1bHRfdHlwZTpidWNrZXQnLAogICAgICAgICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgICAgICBtdXN0OiBib29sQ3JpdGVyaWEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhZ2dzOiB7CiAgICAgICAgICBqb2JJZDogewogICAgICAgICAgICB0ZXJtczogewogICAgICAgICAgICAgIGZpZWxkOiAnam9iX2lkJywKICAgICAgICAgICAgICBzaXplOiBtYXhSZXN1bHRzICE9PSB1bmRlZmluZWQgPyBtYXhSZXN1bHRzIDogNSwKICAgICAgICAgICAgICBvcmRlcjogewogICAgICAgICAgICAgICAgYW5vbWFseVNjb3JlOiAnZGVzYycKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFnZ3M6IHsKICAgICAgICAgICAgICBhbm9tYWx5U2NvcmU6IHsKICAgICAgICAgICAgICAgIG1heDogewogICAgICAgICAgICAgICAgICBmaWVsZDogJ2Fub21hbHlfc2NvcmUnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBieVRpbWU6IHsKICAgICAgICAgICAgICAgIGRhdGVfaGlzdG9ncmFtOiB7CiAgICAgICAgICAgICAgICAgIGZpZWxkOiAndGltZXN0YW1wJywKICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IGludGVydmFsLAogICAgICAgICAgICAgICAgICBtaW5fZG9jX2NvdW50OiAxLAogICAgICAgICAgICAgICAgICBleHRlbmRlZF9ib3VuZHM6IHsKICAgICAgICAgICAgICAgICAgICBtaW46IGVhcmxpZXN0TXMsCiAgICAgICAgICAgICAgICAgICAgbWF4OiBsYXRlc3RNcwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYWdnczogewogICAgICAgICAgICAgICAgICBhbm9tYWx5U2NvcmU6IHsKICAgICAgICAgICAgICAgICAgICBtYXg6IHsKICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnYW5vbWFseV9zY29yZScKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgdmFyIGRhdGFCeUpvYklkID0gX2xvZGFzaC5kZWZhdWx0LmdldChyZXNwLCBbJ2FnZ3JlZ2F0aW9ucycsICdqb2JJZCcsICdidWNrZXRzJ10sIFtdKTsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGRhdGFCeUpvYklkLCBmdW5jdGlvbiAoZGF0YUZvckpvYikgewogICAgICAgIHZhciBqb2JJZCA9IGRhdGFGb3JKb2Iua2V5OwogICAgICAgIHZhciByZXN1bHRzRm9yVGltZSA9IHt9OwoKICAgICAgICB2YXIgZGF0YUJ5VGltZSA9IF9sb2Rhc2guZGVmYXVsdC5nZXQoZGF0YUZvckpvYiwgWydieVRpbWUnLCAnYnVja2V0cyddLCBbXSk7CgogICAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGRhdGFCeVRpbWUsIGZ1bmN0aW9uIChkYXRhRm9yVGltZSkgewogICAgICAgICAgdmFyIHZhbHVlID0gX2xvZGFzaC5kZWZhdWx0LmdldChkYXRhRm9yVGltZSwgWydhbm9tYWx5U2NvcmUnLCAndmFsdWUnXSk7CgogICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdmFyIHRpbWUgPSBkYXRhRm9yVGltZS5rZXk7CiAgICAgICAgICAgIHJlc3VsdHNGb3JUaW1lW3RpbWVdID0gX2xvZGFzaC5kZWZhdWx0LmdldChkYXRhRm9yVGltZSwgWydhbm9tYWx5U2NvcmUnLCAndmFsdWUnXSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG9iai5yZXN1bHRzW2pvYklkXSA9IHJlc3VsdHNGb3JUaW1lOwogICAgICB9KTsKCiAgICAgIHJlc29sdmUob2JqKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIHJlamVjdChyZXNwKTsKICAgIH0pOwogIH0pOwp9IC8vIE9idGFpbnMgdGhlIHRvcCBpbmZsdWVuY2VycywgYnkgbWF4aW11bSBpbmZsdWVuY2VyIHNjb3JlLCBmb3IgdGhlIHNwZWNpZmllZCBpbmRleCwgdGltZSByYW5nZSBhbmQgam9iIElEKHMpLgovLyBQYXNzIGFuIGVtcHR5IGFycmF5IG9yIFsnKiddIHRvIHNlYXJjaCBvdmVyIGFsbCBqb2IgSURzLgovLyBBbiBvcHRpb25hbCBhcnJheSBvZiBpbmZsdWVuY2VycyBtYXkgYmUgc3VwcGxpZWQsIHdpdGggZWFjaCBvYmplY3QgaW4gdGhlIGFycmF5IGhhdmluZyAnZmllbGROYW1lJwovLyBhbmQgJ2ZpZWxkVmFsdWUnIHByb3BlcnRpZXMsIHRvIGxpbWl0IGRhdGEgdG8gdGhlIHN1cHBsaWVkIGxpc3Qgb2YgaW5mbHVlbmNlcnMuCi8vIFJldHVybmVkIHJlc3BvbnNlIGNvbnRhaW5zIGFuIGluZmx1ZW5jZXJzIHByb3BlcnR5LCB3aXRoIGEga2V5IGZvciBlYWNoIG9mIHRoZSBpbmZsdWVuY2VyIGZpZWxkIG5hbWVzLAovLyB3aG9zZSB2YWx1ZSBpcyBhbiBhcnJheSBvZiBvYmplY3RzIGNvbnRhaW5pbmcgaW5mbHVlbmNlckZpZWxkVmFsdWUsIG1heEFub21hbHlTY29yZSBhbmQgc3VtQW5vbWFseVNjb3JlIGtleXMuCgoKZnVuY3Rpb24gZ2V0VG9wSW5mbHVlbmNlcnMoam9iSWRzLCBlYXJsaWVzdE1zLCBsYXRlc3RNcykgewogIHZhciBtYXhGaWVsZFZhbHVlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogMTA7CiAgdmFyIGluZmx1ZW5jZXJzID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiBbXTsKICB2YXIgaW5mbHVlbmNlcnNGaWx0ZXJRdWVyeSA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ID8gYXJndW1lbnRzWzVdIDogdW5kZWZpbmVkOwogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICB2YXIgb2JqID0gewogICAgICBzdWNjZXNzOiB0cnVlLAogICAgICBpbmZsdWVuY2Vyczoge30KICAgIH07IC8vIEJ1aWxkIHRoZSBjcml0ZXJpYSB0byB1c2UgaW4gdGhlIGJvb2wgZmlsdGVyIHBhcnQgb2YgdGhlIHJlcXVlc3QuCiAgICAvLyBBZGRzIGNyaXRlcmlhIGZvciB0aGUgdGltZSByYW5nZSBwbHVzIGFueSBzcGVjaWZpZWQgam9iIElEcy4KCiAgICB2YXIgYm9vbENyaXRlcmlhID0gW3sKICAgICAgcmFuZ2U6IHsKICAgICAgICB0aW1lc3RhbXA6IHsKICAgICAgICAgIGd0ZTogZWFybGllc3RNcywKICAgICAgICAgIGx0ZTogbGF0ZXN0TXMsCiAgICAgICAgICBmb3JtYXQ6ICdlcG9jaF9taWxsaXMnCiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIHJhbmdlOiB7CiAgICAgICAgaW5mbHVlbmNlcl9zY29yZTogewogICAgICAgICAgZ3Q6IDAKICAgICAgICB9CiAgICAgIH0KICAgIH1dOwoKICAgIGlmIChqb2JJZHMgJiYgam9iSWRzLmxlbmd0aCA+IDAgJiYgIShqb2JJZHMubGVuZ3RoID09PSAxICYmIGpvYklkc1swXSA9PT0gJyonKSkgewogICAgICB2YXIgam9iSWRGaWx0ZXJTdHIgPSAnJzsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGpvYklkcywgZnVuY3Rpb24gKGpvYklkLCBpKSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICBqb2JJZEZpbHRlclN0ciArPSAnIE9SICc7CiAgICAgICAgfQoKICAgICAgICBqb2JJZEZpbHRlclN0ciArPSAnam9iX2lkOic7CiAgICAgICAgam9iSWRGaWx0ZXJTdHIgKz0gam9iSWQ7CiAgICAgIH0pOwoKICAgICAgYm9vbENyaXRlcmlhLnB1c2goewogICAgICAgIHF1ZXJ5X3N0cmluZzogewogICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UsCiAgICAgICAgICBxdWVyeTogam9iSWRGaWx0ZXJTdHIKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGlmIChpbmZsdWVuY2Vyc0ZpbHRlclF1ZXJ5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgYm9vbENyaXRlcmlhLnB1c2goaW5mbHVlbmNlcnNGaWx0ZXJRdWVyeSk7CiAgICB9IC8vIEFkZCBhIHNob3VsZCBxdWVyeSB0byBmaWx0ZXIgZm9yIGVhY2ggb2YgdGhlIHNwZWNpZmllZCBpbmZsdWVuY2Vycy4KCgogICAgaWYgKGluZmx1ZW5jZXJzLmxlbmd0aCA+IDApIHsKICAgICAgYm9vbENyaXRlcmlhLnB1c2goewogICAgICAgIGJvb2w6IHsKICAgICAgICAgIHNob3VsZDogaW5mbHVlbmNlcnMubWFwKGZ1bmN0aW9uIChpbmZsdWVuY2VyKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgYm9vbDogewogICAgICAgICAgICAgICAgbXVzdDogW3sKICAgICAgICAgICAgICAgICAgdGVybTogewogICAgICAgICAgICAgICAgICAgIGluZmx1ZW5jZXJfZmllbGRfbmFtZTogaW5mbHVlbmNlci5maWVsZE5hbWUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICB0ZXJtOiB7CiAgICAgICAgICAgICAgICAgICAgaW5mbHVlbmNlcl9maWVsZF92YWx1ZTogaW5mbHVlbmNlci5maWVsZFZhbHVlCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgfSksCiAgICAgICAgICBtaW5pbXVtX3Nob3VsZF9tYXRjaDogMQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgX21sX2FwaV9zZXJ2aWNlLm1sLmVzU2VhcmNoKHsKICAgICAgaW5kZXg6IF9pbmRleF9wYXR0ZXJucy5NTF9SRVNVTFRTX0lOREVYX1BBVFRFUk4sCiAgICAgIHNpemU6IDAsCiAgICAgIGJvZHk6IHsKICAgICAgICBxdWVyeTogewogICAgICAgICAgYm9vbDogewogICAgICAgICAgICBmaWx0ZXI6IFt7CiAgICAgICAgICAgICAgcXVlcnlfc3RyaW5nOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogJ3Jlc3VsdF90eXBlOmluZmx1ZW5jZXInLAogICAgICAgICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgICAgICBtdXN0OiBib29sQ3JpdGVyaWEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhZ2dzOiB7CiAgICAgICAgICBpbmZsdWVuY2VyRmllbGROYW1lczogewogICAgICAgICAgICB0ZXJtczogewogICAgICAgICAgICAgIGZpZWxkOiAnaW5mbHVlbmNlcl9maWVsZF9uYW1lJywKICAgICAgICAgICAgICBzaXplOiA1LAogICAgICAgICAgICAgIG9yZGVyOiB7CiAgICAgICAgICAgICAgICBtYXhBbm9tYWx5U2NvcmU6ICdkZXNjJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWdnczogewogICAgICAgICAgICAgIG1heEFub21hbHlTY29yZTogewogICAgICAgICAgICAgICAgbWF4OiB7CiAgICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5mbHVlbmNlcl9zY29yZScKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGluZmx1ZW5jZXJGaWVsZFZhbHVlczogewogICAgICAgICAgICAgICAgdGVybXM6IHsKICAgICAgICAgICAgICAgICAgZmllbGQ6ICdpbmZsdWVuY2VyX2ZpZWxkX3ZhbHVlJywKICAgICAgICAgICAgICAgICAgc2l6ZTogbWF4RmllbGRWYWx1ZXMsCiAgICAgICAgICAgICAgICAgIG9yZGVyOiB7CiAgICAgICAgICAgICAgICAgICAgbWF4QW5vbWFseVNjb3JlOiAnZGVzYycKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFnZ3M6IHsKICAgICAgICAgICAgICAgICAgbWF4QW5vbWFseVNjb3JlOiB7CiAgICAgICAgICAgICAgICAgICAgbWF4OiB7CiAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ2luZmx1ZW5jZXJfc2NvcmUnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBzdW1Bbm9tYWx5U2NvcmU6IHsKICAgICAgICAgICAgICAgICAgICBzdW06IHsKICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5mbHVlbmNlcl9zY29yZScKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgdmFyIGZpZWxkTmFtZUJ1Y2tldHMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHJlc3AsIFsnYWdncmVnYXRpb25zJywgJ2luZmx1ZW5jZXJGaWVsZE5hbWVzJywgJ2J1Y2tldHMnXSwgW10pOwoKICAgICAgX2xvZGFzaC5kZWZhdWx0LmVhY2goZmllbGROYW1lQnVja2V0cywgZnVuY3Rpb24gKG5hbWVCdWNrZXQpIHsKICAgICAgICB2YXIgZmllbGROYW1lID0gbmFtZUJ1Y2tldC5rZXk7CiAgICAgICAgdmFyIGZpZWxkVmFsdWVzID0gW107CgogICAgICAgIHZhciBmaWVsZFZhbHVlQnVja2V0cyA9IF9sb2Rhc2guZGVmYXVsdC5nZXQobmFtZUJ1Y2tldCwgWydpbmZsdWVuY2VyRmllbGRWYWx1ZXMnLCAnYnVja2V0cyddLCBbXSk7CgogICAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGZpZWxkVmFsdWVCdWNrZXRzLCBmdW5jdGlvbiAodmFsdWVCdWNrZXQpIHsKICAgICAgICAgIHZhciBmaWVsZFZhbHVlUmVzdWx0ID0gewogICAgICAgICAgICBpbmZsdWVuY2VyRmllbGRWYWx1ZTogdmFsdWVCdWNrZXQua2V5LAogICAgICAgICAgICBtYXhBbm9tYWx5U2NvcmU6IHZhbHVlQnVja2V0Lm1heEFub21hbHlTY29yZS52YWx1ZSwKICAgICAgICAgICAgc3VtQW5vbWFseVNjb3JlOiB2YWx1ZUJ1Y2tldC5zdW1Bbm9tYWx5U2NvcmUudmFsdWUKICAgICAgICAgIH07CiAgICAgICAgICBmaWVsZFZhbHVlcy5wdXNoKGZpZWxkVmFsdWVSZXN1bHQpOwogICAgICAgIH0pOwoKICAgICAgICBvYmouaW5mbHVlbmNlcnNbZmllbGROYW1lXSA9IGZpZWxkVmFsdWVzOwogICAgICB9KTsKCiAgICAgIHJlc29sdmUob2JqKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIHJlamVjdChyZXNwKTsKICAgIH0pOwogIH0pOwp9IC8vIE9idGFpbnMgdGhlIHRvcCBpbmZsdWVuY2VyIGZpZWxkIHZhbHVlcywgYnkgbWF4aW11bSBhbm9tYWx5IHNjb3JlLCBmb3IgYQovLyBwYXJ0aWN1bGFyIGluZGV4LCBmaWVsZCBuYW1lIGFuZCBqb2IgSUQocykuCi8vIFBhc3MgYW4gZW1wdHkgYXJyYXkgb3IgWycqJ10gdG8gc2VhcmNoIG92ZXIgYWxsIGpvYiBJRHMuCi8vIFJldHVybmVkIHJlc3BvbnNlIGNvbnRhaW5zIGEgcmVzdWx0cyBwcm9wZXJ0eSwgd2hpY2ggaXMgYW4gYXJyYXkgb2Ygb2JqZWN0cwovLyBjb250YWluaW5nIGluZmx1ZW5jZXJGaWVsZFZhbHVlLCBtYXhBbm9tYWx5U2NvcmUgYW5kIHN1bUFub21hbHlTY29yZSBrZXlzLgoKCmZ1bmN0aW9uIGdldFRvcEluZmx1ZW5jZXJWYWx1ZXMoam9iSWRzLCBpbmZsdWVuY2VyRmllbGROYW1lLCBlYXJsaWVzdE1zLCBsYXRlc3RNcywgbWF4UmVzdWx0cykgewogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICB2YXIgb2JqID0gewogICAgICBzdWNjZXNzOiB0cnVlLAogICAgICByZXN1bHRzOiBbXQogICAgfTsgLy8gQnVpbGQgdGhlIGNyaXRlcmlhIHRvIHVzZSBpbiB0aGUgYm9vbCBmaWx0ZXIgcGFydCBvZiB0aGUgcmVxdWVzdC4KICAgIC8vIEFkZHMgY3JpdGVyaWEgZm9yIHRoZSB0aW1lIHJhbmdlIHBsdXMgYW55IHNwZWNpZmllZCBqb2IgSURzLgoKICAgIHZhciBib29sQ3JpdGVyaWEgPSBbewogICAgICByYW5nZTogewogICAgICAgIHRpbWVzdGFtcDogewogICAgICAgICAgZ3RlOiBlYXJsaWVzdE1zLAogICAgICAgICAgbHRlOiBsYXRlc3RNcywKICAgICAgICAgIGZvcm1hdDogJ2Vwb2NoX21pbGxpcycKICAgICAgICB9CiAgICAgIH0KICAgIH1dOwoKICAgIGlmIChqb2JJZHMgJiYgam9iSWRzLmxlbmd0aCA+IDAgJiYgIShqb2JJZHMubGVuZ3RoID09PSAxICYmIGpvYklkc1swXSA9PT0gJyonKSkgewogICAgICB2YXIgam9iSWRGaWx0ZXJTdHIgPSAnJzsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGpvYklkcywgZnVuY3Rpb24gKGpvYklkLCBpKSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICBqb2JJZEZpbHRlclN0ciArPSAnIE9SICc7CiAgICAgICAgfQoKICAgICAgICBqb2JJZEZpbHRlclN0ciArPSAnam9iX2lkOic7CiAgICAgICAgam9iSWRGaWx0ZXJTdHIgKz0gam9iSWQ7CiAgICAgIH0pOwoKICAgICAgYm9vbENyaXRlcmlhLnB1c2goewogICAgICAgIHF1ZXJ5X3N0cmluZzogewogICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UsCiAgICAgICAgICBxdWVyeTogam9iSWRGaWx0ZXJTdHIKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIF9tbF9hcGlfc2VydmljZS5tbC5lc1NlYXJjaCh7CiAgICAgIGluZGV4OiBfaW5kZXhfcGF0dGVybnMuTUxfUkVTVUxUU19JTkRFWF9QQVRURVJOLAogICAgICBzaXplOiAwLAogICAgICBib2R5OiB7CiAgICAgICAgcXVlcnk6IHsKICAgICAgICAgIGJvb2w6IHsKICAgICAgICAgICAgZmlsdGVyOiBbewogICAgICAgICAgICAgIHF1ZXJ5X3N0cmluZzogewogICAgICAgICAgICAgICAgcXVlcnk6ICJyZXN1bHRfdHlwZTppbmZsdWVuY2VyIEFORCBpbmZsdWVuY2VyX2ZpZWxkX25hbWU6ICIuY29uY2F0KCgwLCBfc3RyaW5nX3V0aWxzLmVzY2FwZUZvckVsYXN0aWNzZWFyY2hRdWVyeSkoaW5mbHVlbmNlckZpZWxkTmFtZSkpLAogICAgICAgICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgICAgICBtdXN0OiBib29sQ3JpdGVyaWEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhZ2dzOiB7CiAgICAgICAgICBpbmZsdWVuY2VyRmllbGRWYWx1ZXM6IHsKICAgICAgICAgICAgdGVybXM6IHsKICAgICAgICAgICAgICBmaWVsZDogJ2luZmx1ZW5jZXJfZmllbGRfdmFsdWUnLAogICAgICAgICAgICAgIHNpemU6IG1heFJlc3VsdHMgIT09IHVuZGVmaW5lZCA/IG1heFJlc3VsdHMgOiAyLAogICAgICAgICAgICAgIG9yZGVyOiB7CiAgICAgICAgICAgICAgICBtYXhBbm9tYWx5U2NvcmU6ICdkZXNjJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWdnczogewogICAgICAgICAgICAgIG1heEFub21hbHlTY29yZTogewogICAgICAgICAgICAgICAgbWF4OiB7CiAgICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5mbHVlbmNlcl9zY29yZScKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHN1bUFub21hbHlTY29yZTogewogICAgICAgICAgICAgICAgc3VtOiB7CiAgICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5mbHVlbmNlcl9zY29yZScKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgdmFyIGJ1Y2tldHMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHJlc3AsIFsnYWdncmVnYXRpb25zJywgJ2luZmx1ZW5jZXJGaWVsZFZhbHVlcycsICdidWNrZXRzJ10sIFtdKTsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGJ1Y2tldHMsIGZ1bmN0aW9uIChidWNrZXQpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gewogICAgICAgICAgaW5mbHVlbmNlckZpZWxkVmFsdWU6IGJ1Y2tldC5rZXksCiAgICAgICAgICBtYXhBbm9tYWx5U2NvcmU6IGJ1Y2tldC5tYXhBbm9tYWx5U2NvcmUudmFsdWUsCiAgICAgICAgICBzdW1Bbm9tYWx5U2NvcmU6IGJ1Y2tldC5zdW1Bbm9tYWx5U2NvcmUudmFsdWUKICAgICAgICB9OwogICAgICAgIG9iai5yZXN1bHRzLnB1c2gocmVzdWx0KTsKICAgICAgfSk7CgogICAgICByZXNvbHZlKG9iaik7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVzcCkgewogICAgICByZWplY3QocmVzcCk7CiAgICB9KTsKICB9KTsKfSAvLyBPYnRhaW5zIHRoZSBvdmVyYWxsIGJ1Y2tldCBzY29yZXMgZm9yIHRoZSBzcGVjaWZpZWQgam9iIElEKHMpLgovLyBQYXNzIFsnKiddIHRvIHNlYXJjaCBvdmVyIGFsbCBqb2IgSURzLgovLyBSZXR1cm5lZCByZXNwb25zZSBjb250YWlucyBhIHJlc3VsdHMgcHJvcGVydHkgYXMgYW4gb2JqZWN0IG9mIG1heCBzY29yZSBieSB0aW1lLgoKCmZ1bmN0aW9uIGdldE92ZXJhbGxCdWNrZXRTY29yZXMoam9iSWRzLCB0b3BOLCBlYXJsaWVzdE1zLCBsYXRlc3RNcywgaW50ZXJ2YWwpIHsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgdmFyIG9iaiA9IHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAgcmVzdWx0czoge30KICAgIH07CgogICAgX21sX2FwaV9zZXJ2aWNlLm1sLm92ZXJhbGxCdWNrZXRzKHsKICAgICAgam9iSWQ6IGpvYklkcywKICAgICAgdG9wTjogdG9wTiwKICAgICAgYnVja2V0U3BhbjogaW50ZXJ2YWwsCiAgICAgIHN0YXJ0OiBlYXJsaWVzdE1zLAogICAgICBlbmQ6IGxhdGVzdE1zCiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIHZhciBkYXRhQnlUaW1lID0gX2xvZGFzaC5kZWZhdWx0LmdldChyZXNwLCBbJ292ZXJhbGxfYnVja2V0cyddLCBbXSk7CgogICAgICBfbG9kYXNoLmRlZmF1bHQuZWFjaChkYXRhQnlUaW1lLCBmdW5jdGlvbiAoZGF0YUZvclRpbWUpIHsKICAgICAgICB2YXIgdmFsdWUgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KGRhdGFGb3JUaW1lLCBbJ292ZXJhbGxfc2NvcmUnXSk7CgogICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvYmoucmVzdWx0c1tkYXRhRm9yVGltZS50aW1lc3RhbXBdID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHJlc29sdmUob2JqKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIHJlamVjdChyZXNwKTsKICAgIH0pOwogIH0pOwp9IC8vIE9idGFpbnMgdGhlIG1heGltdW0gc2NvcmUgYnkgaW5mbHVlbmNlcl9maWVsZF92YWx1ZSBhbmQgYnkgdGltZSBmb3IgdGhlIHNwZWNpZmllZCBqb2IgSUQocykKLy8gKHBhc3MgYW4gZW1wdHkgYXJyYXkgb3IgWycqJ10gdG8gc2VhcmNoIG92ZXIgYWxsIGpvYiBJRHMpLCBhbmQgc3BlY2lmaWVkIGluZmx1ZW5jZXIgZmllbGQKLy8gdmFsdWVzIChwYXNzIGFuIGVtcHR5IGFycmF5IHRvIHNlYXJjaCBvdmVyIGFsbCBmaWVsZCB2YWx1ZXMpLgovLyBSZXR1cm5lZCByZXNwb25zZSBjb250YWlucyBhIHJlc3VsdHMgcHJvcGVydHkgd2l0aCBpbmZsdWVuY2VyIGZpZWxkIHZhbHVlcyBrZXllZAovLyBhZ2FpbnN0IG1heCBzY29yZSBieSB0aW1lLgoKCmZ1bmN0aW9uIGdldEluZmx1ZW5jZXJWYWx1ZU1heFNjb3JlQnlUaW1lKGpvYklkcywgaW5mbHVlbmNlckZpZWxkTmFtZSwgaW5mbHVlbmNlckZpZWxkVmFsdWVzLCBlYXJsaWVzdE1zLCBsYXRlc3RNcywgaW50ZXJ2YWwsIG1heFJlc3VsdHMsIGluZmx1ZW5jZXJzRmlsdGVyUXVlcnkpIHsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgdmFyIG9iaiA9IHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAgcmVzdWx0czoge30KICAgIH07IC8vIEJ1aWxkIHRoZSBjcml0ZXJpYSB0byB1c2UgaW4gdGhlIGJvb2wgZmlsdGVyIHBhcnQgb2YgdGhlIHJlcXVlc3QuCiAgICAvLyBBZGRzIGNyaXRlcmlhIGZvciB0aGUgdGltZSByYW5nZSBwbHVzIGFueSBzcGVjaWZpZWQgam9iIElEcy4KCiAgICB2YXIgYm9vbENyaXRlcmlhID0gW3sKICAgICAgcmFuZ2U6IHsKICAgICAgICB0aW1lc3RhbXA6IHsKICAgICAgICAgIGd0ZTogZWFybGllc3RNcywKICAgICAgICAgIGx0ZTogbGF0ZXN0TXMsCiAgICAgICAgICBmb3JtYXQ6ICdlcG9jaF9taWxsaXMnCiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIHJhbmdlOiB7CiAgICAgICAgaW5mbHVlbmNlcl9zY29yZTogewogICAgICAgICAgZ3Q6IDAKICAgICAgICB9CiAgICAgIH0KICAgIH1dOwoKICAgIGlmIChqb2JJZHMgJiYgam9iSWRzLmxlbmd0aCA+IDAgJiYgIShqb2JJZHMubGVuZ3RoID09PSAxICYmIGpvYklkc1swXSA9PT0gJyonKSkgewogICAgICB2YXIgam9iSWRGaWx0ZXJTdHIgPSAnJzsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGpvYklkcywgZnVuY3Rpb24gKGpvYklkLCBpKSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICBqb2JJZEZpbHRlclN0ciArPSAnIE9SICc7CiAgICAgICAgfQoKICAgICAgICBqb2JJZEZpbHRlclN0ciArPSAiam9iX2lkOiIuY29uY2F0KGpvYklkKTsKICAgICAgfSk7CgogICAgICBib29sQ3JpdGVyaWEucHVzaCh7CiAgICAgICAgcXVlcnlfc3RyaW5nOiB7CiAgICAgICAgICBhbmFseXplX3dpbGRjYXJkOiBmYWxzZSwKICAgICAgICAgIHF1ZXJ5OiBqb2JJZEZpbHRlclN0cgogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgaWYgKGluZmx1ZW5jZXJzRmlsdGVyUXVlcnkgIT09IHVuZGVmaW5lZCkgewogICAgICBib29sQ3JpdGVyaWEucHVzaChpbmZsdWVuY2Vyc0ZpbHRlclF1ZXJ5KTsKICAgIH0KCiAgICBpZiAoaW5mbHVlbmNlckZpZWxkVmFsdWVzICYmIGluZmx1ZW5jZXJGaWVsZFZhbHVlcy5sZW5ndGggPiAwKSB7CiAgICAgIHZhciBpbmZsdWVuY2VyRmlsdGVyU3RyID0gJyc7CgogICAgICBfbG9kYXNoLmRlZmF1bHQuZWFjaChpbmZsdWVuY2VyRmllbGRWYWx1ZXMsIGZ1bmN0aW9uICh2YWx1ZSwgaSkgewogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgaW5mbHVlbmNlckZpbHRlclN0ciArPSAnIE9SICc7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsdWUudHJpbSgpLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGluZmx1ZW5jZXJGaWx0ZXJTdHIgKz0gImluZmx1ZW5jZXJfZmllbGRfdmFsdWU6Ii5jb25jYXQoKDAsIF9zdHJpbmdfdXRpbHMuZXNjYXBlRm9yRWxhc3RpY3NlYXJjaFF1ZXJ5KSh2YWx1ZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBXcmFwIHdoaXRlc3BhY2UgaW5mbHVlbmNlciBmaWVsZCB2YWx1ZXMgaW4gcXVvdGVzIGZvciB0aGUgcXVlcnlfc3RyaW5nIHF1ZXJ5LgogICAgICAgICAgaW5mbHVlbmNlckZpbHRlclN0ciArPSAiaW5mbHVlbmNlcl9maWVsZF92YWx1ZTpcIiIuY29uY2F0KHZhbHVlLCAiXCIiKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgYm9vbENyaXRlcmlhLnB1c2goewogICAgICAgIHF1ZXJ5X3N0cmluZzogewogICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UsCiAgICAgICAgICBxdWVyeTogaW5mbHVlbmNlckZpbHRlclN0cgogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgX21sX2FwaV9zZXJ2aWNlLm1sLmVzU2VhcmNoKHsKICAgICAgaW5kZXg6IF9pbmRleF9wYXR0ZXJucy5NTF9SRVNVTFRTX0lOREVYX1BBVFRFUk4sCiAgICAgIHNpemU6IDAsCiAgICAgIGJvZHk6IHsKICAgICAgICBxdWVyeTogewogICAgICAgICAgYm9vbDogewogICAgICAgICAgICBmaWx0ZXI6IFt7CiAgICAgICAgICAgICAgcXVlcnlfc3RyaW5nOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogInJlc3VsdF90eXBlOmluZmx1ZW5jZXIgQU5EIGluZmx1ZW5jZXJfZmllbGRfbmFtZTogIi5jb25jYXQoKDAsIF9zdHJpbmdfdXRpbHMuZXNjYXBlRm9yRWxhc3RpY3NlYXJjaFF1ZXJ5KShpbmZsdWVuY2VyRmllbGROYW1lKSksCiAgICAgICAgICAgICAgICBhbmFseXplX3dpbGRjYXJkOiBmYWxzZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGJvb2w6IHsKICAgICAgICAgICAgICAgIG11c3Q6IGJvb2xDcml0ZXJpYQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFnZ3M6IHsKICAgICAgICAgIGluZmx1ZW5jZXJGaWVsZFZhbHVlczogewogICAgICAgICAgICB0ZXJtczogewogICAgICAgICAgICAgIGZpZWxkOiAnaW5mbHVlbmNlcl9maWVsZF92YWx1ZScsCiAgICAgICAgICAgICAgc2l6ZTogbWF4UmVzdWx0cyAhPT0gdW5kZWZpbmVkID8gbWF4UmVzdWx0cyA6IDEwLAogICAgICAgICAgICAgIG9yZGVyOiB7CiAgICAgICAgICAgICAgICBtYXhBbm9tYWx5U2NvcmU6ICdkZXNjJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWdnczogewogICAgICAgICAgICAgIG1heEFub21hbHlTY29yZTogewogICAgICAgICAgICAgICAgbWF4OiB7CiAgICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5mbHVlbmNlcl9zY29yZScKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJ5VGltZTogewogICAgICAgICAgICAgICAgZGF0ZV9oaXN0b2dyYW06IHsKICAgICAgICAgICAgICAgICAgZmllbGQ6ICd0aW1lc3RhbXAnLAogICAgICAgICAgICAgICAgICBpbnRlcnZhbDogaW50ZXJ2YWwsCiAgICAgICAgICAgICAgICAgIG1pbl9kb2NfY291bnQ6IDEKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhZ2dzOiB7CiAgICAgICAgICAgICAgICAgIG1heEFub21hbHlTY29yZTogewogICAgICAgICAgICAgICAgICAgIG1heDogewogICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICdpbmZsdWVuY2VyX3Njb3JlJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICB2YXIgZmllbGRWYWx1ZUJ1Y2tldHMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHJlc3AsIFsnYWdncmVnYXRpb25zJywgJ2luZmx1ZW5jZXJGaWVsZFZhbHVlcycsICdidWNrZXRzJ10sIFtdKTsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGZpZWxkVmFsdWVCdWNrZXRzLCBmdW5jdGlvbiAodmFsdWVCdWNrZXQpIHsKICAgICAgICB2YXIgZmllbGRWYWx1ZSA9IHZhbHVlQnVja2V0LmtleTsKICAgICAgICB2YXIgZmllbGRWYWx1ZXMgPSB7fTsKCiAgICAgICAgdmFyIHRpbWVCdWNrZXRzID0gX2xvZGFzaC5kZWZhdWx0LmdldCh2YWx1ZUJ1Y2tldCwgWydieVRpbWUnLCAnYnVja2V0cyddLCBbXSk7CgogICAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKHRpbWVCdWNrZXRzLCBmdW5jdGlvbiAodGltZUJ1Y2tldCkgewogICAgICAgICAgdmFyIHRpbWUgPSB0aW1lQnVja2V0LmtleTsKICAgICAgICAgIHZhciBzY29yZSA9IHRpbWVCdWNrZXQubWF4QW5vbWFseVNjb3JlLnZhbHVlOwogICAgICAgICAgZmllbGRWYWx1ZXNbdGltZV0gPSBzY29yZTsKICAgICAgICB9KTsKCiAgICAgICAgb2JqLnJlc3VsdHNbZmllbGRWYWx1ZV0gPSBmaWVsZFZhbHVlczsKICAgICAgfSk7CgogICAgICByZXNvbHZlKG9iaik7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVzcCkgewogICAgICByZWplY3QocmVzcCk7CiAgICB9KTsKICB9KTsKfSAvLyBRdWVyaWVzIEVsYXN0aWNzZWFyY2ggdG8gb2J0YWluIHJlY29yZCBsZXZlbCByZXN1bHRzIGNvbnRhaW5pbmcgdGhlIGluZmx1ZW5jZXJzCi8vIGZvciB0aGUgc3BlY2lmaWVkIGpvYihzKSwgcmVjb3JkIHNjb3JlIHRocmVzaG9sZCwgYW5kIHRpbWUgcmFuZ2UuCi8vIFBhc3MgYW4gZW1wdHkgYXJyYXkgb3IgWycqJ10gdG8gc2VhcmNoIG92ZXIgYWxsIGpvYiBJRHMuCi8vIFJldHVybmVkIHJlc3BvbnNlIGNvbnRhaW5zIGEgcmVjb3JkcyBwcm9wZXJ0eSwgd2l0aCBlYWNoIHJlY29yZCBjb250YWluaW5nCi8vIG9ubHkgdGhlIGZpZWxkcyBqb2JfaWQsIGRldGVjdG9yX2luZGV4LCByZWNvcmRfc2NvcmUgYW5kIGluZmx1ZW5jZXJzLgoKCmZ1bmN0aW9uIGdldFJlY29yZEluZmx1ZW5jZXJzKGpvYklkcywgdGhyZXNob2xkLCBlYXJsaWVzdE1zLCBsYXRlc3RNcywgbWF4UmVzdWx0cykgewogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICB2YXIgb2JqID0gewogICAgICBzdWNjZXNzOiB0cnVlLAogICAgICByZWNvcmRzOiBbXQogICAgfTsgLy8gQnVpbGQgdGhlIGNyaXRlcmlhIHRvIHVzZSBpbiB0aGUgYm9vbCBmaWx0ZXIgcGFydCBvZiB0aGUgcmVxdWVzdC4KICAgIC8vIEFkZHMgY3JpdGVyaWEgZm9yIHRoZSBleGlzdGVuY2Ugb2YgdGhlIG5lc3RlZCBpbmZsdWVuY2VycyBmaWVsZCwgdGltZSByYW5nZSwKICAgIC8vIHJlY29yZCBzY29yZSwgcGx1cyBhbnkgc3BlY2lmaWVkIGpvYiBJRHMuCgogICAgdmFyIGJvb2xDcml0ZXJpYSA9IFt7CiAgICAgIG5lc3RlZDogewogICAgICAgIHBhdGg6ICdpbmZsdWVuY2VycycsCiAgICAgICAgcXVlcnk6IHsKICAgICAgICAgIGJvb2w6IHsKICAgICAgICAgICAgbXVzdDogW3sKICAgICAgICAgICAgICBleGlzdHM6IHsKICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5mbHVlbmNlcnMnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICByYW5nZTogewogICAgICAgIHRpbWVzdGFtcDogewogICAgICAgICAgZ3RlOiBlYXJsaWVzdE1zLAogICAgICAgICAgbHRlOiBsYXRlc3RNcywKICAgICAgICAgIGZvcm1hdDogJ2Vwb2NoX21pbGxpcycKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAgcmFuZ2U6IHsKICAgICAgICByZWNvcmRfc2NvcmU6IHsKICAgICAgICAgIGd0ZTogdGhyZXNob2xkCiAgICAgICAgfQogICAgICB9CiAgICB9XTsKCiAgICBpZiAoam9iSWRzICYmIGpvYklkcy5sZW5ndGggPiAwICYmICEoam9iSWRzLmxlbmd0aCA9PT0gMSAmJiBqb2JJZHNbMF0gPT09ICcqJykpIHsKICAgICAgdmFyIGpvYklkRmlsdGVyU3RyID0gJyc7CgogICAgICBfbG9kYXNoLmRlZmF1bHQuZWFjaChqb2JJZHMsIGZ1bmN0aW9uIChqb2JJZCwgaSkgewogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgam9iSWRGaWx0ZXJTdHIgKz0gJyBPUiAnOwogICAgICAgIH0KCiAgICAgICAgam9iSWRGaWx0ZXJTdHIgKz0gJ2pvYl9pZDonOwogICAgICAgIGpvYklkRmlsdGVyU3RyICs9IGpvYklkOwogICAgICB9KTsKCiAgICAgIGJvb2xDcml0ZXJpYS5wdXNoKHsKICAgICAgICBxdWVyeV9zdHJpbmc6IHsKICAgICAgICAgIGFuYWx5emVfd2lsZGNhcmQ6IGZhbHNlLAogICAgICAgICAgcXVlcnk6IGpvYklkRmlsdGVyU3RyCiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBfbWxfYXBpX3NlcnZpY2UubWwuZXNTZWFyY2goewogICAgICBpbmRleDogX2luZGV4X3BhdHRlcm5zLk1MX1JFU1VMVFNfSU5ERVhfUEFUVEVSTiwKICAgICAgc2l6ZTogbWF4UmVzdWx0cyAhPT0gdW5kZWZpbmVkID8gbWF4UmVzdWx0cyA6IDEwMCwKICAgICAgcmVzdF90b3RhbF9oaXRzX2FzX2ludDogdHJ1ZSwKICAgICAgYm9keTogewogICAgICAgIF9zb3VyY2U6IFsnam9iX2lkJywgJ2RldGVjdG9yX2luZGV4JywgJ2luZmx1ZW5jZXJzJywgJ3JlY29yZF9zY29yZSddLAogICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgIGZpbHRlcjogW3sKICAgICAgICAgICAgICBxdWVyeV9zdHJpbmc6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiAncmVzdWx0X3R5cGU6cmVjb3JkJywKICAgICAgICAgICAgICAgIGFuYWx5emVfd2lsZGNhcmQ6IGZhbHNlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgYm9vbDogewogICAgICAgICAgICAgICAgbXVzdDogYm9vbENyaXRlcmlhCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc29ydDogW3sKICAgICAgICAgIHJlY29yZF9zY29yZTogewogICAgICAgICAgICBvcmRlcjogJ2Rlc2MnCiAgICAgICAgICB9CiAgICAgICAgfV0KICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICBpZiAocmVzcC5oaXRzLnRvdGFsICE9PSAwKSB7CiAgICAgICAgX2xvZGFzaC5kZWZhdWx0LmVhY2gocmVzcC5oaXRzLmhpdHMsIGZ1bmN0aW9uIChoaXQpIHsKICAgICAgICAgIG9iai5yZWNvcmRzLnB1c2goaGl0Ll9zb3VyY2UpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXNvbHZlKG9iaik7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVzcCkgewogICAgICByZWplY3QocmVzcCk7CiAgICB9KTsKICB9KTsKfSAvLyBRdWVyaWVzIEVsYXN0aWNzZWFyY2ggdG8gb2J0YWluIHRoZSByZWNvcmQgbGV2ZWwgcmVzdWx0cyBjb250YWluaW5nIHRoZSBzcGVjaWZpZWQgaW5mbHVlbmNlcihzKSwKLy8gZm9yIHRoZSBzcGVjaWZpZWQgam9iKHMpLCB0aW1lIHJhbmdlLCBhbmQgcmVjb3JkIHNjb3JlIHRocmVzaG9sZC4KLy8gaW5mbHVlbmNlcnMgcGFyYW1ldGVyIG11c3QgYmUgYW4gYXJyYXksIHdpdGggZWFjaCBvYmplY3QgaW4gdGhlIGFycmF5IGhhdmluZyAnZmllbGROYW1lJwovLyAnZmllbGRWYWx1ZScgcHJvcGVydGllcy4gVGhlIGluZmx1ZW5jZXIgYXJyYXkgdXNlcyAnc2hvdWxkJyBmb3IgdGhlIG5lc3RlZCBib29sIHF1ZXJ5LAovLyBzbyB0aGlzIHJldHVybnMgcmVjb3JkIGxldmVsIHJlc3VsdHMgd2hpY2ggaGF2ZSBhdCBsZWFzdCBvbmUgb2YgdGhlIGluZmx1ZW5jZXJzLgovLyBQYXNzIGFuIGVtcHR5IGFycmF5IG9yIFsnKiddIHRvIHNlYXJjaCBvdmVyIGFsbCBqb2IgSURzLgoKCmZ1bmN0aW9uIGdldFJlY29yZHNGb3JJbmZsdWVuY2VyKGpvYklkcywgaW5mbHVlbmNlcnMsIHRocmVzaG9sZCwgZWFybGllc3RNcywgbGF0ZXN0TXMsIG1heFJlc3VsdHMsIGluZmx1ZW5jZXJzRmlsdGVyUXVlcnkpIHsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgdmFyIG9iaiA9IHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAgcmVjb3JkczogW10KICAgIH07IC8vIEJ1aWxkIHRoZSBjcml0ZXJpYSB0byB1c2UgaW4gdGhlIGJvb2wgZmlsdGVyIHBhcnQgb2YgdGhlIHJlcXVlc3QuCiAgICAvLyBBZGQgY3JpdGVyaWEgZm9yIHRoZSB0aW1lIHJhbmdlLCByZWNvcmQgc2NvcmUsIHBsdXMgYW55IHNwZWNpZmllZCBqb2IgSURzLgoKICAgIHZhciBib29sQ3JpdGVyaWEgPSBbewogICAgICByYW5nZTogewogICAgICAgIHRpbWVzdGFtcDogewogICAgICAgICAgZ3RlOiBlYXJsaWVzdE1zLAogICAgICAgICAgbHRlOiBsYXRlc3RNcywKICAgICAgICAgIGZvcm1hdDogJ2Vwb2NoX21pbGxpcycKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAgcmFuZ2U6IHsKICAgICAgICByZWNvcmRfc2NvcmU6IHsKICAgICAgICAgIGd0ZTogdGhyZXNob2xkCiAgICAgICAgfQogICAgICB9CiAgICB9XTsKCiAgICBpZiAoam9iSWRzICYmIGpvYklkcy5sZW5ndGggPiAwICYmICEoam9iSWRzLmxlbmd0aCA9PT0gMSAmJiBqb2JJZHNbMF0gPT09ICcqJykpIHsKICAgICAgdmFyIGpvYklkRmlsdGVyU3RyID0gJyc7CgogICAgICBfbG9kYXNoLmRlZmF1bHQuZWFjaChqb2JJZHMsIGZ1bmN0aW9uIChqb2JJZCwgaSkgewogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgam9iSWRGaWx0ZXJTdHIgKz0gJyBPUiAnOwogICAgICAgIH0KCiAgICAgICAgam9iSWRGaWx0ZXJTdHIgKz0gJ2pvYl9pZDonOwogICAgICAgIGpvYklkRmlsdGVyU3RyICs9IGpvYklkOwogICAgICB9KTsKCiAgICAgIGJvb2xDcml0ZXJpYS5wdXNoKHsKICAgICAgICBxdWVyeV9zdHJpbmc6IHsKICAgICAgICAgIGFuYWx5emVfd2lsZGNhcmQ6IGZhbHNlLAogICAgICAgICAgcXVlcnk6IGpvYklkRmlsdGVyU3RyCiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBpZiAoaW5mbHVlbmNlcnNGaWx0ZXJRdWVyeSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvb2xDcml0ZXJpYS5wdXNoKGluZmx1ZW5jZXJzRmlsdGVyUXVlcnkpOwogICAgfSAvLyBBZGQgYSBuZXN0ZWQgcXVlcnkgdG8gZmlsdGVyIGZvciBlYWNoIG9mIHRoZSBzcGVjaWZpZWQgaW5mbHVlbmNlcnMuCgoKICAgIGlmIChpbmZsdWVuY2Vycy5sZW5ndGggPiAwKSB7CiAgICAgIGJvb2xDcml0ZXJpYS5wdXNoKHsKICAgICAgICBib29sOiB7CiAgICAgICAgICBzaG91bGQ6IGluZmx1ZW5jZXJzLm1hcChmdW5jdGlvbiAoaW5mbHVlbmNlcikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG5lc3RlZDogewogICAgICAgICAgICAgICAgcGF0aDogJ2luZmx1ZW5jZXJzJywKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGJvb2w6IHsKICAgICAgICAgICAgICAgICAgICBtdXN0OiBbewogICAgICAgICAgICAgICAgICAgICAgbWF0Y2g6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2luZmx1ZW5jZXJzLmluZmx1ZW5jZXJfZmllbGRfbmFtZSc6IGluZmx1ZW5jZXIuZmllbGROYW1lCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgbWF0Y2g6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2luZmx1ZW5jZXJzLmluZmx1ZW5jZXJfZmllbGRfdmFsdWVzJzogaW5mbHVlbmNlci5maWVsZFZhbHVlCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0pLAogICAgICAgICAgbWluaW11bV9zaG91bGRfbWF0Y2g6IDEKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIF9tbF9hcGlfc2VydmljZS5tbC5lc1NlYXJjaCh7CiAgICAgIGluZGV4OiBfaW5kZXhfcGF0dGVybnMuTUxfUkVTVUxUU19JTkRFWF9QQVRURVJOLAogICAgICBzaXplOiBtYXhSZXN1bHRzICE9PSB1bmRlZmluZWQgPyBtYXhSZXN1bHRzIDogMTAwLAogICAgICByZXN0X3RvdGFsX2hpdHNfYXNfaW50OiB0cnVlLAogICAgICBib2R5OiB7CiAgICAgICAgcXVlcnk6IHsKICAgICAgICAgIGJvb2w6IHsKICAgICAgICAgICAgZmlsdGVyOiBbewogICAgICAgICAgICAgIHF1ZXJ5X3N0cmluZzogewogICAgICAgICAgICAgICAgcXVlcnk6ICdyZXN1bHRfdHlwZTpyZWNvcmQnLAogICAgICAgICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgICAgICBtdXN0OiBib29sQ3JpdGVyaWEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzb3J0OiBbewogICAgICAgICAgcmVjb3JkX3Njb3JlOiB7CiAgICAgICAgICAgIG9yZGVyOiAnZGVzYycKICAgICAgICAgIH0KICAgICAgICB9XQogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIGlmIChyZXNwLmhpdHMudG90YWwgIT09IDApIHsKICAgICAgICBfbG9kYXNoLmRlZmF1bHQuZWFjaChyZXNwLmhpdHMuaGl0cywgZnVuY3Rpb24gKGhpdCkgewogICAgICAgICAgb2JqLnJlY29yZHMucHVzaChoaXQuX3NvdXJjZSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJlc29sdmUob2JqKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIHJlamVjdChyZXNwKTsKICAgIH0pOwogIH0pOwp9IC8vIFF1ZXJpZXMgRWxhc3RpY3NlYXJjaCB0byBvYnRhaW4gdGhlIHJlY29yZCBsZXZlbCByZXN1bHRzIGZvciB0aGUgc3BlY2lmaWVkIGpvYiBhbmQgZGV0ZWN0b3IsCi8vIHRpbWUgcmFuZ2UsIHJlY29yZCBzY29yZSB0aHJlc2hvbGQsIGFuZCB3aGV0aGVyIHRvIG9ubHkgcmV0dXJuIHJlc3VsdHMgY29udGFpbmluZyBpbmZsdWVuY2Vycy4KLy8gQW4gYWRkaXRpb25hbCwgb3B0aW9uYWwgaW5mbHVlbmNlciBmaWVsZCBuYW1lIGFuZCB2YWx1ZSBtYXkgYWxzbyBiZSBwcm92aWRlZC4KCgpmdW5jdGlvbiBnZXRSZWNvcmRzRm9yRGV0ZWN0b3Ioam9iSWQsIGRldGVjdG9ySW5kZXgsIGNoZWNrRm9ySW5mbHVlbmNlcnMsIGluZmx1ZW5jZXJGaWVsZE5hbWUsIGluZmx1ZW5jZXJGaWVsZFZhbHVlLCB0aHJlc2hvbGQsIGVhcmxpZXN0TXMsIGxhdGVzdE1zLCBtYXhSZXN1bHRzKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIHZhciBvYmogPSB7CiAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgIHJlY29yZHM6IFtdCiAgICB9OyAvLyBCdWlsZCB0aGUgY3JpdGVyaWEgdG8gdXNlIGluIHRoZSBib29sIGZpbHRlciBwYXJ0IG9mIHRoZSByZXF1ZXN0LgogICAgLy8gQWRkIGNyaXRlcmlhIGZvciB0aGUgdGltZSByYW5nZSwgcmVjb3JkIHNjb3JlLCBwbHVzIGFueSBzcGVjaWZpZWQgam9iIElEcy4KCiAgICB2YXIgYm9vbENyaXRlcmlhID0gW3sKICAgICAgcmFuZ2U6IHsKICAgICAgICB0aW1lc3RhbXA6IHsKICAgICAgICAgIGd0ZTogZWFybGllc3RNcywKICAgICAgICAgIGx0ZTogbGF0ZXN0TXMsCiAgICAgICAgICBmb3JtYXQ6ICdlcG9jaF9taWxsaXMnCiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIHRlcm06IHsKICAgICAgICBqb2JfaWQ6IGpvYklkCiAgICAgIH0KICAgIH0sIHsKICAgICAgdGVybTogewogICAgICAgIGRldGVjdG9yX2luZGV4OiBkZXRlY3RvckluZGV4CiAgICAgIH0KICAgIH0sIHsKICAgICAgcmFuZ2U6IHsKICAgICAgICByZWNvcmRfc2NvcmU6IHsKICAgICAgICAgIGd0ZTogdGhyZXNob2xkCiAgICAgICAgfQogICAgICB9CiAgICB9XTsgLy8gQWRkIGEgbmVzdGVkIHF1ZXJ5IHRvIGZpbHRlciBmb3IgdGhlIHNwZWNpZmllZCBpbmZsdWVuY2VyIGZpZWxkIG5hbWUgYW5kIHZhbHVlLgoKICAgIGlmIChpbmZsdWVuY2VyRmllbGROYW1lICYmIGluZmx1ZW5jZXJGaWVsZFZhbHVlKSB7CiAgICAgIGJvb2xDcml0ZXJpYS5wdXNoKHsKICAgICAgICBuZXN0ZWQ6IHsKICAgICAgICAgIHBhdGg6ICdpbmZsdWVuY2VycycsCiAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgICAgbXVzdDogW3sKICAgICAgICAgICAgICAgIG1hdGNoOiB7CiAgICAgICAgICAgICAgICAgICdpbmZsdWVuY2Vycy5pbmZsdWVuY2VyX2ZpZWxkX25hbWUnOiBpbmZsdWVuY2VyRmllbGROYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbWF0Y2g6IHsKICAgICAgICAgICAgICAgICAgJ2luZmx1ZW5jZXJzLmluZmx1ZW5jZXJfZmllbGRfdmFsdWVzJzogaW5mbHVlbmNlckZpZWxkVmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChjaGVja0ZvckluZmx1ZW5jZXJzID09PSB0cnVlKSB7CiAgICAgICAgYm9vbENyaXRlcmlhLnB1c2goewogICAgICAgICAgbmVzdGVkOiB7CiAgICAgICAgICAgIHBhdGg6ICdpbmZsdWVuY2VycycsCiAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgYm9vbDogewogICAgICAgICAgICAgICAgbXVzdDogW3sKICAgICAgICAgICAgICAgICAgZXhpc3RzOiB7CiAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICdpbmZsdWVuY2VycycKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIF9tbF9hcGlfc2VydmljZS5tbC5lc1NlYXJjaCh7CiAgICAgIGluZGV4OiBfaW5kZXhfcGF0dGVybnMuTUxfUkVTVUxUU19JTkRFWF9QQVRURVJOLAogICAgICBzaXplOiBtYXhSZXN1bHRzICE9PSB1bmRlZmluZWQgPyBtYXhSZXN1bHRzIDogMTAwLAogICAgICByZXN0X3RvdGFsX2hpdHNfYXNfaW50OiB0cnVlLAogICAgICBib2R5OiB7CiAgICAgICAgcXVlcnk6IHsKICAgICAgICAgIGJvb2w6IHsKICAgICAgICAgICAgZmlsdGVyOiBbewogICAgICAgICAgICAgIHF1ZXJ5X3N0cmluZzogewogICAgICAgICAgICAgICAgcXVlcnk6ICdyZXN1bHRfdHlwZTpyZWNvcmQnLAogICAgICAgICAgICAgICAgYW5hbHl6ZV93aWxkY2FyZDogZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgICAgICBtdXN0OiBib29sQ3JpdGVyaWEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzb3J0OiBbewogICAgICAgICAgcmVjb3JkX3Njb3JlOiB7CiAgICAgICAgICAgIG9yZGVyOiAnZGVzYycKICAgICAgICAgIH0KICAgICAgICB9XQogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIGlmIChyZXNwLmhpdHMudG90YWwgIT09IDApIHsKICAgICAgICBfbG9kYXNoLmRlZmF1bHQuZWFjaChyZXNwLmhpdHMuaGl0cywgZnVuY3Rpb24gKGhpdCkgewogICAgICAgICAgb2JqLnJlY29yZHMucHVzaChoaXQuX3NvdXJjZSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJlc29sdmUob2JqKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIHJlamVjdChyZXNwKTsKICAgIH0pOwogIH0pOwp9IC8vIFF1ZXJpZXMgRWxhc3RpY3NlYXJjaCB0byBvYnRhaW4gYWxsIHRoZSByZWNvcmQgbGV2ZWwgcmVzdWx0cyBmb3IgdGhlIHNwZWNpZmllZCBqb2IocyksIHRpbWUgcmFuZ2UsCi8vIGFuZCByZWNvcmQgc2NvcmUgdGhyZXNob2xkLgovLyBQYXNzIGFuIGVtcHR5IGFycmF5IG9yIFsnKiddIHRvIHNlYXJjaCBvdmVyIGFsbCBqb2IgSURzLgovLyBSZXR1cm5lZCByZXNwb25zZSBjb250YWlucyBhIHJlY29yZHMgcHJvcGVydHksIHdoaWNoIGlzIGFuIGFycmF5IG9mIHRoZSBtYXRjaGluZyByZXN1bHRzLgoKCmZ1bmN0aW9uIGdldFJlY29yZHMoam9iSWRzLCB0aHJlc2hvbGQsIGVhcmxpZXN0TXMsIGxhdGVzdE1zLCBtYXhSZXN1bHRzKSB7CiAgcmV0dXJuIHRoaXMuZ2V0UmVjb3Jkc0ZvckluZmx1ZW5jZXIoam9iSWRzLCBbXSwgdGhyZXNob2xkLCBlYXJsaWVzdE1zLCBsYXRlc3RNcywgbWF4UmVzdWx0cyk7Cn0gLy8gUXVlcmllcyBFbGFzdGljc2VhcmNoIHRvIG9idGFpbiBldmVudCByYXRlIGRhdGEgaS5lLiB0aGUgY291bnQKLy8gb2YgZG9jdW1lbnRzIG92ZXIgdGltZS4KLy8gaW5kZXggY2FuIGJlIGEgU3RyaW5nLCBvciBTdHJpbmdbXSwgb2YgaW5kZXggbmFtZXMgdG8gc2VhcmNoLgovLyBFeHRyYSBxdWVyeSBvYmplY3QgY2FuIGJlIHN1cHBsaWVkLCBvciBwYXNzIG51bGwgaWYgbm8gYWRkaXRpb25hbCBxdWVyeS4KLy8gUmV0dXJuZWQgcmVzcG9uc2UgY29udGFpbnMgYSByZXN1bHRzIHByb3BlcnR5LCB3aGljaCBpcyBhbiBvYmplY3QKLy8gb2YgZG9jdW1lbnQgY291bnRzIGFnYWluc3QgdGltZSAoZXBvY2ggbWlsbGlzKS4KCgpmdW5jdGlvbiBnZXRFdmVudFJhdGVEYXRhKGluZGV4LCBxdWVyeSwgdGltZUZpZWxkTmFtZSwgZWFybGllc3RNcywgbGF0ZXN0TXMsIGludGVydmFsKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIHZhciBvYmogPSB7CiAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgIHJlc3VsdHM6IHt9CiAgICB9OyAvLyBCdWlsZCB0aGUgY3JpdGVyaWEgdG8gdXNlIGluIHRoZSBib29sIGZpbHRlciBwYXJ0IG9mIHRoZSByZXF1ZXN0LgogICAgLy8gQWRkIGNyaXRlcmlhIGZvciB0aGUgdGltZSByYW5nZSwgZW50aXR5IGZpZWxkcywKICAgIC8vIHBsdXMgYW55IGFkZGl0aW9uYWwgc3VwcGxpZWQgcXVlcnkuCgogICAgdmFyIG11c3RDcml0ZXJpYSA9IFt7CiAgICAgIHJhbmdlOiBfZGVmaW5lUHJvcGVydHkoe30sIHRpbWVGaWVsZE5hbWUsIHsKICAgICAgICBndGU6IGVhcmxpZXN0TXMsCiAgICAgICAgbHRlOiBsYXRlc3RNcywKICAgICAgICBmb3JtYXQ6ICdlcG9jaF9taWxsaXMnCiAgICAgIH0pCiAgICB9XTsKCiAgICBpZiAocXVlcnkpIHsKICAgICAgbXVzdENyaXRlcmlhLnB1c2gocXVlcnkpOwogICAgfQoKICAgIF9tbF9hcGlfc2VydmljZS5tbC5lc1NlYXJjaCh7CiAgICAgIGluZGV4OiBpbmRleCwKICAgICAgcmVzdF90b3RhbF9oaXRzX2FzX2ludDogdHJ1ZSwKICAgICAgc2l6ZTogMCwKICAgICAgYm9keTogewogICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgIG11c3Q6IG11c3RDcml0ZXJpYQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgX3NvdXJjZTogewogICAgICAgICAgZXhjbHVkZXM6IFtdCiAgICAgICAgfSwKICAgICAgICBhZ2dzOiB7CiAgICAgICAgICBldmVudFJhdGU6IHsKICAgICAgICAgICAgZGF0ZV9oaXN0b2dyYW06IHsKICAgICAgICAgICAgICBmaWVsZDogdGltZUZpZWxkTmFtZSwKICAgICAgICAgICAgICBpbnRlcnZhbDogaW50ZXJ2YWwsCiAgICAgICAgICAgICAgbWluX2RvY19jb3VudDogMCwKICAgICAgICAgICAgICBleHRlbmRlZF9ib3VuZHM6IHsKICAgICAgICAgICAgICAgIG1pbjogZWFybGllc3RNcywKICAgICAgICAgICAgICAgIG1heDogbGF0ZXN0TXMKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgdmFyIGRhdGFCeVRpbWVCdWNrZXQgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHJlc3AsIFsnYWdncmVnYXRpb25zJywgJ2V2ZW50UmF0ZScsICdidWNrZXRzJ10sIFtdKTsKCiAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGRhdGFCeVRpbWVCdWNrZXQsIGZ1bmN0aW9uIChkYXRhRm9yVGltZSkgewogICAgICAgIHZhciB0aW1lID0gZGF0YUZvclRpbWUua2V5OwogICAgICAgIG9iai5yZXN1bHRzW3RpbWVdID0gZGF0YUZvclRpbWUuZG9jX2NvdW50OwogICAgICB9KTsKCiAgICAgIG9iai50b3RhbCA9IHJlc3AuaGl0cy50b3RhbDsKICAgICAgcmVzb2x2ZShvYmopOwogICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgcmVqZWN0KHJlc3ApOwogICAgfSk7CiAgfSk7Cn0gLy8gUXVlcmllcyBFbGFzdGljc2VhcmNoIHRvIG9idGFpbiBldmVudCBkaXN0cmlidXRpb24gaS5lLiB0aGUgY291bnQKLy8gb2YgZW50aXRpZXMgb3ZlciB0aW1lLgovLyBpbmRleCBjYW4gYmUgYSBTdHJpbmcsIG9yIFN0cmluZ1tdLCBvZiBpbmRleCBuYW1lcyB0byBzZWFyY2guCi8vIEV4dHJhIHF1ZXJ5IG9iamVjdCBjYW4gYmUgc3VwcGxpZWQsIG9yIHBhc3MgbnVsbCBpZiBubyBhZGRpdGlvbmFsIHF1ZXJ5LgovLyBSZXR1cm5lZCByZXNwb25zZSBjb250YWlucyBhIHJlc3VsdHMgcHJvcGVydHksIHdoaWNoIGlzIGFuIG9iamVjdAovLyBvZiBkb2N1bWVudCBjb3VudHMgYWdhaW5zdCB0aW1lIChlcG9jaCBtaWxsaXMpLgoKCnZhciBTQU1QTEVSX1RPUF9URVJNU19TSEFSRF9TSVpFID0gMjAwMDA7CnZhciBFTlRJVFlfQUdHUkVHQVRJT05fU0laRSA9IDEwOwp2YXIgQUdHUkVHQVRJT05fTUlOX0RPQ19DT1VOVCA9IDE7CnZhciBDQVJESU5BTElUWV9QUkVDSVNJT05fVEhSRVNIT0xEID0gMTAwOwoKZnVuY3Rpb24gZ2V0RXZlbnREaXN0cmlidXRpb25EYXRhKGluZGV4LCBzcGxpdEZpZWxkKSB7CiAgdmFyIGZpbHRlckZpZWxkID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBudWxsOwogIHZhciBxdWVyeSA9IGFyZ3VtZW50cy5sZW5ndGggPiAzID8gYXJndW1lbnRzWzNdIDogdW5kZWZpbmVkOwogIHZhciBtZXRyaWNGdW5jdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ID8gYXJndW1lbnRzWzRdIDogdW5kZWZpbmVkOwogIHZhciAvLyBFUyBhZ2dyZWdhdGlvbiBuYW1lCiAgbWV0cmljRmllbGROYW1lID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgPyBhcmd1bWVudHNbNV0gOiB1bmRlZmluZWQ7CiAgdmFyIHRpbWVGaWVsZE5hbWUgPSBhcmd1bWVudHMubGVuZ3RoID4gNiA/IGFyZ3VtZW50c1s2XSA6IHVuZGVmaW5lZDsKICB2YXIgZWFybGllc3RNcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA3ID8gYXJndW1lbnRzWzddIDogdW5kZWZpbmVkOwogIHZhciBsYXRlc3RNcyA9IGFyZ3VtZW50cy5sZW5ndGggPiA4ID8gYXJndW1lbnRzWzhdIDogdW5kZWZpbmVkOwogIHZhciBpbnRlcnZhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiA5ID8gYXJndW1lbnRzWzldIDogdW5kZWZpbmVkOwogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICBpZiAoc3BsaXRGaWVsZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiByZXNvbHZlKFtdKTsKICAgIH0gLy8gQnVpbGQgdGhlIGNyaXRlcmlhIHRvIHVzZSBpbiB0aGUgYm9vbCBmaWx0ZXIgcGFydCBvZiB0aGUgcmVxdWVzdC4KICAgIC8vIEFkZCBjcml0ZXJpYSBmb3IgdGhlIHRpbWUgcmFuZ2UsIGVudGl0eSBmaWVsZHMsCiAgICAvLyBwbHVzIGFueSBhZGRpdGlvbmFsIHN1cHBsaWVkIHF1ZXJ5LgoKCiAgICB2YXIgbXVzdENyaXRlcmlhID0gW107CiAgICBtdXN0Q3JpdGVyaWEucHVzaCh7CiAgICAgIHJhbmdlOiBfZGVmaW5lUHJvcGVydHkoe30sIHRpbWVGaWVsZE5hbWUsIHsKICAgICAgICBndGU6IGVhcmxpZXN0TXMsCiAgICAgICAgbHRlOiBsYXRlc3RNcywKICAgICAgICBmb3JtYXQ6ICdlcG9jaF9taWxsaXMnCiAgICAgIH0pCiAgICB9KTsKCiAgICBpZiAocXVlcnkpIHsKICAgICAgbXVzdENyaXRlcmlhLnB1c2gocXVlcnkpOwogICAgfQoKICAgIGlmIChmaWx0ZXJGaWVsZCAhPT0gbnVsbCkgewogICAgICBtdXN0Q3JpdGVyaWEucHVzaCh7CiAgICAgICAgdGVybTogX2RlZmluZVByb3BlcnR5KHt9LCBmaWx0ZXJGaWVsZC5maWVsZE5hbWUsIGZpbHRlckZpZWxkLmZpZWxkVmFsdWUpCiAgICAgIH0pOwogICAgfQoKICAgIHZhciBib2R5ID0gewogICAgICBxdWVyeTogewogICAgICAgIC8vIHVzaW5nIGZ1bmN0aW9uX3Njb3JlIGFuZCByYW5kb21fc2NvcmUgdG8gZ2V0IGEgcmFuZG9tIHNhbXBsZSBvZiBkb2N1bWVudHMuCiAgICAgICAgLy8gb3RoZXJ3aXNlIGFsbCBkb2N1bWVudHMgd291bGQgaGF2ZSB0aGUgc2FtZSBzY29yZSBhbmQgdGhlIHNhbXBsZXIgYWdncmVnYXRpb24KICAgICAgICAvLyB3b3VsZCBwaWNrIHRoZSBmaXJzdCBOIGRvY3VtZW50cyBpbnN0ZWFkIG9mIGEgcmFuZG9tIHNldC4KICAgICAgICBmdW5jdGlvbl9zY29yZTogewogICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgYm9vbDogewogICAgICAgICAgICAgIG11c3Q6IG11c3RDcml0ZXJpYQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb25zOiBbewogICAgICAgICAgICByYW5kb21fc2NvcmU6IHsKICAgICAgICAgICAgICAvLyBzdGF0aWMgc2VlZCB0byBnZXQgc2FtZSByYW5kb21pemVkIHJlc3VsdHMgb24gZXZlcnkgcmVxdWVzdAogICAgICAgICAgICAgIHNlZWQ6IDEwLAogICAgICAgICAgICAgIGZpZWxkOiAnX3NlcV9ubycKICAgICAgICAgICAgfQogICAgICAgICAgfV0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNpemU6IDAsCiAgICAgIF9zb3VyY2U6IHsKICAgICAgICBleGNsdWRlczogW10KICAgICAgfSwKICAgICAgYWdnczogewogICAgICAgIHNhbXBsZTogewogICAgICAgICAgc2FtcGxlcjogewogICAgICAgICAgICBzaGFyZF9zaXplOiBTQU1QTEVSX1RPUF9URVJNU19TSEFSRF9TSVpFCiAgICAgICAgICB9LAogICAgICAgICAgYWdnczogewogICAgICAgICAgICBieVRpbWU6IHsKICAgICAgICAgICAgICBkYXRlX2hpc3RvZ3JhbTogewogICAgICAgICAgICAgICAgZmllbGQ6IHRpbWVGaWVsZE5hbWUsCiAgICAgICAgICAgICAgICBpbnRlcnZhbDogaW50ZXJ2YWwsCiAgICAgICAgICAgICAgICBtaW5fZG9jX2NvdW50OiBBR0dSRUdBVElPTl9NSU5fRE9DX0NPVU5UCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBhZ2dzOiB7CiAgICAgICAgICAgICAgICBlbnRpdGllczogewogICAgICAgICAgICAgICAgICB0ZXJtczogewogICAgICAgICAgICAgICAgICAgIGZpZWxkOiBzcGxpdEZpZWxkLmZpZWxkTmFtZSwKICAgICAgICAgICAgICAgICAgICBzaXplOiBFTlRJVFlfQUdHUkVHQVRJT05fU0laRSwKICAgICAgICAgICAgICAgICAgICBtaW5fZG9jX2NvdW50OiBBR0dSRUdBVElPTl9NSU5fRE9DX0NPVU5UCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgaWYgKG1ldHJpY0ZpZWxkTmFtZSAhPT0gdW5kZWZpbmVkICYmIG1ldHJpY0ZpZWxkTmFtZSAhPT0gJycpIHsKICAgICAgYm9keS5hZ2dzLnNhbXBsZS5hZ2dzLmJ5VGltZS5hZ2dzLmVudGl0aWVzLmFnZ3MgPSB7fTsKCiAgICAgIHZhciBtZXRyaWNBZ2cgPSBfZGVmaW5lUHJvcGVydHkoe30sIG1ldHJpY0Z1bmN0aW9uLCB7CiAgICAgICAgZmllbGQ6IG1ldHJpY0ZpZWxkTmFtZQogICAgICB9KTsKCiAgICAgIGlmIChtZXRyaWNGdW5jdGlvbiA9PT0gJ3BlcmNlbnRpbGVzJykgewogICAgICAgIG1ldHJpY0FnZ1ttZXRyaWNGdW5jdGlvbl0ucGVyY2VudHMgPSBbX2pvYl91dGlscy5NTF9NRURJQU5fUEVSQ0VOVFNdOwogICAgICB9CgogICAgICBpZiAobWV0cmljRnVuY3Rpb24gPT09ICdjYXJkaW5hbGl0eScpIHsKICAgICAgICBtZXRyaWNBZ2dbbWV0cmljRnVuY3Rpb25dLnByZWNpc2lvbl90aHJlc2hvbGQgPSBDQVJESU5BTElUWV9QUkVDSVNJT05fVEhSRVNIT0xEOwogICAgICB9CgogICAgICBib2R5LmFnZ3Muc2FtcGxlLmFnZ3MuYnlUaW1lLmFnZ3MuZW50aXRpZXMuYWdncy5tZXRyaWMgPSBtZXRyaWNBZ2c7CiAgICB9CgogICAgX21sX2FwaV9zZXJ2aWNlLm1sLmVzU2VhcmNoKHsKICAgICAgaW5kZXg6IGluZGV4LAogICAgICBib2R5OiBib2R5LAogICAgICByZXN0X3RvdGFsX2hpdHNfYXNfaW50OiB0cnVlCiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIC8vIEJlY2F1c2Ugb2YgdGhlIHNhbXBsaW5nLCByZXN1bHRzIG9mIG1ldHJpY0Z1bmN0aW9ucyB3aGljaCB1c2Ugc3VtIG9yIGNvdW50CiAgICAgIC8vIGNhbiBiZSBzaWduaWZpY2FudGx5IHNrZXdlZC4gVGFraW5nIGludG8gYWNjb3VudCB0b3RhbEhpdHMgd2UgY2FsY3VsYXRlIGEKICAgICAgLy8gYSBmYWN0b3IgdG8gbm9ybWFsaXplIHJlc3VsdHMgZm9yIHRoZXNlIG1ldHJpY0Z1bmN0aW9ucy4KICAgICAgdmFyIHRvdGFsSGl0cyA9IF9sb2Rhc2guZGVmYXVsdC5nZXQocmVzcCwgWydoaXRzJywgJ3RvdGFsJ10sIDApOwoKICAgICAgdmFyIHN1Y2Nlc3NmdWxTaGFyZHMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHJlc3AsIFsnX3NoYXJkcycsICdzdWNjZXNzZnVsJ10sIDApOwoKICAgICAgdmFyIG5vcm1hbGl6ZUZhY3RvciA9IDE7CgogICAgICBpZiAodG90YWxIaXRzID4gc3VjY2Vzc2Z1bFNoYXJkcyAqIFNBTVBMRVJfVE9QX1RFUk1TX1NIQVJEX1NJWkUpIHsKICAgICAgICBub3JtYWxpemVGYWN0b3IgPSB0b3RhbEhpdHMgLyAoc3VjY2Vzc2Z1bFNoYXJkcyAqIFNBTVBMRVJfVE9QX1RFUk1TX1NIQVJEX1NJWkUpOwogICAgICB9CgogICAgICB2YXIgZGF0YUJ5VGltZSA9IF9sb2Rhc2guZGVmYXVsdC5nZXQocmVzcCwgWydhZ2dyZWdhdGlvbnMnLCAnc2FtcGxlJywgJ2J5VGltZScsICdidWNrZXRzJ10sIFtdKTsKCiAgICAgIHZhciBkYXRhID0gZGF0YUJ5VGltZS5yZWR1Y2UoZnVuY3Rpb24gKGQsIGRhdGFGb3JUaW1lKSB7CiAgICAgICAgdmFyIGRhdGUgPSArZGF0YUZvclRpbWUua2V5OwoKICAgICAgICB2YXIgZW50aXRpZXMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KGRhdGFGb3JUaW1lLCBbJ2VudGl0aWVzJywgJ2J1Y2tldHMnXSwgW10pOwoKICAgICAgICBlbnRpdGllcy5mb3JFYWNoKGZ1bmN0aW9uIChlbnRpdHkpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IG1ldHJpY0Z1bmN0aW9uID09PSAnY291bnQnID8gZW50aXR5LmRvY19jb3VudCA6IGVudGl0eS5tZXRyaWMudmFsdWU7CgogICAgICAgICAgaWYgKG1ldHJpY0Z1bmN0aW9uID09PSAnY291bnQnIHx8IG1ldHJpY0Z1bmN0aW9uID09PSAnY2FyZGluYWxpdHknIHx8IG1ldHJpY0Z1bmN0aW9uID09PSAnc3VtJykgewogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlICogbm9ybWFsaXplRmFjdG9yOwogICAgICAgICAgfQoKICAgICAgICAgIGQucHVzaCh7CiAgICAgICAgICAgIGRhdGU6IGRhdGUsCiAgICAgICAgICAgIGVudGl0eTogZW50aXR5LmtleSwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZDsKICAgICAgfSwgW10pOwogICAgICByZXNvbHZlKGRhdGEpOwogICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgcmVqZWN0KHJlc3ApOwogICAgfSk7CiAgfSk7Cn0gLy8gUXVlcmllcyBFbGFzdGljc2VhcmNoIHRvIG9idGFpbiB0aGUgbWF4IHJlY29yZCBzY29yZSBvdmVyIHRpbWUgZm9yIHRoZSBzcGVjaWZpZWQgam9iLAovLyBjcml0ZXJpYSwgdGltZSByYW5nZSwgYW5kIGFnZ3JlZ2F0aW9uIGludGVydmFsLgovLyBjcml0ZXJpYUZpZWxkcyBwYXJhbWV0ZXIgbXVzdCBiZSBhbiBhcnJheSwgd2l0aCBlYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkgaGF2aW5nICdmaWVsZE5hbWUnCi8vICdmaWVsZFZhbHVlJyBwcm9wZXJ0aWVzLgoKCmZ1bmN0aW9uIGdldFJlY29yZE1heFNjb3JlQnlUaW1lKGpvYklkLCBjcml0ZXJpYUZpZWxkcywgZWFybGllc3RNcywgbGF0ZXN0TXMsIGludGVydmFsKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIHZhciBvYmogPSB7CiAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgIHJlc3VsdHM6IHt9CiAgICB9OyAvLyBCdWlsZCB0aGUgY3JpdGVyaWEgdG8gdXNlIGluIHRoZSBib29sIGZpbHRlciBwYXJ0IG9mIHRoZSByZXF1ZXN0LgoKICAgIHZhciBtdXN0Q3JpdGVyaWEgPSBbewogICAgICByYW5nZTogewogICAgICAgIHRpbWVzdGFtcDogewogICAgICAgICAgZ3RlOiBlYXJsaWVzdE1zLAogICAgICAgICAgbHRlOiBsYXRlc3RNcywKICAgICAgICAgIGZvcm1hdDogJ2Vwb2NoX21pbGxpcycKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAgdGVybTogewogICAgICAgIGpvYl9pZDogam9iSWQKICAgICAgfQogICAgfV07CiAgICB2YXIgc2hvdWxkQ3JpdGVyaWEgPSBbXTsKCiAgICBfbG9kYXNoLmRlZmF1bHQuZWFjaChjcml0ZXJpYUZpZWxkcywgZnVuY3Rpb24gKGNyaXRlcmlhKSB7CiAgICAgIGlmIChjcml0ZXJpYS5maWVsZFZhbHVlLmxlbmd0aCAhPT0gMCkgewogICAgICAgIG11c3RDcml0ZXJpYS5wdXNoKHsKICAgICAgICAgIHRlcm06IF9kZWZpbmVQcm9wZXJ0eSh7fSwgY3JpdGVyaWEuZmllbGROYW1lLCBjcml0ZXJpYS5maWVsZFZhbHVlKQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEFkZCBzcGVjaWFsIGhhbmRsaW5nIGZvciBibGFuayBlbnRpdHkgZmllbGQgdmFsdWVzLCBjaGVja2luZyBmb3IgZWl0aGVyCiAgICAgICAgLy8gYW4gZW1wdHkgc3RyaW5nIG9yIHRoZSBmaWVsZCBub3QgZXhpc3RpbmcuCiAgICAgICAgdmFyIGVtcHR5RmllbGRDb25kaXRpb24gPSB7CiAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgIG11c3Q6IFt7CiAgICAgICAgICAgICAgdGVybToge30KICAgICAgICAgICAgfV0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGVtcHR5RmllbGRDb25kaXRpb24uYm9vbC5tdXN0WzBdLnRlcm1bY3JpdGVyaWEuZmllbGROYW1lXSA9ICcnOwogICAgICAgIHNob3VsZENyaXRlcmlhLnB1c2goZW1wdHlGaWVsZENvbmRpdGlvbik7CiAgICAgICAgc2hvdWxkQ3JpdGVyaWEucHVzaCh7CiAgICAgICAgICBib29sOiB7CiAgICAgICAgICAgIG11c3Rfbm90OiBbewogICAgICAgICAgICAgIGV4aXN0czogewogICAgICAgICAgICAgICAgZmllbGQ6IGNyaXRlcmlhLmZpZWxkTmFtZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX21sX2FwaV9zZXJ2aWNlLm1sLmVzU2VhcmNoKHsKICAgICAgaW5kZXg6IF9pbmRleF9wYXR0ZXJucy5NTF9SRVNVTFRTX0lOREVYX1BBVFRFUk4sCiAgICAgIHNpemU6IDAsCiAgICAgIGJvZHk6IHsKICAgICAgICBxdWVyeTogewogICAgICAgICAgYm9vbDogewogICAgICAgICAgICBmaWx0ZXI6IFt7CiAgICAgICAgICAgICAgcXVlcnlfc3RyaW5nOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogJ3Jlc3VsdF90eXBlOnJlY29yZCcsCiAgICAgICAgICAgICAgICBhbmFseXplX3dpbGRjYXJkOiB0cnVlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgYm9vbDogewogICAgICAgICAgICAgICAgbXVzdDogbXVzdENyaXRlcmlhCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWdnczogewogICAgICAgICAgdGltZXM6IHsKICAgICAgICAgICAgZGF0ZV9oaXN0b2dyYW06IHsKICAgICAgICAgICAgICBmaWVsZDogJ3RpbWVzdGFtcCcsCiAgICAgICAgICAgICAgaW50ZXJ2YWw6IGludGVydmFsLAogICAgICAgICAgICAgIG1pbl9kb2NfY291bnQ6IDEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWdnczogewogICAgICAgICAgICAgIHJlY29yZFNjb3JlOiB7CiAgICAgICAgICAgICAgICBtYXg6IHsKICAgICAgICAgICAgICAgICAgZmllbGQ6ICdyZWNvcmRfc2NvcmUnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgIHZhciBhZ2dyZWdhdGlvbnNCeVRpbWUgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHJlc3AsIFsnYWdncmVnYXRpb25zJywgJ3RpbWVzJywgJ2J1Y2tldHMnXSwgW10pOwoKICAgICAgX2xvZGFzaC5kZWZhdWx0LmVhY2goYWdncmVnYXRpb25zQnlUaW1lLCBmdW5jdGlvbiAoZGF0YUZvclRpbWUpIHsKICAgICAgICB2YXIgdGltZSA9IGRhdGFGb3JUaW1lLmtleTsKICAgICAgICBvYmoucmVzdWx0c1t0aW1lXSA9IHsKICAgICAgICAgIHNjb3JlOiBfbG9kYXNoLmRlZmF1bHQuZ2V0KGRhdGFGb3JUaW1lLCBbJ3JlY29yZFNjb3JlJywgJ3ZhbHVlJ10pCiAgICAgICAgfTsKICAgICAgfSk7CgogICAgICByZXNvbHZlKG9iaik7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVzcCkgewogICAgICByZWplY3QocmVzcCk7CiAgICB9KTsKICB9KTsKfQ=="},null]}