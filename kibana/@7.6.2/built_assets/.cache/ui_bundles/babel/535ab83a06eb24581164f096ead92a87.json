{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/remote_clusters/public/app/sections/components/remote_cluster_form/remote_cluster_form.js","dependencies":[{"path":"x-pack/legacy/plugins/remote_clusters/public/app/sections/components/remote_cluster_form/remote_cluster_form.js","mtime":1585205046636},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlJlbW90ZUNsdXN0ZXJGb3JtID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInByb3AtdHlwZXMiKSk7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3JlYWN0MiA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfZG9jdW1lbnRhdGlvbiA9IHJlcXVpcmUoIi4uLy4uLy4uL3NlcnZpY2VzL2RvY3VtZW50YXRpb24iKTsKCnZhciBfcmVxdWVzdF9mbHlvdXQgPSByZXF1aXJlKCIuL3JlcXVlc3RfZmx5b3V0Iik7Cgp2YXIgX3ZhbGlkYXRvcnMgPSByZXF1aXJlKCIuL3ZhbGlkYXRvcnMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9Cgp2YXIgZGVmYXVsdEZpZWxkcyA9IHsKICBuYW1lOiAnJywKICBzZWVkczogW10sCiAgc2tpcFVuYXZhaWxhYmxlOiBmYWxzZQp9Owp2YXIgRVJST1JfVElUTEVfSUQgPSAncmVtb3ZlQ2x1c3RlcnNFcnJvclRpdGxlJzsKdmFyIEVSUk9SX0xJU1RfSUQgPSAncmVtb3ZlQ2x1c3RlcnNFcnJvckxpc3QnOwoKdmFyIFJlbW90ZUNsdXN0ZXJGb3JtID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhSZW1vdGVDbHVzdGVyRm9ybSwgX0NvbXBvbmVudCk7CgogIGZ1bmN0aW9uIFJlbW90ZUNsdXN0ZXJGb3JtKHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlbW90ZUNsdXN0ZXJGb3JtKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihSZW1vdGVDbHVzdGVyRm9ybSkuY2FsbCh0aGlzLCBwcm9wcykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInRvZ2dsZVJlcXVlc3QiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgdmFyIGlzUmVxdWVzdFZpc2libGUgPSBfcmVmLmlzUmVxdWVzdFZpc2libGU7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGlzUmVxdWVzdFZpc2libGU6ICFpc1JlcXVlc3RWaXNpYmxlCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZpZWxkc0NoYW5nZSIsIGZ1bmN0aW9uIChjaGFuZ2VkRmllbGRzKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmMikgewogICAgICAgIHZhciBwcmV2RmllbGRzID0gX3JlZjIuZmllbGRzLAogICAgICAgICAgICBzZWVkSW5wdXQgPSBfcmVmMi5zZWVkSW5wdXQ7CgogICAgICAgIHZhciBuZXdGaWVsZHMgPSBfb2JqZWN0U3ByZWFkKHt9LCBwcmV2RmllbGRzLCB7fSwgY2hhbmdlZEZpZWxkcyk7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmaWVsZHM6IG5ld0ZpZWxkcywKICAgICAgICAgIGZpZWxkc0Vycm9yczogX3RoaXMuZ2V0RmllbGRzRXJyb3JzKG5ld0ZpZWxkcywgc2VlZElucHV0KQogICAgICAgIH07CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2F2ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHNhdmUgPSBfdGhpcy5wcm9wcy5zYXZlOwoKICAgICAgaWYgKF90aGlzLmhhc0Vycm9ycygpKSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZTogdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBjbHVzdGVyID0gX3RoaXMuZ2V0QWxsRmllbGRzKCk7CgogICAgICBzYXZlKGNsdXN0ZXIpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25DcmVhdGVTZWVkIiwgZnVuY3Rpb24gKG5ld1NlZWQpIHsKICAgICAgLy8gSWYgdGhlIHVzZXIganVzdCBoaXQgZW50ZXIgd2l0aG91dCB0eXBpbmcgYW55dGhpbmcsIHRyZWF0IGl0IGFzIGEgbm8tb3AuCiAgICAgIGlmICghbmV3U2VlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGxvY2FsU2VlZEVycm9ycyA9ICgwLCBfdmFsaWRhdG9ycy52YWxpZGF0ZVNlZWQpKG5ld1NlZWQpOwoKICAgICAgaWYgKGxvY2FsU2VlZEVycm9ycy5sZW5ndGggIT09IDApIHsKICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBsb2NhbFNlZWRFcnJvcnM6IGxvY2FsU2VlZEVycm9ycwogICAgICAgIH0pOyAvLyBSZXR1cm4gZmFsc2UgdG8gZXhwbGljaXRseSByZWplY3QgdGhlIHVzZXIncyBpbnB1dC4KCgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHNlZWRzID0gX3RoaXMuc3RhdGUuZmllbGRzLnNlZWRzOwogICAgICB2YXIgbmV3U2VlZHMgPSBzZWVkcy5zbGljZSgwKTsKICAgICAgbmV3U2VlZHMucHVzaChuZXdTZWVkLnRvTG93ZXJDYXNlKCkpOwoKICAgICAgX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgIHNlZWRzOiBuZXdTZWVkcwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2VlZHNJbnB1dENoYW5nZSIsIGZ1bmN0aW9uIChzZWVkSW5wdXQpIHsKICAgICAgaWYgKCFzZWVkSW5wdXQpIHsKICAgICAgICAvLyBJZiBlbXB0eSBzZWVkSW5wdXQgKCIiKSBkb24ndCBkbyBhbnl0aGluZy4gVGhpcyBoYXBwZW5zCiAgICAgICAgLy8gcmlnaHQgYWZ0ZXIgYSBzZWVkIGlzIGNyZWF0ZWQuCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICB2YXIgZmllbGRzID0gX3JlZjMuZmllbGRzLAogICAgICAgICAgICBsb2NhbFNlZWRFcnJvcnMgPSBfcmVmMy5sb2NhbFNlZWRFcnJvcnM7CiAgICAgICAgdmFyIHNlZWRzID0gZmllbGRzLnNlZWRzOyAvLyBBbGxvdyB0eXBpbmcgdG8gY2xlYXIgdGhlIGVycm9ycywgYnV0IG5vdCB0byBhZGQgbmV3IG9uZXMuCgogICAgICAgIHZhciBlcnJvcnMgPSAhc2VlZElucHV0IHx8ICgwLCBfdmFsaWRhdG9ycy52YWxpZGF0ZVNlZWQpKHNlZWRJbnB1dCkubGVuZ3RoID09PSAwID8gW10gOiBsb2NhbFNlZWRFcnJvcnM7IC8vIEV1aUNvbWJvQm94IGludGVybmFsbHkgY2hlY2tzIGZvciBkdXBsaWNhdGVzIGFuZCBwcmV2ZW50cyBjYWxsaW5nIG9uQ3JlYXRlT3B0aW9uIGlmIHRoZQogICAgICAgIC8vIGlucHV0IGlzIGEgZHVwbGljYXRlLiBTbyB3ZSBuZWVkIHRvIHN1cmZhY2UgdGhpcyBlcnJvciBoZXJlIGluc3RlYWQuCgogICAgICAgIHZhciBpc0R1cGxpY2F0ZSA9IHNlZWRzLmluY2x1ZGVzKHNlZWRJbnB1dCk7CgogICAgICAgIGlmIChpc0R1cGxpY2F0ZSkgewogICAgICAgICAgZXJyb3JzLnB1c2goX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLmxvY2FsU2VlZEVycm9yLmR1cGxpY2F0ZU1lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRHVwbGljYXRlIHNlZWQgbm9kZXMgYXJlbid0IGFsbG93ZWQuIgogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGxvY2FsU2VlZEVycm9yczogZXJyb3JzLAogICAgICAgICAgZmllbGRzRXJyb3JzOiBfdGhpcy5nZXRGaWVsZHNFcnJvcnMoZmllbGRzLCBzZWVkSW5wdXQpLAogICAgICAgICAgc2VlZElucHV0OiBzZWVkSW5wdXQKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2VlZHNDaGFuZ2UiLCBmdW5jdGlvbiAoc2VlZHMpIHsKICAgICAgX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgIHNlZWRzOiBzZWVkcy5tYXAoZnVuY3Rpb24gKF9yZWY0KSB7CiAgICAgICAgICB2YXIgbGFiZWwgPSBfcmVmNC5sYWJlbDsKICAgICAgICAgIHJldHVybiBsYWJlbDsKICAgICAgICB9KQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2tpcFVuYXZhaWxhYmxlQ2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHNraXBVbmF2YWlsYWJsZSA9IGUudGFyZ2V0LmNoZWNrZWQ7CgogICAgICBfdGhpcy5vbkZpZWxkc0NoYW5nZSh7CiAgICAgICAgc2tpcFVuYXZhaWxhYmxlOiBza2lwVW5hdmFpbGFibGUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZXNldFRvRGVmYXVsdCIsIGZ1bmN0aW9uIChmaWVsZE5hbWUpIHsKICAgICAgX3RoaXMub25GaWVsZHNDaGFuZ2UoX2RlZmluZVByb3BlcnR5KHt9LCBmaWVsZE5hbWUsIGRlZmF1bHRGaWVsZHNbZmllbGROYW1lXSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFzRXJyb3JzIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgIGZpZWxkc0Vycm9ycyA9IF90aGlzJHN0YXRlLmZpZWxkc0Vycm9ycywKICAgICAgICAgIGxvY2FsU2VlZEVycm9ycyA9IF90aGlzJHN0YXRlLmxvY2FsU2VlZEVycm9yczsKICAgICAgdmFyIGVycm9yVmFsdWVzID0gT2JqZWN0LnZhbHVlcyhmaWVsZHNFcnJvcnMpOwogICAgICB2YXIgaGFzRXJyb3JzID0gZXJyb3JWYWx1ZXMuc29tZShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gZXJyb3IgIT0gbnVsbDsKICAgICAgfSkgfHwgbG9jYWxTZWVkRXJyb3JzLmxlbmd0aDsKICAgICAgcmV0dXJuIGhhc0Vycm9yczsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbmRlckVycm9ycyIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IF90aGlzLnN0YXRlLAogICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZSA9IF90aGlzJHN0YXRlMi5hcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgX3RoaXMkc3RhdGUyJGZpZWxkc0VyID0gX3RoaXMkc3RhdGUyLmZpZWxkc0Vycm9ycywKICAgICAgICAgIGVycm9yQ2x1c3Rlck5hbWUgPSBfdGhpcyRzdGF0ZTIkZmllbGRzRXIubmFtZSwKICAgICAgICAgIGVycm9yc1NlZWRzID0gX3RoaXMkc3RhdGUyJGZpZWxkc0VyLnNlZWRzLAogICAgICAgICAgbG9jYWxTZWVkRXJyb3JzID0gX3RoaXMkc3RhdGUyLmxvY2FsU2VlZEVycm9yczsKCiAgICAgIHZhciBoYXNFcnJvcnMgPSBfdGhpcy5oYXNFcnJvcnMoKTsKCiAgICAgIGlmICghYXJlRXJyb3JzVmlzaWJsZSB8fCAhaGFzRXJyb3JzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBlcnJvckV4cGxhbmF0aW9ucyA9IFtdOwoKICAgICAgaWYgKGVycm9yQ2x1c3Rlck5hbWUpIHsKICAgICAgICBlcnJvckV4cGxhbmF0aW9ucy5wdXNoKHsKICAgICAgICAgIGtleTogJ25hbWVFeHBsYW5hdGlvbicsCiAgICAgICAgICBmaWVsZDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLmlucHV0TmFtZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGUgIk5hbWUiIGZpZWxkIGlzIGludmFsaWQuJwogICAgICAgICAgfSksCiAgICAgICAgICBlcnJvcjogZXJyb3JDbHVzdGVyTmFtZQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAoZXJyb3JzU2VlZHMpIHsKICAgICAgICBlcnJvckV4cGxhbmF0aW9ucy5wdXNoKHsKICAgICAgICAgIGtleTogJ3NlZWRzRXhwbGFuYXRpb24nLAogICAgICAgICAgZmllbGQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5pbnB1dFNlZWRzRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1RoZSAiU2VlZCBub2RlcyIgZmllbGQgaXMgaW52YWxpZC4nCiAgICAgICAgICB9KSwKICAgICAgICAgIGVycm9yOiBlcnJvcnNTZWVkcwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAobG9jYWxTZWVkRXJyb3JzICYmIGxvY2FsU2VlZEVycm9ycy5sZW5ndGgpIHsKICAgICAgICBlcnJvckV4cGxhbmF0aW9ucy5wdXNoKHsKICAgICAgICAgIGtleTogJ2xvY2FsU2VlZEV4cGxhbmF0aW9uJywKICAgICAgICAgIGZpZWxkOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2sucmVtb3RlQ2x1c3RlcnMucmVtb3RlQ2x1c3RlckZvcm0uaW5wdXRMb2NhbFNlZWRFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVGhlICJTZWVkIG5vZGVzIiBmaWVsZCBpcyBpbnZhbGlkLicKICAgICAgICAgIH0pLAogICAgICAgICAgZXJyb3I6IGxvY2FsU2VlZEVycm9ycy5qb2luKCcgJykKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIG1lc3NhZ2VzVG9CZVJlbmRlcmVkID0gZXJyb3JFeHBsYW5hdGlvbnMubGVuZ3RoICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTY3JlZW5SZWFkZXJPbmx5LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkbCIsIHsKICAgICAgICBpZDogX3RoaXMuZ2VuZXJhdGVJZChFUlJPUl9MSVNUX0lEKSwKICAgICAgICAiYXJpYS1sYWJlbGxlZGJ5IjogX3RoaXMuZ2VuZXJhdGVJZChFUlJPUl9USVRMRV9JRCkKICAgICAgfSwgZXJyb3JFeHBsYW5hdGlvbnMubWFwKGZ1bmN0aW9uIChfcmVmNSkgewogICAgICAgIHZhciBrZXkgPSBfcmVmNS5rZXksCiAgICAgICAgICAgIGZpZWxkID0gX3JlZjUuZmllbGQsCiAgICAgICAgICAgIGVycm9yID0gX3JlZjUuZXJyb3I7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgIGtleToga2V5CiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZHQiLCBudWxsLCBmaWVsZCksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRkIiwgbnVsbCwgZXJyb3IpKTsKICAgICAgfSkpKTsKCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIiwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAicmVtb3RlQ2x1c3RlckZvcm1HbG9iYWxFcnJvciIKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgzIiwgewogICAgICAgICAgaWQ6IF90aGlzLmdlbmVyYXRlSWQoRVJST1JfVElUTEVfSUQpCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2sucmVtb3RlQ2x1c3RlcnMucmVtb3RlQ2x1c3RlckZvcm0uZXJyb3JUaXRsZSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZpeCBlcnJvcnMgYmVmb3JlIGNvbnRpbnVpbmcuIgogICAgICAgIH0pKSwKICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgaWNvblR5cGU6ICJjcm9zcyIKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlEZWxheVJlbmRlciwgbnVsbCwgbWVzc2FnZXNUb0JlUmVuZGVyZWQpKTsKICAgIH0pOwoKICAgIHZhciBfZmllbGRzID0gcHJvcHMuZmllbGRzLAogICAgICAgIGRpc2FibGVkRmllbGRzID0gcHJvcHMuZGlzYWJsZWRGaWVsZHM7CiAgICB2YXIgZmllbGRzU3RhdGUgPSAoMCwgX2xvZGFzaC5tZXJnZSkoe30sIGRlZmF1bHRGaWVsZHMsIF9maWVsZHMpOwogICAgX3RoaXMuZ2VuZXJhdGVJZCA9ICgwLCBfZXVpLmh0bWxJZEdlbmVyYXRvcikoKTsKICAgIF90aGlzLnN0YXRlID0gewogICAgICBsb2NhbFNlZWRFcnJvcnM6IFtdLAogICAgICBzZWVkSW5wdXQ6ICcnLAogICAgICBmaWVsZHM6IGZpZWxkc1N0YXRlLAogICAgICBkaXNhYmxlZEZpZWxkczogZGlzYWJsZWRGaWVsZHMsCiAgICAgIGZpZWxkc0Vycm9yczogX3RoaXMuZ2V0RmllbGRzRXJyb3JzKGZpZWxkc1N0YXRlKSwKICAgICAgYXJlRXJyb3JzVmlzaWJsZTogZmFsc2UsCiAgICAgIGlzUmVxdWVzdFZpc2libGU6IGZhbHNlCiAgICB9OwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFJlbW90ZUNsdXN0ZXJGb3JtLCBbewogICAga2V5OiAiZ2V0RmllbGRzRXJyb3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZHNFcnJvcnMoZmllbGRzKSB7CiAgICAgIHZhciBzZWVkSW5wdXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICcnOwogICAgICB2YXIgbmFtZSA9IGZpZWxkcy5uYW1lLAogICAgICAgICAgc2VlZHMgPSBmaWVsZHMuc2VlZHM7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogKDAsIF92YWxpZGF0b3JzLnZhbGlkYXRlTmFtZSkobmFtZSksCiAgICAgICAgc2VlZHM6ICgwLCBfdmFsaWRhdG9ycy52YWxpZGF0ZVNlZWRzKShzZWVkcywgc2VlZElucHV0KQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldEFsbEZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QWxsRmllbGRzKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUkZmllbGRzID0gdGhpcy5zdGF0ZS5maWVsZHMsCiAgICAgICAgICBuYW1lID0gX3RoaXMkc3RhdGUkZmllbGRzLm5hbWUsCiAgICAgICAgICBzZWVkcyA9IF90aGlzJHN0YXRlJGZpZWxkcy5zZWVkcywKICAgICAgICAgIHNraXBVbmF2YWlsYWJsZSA9IF90aGlzJHN0YXRlJGZpZWxkcy5za2lwVW5hdmFpbGFibGU7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICBzZWVkczogc2VlZHMsCiAgICAgICAgc2tpcFVuYXZhaWxhYmxlOiBza2lwVW5hdmFpbGFibGUKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJTZWVkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyU2VlZHMoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTMgPSB0aGlzLnN0YXRlLAogICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZSA9IF90aGlzJHN0YXRlMy5hcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgc2VlZHMgPSBfdGhpcyRzdGF0ZTMuZmllbGRzLnNlZWRzLAogICAgICAgICAgZXJyb3JzU2VlZHMgPSBfdGhpcyRzdGF0ZTMuZmllbGRzRXJyb3JzLnNlZWRzLAogICAgICAgICAgbG9jYWxTZWVkRXJyb3JzID0gX3RoaXMkc3RhdGUzLmxvY2FsU2VlZEVycm9yczsgLy8gU2hvdyBlcnJvcnMgaWYgdGhlcmUgaXMgYSBnZW5lcmFsIGZvcm0gZXJyb3Igb3IgbG9jYWwgZXJyb3JzLgoKICAgICAgdmFyIGFyZUZvcm1FcnJvcnNWaXNpYmxlID0gQm9vbGVhbihhcmVFcnJvcnNWaXNpYmxlICYmIGVycm9yc1NlZWRzKTsKICAgICAgdmFyIHNob3dFcnJvcnMgPSBhcmVGb3JtRXJyb3JzVmlzaWJsZSB8fCBsb2NhbFNlZWRFcnJvcnMubGVuZ3RoICE9PSAwOwogICAgICB2YXIgZXJyb3JzID0gYXJlRm9ybUVycm9yc1Zpc2libGUgPyBsb2NhbFNlZWRFcnJvcnMuY29uY2F0KGVycm9yc1NlZWRzKSA6IGxvY2FsU2VlZEVycm9yczsKICAgICAgdmFyIGZvcm1hdHRlZFNlZWRzID0gc2VlZHMubWFwKGZ1bmN0aW9uIChzZWVkKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGxhYmVsOiBzZWVkCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRGVzY3JpYmVkRm9ybUdyb3VwLCB7CiAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUaXRsZSwgewogICAgICAgICAgc2l6ZTogInMiCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaDIiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5zZWN0aW9uU2VlZHNUaXRsZSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNlZWQgbm9kZXMgZm9yIGNsdXN0ZXIgZGlzY292ZXJ5IgogICAgICAgIH0pKSksCiAgICAgICAgZGVzY3JpcHRpb246IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLnNlY3Rpb25TZWVkc0Rlc2NyaXB0aW9uMSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkEgbGlzdCBvZiByZW1vdGUgY2x1c3RlciBub2RlcyB0byBxdWVyeSBmb3IgdGhlIGNsdXN0ZXIgc3RhdGUuIFNwZWNpZnkgbXVsdGlwbGUgc2VlZCBub2RlcyBzbyBkaXNjb3ZlcnkgZG9lc24ndCBmYWlsIGlmIGEgbm9kZSBpcyB1bmF2YWlsYWJsZS4iCiAgICAgICAgfSksCiAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInJlbW90ZUNsdXN0ZXJGb3JtU2VlZE5vZGVzRm9ybVJvdyIsCiAgICAgICAgbGFiZWw6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLmZpZWxkU2VlZHNMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNlZWQgbm9kZXMiCiAgICAgICAgfSksCiAgICAgICAgaGVscFRleHQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLnNlY3Rpb25TZWVkc0hlbHBUZXh0IiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQW4gSVAgYWRkcmVzcyBvciBob3N0IG5hbWUsIGZvbGxvd2VkIGJ5IHRoZSB7dHJhbnNwb3J0UG9ydH0gb2YgdGhlIHJlbW90ZSBjbHVzdGVyLiIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgdHJhbnNwb3J0UG9ydDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxpbmssIHsKICAgICAgICAgICAgICBocmVmOiBfZG9jdW1lbnRhdGlvbi50cmFuc3BvcnRQb3J0VXJsLAogICAgICAgICAgICAgIHRhcmdldDogIl9ibGFuayIKICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLnNlY3Rpb25TZWVkc0hlbHBUZXh0LnRyYW5zcG9ydFBvcnRMaW5rVGV4dCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJ0cmFuc3BvcnQgcG9ydCIKICAgICAgICAgICAgfSkpCiAgICAgICAgICB9CiAgICAgICAgfSksCiAgICAgICAgaXNJbnZhbGlkOiBzaG93RXJyb3JzLAogICAgICAgIGVycm9yOiBlcnJvcnMsCiAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb21ib0JveCwgewogICAgICAgIG5vU3VnZ2VzdGlvbnM6IHRydWUsCiAgICAgICAgcGxhY2Vob2xkZXI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5maWVsZFNlZWRzUGxhY2Vob2xkZXInLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ2hvc3Q6cG9ydCcKICAgICAgICB9KSwKICAgICAgICBzZWxlY3RlZE9wdGlvbnM6IGZvcm1hdHRlZFNlZWRzLAogICAgICAgIG9uQ3JlYXRlT3B0aW9uOiB0aGlzLm9uQ3JlYXRlU2VlZCwKICAgICAgICBvbkNoYW5nZTogdGhpcy5vblNlZWRzQ2hhbmdlLAogICAgICAgIG9uU2VhcmNoQ2hhbmdlOiB0aGlzLm9uU2VlZHNJbnB1dENoYW5nZSwKICAgICAgICBpc0ludmFsaWQ6IHNob3dFcnJvcnMsCiAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJyZW1vdGVDbHVzdGVyRm9ybVNlZWRzSW5wdXQiCiAgICAgIH0pKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyU2tpcFVuYXZhaWxhYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJTa2lwVW5hdmFpbGFibGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIHNraXBVbmF2YWlsYWJsZSA9IHRoaXMuc3RhdGUuZmllbGRzLnNraXBVbmF2YWlsYWJsZTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlEZXNjcmliZWRGb3JtR3JvdXAsIHsKICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgICBzaXplOiAicyIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLnNlY3Rpb25Ta2lwVW5hdmFpbGFibGVUaXRsZSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk1ha2UgcmVtb3RlIGNsdXN0ZXIgb3B0aW9uYWwiCiAgICAgICAgfSkpKSwKICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5zZWN0aW9uU2tpcFVuYXZhaWxhYmxlRGVzY3JpcHRpb24iLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJCeSBkZWZhdWx0LCBhIHJlcXVlc3QgZmFpbHMgaWYgYW55IG9mIHRoZSBxdWVyaWVkIHJlbW90ZSBjbHVzdGVycyBhcmUgdW5hdmFpbGFibGUuIFRvIGNvbnRpbnVlIHNlbmRpbmcgYSByZXF1ZXN0IHRvIG90aGVyIHJlbW90ZSBjbHVzdGVycyBpZiB0aGlzIGNsdXN0ZXIgaXMgdW5hdmFpbGFibGUsIGVuYWJsZSB7b3B0aW9uTmFtZX0uIHtsZWFybk1vcmVMaW5rfSIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgb3B0aW9uTmFtZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3Ryb25nIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLnNlY3Rpb25Ta2lwVW5hdmFpbGFibGVEZXNjcmlwdGlvbi5vcHRpb25OYW1lTGFiZWwiLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2tpcCBpZiB1bmF2YWlsYWJsZSIKICAgICAgICAgICAgfSkpLAogICAgICAgICAgICBsZWFybk1vcmVMaW5rOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgICAgICAgIGhyZWY6IF9kb2N1bWVudGF0aW9uLnNraXBwaW5nRGlzY29ubmVjdGVkQ2x1c3RlcnNVcmwsCiAgICAgICAgICAgICAgdGFyZ2V0OiAiX2JsYW5rIgogICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAieHBhY2sucmVtb3RlQ2x1c3RlcnMucmVtb3RlQ2x1c3RlckZvcm0uc2VjdGlvblNraXBVbmF2YWlsYWJsZURlc2NyaXB0aW9uLmxlYXJuTW9yZUxpbmtMYWJlbCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJMZWFybiBtb3JlLiIKICAgICAgICAgICAgfSkpCiAgICAgICAgICB9CiAgICAgICAgfSkpKSwKICAgICAgICBmdWxsV2lkdGg6IHRydWUKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAicmVtb3RlQ2x1c3RlckZvcm1Ta2lwVW5hdmFpbGFibGVGb3JtUm93IiwKICAgICAgICBjbGFzc05hbWU6ICJyZW1vdGVDbHVzdGVyU2tpcElmVW5hdmFpbGFibGVTd2l0Y2giLAogICAgICAgIGhhc0VtcHR5TGFiZWxTcGFjZTogdHJ1ZSwKICAgICAgICBmdWxsV2lkdGg6IHRydWUsCiAgICAgICAgaGVscFRleHQ6IHNraXBVbmF2YWlsYWJsZSAhPT0gZGVmYXVsdEZpZWxkcy5za2lwVW5hdmFpbGFibGUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgX3RoaXMyLnJlc2V0VG9EZWZhdWx0KCdza2lwVW5hdmFpbGFibGUnKTsKICAgICAgICAgIH0KICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5zZWN0aW9uU2tpcFVuYXZhaWxhYmxlUmVzZXRMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlJlc2V0IHRvIGRlZmF1bHQiCiAgICAgICAgfSkpIDogbnVsbAogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3dpdGNoLCB7CiAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5zZWN0aW9uU2tpcFVuYXZhaWxhYmxlTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NraXAgaWYgdW5hdmFpbGFibGUnCiAgICAgICAgfSksCiAgICAgICAgY2hlY2tlZDogc2tpcFVuYXZhaWxhYmxlLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uU2tpcFVuYXZhaWxhYmxlQ2hhbmdlLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJyZW1vdGVDbHVzdGVyRm9ybVNraXBVbmF2YWlsYWJsZUZvcm1Ub2dnbGUiCiAgICAgIH0pKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyQWN0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyQWN0aW9ucygpIHsKICAgICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgIGlzU2F2aW5nID0gX3RoaXMkcHJvcHMuaXNTYXZpbmcsCiAgICAgICAgICBjYW5jZWwgPSBfdGhpcyRwcm9wcy5jYW5jZWw7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTQgPSB0aGlzLnN0YXRlLAogICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZSA9IF90aGlzJHN0YXRlNC5hcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgaXNSZXF1ZXN0VmlzaWJsZSA9IF90aGlzJHN0YXRlNC5pc1JlcXVlc3RWaXNpYmxlOwoKICAgICAgaWYgKGlzU2F2aW5nKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAiZmxleFN0YXJ0IiwKICAgICAgICAgIGd1dHRlclNpemU6ICJtIgogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTG9hZGluZ1NwaW5uZXIsIHsKICAgICAgICAgIHNpemU6ICJsIgogICAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICBncm93OiBmYWxzZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUZXh0LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5hY3Rpb25zLnNhdmluZ1RleHQiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZpbmciCiAgICAgICAgfSkpKSk7CiAgICAgIH0KCiAgICAgIHZhciBjYW5jZWxCdXR0b247CgogICAgICBpZiAoY2FuY2VsKSB7CiAgICAgICAgY2FuY2VsQnV0dG9uID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICBncm93OiBmYWxzZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25FbXB0eSwgewogICAgICAgICAgY29sb3I6ICJwcmltYXJ5IiwKICAgICAgICAgIG9uQ2xpY2s6IGNhbmNlbAogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLmNhbmNlbEJ1dHRvbkxhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuY2VsIgogICAgICAgIH0pKSk7CiAgICAgIH0KCiAgICAgIHZhciBpc1NhdmVEaXNhYmxlZCA9IGFyZUVycm9yc1Zpc2libGUgJiYgdGhpcy5oYXNFcnJvcnMoKTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBqdXN0aWZ5Q29udGVudDogInNwYWNlQmV0d2VlbiIsCiAgICAgICAgYWxpZ25JdGVtczogImNlbnRlciIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgIGFsaWduSXRlbXM6ICJjZW50ZXIiLAogICAgICAgIGd1dHRlclNpemU6ICJtIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInJlbW90ZUNsdXN0ZXJGb3JtU2F2ZUJ1dHRvbiIsCiAgICAgICAgY29sb3I6ICJzZWNvbmRhcnkiLAogICAgICAgIGljb25UeXBlOiAiY2hlY2siLAogICAgICAgIG9uQ2xpY2s6IHRoaXMuc2F2ZSwKICAgICAgICBmaWxsOiB0cnVlLAogICAgICAgIGRpc2FibGVkOiBpc1NhdmVEaXNhYmxlZCwKICAgICAgICAiYXJpYS1kZXNjcmliZWRieSI6ICIiLmNvbmNhdCh0aGlzLmdlbmVyYXRlSWQoRVJST1JfVElUTEVfSUQpLCAiICIpLmNvbmNhdCh0aGlzLmdlbmVyYXRlSWQoRVJST1JfTElTVF9JRCkpCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5zYXZlQnV0dG9uTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSIKICAgICAgfSkpKSwgY2FuY2VsQnV0dG9uKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25FbXB0eSwgewogICAgICAgIG9uQ2xpY2s6IHRoaXMudG9nZ2xlUmVxdWVzdAogICAgICB9LCBpc1JlcXVlc3RWaXNpYmxlID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLmhpZGVSZXF1ZXN0QnV0dG9uTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSGlkZSByZXF1ZXN0IgogICAgICB9KSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5zaG93UmVxdWVzdEJ1dHRvbkxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNob3cgcmVxdWVzdCIKICAgICAgfSkpKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyU2F2aW5nRmVlZGJhY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclNhdmluZ0ZlZWRiYWNrKCkgewogICAgICBpZiAodGhpcy5wcm9wcy5pc1NhdmluZykgewogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpT3ZlcmxheU1hc2ssIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMb2FkaW5nS2liYW5hLCB7CiAgICAgICAgICBzaXplOiAieGwiCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJTYXZlRXJyb3JGZWVkYmFjayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyU2F2ZUVycm9yRmVlZGJhY2soKSB7CiAgICAgIHZhciBzYXZlRXJyb3IgPSB0aGlzLnByb3BzLnNhdmVFcnJvcjsKCiAgICAgIGlmIChzYXZlRXJyb3IpIHsKICAgICAgICB2YXIgbWVzc2FnZSA9IHNhdmVFcnJvci5tZXNzYWdlLAogICAgICAgICAgICBjYXVzZSA9IHNhdmVFcnJvci5jYXVzZTsKICAgICAgICB2YXIgZXJyb3JCb2R5OwoKICAgICAgICBpZiAoY2F1c2UpIHsKICAgICAgICAgIGlmIChjYXVzZS5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgZXJyb3JCb2R5ID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIGNhdXNlWzBdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVycm9yQm9keSA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInVsIiwgbnVsbCwgY2F1c2UubWFwKGZ1bmN0aW9uIChjYXVzZVZhbHVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImxpIiwgewogICAgICAgICAgICAgICAga2V5OiBjYXVzZVZhbHVlCiAgICAgICAgICAgICAgfSwgY2F1c2VWYWx1ZSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICAgIHRpdGxlOiBtZXNzYWdlLAogICAgICAgICAgaWNvbjogImNyb3NzIiwKICAgICAgICAgIGNvbG9yOiAid2FybmluZyIKICAgICAgICB9LCBlcnJvckJvZHkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCBudWxsKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBkaXNhYmxlZE5hbWUgPSB0aGlzLnByb3BzLmRpc2FibGVkRmllbGRzLm5hbWU7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTUgPSB0aGlzLnN0YXRlLAogICAgICAgICAgaXNSZXF1ZXN0VmlzaWJsZSA9IF90aGlzJHN0YXRlNS5pc1JlcXVlc3RWaXNpYmxlLAogICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZSA9IF90aGlzJHN0YXRlNS5hcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgbmFtZSA9IF90aGlzJHN0YXRlNS5maWVsZHMubmFtZSwKICAgICAgICAgIGVycm9yQ2x1c3Rlck5hbWUgPSBfdGhpcyRzdGF0ZTUuZmllbGRzRXJyb3JzLm5hbWU7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgdGhpcy5yZW5kZXJTYXZlRXJyb3JGZWVkYmFjaygpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybSwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aURlc2NyaWJlZEZvcm1Hcm91cCwgewogICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIHsKICAgICAgICAgIHNpemU6ICJzIgogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2sucmVtb3RlQ2x1c3RlcnMucmVtb3RlQ2x1c3RlckZvcm0uc2VjdGlvbk5hbWVUaXRsZSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk5hbWUiCiAgICAgICAgfSkpKSwKICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2sucmVtb3RlQ2x1c3RlcnMucmVtb3RlQ2x1c3RlckZvcm0uc2VjdGlvbk5hbWVEZXNjcmlwdGlvbiIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkEgdW5pcXVlIG5hbWUgZm9yIHRoZSByZW1vdGUgY2x1c3Rlci4iCiAgICAgICAgfSksCiAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInJlbW90ZUNsdXN0ZXJGb3JtTmFtZUZvcm1Sb3ciLAogICAgICAgIGxhYmVsOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5yZW1vdGVDbHVzdGVycy5yZW1vdGVDbHVzdGVyRm9ybS5maWVsZE5hbWVMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk5hbWUiCiAgICAgICAgfSksCiAgICAgICAgaGVscFRleHQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnJlbW90ZUNsdXN0ZXJzLnJlbW90ZUNsdXN0ZXJGb3JtLmZpZWxkTmFtZUxhYmVsSGVscFRleHQiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJOYW1lIGNhbiBvbmx5IGNvbnRhaW4gbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMsIGFuZCBkYXNoZXMuIgogICAgICAgIH0pLAogICAgICAgIGVycm9yOiBlcnJvckNsdXN0ZXJOYW1lLAogICAgICAgIGlzSW52YWxpZDogQm9vbGVhbihhcmVFcnJvcnNWaXNpYmxlICYmIGVycm9yQ2x1c3Rlck5hbWUpLAogICAgICAgIGZ1bGxXaWR0aDogdHJ1ZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGRUZXh0LCB7CiAgICAgICAgaXNJbnZhbGlkOiBCb29sZWFuKGFyZUVycm9yc1Zpc2libGUgJiYgZXJyb3JDbHVzdGVyTmFtZSksCiAgICAgICAgdmFsdWU6IG5hbWUsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIHJldHVybiBfdGhpczMub25GaWVsZHNDaGFuZ2UoewogICAgICAgICAgICBuYW1lOiBlLnRhcmdldC52YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBmdWxsV2lkdGg6IHRydWUsCiAgICAgICAgZGlzYWJsZWQ6IGRpc2FibGVkTmFtZSwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAicmVtb3RlQ2x1c3RlckZvcm1OYW1lSW5wdXQiCiAgICAgIH0pKSksIHRoaXMucmVuZGVyU2VlZHMoKSwgdGhpcy5yZW5kZXJTa2lwVW5hdmFpbGFibGUoKSksIHRoaXMucmVuZGVyRXJyb3JzKCksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibCIKICAgICAgfSksIHRoaXMucmVuZGVyQWN0aW9ucygpLCB0aGlzLnJlbmRlclNhdmluZ0ZlZWRiYWNrKCksIGlzUmVxdWVzdFZpc2libGUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZXF1ZXN0X2ZseW91dC5SZXF1ZXN0Rmx5b3V0LCB7CiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICBjbHVzdGVyOiB0aGlzLmdldEFsbEZpZWxkcygpLAogICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczMuc2V0U3RhdGUoewogICAgICAgICAgICBpc1JlcXVlc3RWaXNpYmxlOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KSA6IG51bGwpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFJlbW90ZUNsdXN0ZXJGb3JtOwp9KF9yZWFjdC5Db21wb25lbnQpOwoKZXhwb3J0cy5SZW1vdGVDbHVzdGVyRm9ybSA9IFJlbW90ZUNsdXN0ZXJGb3JtOwoKX2RlZmluZVByb3BlcnR5KFJlbW90ZUNsdXN0ZXJGb3JtLCAicHJvcFR5cGVzIiwgewogIHNhdmU6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQsCiAgY2FuY2VsOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYywKICBpc1NhdmluZzogX3Byb3BUeXBlcy5kZWZhdWx0LmJvb2wsCiAgc2F2ZUVycm9yOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LAogIGZpZWxkczogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdCwKICBkaXNhYmxlZEZpZWxkczogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdAp9KTsKCl9kZWZpbmVQcm9wZXJ0eShSZW1vdGVDbHVzdGVyRm9ybSwgImRlZmF1bHRQcm9wcyIsIHsKICBmaWVsZHM6ICgwLCBfbG9kYXNoLm1lcmdlKSh7fSwgZGVmYXVsdEZpZWxkcyksCiAgZGlzYWJsZWRGaWVsZHM6IHt9Cn0pOw=="},null]}