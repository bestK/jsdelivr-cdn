{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/visualize/np_ready/editor/editor.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/visualize/np_ready/editor/editor.js","mtime":1585205039915},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmluaXRFZGl0b3JEaXJlY3RpdmUgPSBpbml0RWRpdG9yRGlyZWN0aXZlOwoKdmFyIF9hbmd1bGFyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJhbmd1bGFyIikpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfcnhqcyA9IHJlcXVpcmUoInJ4anMiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKcmVxdWlyZSgiLi4vLi4vc2F2ZWRfdmlzdWFsaXphdGlvbnMvc2F2ZWRfdmlzdWFsaXphdGlvbnMiKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfbGliID0gcmVxdWlyZSgiLi9saWIiKTsKCnZhciBfdmlzdWFsaXplX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4uL3Zpc3VhbGl6ZV9jb25zdGFudHMiKTsKCnZhciBfYnJlYWRjcnVtYnMgPSByZXF1aXJlKCIuLi9icmVhZGNydW1icyIpOwoKdmFyIF9oZWxwX21lbnVfdXRpbCA9IHJlcXVpcmUoIi4uL2hlbHBfbWVudS9oZWxwX21lbnVfdXRpbCIpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9kYXRhL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMyID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9raWJhbmFfdXRpbHMvcHVibGljIik7Cgp2YXIgX3Zpc3VhbGl6YXRpb25fZWRpdG9yID0gcmVxdWlyZSgiLi92aXN1YWxpemF0aW9uX2VkaXRvciIpOwoKdmFyIF92aXN1YWxpemF0aW9uID0gcmVxdWlyZSgiLi92aXN1YWxpemF0aW9uIik7Cgp2YXIgX2xlZ2FjeV9pbXBvcnRzID0gcmVxdWlyZSgiLi4vLi4vbGVnYWN5X2ltcG9ydHMiKTsKCnZhciBfa2liYW5hX3NlcnZpY2VzID0gcmVxdWlyZSgiLi4vLi4va2liYW5hX3NlcnZpY2VzIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKZnVuY3Rpb24gaW5pdEVkaXRvckRpcmVjdGl2ZShhcHAsIGRlcHMpIHsKICBhcHAuZGlyZWN0aXZlKCd2aXN1YWxpemVBcHAnLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gewogICAgICByZXN0cmljdDogJ0UnLAogICAgICBjb250cm9sbGVyQXM6ICd2aXN1YWxpemVBcHAnLAogICAgICBjb250cm9sbGVyOiBWaXN1YWxpemVBcHBDb250cm9sbGVyCiAgICB9OwogIH0pOwogICgwLCBfdmlzdWFsaXphdGlvbl9lZGl0b3IuaW5pdFZpc0VkaXRvckRpcmVjdGl2ZSkoYXBwLCBkZXBzKTsKICAoMCwgX3Zpc3VhbGl6YXRpb24uaW5pdFZpc3VhbGl6YXRpb25EaXJlY3RpdmUpKGFwcCwgZGVwcyk7Cn0KCmZ1bmN0aW9uIFZpc3VhbGl6ZUFwcENvbnRyb2xsZXIoJHNjb3BlLCAkZWxlbWVudCwgJHJvdXRlLCBBcHBTdGF0ZSwgJHdpbmRvdywgJGluamVjdG9yLCAkdGltZW91dCwga2JuVXJsLCByZWRpcmVjdFdoZW5NaXNzaW5nLCBQcm9taXNlLCBrYm5CYXNlVXJsLCBnZXRBcHBTdGF0ZSwgZ2xvYmFsU3RhdGUpIHsKICB2YXIgX2dldFNlcnZpY2VzID0gKDAsIF9raWJhbmFfc2VydmljZXMuZ2V0U2VydmljZXMpKCksCiAgICAgIGluZGV4UGF0dGVybnMgPSBfZ2V0U2VydmljZXMuaW5kZXhQYXR0ZXJucywKICAgICAgbG9jYWxTdG9yYWdlID0gX2dldFNlcnZpY2VzLmxvY2FsU3RvcmFnZSwKICAgICAgdmlzdWFsaXplQ2FwYWJpbGl0aWVzID0gX2dldFNlcnZpY2VzLnZpc3VhbGl6ZUNhcGFiaWxpdGllcywKICAgICAgc2hhcmUgPSBfZ2V0U2VydmljZXMuc2hhcmUsCiAgICAgIF9nZXRTZXJ2aWNlcyRkYXRhJHF1ZSA9IF9nZXRTZXJ2aWNlcy5kYXRhLnF1ZXJ5LAogICAgICBmaWx0ZXJNYW5hZ2VyID0gX2dldFNlcnZpY2VzJGRhdGEkcXVlLmZpbHRlck1hbmFnZXIsCiAgICAgIHRpbWVmaWx0ZXIgPSBfZ2V0U2VydmljZXMkZGF0YSRxdWUudGltZWZpbHRlci50aW1lZmlsdGVyLAogICAgICB0b2FzdE5vdGlmaWNhdGlvbnMgPSBfZ2V0U2VydmljZXMudG9hc3ROb3RpZmljYXRpb25zLAogICAgICBsZWdhY3lDaHJvbWUgPSBfZ2V0U2VydmljZXMubGVnYWN5Q2hyb21lLAogICAgICBjaHJvbWUgPSBfZ2V0U2VydmljZXMuY2hyb21lLAogICAgICBnZXRCYXNlUGF0aCA9IF9nZXRTZXJ2aWNlcy5nZXRCYXNlUGF0aCwKICAgICAgZG9jTGlua3MgPSBfZ2V0U2VydmljZXMuY29yZS5kb2NMaW5rcywKICAgICAgc2F2ZWRRdWVyeVNlcnZpY2UgPSBfZ2V0U2VydmljZXMuc2F2ZWRRdWVyeVNlcnZpY2UsCiAgICAgIHVpU2V0dGluZ3MgPSBfZ2V0U2VydmljZXMudWlTZXR0aW5nczsKCiAgdmFyIGZpbHRlclN0YXRlTWFuYWdlciA9IG5ldyBfcHVibGljLkZpbHRlclN0YXRlTWFuYWdlcihnbG9iYWxTdGF0ZSwgZ2V0QXBwU3RhdGUsIGZpbHRlck1hbmFnZXIpOwogIHZhciBxdWVyeUZpbHRlciA9IGZpbHRlck1hbmFnZXI7IC8vIFJldHJpZXZlIHRoZSByZXNvbHZlZCBTYXZlZFZpcyBpbnN0YW5jZS4KCiAgdmFyIHNhdmVkVmlzID0gJHJvdXRlLmN1cnJlbnQubG9jYWxzLnNhdmVkVmlzOwoKICB2YXIgX2FwcGx5VmlzID0gZnVuY3Rpb24gX2FwcGx5VmlzKCkgewogICAgJHNjb3BlLiRhcHBseSgpOwogIH07IC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZGlnZXN0IGN5Y2xlLiBUaGlzIGlzIG5lZWRlZCB3aGVuIHZpcyBpcyB1cGRhdGVkIGZyb20gYSBnbG9iYWwgYW5ndWxhciBsaWtlIGluIHZpc3VhbGl6ZV9lbWJlZGRhYmxlLmpzLgoKCiAgc2F2ZWRWaXMudmlzLm9uKCdhcHBseScsIF9hcHBseVZpcyk7IC8vIHZpcyBpcyBpbnN0YW5jZSBvZiBzcmMvbGVnYWN5L3VpL3B1YmxpYy92aXMvdmlzLmpzLgogIC8vIFNlYXJjaFNvdXJjZSBpcyBhIHByb21pc2UtYmFzZWQgc3RyZWFtIG9mIHNlYXJjaCByZXN1bHRzIHRoYXQgY2FuIGluaGVyaXQgZnJvbSBvdGhlciBzZWFyY2ggc291cmNlcy4KCiAgdmFyIHZpcyA9IHNhdmVkVmlzLnZpcywKICAgICAgc2VhcmNoU291cmNlID0gc2F2ZWRWaXMuc2VhcmNoU291cmNlOwogICRzY29wZS52aXMgPSB2aXM7CiAgdmFyICRhcHBTdGF0dXMgPSB0aGlzLmFwcFN0YXR1cyA9IHsKICAgIGRpcnR5OiAhc2F2ZWRWaXMuaWQKICB9OwogICRzY29wZS50b3BOYXZNZW51ID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh2aXN1YWxpemVDYXBhYmlsaXRpZXMuc2F2ZSA/IFt7CiAgICBpZDogJ3NhdmUnLAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udG9wTmF2TWVudS5zYXZlVmlzdWFsaXphdGlvbkJ1dHRvbkxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ3NhdmUnCiAgICB9KSwKICAgIGRlc2NyaXB0aW9uOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLnZpc3VhbGl6ZS50b3BOYXZNZW51LnNhdmVWaXN1YWxpemF0aW9uQnV0dG9uQXJpYUxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ1NhdmUgVmlzdWFsaXphdGlvbicKICAgIH0pLAogICAgdGVzdElkOiAndmlzdWFsaXplU2F2ZUJ1dHRvbicsCiAgICBkaXNhYmxlQnV0dG9uOiBmdW5jdGlvbiBkaXNhYmxlQnV0dG9uKCkgewogICAgICByZXR1cm4gQm9vbGVhbih2aXMuZGlydHkpOwogICAgfSwKICAgIHRvb2x0aXA6IGZ1bmN0aW9uIHRvb2x0aXAoKSB7CiAgICAgIGlmICh2aXMuZGlydHkpIHsKICAgICAgICByZXR1cm4gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi52aXN1YWxpemUudG9wTmF2TWVudS5zYXZlVmlzdWFsaXphdGlvbkRpc2FibGVkQnV0dG9uVG9vbHRpcCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQXBwbHkgb3IgRGlzY2FyZCB5b3VyIGNoYW5nZXMgYmVmb3JlIHNhdmluZycKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHJ1bjogZnVuY3Rpb24gcnVuKCkgewogICAgICB2YXIgb25TYXZlLCBjb25maXJtQnV0dG9uTGFiZWwsIHNhdmVNb2RhbDsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBydW4kKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIG9uU2F2ZSA9IGZ1bmN0aW9uIG9uU2F2ZShfcmVmKSB7CiAgICAgICAgICAgICAgICB2YXIgbmV3VGl0bGUgPSBfcmVmLm5ld1RpdGxlLAogICAgICAgICAgICAgICAgICAgIG5ld0NvcHlPblNhdmUgPSBfcmVmLm5ld0NvcHlPblNhdmUsCiAgICAgICAgICAgICAgICAgICAgaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZCA9IF9yZWYuaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZCwKICAgICAgICAgICAgICAgICAgICBvblRpdGxlRHVwbGljYXRlID0gX3JlZi5vblRpdGxlRHVwbGljYXRlLAogICAgICAgICAgICAgICAgICAgIG5ld0Rlc2NyaXB0aW9uID0gX3JlZi5uZXdEZXNjcmlwdGlvbjsKICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGl0bGUgPSBzYXZlZFZpcy50aXRsZTsKICAgICAgICAgICAgICAgIHNhdmVkVmlzLnRpdGxlID0gbmV3VGl0bGU7CiAgICAgICAgICAgICAgICBzYXZlZFZpcy5jb3B5T25TYXZlID0gbmV3Q29weU9uU2F2ZTsKICAgICAgICAgICAgICAgIHNhdmVkVmlzLmRlc2NyaXB0aW9uID0gbmV3RGVzY3JpcHRpb247CiAgICAgICAgICAgICAgICB2YXIgc2F2ZU9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgIGNvbmZpcm1PdmVyd3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkOiBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgICAgICAgICAgICBvblRpdGxlRHVwbGljYXRlOiBvblRpdGxlRHVwbGljYXRlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIGRvU2F2ZShzYXZlT3B0aW9ucykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHNhdmUgd2Fzbid0IHN1Y2Nlc3NmdWwsIHB1dCB0aGUgb3JpZ2luYWwgdmFsdWVzIGJhY2suCiAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuaWQgfHwgcmVzcG9uc2UuZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBzYXZlZFZpcy50aXRsZSA9IGN1cnJlbnRUaXRsZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkxhYmVsID0gJHNjb3BlLmlzQWRkVG9EYXNoTW9kZSgpID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICAgIGlkOiAia2JuLnZpc3VhbGl6ZS5zYXZlRGlhbG9nLnNhdmVBbmRBZGRUb0Rhc2hib2FyZEJ1dHRvbkxhYmVsIiwKICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSBhbmQgYWRkIHRvIGRhc2hib2FyZCIKICAgICAgICAgICAgICB9KSA6IG51bGw7CiAgICAgICAgICAgICAgc2F2ZU1vZGFsID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfbGVnYWN5X2ltcG9ydHMuU2F2ZWRPYmplY3RTYXZlTW9kYWwsIHsKICAgICAgICAgICAgICAgIG9uU2F2ZTogb25TYXZlLAogICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gb25DbG9zZSgpIHt9LAogICAgICAgICAgICAgICAgdGl0bGU6IHNhdmVkVmlzLnRpdGxlLAogICAgICAgICAgICAgICAgc2hvd0NvcHlPblNhdmU6IHNhdmVkVmlzLmlkID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICAgICAgb2JqZWN0VHlwZTogInZpc3VhbGl6YXRpb24iLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkxhYmVsOiBjb25maXJtQnV0dG9uTGFiZWwsCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogc2F2ZWRWaXMuZGVzY3JpcHRpb24KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAoMCwgX2xlZ2FjeV9pbXBvcnRzLnNob3dTYXZlTW9kYWwpKHNhdmVNb2RhbCk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH1dIDogW10pLCBbewogICAgaWQ6ICdzaGFyZScsCiAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi50b3BOYXZNZW51LnNoYXJlVmlzdWFsaXphdGlvbkJ1dHRvbkxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ3NoYXJlJwogICAgfSksCiAgICBkZXNjcmlwdGlvbjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi52aXN1YWxpemUudG9wTmF2TWVudS5zaGFyZVZpc3VhbGl6YXRpb25CdXR0b25BcmlhTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2hhcmUgVmlzdWFsaXphdGlvbicKICAgIH0pLAogICAgdGVzdElkOiAnc2hhcmVUb3BOYXZCdXR0b24nLAogICAgcnVuOiBmdW5jdGlvbiBydW4oYW5jaG9yRWxlbWVudCkgewogICAgICB2YXIgaGFzVW5hcHBsaWVkQ2hhbmdlcyA9IHZpcy5kaXJ0eTsKICAgICAgdmFyIGhhc1Vuc2F2ZWRDaGFuZ2VzID0gJGFwcFN0YXR1cy5kaXJ0eTsKICAgICAgc2hhcmUudG9nZ2xlU2hhcmVDb250ZXh0TWVudSh7CiAgICAgICAgYW5jaG9yRWxlbWVudDogYW5jaG9yRWxlbWVudCwKICAgICAgICBhbGxvd0VtYmVkOiB0cnVlLAogICAgICAgIGFsbG93U2hvcnRVcmw6IHZpc3VhbGl6ZUNhcGFiaWxpdGllcy5jcmVhdGVTaG9ydFVybCwKICAgICAgICBzaGFyZWFibGVVcmw6ICgwLCBfcHVibGljMi51bmhhc2hVcmwpKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSwKICAgICAgICBvYmplY3RJZDogc2F2ZWRWaXMuaWQsCiAgICAgICAgb2JqZWN0VHlwZTogJ3Zpc3VhbGl6YXRpb24nLAogICAgICAgIHNoYXJpbmdEYXRhOiB7CiAgICAgICAgICB0aXRsZTogc2F2ZWRWaXMudGl0bGUKICAgICAgICB9LAogICAgICAgIGlzRGlydHk6IGhhc1VuYXBwbGllZENoYW5nZXMgfHwgaGFzVW5zYXZlZENoYW5nZXMKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAgaWQ6ICdpbnNwZWN0b3InLAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udG9wTmF2TWVudS5vcGVuSW5zcGVjdG9yQnV0dG9uTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnaW5zcGVjdCcKICAgIH0pLAogICAgZGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLnRvcE5hdk1lbnUub3Blbkluc3BlY3RvckJ1dHRvbkFyaWFMYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdPcGVuIEluc3BlY3RvciBmb3IgdmlzdWFsaXphdGlvbicKICAgIH0pLAogICAgdGVzdElkOiAnb3Blbkluc3BlY3RvckJ1dHRvbicsCiAgICBkaXNhYmxlQnV0dG9uOiBmdW5jdGlvbiBkaXNhYmxlQnV0dG9uKCkgewogICAgICByZXR1cm4gIXZpcy5oYXNJbnNwZWN0b3IgfHwgIXZpcy5oYXNJbnNwZWN0b3IoKTsKICAgIH0sCiAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgdmFyIGluc3BlY3RvclNlc3Npb24gPSB2aXMub3Blbkluc3BlY3RvcigpOyAvLyBDbG9zZSB0aGUgaW5zcGVjdG9yIGlmIHRoaXMgc2NvcGUgaXMgZGVzdHJveWVkIChlLmcuIGJlY2F1c2UgdGhlIHVzZXIgbmF2aWdhdGVzIGF3YXkpLgoKICAgICAgdmFyIHJlbW92ZVdhdGNoID0gJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGluc3BlY3RvclNlc3Npb24uY2xvc2UoKTsKICAgICAgfSk7IC8vIFJlbW92ZSB0aGF0IHdhdGNoIGluIGNhc2UgdGhlIHVzZXIgY2xvc2VzIHRoZSBpbnNwZWN0b3Igc2Vzc2lvbiBoZXJzZWxmLgoKICAgICAgaW5zcGVjdG9yU2Vzc2lvbi5vbkNsb3NlLmZpbmFsbHkocmVtb3ZlV2F0Y2gpOwogICAgfSwKICAgIHRvb2x0aXA6IGZ1bmN0aW9uIHRvb2x0aXAoKSB7CiAgICAgIGlmICghdmlzLmhhc0luc3BlY3RvciB8fCAhdmlzLmhhc0luc3BlY3RvcigpKSB7CiAgICAgICAgcmV0dXJuIF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLnRvcE5hdk1lbnUub3Blbkluc3BlY3RvckRpc2FibGVkQnV0dG9uVG9vbHRpcCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVGhpcyB2aXN1YWxpemF0aW9uIGRvZXNuJ3Qgc3VwcG9ydCBhbnkgaW5zcGVjdG9ycy4iCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBpZDogJ3JlZnJlc2gnLAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udG9wTmF2TWVudS5yZWZyZXNoQnV0dG9uTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAncmVmcmVzaCcKICAgIH0pLAogICAgZGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLnRvcE5hdk1lbnUucmVmcmVzaEJ1dHRvbkFyaWFMYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZWZyZXNoJwogICAgfSksCiAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgdmlzLmZvcmNlUmVsb2FkKCk7CiAgICB9LAogICAgdGVzdElkOiAndmlzdWFsaXplUmVmcmVzaEJ1dHRvbicKICB9XSk7CiAgdmFyIHN0YXRlTW9uaXRvcjsKCiAgaWYgKHNhdmVkVmlzLmlkKSB7CiAgICBjaHJvbWUuZG9jVGl0bGUuY2hhbmdlKHNhdmVkVmlzLnRpdGxlKTsKICB9IC8vIEV4dHJhY3QgdmlzdWFsaXphdGlvbiBzdGF0ZSB3aXRoIGZpbHRlcmVkIGFnZ3MuIFlvdSBjYW4gc2VlIHRoZXNlIGZpbHRlcmVkIGFnZ3MgaW4gdGhlIFVSTC4KICAvLyBDb25zaXN0cyBvZiB0aGluZ3MgbGlrZSBhZ2dzLCBwYXJhbXMsIGxpc3RlbmVycywgdGl0bGUsIHR5cGUsIGV0Yy4KCgogIHZhciBzYXZlZFZpc1N0YXRlID0gdmlzLmdldFN0YXRlKCk7CiAgdmFyIHN0YXRlRGVmYXVsdHMgPSB7CiAgICB1aVN0YXRlOiBzYXZlZFZpcy51aVN0YXRlSlNPTiA/IEpTT04ucGFyc2Uoc2F2ZWRWaXMudWlTdGF0ZUpTT04pIDoge30sCiAgICBsaW5rZWQ6ICEhc2F2ZWRWaXMuc2F2ZWRTZWFyY2hJZCwKICAgIHF1ZXJ5OiBzZWFyY2hTb3VyY2UuZ2V0T3duRmllbGQoJ3F1ZXJ5JykgfHwgewogICAgICBxdWVyeTogJycsCiAgICAgIGxhbmd1YWdlOiBsb2NhbFN0b3JhZ2UuZ2V0KCdraWJhbmEudXNlclF1ZXJ5TGFuZ3VhZ2UnKSB8fCB1aVNldHRpbmdzLmdldCgnc2VhcmNoOnF1ZXJ5TGFuZ3VhZ2UnKQogICAgfSwKICAgIGZpbHRlcnM6IHNlYXJjaFNvdXJjZS5nZXRPd25GaWVsZCgnZmlsdGVyJykgfHwgW10sCiAgICB2aXM6IHNhdmVkVmlzU3RhdGUKICB9OyAvLyBJbnN0YW5jZSBvZiBhcHBfc3RhdGUuanMuCgogIHZhciAkc3RhdGUgPSBmdW5jdGlvbiBpbml0U3RhdGUoKSB7CiAgICAvLyBUaGlzIGlzIHVzZWQgdG8gc3luYyB2aXN1YWxpemF0aW9uIHN0YXRlIHdpdGggdGhlIHVybCB3aGVuIGBhcHBTdGF0ZS5zYXZlKClgIGlzIGNhbGxlZC4KICAgIHZhciBhcHBTdGF0ZSA9IG5ldyBBcHBTdGF0ZShzdGF0ZURlZmF1bHRzKTsgLy8gSW5pdGlhbGl6aW5nIGFwcFN0YXRlIGRvZXMgdHdvIHRoaW5ncyAtIGZpcnN0IGl0IHRyYW5zbGF0ZXMgdGhlIGRlZmF1bHRzIGludG8gQXBwU3RhdGUsCiAgICAvLyBzZWNvbmQgaXQgdXBkYXRlcyBhcHBTdGF0ZSBiYXNlZCBvbiB0aGUgdXJsICh0aGUgdXJsIHRydW1wcyB0aGUgZGVmYXVsdHMpLiBUaGlzIG1lYW5zIGlmCiAgICAvLyB3ZSB1cGRhdGUgdGhlIHN0YXRlIGZvcm1hdCBhdCBhbGwgYW5kIHdhbnQgdG8gaGFuZGxlIEJXQywgd2UgbXVzdCBub3Qgb25seSBtaWdyYXRlIHRoZQogICAgLy8gZGF0YSBzdG9yZWQgd2l0aCBzYXZlZCB2aXMsIGJ1dCBhbHNvIGFueSBvbGQgc3RhdGUgaW4gdGhlIHVybC4KCiAgICAoMCwgX2xpYi5taWdyYXRlQXBwU3RhdGUpKGFwcFN0YXRlKTsgLy8gVGhlIHNhdmVkVmlzIGlzIHB1bGxlZCBmcm9tIGVsYXN0aWNzZWFyY2gsIGJ1dCB0aGUgYXBwU3RhdGUgaXMgcHVsbGVkIGZyb20gdGhlIHVybCwgd2l0aCB0aGUKICAgIC8vIGRlZmF1bHRzIGFwcGxpZWQuIElmIHRoZSB1cmwgd2FzIGZyb20gYSBwcmV2aW91cyBzZXNzaW9uIHdoaWNoIGluY2x1ZGVkIG1vZGlmaWNhdGlvbnMgdG8gdGhlCiAgICAvLyBhcHBTdGF0ZSB0aGVuIHRoZXkgd29uJ3QgYmUgZXF1YWwuCgogICAgaWYgKCFfYW5ndWxhci5kZWZhdWx0LmVxdWFscyhhcHBTdGF0ZS52aXMsIHNhdmVkVmlzU3RhdGUpKSB7CiAgICAgIFByb21pc2UudHJ5KGZ1bmN0aW9uICgpIHsKICAgICAgICB2aXMuc2V0U3RhdGUoYXBwU3RhdGUudmlzKTsKICAgICAgfSkuY2F0Y2gocmVkaXJlY3RXaGVuTWlzc2luZyh7CiAgICAgICAgJ2luZGV4LXBhdHRlcm4tZmllbGQnOiAnL3Zpc3VhbGl6ZScKICAgICAgfSkpOwogICAgfQoKICAgIHJldHVybiBhcHBTdGF0ZTsKICB9KCk7CgogICRzY29wZS5maWx0ZXJzID0gcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpOwoKICAkc2NvcGUub25GaWx0ZXJzVXBkYXRlZCA9IGZ1bmN0aW9uIChmaWx0ZXJzKSB7CiAgICAvLyBUaGUgZmlsdGVycyB3aWxsIGF1dG9tYXRpY2FsbHkgYmUgc2V0IHdoZW4gdGhlIHF1ZXJ5RmlsdGVyIGVtaXRzIGFuIHVwZGF0ZSBldmVudCAoc2VlIGJlbG93KQogICAgcXVlcnlGaWx0ZXIuc2V0RmlsdGVycyhmaWx0ZXJzKTsKICB9OwoKICAkc2NvcGUuc2hvd1NhdmVRdWVyeSA9IHZpc3VhbGl6ZUNhcGFiaWxpdGllcy5zYXZlUXVlcnk7CiAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdmlzdWFsaXplQ2FwYWJpbGl0aWVzLnNhdmVRdWVyeTsKICB9LCBmdW5jdGlvbiAobmV3Q2FwYWJpbGl0eSkgewogICAgJHNjb3BlLnNob3dTYXZlUXVlcnkgPSBuZXdDYXBhYmlsaXR5OwogIH0pOwoKICBmdW5jdGlvbiBpbml0KCkgewogICAgLy8gZXhwb3J0IHNvbWUgb2JqZWN0cwogICAgJHNjb3BlLnNhdmVkVmlzID0gc2F2ZWRWaXM7CgogICAgaWYgKHZpcy5pbmRleFBhdHRlcm4pIHsKICAgICAgJHNjb3BlLmluZGV4UGF0dGVybiA9IHZpcy5pbmRleFBhdHRlcm47CiAgICB9IGVsc2UgewogICAgICBpbmRleFBhdHRlcm5zLmdldERlZmF1bHQoKS50aGVuKGZ1bmN0aW9uIChkZWZhdWx0SW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgJHNjb3BlLmluZGV4UGF0dGVybiA9IGRlZmF1bHRJbmRleFBhdHRlcm47CiAgICAgIH0pOwogICAgfQoKICAgICRzY29wZS5zZWFyY2hTb3VyY2UgPSBzZWFyY2hTb3VyY2U7CiAgICAkc2NvcGUuc3RhdGUgPSAkc3RhdGU7CiAgICAkc2NvcGUucmVmcmVzaEludGVydmFsID0gdGltZWZpbHRlci5nZXRSZWZyZXNoSW50ZXJ2YWwoKTsgLy8gQ3JlYXRlIGEgUGVyc2lzdGVkU3RhdGUgaW5zdGFuY2UuCgogICAgJHNjb3BlLnVpU3RhdGUgPSAkc3RhdGUubWFrZVN0YXRlZnVsKCd1aVN0YXRlJyk7CiAgICAkc2NvcGUuYXBwU3RhdHVzID0gJGFwcFN0YXR1czsKICAgIHZhciBhZGRUb0Rhc2hNb2RlID0gJHJvdXRlLmN1cnJlbnQucGFyYW1zW19sZWdhY3lfaW1wb3J0cy5EYXNoYm9hcmRDb25zdGFudHMuQUREX1ZJU1VBTElaQVRJT05fVE9fREFTSEJPQVJEX01PREVfUEFSQU1dOwogICAga2JuVXJsLnJlbW92ZVBhcmFtKF9sZWdhY3lfaW1wb3J0cy5EYXNoYm9hcmRDb25zdGFudHMuQUREX1ZJU1VBTElaQVRJT05fVE9fREFTSEJPQVJEX01PREVfUEFSQU0pOwoKICAgICRzY29wZS5pc0FkZFRvRGFzaE1vZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBhZGRUb0Rhc2hNb2RlOwogICAgfTsKCiAgICAkc2NvcGUuc2hvd0ZpbHRlckJhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHZpcy50eXBlLm9wdGlvbnMuc2hvd0ZpbHRlckJhcjsKICAgIH07CgogICAgJHNjb3BlLnNob3dRdWVyeUlucHV0ID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdmlzLnR5cGUucmVxdWlyZXNTZWFyY2ggJiYgdmlzLnR5cGUub3B0aW9ucy5zaG93UXVlcnlCYXI7CiAgICB9OwoKICAgICRzY29wZS5zaG93UXVlcnlCYXJUaW1lUGlja2VyID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdmlzLnR5cGUub3B0aW9ucy5zaG93VGltZVBpY2tlcjsKICAgIH07CgogICAgJHNjb3BlLnRpbWVSYW5nZSA9IHRpbWVmaWx0ZXIuZ2V0VGltZSgpOwogICAgJHNjb3BlLm9wdHMgPSBfbG9kYXNoLmRlZmF1bHQucGljaygkc2NvcGUsICdzYXZlZFZpcycsICdpc0FkZFRvRGFzaE1vZGUnKTsKICAgIHN0YXRlTW9uaXRvciA9IF9sZWdhY3lfaW1wb3J0cy5zdGF0ZU1vbml0b3JGYWN0b3J5LmNyZWF0ZSgkc3RhdGUsIHN0YXRlRGVmYXVsdHMpOwogICAgc3RhdGVNb25pdG9yLmlnbm9yZVByb3BzKFsndmlzLmxpc3RlbmVycyddKS5vbkNoYW5nZShmdW5jdGlvbiAoc3RhdHVzKSB7CiAgICAgICRhcHBTdGF0dXMuZGlydHkgPSBzdGF0dXMuZGlydHkgfHwgIXNhdmVkVmlzLmlkOwogICAgfSk7CiAgICAkc2NvcGUuJHdhdGNoKCdzdGF0ZS5xdWVyeScsIGZ1bmN0aW9uIChuZXdRdWVyeSwgb2xkUXVlcnkpIHsKICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChuZXdRdWVyeSwgb2xkUXVlcnkpKSB7CiAgICAgICAgdmFyIHF1ZXJ5ID0gKDAsIF9sZWdhY3lfaW1wb3J0cy5taWdyYXRlTGVnYWN5UXVlcnkpKG5ld1F1ZXJ5KTsKCiAgICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChxdWVyeSwgbmV3UXVlcnkpKSB7CiAgICAgICAgICAkc3RhdGUucXVlcnkgPSBxdWVyeTsKICAgICAgICB9CgogICAgICAgICRzY29wZS5mZXRjaCgpOwogICAgICB9CiAgICB9KTsKICAgICRzdGF0ZS5yZXBsYWNlKCk7CgogICAgdmFyIHVwZGF0ZVRpbWVSYW5nZSA9IGZ1bmN0aW9uIHVwZGF0ZVRpbWVSYW5nZSgpIHsKICAgICAgJHNjb3BlLnRpbWVSYW5nZSA9IHRpbWVmaWx0ZXIuZ2V0VGltZSgpOwogICAgICAkc2NvcGUuJGJyb2FkY2FzdCgncmVuZGVyJyk7CiAgICB9OwoKICAgIHZhciBzdWJzY3JpcHRpb25zID0gbmV3IF9yeGpzLlN1YnNjcmlwdGlvbigpOwogICAgc3Vic2NyaXB0aW9ucy5hZGQoKDAsIF9sZWdhY3lfaW1wb3J0cy5zdWJzY3JpYmVXaXRoU2NvcGUpKCRzY29wZSwgdGltZWZpbHRlci5nZXRSZWZyZXNoSW50ZXJ2YWxVcGRhdGUkKCksIHsKICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAkc2NvcGUucmVmcmVzaEludGVydmFsID0gdGltZWZpbHRlci5nZXRSZWZyZXNoSW50ZXJ2YWwoKTsKICAgICAgfQogICAgfSkpOwogICAgc3Vic2NyaXB0aW9ucy5hZGQoKDAsIF9sZWdhY3lfaW1wb3J0cy5zdWJzY3JpYmVXaXRoU2NvcGUpKCRzY29wZSwgdGltZWZpbHRlci5nZXRUaW1lVXBkYXRlJCgpLCB7CiAgICAgIG5leHQ6IHVwZGF0ZVRpbWVSYW5nZQogICAgfSkpOwogICAgc3Vic2NyaXB0aW9ucy5hZGQoY2hyb21lLmdldElzVmlzaWJsZSQoKS5zdWJzY3JpYmUoZnVuY3Rpb24gKGlzVmlzaWJsZSkgewogICAgICAkc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgJHNjb3BlLmlzVmlzaWJsZSA9IGlzVmlzaWJsZTsKICAgICAgfSk7CiAgICB9KSk7IC8vIHVwZGF0ZSB0aGUgc2VhcmNoU291cmNlIHdoZW4gcXVlcnkgdXBkYXRlcwoKICAgICRzY29wZS5mZXRjaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgJHN0YXRlLnNhdmUoKTsKICAgICAgJHNjb3BlLnF1ZXJ5ID0gJHN0YXRlLnF1ZXJ5OwogICAgICBzYXZlZFZpcy5zZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3F1ZXJ5JywgJHN0YXRlLnF1ZXJ5KTsKICAgICAgc2F2ZWRWaXMuc2VhcmNoU291cmNlLnNldEZpZWxkKCdmaWx0ZXInLCAkc3RhdGUuZmlsdGVycyk7CiAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdyZW5kZXInKTsKICAgIH07IC8vIHVwZGF0ZSB0aGUgc2VhcmNoU291cmNlIHdoZW4gZmlsdGVycyB1cGRhdGUKCgogICAgc3Vic2NyaXB0aW9ucy5hZGQoKDAsIF9sZWdhY3lfaW1wb3J0cy5zdWJzY3JpYmVXaXRoU2NvcGUpKCRzY29wZSwgcXVlcnlGaWx0ZXIuZ2V0VXBkYXRlcyQoKSwgewogICAgICBuZXh0OiBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgICRzY29wZS5maWx0ZXJzID0gcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpOwogICAgICAgICRzY29wZS5nbG9iYWxGaWx0ZXJzID0gcXVlcnlGaWx0ZXIuZ2V0R2xvYmFsRmlsdGVycygpOwogICAgICB9CiAgICB9KSk7CiAgICBzdWJzY3JpcHRpb25zLmFkZCgoMCwgX2xlZ2FjeV9pbXBvcnRzLnN1YnNjcmliZVdpdGhTY29wZSkoJHNjb3BlLCBxdWVyeUZpbHRlci5nZXRGZXRjaGVzJCgpLCB7CiAgICAgIG5leHQ6ICRzY29wZS5mZXRjaAogICAgfSkpOwogICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICgkc2NvcGUuX2hhbmRsZXIpIHsKICAgICAgICAkc2NvcGUuX2hhbmRsZXIuZGVzdHJveSgpOwogICAgICB9CgogICAgICBzYXZlZFZpcy5kZXN0cm95KCk7CiAgICAgIHN0YXRlTW9uaXRvci5kZXN0cm95KCk7CiAgICAgIGZpbHRlclN0YXRlTWFuYWdlci5kZXN0cm95KCk7CiAgICAgIHN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKTsKICAgICAgJHNjb3BlLnZpcy5vZmYoJ2FwcGx5JywgX2FwcGx5VmlzKTsKICAgIH0pOwogICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAkc2NvcGUuJGJyb2FkY2FzdCgncmVuZGVyJyk7CiAgICB9KTsKICB9CgogICRzY29wZS51cGRhdGVRdWVyeUFuZEZldGNoID0gZnVuY3Rpb24gKF9yZWYyKSB7CiAgICB2YXIgcXVlcnkgPSBfcmVmMi5xdWVyeSwKICAgICAgICBkYXRlUmFuZ2UgPSBfcmVmMi5kYXRlUmFuZ2U7CiAgICB2YXIgaXNVcGRhdGUgPSBxdWVyeSAmJiAhX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwocXVlcnksICRzdGF0ZS5xdWVyeSkgfHwgZGF0ZVJhbmdlICYmICFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChkYXRlUmFuZ2UsICRzY29wZS50aW1lUmFuZ2UpOwogICAgJHN0YXRlLnF1ZXJ5ID0gcXVlcnk7CiAgICB0aW1lZmlsdGVyLnNldFRpbWUoZGF0ZVJhbmdlKTsgLy8gSWYgbm90aGluZyBoYXMgY2hhbmdlZCwgdHJpZ2dlciB0aGUgZmV0Y2ggbWFudWFsbHksIG90aGVyd2lzZSBpdCB3aWxsIGhhcHBlbiBhcyBhIHJlc3VsdCBvZiB0aGUgY2hhbmdlcwoKICAgIGlmICghaXNVcGRhdGUpIHsKICAgICAgJHNjb3BlLnZpcy5mb3JjZVJlbG9hZCgpOwogICAgfQogIH07CgogICRzY29wZS5vblJlZnJlc2hDaGFuZ2UgPSBmdW5jdGlvbiAoX3JlZjMpIHsKICAgIHZhciBpc1BhdXNlZCA9IF9yZWYzLmlzUGF1c2VkLAogICAgICAgIHJlZnJlc2hJbnRlcnZhbCA9IF9yZWYzLnJlZnJlc2hJbnRlcnZhbDsKICAgIHRpbWVmaWx0ZXIuc2V0UmVmcmVzaEludGVydmFsKHsKICAgICAgcGF1c2U6IGlzUGF1c2VkLAogICAgICB2YWx1ZTogcmVmcmVzaEludGVydmFsID8gcmVmcmVzaEludGVydmFsIDogJHNjb3BlLnJlZnJlc2hJbnRlcnZhbC52YWx1ZQogICAgfSk7CiAgfTsKCiAgJHNjb3BlLm9uUXVlcnlTYXZlZCA9IGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHNhdmVkUXVlcnk7CiAgfTsKCiAgJHNjb3BlLm9uU2F2ZWRRdWVyeVVwZGF0ZWQgPSBmdW5jdGlvbiAoc2F2ZWRRdWVyeSkgewogICAgJHNjb3BlLnNhdmVkUXVlcnkgPSBfb2JqZWN0U3ByZWFkKHt9LCBzYXZlZFF1ZXJ5KTsKICB9OwoKICAkc2NvcGUub25DbGVhclNhdmVkUXVlcnkgPSBmdW5jdGlvbiAoKSB7CiAgICBkZWxldGUgJHNjb3BlLnNhdmVkUXVlcnk7CiAgICBkZWxldGUgJHN0YXRlLnNhdmVkUXVlcnk7CiAgICAkc3RhdGUucXVlcnkgPSB7CiAgICAgIHF1ZXJ5OiAnJywKICAgICAgbGFuZ3VhZ2U6IGxvY2FsU3RvcmFnZS5nZXQoJ2tpYmFuYS51c2VyUXVlcnlMYW5ndWFnZScpIHx8IHVpU2V0dGluZ3MuZ2V0KCdzZWFyY2g6cXVlcnlMYW5ndWFnZScpCiAgICB9OwogICAgcXVlcnlGaWx0ZXIucmVtb3ZlQWxsKCk7CiAgICAkc3RhdGUuc2F2ZSgpOwogICAgJHNjb3BlLmZldGNoKCk7CiAgfTsKCiAgdmFyIHVwZGF0ZVN0YXRlRnJvbVNhdmVkUXVlcnkgPSBmdW5jdGlvbiB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KHNhdmVkUXVlcnkpIHsKICAgICRzdGF0ZS5xdWVyeSA9IHNhdmVkUXVlcnkuYXR0cmlidXRlcy5xdWVyeTsKICAgICRzdGF0ZS5zYXZlKCk7CiAgICBxdWVyeUZpbHRlci5zZXRGaWx0ZXJzKHNhdmVkUXVlcnkuYXR0cmlidXRlcy5maWx0ZXJzIHx8IFtdKTsKCiAgICBpZiAoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIpIHsKICAgICAgdGltZWZpbHRlci5zZXRUaW1lKHsKICAgICAgICBmcm9tOiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5mcm9tLAogICAgICAgIHRvOiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci50bwogICAgICB9KTsKCiAgICAgIGlmIChzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5yZWZyZXNoSW50ZXJ2YWwpIHsKICAgICAgICB0aW1lZmlsdGVyLnNldFJlZnJlc2hJbnRlcnZhbChzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5yZWZyZXNoSW50ZXJ2YWwpOwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLmZldGNoKCk7CiAgfTsKCiAgJHNjb3BlLiR3YXRjaCgnc2F2ZWRRdWVyeScsIGZ1bmN0aW9uIChuZXdTYXZlZFF1ZXJ5KSB7CiAgICBpZiAoIW5ld1NhdmVkUXVlcnkpIHJldHVybjsKICAgICRzdGF0ZS5zYXZlZFF1ZXJ5ID0gbmV3U2F2ZWRRdWVyeS5pZDsKICAgICRzdGF0ZS5zYXZlKCk7CiAgICB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KG5ld1NhdmVkUXVlcnkpOwogIH0pOwogICRzY29wZS4kd2F0Y2goJ3N0YXRlLnNhdmVkUXVlcnknLCBmdW5jdGlvbiAobmV3U2F2ZWRRdWVyeUlkKSB7CiAgICBpZiAoIW5ld1NhdmVkUXVlcnlJZCkgewogICAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHVuZGVmaW5lZDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICghJHNjb3BlLnNhdmVkUXVlcnkgfHwgbmV3U2F2ZWRRdWVyeUlkICE9PSAkc2NvcGUuc2F2ZWRRdWVyeS5pZCkgewogICAgICBzYXZlZFF1ZXJ5U2VydmljZS5nZXRTYXZlZFF1ZXJ5KG5ld1NhdmVkUXVlcnlJZCkudGhlbihmdW5jdGlvbiAoc2F2ZWRRdWVyeSkgewogICAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICRzY29wZS5zYXZlZFF1ZXJ5ID0gc2F2ZWRRdWVyeTsKICAgICAgICAgIHVwZGF0ZVN0YXRlRnJvbVNhdmVkUXVlcnkoc2F2ZWRRdWVyeSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0pOwogIC8qKgogICAqIENhbGxlZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyAiU2F2ZSIgYnV0dG9uLgogICAqLwoKICBmdW5jdGlvbiBkb1NhdmUoc2F2ZU9wdGlvbnMpIHsKICAgIC8vIHZpcy50aXRsZSB3YXMgbm90IGJvdW5kIGFuZCBpdCdzIG5lZWRlZCB0byByZWZsZWN0IHRpdGxlIGludG8gdmlzU3RhdGUKICAgICRzdGF0ZS52aXMudGl0bGUgPSBzYXZlZFZpcy50aXRsZTsKICAgICRzdGF0ZS52aXMudHlwZSA9IHNhdmVkVmlzLnR5cGUgfHwgJHN0YXRlLnZpcy50eXBlOwogICAgc2F2ZWRWaXMudmlzU3RhdGUgPSAkc3RhdGUudmlzOwogICAgc2F2ZWRWaXMudWlTdGF0ZUpTT04gPSBfYW5ndWxhci5kZWZhdWx0LnRvSnNvbigkc2NvcGUudWlTdGF0ZS5nZXRDaGFuZ2VzKCkpOwogICAgcmV0dXJuIHNhdmVkVmlzLnNhdmUoc2F2ZU9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKGlkKSB7CiAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICBzdGF0ZU1vbml0b3Iuc2V0SW5pdGlhbFN0YXRlKCRzdGF0ZS50b0pTT04oKSk7CgogICAgICAgIGlmIChpZCkgewogICAgICAgICAgdG9hc3ROb3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MoewogICAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi52aXN1YWxpemUudG9wTmF2TWVudS5zYXZlVmlzdWFsaXphdGlvbi5zdWNjZXNzTm90aWZpY2F0aW9uVGV4dCcsIHsKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmVkICd7dmlzVGl0bGV9JyIsCiAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICB2aXNUaXRsZTogc2F2ZWRWaXMudGl0bGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAnZGF0YS10ZXN0LXN1YmonOiAnc2F2ZVZpc3VhbGl6YXRpb25TdWNjZXNzJwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKCRzY29wZS5pc0FkZFRvRGFzaE1vZGUoKSkgewogICAgICAgICAgICB2YXIgc2F2ZWRWaXN1YWxpemF0aW9uUGFyc2VkVXJsID0gbmV3IF9sZWdhY3lfaW1wb3J0cy5LaWJhbmFQYXJzZWRVcmwoewogICAgICAgICAgICAgIGJhc2VQYXRoOiBnZXRCYXNlUGF0aCgpLAogICAgICAgICAgICAgIGFwcElkOiBrYm5CYXNlVXJsLnNsaWNlKCcvYXBwLycubGVuZ3RoKSwKICAgICAgICAgICAgICBhcHBQYXRoOiBrYm5VcmwuZXZhbCgiIi5jb25jYXQoX3Zpc3VhbGl6ZV9jb25zdGFudHMuVmlzdWFsaXplQ29uc3RhbnRzLkVESVRfUEFUSCwgIi97e2lkfX0iKSwgewogICAgICAgICAgICAgICAgaWQ6IHNhdmVkVmlzLmlkCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7IC8vIE1hbnVhbGx5IGluc2VydCBhIG5ldyB1cmwgc28gdGhlIGJhY2sgYnV0dG9uIHdpbGwgb3BlbiB0aGUgc2F2ZWQgdmlzdWFsaXphdGlvbi4KCiAgICAgICAgICAgICR3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoe30sICcnLCBzYXZlZFZpc3VhbGl6YXRpb25QYXJzZWRVcmwuZ2V0Um9vdFJlbGF0aXZlUGF0aCgpKTsgLy8gU2luY2Ugd2UgYXJlbid0IHJlbG9hZGluZyB0aGUgcGFnZSwgb25seSBpbnNlcnRpbmcgYSBuZXcgYnJvd3NlciBoaXN0b3J5IGl0ZW0sIHdlIG5lZWQgdG8gbWFudWFsbHkgdXBkYXRlCiAgICAgICAgICAgIC8vIHRoZSBsYXN0IHVybCBmb3IgdGhpcyBhcHAsIHNvIGRpcmVjdGx5IGNsaWNraW5nIG9uIHRoZSBWaXN1YWxpemUgdGFiIHdpbGwgYWxzbyBicmluZyB0aGUgdXNlciB0byB0aGUgc2F2ZWQKICAgICAgICAgICAgLy8gdXJsLCBub3QgdGhlIHVuc2F2ZWQgb25lLgoKICAgICAgICAgICAgbGVnYWN5Q2hyb21lLnRyYWNrU3ViVXJsRm9yQXBwKCdraWJhbmE6dmlzdWFsaXplJywgc2F2ZWRWaXN1YWxpemF0aW9uUGFyc2VkVXJsKTsKICAgICAgICAgICAgdmFyIGxhc3REYXNoYm9hcmRBYnNvbHV0ZVVybCA9IGNocm9tZS5uYXZMaW5rcy5nZXQoJ2tpYmFuYTpkYXNoYm9hcmQnKS51cmw7CiAgICAgICAgICAgIHZhciBkYXNoYm9hcmRQYXJzZWRVcmwgPSAoMCwgX2xlZ2FjeV9pbXBvcnRzLmFic29sdXRlVG9QYXJzZWRVcmwpKGxhc3REYXNoYm9hcmRBYnNvbHV0ZVVybCwgZ2V0QmFzZVBhdGgoKSk7CiAgICAgICAgICAgIGRhc2hib2FyZFBhcnNlZFVybC5hZGRRdWVyeVBhcmFtZXRlcihfbGVnYWN5X2ltcG9ydHMuRGFzaGJvYXJkQ29uc3RhbnRzLkFERF9FTUJFRERBQkxFX1RZUEUsIF9sZWdhY3lfaW1wb3J0cy5WSVNVQUxJWkVfRU1CRUREQUJMRV9UWVBFKTsKICAgICAgICAgICAgZGFzaGJvYXJkUGFyc2VkVXJsLmFkZFF1ZXJ5UGFyYW1ldGVyKF9sZWdhY3lfaW1wb3J0cy5EYXNoYm9hcmRDb25zdGFudHMuQUREX0VNQkVEREFCTEVfSUQsIHNhdmVkVmlzLmlkKTsKICAgICAgICAgICAga2JuVXJsLmNoYW5nZShkYXNoYm9hcmRQYXJzZWRVcmwuYXBwUGF0aCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHNhdmVkVmlzLmlkID09PSAkcm91dGUuY3VycmVudC5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgY2hyb21lLmRvY1RpdGxlLmNoYW5nZShzYXZlZFZpcy5sYXN0U2F2ZWRUaXRsZSk7CiAgICAgICAgICAgIGNocm9tZS5zZXRCcmVhZGNydW1icygkaW5qZWN0b3IuaW52b2tlKF9icmVhZGNydW1icy5nZXRFZGl0QnJlYWRjcnVtYnMpKTsKICAgICAgICAgICAgc2F2ZWRWaXMudmlzLnRpdGxlID0gc2F2ZWRWaXMudGl0bGU7CiAgICAgICAgICAgIHNhdmVkVmlzLnZpcy5kZXNjcmlwdGlvbiA9IHNhdmVkVmlzLmRlc2NyaXB0aW9uOyAvLyBpdCdzIG5lZWRlZCB0byBzYXZlIHRoZSBzdGF0ZSB0byB1cGRhdGUgdXJsIHN0cmluZwoKICAgICAgICAgICAgJHN0YXRlLnNhdmUoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGtiblVybC5jaGFuZ2UoIiIuY29uY2F0KF92aXN1YWxpemVfY29uc3RhbnRzLlZpc3VhbGl6ZUNvbnN0YW50cy5FRElUX1BBVEgsICIve3tpZH19IiksIHsKICAgICAgICAgICAgICBpZDogc2F2ZWRWaXMuaWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogaWQKICAgICAgfTsKICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgIHRvYXN0Tm90aWZpY2F0aW9ucy5hZGREYW5nZXIoewogICAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLnZpc3VhbGl6ZS50b3BOYXZNZW51LnNhdmVWaXN1YWxpemF0aW9uLmZhaWx1cmVOb3RpZmljYXRpb25UZXh0JywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJFcnJvciBvbiBzYXZpbmcgJ3t2aXNUaXRsZX0nIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICB2aXNUaXRsZTogc2F2ZWRWaXMudGl0bGUKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICB0ZXh0OiBlcnJvci5tZXNzYWdlLAogICAgICAgICdkYXRhLXRlc3Qtc3Viaic6ICdzYXZlVmlzdWFsaXphdGlvbkVycm9yJwogICAgICB9KTsKICAgICAgcmV0dXJuIHsKICAgICAgICBlcnJvcjogZXJyb3IKICAgICAgfTsKICAgIH0pOwogIH0KCiAgJHNjb3BlLnVubGluayA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICghJHN0YXRlLmxpbmtlZCkgcmV0dXJuOwogICAgJHN0YXRlLmxpbmtlZCA9IGZhbHNlOwogICAgdmFyIHNlYXJjaFNvdXJjZVBhcmVudCA9IHNlYXJjaFNvdXJjZS5nZXRQYXJlbnQoKTsKICAgIHZhciBzZWFyY2hTb3VyY2VHcmFuZHBhcmVudCA9IHNlYXJjaFNvdXJjZVBhcmVudC5nZXRQYXJlbnQoKTsKICAgIGRlbGV0ZSBzYXZlZFZpcy5zYXZlZFNlYXJjaElkOwogICAgZGVsZXRlIHZpcy5zYXZlZFNlYXJjaElkOwogICAgc2VhcmNoU291cmNlUGFyZW50LnNldEZpZWxkKCdmaWx0ZXInLCBfbG9kYXNoLmRlZmF1bHQudW5pb24oc2VhcmNoU291cmNlLmdldE93bkZpZWxkKCdmaWx0ZXInKSwgc2VhcmNoU291cmNlUGFyZW50LmdldE93bkZpZWxkKCdmaWx0ZXInKSkpOwogICAgJHN0YXRlLnF1ZXJ5ID0gc2VhcmNoU291cmNlUGFyZW50LmdldEZpZWxkKCdxdWVyeScpOwogICAgJHN0YXRlLmZpbHRlcnMgPSBzZWFyY2hTb3VyY2VQYXJlbnQuZ2V0RmllbGQoJ2ZpbHRlcicpOwogICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdpbmRleCcsIHNlYXJjaFNvdXJjZVBhcmVudC5nZXRGaWVsZCgnaW5kZXgnKSk7CiAgICBzZWFyY2hTb3VyY2Uuc2V0UGFyZW50KHNlYXJjaFNvdXJjZUdyYW5kcGFyZW50KTsKICAgIHRvYXN0Tm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLmxpbmtlZFRvU2VhcmNoLnVubGlua1N1Y2Nlc3NOb3RpZmljYXRpb25UZXh0JywgewogICAgICBkZWZhdWx0TWVzc2FnZTogIlVubGlua2VkIGZyb20gc2F2ZWQgc2VhcmNoICd7c2VhcmNoVGl0bGV9JyIsCiAgICAgIHZhbHVlczogewogICAgICAgIHNlYXJjaFRpdGxlOiBzYXZlZFZpcy5zYXZlZFNlYXJjaC50aXRsZQogICAgICB9CiAgICB9KSk7CiAgICAkc2NvcGUuZmV0Y2goKTsKICB9OwoKICAkc2NvcGUuZ2V0QWRkaXRpb25hbE1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gJzxpIGNsYXNzPSJrdWlJY29uIGZhLWZsYXNrIj48L2k+JyArIF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4udmlzdWFsaXplLmV4cGVyaW1lbnRhbFZpc0luZm9UZXh0JywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ1RoaXMgdmlzdWFsaXphdGlvbiBpcyBtYXJrZWQgYXMgZXhwZXJpbWVudGFsLicKICAgIH0pICsgJyAnICsgdmlzLnR5cGUuZmVlZGJhY2tNZXNzYWdlOwogIH07CgogICgwLCBfaGVscF9tZW51X3V0aWwuYWRkSGVscE1lbnVUb0FwcENocm9tZSkoY2hyb21lLCBkb2NMaW5rcyk7CiAgaW5pdCgpOwp9"},null]}