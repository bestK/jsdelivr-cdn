{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/cross_cluster_replication/public/app/components/auto_follow_pattern_form.js","dependencies":[{"path":"x-pack/legacy/plugins/cross_cluster_replication/public/app/components/auto_follow_pattern_form.js","mtime":1585205044097},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkF1dG9Gb2xsb3dQYXR0ZXJuRm9ybSA9IGV4cG9ydHMudXBkYXRlRm9ybUVycm9ycyA9IHZvaWQgMDsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJwcm9wLXR5cGVzIikpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3JlYWN0MiA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfaW5kaWNlcyA9IHJlcXVpcmUoInVpL2luZGljZXMiKTsKCnZhciBfcm91dGluZyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiLi4vc2VydmljZXMvcm91dGluZyIpKTsKCnZhciBfcXVlcnlfcGFyYW1zID0gcmVxdWlyZSgiLi4vc2VydmljZXMvcXVlcnlfcGFyYW1zIik7Cgp2YXIgX2dldF9yZW1vdGVfY2x1c3Rlcl9uYW1lID0gcmVxdWlyZSgiLi4vc2VydmljZXMvZ2V0X3JlbW90ZV9jbHVzdGVyX25hbWUiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vY29uc3RhbnRzIik7Cgp2YXIgX3NlY3Rpb25fZXJyb3IgPSByZXF1aXJlKCIuL3NlY3Rpb25fZXJyb3IiKTsKCnZhciBfYXV0b19mb2xsb3dfcGF0dGVybl9pbmRpY2VzX3ByZXZpZXcgPSByZXF1aXJlKCIuL2F1dG9fZm9sbG93X3BhdHRlcm5faW5kaWNlc19wcmV2aWV3Iik7Cgp2YXIgX3JlbW90ZV9jbHVzdGVyc19mb3JtX2ZpZWxkID0gcmVxdWlyZSgiLi9yZW1vdGVfY2x1c3RlcnNfZm9ybV9maWVsZCIpOwoKdmFyIF9hdXRvX2ZvbGxvd19wYXR0ZXJuX3ZhbGlkYXRvcnMgPSByZXF1aXJlKCIuLi9zZXJ2aWNlcy9hdXRvX2ZvbGxvd19wYXR0ZXJuX3ZhbGlkYXRvcnMiKTsKCnZhciBfYXV0b19mb2xsb3dfcGF0dGVybl9yZXF1ZXN0X2ZseW91dCA9IHJlcXVpcmUoIi4vYXV0b19mb2xsb3dfcGF0dGVybl9yZXF1ZXN0X2ZseW91dCIpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9kYXRhL3B1YmxpYyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307IHZhciB0YXJnZXQgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKTsgdmFyIGtleSwgaTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHNvdXJjZVN5bWJvbEtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7IGZvciAoaSA9IDA7IGkgPCBzb3VyY2VTeW1ib2xLZXlzLmxlbmd0aDsgaSsrKSB7IGtleSA9IHNvdXJjZVN5bWJvbEtleXNbaV07IGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7IGlmICghT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHNvdXJjZSwga2V5KSkgY29udGludWU7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7IGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OyB2YXIgdGFyZ2V0ID0ge307IHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsgdmFyIGtleSwgaTsgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsga2V5ID0gc291cmNlS2V5c1tpXTsgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIGluZGV4UGF0dGVybklsbGVnYWxDaGFyYWN0ZXJzID0gX3B1YmxpYy5pbmRleFBhdHRlcm5zLklMTEVHQUxfQ0hBUkFDVEVSU19WSVNJQkxFLmpvaW4oJyAnKTsKCnZhciBpbmRleE5hbWVJbGxlZ2FsQ2hhcmFjdGVycyA9IF9pbmRpY2VzLklOREVYX0lMTEVHQUxfQ0hBUkFDVEVSU19WSVNJQkxFLmpvaW4oJyAnKTsKCnZhciBnZXRFbXB0eUF1dG9Gb2xsb3dQYXR0ZXJuID0gZnVuY3Rpb24gZ2V0RW1wdHlBdXRvRm9sbG93UGF0dGVybigpIHsKICB2YXIgcmVtb3RlQ2x1c3Rlck5hbWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcnOwogIHJldHVybiB7CiAgICBuYW1lOiAnJywKICAgIHJlbW90ZUNsdXN0ZXI6IHJlbW90ZUNsdXN0ZXJOYW1lLAogICAgbGVhZGVySW5kZXhQYXR0ZXJuczogW10sCiAgICBmb2xsb3dJbmRleFBhdHRlcm5QcmVmaXg6ICcnLAogICAgZm9sbG93SW5kZXhQYXR0ZXJuU3VmZml4OiAnJwogIH07Cn07Cgp2YXIgdXBkYXRlRm9ybUVycm9ycyA9IGZ1bmN0aW9uIHVwZGF0ZUZvcm1FcnJvcnMoZXJyb3JzLCBleGlzdGluZ0Vycm9ycykgewogIHJldHVybiB7CiAgICBmaWVsZHNFcnJvcnM6IF9vYmplY3RTcHJlYWQoe30sIGV4aXN0aW5nRXJyb3JzLCB7fSwgZXJyb3JzKQogIH07Cn07CgpleHBvcnRzLnVwZGF0ZUZvcm1FcnJvcnMgPSB1cGRhdGVGb3JtRXJyb3JzOwoKdmFyIEF1dG9Gb2xsb3dQYXR0ZXJuRm9ybSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9QdXJlQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKEF1dG9Gb2xsb3dQYXR0ZXJuRm9ybSwgX1B1cmVDb21wb25lbnQpOwoKICBmdW5jdGlvbiBBdXRvRm9sbG93UGF0dGVybkZvcm0ocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXV0b0ZvbGxvd1BhdHRlcm5Gb3JtKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihBdXRvRm9sbG93UGF0dGVybkZvcm0pLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ0b2dnbGVSZXF1ZXN0IiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoX3JlZikgewogICAgICAgIHZhciBpc1JlcXVlc3RWaXNpYmxlID0gX3JlZi5pc1JlcXVlc3RWaXNpYmxlOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpc1JlcXVlc3RWaXNpYmxlOiAhaXNSZXF1ZXN0VmlzaWJsZQogICAgICAgIH07CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZHNDaGFuZ2UiLCBmdW5jdGlvbiAoZmllbGRzKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmMikgewogICAgICAgIHZhciBhdXRvRm9sbG93UGF0dGVybiA9IF9yZWYyLmF1dG9Gb2xsb3dQYXR0ZXJuOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBhdXRvRm9sbG93UGF0dGVybjogX29iamVjdFNwcmVhZCh7fSwgYXV0b0ZvbGxvd1BhdHRlcm4sIHt9LCBmaWVsZHMpCiAgICAgICAgfTsKICAgICAgfSk7CgogICAgICB2YXIgZXJyb3JzID0gKDAsIF9hdXRvX2ZvbGxvd19wYXR0ZXJuX3ZhbGlkYXRvcnMudmFsaWRhdGVBdXRvRm9sbG93UGF0dGVybikoZmllbGRzKTsKCiAgICAgIF90aGlzLm9uRmllbGRzRXJyb3JDaGFuZ2UoZXJyb3JzKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uRmllbGRzRXJyb3JDaGFuZ2UiLCBmdW5jdGlvbiAoZXJyb3JzKSB7CiAgICAgIHJldHVybiBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICB2YXIgZmllbGRzRXJyb3JzID0gX3JlZjMuZmllbGRzRXJyb3JzOwogICAgICAgIHJldHVybiB1cGRhdGVGb3JtRXJyb3JzKGVycm9ycywgZmllbGRzRXJyb3JzKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkNsdXN0ZXJDaGFuZ2UiLCBmdW5jdGlvbiAocmVtb3RlQ2x1c3RlcikgewogICAgICBfdGhpcy5vbkZpZWxkc0NoYW5nZSh7CiAgICAgICAgcmVtb3RlQ2x1c3RlcjogcmVtb3RlQ2x1c3RlcgogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ3JlYXRlTGVhZGVySW5kZXhQYXR0ZXJuIiwgZnVuY3Rpb24gKGluZGV4UGF0dGVybikgewogICAgICB2YXIgZXJyb3IgPSAoMCwgX2F1dG9fZm9sbG93X3BhdHRlcm5fdmFsaWRhdG9ycy52YWxpZGF0ZUxlYWRlckluZGV4UGF0dGVybikoaW5kZXhQYXR0ZXJuKTsKCiAgICAgIGlmIChlcnJvcikgewogICAgICAgIHZhciBlcnJvcnMgPSB7CiAgICAgICAgICBsZWFkZXJJbmRleFBhdHRlcm5zOiBfb2JqZWN0U3ByZWFkKHt9LCBlcnJvciwgewogICAgICAgICAgICBhbHdheXNWaXNpYmxlOiB0cnVlCiAgICAgICAgICB9KQogICAgICAgIH07CgogICAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmNCkgewogICAgICAgICAgdmFyIGZpZWxkc0Vycm9ycyA9IF9yZWY0LmZpZWxkc0Vycm9yczsKICAgICAgICAgIHJldHVybiB1cGRhdGVGb3JtRXJyb3JzKGVycm9ycywgZmllbGRzRXJyb3JzKTsKICAgICAgICB9KTsgLy8gUmV0dXJuIGZhbHNlIHRvIGV4cGxpY2l0bHkgcmVqZWN0IHRoZSB1c2VyJ3MgaW5wdXQuCgoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciBsZWFkZXJJbmRleFBhdHRlcm5zID0gX3RoaXMuc3RhdGUuYXV0b0ZvbGxvd1BhdHRlcm4ubGVhZGVySW5kZXhQYXR0ZXJuczsKICAgICAgdmFyIG5ld0xlYWRlckluZGV4UGF0dGVybnMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGxlYWRlckluZGV4UGF0dGVybnMpLCBbaW5kZXhQYXR0ZXJuXSk7CgogICAgICBfdGhpcy5vbkZpZWxkc0NoYW5nZSh7CiAgICAgICAgbGVhZGVySW5kZXhQYXR0ZXJuczogbmV3TGVhZGVySW5kZXhQYXR0ZXJucwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uTGVhZGVySW5kZXhQYXR0ZXJuQ2hhbmdlIiwgZnVuY3Rpb24gKGluZGV4UGF0dGVybnMpIHsKICAgICAgX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgIGxlYWRlckluZGV4UGF0dGVybnM6IGluZGV4UGF0dGVybnMubWFwKGZ1bmN0aW9uIChfcmVmNSkgewogICAgICAgICAgdmFyIGxhYmVsID0gX3JlZjUubGFiZWw7CiAgICAgICAgICByZXR1cm4gbGFiZWw7CiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkxlYWRlckluZGV4UGF0dGVybklucHV0Q2hhbmdlIiwgZnVuY3Rpb24gKGxlYWRlckluZGV4UGF0dGVybikgewogICAgICB2YXIgaXNFbXB0eSA9ICFsZWFkZXJJbmRleFBhdHRlcm4gfHwgIWxlYWRlckluZGV4UGF0dGVybi50cmltKCk7CiAgICAgIHZhciBsZWFkZXJJbmRleFBhdHRlcm5zID0gX3RoaXMuc3RhdGUuYXV0b0ZvbGxvd1BhdHRlcm4ubGVhZGVySW5kZXhQYXR0ZXJuczsKCiAgICAgIGlmICghaXNFbXB0eSAmJiBsZWFkZXJJbmRleFBhdHRlcm5zLmluY2x1ZGVzKGxlYWRlckluZGV4UGF0dGVybikpIHsKICAgICAgICB2YXIgZXJyb3JNc2cgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLmxlYWRlckluZGV4UGF0dGVybkVycm9yLmR1cGxpY2F0ZU1lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkR1cGxpY2F0ZSBsZWFkZXIgaW5kZXggcGF0dGVybiBhcmVuJ3QgYWxsb3dlZC4iCiAgICAgICAgfSk7CgogICAgICAgIHZhciBlcnJvcnMgPSB7CiAgICAgICAgICBsZWFkZXJJbmRleFBhdHRlcm5zOiB7CiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yTXNnLAogICAgICAgICAgICBhbHdheXNWaXNpYmxlOiB0cnVlCiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKF9yZWY2KSB7CiAgICAgICAgICB2YXIgZmllbGRzRXJyb3JzID0gX3JlZjYuZmllbGRzRXJyb3JzOwogICAgICAgICAgcmV0dXJuIHVwZGF0ZUZvcm1FcnJvcnMoZXJyb3JzLCBmaWVsZHNFcnJvcnMpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmNykgewogICAgICAgICAgdmFyIGZpZWxkc0Vycm9ycyA9IF9yZWY3LmZpZWxkc0Vycm9ycywKICAgICAgICAgICAgICBsZWFkZXJJbmRleFBhdHRlcm5zID0gX3JlZjcuYXV0b0ZvbGxvd1BhdHRlcm4ubGVhZGVySW5kZXhQYXR0ZXJuczsKICAgICAgICAgIHZhciBlcnJvcnMgPSBCb29sZWFuKGxlYWRlckluZGV4UGF0dGVybnMubGVuZ3RoKSA/IC8vIFZhbGlkYXRlIGV4aXN0aW5nIHBhdHRlcm5zLCBzbyB3ZSBjYW4gc3VyZmFjZSBhbiBlcnJvciBpZiB0aGlzIHJlcXVpcmVkIGlucHV0IGlzIG1pc3NpbmcuCiAgICAgICAgICAoMCwgX2F1dG9fZm9sbG93X3BhdHRlcm5fdmFsaWRhdG9ycy52YWxpZGF0ZUF1dG9Gb2xsb3dQYXR0ZXJuKSh7CiAgICAgICAgICAgIGxlYWRlckluZGV4UGF0dGVybnM6IGxlYWRlckluZGV4UGF0dGVybnMKICAgICAgICAgIH0pIDogLy8gVmFsaWRhdGUgdGhlIGlucHV0IGFzIHRoZSB1c2VyIHR5cGVzIHNvIHRoZXkgaGF2ZSBpbW1lZGlhdGUgZmVlZGJhY2sgYWJvdXQgZXJyb3JzLgogICAgICAgICAgKDAsIF9hdXRvX2ZvbGxvd19wYXR0ZXJuX3ZhbGlkYXRvcnMudmFsaWRhdGVBdXRvRm9sbG93UGF0dGVybikoewogICAgICAgICAgICBsZWFkZXJJbmRleFBhdHRlcm5zOiBbbGVhZGVySW5kZXhQYXR0ZXJuXQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gdXBkYXRlRm9ybUVycm9ycyhlcnJvcnMsIGZpZWxkc0Vycm9ycyk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldEZpZWxkcyIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHN0YXRlRmllbGRzID0gX3RoaXMuc3RhdGUuYXV0b0ZvbGxvd1BhdHRlcm47CgogICAgICB2YXIgZm9sbG93SW5kZXhQYXR0ZXJuUHJlZml4ID0gc3RhdGVGaWVsZHMuZm9sbG93SW5kZXhQYXR0ZXJuUHJlZml4LAogICAgICAgICAgZm9sbG93SW5kZXhQYXR0ZXJuU3VmZml4ID0gc3RhdGVGaWVsZHMuZm9sbG93SW5kZXhQYXR0ZXJuU3VmZml4LAogICAgICAgICAgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhzdGF0ZUZpZWxkcywgWyJmb2xsb3dJbmRleFBhdHRlcm5QcmVmaXgiLCAiZm9sbG93SW5kZXhQYXR0ZXJuU3VmZml4Il0pOwoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHJlc3QsIHsKICAgICAgICBmb2xsb3dJbmRleFBhdHRlcm46ICIiLmNvbmNhdChmb2xsb3dJbmRleFBhdHRlcm5QcmVmaXgsICJ7e2xlYWRlcl9pbmRleH19IikuY29uY2F0KGZvbGxvd0luZGV4UGF0dGVyblN1ZmZpeCkKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZW5kRm9ybSIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGlzRm9ybVZhbGlkID0gX3RoaXMuaXNGb3JtVmFsaWQoKTsKCiAgICAgIGlmICghaXNGb3JtVmFsaWQpIHsKICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBhcmVFcnJvcnNWaXNpYmxlOiB0cnVlCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGFyZUVycm9yc1Zpc2libGU6IGZhbHNlCiAgICAgIH0pOwoKICAgICAgdmFyIF90aGlzJGdldEZpZWxkcyA9IF90aGlzLmdldEZpZWxkcygpLAogICAgICAgICAgbmFtZSA9IF90aGlzJGdldEZpZWxkcy5uYW1lLAogICAgICAgICAgYXV0b0ZvbGxvd1BhdHRlcm4gPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoX3RoaXMkZ2V0RmllbGRzLCBbIm5hbWUiXSk7CgogICAgICBfdGhpcy5wcm9wcy5zYXZlQXV0b0ZvbGxvd1BhdHRlcm4obmFtZSwgYXV0b0ZvbGxvd1BhdHRlcm4pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiY2FuY2VsRm9ybSIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3JvdXRpbmcuZGVmYXVsdC5uYXZpZ2F0ZSgnL2F1dG9fZm9sbG93X3BhdHRlcm5zJyk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZW5kZXJGb3JtIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgIF90aGlzJHN0YXRlJGF1dG9Gb2xsbyA9IF90aGlzJHN0YXRlLmF1dG9Gb2xsb3dQYXR0ZXJuLAogICAgICAgICAgbmFtZSA9IF90aGlzJHN0YXRlJGF1dG9Gb2xsby5uYW1lLAogICAgICAgICAgcmVtb3RlQ2x1c3RlciA9IF90aGlzJHN0YXRlJGF1dG9Gb2xsby5yZW1vdGVDbHVzdGVyLAogICAgICAgICAgbGVhZGVySW5kZXhQYXR0ZXJucyA9IF90aGlzJHN0YXRlJGF1dG9Gb2xsby5sZWFkZXJJbmRleFBhdHRlcm5zLAogICAgICAgICAgZm9sbG93SW5kZXhQYXR0ZXJuUHJlZml4ID0gX3RoaXMkc3RhdGUkYXV0b0ZvbGxvLmZvbGxvd0luZGV4UGF0dGVyblByZWZpeCwKICAgICAgICAgIGZvbGxvd0luZGV4UGF0dGVyblN1ZmZpeCA9IF90aGlzJHN0YXRlJGF1dG9Gb2xsby5mb2xsb3dJbmRleFBhdHRlcm5TdWZmaXgsCiAgICAgICAgICBpc05ldyA9IF90aGlzJHN0YXRlLmlzTmV3LAogICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZSA9IF90aGlzJHN0YXRlLmFyZUVycm9yc1Zpc2libGUsCiAgICAgICAgICBmaWVsZHNFcnJvcnMgPSBfdGhpcyRzdGF0ZS5maWVsZHNFcnJvcnM7CiAgICAgIC8qKgogICAgICAgKiBBdXRvLWZvbGxvdyBwYXR0ZXJuIE5hbWUKICAgICAgICovCgogICAgICB2YXIgcmVuZGVyQXV0b0ZvbGxvd1BhdHRlcm5OYW1lID0gZnVuY3Rpb24gcmVuZGVyQXV0b0ZvbGxvd1BhdHRlcm5OYW1lKCkgewogICAgICAgIHZhciBpc0ludmFsaWQgPSBhcmVFcnJvcnNWaXNpYmxlICYmICEhZmllbGRzRXJyb3JzLm5hbWU7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlEZXNjcmliZWRGb3JtR3JvdXAsIHsKICAgICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIHsKICAgICAgICAgICAgc2l6ZTogInMiCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoNCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLnNlY3Rpb25BdXRvRm9sbG93UGF0dGVybk5hbWVUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiTmFtZSIKICAgICAgICAgIH0pKSksCiAgICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvbkF1dG9Gb2xsb3dQYXR0ZXJuTmFtZURlc2NyaXB0aW9uIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJBIHVuaXF1ZSBuYW1lIGZvciB0aGUgYXV0by1mb2xsb3cgcGF0dGVybi4iCiAgICAgICAgICB9KSwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgICBsYWJlbDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uYXV0b0ZvbGxvd1BhdHRlcm5OYW1lLmZpZWxkTmFtZUxhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJOYW1lIgogICAgICAgICAgfSksCiAgICAgICAgICBlcnJvcjogZmllbGRzRXJyb3JzLm5hbWUsCiAgICAgICAgICBpc0ludmFsaWQ6IGlzSW52YWxpZCwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZFRleHQsIHsKICAgICAgICAgIGlzSW52YWxpZDogaXNJbnZhbGlkLAogICAgICAgICAgdmFsdWU6IG5hbWUsCiAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgICAgICAgIG5hbWU6IGUudGFyZ2V0LnZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICAgIGRpc2FibGVkOiAhaXNOZXcsCiAgICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAibmFtZUlucHV0IgogICAgICAgIH0pKSk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBSZW1vdGUgQ2x1c3RlcgogICAgICAgKi8KCgogICAgICB2YXIgcmVuZGVyUmVtb3RlQ2x1c3RlckZpZWxkID0gZnVuY3Rpb24gcmVuZGVyUmVtb3RlQ2x1c3RlckZpZWxkKCkgewogICAgICAgIHZhciBfdGhpcyRwcm9wcyA9IF90aGlzLnByb3BzLAogICAgICAgICAgICByZW1vdGVDbHVzdGVycyA9IF90aGlzJHByb3BzLnJlbW90ZUNsdXN0ZXJzLAogICAgICAgICAgICBjdXJyZW50VXJsID0gX3RoaXMkcHJvcHMuY3VycmVudFVybDsKICAgICAgICB2YXIgZXJyb3JNZXNzYWdlcyA9IHsKICAgICAgICAgIG5vQ2x1c3RlckZvdW5kOiBmdW5jdGlvbiBub0NsdXN0ZXJGb3VuZCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uZW1wdHlSZW1vdGVDbHVzdGVyc0NhbGxPdXREZXNjcmlwdGlvbiIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJBdXRvLWZvbGxvdyBwYXR0ZXJucyBjYXB0dXJlIGluZGljZXMgb24gcmVtb3RlIGNsdXN0ZXJzLiIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgcmVtb3RlQ2x1c3Rlck5vdENvbm5lY3RlZE5vdEVkaXRhYmxlOiBmdW5jdGlvbiByZW1vdGVDbHVzdGVyTm90Q29ubmVjdGVkTm90RWRpdGFibGUobmFtZSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uY3VycmVudFJlbW90ZUNsdXN0ZXJOb3RDb25uZWN0ZWRDYWxsT3V0VGl0bGUiLAogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDYW4ndCBlZGl0IGF1dG8tZm9sbG93IHBhdHRlcm4gYmVjYXVzZSByZW1vdGUgY2x1c3RlciAne25hbWV9JyBpcyBub3QgY29ubmVjdGVkIiwKICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5jdXJyZW50UmVtb3RlQ2x1c3Rlck5vdENvbm5lY3RlZENhbGxPdXREZXNjcmlwdGlvbiIsCiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIllvdSBjYW4gYWRkcmVzcyB0aGlzIGJ5IGVkaXRpbmcgdGhlIHJlbW90ZSBjbHVzdGVyLiIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9OwogICAgICAgICAgfSwKICAgICAgICAgIHJlbW90ZUNsdXN0ZXJEb2VzTm90RXhpc3Q6IGZ1bmN0aW9uIHJlbW90ZUNsdXN0ZXJEb2VzTm90RXhpc3QobmFtZSkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5jdXJyZW50UmVtb3RlQ2x1c3Rlck5vdEZvdW5kQ2FsbE91dERlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRvIGVkaXQgdGhpcyBhdXRvLWZvbGxvdyBwYXR0ZXJuLCB5b3UgbXVzdCBhZGQgYSByZW1vdGUgY2x1c3RlciBuYW1lZCAne25hbWV9Jy4iLAogICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aURlc2NyaWJlZEZvcm1Hcm91cCwgewogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUaXRsZSwgewogICAgICAgICAgICBzaXplOiAicyIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImg0IiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvblJlbW90ZUNsdXN0ZXJUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUmVtb3RlIGNsdXN0ZXIiCiAgICAgICAgICB9KSkpLAogICAgICAgICAgZGVzY3JpcHRpb246IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLnNlY3Rpb25SZW1vdGVDbHVzdGVyRGVzY3JpcHRpb24iLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoZSByZW1vdGUgY2x1c3RlciB0byByZXBsaWNhdGUgbGVhZGVyIGluZGljZXMgZnJvbS4iCiAgICAgICAgICB9KSwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlbW90ZV9jbHVzdGVyc19mb3JtX2ZpZWxkLlJlbW90ZUNsdXN0ZXJzRm9ybUZpZWxkLCB7CiAgICAgICAgICBzZWxlY3RlZDogcmVtb3RlQ2x1c3RlciA/IHJlbW90ZUNsdXN0ZXIgOiBudWxsLAogICAgICAgICAgcmVtb3RlQ2x1c3RlcnM6IHJlbW90ZUNsdXN0ZXJzLAogICAgICAgICAgY3VycmVudFVybDogY3VycmVudFVybCwKICAgICAgICAgIGlzRWRpdGFibGU6IGlzTmV3LAogICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZTogYXJlRXJyb3JzVmlzaWJsZSwKICAgICAgICAgIG9uQ2hhbmdlOiBfdGhpcy5vbkNsdXN0ZXJDaGFuZ2UsCiAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbiBvbkVycm9yKGVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5vbkZpZWxkc0Vycm9yQ2hhbmdlKHsKICAgICAgICAgICAgICByZW1vdGVDbHVzdGVyOiBlcnJvcgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBlcnJvck1lc3NhZ2VzOiBlcnJvck1lc3NhZ2VzCiAgICAgICAgfSkpOwogICAgICB9OwogICAgICAvKioKICAgICAgICogTGVhZGVyIGluZGV4IHBhdHRlcm4ocykKICAgICAgICovCgoKICAgICAgdmFyIHJlbmRlckxlYWRlckluZGV4UGF0dGVybnMgPSBmdW5jdGlvbiByZW5kZXJMZWFkZXJJbmRleFBhdHRlcm5zKCkgewogICAgICAgIHZhciBoYXNFcnJvciA9ICEhKGZpZWxkc0Vycm9ycy5sZWFkZXJJbmRleFBhdHRlcm5zICYmIGZpZWxkc0Vycm9ycy5sZWFkZXJJbmRleFBhdHRlcm5zLm1lc3NhZ2UpOwogICAgICAgIHZhciBpc0ludmFsaWQgPSBoYXNFcnJvciAmJiAoZmllbGRzRXJyb3JzLmxlYWRlckluZGV4UGF0dGVybnMuYWx3YXlzVmlzaWJsZSB8fCBhcmVFcnJvcnNWaXNpYmxlKTsKICAgICAgICB2YXIgZm9ybWF0dGVkTGVhZGVySW5kZXhQYXR0ZXJucyA9IGxlYWRlckluZGV4UGF0dGVybnMubWFwKGZ1bmN0aW9uIChwYXR0ZXJuKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsYWJlbDogcGF0dGVybgogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aURlc2NyaWJlZEZvcm1Hcm91cCwgewogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUaXRsZSwgewogICAgICAgICAgICBzaXplOiAicyIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImg0IiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvbkxlYWRlckluZGV4UGF0dGVybnNUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiTGVhZGVyIGluZGljZXMiCiAgICAgICAgICB9KSkpLAogICAgICAgICAgZGVzY3JpcHRpb246IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvbkxlYWRlckluZGV4UGF0dGVybnNEZXNjcmlwdGlvbjEiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk9uZSBvciBtb3JlIGluZGV4IHBhdHRlcm5zIHRoYXQgaWRlbnRpZnkgdGhlIGluZGljZXMgeW91IHdhbnQgdG8gcmVwbGljYXRlIGZyb20gdGhlIHJlbW90ZSBjbHVzdGVyLiBBcyBuZXcgaW5kaWNlcyBtYXRjaGluZyB0aGVzZSBwYXR0ZXJucyBhcmUgY3JlYXRlZCwgdGhleSBhcmUgcmVwbGljYXRlZCB0byBmb2xsb3dlciBpbmRpY2VzIG9uIHRoZSBsb2NhbCBjbHVzdGVyLiIKICAgICAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLnNlY3Rpb25MZWFkZXJJbmRleFBhdHRlcm5zRGVzY3JpcHRpb24yIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJ7bm90ZX0gSW5kaWNlcyB0aGF0IGFscmVhZHkgZXhpc3QgYXJlIG5vdCByZXBsaWNhdGVkLiIsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIG5vdGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInN0cm9uZyIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5zZWN0aW9uTGVhZGVySW5kZXhQYXR0ZXJuc0Rlc2NyaXB0aW9uMi5ub3RlTGFiZWwiLAogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJOb3RlOiIKICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkpKSwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgICBsYWJlbDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uZmllbGRMZWFkZXJJbmRleFBhdHRlcm5zTGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkluZGV4IHBhdHRlcm5zIgogICAgICAgICAgfSksCiAgICAgICAgICBoZWxwVGV4dDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uZmllbGRMZWFkZXJJbmRleFBhdHRlcm5zSGVscExhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTcGFjZXMgYW5kIHRoZSBjaGFyYWN0ZXJzIHtjaGFyYWN0ZXJMaXN0fSBhcmUgbm90IGFsbG93ZWQuIiwKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgY2hhcmFjdGVyTGlzdDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3Ryb25nIiwgbnVsbCwgaW5kZXhQYXR0ZXJuSWxsZWdhbENoYXJhY3RlcnMpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQsCiAgICAgICAgICBlcnJvcjogZmllbGRzRXJyb3JzLmxlYWRlckluZGV4UGF0dGVybnMgJiYgZmllbGRzRXJyb3JzLmxlYWRlckluZGV4UGF0dGVybnMubWVzc2FnZSwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb21ib0JveCwgewogICAgICAgICAgbm9TdWdnZXN0aW9uczogdHJ1ZSwKICAgICAgICAgIHBsYWNlaG9sZGVyOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLmZpZWxkTGVhZGVySW5kZXhQYXR0ZXJuc1BsYWNlaG9sZGVyJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1R5cGUgYW5kIHRoZW4gaGl0IEVOVEVSJwogICAgICAgICAgfSksCiAgICAgICAgICBzZWxlY3RlZE9wdGlvbnM6IGZvcm1hdHRlZExlYWRlckluZGV4UGF0dGVybnMsCiAgICAgICAgICBvbkNyZWF0ZU9wdGlvbjogX3RoaXMub25DcmVhdGVMZWFkZXJJbmRleFBhdHRlcm4sCiAgICAgICAgICBvbkNoYW5nZTogX3RoaXMub25MZWFkZXJJbmRleFBhdHRlcm5DaGFuZ2UsCiAgICAgICAgICBvblNlYXJjaENoYW5nZTogX3RoaXMub25MZWFkZXJJbmRleFBhdHRlcm5JbnB1dENoYW5nZSwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbmRleFBhdHRlcm5JbnB1dCIKICAgICAgICB9KSkpOwogICAgICB9OwogICAgICAvKioKICAgICAgICogQXV0by1mb2xsb3cgcGF0dGVybiBwcmVmaXgvc3VmZml4CiAgICAgICAqLwoKCiAgICAgIHZhciByZW5kZXJBdXRvRm9sbG93UGF0dGVyblByZWZpeFN1ZmZpeCA9IGZ1bmN0aW9uIHJlbmRlckF1dG9Gb2xsb3dQYXR0ZXJuUHJlZml4U3VmZml4KCkgewogICAgICAgIHZhciBpc1ByZWZpeEludmFsaWQgPSBhcmVFcnJvcnNWaXNpYmxlICYmICEhZmllbGRzRXJyb3JzLmZvbGxvd0luZGV4UGF0dGVyblByZWZpeDsKICAgICAgICB2YXIgaXNTdWZmaXhJbnZhbGlkID0gYXJlRXJyb3JzVmlzaWJsZSAmJiAhIWZpZWxkc0Vycm9ycy5mb2xsb3dJbmRleFBhdHRlcm5TdWZmaXg7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlEZXNjcmliZWRGb3JtR3JvdXAsIHsKICAgICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIHsKICAgICAgICAgICAgc2l6ZTogInMiCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoNCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLnNlY3Rpb25BdXRvRm9sbG93UGF0dGVyblRpdGxlIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJGb2xsb3dlciBpbmRpY2VzIChvcHRpb25hbCkiCiAgICAgICAgICB9KSkpLAogICAgICAgICAgZGVzY3JpcHRpb246IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLnNlY3Rpb25BdXRvRm9sbG93UGF0dGVybkRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJBIGN1c3RvbSBwcmVmaXggb3Igc3VmZml4IHRvIGFwcGx5IHRvIHRoZSBuYW1lcyBvZiB0aGUgZm9sbG93ZXIgaW5kaWNlcyBzbyB5b3UgY2FuIG1vcmUgZWFzaWx5IGlkZW50aWZ5IHJlcGxpY2F0ZWQgaW5kaWNlcy4gQnkgZGVmYXVsdCwgYSBmb2xsb3dlciBpbmRleCBoYXMgdGhlIHNhbWUgbmFtZSBhcyB0aGUgbGVhZGVyIGluZGV4LiIKICAgICAgICAgIH0pLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgICAgZ3V0dGVyU2l6ZTogInMiCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgICAgY2xhc3NOYW1lOiAiY2NyRm9sbG93ZXJJbmRpY2VzRm9ybVJvdyIsCiAgICAgICAgICBsYWJlbDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uYXV0b0ZvbGxvd1BhdHRlcm4uZmllbGRQcmVmaXhMYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUHJlZml4IgogICAgICAgICAgfSksCiAgICAgICAgICBlcnJvcjogZmllbGRzRXJyb3JzLmZvbGxvd0luZGV4UGF0dGVyblByZWZpeCwKICAgICAgICAgIGlzSW52YWxpZDogaXNQcmVmaXhJbnZhbGlkLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkVGV4dCwgewogICAgICAgICAgaXNJbnZhbGlkOiBpc1ByZWZpeEludmFsaWQsCiAgICAgICAgICB2YWx1ZTogZm9sbG93SW5kZXhQYXR0ZXJuUHJlZml4LAogICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzLm9uRmllbGRzQ2hhbmdlKHsKICAgICAgICAgICAgICBmb2xsb3dJbmRleFBhdHRlcm5QcmVmaXg6IGUudGFyZ2V0LnZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJwcmVmaXhJbnB1dCIKICAgICAgICB9KSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgICBjbGFzc05hbWU6ICJjY3JGb2xsb3dlckluZGljZXNGb3JtUm93IiwKICAgICAgICAgIGxhYmVsOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5hdXRvRm9sbG93UGF0dGVybi5maWVsZFN1ZmZpeExhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTdWZmaXgiCiAgICAgICAgICB9KSwKICAgICAgICAgIGVycm9yOiBmaWVsZHNFcnJvcnMuZm9sbG93SW5kZXhQYXR0ZXJuU3VmZml4LAogICAgICAgICAgaXNJbnZhbGlkOiBpc1N1ZmZpeEludmFsaWQsCiAgICAgICAgICBmdWxsV2lkdGg6IHRydWUKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGRUZXh0LCB7CiAgICAgICAgICBpc0ludmFsaWQ6IGlzU3VmZml4SW52YWxpZCwKICAgICAgICAgIHZhbHVlOiBmb2xsb3dJbmRleFBhdHRlcm5TdWZmaXgsCiAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgICAgICAgIGZvbGxvd0luZGV4UGF0dGVyblN1ZmZpeDogZS50YXJnZXQudmFsdWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInN1ZmZpeElucHV0IgogICAgICAgIH0pKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybUhlbHBUZXh0LCB7CiAgICAgICAgICBjbGFzc05hbWU6IGlzUHJlZml4SW52YWxpZCB8fCBpc1N1ZmZpeEludmFsaWQgPyBudWxsIDogJ2NjckZvbGxvd2VySW5kaWNlc0hlbHBUZXh0JwogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5maWVsZEZvbGxvd2VySW5kaWNlc0hlbHBMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNwYWNlcyBhbmQgdGhlIGNoYXJhY3RlcnMge2NoYXJhY3Rlckxpc3R9IGFyZSBub3QgYWxsb3dlZC4iLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGNoYXJhY3Rlckxpc3Q6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInN0cm9uZyIsIG51bGwsIGluZGV4TmFtZUlsbGVnYWxDaGFyYWN0ZXJzKQogICAgICAgICAgfQogICAgICAgIH0pKSwgISFsZWFkZXJJbmRleFBhdHRlcm5zLmxlbmd0aCAmJiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgICAgc2l6ZTogIm0iCiAgICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2F1dG9fZm9sbG93X3BhdHRlcm5faW5kaWNlc19wcmV2aWV3LkF1dG9Gb2xsb3dQYXR0ZXJuSW5kaWNlc1ByZXZpZXcsIHsKICAgICAgICAgIHByZWZpeDogZm9sbG93SW5kZXhQYXR0ZXJuUHJlZml4LAogICAgICAgICAgc3VmZml4OiBmb2xsb3dJbmRleFBhdHRlcm5TdWZmaXgsCiAgICAgICAgICBsZWFkZXJJbmRleFBhdHRlcm5zOiBsZWFkZXJJbmRleFBhdHRlcm5zCiAgICAgICAgfSkpKTsKICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIEZvcm0gRXJyb3Igd2FybmluZyBtZXNzYWdlCiAgICAgICAqLwoKCiAgICAgIHZhciByZW5kZXJGb3JtRXJyb3JXYXJuaW5nID0gZnVuY3Rpb24gcmVuZGVyRm9ybUVycm9yV2FybmluZygpIHsKICAgICAgICB2YXIgYXJlRXJyb3JzVmlzaWJsZSA9IF90aGlzLnN0YXRlLmFyZUVycm9yc1Zpc2libGU7CgogICAgICAgIHZhciBpc0Zvcm1WYWxpZCA9IF90aGlzLmlzRm9ybVZhbGlkKCk7CgogICAgICAgIGlmICghYXJlRXJyb3JzVmlzaWJsZSB8fCBpc0Zvcm1WYWxpZCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0udmFsaWRhdGlvbkVycm9yVGl0bGUiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZpeCBlcnJvcnMgYmVmb3JlIGNvbnRpbnVpbmcuIgogICAgICAgICAgfSksCiAgICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgICBpY29uVHlwZTogImNyb3NzIiwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJmb3JtRXJyb3IiCiAgICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICAgIHNpemU6ICJsIgogICAgICAgIH0pKTsKICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIEZvcm0gQWN0aW9ucwogICAgICAgKi8KCgogICAgICB2YXIgcmVuZGVyQWN0aW9ucyA9IGZ1bmN0aW9uIHJlbmRlckFjdGlvbnMoKSB7CiAgICAgICAgdmFyIF90aGlzJHByb3BzMiA9IF90aGlzLnByb3BzLAogICAgICAgICAgICBhcGlTdGF0dXMgPSBfdGhpcyRwcm9wczIuYXBpU3RhdHVzLAogICAgICAgICAgICBzYXZlQnV0dG9uTGFiZWwgPSBfdGhpcyRwcm9wczIuc2F2ZUJ1dHRvbkxhYmVsOwogICAgICAgIHZhciBfdGhpcyRzdGF0ZTIgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZSA9IF90aGlzJHN0YXRlMi5hcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgICBpc1JlcXVlc3RWaXNpYmxlID0gX3RoaXMkc3RhdGUyLmlzUmVxdWVzdFZpc2libGU7CgogICAgICAgIGlmIChhcGlTdGF0dXMgPT09IF9jb25zdGFudHMuQVBJX1NUQVRVUy5TQVZJTkcpIHsKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAiZmxleFN0YXJ0IiwKICAgICAgICAgICAgZ3V0dGVyU2l6ZTogIm0iCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMb2FkaW5nU3Bpbm5lciwgewogICAgICAgICAgICBzaXplOiAibCIKICAgICAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uYWN0aW9ucy5zYXZpbmdUZXh0IiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZpbmciCiAgICAgICAgICB9KSkpKTsKICAgICAgICB9CgogICAgICAgIHZhciBpc1NhdmVEaXNhYmxlZCA9IGFyZUVycm9yc1Zpc2libGUgJiYgIV90aGlzLmlzRm9ybVZhbGlkKCk7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAic3BhY2VCZXR3ZWVuIiwKICAgICAgICAgIGFsaWduSXRlbXM6ICJjZW50ZXIiCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgICAgZ3V0dGVyU2l6ZTogIm0iLAogICAgICAgICAgYWxpZ25JdGVtczogImNlbnRlciIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgICAgY29sb3I6ICJzZWNvbmRhcnkiLAogICAgICAgICAgaWNvblR5cGU6ICJjaGVjayIsCiAgICAgICAgICBvbkNsaWNrOiBfdGhpcy5zZW5kRm9ybSwKICAgICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgICBkaXNhYmxlZDogaXNTYXZlRGlzYWJsZWQsCiAgICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAic3VibWl0QnV0dG9uIgogICAgICAgIH0sIHNhdmVCdXR0b25MYWJlbCkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgICAgICBjb2xvcjogInByaW1hcnkiLAogICAgICAgICAgb25DbGljazogX3RoaXMuY2FuY2VsRm9ybQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5jYW5jZWxCdXR0b25MYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNhbmNlbCIsCiAgICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiY2FuY2VsQnV0dG9uIgogICAgICAgIH0pKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgICAgICBvbkNsaWNrOiBfdGhpcy50b2dnbGVSZXF1ZXN0CiAgICAgICAgfSwgaXNSZXF1ZXN0VmlzaWJsZSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5oaWRlUmVxdWVzdEJ1dHRvbkxhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSGlkZSByZXF1ZXN0IgogICAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtbS5zaG93UmVxdWVzdEJ1dHRvbkxhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2hvdyByZXF1ZXN0IgogICAgICAgIH0pKSkpOwogICAgICB9OwoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybSwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhdXRvRm9sbG93UGF0dGVybkZvcm0iCiAgICAgIH0sIHJlbmRlckF1dG9Gb2xsb3dQYXR0ZXJuTmFtZSgpLCByZW5kZXJSZW1vdGVDbHVzdGVyRmllbGQoKSwgcmVuZGVyTGVhZGVySW5kZXhQYXR0ZXJucygpLCByZW5kZXJBdXRvRm9sbG93UGF0dGVyblByZWZpeFN1ZmZpeCgpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgbnVsbCksIHJlbmRlckZvcm1FcnJvcldhcm5pbmcoKSwgX3RoaXMucmVuZGVyQXBpRXJyb3JzKCksIHJlbmRlckFjdGlvbnMoKSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZW5kZXJMb2FkaW5nIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgYXBpU3RhdHVzID0gX3RoaXMucHJvcHMuYXBpU3RhdHVzOwoKICAgICAgaWYgKGFwaVN0YXR1cyA9PT0gX2NvbnN0YW50cy5BUElfU1RBVFVTLlNBVklORykgewogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpT3ZlcmxheU1hc2ssIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMb2FkaW5nS2liYW5hLCB7CiAgICAgICAgICBzaXplOiAieGwiCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0pOwoKICAgIHZhciBfaXNOZXcgPSBfdGhpcy5wcm9wcy5hdXRvRm9sbG93UGF0dGVybiA9PT0gdW5kZWZpbmVkOwoKICAgIHZhciBzZWFyY2ggPSBfcm91dGluZy5kZWZhdWx0LnJlYWN0Um91dGVyLnJvdXRlLmxvY2F0aW9uLnNlYXJjaDsKICAgIHZhciBxdWVyeVBhcmFtcyA9ICgwLCBfcXVlcnlfcGFyYW1zLmV4dHJhY3RRdWVyeVBhcmFtcykoc2VhcmNoKTsKICAgIHZhciByZW1vdGVDbHVzdGVyTmFtZSA9ICgwLCBfZ2V0X3JlbW90ZV9jbHVzdGVyX25hbWUuZ2V0UmVtb3RlQ2x1c3Rlck5hbWUpKF90aGlzLnByb3BzLnJlbW90ZUNsdXN0ZXJzLCBxdWVyeVBhcmFtcy5jbHVzdGVyKTsKCiAgICB2YXIgX2F1dG9Gb2xsb3dQYXR0ZXJuID0gX2lzTmV3ID8gZ2V0RW1wdHlBdXRvRm9sbG93UGF0dGVybihyZW1vdGVDbHVzdGVyTmFtZSkgOiBfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5wcm9wcy5hdXRvRm9sbG93UGF0dGVybik7CgogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIGF1dG9Gb2xsb3dQYXR0ZXJuOiBfYXV0b0ZvbGxvd1BhdHRlcm4sCiAgICAgIGZpZWxkc0Vycm9yczogKDAsIF9hdXRvX2ZvbGxvd19wYXR0ZXJuX3ZhbGlkYXRvcnMudmFsaWRhdGVBdXRvRm9sbG93UGF0dGVybikoX2F1dG9Gb2xsb3dQYXR0ZXJuKSwKICAgICAgYXJlRXJyb3JzVmlzaWJsZTogZmFsc2UsCiAgICAgIGlzTmV3OiBfaXNOZXcsCiAgICAgIGlzUmVxdWVzdFZpc2libGU6IGZhbHNlCiAgICB9OwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEF1dG9Gb2xsb3dQYXR0ZXJuRm9ybSwgW3sKICAgIGtleTogImlzRm9ybVZhbGlkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0Zvcm1WYWxpZCgpIHsKICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5zdGF0ZS5maWVsZHNFcnJvcnMpLmV2ZXJ5KGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIHJldHVybiBlcnJvciA9PT0gdW5kZWZpbmVkIHx8IGVycm9yID09PSBudWxsOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJBcGlFcnJvcnMiLAoKICAgIC8qKgogICAgICogU2VjY3Rpb25zIFJlbmRlcnMKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckFwaUVycm9ycygpIHsKICAgICAgdmFyIGFwaUVycm9yID0gdGhpcy5wcm9wcy5hcGlFcnJvcjsKCiAgICAgIGlmIChhcGlFcnJvcikgewogICAgICAgIHZhciB0aXRsZSA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2F2aW5nRXJyb3JUaXRsZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuJ3QgY3JlYXRlIGF1dG8tZm9sbG93IHBhdHRlcm4iCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2VjdGlvbl9lcnJvci5TZWN0aW9uRXJyb3IsIHsKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIGVycm9yOiBhcGlFcnJvciwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhcGlFcnJvciIKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgICAgc2l6ZTogImwiCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgX3RoaXMkc3RhdGUzID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGF1dG9Gb2xsb3dQYXR0ZXJuID0gX3RoaXMkc3RhdGUzLmF1dG9Gb2xsb3dQYXR0ZXJuLAogICAgICAgICAgaXNSZXF1ZXN0VmlzaWJsZSA9IF90aGlzJHN0YXRlMy5pc1JlcXVlc3RWaXNpYmxlLAogICAgICAgICAgaXNOZXcgPSBfdGhpcyRzdGF0ZTMuaXNOZXc7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgdGhpcy5yZW5kZXJGb3JtKCksIHRoaXMucmVuZGVyTG9hZGluZygpLCBpc1JlcXVlc3RWaXNpYmxlID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfYXV0b19mb2xsb3dfcGF0dGVybl9yZXF1ZXN0X2ZseW91dC5BdXRvRm9sbG93UGF0dGVyblJlcXVlc3RGbHlvdXQsIHsKICAgICAgICBuYW1lOiBhdXRvRm9sbG93UGF0dGVybi5uYW1lLAogICAgICAgIGF1dG9Gb2xsb3dQYXR0ZXJuOiB0aGlzLmdldEZpZWxkcygpLAogICAgICAgIGlzTmV3OiBpc05ldywKICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgaXNSZXF1ZXN0VmlzaWJsZTogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkgOiBudWxsKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBBdXRvRm9sbG93UGF0dGVybkZvcm07Cn0oX3JlYWN0LlB1cmVDb21wb25lbnQpOwoKZXhwb3J0cy5BdXRvRm9sbG93UGF0dGVybkZvcm0gPSBBdXRvRm9sbG93UGF0dGVybkZvcm07CgpfZGVmaW5lUHJvcGVydHkoQXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLCAicHJvcFR5cGVzIiwgewogIHNhdmVBdXRvRm9sbG93UGF0dGVybjogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICBhdXRvRm9sbG93UGF0dGVybjogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdCwKICBhcGlFcnJvcjogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdCwKICBhcGlTdGF0dXM6IF9wcm9wVHlwZXMuZGVmYXVsdC5zdHJpbmcuaXNSZXF1aXJlZCwKICBjdXJyZW50VXJsOiBfcHJvcFR5cGVzLmRlZmF1bHQuc3RyaW5nLmlzUmVxdWlyZWQsCiAgcmVtb3RlQ2x1c3RlcnM6IF9wcm9wVHlwZXMuZGVmYXVsdC5hcnJheSwKICBzYXZlQnV0dG9uTGFiZWw6IF9wcm9wVHlwZXMuZGVmYXVsdC5ub2RlCn0pOw=="},null]}