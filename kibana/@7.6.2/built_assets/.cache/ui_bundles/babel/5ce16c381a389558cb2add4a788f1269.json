{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/kibana_react/public/saved_objects/saved_object_finder.js","dependencies":[{"path":"src/plugins/kibana_react/public/saved_objects/saved_object_finder.js","mtime":1585205041830},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuU2F2ZWRPYmplY3RGaW5kZXJVaSA9IGV4cG9ydHMuU2F2ZWRPYmplY3RGaW5kZXIgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInByb3AtdHlwZXMiKSk7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfY29udGV4dDIgPSByZXF1aXJlKCIuLi9jb250ZXh0Iik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfZXh0ZW5kcygpIHsKICBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgewogICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGFyZ2V0OwogIH07CgogIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgewogIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogIH0KfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICByZXR1cm4gQ29uc3RydWN0b3I7Cn0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CiAgICByZXR1cm4gY2FsbDsKICB9CgogIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOwp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfSAvLyBUT0RPIHRoZSB0eXBpbmdzIGZvciBFdWlMaXN0R3JvdXAgYXJlIGluY29ycmVjdCAtIG1heFdpZHRoIGlzIG1pc3NpbmcuIFRoaXMgY2FuIGJlIHJlbW92ZWQgd2hlbiB0aGUgdHlwZXMgYXJlIGFkanVzdGVkCgoKdmFyIEZpeGVkRXVpTGlzdEdyb3VwID0gX2V1aS5FdWlMaXN0R3JvdXA7IC8vIFRPRE8gdGhlIHR5cGluZ3MgZm9yIEV1aUNvbnRleHRNZW51UGFuZWwgYXJlIGluY29ycmVjdCAtIHdhdGNoZWRJdGVtUHJvcHMgaXMgbWlzc2luZy4gVGhpcyBjYW4gYmUgcmVtb3ZlZCB3aGVuIHRoZSB0eXBlcyBhcmUgYWRqdXN0ZWQKCnZhciBGaXhlZEV1aUNvbnRleHRNZW51UGFuZWwgPSBfZXVpLkV1aUNvbnRleHRNZW51UGFuZWw7Cgp2YXIgU2F2ZWRPYmplY3RGaW5kZXJVaSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoU2F2ZWRPYmplY3RGaW5kZXJVaSwgX1JlYWN0JENvbXBvbmVudCk7CgogIGZ1bmN0aW9uIFNhdmVkT2JqZWN0RmluZGVyVWkocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2F2ZWRPYmplY3RGaW5kZXJVaSk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoU2F2ZWRPYmplY3RGaW5kZXJVaSkuY2FsbCh0aGlzLCBwcm9wcykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImlzQ29tcG9uZW50TW91bnRlZCIsIGZhbHNlKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJkZWJvdW5jZWRGZXRjaCIsIF9sb2Rhc2guZGVmYXVsdC5kZWJvdW5jZShmdW5jdGlvbiBfY2FsbGVlKHF1ZXJ5KSB7CiAgICAgIHZhciBtZXRhRGF0YU1hcCwgZmllbGRzLCBwZXJQYWdlLCByZXNwOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIG1ldGFEYXRhTWFwID0gX3RoaXMuZ2V0U2F2ZWRPYmplY3RNZXRhRGF0YU1hcCgpOwogICAgICAgICAgICAgIGZpZWxkcyA9IE9iamVjdC52YWx1ZXMobWV0YURhdGFNYXApLm1hcChmdW5jdGlvbiAobWV0YURhdGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhRGF0YS5pbmNsdWRlRmllbGRzIHx8IFtdOwogICAgICAgICAgICAgIH0pLnJlZHVjZShmdW5jdGlvbiAoYWxsRmllbGRzLCBjdXJyZW50RmllbGRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWxsRmllbGRzLmNvbmNhdChjdXJyZW50RmllbGRzKTsKICAgICAgICAgICAgICB9LCBbJ3RpdGxlJ10pOwogICAgICAgICAgICAgIHBlclBhZ2UgPSBfdGhpcy5wcm9wcy51aVNldHRpbmdzLmdldCgnc2F2ZWRPYmplY3RzOmxpc3RpbmdMaW1pdCcpOwogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX3RoaXMucHJvcHMuc2F2ZWRPYmplY3RzLmNsaWVudC5maW5kKHsKICAgICAgICAgICAgICAgIHR5cGU6IE9iamVjdC5rZXlzKG1ldGFEYXRhTWFwKSwKICAgICAgICAgICAgICAgIGZpZWxkczogX3RvQ29uc3VtYWJsZUFycmF5KG5ldyBTZXQoZmllbGRzKSksCiAgICAgICAgICAgICAgICBzZWFyY2g6IHF1ZXJ5ID8gIiIuY29uY2F0KHF1ZXJ5LCAiKiIpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgcGFnZTogMSwKICAgICAgICAgICAgICAgIHBlclBhZ2U6IHBlclBhZ2UsCiAgICAgICAgICAgICAgICBzZWFyY2hGaWVsZHM6IFsndGl0bGVeMycsICdkZXNjcmlwdGlvbiddLAogICAgICAgICAgICAgICAgZGVmYXVsdFNlYXJjaE9wZXJhdG9yOiAnQU5EJwogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICByZXNwLnNhdmVkT2JqZWN0cyA9IHJlc3Auc2F2ZWRPYmplY3RzLmZpbHRlcihmdW5jdGlvbiAoc2F2ZWRPYmplY3QpIHsKICAgICAgICAgICAgICAgIHZhciBtZXRhRGF0YSA9IG1ldGFEYXRhTWFwW3NhdmVkT2JqZWN0LnR5cGVdOwoKICAgICAgICAgICAgICAgIGlmIChtZXRhRGF0YS5zaG93U2F2ZWRPYmplY3QpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG1ldGFEYXRhLnNob3dTYXZlZE9iamVjdChzYXZlZE9iamVjdCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzLmlzQ29tcG9uZW50TW91bnRlZCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIC8vIFdlIG5lZWQgdGhpcyBjaGVjayB0byBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgc2VhcmNoIHJlc3VsdHMgY29tZSBiYWNrIGluIGEgZGlmZmVyZW50CiAgICAgICAgICAgICAgLy8gb3JkZXIgdGhhbiB0aGV5IHdlcmUgc2VudCBvdXQuIE9ubHkgbG9hZCByZXN1bHRzIGZvciB0aGUgbW9zdCByZWNlbnQgc2VhcmNoLgogICAgICAgICAgICAgIGlmIChxdWVyeSA9PT0gX3RoaXMuc3RhdGUucXVlcnkpIHsKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgaXNGZXRjaGluZ0l0ZW1zOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgcGFnZTogMCwKICAgICAgICAgICAgICAgICAgaXRlbXM6IHJlc3Auc2F2ZWRPYmplY3RzLm1hcChmdW5jdGlvbiAoc2F2ZWRPYmplY3QpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBzYXZlZE9iamVjdC5hdHRyaWJ1dGVzLnRpdGxlLAogICAgICAgICAgICAgICAgICAgICAgICBpZCA9IHNhdmVkT2JqZWN0LmlkLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gc2F2ZWRPYmplY3QudHlwZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHR5cGVvZiB0aXRsZSA9PT0gJ3N0cmluZycgPyB0aXRsZSA6ICcnLAogICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgICAgICAgICAgIHNhdmVkT2JqZWN0OiBzYXZlZE9iamVjdAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sIDMwMCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldFBhZ2VPZkl0ZW1zIiwgZnVuY3Rpb24gKCkgewogICAgICAvLyBkbyBub3Qgc29ydCBvcmlnaW5hbCBsaXN0IHRvIHByZXNlcnZlIGVsYXN0aWNzZWFyY2ggcmFua2luZyBvcmRlcgogICAgICB2YXIgaXRlbXMgPSBfdGhpcy5zdGF0ZS5pdGVtcy5zbGljZSgpOwoKICAgICAgdmFyIHNvcnREaXJlY3Rpb24gPSBfdGhpcy5zdGF0ZS5zb3J0RGlyZWN0aW9uOwoKICAgICAgaWYgKHNvcnREaXJlY3Rpb24gfHwgIV90aGlzLnN0YXRlLnF1ZXJ5KSB7CiAgICAgICAgaXRlbXMuc29ydChmdW5jdGlvbiAoX3JlZiwgX3JlZjIpIHsKICAgICAgICAgIHZhciB0aXRsZUEgPSBfcmVmLnRpdGxlOwogICAgICAgICAgdmFyIHRpdGxlQiA9IF9yZWYyLnRpdGxlOwogICAgICAgICAgdmFyIG9yZGVyID0gMTsKCiAgICAgICAgICBpZiAoc29ydERpcmVjdGlvbiA9PT0gJ2Rlc2MnKSB7CiAgICAgICAgICAgIG9yZGVyID0gLTE7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG9yZGVyICogKHRpdGxlQSB8fCAnJykudG9Mb3dlckNhc2UoKS5sb2NhbGVDb21wYXJlKCh0aXRsZUIgfHwgJycpLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIH0pOwogICAgICB9IC8vIElmIGJlZ2luIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbGVuZ3RoIG9mIHRoZSBzZXF1ZW5jZSwgYW4gZW1wdHkgYXJyYXkgaXMgcmV0dXJuZWQuCgoKICAgICAgdmFyIHN0YXJ0SW5kZXggPSBfdGhpcy5zdGF0ZS5wYWdlICogX3RoaXMuc3RhdGUucGVyUGFnZTsgLy8gSWYgZW5kIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbGVuZ3RoIG9mIHRoZSBzZXF1ZW5jZSwgc2xpY2UgZXh0cmFjdHMgdGhyb3VnaCB0byB0aGUgZW5kIG9mIHRoZSBzZXF1ZW5jZSAoYXJyLmxlbmd0aCkuCgogICAgICB2YXIgbGFzdEluZGV4ID0gc3RhcnRJbmRleCArIF90aGlzLnN0YXRlLnBlclBhZ2U7CiAgICAgIHJldHVybiBpdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gX3RoaXMuc3RhdGUuZmlsdGVyZWRUeXBlcy5sZW5ndGggPT09IDAgfHwgX3RoaXMuc3RhdGUuZmlsdGVyZWRUeXBlcy5pbmNsdWRlcyhpdGVtLnR5cGUpOwogICAgICB9KS5zbGljZShzdGFydEluZGV4LCBsYXN0SW5kZXgpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmV0Y2hJdGVtcyIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGlzRmV0Y2hpbmdJdGVtczogdHJ1ZQogICAgICB9LCBfdGhpcy5kZWJvdW5jZWRGZXRjaC5iaW5kKG51bGwsIF90aGlzLnN0YXRlLnF1ZXJ5KSk7CiAgICB9KTsKCiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgaXRlbXM6IFtdLAogICAgICBpc0ZldGNoaW5nSXRlbXM6IGZhbHNlLAogICAgICBwYWdlOiAwLAogICAgICBwZXJQYWdlOiBwcm9wcy5pbml0aWFsUGFnZVNpemUgfHwgcHJvcHMuZml4ZWRQYWdlU2l6ZSB8fCAxMCwKICAgICAgcXVlcnk6ICcnLAogICAgICBmaWx0ZXJPcGVuOiBmYWxzZSwKICAgICAgZmlsdGVyZWRUeXBlczogW10sCiAgICAgIHNvcnRPcGVuOiBmYWxzZQogICAgfTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhTYXZlZE9iamVjdEZpbmRlclVpLCBbewogICAga2V5OiAiY29tcG9uZW50V2lsbFVubW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkgewogICAgICB0aGlzLmlzQ29tcG9uZW50TW91bnRlZCA9IGZhbHNlOwogICAgICB0aGlzLmRlYm91bmNlZEZldGNoLmNhbmNlbCgpOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdGhpcy5pc0NvbXBvbmVudE1vdW50ZWQgPSB0cnVlOwogICAgICB0aGlzLmZldGNoSXRlbXMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIHRoaXMucmVuZGVyU2VhcmNoQmFyKCksIHRoaXMucmVuZGVyTGlzdGluZygpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTYXZlZE9iamVjdE1ldGFEYXRhTWFwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTYXZlZE9iamVjdE1ldGFEYXRhTWFwKCkgewogICAgICByZXR1cm4gdGhpcy5wcm9wcy5zYXZlZE9iamVjdE1ldGFEYXRhLnJlZHVjZShmdW5jdGlvbiAobWFwLCBtZXRhRGF0YSkgewogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBtYXAsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgbWV0YURhdGEudHlwZSwgbWV0YURhdGEpKTsKICAgICAgfSwge30pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFBhZ2VDb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFnZUNvdW50KCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBNYXRoLmNlaWwoKHRoaXMuc3RhdGUuZmlsdGVyZWRUeXBlcy5sZW5ndGggPT09IDAgPyB0aGlzLnN0YXRlLml0ZW1zLmxlbmd0aCA6IHRoaXMuc3RhdGUuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5zdGF0ZS5maWx0ZXJlZFR5cGVzLmxlbmd0aCA9PT0gMCB8fCBfdGhpczIuc3RhdGUuZmlsdGVyZWRUeXBlcy5pbmNsdWRlcyhpdGVtLnR5cGUpOwogICAgICB9KS5sZW5ndGgpIC8gdGhpcy5zdGF0ZS5wZXJQYWdlKTsKICAgIH0gLy8gc2VydmVyLXNpZGUgcGFnaW5nIG5vdCBzdXBwb3J0ZWQKICAgIC8vIDEpIHNhdmVkIG9iamVjdCBjbGllbnQgZG9lcyBub3Qgc3VwcG9ydCBzb3J0aW5nIGJ5IHRpdGxlIGJlY2F1c2UgdGl0bGUgaXMgb25seSBtYXBwZWQgYXMgYW5hbHl6ZWQKICAgIC8vIDIpIGNhbiBub3Qgc2VhcmNoIG9uIGFueXRoaW5nIG90aGVyIHRoYW4gdGl0bGUgYmVjYXVzZSBhbGwgb3RoZXIgZmllbGRzIGFyZSBzdG9yZWQgaW4gb3BhcXVlIEpTT04gc3RyaW5ncywKICAgIC8vICAgIGZvciBleGFtcGxlLCB2aXN1YWxpemF0aW9ucyBuZWVkIHRvIGJlIHNlYXJjaCBieSBpc0xhYiBidXQgdGhpcyBpcyBub3QgcG9zc2libGUgaW4gRWxhc3RpY3NlYXJjaCBzaWRlCiAgICAvLyAgICB3aXRoIHRoZSBjdXJyZW50IG1hcHBpbmdzCgogIH0sIHsKICAgIGtleTogImdldEF2YWlsYWJsZVNhdmVkT2JqZWN0TWV0YURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEF2YWlsYWJsZVNhdmVkT2JqZWN0TWV0YURhdGEoKSB7CiAgICAgIHZhciB0eXBlc0luSXRlbXMgPSBuZXcgU2V0KCk7CiAgICAgIHRoaXMuc3RhdGUuaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHR5cGVzSW5JdGVtcy5hZGQoaXRlbS50eXBlKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLnByb3BzLnNhdmVkT2JqZWN0TWV0YURhdGEuZmlsdGVyKGZ1bmN0aW9uIChtZXRhRGF0YSkgewogICAgICAgIHJldHVybiB0eXBlc0luSXRlbXMuaGFzKG1ldGFEYXRhLnR5cGUpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTb3J0T3B0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U29ydE9wdGlvbnMoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIHNvcnRPcHRpb25zID0gW19yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb250ZXh0TWVudUl0ZW0sIHsKICAgICAgICBrZXk6ICJhc2MiLAogICAgICAgIGljb246IHRoaXMuc3RhdGUuc29ydERpcmVjdGlvbiA9PT0gJ2FzYycgfHwgdGhpcy5zdGF0ZS5xdWVyeSA9PT0gJycgJiYgdGhpcy5zdGF0ZS5zb3J0RGlyZWN0aW9uICE9PSAnZGVzYycgPyAnY2hlY2snIDogJ2VtcHR5JywKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgX3RoaXMzLnNldFN0YXRlKHsKICAgICAgICAgICAgc29ydERpcmVjdGlvbjogJ2FzYycKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tpYmFuYS1yZWFjdC5zYXZlZE9iamVjdHMuZmluZGVyLnNvcnRBc2MnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdBc2NlbmRpbmcnCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvbnRleHRNZW51SXRlbSwgewogICAgICAgIGtleTogImRlc2MiLAogICAgICAgIGljb246IHRoaXMuc3RhdGUuc29ydERpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJ2NoZWNrJyA6ICdlbXB0eScsCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHNvcnREaXJlY3Rpb246ICdkZXNjJwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2liYW5hLXJlYWN0LnNhdmVkT2JqZWN0cy5maW5kZXIuc29ydERlc2MnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEZXNjZW5kaW5nJwogICAgICB9KSldOwoKICAgICAgaWYgKHRoaXMuc3RhdGUucXVlcnkpIHsKICAgICAgICBzb3J0T3B0aW9ucy5wdXNoKF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb250ZXh0TWVudUl0ZW0sIHsKICAgICAgICAgIGtleTogImF1dG8iLAogICAgICAgICAgaWNvbjogIXRoaXMuc3RhdGUuc29ydERpcmVjdGlvbiA/ICdjaGVjaycgOiAnZW1wdHknLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgX3RoaXMzLnNldFN0YXRlKHsKICAgICAgICAgICAgICBzb3J0RGlyZWN0aW9uOiB1bmRlZmluZWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tpYmFuYS1yZWFjdC5zYXZlZE9iamVjdHMuZmluZGVyLnNvcnRBdXRvJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdCZXN0IG1hdGNoJwogICAgICAgIH0pKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzb3J0T3B0aW9uczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJTZWFyY2hCYXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclNlYXJjaEJhcigpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgYXZhaWxhYmxlU2F2ZWRPYmplY3RNZXRhRGF0YSA9IHRoaXMuZ2V0QXZhaWxhYmxlU2F2ZWRPYmplY3RNZXRhRGF0YSgpOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgIGd1dHRlclNpemU6ICJtIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiB0cnVlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZFNlYXJjaCwgewogICAgICAgIHBsYWNlaG9sZGVyOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2liYW5hLXJlYWN0LnNhdmVkT2JqZWN0cy5maW5kZXIuc2VhcmNoUGxhY2Vob2xkZXInLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NlYXJjaOKApicKICAgICAgICB9KSwKICAgICAgICAiYXJpYS1sYWJlbCI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdraWJhbmEtcmVhY3Quc2F2ZWRPYmplY3RzLmZpbmRlci5zZWFyY2hQbGFjZWhvbGRlcicsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2VhcmNo4oCmJwogICAgICAgIH0pLAogICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS5xdWVyeSwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgX3RoaXM0LnNldFN0YXRlKHsKICAgICAgICAgICAgcXVlcnk6IGUudGFyZ2V0LnZhbHVlCiAgICAgICAgICB9LCBfdGhpczQuZmV0Y2hJdGVtcyk7CiAgICAgICAgfSwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAic2F2ZWRPYmplY3RGaW5kZXJTZWFyY2hJbnB1dCIsCiAgICAgICAgaXNMb2FkaW5nOiB0aGlzLnN0YXRlLmlzRmV0Y2hpbmdJdGVtcwogICAgICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWx0ZXJHcm91cCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBvcG92ZXIsIHsKICAgICAgICBpZDogImFkZFBhbmVsU29ydFBvcG92ZXIiLAogICAgICAgIHBhbmVsQ2xhc3NOYW1lOiAiZXVpRmlsdGVyR3JvdXBfX3BvcG92ZXJQYW5lbCIsCiAgICAgICAgcGFuZWxQYWRkaW5nU2l6ZTogIm5vbmUiLAogICAgICAgIGlzT3BlbjogdGhpcy5zdGF0ZS5zb3J0T3BlbiwKICAgICAgICBjbG9zZVBvcG92ZXI6IGZ1bmN0aW9uIGNsb3NlUG9wb3ZlcigpIHsKICAgICAgICAgIHJldHVybiBfdGhpczQuc2V0U3RhdGUoewogICAgICAgICAgICBzb3J0T3BlbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYnV0dG9uOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmlsdGVyQnV0dG9uLCB7CiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXM0LnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgICAgICAgIHZhciBzb3J0T3BlbiA9IF9yZWYzLnNvcnRPcGVuOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBzb3J0T3BlbjogIXNvcnRPcGVuCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgaWNvblR5cGU6ICJhcnJvd0Rvd24iLAogICAgICAgICAgaXNTZWxlY3RlZDogdGhpcy5zdGF0ZS5zb3J0T3BlbiwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJzYXZlZE9iamVjdEZpbmRlclNvcnRCdXR0b24iCiAgICAgICAgfSwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tpYmFuYS1yZWFjdC5zYXZlZE9iamVjdHMuZmluZGVyLnNvcnRCdXR0b25MYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU29ydCcKICAgICAgICB9KSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChGaXhlZEV1aUNvbnRleHRNZW51UGFuZWwsIHsKICAgICAgICB3YXRjaGVkSXRlbVByb3BzOiBbJ2ljb24nLCAnZGlzYWJsZWQnXSwKICAgICAgICBpdGVtczogdGhpcy5nZXRTb3J0T3B0aW9ucygpCiAgICAgIH0pKSwgdGhpcy5wcm9wcy5zaG93RmlsdGVyICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQb3BvdmVyLCB7CiAgICAgICAgaWQ6ICJhZGRQYW5lbEZpbHRlclBvcG92ZXIiLAogICAgICAgIHBhbmVsQ2xhc3NOYW1lOiAiZXVpRmlsdGVyR3JvdXBfX3BvcG92ZXJQYW5lbCIsCiAgICAgICAgcGFuZWxQYWRkaW5nU2l6ZTogIm5vbmUiLAogICAgICAgIGlzT3BlbjogdGhpcy5zdGF0ZS5maWx0ZXJPcGVuLAogICAgICAgIGNsb3NlUG9wb3ZlcjogZnVuY3Rpb24gY2xvc2VQb3BvdmVyKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzNC5zZXRTdGF0ZSh7CiAgICAgICAgICAgIGZpbHRlck9wZW46IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGJ1dHRvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpbHRlckJ1dHRvbiwgewogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5zZXRTdGF0ZShmdW5jdGlvbiAoX3JlZjQpIHsKICAgICAgICAgICAgICB2YXIgZmlsdGVyT3BlbiA9IF9yZWY0LmZpbHRlck9wZW47CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGZpbHRlck9wZW46ICFmaWx0ZXJPcGVuCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgaWNvblR5cGU6ICJhcnJvd0Rvd24iLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInNhdmVkT2JqZWN0RmluZGVyRmlsdGVyQnV0dG9uIiwKICAgICAgICAgIGlzU2VsZWN0ZWQ6IHRoaXMuc3RhdGUuZmlsdGVyT3BlbiwKICAgICAgICAgIG51bUZpbHRlcnM6IHRoaXMucHJvcHMuc2F2ZWRPYmplY3RNZXRhRGF0YS5sZW5ndGgsCiAgICAgICAgICBoYXNBY3RpdmVGaWx0ZXJzOiB0aGlzLnN0YXRlLmZpbHRlcmVkVHlwZXMubGVuZ3RoID4gMCwKICAgICAgICAgIG51bUFjdGl2ZUZpbHRlcnM6IHRoaXMuc3RhdGUuZmlsdGVyZWRUeXBlcy5sZW5ndGgKICAgICAgICB9LCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2liYW5hLXJlYWN0LnNhdmVkT2JqZWN0cy5maW5kZXIuZmlsdGVyQnV0dG9uTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1R5cGVzJwogICAgICAgIH0pKQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KEZpeGVkRXVpQ29udGV4dE1lbnVQYW5lbCwgewogICAgICAgIHdhdGNoZWRJdGVtUHJvcHM6IFsnaWNvbicsICdkaXNhYmxlZCddLAogICAgICAgIGl0ZW1zOiB0aGlzLnByb3BzLnNhdmVkT2JqZWN0TWV0YURhdGEubWFwKGZ1bmN0aW9uIChtZXRhRGF0YSkgewogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb250ZXh0TWVudUl0ZW0sIHsKICAgICAgICAgICAga2V5OiBtZXRhRGF0YS50eXBlLAogICAgICAgICAgICBkaXNhYmxlZDogIWF2YWlsYWJsZVNhdmVkT2JqZWN0TWV0YURhdGEuaW5jbHVkZXMobWV0YURhdGEpLAogICAgICAgICAgICBpY29uOiBfdGhpczQuc3RhdGUuZmlsdGVyZWRUeXBlcy5pbmNsdWRlcyhtZXRhRGF0YS50eXBlKSA/ICdjaGVjaycgOiAnZW1wdHknLAogICAgICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAic2F2ZWRPYmplY3RGaW5kZXJGaWx0ZXItIi5jb25jYXQobWV0YURhdGEudHlwZSksCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgX3RoaXM0LnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmNSkgewogICAgICAgICAgICAgICAgdmFyIGZpbHRlcmVkVHlwZXMgPSBfcmVmNS5maWx0ZXJlZFR5cGVzOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgZmlsdGVyZWRUeXBlczogZmlsdGVyZWRUeXBlcy5pbmNsdWRlcyhtZXRhRGF0YS50eXBlKSA/IGZpbHRlcmVkVHlwZXMuZmlsdGVyKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQgIT09IG1ldGFEYXRhLnR5cGU7CiAgICAgICAgICAgICAgICAgIH0pIDogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShmaWx0ZXJlZFR5cGVzKSwgW21ldGFEYXRhLnR5cGVdKSwKICAgICAgICAgICAgICAgICAgcGFnZTogMAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgbWV0YURhdGEubmFtZSk7CiAgICAgICAgfSkKICAgICAgfSkpKSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckxpc3RpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckxpc3RpbmcoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIGl0ZW1zID0gdGhpcy5zdGF0ZS5pdGVtcy5sZW5ndGggPT09IDAgPyBbXSA6IHRoaXMuZ2V0UGFnZU9mSXRlbXMoKTsKICAgICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgIG9uQ2hvb3NlID0gX3RoaXMkcHJvcHMub25DaG9vc2UsCiAgICAgICAgICBzYXZlZE9iamVjdE1ldGFEYXRhID0gX3RoaXMkcHJvcHMuc2F2ZWRPYmplY3RNZXRhRGF0YTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIHRoaXMuc3RhdGUuaXNGZXRjaGluZ0l0ZW1zICYmIHRoaXMuc3RhdGUuaXRlbXMubGVuZ3RoID09PSAwICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBqdXN0aWZ5Q29udGVudDogImNlbnRlciIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgbnVsbCksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMb2FkaW5nU3Bpbm5lciwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJzYXZlZE9iamVjdEZpbmRlckxvYWRpbmdJbmRpY2F0b3IiCiAgICAgIH0pKSksIGl0ZW1zLmxlbmd0aCA+IDAgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KEZpeGVkRXVpTGlzdEdyb3VwLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInNhdmVkT2JqZWN0RmluZGVySXRlbUxpc3QiLAogICAgICAgIG1heFdpZHRoOiBmYWxzZQogICAgICB9LCBpdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgY3VycmVudFNhdmVkT2JqZWN0TWV0YURhdGEgPSBzYXZlZE9iamVjdE1ldGFEYXRhLmZpbmQoZnVuY3Rpb24gKG1ldGFEYXRhKSB7CiAgICAgICAgICByZXR1cm4gbWV0YURhdGEudHlwZSA9PT0gaXRlbS50eXBlOwogICAgICAgIH0pOwogICAgICAgIHZhciBmdWxsTmFtZSA9IGN1cnJlbnRTYXZlZE9iamVjdE1ldGFEYXRhLmdldFRvb2x0aXBGb3JTYXZlZE9iamVjdCA/IGN1cnJlbnRTYXZlZE9iamVjdE1ldGFEYXRhLmdldFRvb2x0aXBGb3JTYXZlZE9iamVjdChpdGVtLnNhdmVkT2JqZWN0KSA6ICIiLmNvbmNhdChpdGVtLnRpdGxlLCAiICgiKS5jb25jYXQoY3VycmVudFNhdmVkT2JqZWN0TWV0YURhdGEubmFtZSwgIikiKTsKICAgICAgICB2YXIgaWNvblR5cGUgPSAoY3VycmVudFNhdmVkT2JqZWN0TWV0YURhdGEgfHwgewogICAgICAgICAgZ2V0SWNvbkZvclNhdmVkT2JqZWN0OiBmdW5jdGlvbiBnZXRJY29uRm9yU2F2ZWRPYmplY3QoKSB7CiAgICAgICAgICAgIHJldHVybiAnZG9jdW1lbnQnOwogICAgICAgICAgfQogICAgICAgIH0pLmdldEljb25Gb3JTYXZlZE9iamVjdChpdGVtLnNhdmVkT2JqZWN0KTsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxpc3RHcm91cEl0ZW0sIHsKICAgICAgICAgIGtleTogaXRlbS5pZCwKICAgICAgICAgIGljb25UeXBlOiBpY29uVHlwZSwKICAgICAgICAgIGxhYmVsOiBpdGVtLnRpdGxlLAogICAgICAgICAgb25DbGljazogb25DaG9vc2UgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG9uQ2hvb3NlKGl0ZW0uaWQsIGl0ZW0udHlwZSwgZnVsbE5hbWUsIGl0ZW0uc2F2ZWRPYmplY3QpOwogICAgICAgICAgfSA6IHVuZGVmaW5lZCwKICAgICAgICAgIHRpdGxlOiBmdWxsTmFtZSwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJzYXZlZE9iamVjdFRpdGxlIi5jb25jYXQoKGl0ZW0udGl0bGUgfHwgJycpLnNwbGl0KCcgJykuam9pbignLScpKQogICAgICAgIH0pOwogICAgICB9KSkgOiAhdGhpcy5zdGF0ZS5pc0ZldGNoaW5nSXRlbXMgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUVtcHR5UHJvbXB0LCB7CiAgICAgICAgYm9keTogdGhpcy5wcm9wcy5ub0l0ZW1zTWVzc2FnZQogICAgICB9KSwgdGhpcy5nZXRQYWdlQ291bnQoKSA+IDEgJiYgKHRoaXMucHJvcHMuZml4ZWRQYWdlU2l6ZSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQYWdpbmF0aW9uLCB7CiAgICAgICAgYWN0aXZlUGFnZTogdGhpcy5zdGF0ZS5wYWdlLAogICAgICAgIHBhZ2VDb3VudDogdGhpcy5nZXRQYWdlQ291bnQoKSwKICAgICAgICBvblBhZ2VDbGljazogZnVuY3Rpb24gb25QYWdlQ2xpY2socGFnZSkgewogICAgICAgICAgX3RoaXM1LnNldFN0YXRlKHsKICAgICAgICAgICAgcGFnZTogcGFnZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUYWJsZVBhZ2luYXRpb24sIHsKICAgICAgICBhY3RpdmVQYWdlOiB0aGlzLnN0YXRlLnBhZ2UsCiAgICAgICAgcGFnZUNvdW50OiB0aGlzLmdldFBhZ2VDb3VudCgpLAogICAgICAgIG9uQ2hhbmdlUGFnZTogZnVuY3Rpb24gb25DaGFuZ2VQYWdlKHBhZ2UpIHsKICAgICAgICAgIF90aGlzNS5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHBhZ2U6IHBhZ2UKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25DaGFuZ2VJdGVtc1BlclBhZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlSXRlbXNQZXJQYWdlKHBlclBhZ2UpIHsKICAgICAgICAgIF90aGlzNS5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHBlclBhZ2U6IHBlclBhZ2UKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgaXRlbXNQZXJQYWdlOiB0aGlzLnN0YXRlLnBlclBhZ2UsCiAgICAgICAgaXRlbXNQZXJQYWdlT3B0aW9uczogWzUsIDEwLCAxNSwgMjVdCiAgICAgIH0pKSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU2F2ZWRPYmplY3RGaW5kZXJVaTsKfShfcmVhY3QuZGVmYXVsdC5Db21wb25lbnQpOwoKZXhwb3J0cy5TYXZlZE9iamVjdEZpbmRlclVpID0gU2F2ZWRPYmplY3RGaW5kZXJVaTsKCl9kZWZpbmVQcm9wZXJ0eShTYXZlZE9iamVjdEZpbmRlclVpLCAicHJvcFR5cGVzIiwgewogIG9uQ2hvb3NlOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYywKICBub0l0ZW1zTWVzc2FnZTogX3Byb3BUeXBlcy5kZWZhdWx0Lm5vZGUsCiAgc2F2ZWRPYmplY3RNZXRhRGF0YTogX3Byb3BUeXBlcy5kZWZhdWx0LmFycmF5LmlzUmVxdWlyZWQsCiAgaW5pdGlhbFBhZ2VTaXplOiBfcHJvcFR5cGVzLmRlZmF1bHQub25lT2YoWzUsIDEwLCAxNSwgMjVdKSwKICBmaXhlZFBhZ2VTaXplOiBfcHJvcFR5cGVzLmRlZmF1bHQubnVtYmVyLAogIHNob3dGaWx0ZXI6IF9wcm9wVHlwZXMuZGVmYXVsdC5ib29sCn0pOwoKdmFyIFNhdmVkT2JqZWN0RmluZGVyID0gZnVuY3Rpb24gU2F2ZWRPYmplY3RGaW5kZXIocHJvcHMpIHsKICB2YXIgX3VzZUtpYmFuYSA9ICgwLCBfY29udGV4dDIudXNlS2liYW5hKSgpLAogICAgICBzZXJ2aWNlcyA9IF91c2VLaWJhbmEuc2VydmljZXM7CgogIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFNhdmVkT2JqZWN0RmluZGVyVWksIF9leHRlbmRzKHt9LCBwcm9wcywgewogICAgc2F2ZWRPYmplY3RzOiBzZXJ2aWNlcy5zYXZlZE9iamVjdCwKICAgIHVpU2V0dGluZ3M6IHNlcnZpY2VzLnVpU2V0dGluZ3MKICB9KSk7Cn07CgpleHBvcnRzLlNhdmVkT2JqZWN0RmluZGVyID0gU2F2ZWRPYmplY3RGaW5kZXI7"},null]}