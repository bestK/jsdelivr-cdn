{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/layers/sources/es_search_source/es_search_source.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/layers/sources/es_search_source/es_search_source.js","mtime":1585205045341},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkVTU2VhcmNoU291cmNlID0gdm9pZCAwOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF92ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1dWlkL3Y0IikpOwoKdmFyIF92ZWN0b3JfZmVhdHVyZV90eXBlcyA9IHJlcXVpcmUoIi4uL3ZlY3Rvcl9mZWF0dXJlX3R5cGVzIik7Cgp2YXIgX2VzX3NvdXJjZSA9IHJlcXVpcmUoIi4uL2VzX3NvdXJjZSIpOwoKdmFyIF9raWJhbmFfc2VydmljZXMgPSByZXF1aXJlKCIuLi8uLi8uLi9raWJhbmFfc2VydmljZXMiKTsKCnZhciBfZWxhc3RpY3NlYXJjaF9nZW9fdXRpbHMgPSByZXF1aXJlKCIuLi8uLi8uLi9lbGFzdGljc2VhcmNoX2dlb191dGlscyIpOwoKdmFyIF9jcmVhdGVfc291cmNlX2VkaXRvciA9IHJlcXVpcmUoIi4vY3JlYXRlX3NvdXJjZV9lZGl0b3IiKTsKCnZhciBfdXBkYXRlX3NvdXJjZV9lZGl0b3IgPSByZXF1aXJlKCIuL3VwZGF0ZV9zb3VyY2VfZWRpdG9yIik7Cgp2YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvbW1vbi9jb25zdGFudHMiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9pMThuX2dldHRlcnMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vaTE4bl9nZXR0ZXJzIik7Cgp2YXIgX2luZGV4X3BhdHRlcm5fdXRpbCA9IHJlcXVpcmUoIi4uLy4uLy4uL2luZGV4X3BhdHRlcm5fdXRpbCIpOwoKdmFyIF9sb2FkX2luZGV4X3NldHRpbmdzID0gcmVxdWlyZSgiLi9sb2FkX2luZGV4X3NldHRpbmdzIik7Cgp2YXIgX2NvbnN0YW50czIgPSByZXF1aXJlKCIuL2NvbnN0YW50cyIpOwoKdmFyIF9lc19kb2NfZmllbGQgPSByZXF1aXJlKCIuLi8uLi9maWVsZHMvZXNfZG9jX2ZpZWxkIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKZnVuY3Rpb24gZ2V0RmllbGQoaW5kZXhQYXR0ZXJuLCBmaWVsZE5hbWUpIHsKICB2YXIgZmllbGQgPSBpbmRleFBhdHRlcm4uZmllbGRzLmdldEJ5TmFtZShmaWVsZE5hbWUpOwoKICBpZiAoIWZpZWxkKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuc291cmNlLmVzU2VhcmNoLmZpZWxkTm90Rm91bmRNc2cnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVW5hYmxlIHRvIGZpbmQgJ3tmaWVsZE5hbWV9JyBpbiBpbmRleC1wYXR0ZXJuICd7aW5kZXhQYXR0ZXJuVGl0bGV9Jy4iLAogICAgICB2YWx1ZXM6IHsKICAgICAgICBmaWVsZE5hbWU6IGZpZWxkTmFtZSwKICAgICAgICBpbmRleFBhdHRlcm5UaXRsZTogaW5kZXhQYXR0ZXJuLnRpdGxlCiAgICAgIH0KICAgIH0pKTsKICB9CgogIHJldHVybiBmaWVsZDsKfQoKZnVuY3Rpb24gYWRkRmllbGRUb0RTTChkc2wsIGZpZWxkKSB7CiAgcmV0dXJuICFmaWVsZC5zY3JpcHRlZCA/IF9vYmplY3RTcHJlYWQoe30sIGRzbCwgewogICAgZmllbGQ6IGZpZWxkLm5hbWUKICB9KSA6IF9vYmplY3RTcHJlYWQoe30sIGRzbCwgewogICAgc2NyaXB0OiB7CiAgICAgIHNvdXJjZTogZmllbGQuc2NyaXB0LAogICAgICBsYW5nOiBmaWVsZC5sYW5nCiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIGdldERvY1ZhbHVlQW5kU291cmNlRmllbGRzKGluZGV4UGF0dGVybiwgZmllbGROYW1lcykgewogIHZhciBkb2NWYWx1ZUZpZWxkcyA9IFtdOwogIHZhciBzb3VyY2VPbmx5RmllbGRzID0gW107CiAgdmFyIHNjcmlwdEZpZWxkcyA9IHt9OwogIGZpZWxkTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAoZmllbGROYW1lKSB7CiAgICB2YXIgZmllbGQgPSBnZXRGaWVsZChpbmRleFBhdHRlcm4sIGZpZWxkTmFtZSk7CgogICAgaWYgKGZpZWxkLnNjcmlwdGVkKSB7CiAgICAgIHNjcmlwdEZpZWxkc1tmaWVsZC5uYW1lXSA9IHsKICAgICAgICBzY3JpcHQ6IHsKICAgICAgICAgIHNvdXJjZTogZmllbGQuc2NyaXB0LAogICAgICAgICAgbGFuZzogZmllbGQubGFuZwogICAgICAgIH0KICAgICAgfTsKICAgIH0gZWxzZSBpZiAoZmllbGQucmVhZEZyb21Eb2NWYWx1ZXMpIHsKICAgICAgdmFyIGRvY1ZhbHVlRmllbGQgPSBmaWVsZC50eXBlID09PSAnZGF0ZScgPyB7CiAgICAgICAgZmllbGQ6IGZpZWxkTmFtZSwKICAgICAgICBmb3JtYXQ6ICdlcG9jaF9taWxsaXMnCiAgICAgIH0gOiBmaWVsZE5hbWU7CiAgICAgIGRvY1ZhbHVlRmllbGRzLnB1c2goZG9jVmFsdWVGaWVsZCk7CiAgICB9IGVsc2UgewogICAgICBzb3VyY2VPbmx5RmllbGRzLnB1c2goZmllbGROYW1lKTsKICAgIH0KICB9KTsKICByZXR1cm4gewogICAgZG9jVmFsdWVGaWVsZHM6IGRvY1ZhbHVlRmllbGRzLAogICAgc291cmNlT25seUZpZWxkczogc291cmNlT25seUZpZWxkcywKICAgIHNjcmlwdEZpZWxkczogc2NyaXB0RmllbGRzCiAgfTsKfQoKdmFyIEVTU2VhcmNoU291cmNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0Fic3RyYWN0RVNTb3VyY2UpIHsKICBfaW5oZXJpdHMoRVNTZWFyY2hTb3VyY2UsIF9BYnN0cmFjdEVTU291cmNlKTsKCiAgX2NyZWF0ZUNsYXNzKEVTU2VhcmNoU291cmNlLCBudWxsLCBbewogICAga2V5OiAicmVuZGVyRWRpdG9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJFZGl0b3IoX3JlZikgewogICAgICB2YXIgb25QcmV2aWV3U291cmNlID0gX3JlZi5vblByZXZpZXdTb3VyY2UsCiAgICAgICAgICBpbnNwZWN0b3JBZGFwdGVycyA9IF9yZWYuaW5zcGVjdG9yQWRhcHRlcnM7CgogICAgICB2YXIgb25Tb3VyY2VDb25maWdDaGFuZ2UgPSBmdW5jdGlvbiBvblNvdXJjZUNvbmZpZ0NoYW5nZShzb3VyY2VDb25maWcpIHsKICAgICAgICBpZiAoIXNvdXJjZUNvbmZpZykgewogICAgICAgICAgb25QcmV2aWV3U291cmNlKG51bGwpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNvdXJjZSA9IG5ldyBFU1NlYXJjaFNvdXJjZShfb2JqZWN0U3ByZWFkKHsKICAgICAgICAgIGlkOiAoMCwgX3YuZGVmYXVsdCkoKQogICAgICAgIH0sIHNvdXJjZUNvbmZpZyksIGluc3BlY3RvckFkYXB0ZXJzKTsKICAgICAgICBvblByZXZpZXdTb3VyY2Uoc291cmNlKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jcmVhdGVfc291cmNlX2VkaXRvci5DcmVhdGVTb3VyY2VFZGl0b3IsIHsKICAgICAgICBvblNvdXJjZUNvbmZpZ0NoYW5nZTogb25Tb3VyY2VDb25maWdDaGFuZ2UKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICBmdW5jdGlvbiBFU1NlYXJjaFNvdXJjZShkZXNjcmlwdG9yLCBpbnNwZWN0b3JBZGFwdGVycykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFU1NlYXJjaFNvdXJjZSk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoRVNTZWFyY2hTb3VyY2UpLmNhbGwodGhpcywgX29iamVjdFNwcmVhZCh7fSwgZGVzY3JpcHRvciwgewogICAgICBpZDogZGVzY3JpcHRvci5pZCwKICAgICAgdHlwZTogRVNTZWFyY2hTb3VyY2UudHlwZSwKICAgICAgaW5kZXhQYXR0ZXJuSWQ6IGRlc2NyaXB0b3IuaW5kZXhQYXR0ZXJuSWQsCiAgICAgIGdlb0ZpZWxkOiBkZXNjcmlwdG9yLmdlb0ZpZWxkLAogICAgICBmaWx0ZXJCeU1hcEJvdW5kczogX2xvZGFzaC5kZWZhdWx0LmdldChkZXNjcmlwdG9yLCAnZmlsdGVyQnlNYXBCb3VuZHMnLCBfY29uc3RhbnRzMi5ERUZBVUxUX0ZJTFRFUl9CWV9NQVBfQk9VTkRTKSwKICAgICAgdG9vbHRpcFByb3BlcnRpZXM6IF9sb2Rhc2guZGVmYXVsdC5nZXQoZGVzY3JpcHRvciwgJ3Rvb2x0aXBQcm9wZXJ0aWVzJywgW10pLAogICAgICBzb3J0RmllbGQ6IF9sb2Rhc2guZGVmYXVsdC5nZXQoZGVzY3JpcHRvciwgJ3NvcnRGaWVsZCcsICcnKSwKICAgICAgc29ydE9yZGVyOiBfbG9kYXNoLmRlZmF1bHQuZ2V0KGRlc2NyaXB0b3IsICdzb3J0T3JkZXInLCBfY29uc3RhbnRzLlNPUlRfT1JERVIuREVTQyksCiAgICAgIHVzZVRvcEhpdHM6IF9sb2Rhc2guZGVmYXVsdC5nZXQoZGVzY3JpcHRvciwgJ3VzZVRvcEhpdHMnLCBmYWxzZSksCiAgICAgIHRvcEhpdHNTcGxpdEZpZWxkOiBkZXNjcmlwdG9yLnRvcEhpdHNTcGxpdEZpZWxkLAogICAgICB0b3BIaXRzU2l6ZTogX2xvZGFzaC5kZWZhdWx0LmdldChkZXNjcmlwdG9yLCAndG9wSGl0c1NpemUnLCAxKQogICAgfSksIGluc3BlY3RvckFkYXB0ZXJzKSk7CiAgICBfdGhpcy5fdG9vbHRpcEZpZWxkcyA9IF90aGlzLl9kZXNjcmlwdG9yLnRvb2x0aXBQcm9wZXJ0aWVzLm1hcChmdW5jdGlvbiAocHJvcGVydHkpIHsKICAgICAgcmV0dXJuIF90aGlzLmNyZWF0ZUZpZWxkKHsKICAgICAgICBmaWVsZE5hbWU6IHByb3BlcnR5CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRVNTZWFyY2hTb3VyY2UsIFt7CiAgICBrZXk6ICJjcmVhdGVGaWVsZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRmllbGQoX3JlZjIpIHsKICAgICAgdmFyIGZpZWxkTmFtZSA9IF9yZWYyLmZpZWxkTmFtZTsKICAgICAgcmV0dXJuIG5ldyBfZXNfZG9jX2ZpZWxkLkVTRG9jRmllbGQoewogICAgICAgIGZpZWxkTmFtZTogZmllbGROYW1lLAogICAgICAgIHNvdXJjZTogdGhpcwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJTb3VyY2VTZXR0aW5nc0VkaXRvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyU291cmNlU2V0dGluZ3NFZGl0b3IoX3JlZjMpIHsKICAgICAgdmFyIG9uQ2hhbmdlID0gX3JlZjMub25DaGFuZ2U7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF91cGRhdGVfc291cmNlX2VkaXRvci5VcGRhdGVTb3VyY2VFZGl0b3IsIHsKICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgaW5kZXhQYXR0ZXJuSWQ6IHRoaXMuX2Rlc2NyaXB0b3IuaW5kZXhQYXR0ZXJuSWQsCiAgICAgICAgb25DaGFuZ2U6IG9uQ2hhbmdlLAogICAgICAgIHRvb2x0aXBGaWVsZHM6IHRoaXMuX3Rvb2x0aXBGaWVsZHMsCiAgICAgICAgc29ydEZpZWxkOiB0aGlzLl9kZXNjcmlwdG9yLnNvcnRGaWVsZCwKICAgICAgICBzb3J0T3JkZXI6IHRoaXMuX2Rlc2NyaXB0b3Iuc29ydE9yZGVyLAogICAgICAgIHVzZVRvcEhpdHM6IHRoaXMuX2Rlc2NyaXB0b3IudXNlVG9wSGl0cywKICAgICAgICB0b3BIaXRzU3BsaXRGaWVsZDogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU3BsaXRGaWVsZCwKICAgICAgICB0b3BIaXRzU2l6ZTogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU2l6ZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXROdW1iZXJGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE51bWJlckZpZWxkcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgaW5kZXhQYXR0ZXJuOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGdldE51bWJlckZpZWxkcyQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDA7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLmdldEluZGV4UGF0dGVybigpKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGluZGV4UGF0dGVybi5maWVsZHMuZ2V0QnlUeXBlKCdudW1iZXInKS5tYXAoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLmNyZWF0ZUZpZWxkKHsKICAgICAgICAgICAgICAgICAgZmllbGROYW1lOiBmaWVsZC5uYW1lCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDc7CiAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBbXSk7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzLCBbWzAsIDddXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RGF0ZUZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0ZUZpZWxkcygpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgX2luZGV4UGF0dGVybjsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZ2V0RGF0ZUZpZWxkcyQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAwOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuZ2V0SW5kZXhQYXR0ZXJuKCkpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIF9pbmRleFBhdHRlcm4gPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgX2luZGV4UGF0dGVybi5maWVsZHMuZ2V0QnlUeXBlKCdkYXRlJykubWFwKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMy5jcmVhdGVGaWVsZCh7CiAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gNzsKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIFtdKTsKCiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzLCBbWzAsIDddXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Q2F0ZWdvcmljYWxGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENhdGVnb3JpY2FsRmllbGRzKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBfaW5kZXhQYXR0ZXJuMiwgYWdnRmllbGRzOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBnZXRDYXRlZ29yaWNhbEZpZWxkcyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAwOwogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuZ2V0SW5kZXhQYXR0ZXJuKCkpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIF9pbmRleFBhdHRlcm4yID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgYWdnRmllbGRzID0gW107CgogICAgICAgICAgICAgIF9jb25zdGFudHMuQ0FURUdPUklDQUxfREFUQV9UWVBFUy5mb3JFYWNoKGZ1bmN0aW9uIChkYXRhVHlwZSkgewogICAgICAgICAgICAgICAgX2luZGV4UGF0dGVybjIuZmllbGRzLmdldEJ5VHlwZShkYXRhVHlwZSkuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkLmFnZ3JlZ2F0YWJsZSkgewogICAgICAgICAgICAgICAgICAgIGFnZ0ZpZWxkcy5wdXNoKGZpZWxkKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBhZ2dGaWVsZHMubWFwKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5jcmVhdGVGaWVsZCh7CiAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gOTsKICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIFtdKTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzLCBbWzAsIDldXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZHMoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIF9pbmRleFBhdHRlcm4zOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBnZXRGaWVsZHMkKF9jb250ZXh0NCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gMDsKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLmdldEluZGV4UGF0dGVybigpKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBfaW5kZXhQYXR0ZXJuMyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBfaW5kZXhQYXR0ZXJuMy5maWVsZHMuZmlsdGVyKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICAgICAgLy8gRW5zdXJlIGZpZWxkZGF0YSBpcyBlbmFibGVkIGZvciBmaWVsZC4KICAgICAgICAgICAgICAgIC8vIFNlYXJjaCBkb2VzIG5vdCByZXF1ZXN0IF9zb3VyY2UKICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5hZ2dyZWdhdGFibGU7CiAgICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNS5jcmVhdGVGaWVsZCh7CiAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gNzsKICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIFtdKTsKCiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzLCBbWzAsIDddXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RmllbGROYW1lcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RmllbGROYW1lcygpIHsKICAgICAgcmV0dXJuIFt0aGlzLl9kZXNjcmlwdG9yLmdlb0ZpZWxkXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRJbW11dGFibGVQcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbW11dGFibGVQcm9wZXJ0aWVzKCkgewogICAgICB2YXIgaW5kZXhQYXR0ZXJuVGl0bGUsIGdlb0ZpZWxkVHlwZSwgX2luZGV4UGF0dGVybjQsIGdlb0ZpZWxkOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBnZXRJbW11dGFibGVQcm9wZXJ0aWVzJChfY29udGV4dDUpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpbmRleFBhdHRlcm5UaXRsZSA9IHRoaXMuX2Rlc2NyaXB0b3IuaW5kZXhQYXR0ZXJuSWQ7CiAgICAgICAgICAgICAgZ2VvRmllbGRUeXBlID0gJyc7CiAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAyOwogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuZ2V0SW5kZXhQYXR0ZXJuKCkpOwoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIF9pbmRleFBhdHRlcm40ID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuVGl0bGUgPSBfaW5kZXhQYXR0ZXJuNC50aXRsZTsKICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9nZXRHZW9GaWVsZCgpKTsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBnZW9GaWVsZCA9IF9jb250ZXh0NS5zZW50OwogICAgICAgICAgICAgIGdlb0ZpZWxkVHlwZSA9IGdlb0ZpZWxkLnR5cGU7CiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxNTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAxMzsKICAgICAgICAgICAgICBfY29udGV4dDUudDAgPSBfY29udGV4dDVbImNhdGNoIl0oMik7CgogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBbewogICAgICAgICAgICAgICAgbGFiZWw6ICgwLCBfaTE4bl9nZXR0ZXJzLmdldERhdGFTb3VyY2VMYWJlbCkoKSwKICAgICAgICAgICAgICAgIHZhbHVlOiBFU1NlYXJjaFNvdXJjZS50aXRsZQogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNTZWFyY2guaW5kZXhQYXR0ZXJuTGFiZWwnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW5kZXggcGF0dGVybiIKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgdmFsdWU6IGluZGV4UGF0dGVyblRpdGxlCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NlYXJjaC5nZW9GaWVsZExhYmVsJywgewogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0dlb3NwYXRpYWwgZmllbGQnCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9kZXNjcmlwdG9yLmdlb0ZpZWxkCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NlYXJjaC5nZW9GaWVsZFR5cGVMYWJlbCcsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdHZW9zcGF0aWFsIGZpZWxkIHR5cGUnCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHZhbHVlOiBnZW9GaWVsZFR5cGUKICAgICAgICAgICAgICB9XSk7CgogICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcywgW1syLCAxM11dKTsKICAgIH0gLy8gUmV0dXJucyBzb3J0IGNvbnRlbnQgZm9yIGFuIEVsYXN0aWNzZWFyY2ggc2VhcmNoIGJvZHkKCiAgfSwgewogICAga2V5OiAiX2J1aWxkRXNTb3J0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfYnVpbGRFc1NvcnQoKSB7CiAgICAgIHZhciBfdGhpcyRfZGVzY3JpcHRvciA9IHRoaXMuX2Rlc2NyaXB0b3IsCiAgICAgICAgICBzb3J0RmllbGQgPSBfdGhpcyRfZGVzY3JpcHRvci5zb3J0RmllbGQsCiAgICAgICAgICBzb3J0T3JkZXIgPSBfdGhpcyRfZGVzY3JpcHRvci5zb3J0T3JkZXI7CiAgICAgIHJldHVybiBbX2RlZmluZVByb3BlcnR5KHt9LCBzb3J0RmllbGQsIHsKICAgICAgICBvcmRlcjogc29ydE9yZGVyCiAgICAgIH0pXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0VG9wSGl0cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldFRvcEhpdHMobGF5ZXJOYW1lLCBzZWFyY2hGaWx0ZXJzLCByZWdpc3RlckNhbmNlbENhbGxiYWNrKSB7CiAgICAgIHZhciBfdGhpcyRfZGVzY3JpcHRvcjIsIHRvcEhpdHNTcGxpdEZpZWxkTmFtZSwgdG9wSGl0c1NpemUsIGluZGV4UGF0dGVybiwgX2dldERvY1ZhbHVlQW5kU291cmNlLCBkb2NWYWx1ZUZpZWxkcywgc291cmNlT25seUZpZWxkcywgc2NyaXB0RmllbGRzLCB0b3BIaXRzLCB0b3BIaXRzU3BsaXRGaWVsZCwgY2FyZGluYWxpdHlBZ2csIHRlcm1zQWdnLCBzZWFyY2hTb3VyY2UsIHJlc3AsIGFsbEhpdHMsIGVudGl0eUJ1Y2tldHMsIHRvdGFsRW50aXRpZXMsIGFyZUVudGl0aWVzVHJpbW1lZCwgYXJlVG9wSGl0c1RyaW1tZWQ7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9nZXRUb3BIaXRzJChfY29udGV4dDYpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpcyRfZGVzY3JpcHRvcjIgPSB0aGlzLl9kZXNjcmlwdG9yLCB0b3BIaXRzU3BsaXRGaWVsZE5hbWUgPSBfdGhpcyRfZGVzY3JpcHRvcjIudG9wSGl0c1NwbGl0RmllbGQsIHRvcEhpdHNTaXplID0gX3RoaXMkX2Rlc2NyaXB0b3IyLnRvcEhpdHNTaXplOwogICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuZ2V0SW5kZXhQYXR0ZXJuKCkpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGluZGV4UGF0dGVybiA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgIF9nZXREb2NWYWx1ZUFuZFNvdXJjZSA9IGdldERvY1ZhbHVlQW5kU291cmNlRmllbGRzKGluZGV4UGF0dGVybiwgc2VhcmNoRmlsdGVycy5maWVsZE5hbWVzKSwgZG9jVmFsdWVGaWVsZHMgPSBfZ2V0RG9jVmFsdWVBbmRTb3VyY2UuZG9jVmFsdWVGaWVsZHMsIHNvdXJjZU9ubHlGaWVsZHMgPSBfZ2V0RG9jVmFsdWVBbmRTb3VyY2Uuc291cmNlT25seUZpZWxkcywgc2NyaXB0RmllbGRzID0gX2dldERvY1ZhbHVlQW5kU291cmNlLnNjcmlwdEZpZWxkczsKICAgICAgICAgICAgICB0b3BIaXRzID0gewogICAgICAgICAgICAgICAgc2l6ZTogdG9wSGl0c1NpemUsCiAgICAgICAgICAgICAgICBzY3JpcHRfZmllbGRzOiBzY3JpcHRGaWVsZHMsCiAgICAgICAgICAgICAgICBkb2N2YWx1ZV9maWVsZHM6IGRvY1ZhbHVlRmllbGRzCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuX2hhc1NvcnQoKSkgewogICAgICAgICAgICAgICAgdG9wSGl0cy5zb3J0ID0gdGhpcy5fYnVpbGRFc1NvcnQoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChzb3VyY2VPbmx5RmllbGRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdG9wSGl0cy5fc291cmNlID0gZmFsc2U7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRvcEhpdHMuX3NvdXJjZSA9IHsKICAgICAgICAgICAgICAgICAgaW5jbHVkZXM6IHNvdXJjZU9ubHlGaWVsZHMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0b3BIaXRzU3BsaXRGaWVsZCA9IGdldEZpZWxkKGluZGV4UGF0dGVybiwgdG9wSGl0c1NwbGl0RmllbGROYW1lKTsKICAgICAgICAgICAgICBjYXJkaW5hbGl0eUFnZyA9IHsKICAgICAgICAgICAgICAgIHByZWNpc2lvbl90aHJlc2hvbGQ6IDEKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHRlcm1zQWdnID0gewogICAgICAgICAgICAgICAgc2l6ZTogX2NvbnN0YW50cy5ERUZBVUxUX01BWF9CVUNLRVRTX0xJTUlULAogICAgICAgICAgICAgICAgc2hhcmRfc2l6ZTogX2NvbnN0YW50cy5ERUZBVUxUX01BWF9CVUNLRVRTX0xJTUlUCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDEzOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGhpcy5fbWFrZVNlYXJjaFNvdXJjZShzZWFyY2hGaWx0ZXJzLCAwKSk7CgogICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIHNlYXJjaFNvdXJjZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnYWdncycsIHsKICAgICAgICAgICAgICAgIHRvdGFsRW50aXRpZXM6IHsKICAgICAgICAgICAgICAgICAgY2FyZGluYWxpdHk6IGFkZEZpZWxkVG9EU0woY2FyZGluYWxpdHlBZ2csIHRvcEhpdHNTcGxpdEZpZWxkKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVudGl0eVNwbGl0OiB7CiAgICAgICAgICAgICAgICAgIHRlcm1zOiBhZGRGaWVsZFRvRFNMKHRlcm1zQWdnLCB0b3BIaXRzU3BsaXRGaWVsZCksCiAgICAgICAgICAgICAgICAgIGFnZ3M6IHsKICAgICAgICAgICAgICAgICAgICBlbnRpdHlIaXRzOiB7CiAgICAgICAgICAgICAgICAgICAgICB0b3BfaGl0czogdG9wSGl0cwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9ydW5Fc1F1ZXJ5KHsKICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogdGhpcy5nZXRJZCgpLAogICAgICAgICAgICAgICAgcmVxdWVzdE5hbWU6IGxheWVyTmFtZSwKICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZTogc2VhcmNoU291cmNlLAogICAgICAgICAgICAgICAgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjazogcmVnaXN0ZXJDYW5jZWxDYWxsYmFjaywKICAgICAgICAgICAgICAgIHJlcXVlc3REZXNjcmlwdGlvbjogJ0VsYXN0aWNzZWFyY2ggZG9jdW1lbnQgdG9wIGhpdHMgcmVxdWVzdCcKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgIHJlc3AgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICBhbGxIaXRzID0gW107CiAgICAgICAgICAgICAgZW50aXR5QnVja2V0cyA9IF9sb2Rhc2guZGVmYXVsdC5nZXQocmVzcCwgJ2FnZ3JlZ2F0aW9ucy5lbnRpdHlTcGxpdC5idWNrZXRzJywgW10pOwogICAgICAgICAgICAgIHRvdGFsRW50aXRpZXMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHJlc3AsICdhZ2dyZWdhdGlvbnMudG90YWxFbnRpdGllcy52YWx1ZScsIDApOyAvLyBjYW4gbm90IGNvbXBhcmUgZW50aXR5QnVja2V0cy5sZW5ndGggdG8gdG90YWxFbnRpdGllcyBiZWNhdXNlIHRvdGFsRW50aXRpZXMgaXMgYW4gYXBwcm94aW1hdGUKCiAgICAgICAgICAgICAgYXJlRW50aXRpZXNUcmltbWVkID0gZW50aXR5QnVja2V0cy5sZW5ndGggPj0gX2NvbnN0YW50cy5ERUZBVUxUX01BWF9CVUNLRVRTX0xJTUlUOwogICAgICAgICAgICAgIGFyZVRvcEhpdHNUcmltbWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgZW50aXR5QnVja2V0cy5mb3JFYWNoKGZ1bmN0aW9uIChlbnRpdHlCdWNrZXQpIHsKICAgICAgICAgICAgICAgIHZhciB0b3RhbCA9IF9sb2Rhc2guZGVmYXVsdC5nZXQoZW50aXR5QnVja2V0LCAnZW50aXR5SGl0cy5oaXRzLnRvdGFsJywgMCk7CgogICAgICAgICAgICAgICAgdmFyIGhpdHMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KGVudGl0eUJ1Y2tldCwgJ2VudGl0eUhpdHMuaGl0cy5oaXRzJywgW10pOyAvLyBSZXZlcnNlIGhpdHMgbGlzdCBzbyB0b3AgZG9jdW1lbnRzIGJ5IHNvcnQgYXJlIGRyYXduIG9uIHRvcAoKCiAgICAgICAgICAgICAgICBhbGxIaXRzLnB1c2guYXBwbHkoYWxsSGl0cywgX3RvQ29uc3VtYWJsZUFycmF5KGhpdHMucmV2ZXJzZSgpKSk7CgogICAgICAgICAgICAgICAgaWYgKHRvdGFsID4gaGl0cy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgYXJlVG9wSGl0c1RyaW1tZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICBoaXRzOiBhbGxIaXRzLAogICAgICAgICAgICAgICAgbWV0YTogewogICAgICAgICAgICAgICAgICBhcmVSZXN1bHRzVHJpbW1lZDogYXJlRW50aXRpZXNUcmltbWVkIHx8IGFyZVRvcEhpdHNUcmltbWVkLAogICAgICAgICAgICAgICAgICAvLyB1c2VkIHRvIGZvcmNlIHJlLWZldGNoIHdoZW4gem9vbWluZyBpbgogICAgICAgICAgICAgICAgICBhcmVFbnRpdGllc1RyaW1tZWQ6IGFyZUVudGl0aWVzVHJpbW1lZCwKICAgICAgICAgICAgICAgICAgZW50aXR5Q291bnQ6IGVudGl0eUJ1Y2tldHMubGVuZ3RoLAogICAgICAgICAgICAgICAgICB0b3RhbEVudGl0aWVzOiB0b3RhbEVudGl0aWVzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9IC8vIHNlYXJjaEZpbHRlcnMuZmllbGROYW1lcyBjb250YWlucyBnZW8gZmllbGQgYW5kIGFueSBmaWVsZHMgbmVlZGVkIGZvciBzdHlsaW5nIGZlYXR1cmVzCiAgICAvLyBQZXJmb3JtcyBFbGFzdGljc2VhcmNoIHNlYXJjaCByZXF1ZXN0IGJlaW5nIGNhcmVmdWwgdG8gcHVsbCBiYWNrIG9ubHkgcmVxdWlyZWQgZmllbGRzIHRvIG1pbmltaXplIHJlc3BvbnNlIHNpemUKCiAgfSwgewogICAga2V5OiAiX2dldFNlYXJjaEhpdHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRTZWFyY2hIaXRzKGxheWVyTmFtZSwgc2VhcmNoRmlsdGVycywgbWF4UmVzdWx0V2luZG93LCByZWdpc3RlckNhbmNlbENhbGxiYWNrKSB7CiAgICAgIHZhciBpbmRleFBhdHRlcm4sIF9nZXREb2NWYWx1ZUFuZFNvdXJjZTIsIGRvY1ZhbHVlRmllbGRzLCBzb3VyY2VPbmx5RmllbGRzLCBpbml0aWFsU2VhcmNoQ29udGV4dCwgc2VhcmNoU291cmNlLCByZXNwOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfZ2V0U2VhcmNoSGl0cyQoX2NvbnRleHQ3KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGhpcy5nZXRJbmRleFBhdHRlcm4oKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQ3LnNlbnQ7CiAgICAgICAgICAgICAgX2dldERvY1ZhbHVlQW5kU291cmNlMiA9IGdldERvY1ZhbHVlQW5kU291cmNlRmllbGRzKGluZGV4UGF0dGVybiwgc2VhcmNoRmlsdGVycy5maWVsZE5hbWVzKSwgZG9jVmFsdWVGaWVsZHMgPSBfZ2V0RG9jVmFsdWVBbmRTb3VyY2UyLmRvY1ZhbHVlRmllbGRzLCBzb3VyY2VPbmx5RmllbGRzID0gX2dldERvY1ZhbHVlQW5kU291cmNlMi5zb3VyY2VPbmx5RmllbGRzOwogICAgICAgICAgICAgIGluaXRpYWxTZWFyY2hDb250ZXh0ID0gewogICAgICAgICAgICAgICAgZG9jdmFsdWVfZmllbGRzOiBkb2NWYWx1ZUZpZWxkcwogICAgICAgICAgICAgIH07IC8vIFJlcXVlc3QgZmllbGRzIGluIGRvY3ZhbHVlX2ZpZWxkcyBpbnN0ZWQgb2YgX3NvdXJjZQoKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDc7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9tYWtlU2VhcmNoU291cmNlKHNlYXJjaEZpbHRlcnMsIG1heFJlc3VsdFdpbmRvdywgaW5pdGlhbFNlYXJjaENvbnRleHQpKTsKCiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBzZWFyY2hTb3VyY2UgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ2ZpZWxkcycsIHNlYXJjaEZpbHRlcnMuZmllbGROYW1lcyk7IC8vIFNldHRpbmcgImZpZWxkcyIgZmlsdGVycyBvdXQgdW51c2VkIHNjcmlwdGVkIGZpZWxkcwoKICAgICAgICAgICAgICBpZiAoc291cmNlT25seUZpZWxkcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnc291cmNlJywgZmFsc2UpOyAvLyBkbyBub3QgbmVlZCBhbnl0aGluZyBmcm9tIF9zb3VyY2UKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdzb3VyY2UnLCBzb3VyY2VPbmx5RmllbGRzKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLl9oYXNTb3J0KCkpIHsKICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnc29ydCcsIHRoaXMuX2J1aWxkRXNTb3J0KCkpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAxMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3J1bkVzUXVlcnkoewogICAgICAgICAgICAgICAgcmVxdWVzdElkOiB0aGlzLmdldElkKCksCiAgICAgICAgICAgICAgICByZXF1ZXN0TmFtZTogbGF5ZXJOYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlOiBzZWFyY2hTb3VyY2UsCiAgICAgICAgICAgICAgICByZWdpc3RlckNhbmNlbENhbGxiYWNrOiByZWdpc3RlckNhbmNlbENhbGxiYWNrLAogICAgICAgICAgICAgICAgcmVxdWVzdERlc2NyaXB0aW9uOiAnRWxhc3RpY3NlYXJjaCBkb2N1bWVudCByZXF1ZXN0JwogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgcmVzcCA9IF9jb250ZXh0Ny5zZW50OwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICBoaXRzOiByZXNwLmhpdHMuaGl0cy5yZXZlcnNlKCksCiAgICAgICAgICAgICAgICAvLyBSZXZlcnNlIGhpdHMgc28gdG9wIGRvY3VtZW50cyBieSBzb3J0IGFyZSBkcmF3biBvbiB0b3AKICAgICAgICAgICAgICAgIG1ldGE6IHsKICAgICAgICAgICAgICAgICAgYXJlUmVzdWx0c1RyaW1tZWQ6IHJlc3AuaGl0cy50b3RhbCA+IHJlc3AuaGl0cy5oaXRzLmxlbmd0aAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9pc1RvcEhpdHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9pc1RvcEhpdHMoKSB7CiAgICAgIHZhciBfdGhpcyRfZGVzY3JpcHRvcjMgPSB0aGlzLl9kZXNjcmlwdG9yLAogICAgICAgICAgdXNlVG9wSGl0cyA9IF90aGlzJF9kZXNjcmlwdG9yMy51c2VUb3BIaXRzLAogICAgICAgICAgdG9wSGl0c1NwbGl0RmllbGQgPSBfdGhpcyRfZGVzY3JpcHRvcjMudG9wSGl0c1NwbGl0RmllbGQ7CiAgICAgIHJldHVybiAhISh1c2VUb3BIaXRzICYmIHRvcEhpdHNTcGxpdEZpZWxkKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaGFzU29ydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhc1NvcnQoKSB7CiAgICAgIHZhciBfdGhpcyRfZGVzY3JpcHRvcjQgPSB0aGlzLl9kZXNjcmlwdG9yLAogICAgICAgICAgc29ydEZpZWxkID0gX3RoaXMkX2Rlc2NyaXB0b3I0LnNvcnRGaWVsZCwKICAgICAgICAgIHNvcnRPcmRlciA9IF90aGlzJF9kZXNjcmlwdG9yNC5zb3J0T3JkZXI7CiAgICAgIHJldHVybiAhIXNvcnRGaWVsZCAmJiAhIXNvcnRPcmRlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRHZW9Kc29uV2l0aE1ldGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdlb0pzb25XaXRoTWV0YShsYXllck5hbWUsIHNlYXJjaEZpbHRlcnMsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2spIHsKICAgICAgdmFyIGluZGV4UGF0dGVybiwgaW5kZXhTZXR0aW5ncywgX3JlZjUsIGhpdHMsIG1ldGEsIHVudXNlZE1ldGFGaWVsZHMsIGZsYXR0ZW5IaXQsIGZlYXR1cmVDb2xsZWN0aW9uLCBfZ2VvRmllbGQ7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGdldEdlb0pzb25XaXRoTWV0YSQoX2NvbnRleHQ4KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGhpcy5nZXRJbmRleFBhdHRlcm4oKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSA1OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9sb2FkX2luZGV4X3NldHRpbmdzLmxvYWRJbmRleFNldHRpbmdzKShpbmRleFBhdHRlcm4udGl0bGUpKTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBpbmRleFNldHRpbmdzID0gX2NvbnRleHQ4LnNlbnQ7CgogICAgICAgICAgICAgIGlmICghdGhpcy5faXNUb3BIaXRzKCkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gOTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX2dldFRvcEhpdHMobGF5ZXJOYW1lLCBzZWFyY2hGaWx0ZXJzLCByZWdpc3RlckNhbmNlbENhbGxiYWNrKSk7CgogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgX2NvbnRleHQ4LnQwID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAxNTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAxNDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX2dldFNlYXJjaEhpdHMobGF5ZXJOYW1lLCBzZWFyY2hGaWx0ZXJzLCBpbmRleFNldHRpbmdzLm1heFJlc3VsdFdpbmRvdywgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjaykpOwoKICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBfY29udGV4dDgudDAgPSBfY29udGV4dDguc2VudDsKCiAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgX3JlZjUgPSBfY29udGV4dDgudDA7CiAgICAgICAgICAgICAgaGl0cyA9IF9yZWY1LmhpdHM7CiAgICAgICAgICAgICAgbWV0YSA9IF9yZWY1Lm1ldGE7CiAgICAgICAgICAgICAgdW51c2VkTWV0YUZpZWxkcyA9IGluZGV4UGF0dGVybi5tZXRhRmllbGRzLmZpbHRlcihmdW5jdGlvbiAobWV0YUZpZWxkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIVsnX2lkJywgJ19pbmRleCddLmluY2x1ZGVzKG1ldGFGaWVsZCk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGZsYXR0ZW5IaXQgPSBmdW5jdGlvbiBmbGF0dGVuSGl0KGhpdCkgewogICAgICAgICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBpbmRleFBhdHRlcm4uZmxhdHRlbkhpdChoaXQpOyAvLyByZW1vdmUgbWV0YUZpZWxkcwoKICAgICAgICAgICAgICAgIHVudXNlZE1ldGFGaWVsZHMuZm9yRWFjaChmdW5jdGlvbiAobWV0YUZpZWxkKSB7CiAgICAgICAgICAgICAgICAgIGRlbGV0ZSBwcm9wZXJ0aWVzW21ldGFGaWVsZF07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIF9jb250ZXh0OC5wcmV2ID0gMjA7CiAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAyMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX2dldEdlb0ZpZWxkKCkpOwoKICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICBfZ2VvRmllbGQgPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICBmZWF0dXJlQ29sbGVjdGlvbiA9ICgwLCBfZWxhc3RpY3NlYXJjaF9nZW9fdXRpbHMuaGl0c1RvR2VvSnNvbikoaGl0cywgZmxhdHRlbkhpdCwgX2dlb0ZpZWxkLm5hbWUsIF9nZW9GaWVsZC50eXBlKTsKICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDMwOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICBfY29udGV4dDgucHJldiA9IDI3OwogICAgICAgICAgICAgIF9jb250ZXh0OC50MSA9IF9jb250ZXh0OFsiY2F0Y2giXSgyMCk7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NlYXJjaC5jb252ZXJ0VG9HZW9Kc29uRXJyb3JNc2cnLCB7CiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VuYWJsZSB0byBjb252ZXJ0IHNlYXJjaCByZXNwb25zZSB0byBnZW9Kc29uIGZlYXR1cmUgY29sbGVjdGlvbiwgZXJyb3I6IHtlcnJvck1zZ30nLAogICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgIGVycm9yTXNnOiBfY29udGV4dDgudDEubWVzc2FnZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgIGRhdGE6IGZlYXR1cmVDb2xsZWN0aW9uLAogICAgICAgICAgICAgICAgbWV0YTogbWV0YQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMsIFtbMjAsIDI3XV0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNhbkZvcm1hdEZlYXR1cmVQcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5Gb3JtYXRGZWF0dXJlUHJvcGVydGllcygpIHsKICAgICAgcmV0dXJuIHRoaXMuX3Rvb2x0aXBGaWVsZHMubGVuZ3RoID4gMDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfbG9hZFRvb2x0aXBQcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfbG9hZFRvb2x0aXBQcm9wZXJ0aWVzKGRvY0lkLCBpbmRleCwgaW5kZXhQYXR0ZXJuKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIHNlYXJjaFNvdXJjZSwgcXVlcnksIHJlc3AsIGhpdCwgcHJvcGVydGllczsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfbG9hZFRvb2x0aXBQcm9wZXJ0aWVzJChfY29udGV4dDkpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoISh0aGlzLl90b29sdGlwRmllbGRzLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIHt9KTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBzZWFyY2hTb3VyY2UgPSBuZXcgX2tpYmFuYV9zZXJ2aWNlcy5TZWFyY2hTb3VyY2UoKTsKICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ2luZGV4JywgaW5kZXhQYXR0ZXJuKTsKICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3NpemUnLCAxKTsKICAgICAgICAgICAgICBxdWVyeSA9IHsKICAgICAgICAgICAgICAgIGxhbmd1YWdlOiAna3VlcnknLAogICAgICAgICAgICAgICAgcXVlcnk6ICJfaWQ6XCIiLmNvbmNhdChkb2NJZCwgIlwiIGFuZCBfaW5kZXg6XCIiKS5jb25jYXQoaW5kZXgsICJcIiIpCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3F1ZXJ5JywgcXVlcnkpOwogICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnZmllbGRzJywgdGhpcy5fZ2V0VG9vbHRpcFByb3BlcnR5TmFtZXMoKSk7CiAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHNlYXJjaFNvdXJjZS5mZXRjaCgpKTsKCiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgcmVzcCA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICAgIGhpdCA9IF9sb2Rhc2guZGVmYXVsdC5nZXQocmVzcCwgJ2hpdHMuaGl0c1swXScpOwoKICAgICAgICAgICAgICBpZiAoaGl0KSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuc291cmNlLmVzU2VhcmNoLmxvYWRUb29sdGlwUHJvcGVydGllc0Vycm9yTXNnJywgewogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdVbmFibGUgdG8gZmluZCBkb2N1bWVudCwgX2lkOiB7ZG9jSWR9JywKICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICBkb2NJZDogZG9jSWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIHByb3BlcnRpZXMgPSBpbmRleFBhdHRlcm4uZmxhdHRlbkhpdChoaXQpOwogICAgICAgICAgICAgIGluZGV4UGF0dGVybi5tZXRhRmllbGRzLmZvckVhY2goZnVuY3Rpb24gKG1ldGFGaWVsZCkgewogICAgICAgICAgICAgICAgaWYgKCFfdGhpczYuX2dldFRvb2x0aXBQcm9wZXJ0eU5hbWVzKCkuaW5jbHVkZXMobWV0YUZpZWxkKSkgewogICAgICAgICAgICAgICAgICBkZWxldGUgcHJvcGVydGllc1ttZXRhRmllbGRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCBwcm9wZXJ0aWVzKTsKCiAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmaWx0ZXJBbmRGb3JtYXRQcm9wZXJ0aWVzVG9IdG1sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaWx0ZXJBbmRGb3JtYXRQcm9wZXJ0aWVzVG9IdG1sKHByb3BlcnRpZXMpIHsKICAgICAgdmFyIGluZGV4UGF0dGVybiwgcHJvcGVydHlWYWx1ZXMsIHRvb2x0aXBQcm9wZXJ0aWVzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGZpbHRlckFuZEZvcm1hdFByb3BlcnRpZXNUb0h0bWwkKF9jb250ZXh0MTApIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLmdldEluZGV4UGF0dGVybigpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX2xvYWRUb29sdGlwUHJvcGVydGllcyhwcm9wZXJ0aWVzLl9pZCwgcHJvcGVydGllcy5faW5kZXgsIGluZGV4UGF0dGVybikpOwoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIHByb3BlcnR5VmFsdWVzID0gX2NvbnRleHQxMC5zZW50OwogICAgICAgICAgICAgIHRvb2x0aXBQcm9wZXJ0aWVzID0gdGhpcy5fdG9vbHRpcEZpZWxkcy5tYXAoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBwcm9wZXJ0eVZhbHVlc1tmaWVsZC5nZXROYW1lKCldOwogICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmNyZWF0ZVRvb2x0aXBQcm9wZXJ0eSh2YWx1ZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLmFsbCh0b29sdGlwUHJvcGVydGllcykpOwoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImlzRmlsdGVyQnlNYXBCb3VuZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzRmlsdGVyQnlNYXBCb3VuZHMoKSB7CiAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuZ2V0KHRoaXMuX2Rlc2NyaXB0b3IsICdmaWx0ZXJCeU1hcEJvdW5kcycsIGZhbHNlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc0ZpbHRlckJ5TWFwQm91bmRzQ29uZmlndXJhYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0ZpbHRlckJ5TWFwQm91bmRzQ29uZmlndXJhYmxlKCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMZWZ0Sm9pbkZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGVmdEpvaW5GaWVsZHMoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4UGF0dGVybjsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBnZXRMZWZ0Sm9pbkZpZWxkcyQoX2NvbnRleHQxMSkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuZ2V0SW5kZXhQYXR0ZXJuKCkpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGluZGV4UGF0dGVybiA9IF9jb250ZXh0MTEuc2VudDsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsICgwLCBfaW5kZXhfcGF0dGVybl91dGlsLmdldFNvdXJjZUZpZWxkcykoaW5kZXhQYXR0ZXJuLmZpZWxkcykubWFwKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNy5jcmVhdGVGaWVsZCh7CiAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFN1cHBvcnRlZFNoYXBlVHlwZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFN1cHBvcnRlZFNoYXBlVHlwZXMoKSB7CiAgICAgIHZhciBnZW9GaWVsZFR5cGUsIF9nZW9GaWVsZDI7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGdldFN1cHBvcnRlZFNoYXBlVHlwZXMkKF9jb250ZXh0MTIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0MTIucHJldiA9IDA7CiAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX2dldEdlb0ZpZWxkKCkpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIF9nZW9GaWVsZDIgPSBfY29udGV4dDEyLnNlbnQ7CiAgICAgICAgICAgICAgZ2VvRmllbGRUeXBlID0gX2dlb0ZpZWxkMi50eXBlOwogICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgX2NvbnRleHQxMi5wcmV2ID0gNzsKICAgICAgICAgICAgICBfY29udGV4dDEyLnQwID0gX2NvbnRleHQxMlsiY2F0Y2giXSgwKTsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBpZiAoIShnZW9GaWVsZFR5cGUgPT09IF9jb25zdGFudHMuRVNfR0VPX0ZJRUxEX1RZUEUuR0VPX1BPSU5UKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwgW192ZWN0b3JfZmVhdHVyZV90eXBlcy5WRUNUT1JfU0hBUEVfVFlQRVMuUE9JTlRdKTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLCBbX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5QT0lOVCwgX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5MSU5FLCBfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPTFlHT05dKTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcywgW1swLCA3XV0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFNvdXJjZVRvb2x0aXBDb250ZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTb3VyY2VUb29sdGlwQ29udGVudChzb3VyY2VEYXRhUmVxdWVzdCkgewogICAgICB2YXIgZmVhdHVyZUNvbGxlY3Rpb24gPSBzb3VyY2VEYXRhUmVxdWVzdCA/IHNvdXJjZURhdGFSZXF1ZXN0LmdldERhdGEoKSA6IG51bGw7CiAgICAgIHZhciBtZXRhID0gc291cmNlRGF0YVJlcXVlc3QgPyBzb3VyY2VEYXRhUmVxdWVzdC5nZXRNZXRhKCkgOiBudWxsOwoKICAgICAgaWYgKCFmZWF0dXJlQ29sbGVjdGlvbiB8fCAhbWV0YSkgewogICAgICAgIC8vIG5vIHRvb2x0aXAgY29udGVudCBuZWVkZWQgd2hlbiB0aGVyZSBpcyBubyBmZWF0dXJlIGNvbGxlY3Rpb24gb3IgbWV0YQogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0b29sdGlwQ29udGVudDogbnVsbCwKICAgICAgICAgIGFyZVJlc3VsdHNUcmltbWVkOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9pc1RvcEhpdHMoKSkgewogICAgICAgIHZhciBlbnRpdGllc0ZvdW5kTXNnID0gbWV0YS5hcmVFbnRpdGllc1RyaW1tZWQgPyBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5lc1NlYXJjaC50b3BIaXRzUmVzdWx0c1RyaW1tZWRNc2cnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlJlc3VsdHMgbGltaXRlZCB0byBmaXJzdCB7ZW50aXR5Q291bnR9IGVudGl0aWVzIG9mIH57dG90YWxFbnRpdGllc30uIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBlbnRpdHlDb3VudDogbWV0YS5lbnRpdHlDb3VudCwKICAgICAgICAgICAgdG90YWxFbnRpdGllczogbWV0YS50b3RhbEVudGl0aWVzCiAgICAgICAgICB9CiAgICAgICAgfSkgOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5lc1NlYXJjaC50b3BIaXRzRW50aXRpZXNDb3VudE1zZycsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRm91bmQge2VudGl0eUNvdW50fSBlbnRpdGllcy4iLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGVudGl0eUNvdW50OiBtZXRhLmVudGl0eUNvdW50CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciBkb2NzUGVyRW50aXR5TXNnID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuZXNTZWFyY2gudG9wSGl0c1NpemVNc2cnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNob3dpbmcgdG9wIHt0b3BIaXRzU2l6ZX0gZG9jdW1lbnRzIHBlciBlbnRpdHkuIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICB0b3BIaXRzU2l6ZTogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU2l6ZQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgdG9vbHRpcENvbnRlbnQ6ICIiLmNvbmNhdChlbnRpdGllc0ZvdW5kTXNnLCAiICIpLmNvbmNhdChkb2NzUGVyRW50aXR5TXNnKSwKICAgICAgICAgIC8vIFVzZWQgdG8gc2hvdyB0cmltbWVkIGljb24gaW4gbGVnZW5kCiAgICAgICAgICAvLyB1c2VyIG9ubHkgbmVlZHMgdG8gYmUgbm90aWZpZWQgb2YgdHJpbW1lZCByZXN1bHRzIHdoZW4gZW50aXRpZXMgYXJlIHRyaW1tZWQKICAgICAgICAgIGFyZVJlc3VsdHNUcmltbWVkOiBtZXRhLmFyZUVudGl0aWVzVHJpbW1lZAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmIChtZXRhLmFyZVJlc3VsdHNUcmltbWVkKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRvb2x0aXBDb250ZW50OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5lc1NlYXJjaC5yZXN1bHRzVHJpbW1lZE1zZycsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZXN1bHRzIGxpbWl0ZWQgdG8gZmlyc3Qge2NvdW50fSBkb2N1bWVudHMuIiwKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgY291bnQ6IGZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVzLmxlbmd0aAogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIGFyZVJlc3VsdHNUcmltbWVkOiB0cnVlCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICB0b29sdGlwQ29udGVudDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuZXNTZWFyY2guZmVhdHVyZUNvdW50TXNnJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJGb3VuZCB7Y291bnR9IGRvY3VtZW50cy4iLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGNvdW50OiBmZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcy5sZW5ndGgKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBhcmVSZXN1bHRzVHJpbW1lZDogZmFsc2UKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTeW5jTWV0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U3luY01ldGEoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgc29ydEZpZWxkOiB0aGlzLl9kZXNjcmlwdG9yLnNvcnRGaWVsZCwKICAgICAgICBzb3J0T3JkZXI6IHRoaXMuX2Rlc2NyaXB0b3Iuc29ydE9yZGVyLAogICAgICAgIHVzZVRvcEhpdHM6IHRoaXMuX2Rlc2NyaXB0b3IudXNlVG9wSGl0cywKICAgICAgICB0b3BIaXRzU3BsaXRGaWVsZDogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU3BsaXRGaWVsZCwKICAgICAgICB0b3BIaXRzU2l6ZTogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU2l6ZQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFByZUluZGV4ZWRTaGFwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UHJlSW5kZXhlZFNoYXBlKHByb3BlcnRpZXMpIHsKICAgICAgdmFyIGdlb0ZpZWxkOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGdldFByZUluZGV4ZWRTaGFwZSQoX2NvbnRleHQxMykgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX2dldEdlb0ZpZWxkKCkpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGdlb0ZpZWxkID0gX2NvbnRleHQxMy5zZW50OwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgaW5kZXg6IHByb3BlcnRpZXMuX2luZGV4LAogICAgICAgICAgICAgICAgLy8gQ2FuIG5vdCB1c2UgaW5kZXggcGF0dGVybiB0aXRsZSBiZWNhdXNlIGl0IG1heSByZWZlcmVuY2UgbWFueSBpbmRpY2VzCiAgICAgICAgICAgICAgICBpZDogcHJvcGVydGllcy5faWQsCiAgICAgICAgICAgICAgICBwYXRoOiBnZW9GaWVsZC5uYW1lCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRVNTZWFyY2hTb3VyY2U7Cn0oX2VzX3NvdXJjZS5BYnN0cmFjdEVTU291cmNlKTsKCmV4cG9ydHMuRVNTZWFyY2hTb3VyY2UgPSBFU1NlYXJjaFNvdXJjZTsKCl9kZWZpbmVQcm9wZXJ0eShFU1NlYXJjaFNvdXJjZSwgInR5cGUiLCBfY29uc3RhbnRzLkVTX1NFQVJDSCk7CgpfZGVmaW5lUHJvcGVydHkoRVNTZWFyY2hTb3VyY2UsICJ0aXRsZSIsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NlYXJjaFRpdGxlJywgewogIGRlZmF1bHRNZXNzYWdlOiAnRG9jdW1lbnRzJwp9KSk7CgpfZGVmaW5lUHJvcGVydHkoRVNTZWFyY2hTb3VyY2UsICJkZXNjcmlwdGlvbiIsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NlYXJjaERlc2NyaXB0aW9uJywgewogIGRlZmF1bHRNZXNzYWdlOiAnVmVjdG9yIGRhdGEgZnJvbSBhIEtpYmFuYSBpbmRleCBwYXR0ZXJuJwp9KSk7"},null]}