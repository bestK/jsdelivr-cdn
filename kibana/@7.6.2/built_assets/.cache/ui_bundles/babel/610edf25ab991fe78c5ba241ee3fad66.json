{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/dashboard/np_ready/dashboard_app_controller.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/dashboard/np_ready/dashboard_app_controller.js","mtime":1585205039428},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkRhc2hib2FyZEFwcENvbnRyb2xsZXIgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX2FuZ3VsYXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImFuZ3VsYXIiKSk7Cgp2YXIgX3J4anMgPSByZXF1aXJlKCJyeGpzIik7Cgp2YXIgX2Rhc2hib2FyZF9lbXB0eV9zY3JlZW4gPSByZXF1aXJlKCIuL2Rhc2hib2FyZF9lbXB0eV9zY3JlZW4iKTsKCnZhciBfbGVnYWN5X2ltcG9ydHMgPSByZXF1aXJlKCIuLi9sZWdhY3lfaW1wb3J0cyIpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9kYXRhL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMyID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vZGFzaGJvYXJkX2VtYmVkZGFibGVfY29udGFpbmVyL3B1YmxpYy9ucF9yZWFkeS9wdWJsaWMiKTsKCnZhciBfcHVibGljMyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2VtYmVkZGFibGVfYXBpL3B1YmxpYy9ucF9yZWFkeS9wdWJsaWMiKTsKCnZhciBfc2hvd19vcHRpb25zX3BvcG92ZXIgPSByZXF1aXJlKCIuL3RvcF9uYXYvc2hvd19vcHRpb25zX3BvcG92ZXIiKTsKCnZhciBfc2F2ZV9tb2RhbCA9IHJlcXVpcmUoIi4vdG9wX25hdi9zYXZlX21vZGFsIik7Cgp2YXIgX3Nob3dfY2xvbmVfbW9kYWwgPSByZXF1aXJlKCIuL3RvcF9uYXYvc2hvd19jbG9uZV9tb2RhbCIpOwoKdmFyIF9saWIgPSByZXF1aXJlKCIuL2xpYiIpOwoKdmFyIF9kYXNoYm9hcmRfc3RhdGVfbWFuYWdlciA9IHJlcXVpcmUoIi4vZGFzaGJvYXJkX3N0YXRlX21hbmFnZXIiKTsKCnZhciBfZGFzaGJvYXJkX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4vZGFzaGJvYXJkX2NvbnN0YW50cyIpOwoKdmFyIF9nZXRfdG9wX25hdl9jb25maWcgPSByZXF1aXJlKCIuL3RvcF9uYXYvZ2V0X3RvcF9uYXZfY29uZmlnIik7Cgp2YXIgX3RvcF9uYXZfaWRzID0gcmVxdWlyZSgiLi90b3BfbmF2L3RvcF9uYXZfaWRzIik7Cgp2YXIgX2Rhc2hib2FyZF9zdHJpbmdzID0gcmVxdWlyZSgiLi9kYXNoYm9hcmRfc3RyaW5ncyIpOwoKdmFyIF9lbWJlZGRhYmxlX3NhdmVkX29iamVjdF9jb252ZXJ0ZXJzID0gcmVxdWlyZSgiLi9saWIvZW1iZWRkYWJsZV9zYXZlZF9vYmplY3RfY29udmVydGVycyIpOwoKdmFyIF9wdWJsaWM0ID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9raWJhbmFfcmVhY3QvcHVibGljIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIF9leHRlbmRzKCkgewogIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0YXJnZXQ7CiAgfTsKCiAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9Cgp2YXIgRGFzaGJvYXJkQXBwQ29udHJvbGxlciA9IC8vIFBhcnQgb2YgdGhlIGV4cG9zZWQgcGx1Z2luIEFQSSAtIGRvIG5vdCByZW1vdmUgd2l0aG91dCBjYXJlZnVsIGNvbnNpZGVyYXRpb24uCmZ1bmN0aW9uIERhc2hib2FyZEFwcENvbnRyb2xsZXIoX3JlZikgewogIHZhciBfdGhpcyA9IHRoaXM7CgogIHZhciAkc2NvcGUgPSBfcmVmLiRzY29wZSwKICAgICAgJHJvdXRlID0gX3JlZi4kcm91dGUsCiAgICAgICRyb3V0ZVBhcmFtcyA9IF9yZWYuJHJvdXRlUGFyYW1zLAogICAgICBnZXRBcHBTdGF0ZSA9IF9yZWYuZ2V0QXBwU3RhdGUsCiAgICAgIGdsb2JhbFN0YXRlID0gX3JlZi5nbG9iYWxTdGF0ZSwKICAgICAgZGFzaGJvYXJkQ29uZmlnID0gX3JlZi5kYXNoYm9hcmRDb25maWcsCiAgICAgIGxvY2FsU3RvcmFnZSA9IF9yZWYubG9jYWxTdG9yYWdlLAogICAgICBrYm5VcmwgPSBfcmVmLmtiblVybCwKICAgICAgQXBwU3RhdGVDbGFzcyA9IF9yZWYuQXBwU3RhdGVDbGFzcywKICAgICAgaW5kZXhQYXR0ZXJucyA9IF9yZWYuaW5kZXhQYXR0ZXJucywKICAgICAgY29uZmlnID0gX3JlZi5jb25maWcsCiAgICAgIGNvbmZpcm1Nb2RhbCA9IF9yZWYuY29uZmlybU1vZGFsLAogICAgICBzYXZlZFF1ZXJ5U2VydmljZSA9IF9yZWYuc2F2ZWRRdWVyeVNlcnZpY2UsCiAgICAgIGVtYmVkZGFibGVzID0gX3JlZi5lbWJlZGRhYmxlcywKICAgICAgc2hhcmUgPSBfcmVmLnNoYXJlLAogICAgICBkYXNoYm9hcmRDYXBhYmlsaXRpZXMgPSBfcmVmLmRhc2hib2FyZENhcGFiaWxpdGllcywKICAgICAgX3JlZiRucERhdGFTdGFydCRxdWVyID0gX3JlZi5ucERhdGFTdGFydC5xdWVyeSwKICAgICAgZmlsdGVyTWFuYWdlciA9IF9yZWYkbnBEYXRhU3RhcnQkcXVlci5maWx0ZXJNYW5hZ2VyLAogICAgICB0aW1lZmlsdGVyID0gX3JlZiRucERhdGFTdGFydCRxdWVyLnRpbWVmaWx0ZXIudGltZWZpbHRlciwKICAgICAgX3JlZiRjb3JlID0gX3JlZi5jb3JlLAogICAgICBub3RpZmljYXRpb25zID0gX3JlZiRjb3JlLm5vdGlmaWNhdGlvbnMsCiAgICAgIG92ZXJsYXlzID0gX3JlZiRjb3JlLm92ZXJsYXlzLAogICAgICBjaHJvbWUgPSBfcmVmJGNvcmUuY2hyb21lLAogICAgICBpbmplY3RlZE1ldGFkYXRhID0gX3JlZiRjb3JlLmluamVjdGVkTWV0YWRhdGEsCiAgICAgIHVpU2V0dGluZ3MgPSBfcmVmJGNvcmUudWlTZXR0aW5ncywKICAgICAgc2F2ZWRPYmplY3RzID0gX3JlZiRjb3JlLnNhdmVkT2JqZWN0cywKICAgICAgaHR0cCA9IF9yZWYkY29yZS5odHRwOwoKICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGFzaGJvYXJkQXBwQ29udHJvbGxlcik7CgogIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiYXBwU3RhdHVzIiwgdm9pZCAwKTsKCiAgbmV3IF9wdWJsaWMuRmlsdGVyU3RhdGVNYW5hZ2VyKGdsb2JhbFN0YXRlLCBnZXRBcHBTdGF0ZSwgZmlsdGVyTWFuYWdlcik7CiAgdmFyIHF1ZXJ5RmlsdGVyID0gZmlsdGVyTWFuYWdlcjsKICB2YXIgbGFzdFJlbG9hZFJlcXVlc3RUaW1lID0gMDsKICB2YXIgZGFzaCA9ICRzY29wZS5kYXNoID0gJHJvdXRlLmN1cnJlbnQubG9jYWxzLmRhc2g7CgogIGlmIChkYXNoLmlkKSB7CiAgICBjaHJvbWUuZG9jVGl0bGUuY2hhbmdlKGRhc2gudGl0bGUpOwogIH0KCiAgdmFyIGRhc2hib2FyZFN0YXRlTWFuYWdlciA9IG5ldyBfZGFzaGJvYXJkX3N0YXRlX21hbmFnZXIuRGFzaGJvYXJkU3RhdGVNYW5hZ2VyKHsKICAgIHNhdmVkRGFzaGJvYXJkOiBkYXNoLAogICAgQXBwU3RhdGVDbGFzczogQXBwU3RhdGVDbGFzcywKICAgIGhpZGVXcml0ZUNvbnRyb2xzOiBkYXNoYm9hcmRDb25maWcuZ2V0SGlkZVdyaXRlQ29udHJvbHMoKSwKICAgIGtpYmFuYVZlcnNpb246IGluamVjdGVkTWV0YWRhdGEuZ2V0S2liYW5hVmVyc2lvbigpCiAgfSk7CiAgJHNjb3BlLmFwcFN0YXRlID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldEFwcFN0YXRlKCk7IC8vIFRoZSBoYXNoIGNoZWNrIGlzIHNvIHdlIG9ubHkgdXBkYXRlIHRoZSB0aW1lIGZpbHRlciBvbiBkYXNoYm9hcmQgb3Blbiwgbm90IGR1cmluZwogIC8vIG5vcm1hbCBjcm9zcyBhcHAgbmF2aWdhdGlvbi4KCiAgaWYgKGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRJc1RpbWVTYXZlZFdpdGhEYXNoYm9hcmQoKSAmJiAhZ2xvYmFsU3RhdGUuJGluaGVyaXRlZEdsb2JhbFN0YXRlKSB7CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc3luY1RpbWVmaWx0ZXJXaXRoRGFzaGJvYXJkKHRpbWVmaWx0ZXIpOwogIH0KCiAgJHNjb3BlLnNob3dTYXZlUXVlcnkgPSBkYXNoYm9hcmRDYXBhYmlsaXRpZXMuc2F2ZVF1ZXJ5OwoKICB2YXIgZ2V0U2hvdWxkU2hvd0VkaXRIZWxwID0gZnVuY3Rpb24gZ2V0U2hvdWxkU2hvd0VkaXRIZWxwKCkgewogICAgcmV0dXJuICFkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UGFuZWxzKCkubGVuZ3RoICYmIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRJc0VkaXRNb2RlKCkgJiYgIWRhc2hib2FyZENvbmZpZy5nZXRIaWRlV3JpdGVDb250cm9scygpOwogIH07CgogIHZhciBnZXRTaG91bGRTaG93Vmlld0hlbHAgPSBmdW5jdGlvbiBnZXRTaG91bGRTaG93Vmlld0hlbHAoKSB7CiAgICByZXR1cm4gIWRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRQYW5lbHMoKS5sZW5ndGggJiYgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldElzVmlld01vZGUoKSAmJiAhZGFzaGJvYXJkQ29uZmlnLmdldEhpZGVXcml0ZUNvbnRyb2xzKCk7CiAgfTsKCiAgdmFyIGdldElzRW1wdHlJblJlYWRvbmx5TW9kZSA9IGZ1bmN0aW9uIGdldElzRW1wdHlJblJlYWRvbmx5TW9kZSgpIHsKICAgIHJldHVybiAhZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFBhbmVscygpLmxlbmd0aCAmJiAhZ2V0U2hvdWxkU2hvd0VkaXRIZWxwKCkgJiYgIWdldFNob3VsZFNob3dWaWV3SGVscCgpICYmIGRhc2hib2FyZENvbmZpZy5nZXRIaWRlV3JpdGVDb250cm9scygpOwogIH07CgogIHZhciBhZGRWaXN1YWxpemF0aW9uID0gZnVuY3Rpb24gYWRkVmlzdWFsaXphdGlvbigpIHsKICAgIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5WSVNVQUxJWkVdKCk7CiAgfTsKCiAgdmFyIHVwZGF0ZUluZGV4UGF0dGVybnMgPSBmdW5jdGlvbiB1cGRhdGVJbmRleFBhdHRlcm5zKGNvbnRhaW5lcikgewogICAgaWYgKCFjb250YWluZXIgfHwgKDAsIF9wdWJsaWMzLmlzRXJyb3JFbWJlZGRhYmxlKShjb250YWluZXIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgcGFuZWxJbmRleFBhdHRlcm5zID0gW107CiAgICBPYmplY3QudmFsdWVzKGNvbnRhaW5lci5nZXRDaGlsZElkcygpKS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICB2YXIgX3BhbmVsSW5kZXhQYXR0ZXJuczsKCiAgICAgIHZhciBlbWJlZGRhYmxlID0gY29udGFpbmVyLmdldENoaWxkKGlkKTsKICAgICAgaWYgKCgwLCBfcHVibGljMy5pc0Vycm9yRW1iZWRkYWJsZSkoZW1iZWRkYWJsZSkpIHJldHVybjsKICAgICAgdmFyIGVtYmVkZGFibGVJbmRleFBhdHRlcm5zID0gZW1iZWRkYWJsZS5nZXRPdXRwdXQoKS5pbmRleFBhdHRlcm5zOwogICAgICBpZiAoIWVtYmVkZGFibGVJbmRleFBhdHRlcm5zKSByZXR1cm47CgogICAgICAoX3BhbmVsSW5kZXhQYXR0ZXJucyA9IHBhbmVsSW5kZXhQYXR0ZXJucykucHVzaC5hcHBseShfcGFuZWxJbmRleFBhdHRlcm5zLCBfdG9Db25zdW1hYmxlQXJyYXkoZW1iZWRkYWJsZUluZGV4UGF0dGVybnMpKTsKICAgIH0pOwogICAgcGFuZWxJbmRleFBhdHRlcm5zID0gKDAsIF9sb2Rhc2gudW5pcSkocGFuZWxJbmRleFBhdHRlcm5zLCAnaWQnKTsKCiAgICBpZiAocGFuZWxJbmRleFBhdHRlcm5zICYmIHBhbmVsSW5kZXhQYXR0ZXJucy5sZW5ndGggPiAwKSB7CiAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICAkc2NvcGUuaW5kZXhQYXR0ZXJucyA9IHBhbmVsSW5kZXhQYXR0ZXJuczsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBpbmRleFBhdHRlcm5zLmdldERlZmF1bHQoKS50aGVuKGZ1bmN0aW9uIChkZWZhdWx0SW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICAgJHNjb3BlLmluZGV4UGF0dGVybnMgPSBbZGVmYXVsdEluZGV4UGF0dGVybl07CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIHZhciBnZXRFbXB0eVNjcmVlblByb3BzID0gZnVuY3Rpb24gZ2V0RW1wdHlTY3JlZW5Qcm9wcyhzaG91bGRTaG93RWRpdEhlbHAsIGlzRW1wdHlJblJlYWRPbmx5TW9kZSkgewogICAgdmFyIGVtcHR5U2NyZWVuUHJvcHMgPSB7CiAgICAgIG9uTGlua0NsaWNrOiBzaG91bGRTaG93RWRpdEhlbHAgPyAkc2NvcGUuc2hvd0FkZFBhbmVsIDogJHNjb3BlLmVudGVyRWRpdE1vZGUsCiAgICAgIHNob3dMaW5rVG9WaXN1YWxpemU6IHNob3VsZFNob3dFZGl0SGVscCwKICAgICAgdWlTZXR0aW5nczogdWlTZXR0aW5ncywKICAgICAgaHR0cDogaHR0cAogICAgfTsKCiAgICBpZiAoc2hvdWxkU2hvd0VkaXRIZWxwKSB7CiAgICAgIGVtcHR5U2NyZWVuUHJvcHMub25WaXN1YWxpemVDbGljayA9IGFkZFZpc3VhbGl6YXRpb247CiAgICB9CgogICAgaWYgKGlzRW1wdHlJblJlYWRPbmx5TW9kZSkgewogICAgICBlbXB0eVNjcmVlblByb3BzLmlzUmVhZG9ubHlNb2RlID0gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gZW1wdHlTY3JlZW5Qcm9wczsKICB9OwoKICB2YXIgZ2V0RGFzaGJvYXJkSW5wdXQgPSBmdW5jdGlvbiBnZXREYXNoYm9hcmRJbnB1dCgpIHsKICAgIHZhciBlbWJlZGRhYmxlc01hcCA9IHt9OwogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFBhbmVscygpLmZvckVhY2goZnVuY3Rpb24gKHBhbmVsKSB7CiAgICAgIGVtYmVkZGFibGVzTWFwW3BhbmVsLnBhbmVsSW5kZXhdID0gKDAsIF9lbWJlZGRhYmxlX3NhdmVkX29iamVjdF9jb252ZXJ0ZXJzLmNvbnZlcnRTYXZlZERhc2hib2FyZFBhbmVsVG9QYW5lbFN0YXRlKShwYW5lbCk7CiAgICB9KTsKICAgIHZhciBleHBhbmRlZFBhbmVsSWQ7CgogICAgaWYgKGRhc2hib2FyZENvbnRhaW5lciAmJiAhKDAsIF9wdWJsaWMzLmlzRXJyb3JFbWJlZGRhYmxlKShkYXNoYm9hcmRDb250YWluZXIpKSB7CiAgICAgIGV4cGFuZGVkUGFuZWxJZCA9IGRhc2hib2FyZENvbnRhaW5lci5nZXRJbnB1dCgpLmV4cGFuZGVkUGFuZWxJZDsKICAgIH0KCiAgICB2YXIgc2hvdWxkU2hvd0VkaXRIZWxwID0gZ2V0U2hvdWxkU2hvd0VkaXRIZWxwKCk7CiAgICB2YXIgc2hvdWxkU2hvd1ZpZXdIZWxwID0gZ2V0U2hvdWxkU2hvd1ZpZXdIZWxwKCk7CiAgICB2YXIgaXNFbXB0eUluUmVhZG9ubHlNb2RlID0gZ2V0SXNFbXB0eUluUmVhZG9ubHlNb2RlKCk7CiAgICByZXR1cm4gewogICAgICBpZDogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNhdmVkRGFzaGJvYXJkLmlkIHx8ICcnLAogICAgICBmaWx0ZXJzOiBxdWVyeUZpbHRlci5nZXRGaWx0ZXJzKCksCiAgICAgIGhpZGVQYW5lbFRpdGxlczogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldEhpZGVQYW5lbFRpdGxlcygpLAogICAgICBxdWVyeTogJHNjb3BlLm1vZGVsLnF1ZXJ5LAogICAgICB0aW1lUmFuZ2U6IF9vYmplY3RTcHJlYWQoe30sIF9sb2Rhc2guZGVmYXVsdC5jbG9uZURlZXAodGltZWZpbHRlci5nZXRUaW1lKCkpKSwKICAgICAgcmVmcmVzaENvbmZpZzogdGltZWZpbHRlci5nZXRSZWZyZXNoSW50ZXJ2YWwoKSwKICAgICAgdmlld01vZGU6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRWaWV3TW9kZSgpLAogICAgICBwYW5lbHM6IGVtYmVkZGFibGVzTWFwLAogICAgICBpc0Z1bGxTY3JlZW5Nb2RlOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0RnVsbFNjcmVlbk1vZGUoKSwKICAgICAgaXNFbXB0eVN0YXRlOiBzaG91bGRTaG93RWRpdEhlbHAgfHwgc2hvdWxkU2hvd1ZpZXdIZWxwIHx8IGlzRW1wdHlJblJlYWRvbmx5TW9kZSwKICAgICAgdXNlTWFyZ2luczogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFVzZU1hcmdpbnMoKSwKICAgICAgbGFzdFJlbG9hZFJlcXVlc3RUaW1lOiBsYXN0UmVsb2FkUmVxdWVzdFRpbWUsCiAgICAgIHRpdGxlOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGl0bGUoKSwKICAgICAgZGVzY3JpcHRpb246IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXREZXNjcmlwdGlvbigpLAogICAgICBleHBhbmRlZFBhbmVsSWQ6IGV4cGFuZGVkUGFuZWxJZAogICAgfTsKICB9OwoKICB2YXIgdXBkYXRlU3RhdGUgPSBmdW5jdGlvbiB1cGRhdGVTdGF0ZSgpIHsKICAgIC8vIEZvbGxvd2luZyB0aGUgImJlc3QgcHJhY3RpY2UiIG9mIGFsd2F5cyBoYXZlIGEgJy4nIGluIHlvdXIgbmctbW9kZWxzIOKAkwogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci5qcy93aWtpL1VuZGVyc3RhbmRpbmctU2NvcGVzCiAgICAkc2NvcGUubW9kZWwgPSB7CiAgICAgIHF1ZXJ5OiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UXVlcnkoKSwKICAgICAgZmlsdGVyczogcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpLAogICAgICB0aW1lUmVzdG9yZTogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpbWVSZXN0b3JlKCksCiAgICAgIHRpdGxlOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGl0bGUoKSwKICAgICAgZGVzY3JpcHRpb246IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXREZXNjcmlwdGlvbigpLAogICAgICB0aW1lUmFuZ2U6IHRpbWVmaWx0ZXIuZ2V0VGltZSgpLAogICAgICByZWZyZXNoSW50ZXJ2YWw6IHRpbWVmaWx0ZXIuZ2V0UmVmcmVzaEludGVydmFsKCkKICAgIH07CiAgICAkc2NvcGUucGFuZWxzID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFBhbmVscygpOwogICAgJHNjb3BlLnNjcmVlblRpdGxlID0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpdGxlKCk7CiAgfTsKCiAgdXBkYXRlU3RhdGUoKTsKICB2YXIgZGFzaGJvYXJkQ29udGFpbmVyOwogIHZhciBpbnB1dFN1YnNjcmlwdGlvbjsKICB2YXIgb3V0cHV0U3Vic2NyaXB0aW9uOwogIHZhciBkYXNoYm9hcmREb20gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaGJvYXJkVmlld3BvcnQnKTsKICB2YXIgZGFzaGJvYXJkRmFjdG9yeSA9IGVtYmVkZGFibGVzLmdldEVtYmVkZGFibGVGYWN0b3J5KF9wdWJsaWMyLkRBU0hCT0FSRF9DT05UQUlORVJfVFlQRSk7CiAgZGFzaGJvYXJkRmFjdG9yeS5jcmVhdGUoZ2V0RGFzaGJvYXJkSW5wdXQoKSkudGhlbihmdW5jdGlvbiAoY29udGFpbmVyKSB7CiAgICBpZiAoISgwLCBfcHVibGljMy5pc0Vycm9yRW1iZWRkYWJsZSkoY29udGFpbmVyKSkgewogICAgICBkYXNoYm9hcmRDb250YWluZXIgPSBjb250YWluZXI7CgogICAgICBkYXNoYm9hcmRDb250YWluZXIucmVuZGVyRW1wdHkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNob3VsZFNob3dFZGl0SGVscCA9IGdldFNob3VsZFNob3dFZGl0SGVscCgpOwogICAgICAgIHZhciBzaG91bGRTaG93Vmlld0hlbHAgPSBnZXRTaG91bGRTaG93Vmlld0hlbHAoKTsKICAgICAgICB2YXIgaXNFbXB0eUluUmVhZE9ubHlNb2RlID0gZ2V0SXNFbXB0eUluUmVhZG9ubHlNb2RlKCk7CiAgICAgICAgdmFyIGlzRW1wdHlTdGF0ZSA9IHNob3VsZFNob3dFZGl0SGVscCB8fCBzaG91bGRTaG93Vmlld0hlbHAgfHwgaXNFbXB0eUluUmVhZE9ubHlNb2RlOwogICAgICAgIHJldHVybiBpc0VtcHR5U3RhdGUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9kYXNoYm9hcmRfZW1wdHlfc2NyZWVuLkRhc2hib2FyZEVtcHR5U2NyZWVuLCBnZXRFbXB0eVNjcmVlblByb3BzKHNob3VsZFNob3dFZGl0SGVscCwgaXNFbXB0eUluUmVhZE9ubHlNb2RlKSkgOiBudWxsOwogICAgICB9OwoKICAgICAgdXBkYXRlSW5kZXhQYXR0ZXJucyhkYXNoYm9hcmRDb250YWluZXIpOwogICAgICBvdXRwdXRTdWJzY3JpcHRpb24gPSBkYXNoYm9hcmRDb250YWluZXIuZ2V0T3V0cHV0JCgpLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgICAgdXBkYXRlSW5kZXhQYXR0ZXJucyhkYXNoYm9hcmRDb250YWluZXIpOwogICAgICB9KTsKICAgICAgaW5wdXRTdWJzY3JpcHRpb24gPSBkYXNoYm9hcmRDb250YWluZXIuZ2V0SW5wdXQkKCkuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZGlydHkgPSBmYWxzZTsgLy8gVGhpcyBoYXMgdG8gYmUgZmlyc3QgYmVjYXVzZSBoYW5kbGVEYXNoYm9hcmRDb250YWluZXJDaGFuZ2VzIGNhdXNlcwogICAgICAgIC8vIGFwcFN0YXRlLnNhdmUgd2hpY2ggd2lsbCBjYXVzZSByZWZyZXNoRGFzaGJvYXJkQ29udGFpbmVyIHRvIGJlIGNhbGxlZC4KICAgICAgICAvLyBBZGQgZmlsdGVycyBtb2RpZmllcyB0aGUgb2JqZWN0IHBhc3NlZCB0byBpdCwgaGVuY2UgdGhlIGNsb25lIGRlZXAuCgogICAgICAgIGlmICghX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwoY29udGFpbmVyLmdldElucHV0KCkuZmlsdGVycywgcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpKSkgewogICAgICAgICAgcXVlcnlGaWx0ZXIuYWRkRmlsdGVycyhfbG9kYXNoLmRlZmF1bHQuY2xvbmVEZWVwKGNvbnRhaW5lci5nZXRJbnB1dCgpLmZpbHRlcnMpKTsKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBseUZpbHRlcnMoJHNjb3BlLm1vZGVsLnF1ZXJ5LCBjb250YWluZXIuZ2V0SW5wdXQoKS5maWx0ZXJzKTsKICAgICAgICAgIGRpcnR5ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5oYW5kbGVEYXNoYm9hcmRDb250YWluZXJDaGFuZ2VzKGNvbnRhaW5lcik7CgogICAgICAgICAgaWYgKGRpcnR5KSB7CiAgICAgICAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIucmVnaXN0ZXJDaGFuZ2VMaXN0ZW5lcihmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gd2UgYXJlbid0IGNoZWNraW5nIGRpcnR5IHN0YXRlIGJlY2F1c2UgdGhlcmUgYXJlIGNoYW5nZXMgdGhlIGNvbnRhaW5lciBuZWVkcyB0byBrbm93IGFib3V0CiAgICAgICAgLy8gdGhhdCB3b24ndCBtYWtlIHRoZSBkYXNoYm9hcmQgImRpcnR5IiAtIGxpa2UgYSB2aWV3IG1vZGUgY2hhbmdlLgogICAgICAgIHJlZnJlc2hEYXNoYm9hcmRDb250YWluZXIoKTsKICAgICAgfSk7IC8vIFRoaXMgY29kZSBuZWVkcyB0byBiZSByZXBsYWNlZCB3aXRoIGEgYmV0dGVyIG1lY2hhbmlzbSBmb3IgYWRkaW5nIG5ldyBlbWJlZGRhYmxlcyBvZgogICAgICAvLyBhbnkgdHlwZSBmcm9tIHRoZSBhZGQgcGFuZWwuIExpa2VseSB0aGlzIHdpbGwgaGFwcGVuIHZpYSBjcmVhdGluZyBhIHZpc3VhbGl6YXRpb24gImlubGluZSIsCiAgICAgIC8vIHdpdGhvdXQgbmF2aWdhdGluZyBhd2F5IGZyb20gdGhlIFVYLgoKICAgICAgaWYgKCRyb3V0ZVBhcmFtc1tfZGFzaGJvYXJkX2NvbnN0YW50cy5EYXNoYm9hcmRDb25zdGFudHMuQUREX0VNQkVEREFCTEVfVFlQRV0pIHsKICAgICAgICB2YXIgdHlwZSA9ICRyb3V0ZVBhcmFtc1tfZGFzaGJvYXJkX2NvbnN0YW50cy5EYXNoYm9hcmRDb25zdGFudHMuQUREX0VNQkVEREFCTEVfVFlQRV07CiAgICAgICAgdmFyIGlkID0gJHJvdXRlUGFyYW1zW19kYXNoYm9hcmRfY29uc3RhbnRzLkRhc2hib2FyZENvbnN0YW50cy5BRERfRU1CRUREQUJMRV9JRF07CiAgICAgICAgY29udGFpbmVyLmFkZFNhdmVkT2JqZWN0RW1iZWRkYWJsZSh0eXBlLCBpZCk7CiAgICAgICAga2JuVXJsLnJlbW92ZVBhcmFtKF9kYXNoYm9hcmRfY29uc3RhbnRzLkRhc2hib2FyZENvbnN0YW50cy5BRERfRU1CRUREQUJMRV9UWVBFKTsKICAgICAgICBrYm5VcmwucmVtb3ZlUGFyYW0oX2Rhc2hib2FyZF9jb25zdGFudHMuRGFzaGJvYXJkQ29uc3RhbnRzLkFERF9FTUJFRERBQkxFX0lEKTsKICAgICAgfQogICAgfQoKICAgIGlmIChkYXNoYm9hcmREb20pIHsKICAgICAgY29udGFpbmVyLnJlbmRlcihkYXNoYm9hcmREb20pOwogICAgfQogIH0pOyAvLyBQYXJ0IG9mIHRoZSBleHBvc2VkIHBsdWdpbiBBUEkgLSBkbyBub3QgcmVtb3ZlIHdpdGhvdXQgY2FyZWZ1bCBjb25zaWRlcmF0aW9uLgoKICB0aGlzLmFwcFN0YXR1cyA9IHsKICAgIGRpcnR5OiAhZGFzaC5pZAogIH07CiAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnJlZ2lzdGVyQ2hhbmdlTGlzdGVuZXIoZnVuY3Rpb24gKHN0YXR1cykgewogICAgX3RoaXMuYXBwU3RhdHVzLmRpcnR5ID0gc3RhdHVzLmRpcnR5IHx8ICFkYXNoLmlkOwogICAgdXBkYXRlU3RhdGUoKTsKICB9KTsKICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuYXBwbHlGaWx0ZXJzKGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRRdWVyeSgpIHx8IHsKICAgIHF1ZXJ5OiAnJywKICAgIGxhbmd1YWdlOiBsb2NhbFN0b3JhZ2UuZ2V0KCdraWJhbmEudXNlclF1ZXJ5TGFuZ3VhZ2UnKSB8fCBjb25maWcuZ2V0KCdzZWFyY2g6cXVlcnlMYW5ndWFnZScpCiAgfSwgcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpKTsKICB0aW1lZmlsdGVyLmRpc2FibGVUaW1lUmFuZ2VTZWxlY3RvcigpOwogIHRpbWVmaWx0ZXIuZGlzYWJsZUF1dG9SZWZyZXNoU2VsZWN0b3IoKTsKCiAgdmFyIGxhbmRpbmdQYWdlVXJsID0gZnVuY3Rpb24gbGFuZGluZ1BhZ2VVcmwoKSB7CiAgICByZXR1cm4gIiMiLmNvbmNhdChfZGFzaGJvYXJkX2NvbnN0YW50cy5EYXNoYm9hcmRDb25zdGFudHMuTEFORElOR19QQUdFX1BBVEgpOwogIH07CgogIHZhciBnZXREYXNoVGl0bGUgPSBmdW5jdGlvbiBnZXREYXNoVGl0bGUoKSB7CiAgICByZXR1cm4gKDAsIF9kYXNoYm9hcmRfc3RyaW5ncy5nZXREYXNoYm9hcmRUaXRsZSkoZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpdGxlKCksIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRWaWV3TW9kZSgpLCBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0SXNEaXJ0eSh0aW1lZmlsdGVyKSwgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmlzTmV3KCkpOwogIH07IC8vIFB1c2ggYnJlYWRjcnVtYnMgdG8gbmV3IGhlYWRlciBuYXZpZ2F0aW9uCgoKICB2YXIgdXBkYXRlQnJlYWRjcnVtYnMgPSBmdW5jdGlvbiB1cGRhdGVCcmVhZGNydW1icygpIHsKICAgIGNocm9tZS5zZXRCcmVhZGNydW1icyhbewogICAgICB0ZXh0OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5kYXNoYm9hcmRBcHBCcmVhZGNydW1ic1RpdGxlJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGFzaGJvYXJkJwogICAgICB9KSwKICAgICAgaHJlZjogbGFuZGluZ1BhZ2VVcmwoKQogICAgfSwgewogICAgICB0ZXh0OiBnZXREYXNoVGl0bGUoKQogICAgfV0pOwogIH07CgogIHVwZGF0ZUJyZWFkY3J1bWJzKCk7CiAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnJlZ2lzdGVyQ2hhbmdlTGlzdGVuZXIodXBkYXRlQnJlYWRjcnVtYnMpOwoKICB2YXIgZ2V0Q2hhbmdlc0Zyb21BcHBTdGF0ZUZvckNvbnRhaW5lclN0YXRlID0gZnVuY3Rpb24gZ2V0Q2hhbmdlc0Zyb21BcHBTdGF0ZUZvckNvbnRhaW5lclN0YXRlKCkgewogICAgdmFyIGFwcFN0YXRlRGFzaGJvYXJkSW5wdXQgPSBnZXREYXNoYm9hcmRJbnB1dCgpOwoKICAgIGlmICghZGFzaGJvYXJkQ29udGFpbmVyIHx8ICgwLCBfcHVibGljMy5pc0Vycm9yRW1iZWRkYWJsZSkoZGFzaGJvYXJkQ29udGFpbmVyKSkgewogICAgICByZXR1cm4gYXBwU3RhdGVEYXNoYm9hcmRJbnB1dDsKICAgIH0KCiAgICB2YXIgY29udGFpbmVySW5wdXQgPSBkYXNoYm9hcmRDb250YWluZXIuZ2V0SW5wdXQoKTsKICAgIHZhciBkaWZmZXJlbmNlcyA9IHt9OwogICAgT2JqZWN0LmtleXMoY29udGFpbmVySW5wdXQpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICB2YXIgY29udGFpbmVyVmFsdWUgPSBjb250YWluZXJJbnB1dFtrZXldOwogICAgICB2YXIgYXBwU3RhdGVWYWx1ZSA9IGFwcFN0YXRlRGFzaGJvYXJkSW5wdXRba2V5XTsKCiAgICAgIGlmICghX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwoY29udGFpbmVyVmFsdWUsIGFwcFN0YXRlVmFsdWUpKSB7CiAgICAgICAgZGlmZmVyZW5jZXNba2V5XSA9IGFwcFN0YXRlVmFsdWU7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZGlmZmVyZW5jZXMpLmxlbmd0aCA9PT0gMCA/IHVuZGVmaW5lZCA6IGRpZmZlcmVuY2VzOwogIH07CgogIHZhciByZWZyZXNoRGFzaGJvYXJkQ29udGFpbmVyID0gZnVuY3Rpb24gcmVmcmVzaERhc2hib2FyZENvbnRhaW5lcigpIHsKICAgIHZhciBjaGFuZ2VzID0gZ2V0Q2hhbmdlc0Zyb21BcHBTdGF0ZUZvckNvbnRhaW5lclN0YXRlKCk7CgogICAgaWYgKGNoYW5nZXMgJiYgZGFzaGJvYXJkQ29udGFpbmVyKSB7CiAgICAgIGRhc2hib2FyZENvbnRhaW5lci51cGRhdGVJbnB1dChjaGFuZ2VzKTsKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlUXVlcnlBbmRGZXRjaCA9IGZ1bmN0aW9uIChfcmVmMikgewogICAgdmFyIHF1ZXJ5ID0gX3JlZjIucXVlcnksCiAgICAgICAgZGF0ZVJhbmdlID0gX3JlZjIuZGF0ZVJhbmdlOwoKICAgIGlmIChkYXRlUmFuZ2UpIHsKICAgICAgdGltZWZpbHRlci5zZXRUaW1lKGRhdGVSYW5nZSk7CiAgICB9CgogICAgdmFyIG9sZFF1ZXJ5ID0gJHNjb3BlLm1vZGVsLnF1ZXJ5OwoKICAgIGlmIChfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChvbGRRdWVyeSwgcXVlcnkpKSB7CiAgICAgIC8vIFRoZSB1c2VyIGNhbiBzdGlsbCByZXF1ZXN0IGEgcmVsb2FkIGluIHRoZSBxdWVyeSBiYXIsIGV2ZW4gaWYgdGhlCiAgICAgIC8vIHF1ZXJ5IGlzIHRoZSBzYW1lLCBhbmQgaW4gdGhhdCBjYXNlLCB3ZSBoYXZlIHRvIGV4cGxpY2l0bHkgYXNrIGZvcgogICAgICAvLyBhIHJlbG9hZCwgc2luY2Ugbm8gc3RhdGUgY2hhbmdlcyB3aWxsIGNhdXNlIGl0LgogICAgICBsYXN0UmVsb2FkUmVxdWVzdFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgcmVmcmVzaERhc2hib2FyZENvbnRhaW5lcigpOwogICAgfSBlbHNlIHsKICAgICAgJHNjb3BlLm1vZGVsLnF1ZXJ5ID0gcXVlcnk7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBseUZpbHRlcnMoJHNjb3BlLm1vZGVsLnF1ZXJ5LCAkc2NvcGUubW9kZWwuZmlsdGVycyk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLm9uUmVmcmVzaENoYW5nZSA9IGZ1bmN0aW9uIChfcmVmMykgewogICAgdmFyIGlzUGF1c2VkID0gX3JlZjMuaXNQYXVzZWQsCiAgICAgICAgcmVmcmVzaEludGVydmFsID0gX3JlZjMucmVmcmVzaEludGVydmFsOwogICAgdGltZWZpbHRlci5zZXRSZWZyZXNoSW50ZXJ2YWwoewogICAgICBwYXVzZTogaXNQYXVzZWQsCiAgICAgIHZhbHVlOiByZWZyZXNoSW50ZXJ2YWwgPyByZWZyZXNoSW50ZXJ2YWwgOiAkc2NvcGUubW9kZWwucmVmcmVzaEludGVydmFsLnZhbHVlCiAgICB9KTsKICB9OwoKICAkc2NvcGUub25GaWx0ZXJzVXBkYXRlZCA9IGZ1bmN0aW9uIChmaWx0ZXJzKSB7CiAgICAvLyBUaGUgZmlsdGVycyB3aWxsIGF1dG9tYXRpY2FsbHkgYmUgc2V0IHdoZW4gdGhlIHF1ZXJ5RmlsdGVyIGVtaXRzIGFuIHVwZGF0ZSBldmVudCAoc2VlIGJlbG93KQogICAgcXVlcnlGaWx0ZXIuc2V0RmlsdGVycyhmaWx0ZXJzKTsKICB9OwoKICAkc2NvcGUub25RdWVyeVNhdmVkID0gZnVuY3Rpb24gKHNhdmVkUXVlcnkpIHsKICAgICRzY29wZS5zYXZlZFF1ZXJ5ID0gc2F2ZWRRdWVyeTsKICB9OwoKICAkc2NvcGUub25TYXZlZFF1ZXJ5VXBkYXRlZCA9IGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IF9vYmplY3RTcHJlYWQoe30sIHNhdmVkUXVlcnkpOwogIH07CgogICRzY29wZS5vbkNsZWFyU2F2ZWRRdWVyeSA9IGZ1bmN0aW9uICgpIHsKICAgIGRlbGV0ZSAkc2NvcGUuc2F2ZWRRdWVyeTsKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRTYXZlZFF1ZXJ5SWQodW5kZWZpbmVkKTsKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBseUZpbHRlcnMoewogICAgICBxdWVyeTogJycsCiAgICAgIGxhbmd1YWdlOiBsb2NhbFN0b3JhZ2UuZ2V0KCdraWJhbmEudXNlclF1ZXJ5TGFuZ3VhZ2UnKSB8fCBjb25maWcuZ2V0KCdzZWFyY2g6cXVlcnlMYW5ndWFnZScpCiAgICB9LCBbXSk7IC8vIE1ha2luZyB0aGlzIG1ldGhvZCBzeW5jIGJyb2tlIHRoZSB1cGRhdGVzLgogICAgLy8gVGVtcG9yYXJ5IGZpeCwgdW50aWwgd2UgZml4IHRoZSBjb21wbGV4IHN0YXRlIGluIHRoaXMgZmlsZS4KCiAgICBzZXRUaW1lb3V0KHF1ZXJ5RmlsdGVyLnJlbW92ZUFsbCwgMCk7CiAgfTsKCiAgdmFyIHVwZGF0ZVN0YXRlRnJvbVNhdmVkUXVlcnkgPSBmdW5jdGlvbiB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KHNhdmVkUXVlcnkpIHsKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBseUZpbHRlcnMoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnF1ZXJ5LCBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMuZmlsdGVycyB8fCBbXSk7CgogICAgaWYgKHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyKSB7CiAgICAgIHRpbWVmaWx0ZXIuc2V0VGltZSh7CiAgICAgICAgZnJvbTogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIuZnJvbSwKICAgICAgICB0bzogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIudG8KICAgICAgfSk7CgogICAgICBpZiAoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIucmVmcmVzaEludGVydmFsKSB7CiAgICAgICAgdGltZWZpbHRlci5zZXRSZWZyZXNoSW50ZXJ2YWwoc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIucmVmcmVzaEludGVydmFsKTsKICAgICAgfQogICAgfSAvLyBNYWtpbmcgdGhpcyBtZXRob2Qgc3luYyBicm9rZSB0aGUgdXBkYXRlcy4KICAgIC8vIFRlbXBvcmFyeSBmaXgsIHVudGlsIHdlIGZpeCB0aGUgY29tcGxleCBzdGF0ZSBpbiB0aGlzIGZpbGUuCgoKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBxdWVyeUZpbHRlci5zZXRGaWx0ZXJzKHNhdmVkUXVlcnkuYXR0cmlidXRlcy5maWx0ZXJzIHx8IFtdKTsKICAgIH0sIDApOwogIH07CgogICRzY29wZS4kd2F0Y2goJ3NhdmVkUXVlcnknLCBmdW5jdGlvbiAobmV3U2F2ZWRRdWVyeSkgewogICAgaWYgKCFuZXdTYXZlZFF1ZXJ5KSByZXR1cm47CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0U2F2ZWRRdWVyeUlkKG5ld1NhdmVkUXVlcnkuaWQpOwogICAgdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShuZXdTYXZlZFF1ZXJ5KTsKICB9KTsKICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0U2F2ZWRRdWVyeUlkKCk7CiAgfSwgZnVuY3Rpb24gKG5ld1NhdmVkUXVlcnlJZCkgewogICAgaWYgKCFuZXdTYXZlZFF1ZXJ5SWQpIHsKICAgICAgJHNjb3BlLnNhdmVkUXVlcnkgPSB1bmRlZmluZWQ7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoISRzY29wZS5zYXZlZFF1ZXJ5IHx8IG5ld1NhdmVkUXVlcnlJZCAhPT0gJHNjb3BlLnNhdmVkUXVlcnkuaWQpIHsKICAgICAgc2F2ZWRRdWVyeVNlcnZpY2UuZ2V0U2F2ZWRRdWVyeShuZXdTYXZlZFF1ZXJ5SWQpLnRoZW4oZnVuY3Rpb24gKHNhdmVkUXVlcnkpIHsKICAgICAgICAkc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHNhdmVkUXVlcnk7CiAgICAgICAgICB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KHNhdmVkUXVlcnkpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9KTsKICAkc2NvcGUuaW5kZXhQYXR0ZXJucyA9IFtdOwogICRzY29wZS4kd2F0Y2goJ21vZGVsLnF1ZXJ5JywgZnVuY3Rpb24gKG5ld1F1ZXJ5KSB7CiAgICB2YXIgcXVlcnkgPSAoMCwgX2xlZ2FjeV9pbXBvcnRzLm1pZ3JhdGVMZWdhY3lRdWVyeSkobmV3UXVlcnkpOwogICAgJHNjb3BlLnVwZGF0ZVF1ZXJ5QW5kRmV0Y2goewogICAgICBxdWVyeTogcXVlcnkKICAgIH0pOwogIH0pOwogICRzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGRhc2hib2FyZENhcGFiaWxpdGllcy5zYXZlUXVlcnk7CiAgfSwgZnVuY3Rpb24gKG5ld0NhcGFiaWxpdHkpIHsKICAgICRzY29wZS5zaG93U2F2ZVF1ZXJ5ID0gbmV3Q2FwYWJpbGl0eTsKICB9KTsKICAkc2NvcGUudGltZWZpbHRlclN1YnNjcmlwdGlvbnMkID0gbmV3IF9yeGpzLlN1YnNjcmlwdGlvbigpOwogICRzY29wZS50aW1lZmlsdGVyU3Vic2NyaXB0aW9ucyQuYWRkKCgwLCBfbGVnYWN5X2ltcG9ydHMuc3Vic2NyaWJlV2l0aFNjb3BlKSgkc2NvcGUsIHRpbWVmaWx0ZXIuZ2V0UmVmcmVzaEludGVydmFsVXBkYXRlJCgpLCB7CiAgICBuZXh0OiBmdW5jdGlvbiBuZXh0KCkgewogICAgICB1cGRhdGVTdGF0ZSgpOwogICAgICByZWZyZXNoRGFzaGJvYXJkQ29udGFpbmVyKCk7CiAgICB9CiAgfSkpOwogICRzY29wZS50aW1lZmlsdGVyU3Vic2NyaXB0aW9ucyQuYWRkKCgwLCBfbGVnYWN5X2ltcG9ydHMuc3Vic2NyaWJlV2l0aFNjb3BlKSgkc2NvcGUsIHRpbWVmaWx0ZXIuZ2V0VGltZVVwZGF0ZSQoKSwgewogICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgdXBkYXRlU3RhdGUoKTsKICAgICAgcmVmcmVzaERhc2hib2FyZENvbnRhaW5lcigpOwogICAgfQogIH0pKTsKCiAgZnVuY3Rpb24gdXBkYXRlVmlld01vZGUobmV3TW9kZSkgewogICAgJHNjb3BlLnRvcE5hdk1lbnUgPSAoMCwgX2dldF90b3BfbmF2X2NvbmZpZy5nZXRUb3BOYXZDb25maWcpKG5ld01vZGUsIG5hdkFjdGlvbnMsIGRhc2hib2FyZENvbmZpZy5nZXRIaWRlV3JpdGVDb250cm9scygpKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11c2UtYmVmb3JlLWRlZmluZQoKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zd2l0Y2hWaWV3TW9kZShuZXdNb2RlKTsKICB9CgogIHZhciBvbkNoYW5nZVZpZXdNb2RlID0gZnVuY3Rpb24gb25DaGFuZ2VWaWV3TW9kZShuZXdNb2RlKSB7CiAgICB2YXIgaXNQYWdlUmVmcmVzaCA9IG5ld01vZGUgPT09IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRWaWV3TW9kZSgpOwogICAgdmFyIGlzTGVhdmluZ0VkaXRNb2RlID0gIWlzUGFnZVJlZnJlc2ggJiYgbmV3TW9kZSA9PT0gX3B1YmxpYzMuVmlld01vZGUuVklFVzsKICAgIHZhciB3aWxsTG9zZUNoYW5nZXMgPSBpc0xlYXZpbmdFZGl0TW9kZSAmJiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0SXNEaXJ0eSh0aW1lZmlsdGVyKTsKCiAgICBpZiAoIXdpbGxMb3NlQ2hhbmdlcykgewogICAgICB1cGRhdGVWaWV3TW9kZShuZXdNb2RlKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZ1bmN0aW9uIHJldmVydENoYW5nZXNBbmRFeGl0RWRpdE1vZGUoKSB7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5yZXNldFN0YXRlKCk7CiAgICAgIGtiblVybC5jaGFuZ2UoZGFzaC5pZCA/ICgwLCBfZGFzaGJvYXJkX2NvbnN0YW50cy5jcmVhdGVEYXNoYm9hcmRFZGl0VXJsKShkYXNoLmlkKSA6IF9kYXNoYm9hcmRfY29uc3RhbnRzLkRhc2hib2FyZENvbnN0YW50cy5DUkVBVEVfTkVXX0RBU0hCT0FSRF9VUkwpOyAvLyBUaGlzIGlzIG9ubHkgbmVjZXNzYXJ5IGZvciBuZXcgZGFzaGJvYXJkcywgd2hpY2ggd2lsbCBkZWZhdWx0IHRvIEVkaXQgbW9kZS4KCiAgICAgIHVwZGF0ZVZpZXdNb2RlKF9wdWJsaWMzLlZpZXdNb2RlLlZJRVcpOyAvLyBXZSBuZWVkIHRvIGRvIGEgaGFyZCByZXNldCBvZiB0aGUgdGltZXBpY2tlci4gYXBwU3RhdGUgd2lsbCBub3QgcmVsb2FkIGxpa2UKICAgICAgLy8gaXQgZG9lcyBvbiAnb3BlbicgYmVjYXVzZSBpdCdzIGJlZW4gc2F2ZWQgdG8gdGhlIHVybCBhbmQgdGhlIGdldEFwcFN0YXRlLnByZXZpb3VzbHlTdG9yZWQoKSBjaGVjayBvbgogICAgICAvLyByZWxvYWQgd2lsbCBjYXVzZSBpdCBub3QgdG8gc3luYy4KCiAgICAgIGlmIChkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0SXNUaW1lU2F2ZWRXaXRoRGFzaGJvYXJkKCkpIHsKICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc3luY1RpbWVmaWx0ZXJXaXRoRGFzaGJvYXJkKHRpbWVmaWx0ZXIpOwogICAgICB9CiAgICB9CgogICAgY29uZmlybU1vZGFsKF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4uZGFzaGJvYXJkLmNoYW5nZVZpZXdNb2RlQ29uZmlybU1vZGFsLmRpc2NhcmRDaGFuZ2VzRGVzY3JpcHRpb24nLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAiT25jZSB5b3UgZGlzY2FyZCB5b3VyIGNoYW5nZXMsIHRoZXJlJ3Mgbm8gZ2V0dGluZyB0aGVtIGJhY2suIgogICAgfSksIHsKICAgICAgb25Db25maXJtOiByZXZlcnRDaGFuZ2VzQW5kRXhpdEVkaXRNb2RlLAogICAgICBvbkNhbmNlbDogX2xvZGFzaC5kZWZhdWx0Lm5vb3AsCiAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5jaGFuZ2VWaWV3TW9kZUNvbmZpcm1Nb2RhbC5jb25maXJtQnV0dG9uTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEaXNjYXJkIGNoYW5nZXMnCiAgICAgIH0pLAogICAgICBjYW5jZWxCdXR0b25UZXh0OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5jaGFuZ2VWaWV3TW9kZUNvbmZpcm1Nb2RhbC5jYW5jZWxCdXR0b25MYWJlbCcsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0NvbnRpbnVlIGVkaXRpbmcnCiAgICAgIH0pLAogICAgICBkZWZhdWx0Rm9jdXNlZEJ1dHRvbjogX2xlZ2FjeV9pbXBvcnRzLkNvbmZpcm1hdGlvbkJ1dHRvblR5cGVzLkNBTkNFTCwKICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4uZGFzaGJvYXJkLmNoYW5nZVZpZXdNb2RlQ29uZmlybU1vZGFsLmRpc2NhcmRDaGFuZ2VzVGl0bGUnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEaXNjYXJkIGNoYW5nZXMgdG8gZGFzaGJvYXJkPycKICAgICAgfSkKICAgIH0pOwogIH07CiAgLyoqCiAgICogU2F2ZXMgdGhlIGRhc2hib2FyZC4KICAgKgogICAqIEBwYXJhbSB7b2JqZWN0fSBbc2F2ZU9wdGlvbnM9e31dCiAgICogQHByb3BlcnR5IHtib29sZWFufSBbc2F2ZU9wdGlvbnMuY29uZmlybU92ZXJ3cml0ZT1mYWxzZV0gLSBJZiB0cnVlLCBhdHRlbXB0cyB0byBjcmVhdGUgdGhlIHNvdXJjZSBzbyBpdAogICAqIGNhbiBjb25maXJtIGFuIG92ZXJ3cml0ZSBpZiBhIGRvY3VtZW50IHdpdGggdGhlIGlkIGFscmVhZHkgZXhpc3RzLgogICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3NhdmVPcHRpb25zLmlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQ9ZmFsc2VdIC0gSWYgdHJ1ZSwgc2F2ZSBhbGxvd2VkIHdpdGggZHVwbGljYXRlIHRpdGxlCiAgICogQHByb3BlcnR5IHtmdW5jfSBbc2F2ZU9wdGlvbnMub25UaXRsZUR1cGxpY2F0ZV0gLSBmdW5jdGlvbiBjYWxsZWQgaWYgZHVwbGljYXRlIHRpdGxlIGV4aXN0cy4KICAgKiBXaGVuIG5vdCBwcm92aWRlZCwgY29uZmlybSBtb2RhbCB3aWxsIGJlIGRpc3BsYXllZCBhc2tpbmcgdXNlciB0byBjb25maXJtIG9yIGNhbmNlbCBzYXZlLgogICAqIEByZXR1cm4ge1Byb21pc2V9CiAgICogQHJlc29sdmVkIHtTdHJpbmd9IC0gVGhlIGlkIG9mIHRoZSBkb2MKICAgKi8KCgogIGZ1bmN0aW9uIHNhdmUoc2F2ZU9wdGlvbnMpIHsKICAgIHJldHVybiAoMCwgX2xpYi5zYXZlRGFzaGJvYXJkKShfYW5ndWxhci5kZWZhdWx0LnRvSnNvbiwgdGltZWZpbHRlciwgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLCBzYXZlT3B0aW9ucykudGhlbihmdW5jdGlvbiAoaWQpIHsKICAgICAgaWYgKGlkKSB7CiAgICAgICAgbm90aWZpY2F0aW9ucy50b2FzdHMuYWRkU3VjY2Vzcyh7CiAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5kYXNoYm9hcmQuZGFzaGJvYXJkV2FzU2F2ZWRTdWNjZXNzTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJEYXNoYm9hcmQgJ3tkYXNoVGl0bGV9JyB3YXMgc2F2ZWQiLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBkYXNoVGl0bGU6IGRhc2gudGl0bGUKICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICAnZGF0YS10ZXN0LXN1YmonOiAnc2F2ZURhc2hib2FyZFN1Y2Nlc3MnCiAgICAgICAgfSk7CgogICAgICAgIGlmIChkYXNoLmlkICE9PSAkcm91dGVQYXJhbXMuaWQpIHsKICAgICAgICAgIGtiblVybC5jaGFuZ2UoKDAsIF9kYXNoYm9hcmRfY29uc3RhbnRzLmNyZWF0ZURhc2hib2FyZEVkaXRVcmwpKGRhc2guaWQpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2hyb21lLmRvY1RpdGxlLmNoYW5nZShkYXNoLmxhc3RTYXZlZFRpdGxlKTsKICAgICAgICAgIHVwZGF0ZVZpZXdNb2RlKF9wdWJsaWMzLlZpZXdNb2RlLlZJRVcpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogaWQKICAgICAgfTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICBub3RpZmljYXRpb25zLnRvYXN0cy5hZGREYW5nZXIoewogICAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5kYXNoYm9hcmRXYXNOb3RTYXZlZERhbmdlck1lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRhc2hib2FyZCAne2Rhc2hUaXRsZX0nIHdhcyBub3Qgc2F2ZWQuIEVycm9yOiB7ZXJyb3JNZXNzYWdlfSIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgZGFzaFRpdGxlOiBkYXNoLnRpdGxlLAogICAgICAgICAgICBlcnJvck1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICAnZGF0YS10ZXN0LXN1YmonOiAnc2F2ZURhc2hib2FyZEZhaWx1cmUnCiAgICAgIH0pOwogICAgICByZXR1cm4gewogICAgICAgIGVycm9yOiBlcnJvcgogICAgICB9OwogICAgfSk7CiAgfQoKICAkc2NvcGUuc2hvd0ZpbHRlckJhciA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAkc2NvcGUubW9kZWwuZmlsdGVycy5sZW5ndGggPiAwIHx8ICFkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0RnVsbFNjcmVlbk1vZGUoKTsKICB9OwoKICAkc2NvcGUuc2hvd0FkZFBhbmVsID0gZnVuY3Rpb24gKCkgewogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldEZ1bGxTY3JlZW5Nb2RlKGZhbHNlKTsKICAgIC8qCiAgICAgKiBUZW1wIHNvbHV0aW9uIGZvciB0cmlnZ2VyaW5nIG1lbnUgY2xpY2suCiAgICAgKiBXaGVuIGRlLWFuZ3VsYXJpemluZyB0aGlzIGNvZGUsIHBsZWFzZSBjYWxsIHRoZSB1bmRlcmxheWluZyBhY3Rpb24gZnVuY3Rpb24KICAgICAqIGRpcmVjdGx5IGFuZCBub3QgdmlhIHRoZSB0b3AgbmF2IG9iamVjdC4KICAgICAqKi8KCiAgICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuQUREXSgpOwogIH07CgogICRzY29wZS5lbnRlckVkaXRNb2RlID0gZnVuY3Rpb24gKCkgewogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldEZ1bGxTY3JlZW5Nb2RlKGZhbHNlKTsKICAgIC8qCiAgICAgKiBUZW1wIHNvbHV0aW9uIGZvciB0cmlnZ2VyaW5nIG1lbnUgY2xpY2suCiAgICAgKiBXaGVuIGRlLWFuZ3VsYXJpemluZyB0aGlzIGNvZGUsIHBsZWFzZSBjYWxsIHRoZSB1bmRlcmxheWluZyBhY3Rpb24gZnVuY3Rpb24KICAgICAqIGRpcmVjdGx5IGFuZCBub3QgdmlhIHRoZSB0b3AgbmF2IG9iamVjdC4KICAgICAqKi8KCiAgICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuRU5URVJfRURJVF9NT0RFXSgpOwogIH07CgogIHZhciBuYXZBY3Rpb25zID0ge307CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5GVUxMX1NDUkVFTl0gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldEZ1bGxTY3JlZW5Nb2RlKHRydWUpOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5FWElUX0VESVRfTU9ERV0gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gb25DaGFuZ2VWaWV3TW9kZShfcHVibGljMy5WaWV3TW9kZS5WSUVXKTsKICB9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuRU5URVJfRURJVF9NT0RFXSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBvbkNoYW5nZVZpZXdNb2RlKF9wdWJsaWMzLlZpZXdNb2RlLkVESVQpOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5TQVZFXSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjdXJyZW50VGl0bGUgPSBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGl0bGUoKTsKICAgIHZhciBjdXJyZW50RGVzY3JpcHRpb24gPSBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0RGVzY3JpcHRpb24oKTsKICAgIHZhciBjdXJyZW50VGltZVJlc3RvcmUgPSBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGltZVJlc3RvcmUoKTsKCiAgICB2YXIgb25TYXZlID0gZnVuY3Rpb24gb25TYXZlKF9yZWY0KSB7CiAgICAgIHZhciBuZXdUaXRsZSA9IF9yZWY0Lm5ld1RpdGxlLAogICAgICAgICAgbmV3RGVzY3JpcHRpb24gPSBfcmVmNC5uZXdEZXNjcmlwdGlvbiwKICAgICAgICAgIG5ld0NvcHlPblNhdmUgPSBfcmVmNC5uZXdDb3B5T25TYXZlLAogICAgICAgICAgbmV3VGltZVJlc3RvcmUgPSBfcmVmNC5uZXdUaW1lUmVzdG9yZSwKICAgICAgICAgIGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQgPSBfcmVmNC5pc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgICAgb25UaXRsZUR1cGxpY2F0ZSA9IF9yZWY0Lm9uVGl0bGVEdXBsaWNhdGU7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaXRsZShuZXdUaXRsZSk7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXREZXNjcmlwdGlvbihuZXdEZXNjcmlwdGlvbik7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zYXZlZERhc2hib2FyZC5jb3B5T25TYXZlID0gbmV3Q29weU9uU2F2ZTsKICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldFRpbWVSZXN0b3JlKG5ld1RpbWVSZXN0b3JlKTsKICAgICAgdmFyIHNhdmVPcHRpb25zID0gewogICAgICAgIGNvbmZpcm1PdmVyd3JpdGU6IGZhbHNlLAogICAgICAgIGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQ6IGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQsCiAgICAgICAgb25UaXRsZUR1cGxpY2F0ZTogb25UaXRsZUR1cGxpY2F0ZQogICAgICB9OwogICAgICByZXR1cm4gc2F2ZShzYXZlT3B0aW9ucykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAvLyBJZiB0aGUgc2F2ZSB3YXNuJ3Qgc3VjY2Vzc2Z1bCwgcHV0IHRoZSBvcmlnaW5hbCB2YWx1ZXMgYmFjay4KICAgICAgICBpZiAoIXJlc3BvbnNlLmlkKSB7CiAgICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0VGl0bGUoY3VycmVudFRpdGxlKTsKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXREZXNjcmlwdGlvbihjdXJyZW50RGVzY3JpcHRpb24pOwogICAgICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldFRpbWVSZXN0b3JlKGN1cnJlbnRUaW1lUmVzdG9yZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgZGFzaGJvYXJkU2F2ZU1vZGFsID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2F2ZV9tb2RhbC5EYXNoYm9hcmRTYXZlTW9kYWwsIHsKICAgICAgb25TYXZlOiBvblNhdmUsCiAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7fSwKICAgICAgdGl0bGU6IGN1cnJlbnRUaXRsZSwKICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnREZXNjcmlwdGlvbiwKICAgICAgdGltZVJlc3RvcmU6IGN1cnJlbnRUaW1lUmVzdG9yZSwKICAgICAgc2hvd0NvcHlPblNhdmU6IGRhc2guaWQgPyB0cnVlIDogZmFsc2UKICAgIH0pOwoKICAgICgwLCBfbGVnYWN5X2ltcG9ydHMuc2hvd1NhdmVNb2RhbCkoZGFzaGJvYXJkU2F2ZU1vZGFsKTsKICB9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuQ0xPTkVdID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGN1cnJlbnRUaXRsZSA9IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRUaXRsZSgpOwoKICAgIHZhciBvbkNsb25lID0gZnVuY3Rpb24gb25DbG9uZShuZXdUaXRsZSwgaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZCwgb25UaXRsZUR1cGxpY2F0ZSkgewogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2F2ZWREYXNoYm9hcmQuY29weU9uU2F2ZSA9IHRydWU7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaXRsZShuZXdUaXRsZSk7CiAgICAgIHZhciBzYXZlT3B0aW9ucyA9IHsKICAgICAgICBjb25maXJtT3ZlcndyaXRlOiBmYWxzZSwKICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkOiBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgIG9uVGl0bGVEdXBsaWNhdGU6IG9uVGl0bGVEdXBsaWNhdGUKICAgICAgfTsKICAgICAgcmV0dXJuIHNhdmUoc2F2ZU9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gSWYgdGhlIHNhdmUgd2Fzbid0IHN1Y2Nlc3NmdWwsIHB1dCB0aGUgb3JpZ2luYWwgdGl0bGUgYmFjay4KICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaXRsZShjdXJyZW50VGl0bGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICB9KTsKICAgIH07CgogICAgKDAsIF9zaG93X2Nsb25lX21vZGFsLnNob3dDbG9uZU1vZGFsKShvbkNsb25lLCBjdXJyZW50VGl0bGUpOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5BRERdID0gZnVuY3Rpb24gKCkgewogICAgaWYgKGRhc2hib2FyZENvbnRhaW5lciAmJiAhKDAsIF9wdWJsaWMzLmlzRXJyb3JFbWJlZGRhYmxlKShkYXNoYm9hcmRDb250YWluZXIpKSB7CiAgICAgIHZhciBTYXZlZE9iamVjdEZpbmRlciA9IGZ1bmN0aW9uIFNhdmVkT2JqZWN0RmluZGVyKHByb3BzKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3B1YmxpYzQuU2F2ZWRPYmplY3RGaW5kZXJVaSwgX2V4dGVuZHMoe30sIHByb3BzLCB7CiAgICAgICAgICBzYXZlZE9iamVjdHM6IHNhdmVkT2JqZWN0cywKICAgICAgICAgIHVpU2V0dGluZ3M6IHVpU2V0dGluZ3MKICAgICAgICB9KSk7CiAgICAgIH07CgogICAgICAoMCwgX3B1YmxpYzMub3BlbkFkZFBhbmVsRmx5b3V0KSh7CiAgICAgICAgZW1iZWRkYWJsZTogZGFzaGJvYXJkQ29udGFpbmVyLAogICAgICAgIGdldEFsbEZhY3RvcmllczogZW1iZWRkYWJsZXMuZ2V0RW1iZWRkYWJsZUZhY3RvcmllcywKICAgICAgICBnZXRGYWN0b3J5OiBlbWJlZGRhYmxlcy5nZXRFbWJlZGRhYmxlRmFjdG9yeSwKICAgICAgICBub3RpZmljYXRpb25zOiBub3RpZmljYXRpb25zLAogICAgICAgIG92ZXJsYXlzOiBvdmVybGF5cywKICAgICAgICBTYXZlZE9iamVjdEZpbmRlcjogU2F2ZWRPYmplY3RGaW5kZXIKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgbmF2QWN0aW9uc1tfdG9wX25hdl9pZHMuVG9wTmF2SWRzLlZJU1VBTElaRV0gPSBmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgdmFyIHR5cGUsIGZhY3RvcnksIGV4cGxpY2l0SW5wdXQ7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0eXBlID0gJ3Zpc3VhbGl6YXRpb24nOwogICAgICAgICAgICBmYWN0b3J5ID0gZW1iZWRkYWJsZXMuZ2V0RW1iZWRkYWJsZUZhY3RvcnkodHlwZSk7CgogICAgICAgICAgICBpZiAoZmFjdG9yeSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aHJvdyBuZXcgX3B1YmxpYzMuRW1iZWRkYWJsZUZhY3RvcnlOb3RGb3VuZEVycm9yKHR5cGUpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZmFjdG9yeS5nZXRFeHBsaWNpdElucHV0KCkpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgZXhwbGljaXRJbnB1dCA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICBpZiAoIWRhc2hib2FyZENvbnRhaW5lcikgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEwOwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGRhc2hib2FyZENvbnRhaW5lci5hZGROZXdFbWJlZGRhYmxlKHR5cGUsIGV4cGxpY2l0SW5wdXQpKTsKCiAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5PUFRJT05TXSA9IGZ1bmN0aW9uIChhbmNob3JFbGVtZW50KSB7CiAgICAoMCwgX3Nob3dfb3B0aW9uc19wb3BvdmVyLnNob3dPcHRpb25zUG9wb3ZlcikoewogICAgICBhbmNob3JFbGVtZW50OiBhbmNob3JFbGVtZW50LAogICAgICB1c2VNYXJnaW5zOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VXNlTWFyZ2lucygpLAogICAgICBvblVzZU1hcmdpbnNDaGFuZ2U6IGZ1bmN0aW9uIG9uVXNlTWFyZ2luc0NoYW5nZShpc0NoZWNrZWQpIHsKICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0VXNlTWFyZ2lucyhpc0NoZWNrZWQpOwogICAgICB9LAogICAgICBoaWRlUGFuZWxUaXRsZXM6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRIaWRlUGFuZWxUaXRsZXMoKSwKICAgICAgb25IaWRlUGFuZWxUaXRsZXNDaGFuZ2U6IGZ1bmN0aW9uIG9uSGlkZVBhbmVsVGl0bGVzQ2hhbmdlKGlzQ2hlY2tlZCkgewogICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRIaWRlUGFuZWxUaXRsZXMoaXNDaGVja2VkKTsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgbmF2QWN0aW9uc1tfdG9wX25hdl9pZHMuVG9wTmF2SWRzLlNIQVJFXSA9IGZ1bmN0aW9uIChhbmNob3JFbGVtZW50KSB7CiAgICBzaGFyZS50b2dnbGVTaGFyZUNvbnRleHRNZW51KHsKICAgICAgYW5jaG9yRWxlbWVudDogYW5jaG9yRWxlbWVudCwKICAgICAgYWxsb3dFbWJlZDogdHJ1ZSwKICAgICAgYWxsb3dTaG9ydFVybDogIWRhc2hib2FyZENvbmZpZy5nZXRIaWRlV3JpdGVDb250cm9scygpLAogICAgICBzaGFyZWFibGVVcmw6ICgwLCBfbGVnYWN5X2ltcG9ydHMudW5oYXNoVXJsKSh3aW5kb3cubG9jYXRpb24uaHJlZiksCiAgICAgIG9iamVjdElkOiBkYXNoLmlkLAogICAgICBvYmplY3RUeXBlOiAnZGFzaGJvYXJkJywKICAgICAgc2hhcmluZ0RhdGE6IHsKICAgICAgICB0aXRsZTogZGFzaC50aXRsZQogICAgICB9LAogICAgICBpc0RpcnR5OiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0SXNEaXJ0eSgpCiAgICB9KTsKICB9OwoKICB1cGRhdGVWaWV3TW9kZShkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0Vmlld01vZGUoKSk7IC8vIHVwZGF0ZSByb290IHNvdXJjZSB3aGVuIGZpbHRlcnMgdXBkYXRlCgogIHZhciB1cGRhdGVTdWJzY3JpcHRpb24gPSBxdWVyeUZpbHRlci5nZXRVcGRhdGVzJCgpLnN1YnNjcmliZSh7CiAgICBuZXh0OiBmdW5jdGlvbiBuZXh0KCkgewogICAgICAkc2NvcGUubW9kZWwuZmlsdGVycyA9IHF1ZXJ5RmlsdGVyLmdldEZpbHRlcnMoKTsKICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmFwcGx5RmlsdGVycygkc2NvcGUubW9kZWwucXVlcnksICRzY29wZS5tb2RlbC5maWx0ZXJzKTsKCiAgICAgIGlmIChkYXNoYm9hcmRDb250YWluZXIpIHsKICAgICAgICBkYXNoYm9hcmRDb250YWluZXIudXBkYXRlSW5wdXQoewogICAgICAgICAgZmlsdGVyczogJHNjb3BlLm1vZGVsLmZpbHRlcnMKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0pOwogIHZhciB2aXNpYmxlU3Vic2NyaXB0aW9uID0gY2hyb21lLmdldElzVmlzaWJsZSQoKS5zdWJzY3JpYmUoZnVuY3Rpb24gKGlzVmlzaWJsZSkgewogICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAkc2NvcGUuaXNWaXNpYmxlID0gaXNWaXNpYmxlOwogICAgfSk7CiAgfSk7CiAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICB1cGRhdGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgIHZpc2libGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgICRzY29wZS50aW1lZmlsdGVyU3Vic2NyaXB0aW9ucyQudW5zdWJzY3JpYmUoKTsKICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5kZXN0cm95KCk7CgogICAgaWYgKGlucHV0U3Vic2NyaXB0aW9uKSB7CiAgICAgIGlucHV0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICB9CgogICAgaWYgKG91dHB1dFN1YnNjcmlwdGlvbikgewogICAgICBvdXRwdXRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgIH0KCiAgICBpZiAoZGFzaGJvYXJkQ29udGFpbmVyKSB7CiAgICAgIGRhc2hib2FyZENvbnRhaW5lci5kZXN0cm95KCk7CiAgICB9CiAgfSk7Cn07CgpleHBvcnRzLkRhc2hib2FyZEFwcENvbnRyb2xsZXIgPSBEYXNoYm9hcmRBcHBDb250cm9sbGVyOw=="},null]}