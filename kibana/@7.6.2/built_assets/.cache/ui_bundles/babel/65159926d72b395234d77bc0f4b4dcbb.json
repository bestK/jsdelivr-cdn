{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/data/public/index_patterns/index_patterns/index_pattern.js","dependencies":[{"path":"src/plugins/data/public/index_patterns/index_patterns/index_pattern.js","mtime":1585205041547},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkluZGV4UGF0dGVybiA9IHZvaWQgMDsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3JlYWN0ID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9yZWFjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9raWJhbmFfdXRpbHMvcHVibGljIik7Cgp2YXIgX3B1YmxpYzIgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9raWJhbmFfcmVhY3QvcHVibGljIik7Cgp2YXIgX2NvbW1vbiA9IHJlcXVpcmUoIi4uLy4uLy4uL2NvbW1vbiIpOwoKdmFyIF91dGlscyA9IHJlcXVpcmUoIi4uL3V0aWxzIik7Cgp2YXIgXzIgPSByZXF1aXJlKCIuLi8iKTsKCnZhciBfZmllbGRzID0gcmVxdWlyZSgiLi4vZmllbGRzIik7Cgp2YXIgX2ZpZWxkc19mZXRjaGVyID0gcmVxdWlyZSgiLi9fZmllbGRzX2ZldGNoZXIiKTsKCnZhciBfZm9ybWF0X2hpdCA9IHJlcXVpcmUoIi4vZm9ybWF0X2hpdCIpOwoKdmFyIF9mbGF0dGVuX2hpdCA9IHJlcXVpcmUoIi4vZmxhdHRlbl9oaXQiKTsKCnZhciBfc2VydmljZXMgPSByZXF1aXJlKCIuLi8uLi9zZXJ2aWNlcyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIE1BWF9BVFRFTVBUU19UT19SRVNPTFZFX0NPTkZMSUNUUyA9IDM7CnZhciB0eXBlID0gJ2luZGV4LXBhdHRlcm4nOwoKdmFyIEluZGV4UGF0dGVybiA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEluZGV4UGF0dGVybihpZCwgZ2V0Q29uZmlnLCBzYXZlZE9iamVjdHNDbGllbnQsIGFwaUNsaWVudCwgcGF0dGVybkNhY2hlKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJbmRleFBhdHRlcm4pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiaWQiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAidGl0bGUiLCAnJyk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJ0eXBlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImZpZWxkRm9ybWF0TWFwIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInR5cGVNZXRhIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImZpZWxkcyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJ0aW1lRmllbGROYW1lIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImludGVydmFsTmFtZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJmb3JtYXRIaXQiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZm9ybWF0RmllbGQiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZmxhdHRlbkhpdCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJtZXRhRmllbGRzIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInZlcnNpb24iLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic2F2ZWRPYmplY3RzQ2xpZW50Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInBhdHRlcm5DYWNoZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJnZXRDb25maWciLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic291cmNlRmlsdGVycyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJvcmlnaW5hbEJvZHkiLCB7fSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJmaWVsZHNGZXRjaGVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInNob3J0RG90c0VuYWJsZSIsIGZhbHNlKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIm1hcHBpbmciLCAoMCwgX3B1YmxpYy5leHBhbmRTaG9ydGhhbmQpKHsKICAgICAgdGl0bGU6IF9jb21tb24uRVNfRklFTERfVFlQRVMuVEVYVCwKICAgICAgdGltZUZpZWxkTmFtZTogX2NvbW1vbi5FU19GSUVMRF9UWVBFUy5LRVlXT1JELAogICAgICBpbnRlcnZhbE5hbWU6IF9jb21tb24uRVNfRklFTERfVFlQRVMuS0VZV09SRCwKICAgICAgZmllbGRzOiAnanNvbicsCiAgICAgIHNvdXJjZUZpbHRlcnM6ICdqc29uJywKICAgICAgZmllbGRGb3JtYXRNYXA6IHsKICAgICAgICB0eXBlOiBfY29tbW9uLkVTX0ZJRUxEX1RZUEVTLlRFWFQsCiAgICAgICAgX3NlcmlhbGl6ZTogZnVuY3Rpb24gX3NlcmlhbGl6ZSgpIHsKICAgICAgICAgIHZhciBtYXAgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgICAgICAgIHZhciBzZXJpYWxpemVkID0gX2xvZGFzaC5kZWZhdWx0LnRyYW5zZm9ybShtYXAsIF90aGlzLnNlcmlhbGl6ZUZpZWxkRm9ybWF0TWFwKTsKCiAgICAgICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LmlzRW1wdHkoc2VyaWFsaXplZCkgPyB1bmRlZmluZWQgOiBKU09OLnN0cmluZ2lmeShzZXJpYWxpemVkKTsKICAgICAgICB9LAogICAgICAgIF9kZXNlcmlhbGl6ZTogZnVuY3Rpb24gX2Rlc2VyaWFsaXplKCkgewogICAgICAgICAgdmFyIG1hcCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJ3t9JzsKICAgICAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQubWFwVmFsdWVzKEpTT04ucGFyc2UobWFwKSwgZnVuY3Rpb24gKG1hcHBpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzLmRlc2VyaWFsaXplRmllbGRGb3JtYXRNYXAobWFwcGluZyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHR5cGU6IF9jb21tb24uRVNfRklFTERfVFlQRVMuS0VZV09SRCwKICAgICAgdHlwZU1ldGE6ICdqc29uJwogICAgfSkpOwoKICAgIHRoaXMuaWQgPSBpZDsKICAgIHRoaXMuc2F2ZWRPYmplY3RzQ2xpZW50ID0gc2F2ZWRPYmplY3RzQ2xpZW50OwogICAgdGhpcy5wYXR0ZXJuQ2FjaGUgPSBwYXR0ZXJuQ2FjaGU7IC8vIGluc3RlYWQgb2Ygc3RvcmluZyBjb25maWcgd2UgcmF0aGVyIHN0b3JlIHRoZSBnZXR0ZXIgb25seSBhcyBucCB1aVNldHRpbmdzQ2xpZW50IGhhcyBjaXJjdWxhciByZWZlcmVuY2VzCiAgICAvLyB3aGljaCBjYXVzZSBwcm9ibGVtcyB3aGVuIGJlaW5nIGNvbnN1bWVkIGZyb20gYW5ndWxhcgoKICAgIHRoaXMuZ2V0Q29uZmlnID0gZ2V0Q29uZmlnOwogICAgdGhpcy5zaG9ydERvdHNFbmFibGUgPSB0aGlzLmdldENvbmZpZygnc2hvcnREb3RzOmVuYWJsZScpOwogICAgdGhpcy5tZXRhRmllbGRzID0gdGhpcy5nZXRDb25maWcoJ21ldGFGaWVsZHMnKTsKICAgIHRoaXMuZmllbGRzID0gbmV3IF9maWVsZHMuRmllbGRMaXN0KHRoaXMsIFtdLCB0aGlzLnNob3J0RG90c0VuYWJsZSk7CiAgICB0aGlzLmZpZWxkc0ZldGNoZXIgPSAoMCwgX2ZpZWxkc19mZXRjaGVyLmNyZWF0ZUZpZWxkc0ZldGNoZXIpKHRoaXMsIGFwaUNsaWVudCwgdGhpcy5nZXRDb25maWcoJ21ldGFGaWVsZHMnKSk7CiAgICB0aGlzLmZsYXR0ZW5IaXQgPSAoMCwgX2ZsYXR0ZW5faGl0LmZsYXR0ZW5IaXRXcmFwcGVyKSh0aGlzLCB0aGlzLmdldENvbmZpZygnbWV0YUZpZWxkcycpKTsKICAgIHRoaXMuZm9ybWF0SGl0ID0gKDAsIF9mb3JtYXRfaGl0LmZvcm1hdEhpdFByb3ZpZGVyKSh0aGlzLCAoMCwgX3NlcnZpY2VzLmdldEZpZWxkRm9ybWF0cykoKS5nZXREZWZhdWx0SW5zdGFuY2UoX2NvbW1vbi5LQk5fRklFTERfVFlQRVMuU1RSSU5HKSk7CiAgICB0aGlzLmZvcm1hdEZpZWxkID0gdGhpcy5mb3JtYXRIaXQuZm9ybWF0RmllbGQ7CiAgfQoKICBfY3JlYXRlQ2xhc3MoSW5kZXhQYXR0ZXJuLCBbewogICAga2V5OiAic2VyaWFsaXplRmllbGRGb3JtYXRNYXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlcmlhbGl6ZUZpZWxkRm9ybWF0TWFwKGZsYXQsIGZvcm1hdCwgZmllbGQpIHsKICAgICAgaWYgKGZvcm1hdCAmJiBmaWVsZCkgewogICAgICAgIGZsYXRbZmllbGRdID0gZm9ybWF0OwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVzZXJpYWxpemVGaWVsZEZvcm1hdE1hcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzZXJpYWxpemVGaWVsZEZvcm1hdE1hcChtYXBwaW5nKSB7CiAgICAgIHZhciBGaWVsZEZvcm1hdCA9ICgwLCBfc2VydmljZXMuZ2V0RmllbGRGb3JtYXRzKSgpLmdldFR5cGUobWFwcGluZy5pZCk7CiAgICAgIHJldHVybiBGaWVsZEZvcm1hdCAmJiBuZXcgRmllbGRGb3JtYXQobWFwcGluZy5wYXJhbXMsIHRoaXMuZ2V0Q29uZmlnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpbml0RmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0RmllbGRzKGlucHV0KSB7CiAgICAgIHZhciBuZXdWYWx1ZSA9IGlucHV0IHx8IHRoaXMuZmllbGRzOwogICAgICB0aGlzLmZpZWxkcyA9IG5ldyBfZmllbGRzLkZpZWxkTGlzdCh0aGlzLCBuZXdWYWx1ZSwgdGhpcy5zaG9ydERvdHNFbmFibGUpOwogICAgfQogIH0sIHsKICAgIGtleTogImlzRmllbGRSZWZyZXNoUmVxdWlyZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzRmllbGRSZWZyZXNoUmVxdWlyZWQoKSB7CiAgICAgIGlmICghdGhpcy5maWVsZHMpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZmllbGRzLmV2ZXJ5KGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZWxhc3RpYy9raWJhbmEvcHVsbC84NDIxCiAgICAgICAgdmFyIGhhc0ZpZWxkQ2FwcyA9ICdhZ2dyZWdhdGFibGUnIGluIGZpZWxkICYmICdzZWFyY2hhYmxlJyBpbiBmaWVsZDsgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGFzdGljL2tpYmFuYS9wdWxsLzExOTY5CgogICAgICAgIHZhciBoYXNEb2NWYWx1ZXNGbGFnID0gJ3JlYWRGcm9tRG9jVmFsdWVzJyBpbiBmaWVsZDsKICAgICAgICByZXR1cm4gIWhhc0ZpZWxkQ2FwcyB8fCAhaGFzRG9jVmFsdWVzRmxhZzsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaW5kZXhGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluZGV4RmllbGRzKCkgewogICAgICB2YXIgZm9yY2VGaWVsZFJlZnJlc2gsCiAgICAgICAgICBfYXJncyA9IGFyZ3VtZW50czsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBpbmRleEZpZWxkcyQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZm9yY2VGaWVsZFJlZnJlc2ggPSBfYXJncy5sZW5ndGggPiAwICYmIF9hcmdzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnc1swXSA6IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAodGhpcy5pZCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGlmICghKGZvcmNlRmllbGRSZWZyZXNoIHx8IHRoaXMuaXNGaWVsZFJlZnJlc2hSZXF1aXJlZCgpKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGhpcy5yZWZyZXNoRmllbGRzKCkpOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIHRoaXMuaW5pdEZpZWxkcygpOwoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVGcm9tRWxhc3RpY1NlYXJjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlRnJvbUVsYXN0aWNTZWFyY2gocmVzcG9uc2UpIHsKICAgICAgdmFyIGZvcmNlRmllbGRSZWZyZXNoLAogICAgICAgICAgd2FybmluZ1RpdGxlLAogICAgICAgICAgd2FybmluZ1RleHQsCiAgICAgICAgICBlZGl0VXJsVGVtcGxhdGUsCiAgICAgICAgICBlZGl0VXJsLAogICAgICAgICAgX2dldE5vdGlmaWNhdGlvbnMsCiAgICAgICAgICB0b2FzdHMsCiAgICAgICAgICBfYXJnczIgPSBhcmd1bWVudHM7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIHVwZGF0ZUZyb21FbGFzdGljU2VhcmNoJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBmb3JjZUZpZWxkUmVmcmVzaCA9IF9hcmdzMi5sZW5ndGggPiAxICYmIF9hcmdzMlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyWzFdIDogZmFsc2U7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5mb3VuZCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3B1YmxpYy5TYXZlZE9iamVjdE5vdEZvdW5kKHR5cGUsIHRoaXMuaWQsICcjL21hbmFnZW1lbnQva2liYW5hL2luZGV4X3BhdHRlcm4nKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBfbG9kYXNoLmRlZmF1bHQuZm9yT3duKHRoaXMubWFwcGluZywgZnVuY3Rpb24gKGZpZWxkTWFwcGluZywgbmFtZSkgewogICAgICAgICAgICAgICAgaWYgKCFmaWVsZE1hcHBpbmcuX2Rlc2VyaWFsaXplIHx8ICFuYW1lKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXNwb25zZS5fc291cmNlW25hbWVdID0gZmllbGRNYXBwaW5nLl9kZXNlcmlhbGl6ZShyZXNwb25zZS5fc291cmNlW25hbWVdKTsKICAgICAgICAgICAgICB9KTsgLy8gZ2l2ZSBpbmRleCBwYXR0ZXJuIGFsbCBvZiB0aGUgdmFsdWVzIGluIF9zb3VyY2UKCgogICAgICAgICAgICAgIF9sb2Rhc2guZGVmYXVsdC5hc3NpZ24odGhpcywgcmVzcG9uc2UuX3NvdXJjZSk7CgogICAgICAgICAgICAgIGlmICghdGhpcy50aXRsZSAmJiB0aGlzLmlkKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy5pZDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLmlzVW5zdXBwb3J0ZWRUaW1lUGF0dGVybigpKSB7CiAgICAgICAgICAgICAgICB3YXJuaW5nVGl0bGUgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnZGF0YS5pbmRleFBhdHRlcm5zLndhcm5pbmdUaXRsZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTdXBwb3J0IGZvciB0aW1lIGludGVydmFsIGluZGV4IHBhdHRlcm5zIHJlbW92ZWQnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHdhcm5pbmdUZXh0ID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2RhdGEuaW5kZXhQYXR0ZXJucy53YXJuaW5nVGV4dCcsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDdXJyZW50bHkgcXVlcnlpbmcgYWxsIGluZGljZXMgbWF0Y2hpbmcge2luZGV4fS4ge3RpdGxlfSBzaG91bGQgYmUgbWlncmF0ZWQgdG8gYSB3aWxkY2FyZC1iYXNlZCBpbmRleCBwYXR0ZXJuLicsCiAgICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRpdGxlLAogICAgICAgICAgICAgICAgICAgIGluZGV4OiB0aGlzLmdldEluZGV4KCkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7IC8vIGtiblVybCB3YXMgYWRkZWQgdG8gdGhpcyBzZXJ2aWNlIGluICMzNTI2MiBiZWZvcmUgaXQgd2FzIGRlLWFuZ3VsYXJpemVkLCBhbmQgbWVyZ2VkIGluIGEgUFIKICAgICAgICAgICAgICAgIC8vIGRpcmVjdGx5IGFnYWluc3QgdGhlIDcueCBicmFuY2guIEluZGV4IHBhdHRlcm5zIHdlcmUgZGUtYW5ndWxhcml6ZWQgaW4gIzM5MjQ3LCBhbmQgaW4gb3JkZXIKICAgICAgICAgICAgICAgIC8vIHRvIHByZXNlcnZlIHRoZSBmdW5jdGlvbmFsaXR5IGZyb20gIzM1MjYyIHdlIG5lZWQgdG8gZ2V0IHRoZSBpbmplY3RvciBoZXJlIGp1c3QgZm9yIGtiblVybC4KICAgICAgICAgICAgICAgIC8vIFRoaXMgaGFzIGFsbCBiZWVuIHJlbW92ZWQgYXMgb2YgOC4wLgogICAgICAgICAgICAgICAgLy8gMjAxOS0xMi0wMSBUaGUgdXNhZ2Ugb2Yga2JuVXJsIGhhZCB0byBiZSByZW1vdmVkIGR1ZSB0byB0aGUgdHJhbnNpdGlvbiB0byBOUC4KICAgICAgICAgICAgICAgIC8vIEl0J3Mgbm93IHRlbXBvcmFyaWx5IHJlcGxhY2VkIGJ5IGEgc2ltcGxlIHJlcGxhY2Ugb2YgdGhlIHNpbmdsZSBhcmd1bWVudCB1c2VkIGJ5IGFsbCBVUkxzLgogICAgICAgICAgICAgICAgLy8gT25jZSBrYm5VcmwgaXMgbWlncmF0ZWQgdG8gTlAsIHRoaXMgY2FuIGJlIHVwZGF0ZWQuCgogICAgICAgICAgICAgICAgZWRpdFVybFRlbXBsYXRlID0gKDAsIF91dGlscy5nZXRSb3V0ZXMpKCkuZWRpdDsKICAgICAgICAgICAgICAgIGVkaXRVcmwgPSAnL2FwcC9raWJhbmEjJyArIGVkaXRVcmxUZW1wbGF0ZS5yZXBsYWNlKCd7e2lkfX0nLCB0aGlzLmlkKTsKICAgICAgICAgICAgICAgIF9nZXROb3RpZmljYXRpb25zID0gKDAsIF9zZXJ2aWNlcy5nZXROb3RpZmljYXRpb25zKSgpLCB0b2FzdHMgPSBfZ2V0Tm90aWZpY2F0aW9ucy50b2FzdHM7CiAgICAgICAgICAgICAgICB0b2FzdHMuYWRkV2FybmluZyh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiB3YXJuaW5nVGl0bGUsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICgwLCBfcHVibGljMi50b01vdW50UG9pbnQpKF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIHdhcm5pbmdUZXh0KSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICAgICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogImZsZXhFbmQiLAogICAgICAgICAgICAgICAgICAgIGd1dHRlclNpemU6ICJzIgogICAgICAgICAgICAgICAgICB9LCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICAgICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICAgICAgICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICAgICAgICAgICAgICBzaXplOiAicyIsCiAgICAgICAgICAgICAgICAgICAgaHJlZjogKDAsIF9zZXJ2aWNlcy5nZXRIdHRwKSgpLmJhc2VQYXRoLnByZXBlbmQoZWRpdFVybCkKICAgICAgICAgICAgICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICAgICAgICBpZDogImRhdGEuaW5kZXhQYXR0ZXJucy5lZGl0SW5kZXhQYXR0ZXJuIiwKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkVkaXQgaW5kZXggcGF0dGVybiIKICAgICAgICAgICAgICAgICAgfSkpKSkpKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdGhpcy5pbmRleEZpZWxkcyhmb3JjZUZpZWxkUmVmcmVzaCkpOwoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Q29tcHV0ZWRGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbXB1dGVkRmllbGRzKCkgewogICAgICB2YXIgc2NyaXB0RmllbGRzID0ge307CgogICAgICBpZiAoIXRoaXMuZmllbGRzKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHN0b3JlZEZpZWxkczogWycqJ10sCiAgICAgICAgICBzY3JpcHRGaWVsZHM6IHNjcmlwdEZpZWxkcywKICAgICAgICAgIGRvY3ZhbHVlRmllbGRzOiBbXQogICAgICAgIH07CiAgICAgIH0gLy8gRGF0ZSB2YWx1ZSByZXR1cm5lZCBpbiAiX3NvdXJjZSIgY291bGQgYmUgaW4gYW55IG51bWJlciBvZiBmb3JtYXRzCiAgICAgIC8vIFVzZSBhIGRvY3ZhbHVlIGZvciBlYWNoIGRhdGUgZmllbGQgdG8gZW5zdXJlIHN0YW5kYXJkaXplZCBmb3JtYXRzIHdoZW4gd29ya2luZyB3aXRoIGRhdGUgZmllbGRzCiAgICAgIC8vIGluZGV4UGF0dGVybi5mbGF0dGVuSGl0IHdpbGwgb3ZlcnJpZGUgIl9zb3VyY2UiIHZhbHVlcyB3aGVuIHRoZSBzYW1lIGZpZWxkIGlzIGFsc28gZGVmaW5lZCBpbiAiZmllbGRzIgoKCiAgICAgIHZhciBkb2N2YWx1ZUZpZWxkcyA9ICgwLCBfbG9kYXNoLnJlamVjdCkodGhpcy5maWVsZHMuZ2V0QnlUeXBlKCdkYXRlJyksICdzY3JpcHRlZCcpLm1hcChmdW5jdGlvbiAoZGF0ZUZpZWxkKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGZpZWxkOiBkYXRlRmllbGQubmFtZSwKICAgICAgICAgIGZvcm1hdDogZGF0ZUZpZWxkLmVzVHlwZXMgJiYgZGF0ZUZpZWxkLmVzVHlwZXMuaW5kZXhPZignZGF0ZV9uYW5vcycpICE9PSAtMSA/ICdzdHJpY3RfZGF0ZV90aW1lJyA6ICdkYXRlX3RpbWUnCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgICgwLCBfbG9kYXNoLmVhY2gpKHRoaXMuZ2V0U2NyaXB0ZWRGaWVsZHMoKSwgZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgc2NyaXB0RmllbGRzW2ZpZWxkLm5hbWVdID0gewogICAgICAgICAgc2NyaXB0OiB7CiAgICAgICAgICAgIHNvdXJjZTogZmllbGQuc2NyaXB0LAogICAgICAgICAgICBsYW5nOiBmaWVsZC5sYW5nCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3RvcmVkRmllbGRzOiBbJyonXSwKICAgICAgICBzY3JpcHRGaWVsZHM6IHNjcmlwdEZpZWxkcywKICAgICAgICBkb2N2YWx1ZUZpZWxkczogZG9jdmFsdWVGaWVsZHMKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpbml0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KCkgewogICAgICB2YXIgZm9yY2VGaWVsZFJlZnJlc2gsCiAgICAgICAgICBzYXZlZE9iamVjdCwKICAgICAgICAgIHJlc3BvbnNlLAogICAgICAgICAgX2FyZ3MzID0gYXJndW1lbnRzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGluaXQkKF9jb250ZXh0MykgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZvcmNlRmllbGRSZWZyZXNoID0gX2FyZ3MzLmxlbmd0aCA+IDAgJiYgX2FyZ3MzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczNbMF0gOiBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuaWQpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHRoaXMpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuc2F2ZWRPYmplY3RzQ2xpZW50LmdldCh0eXBlLCB0aGlzLmlkKSk7CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgc2F2ZWRPYmplY3QgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICB0aGlzLnZlcnNpb24gPSBzYXZlZE9iamVjdC5fdmVyc2lvbjsKICAgICAgICAgICAgICByZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgIF9pZDogc2F2ZWRPYmplY3QuaWQsCiAgICAgICAgICAgICAgICBfdHlwZTogc2F2ZWRPYmplY3QudHlwZSwKICAgICAgICAgICAgICAgIF9zb3VyY2U6IF9sb2Rhc2guZGVmYXVsdC5jbG9uZURlZXAoc2F2ZWRPYmplY3QuYXR0cmlidXRlcyksCiAgICAgICAgICAgICAgICBmb3VuZDogc2F2ZWRPYmplY3QuX3ZlcnNpb24gPyB0cnVlIDogZmFsc2UKICAgICAgICAgICAgICB9OyAvLyBEbyB0aGlzIGJlZm9yZSB3ZSBhdHRlbXB0IHRvIHVwZGF0ZSBmcm9tIEVTIHNpbmNlIHRoYXQgY2FsbCBjYW4gcG90ZW50aWFsbHkgcGVyZm9ybSBhIHNhdmUKCiAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEJvZHkgPSB0aGlzLnByZXBCb2R5KCk7CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMudXBkYXRlRnJvbUVsYXN0aWNTZWFyY2gocmVzcG9uc2UsIGZvcmNlRmllbGRSZWZyZXNoKSk7CgogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIC8vIERvIGl0IGFmdGVyIHRvIGVuc3VyZSB3ZSBoYXZlIHRoZSBtb3N0IHVwIHRvIGRhdGUgaW5mb3JtYXRpb24KICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsQm9keSA9IHRoaXMucHJlcEJvZHkoKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgdGhpcyk7CgogICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAibWlncmF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbWlncmF0ZShuZXdUaXRsZSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiB0aGlzLnNhdmVkT2JqZWN0c0NsaWVudC51cGRhdGUodHlwZSwgdGhpcy5pZCwgewogICAgICAgIHRpdGxlOiBuZXdUaXRsZSwKICAgICAgICBpbnRlcnZhbE5hbWU6IG51bGwKICAgICAgfSkudGhlbihmdW5jdGlvbiAoX3JlZikgewogICAgICAgIHZhciBfcmVmJGF0dHJpYnV0ZXMgPSBfcmVmLmF0dHJpYnV0ZXMsCiAgICAgICAgICAgIHRpdGxlID0gX3JlZiRhdHRyaWJ1dGVzLnRpdGxlLAogICAgICAgICAgICBpbnRlcnZhbE5hbWUgPSBfcmVmJGF0dHJpYnV0ZXMuaW50ZXJ2YWxOYW1lOwogICAgICAgIF90aGlzMi50aXRsZSA9IHRpdGxlOwogICAgICAgIF90aGlzMi5pbnRlcnZhbE5hbWUgPSBpbnRlcnZhbE5hbWU7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczI7CiAgICAgIH0pOwogICAgfSAvLyBHZXQgdGhlIHNvdXJjZSBmaWx0ZXJpbmcgY29uZmlndXJhdGlvbiBmb3IgdGhhdCBpbmRleC4KCiAgfSwgewogICAga2V5OiAiZ2V0U291cmNlRmlsdGVyaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTb3VyY2VGaWx0ZXJpbmcoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgZXhjbHVkZXM6IHRoaXMuc291cmNlRmlsdGVycyAmJiB0aGlzLnNvdXJjZUZpbHRlcnMubWFwKGZ1bmN0aW9uIChmaWx0ZXIpIHsKICAgICAgICAgIHJldHVybiBmaWx0ZXIudmFsdWU7CiAgICAgICAgfSkgfHwgW10KICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGRTY3JpcHRlZEZpZWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRTY3JpcHRlZEZpZWxkKG5hbWUsIHNjcmlwdCkgewogICAgICB2YXIgZmllbGRUeXBlLAogICAgICAgICAgbGFuZywKICAgICAgICAgIHNjcmlwdGVkRmllbGRzLAogICAgICAgICAgbmFtZXMsCiAgICAgICAgICBfYXJnczQgPSBhcmd1bWVudHM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gYWRkU2NyaXB0ZWRGaWVsZCQoX2NvbnRleHQ0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZmllbGRUeXBlID0gX2FyZ3M0Lmxlbmd0aCA+IDIgJiYgX2FyZ3M0WzJdICE9PSB1bmRlZmluZWQgPyBfYXJnczRbMl0gOiAnc3RyaW5nJzsKICAgICAgICAgICAgICBsYW5nID0gX2FyZ3M0Lmxlbmd0aCA+IDMgPyBfYXJnczRbM10gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgc2NyaXB0ZWRGaWVsZHMgPSB0aGlzLmdldFNjcmlwdGVkRmllbGRzKCk7CiAgICAgICAgICAgICAgbmFtZXMgPSBfbG9kYXNoLmRlZmF1bHQucGx1Y2soc2NyaXB0ZWRGaWVsZHMsICduYW1lJyk7CgogICAgICAgICAgICAgIGlmICghX2xvZGFzaC5kZWZhdWx0LmNvbnRhaW5zKG5hbWVzLCBuYW1lKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3B1YmxpYy5EdXBsaWNhdGVGaWVsZChuYW1lKTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICB0aGlzLmZpZWxkcy5hZGQobmV3IF9maWVsZHMuRmllbGQodGhpcywgewogICAgICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgICAgIHNjcmlwdDogc2NyaXB0LAogICAgICAgICAgICAgICAgZmllbGRUeXBlOiBmaWVsZFR5cGUsCiAgICAgICAgICAgICAgICBzY3JpcHRlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIGxhbmc6IGxhbmcsCiAgICAgICAgICAgICAgICBhZ2dyZWdhdGFibGU6IHRydWUsCiAgICAgICAgICAgICAgICBmaWx0ZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgc2VhcmNoYWJsZTogdHJ1ZQogICAgICAgICAgICAgIH0sIGZhbHNlKSk7CiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA5OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGhpcy5zYXZlKCkpOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlU2NyaXB0ZWRGaWVsZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlU2NyaXB0ZWRGaWVsZChmaWVsZCkgewogICAgICB0aGlzLmZpZWxkcy5yZW1vdmUoZmllbGQpOwogICAgICByZXR1cm4gdGhpcy5zYXZlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicG9wdWxhcml6ZUZpZWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwb3B1bGFyaXplRmllbGQoZmllbGROYW1lKSB7CiAgICAgIHZhciB1bml0LAogICAgICAgICAgZmllbGQsCiAgICAgICAgICBjb3VudCwKICAgICAgICAgIF9hcmdzNSA9IGFyZ3VtZW50czsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBwb3B1bGFyaXplRmllbGQkKF9jb250ZXh0NSkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHVuaXQgPSBfYXJnczUubGVuZ3RoID4gMSAmJiBfYXJnczVbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzNVsxXSA6IDE7CiAgICAgICAgICAgICAgZmllbGQgPSB0aGlzLmZpZWxkcy5nZXRCeU5hbWUoZmllbGROYW1lKTsKCiAgICAgICAgICAgICAgaWYgKGZpZWxkKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjb3VudCA9IE1hdGgubWF4KChmaWVsZC5jb3VudCB8fCAwKSArIHVuaXQsIDApOwoKICAgICAgICAgICAgICBpZiAoIShmaWVsZC5jb3VudCA9PT0gY291bnQpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBmaWVsZC5jb3VudCA9IGNvdW50OwogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLnNhdmUoKSk7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Tm9uU2NyaXB0ZWRGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE5vblNjcmlwdGVkRmllbGRzKCkgewogICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LndoZXJlKHRoaXMuZmllbGRzLCB7CiAgICAgICAgc2NyaXB0ZWQ6IGZhbHNlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFNjcmlwdGVkRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTY3JpcHRlZEZpZWxkcygpIHsKICAgICAgcmV0dXJuIF9sb2Rhc2guZGVmYXVsdC53aGVyZSh0aGlzLmZpZWxkcywgewogICAgICAgIHNjcmlwdGVkOiB0cnVlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEluZGV4IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbmRleCgpIHsKICAgICAgaWYgKCF0aGlzLmlzVW5zdXBwb3J0ZWRUaW1lUGF0dGVybigpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGl0bGU7CiAgICAgIH0gLy8gVGFrZSBhIHRpbWUtYmFzZWQgaW50ZXJ2YWwgaW5kZXggcGF0dGVybiB0aXRsZSAobGlrZSBbZm9vLV1ZWVlZLk1NLkREWy1iYXJdKSBhbmQgdHVybiBpdAogICAgICAvLyBpbnRvIHRoZSBhY3R1YWwgaW5kZXggKGxpa2UgZm9vLSotYmFyKSBieSByZXBsYWNpbmcgYW55dGhpbmcgbm90IGluc2lkZSBzcXVhcmUgYnJhY2tldHMKICAgICAgLy8gd2l0aCBhICouCgoKICAgICAgdmFyIHJlZ2V4ID0gL1xbW15cXV0qXS9nOyAvLyBNYXRjaGVzIHRleHQgaW5zaWRlIGJyYWNrZXRzCgogICAgICB2YXIgc3BsaXRzID0gdGhpcy50aXRsZS5zcGxpdChyZWdleCk7IC8vIGUuZy4gWycnLCAnWVlZWS5NTS5ERCcsICcnXSBmcm9tIHRoZSBhYm92ZSBleGFtcGxlCgogICAgICB2YXIgbWF0Y2hlcyA9IHRoaXMudGl0bGUubWF0Y2gocmVnZXgpIHx8IFtdOyAvLyBlLmcuIFsnW2Zvby1dJywgJ1stYmFyXSddIGZyb20gdGhlIGFib3ZlIGV4YW1wbGUKCiAgICAgIHJldHVybiBzcGxpdHMubWFwKGZ1bmN0aW9uIChzcGxpdCwgaSkgewogICAgICAgIHZhciBtYXRjaCA9IGkgPj0gbWF0Y2hlcy5sZW5ndGggPyAnJyA6IG1hdGNoZXNbaV0ucmVwbGFjZSgvW1xbXF1dL2csICcnKTsKICAgICAgICByZXR1cm4gIiIuY29uY2F0KHNwbGl0Lmxlbmd0aCA/ICcqJyA6ICcnKS5jb25jYXQobWF0Y2gpOwogICAgICB9KS5qb2luKCcnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1Vuc3VwcG9ydGVkVGltZVBhdHRlcm4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVW5zdXBwb3J0ZWRUaW1lUGF0dGVybigpIHsKICAgICAgcmV0dXJuICEhdGhpcy5pbnRlcnZhbE5hbWU7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNUaW1lQmFzZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVGltZUJhc2VkKCkgewogICAgICByZXR1cm4gISF0aGlzLnRpbWVGaWVsZE5hbWUgJiYgKCF0aGlzLmZpZWxkcyB8fCAhIXRoaXMuZ2V0VGltZUZpZWxkKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogImlzVGltZU5hbm9zQmFzZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVGltZU5hbm9zQmFzZWQoKSB7CiAgICAgIHZhciB0aW1lRmllbGQgPSB0aGlzLmdldFRpbWVGaWVsZCgpOwogICAgICByZXR1cm4gdGltZUZpZWxkICYmIHRpbWVGaWVsZC5lc1R5cGVzICYmIHRpbWVGaWVsZC5lc1R5cGVzLmluZGV4T2YoJ2RhdGVfbmFub3MnKSAhPT0gLTE7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNUaW1lQmFzZWRXaWxkY2FyZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNUaW1lQmFzZWRXaWxkY2FyZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNUaW1lQmFzZWQoKSAmJiB0aGlzLmlzV2lsZGNhcmQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRUaW1lRmllbGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRpbWVGaWVsZCgpIHsKICAgICAgaWYgKCF0aGlzLnRpbWVGaWVsZE5hbWUgfHwgIXRoaXMuZmllbGRzIHx8ICF0aGlzLmZpZWxkcy5nZXRCeU5hbWUpIHJldHVybjsKICAgICAgcmV0dXJuIHRoaXMuZmllbGRzLmdldEJ5TmFtZSh0aGlzLnRpbWVGaWVsZE5hbWUpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEZpZWxkQnlOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZEJ5TmFtZShuYW1lKSB7CiAgICAgIGlmICghdGhpcy5maWVsZHMgfHwgIXRoaXMuZmllbGRzLmdldEJ5TmFtZSkgcmV0dXJuOwogICAgICByZXR1cm4gdGhpcy5maWVsZHMuZ2V0QnlOYW1lKG5hbWUpOwogICAgfQogIH0sIHsKICAgIGtleTogImlzV2lsZGNhcmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzV2lsZGNhcmQoKSB7CiAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuaW5jbHVkZXModGhpcy50aXRsZSwgJyonKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwcmVwQm9keSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlcEJvZHkoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGJvZHkgPSB7fTsgLy8gc2VyaWFsaXplIGpzb24gZmllbGRzCgogICAgICBfbG9kYXNoLmRlZmF1bHQuZm9yT3duKHRoaXMubWFwcGluZywgZnVuY3Rpb24gKGZpZWxkTWFwcGluZywgZmllbGROYW1lKSB7CiAgICAgICAgaWYgKCFmaWVsZE5hbWUgfHwgX3RoaXMzW2ZpZWxkTmFtZV0gPT0gbnVsbCkgcmV0dXJuOwogICAgICAgIGJvZHlbZmllbGROYW1lXSA9IGZpZWxkTWFwcGluZy5fc2VyaWFsaXplID8gZmllbGRNYXBwaW5nLl9zZXJpYWxpemUoX3RoaXMzW2ZpZWxkTmFtZV0pIDogX3RoaXMzW2ZpZWxkTmFtZV07CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGJvZHk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIGFsbG93T3ZlcnJpZGUsCiAgICAgICAgICBfY3JlYXRlLAogICAgICAgICAgcG90ZW50aWFsRHVwbGljYXRlQnlUaXRsZSwKICAgICAgICAgIF9hcmdzNyA9IGFyZ3VtZW50czsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gY3JlYXRlJChfY29udGV4dDcpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBhbGxvd092ZXJyaWRlID0gX2FyZ3M3Lmxlbmd0aCA+IDAgJiYgX2FyZ3M3WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczdbMF0gOiBmYWxzZTsKCiAgICAgICAgICAgICAgX2NyZWF0ZSA9IGZ1bmN0aW9uIF9jcmVhdGUoZHVwbGljYXRlSWQpIHsKICAgICAgICAgICAgICAgIHZhciBkdXBsaWNhdGVQYXR0ZXJuLCBib2R5LCByZXNwb25zZTsKICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NyZWF0ZSQoX2NvbnRleHQ2KSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZHVwbGljYXRlSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cGxpY2F0ZVBhdHRlcm4gPSBuZXcgSW5kZXhQYXR0ZXJuKGR1cGxpY2F0ZUlkLCBfdGhpczQuZ2V0Q29uZmlnLCBfdGhpczQuc2F2ZWRPYmplY3RzQ2xpZW50LCBfdGhpczQucGF0dGVybkNhY2hlLCBfdGhpczQuZmllbGRzRmV0Y2hlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkdXBsaWNhdGVQYXR0ZXJuLmRlc3Ryb3koKSk7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICBib2R5ID0gX3RoaXM0LnByZXBCb2R5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpczQuc2F2ZWRPYmplY3RzQ2xpZW50LmNyZWF0ZSh0eXBlLCBib2R5LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IF90aGlzNC5pZAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczQuaWQgPSByZXNwb25zZS5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlLmlkKTsKCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX3V0aWxzLmZpbmRCeVRpdGxlKSh0aGlzLnNhdmVkT2JqZWN0c0NsaWVudCwgdGhpcy50aXRsZSkpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHBvdGVudGlhbER1cGxpY2F0ZUJ5VGl0bGUgPSBfY29udGV4dDcuc2VudDsKCiAgICAgICAgICAgICAgaWYgKHBvdGVudGlhbER1cGxpY2F0ZUJ5VGl0bGUpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSA4OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX2NyZWF0ZSgpKTsKCiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ3LnNlbnQpOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGlmIChhbGxvd092ZXJyaWRlKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDExOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgZmFsc2UpOwoKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDEzOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX2NyZWF0ZShwb3RlbnRpYWxEdXBsaWNhdGVCeVRpdGxlLmlkKSk7CgogICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDcuc2VudCk7CgogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2F2ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2F2ZSgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgc2F2ZUF0dGVtcHRzLAogICAgICAgICAgYm9keSwKICAgICAgICAgIG9yaWdpbmFsQ2hhbmdlZEtleXMsCiAgICAgICAgICBfYXJnczggPSBhcmd1bWVudHM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gc2F2ZSQoX2NvbnRleHQ4KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgc2F2ZUF0dGVtcHRzID0gX2FyZ3M4Lmxlbmd0aCA+IDAgJiYgX2FyZ3M4WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczhbMF0gOiAwOwoKICAgICAgICAgICAgICBpZiAodGhpcy5pZCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgYm9keSA9IHRoaXMucHJlcEJvZHkoKTsgLy8gV2hhdCBrZXlzIGNoYW5nZWQgc2luY2UgdGhleSBsYXN0IHB1bGxlZCB0aGUgaW5kZXggcGF0dGVybgoKICAgICAgICAgICAgICBvcmlnaW5hbENoYW5nZWRLZXlzID0gT2JqZWN0LmtleXMoYm9keSkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBib2R5W2tleV0gIT09IF90aGlzNS5vcmlnaW5hbEJvZHlba2V5XTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgdGhpcy5zYXZlZE9iamVjdHNDbGllbnQudXBkYXRlKHR5cGUsIHRoaXMuaWQsIGJvZHksIHsKICAgICAgICAgICAgICAgIHZlcnNpb246IHRoaXMudmVyc2lvbgogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgICAgICAgIF90aGlzNS5pZCA9IHJlc3AuaWQ7CiAgICAgICAgICAgICAgICBfdGhpczUudmVyc2lvbiA9IHJlc3AuX3ZlcnNpb247CiAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5nZXQoZXJyLCAncmVzLnN0YXR1cycpID09PSA0MDkgJiYgc2F2ZUF0dGVtcHRzKysgPCBNQVhfQVRURU1QVFNfVE9fUkVTT0xWRV9DT05GTElDVFMpIHsKICAgICAgICAgICAgICAgICAgdmFyIHNhbWVQYXR0ZXJuID0gbmV3IEluZGV4UGF0dGVybihfdGhpczUuaWQsIF90aGlzNS5nZXRDb25maWcsIF90aGlzNS5zYXZlZE9iamVjdHNDbGllbnQsIF90aGlzNS5wYXR0ZXJuQ2FjaGUsIF90aGlzNS5maWVsZHNGZXRjaGVyKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHNhbWVQYXR0ZXJuLmluaXQoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBXaGF0IGtleXMgY2hhbmdlZCBmcm9tIG5vdyBhbmQgd2hhdCB0aGUgc2VydmVyIHJldHVybmVkCiAgICAgICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWRCb2R5ID0gc2FtZVBhdHRlcm4ucHJlcEJvZHkoKTsgLy8gQnVpbGQgYSBsaXN0IG9mIGNoYW5nZWQga2V5cyBmcm9tIHRoZSBzZXJ2ZXIgcmVzcG9uc2UKICAgICAgICAgICAgICAgICAgICAvLyBhbmQgZW5zdXJlIHdlIGlnbm9yZSB0aGUga2V5IGlmIHRoZSBzZXJ2ZXIgcmVzcG9uc2UKICAgICAgICAgICAgICAgICAgICAvLyBpcyB0aGUgc2FtZSBhcyB0aGUgb3JpZ2luYWwgcmVzcG9uc2UgKHNpbmNlIHRoYXQgaXMgZXhwZWN0ZWQKICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBtYWRlIGEgY2hhbmdlIGluIHRoYXQga2V5KQoKICAgICAgICAgICAgICAgICAgICB2YXIgc2VydmVyQ2hhbmdlZEtleXMgPSBPYmplY3Qua2V5cyh1cGRhdGVkQm9keSkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVkQm9keVtrZXldICE9PSBib2R5W2tleV0gJiYgX3RoaXM1Lm9yaWdpbmFsQm9keVtrZXldICE9PSB1cGRhdGVkQm9keVtrZXldOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciB1bnJlc29sdmVkQ29sbGlzaW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvciA9IHVuZGVmaW5lZDsKCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvciA9IG9yaWdpbmFsQ2hhbmdlZEtleXNbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW5hbEtleSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfaXRlcmF0b3JFcnJvcjIgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSBzZXJ2ZXJDaGFuZ2VkS2V5c1tTeW1ib2wuaXRlcmF0b3JdKCksIF9zdGVwMjsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiA9IChfc3RlcDIgPSBfaXRlcmF0b3IyLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcnZlcktleSA9IF9zdGVwMi52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxLZXkgPT09IHNlcnZlcktleSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnJlc29sdmVkQ29sbGlzaW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvcjIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yMiA9IGVycjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiAmJiBfaXRlcmF0b3IyLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjIucmV0dXJuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcjIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3IyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBlcnI7CiAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3IucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IucmV0dXJuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodW5yZXNvbHZlZENvbGxpc2lvbikgewogICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnZGF0YS5pbmRleFBhdHRlcm5zLnVuYWJsZVdyaXRlTGFiZWwnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5hYmxlIHRvIHdyaXRlIGluZGV4IHBhdHRlcm4hIFJlZnJlc2ggdGhlIHBhZ2UgdG8gZ2V0IHRoZSBtb3N0IHVwIHRvIGRhdGUgY2hhbmdlcyBmb3IgdGhpcyBpbmRleCBwYXR0ZXJuLicKICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgIHZhciBfZ2V0Tm90aWZpY2F0aW9uczIgPSAoMCwgX3NlcnZpY2VzLmdldE5vdGlmaWNhdGlvbnMpKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RvYXN0cyA9IF9nZXROb3RpZmljYXRpb25zMi50b2FzdHM7CgogICAgICAgICAgICAgICAgICAgICAgX3RvYXN0cy5hZGREYW5nZXIobWVzc2FnZSk7CgogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAgICAgIH0gLy8gU2V0IHRoZSB1cGRhdGVkIHJlc3BvbnNlIG9uIHRoaXMgb2JqZWN0CgoKICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJDaGFuZ2VkS2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgIF90aGlzNVtrZXldID0gc2FtZVBhdHRlcm5ba2V5XTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBfdGhpczUudmVyc2lvbiA9IHNhbWVQYXR0ZXJuLnZlcnNpb247IC8vIENsZWFyIGNhY2hlCgogICAgICAgICAgICAgICAgICAgIF90aGlzNS5wYXR0ZXJuQ2FjaGUuY2xlYXIoX3RoaXM1LmlkKTsgLy8gVHJ5IHRoZSBzYXZlIGFnYWluCgoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM1LnNhdmUoc2F2ZUF0dGVtcHRzKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9mZXRjaEZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZldGNoRmllbGRzKCkgewogICAgICB2YXIgZmllbGRzLCBzY3JpcHRlZCwgYWxsOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9mZXRjaEZpZWxkcyQoX2NvbnRleHQ5KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGhpcy5maWVsZHNGZXRjaGVyLmZldGNoKHRoaXMpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBmaWVsZHMgPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICBzY3JpcHRlZCA9IHRoaXMuZ2V0U2NyaXB0ZWRGaWVsZHMoKTsKICAgICAgICAgICAgICBhbGwgPSBmaWVsZHMuY29uY2F0KHNjcmlwdGVkKTsKICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDc7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLmluaXRGaWVsZHMoYWxsKSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZWZyZXNoRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoRmllbGRzKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHJldHVybiB0aGlzLl9mZXRjaEZpZWxkcygpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczYuc2F2ZSgpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2VsYXN0aWMva2liYW5hL2lzc3Vlcy85MjI0CiAgICAgICAgLy8gVGhpcyBjYWxsIHdpbGwgYXR0ZW1wdCB0byByZW1hcCBmaWVsZHMgZnJvbSB0aGUgbWF0Y2hpbmcKICAgICAgICAvLyBFUyBpbmRleCB3aGljaCBtYXkgbm90IGFjdHVhbGx5IGV4aXN0LiBJbiB0aGF0IHNjZW5hcmlvLAogICAgICAgIC8vIHdlIHN0aWxsIHdhbnQgdG8gbm90aWZ5IHRoZSB1c2VyIHRoYXQgdGhlcmUgaXMgYSBwcm9ibGVtCiAgICAgICAgLy8gYnV0IHdlIGRvIG5vdCB3YW50IHRvIHBvdGVudGlhbGx5IG1ha2UgYW55IHBhZ2VzIHVudXNhYmxlCiAgICAgICAgLy8gc28gZG8gbm90IHJldGhyb3cgdGhlIGVycm9yIGhlcmUKICAgICAgICB2YXIgX2dldE5vdGlmaWNhdGlvbnMzID0gKDAsIF9zZXJ2aWNlcy5nZXROb3RpZmljYXRpb25zKSgpLAogICAgICAgICAgICB0b2FzdHMgPSBfZ2V0Tm90aWZpY2F0aW9uczMudG9hc3RzOwoKICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgXzIuaW5kZXhQYXR0ZXJucy5JbmRleFBhdHRlcm5NaXNzaW5nSW5kaWNlcykgewogICAgICAgICAgdG9hc3RzLmFkZERhbmdlcihlcnIubWVzc2FnZSk7CiAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQoKICAgICAgICB0b2FzdHMuYWRkRXJyb3IoZXJyLCB7CiAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2RhdGEuaW5kZXhQYXR0ZXJucy5mZXRjaEZpZWxkRXJyb3JUaXRsZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFcnJvciBmZXRjaGluZyBmaWVsZHMgZm9yIGluZGV4IHBhdHRlcm4ge3RpdGxlfSAoSUQ6IHtpZH0pJywKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgaWQ6IF90aGlzNi5pZCwKICAgICAgICAgICAgICB0aXRsZTogX3RoaXM2LnRpdGxlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInRvSlNPTiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9KU09OKCkgewogICAgICByZXR1cm4gdGhpcy5pZDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0b1N0cmluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiAnJyArIHRoaXMudG9KU09OKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgdGhpcy5wYXR0ZXJuQ2FjaGUuY2xlYXIodGhpcy5pZCk7CgogICAgICBpZiAodGhpcy5pZCkgewogICAgICAgIHJldHVybiB0aGlzLnNhdmVkT2JqZWN0c0NsaWVudC5kZWxldGUodHlwZSwgdGhpcy5pZCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyb3V0ZXMiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWxzLmdldFJvdXRlcykoKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBJbmRleFBhdHRlcm47Cn0oKTsKCmV4cG9ydHMuSW5kZXhQYXR0ZXJuID0gSW5kZXhQYXR0ZXJuOw=="},null]}