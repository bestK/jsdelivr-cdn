{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/vis_type_vega/public/data_model/vega_parser.js","dependencies":[{"path":"src/legacy/core_plugins/vis_type_vega/public/data_model/vega_parser.js","mtime":1585205040487},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlZlZ2FQYXJzZXIgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIHZlZ2EgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJ2ZWdhLWxpYiIpKTsKCnZhciB2ZWdhTGl0ZSA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInZlZ2EtbGl0ZSIpKTsKCnZhciBfdmVnYVNjaGVtYVVybFBhcnNlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidmVnYS1zY2hlbWEtdXJsLXBhcnNlciIpKTsKCnZhciBfY29tcGFyZVZlcnNpb25zID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJjb21wYXJlLXZlcnNpb25zIikpOwoKdmFyIF9lc19xdWVyeV9wYXJzZXIgPSByZXF1aXJlKCIuL2VzX3F1ZXJ5X3BhcnNlciIpOwoKdmFyIF9oanNvbiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiaGpzb24iKSk7Cgp2YXIgX3V0aWxzID0gcmVxdWlyZSgiLi91dGlscyIpOwoKdmFyIF9lbXNfZmlsZV9wYXJzZXIgPSByZXF1aXJlKCIuL2Vtc19maWxlX3BhcnNlciIpOwoKdmFyIF91cmxfcGFyc2VyID0gcmVxdWlyZSgiLi91cmxfcGFyc2VyIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKLy8gU2V0IGRlZmF1bHQgc2luZ2xlIGNvbG9yIHRvIG1hdGNoIG90aGVyIEtpYmFuYSB2aXN1YWxpemF0aW9ucwp2YXIgZGVmYXVsdENvbG9yID0gX2V1aS5WSVNVQUxJWkFUSU9OX0NPTE9SU1swXTsKdmFyIERFRkFVTFRfU0NIRU1BID0gJ2h0dHBzOi8vdmVnYS5naXRodWIuaW8vc2NoZW1hL3ZlZ2EvdjMuMC5qc29uJzsKdmFyIGxvY1RvRGlyTWFwID0gewogIGxlZnQ6ICdyb3ctcmV2ZXJzZScsCiAgcmlnaHQ6ICdyb3cnLAogIHRvcDogJ2NvbHVtbi1yZXZlcnNlJywKICBib3R0b206ICdjb2x1bW4nCn07IC8vIElmIHRoZXJlIGlzIG5vICIldHlwZSUiIHBhcmFtZXRlciwgdXNlIHRoaXMgcGFyc2VyCgp2YXIgREVGQVVMVF9QQVJTRVIgPSAnZWxhc3RpY3NlYXJjaCc7Cgp2YXIgVmVnYVBhcnNlciA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFZlZ2FQYXJzZXIoc3BlYywgc2VhcmNoQ2FjaGUsIHRpbWVDYWNoZSwgZmlsdGVycywgc2VydmljZVNldHRpbmdzKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmVnYVBhcnNlcik7CgogICAgdGhpcy5zcGVjID0gc3BlYzsKICAgIHRoaXMuaGlkZVdhcm5pbmdzID0gZmFsc2U7CiAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkOwogICAgdGhpcy53YXJuaW5ncyA9IFtdOwoKICAgIHZhciBvbldhcm4gPSB0aGlzLl9vbldhcm5pbmcuYmluZCh0aGlzKTsKCiAgICB0aGlzLl91cmxQYXJzZXJzID0gewogICAgICBlbGFzdGljc2VhcmNoOiBuZXcgX2VzX3F1ZXJ5X3BhcnNlci5Fc1F1ZXJ5UGFyc2VyKHRpbWVDYWNoZSwgc2VhcmNoQ2FjaGUsIGZpbHRlcnMsIG9uV2FybiksCiAgICAgIGVtc2ZpbGU6IG5ldyBfZW1zX2ZpbGVfcGFyc2VyLkVtc0ZpbGVQYXJzZXIoc2VydmljZVNldHRpbmdzKSwKICAgICAgdXJsOiBuZXcgX3VybF9wYXJzZXIuVXJsUGFyc2VyKG9uV2FybikKICAgIH07CiAgfQoKICBfY3JlYXRlQ2xhc3MoVmVnYVBhcnNlciwgW3sKICAgIGtleTogInBhcnNlQXN5bmMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlQXN5bmMoKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gcGFyc2VBc3luYyQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDA7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9wYXJzZUFzeW5jKCkpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA4OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA1OwogICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgLy8gaWYgd2UgcmVqZWN0IGN1cnJlbnQgcHJvbWlzZSwgaXQgd2lsbCB1c2UgdGhlIHN0YW5kYXJkIEtpYmFuYSBlcnJvciBoYW5kbGluZwogICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBfdXRpbHMuVXRpbHMuZm9ybWF0RXJyb3JUb1N0cihfY29udGV4dC50MCk7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdGhpcyk7CgogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMsIFtbMCwgNV1dKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcGFyc2VBc3luYyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlQXN5bmMoKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX3BhcnNlQXN5bmMkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGlmICghKHRoaXMuaXNWZWdhTGl0ZSAhPT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuc3BlYyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3BlYyA9IF9oanNvbi5kZWZhdWx0LnBhcnNlKHRoaXMuc3BlYywgewogICAgICAgICAgICAgICAgICBsZWdhY3lSb290OiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmlzUGxhaW5PYmplY3QodGhpcy5zcGVjKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuaW52YWxpZFZlZ2FTcGVjRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdJbnZhbGlkIFZlZ2Egc3BlY2lmaWNhdGlvbicKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgdGhpcy5pc1ZlZ2FMaXRlID0gdGhpcy5fcGFyc2VTY2hlbWEoKTsKICAgICAgICAgICAgICB0aGlzLnVzZUhvdmVyID0gIXRoaXMuaXNWZWdhTGl0ZTsKICAgICAgICAgICAgICB0aGlzLl9jb25maWcgPSB0aGlzLl9wYXJzZUNvbmZpZygpOwogICAgICAgICAgICAgIHRoaXMuaGlkZVdhcm5pbmdzID0gISF0aGlzLl9jb25maWcuaGlkZVdhcm5pbmdzOwogICAgICAgICAgICAgIHRoaXMudXNlTWFwID0gdGhpcy5fY29uZmlnLnR5cGUgPT09ICdtYXAnOwogICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIgPSB0aGlzLl9jb25maWcucmVuZGVyZXIgPT09ICdzdmcnID8gJ3N2ZycgOiAnY2FudmFzJzsKICAgICAgICAgICAgICB0aGlzLnRvb2x0aXBzID0gdGhpcy5fcGFyc2VUb29sdGlwcygpOwoKICAgICAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0Q29sb3JzKCk7CgogICAgICAgICAgICAgIHRoaXMuX3BhcnNlQ29udHJvbFBsYWNlbWVudCh0aGlzLl9jb25maWcpOwoKICAgICAgICAgICAgICBpZiAodGhpcy51c2VNYXApIHsKICAgICAgICAgICAgICAgIHRoaXMubWFwQ29uZmlnID0gdGhpcy5fcGFyc2VNYXBDb25maWcoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3BlYy5hdXRvc2l6ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IGF1dG9zaXplIHNob3VsZCBiZSBmaXQsIHVubGVzcyBpdCdzIGEgbWFwIChsZWFmbGV0LXZlZ2EgaGFuZGxlcyB0aGF0KQogICAgICAgICAgICAgICAgdGhpcy5zcGVjLmF1dG9zaXplID0gewogICAgICAgICAgICAgICAgICB0eXBlOiAnZml0JywKICAgICAgICAgICAgICAgICAgY29udGFpbnM6ICdwYWRkaW5nJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9yZXNvbHZlRGF0YVVybHMoKSk7CgogICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgIGlmICh0aGlzLmlzVmVnYUxpdGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NvbXBpbGVWZWdhTGl0ZSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhpcy5fY2FsY1NpemluZygpOwoKICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IFZlZ2FMaXRlIHRvIFZlZ2Egc3BlYwogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfY29tcGlsZVZlZ2FMaXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY29tcGlsZVZlZ2FMaXRlKCkgewogICAgICB0aGlzLnZsc3BlYyA9IHRoaXMuc3BlYzsKICAgICAgdmFyIGxvZ2dlciA9IHZlZ2EubG9nZ2VyKHZlZ2EuV2Fybik7CiAgICAgIGxvZ2dlci53YXJuID0gdGhpcy5fb25XYXJuaW5nLmJpbmQodGhpcyk7CiAgICAgIHRoaXMuc3BlYyA9IHZlZ2FMaXRlLmNvbXBpbGUodGhpcy52bHNwZWMsIGxvZ2dlcikuc3BlYzsgLy8gV2hlbiB1c2luZyBWTCB3aXRoIHRoZSB0eXBlPW1hcCBhbmQgdXNlciBkaWQgbm90IHByb3ZpZCB0aGVpciBvd24gcHJvamVjdGlvbiBzZXR0aW5ncywKICAgICAgLy8gcmVtb3ZlIHRoZSBkZWZhdWx0IHByb2plY3Rpb24gdGhhdCB3YXMgZ2VuZXJhdGVkIGJ5IFZlZ2FMaXRlIGNvbXBpbGVyLgogICAgICAvLyBUaGlzIHdheSB3ZSBsZXQgbGVhZmxldC12ZWdhIGxpYnJhcnkgaW5qZWN0IGEgZGlmZmVyZW50IGRlZmF1bHQgcHJvamVjdGlvbiBmb3IgdGlsZSBtYXBzLgogICAgICAvLyBBbHNvLCBWTCBpbmplY3RzIGRlZmF1bHQgcGFkZGluZyBhbmQgYXV0b3NpemUgdmFsdWVzLCBidXQgbmVpdGhlciBzaG91bGQgYmUgc2V0IGZvciB2ZWdhLWxlYWZsZXQuCgogICAgICBpZiAodGhpcy51c2VNYXApIHsKICAgICAgICB2YXIgaGFzQ29uZmlnID0gX2xvZGFzaC5kZWZhdWx0LmlzUGxhaW5PYmplY3QodGhpcy52bHNwZWMuY29uZmlnKTsKCiAgICAgICAgaWYgKHRoaXMudmxzcGVjLmNvbmZpZyA9PT0gdW5kZWZpbmVkIHx8IGhhc0NvbmZpZyAmJiAhdGhpcy52bHNwZWMuY29uZmlnLnByb2plY3Rpb24pIHsKICAgICAgICAgIC8vIEFzc3VtZSBWTCBnZW5lcmF0ZXMgc3BlYy5wcm9qZWN0aW9ucyA9IGFuIGFycmF5IG9mIGV4YWN0bHkgb25lIG9iamVjdCBuYW1lZCAncHJvamVjdGlvbicKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLnNwZWMucHJvamVjdGlvbnMpIHx8IHRoaXMuc3BlYy5wcm9qZWN0aW9ucy5sZW5ndGggIT09IDEgfHwgdGhpcy5zcGVjLnByb2plY3Rpb25zWzBdLm5hbWUgIT09ICdwcm9qZWN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuVkxDb21waWxlclNob3VsZEhhdmVHZW5lcmF0ZWRTaW5nbGVQcm90ZWN0aW9uT2JqZWN0RXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnSW50ZXJuYWwgZXJyb3I6IFZlZ2EtTGl0ZSBjb21waWxlciBzaG91bGQgaGF2ZSBnZW5lcmF0ZWQgYSBzaW5nbGUgcHJvamVjdGlvbiBvYmplY3QnCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICBkZWxldGUgdGhpcy5zcGVjLnByb2plY3Rpb25zOwogICAgICAgIH0gLy8gdG9kbzogc2l6aW5nIGNsZWFudXAgbWlnaHQgbmVlZCB0byBiZSByZXRob3VnaHQgYW5kIGNvbnNvbGlkYXRlZAoKCiAgICAgICAgaWYgKCF0aGlzLnZsc3BlYy53aWR0aCkgZGVsZXRlIHRoaXMuc3BlYy53aWR0aDsKICAgICAgICBpZiAoIXRoaXMudmxzcGVjLmhlaWdodCkgZGVsZXRlIHRoaXMuc3BlYy5oZWlnaHQ7CgogICAgICAgIGlmICghdGhpcy52bHNwZWMucGFkZGluZyAmJiAodGhpcy52bHNwZWMuY29uZmlnID09PSB1bmRlZmluZWQgfHwgaGFzQ29uZmlnICYmICF0aGlzLnZsc3BlYy5jb25maWcucGFkZGluZykpIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLnNwZWMucGFkZGluZzsKICAgICAgICB9CgogICAgICAgIGlmICghdGhpcy52bHNwZWMuYXV0b3NpemUgJiYgKHRoaXMudmxzcGVjLmNvbmZpZyA9PT0gdW5kZWZpbmVkIHx8IGhhc0NvbmZpZyAmJiAhdGhpcy52bHNwZWMuY29uZmlnLmF1dG9zaXplKSkgewogICAgICAgICAgZGVsZXRlIHRoaXMuc3BlYy5hdXRvc2l6ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUHJvY2VzcyBncmFwaCBzaXplIGFuZCBwYWRkaW5nCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9jYWxjU2l6aW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY2FsY1NpemluZygpIHsKICAgICAgdGhpcy51c2VSZXNpemUgPSBmYWxzZTsKCiAgICAgIGlmICghdGhpcy51c2VNYXApIHsKICAgICAgICAvLyB3aGVuIHVzZVJlc2l6ZSBpcyB0cnVlLCB2ZWdhJ3MgY2FudmFzIHNpemUgd2lsbCBiZSBzZXQgYmFzZWQgb24gdGhlIHNpemUgb2YgdGhlIGNvbnRhaW5lciwKICAgICAgICAvLyBhbmQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IHVwZGF0ZWQgb24gcmVzaXplIGV2ZW50cy4KICAgICAgICAvLyBXZSBkZWxldGUgd2lkdGggJiBoZWlnaHQgaWYgdGhlIGF1dG9zaXplIGlzIHNldCB0byAiZml0IgogICAgICAgIC8vIFdlIGFsc28gc2V0IHVzZVJlc2l6ZT10cnVlIGluIGNhc2UgYXV0b3NpemU9bm9uZSwgYW5kIHdpZHRoICYgaGVpZ2h0IGFyZSBub3Qgc2V0CiAgICAgICAgdmFyIGF1dG9zaXplID0gdGhpcy5zcGVjLmF1dG9zaXplLnR5cGUgfHwgdGhpcy5zcGVjLmF1dG9zaXplOwoKICAgICAgICBpZiAoYXV0b3NpemUgPT09ICdmaXQnIHx8IGF1dG9zaXplID09PSAnbm9uZScgJiYgIXRoaXMuc3BlYy53aWR0aCAmJiAhdGhpcy5zcGVjLmhlaWdodCkgewogICAgICAgICAgdGhpcy51c2VSZXNpemUgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSAvLyBQYWRkaW5nIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgd2lkdGgvaGVpZ2h0IGJ5IGRlZmF1bHQKCgogICAgICB0aGlzLnBhZGRpbmdXaWR0aCA9IDA7CiAgICAgIHRoaXMucGFkZGluZ0hlaWdodCA9IDA7CgogICAgICBpZiAodGhpcy51c2VSZXNpemUgJiYgdGhpcy5zcGVjLnBhZGRpbmcgJiYgdGhpcy5zcGVjLmF1dG9zaXplLmNvbnRhaW5zICE9PSAncGFkZGluZycpIHsKICAgICAgICBpZiAoX3R5cGVvZih0aGlzLnNwZWMucGFkZGluZykgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICB0aGlzLnBhZGRpbmdXaWR0aCArPSAoK3RoaXMuc3BlYy5wYWRkaW5nLmxlZnQgfHwgMCkgKyAoK3RoaXMuc3BlYy5wYWRkaW5nLnJpZ2h0IHx8IDApOwogICAgICAgICAgdGhpcy5wYWRkaW5nSGVpZ2h0ICs9ICgrdGhpcy5zcGVjLnBhZGRpbmcudG9wIHx8IDApICsgKCt0aGlzLnNwZWMucGFkZGluZy5ib3R0b20gfHwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucGFkZGluZ1dpZHRoICs9IDIgKiAoK3RoaXMuc3BlYy5wYWRkaW5nIHx8IDApOwogICAgICAgICAgdGhpcy5wYWRkaW5nSGVpZ2h0ICs9IDIgKiAoK3RoaXMuc3BlYy5wYWRkaW5nIHx8IDApOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMudXNlUmVzaXplICYmICh0aGlzLnNwZWMud2lkdGggfHwgdGhpcy5zcGVjLmhlaWdodCkpIHsKICAgICAgICBpZiAodGhpcy5pc1ZlZ2FMaXRlKSB7CiAgICAgICAgICBkZWxldGUgdGhpcy5zcGVjLndpZHRoOwogICAgICAgICAgZGVsZXRlIHRoaXMuc3BlYy5oZWlnaHQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX29uV2FybmluZyhfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci53aWR0aEFuZEhlaWdodFBhcmFtc0FyZUlnbm9yZWRXaXRoQXV0b3NpemVGaXRXYXJuaW5nTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGUge3dpZHRoUGFyYW19IGFuZCB7aGVpZ2h0UGFyYW19IHBhcmFtcyBhcmUgaWdub3JlZCB3aXRoIHthdXRvc2l6ZVBhcmFtfScsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIGF1dG9zaXplUGFyYW06ICdhdXRvc2l6ZT1maXQnLAogICAgICAgICAgICAgIHdpZHRoUGFyYW06ICcid2lkdGgiJywKICAgICAgICAgICAgICBoZWlnaHRQYXJhbTogJyJoZWlnaHQiJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSBjb250YWluZXItZGlyZWN0aW9uIENTUyBwcm9wZXJ0eSBmb3IgYmluZGluZyBwbGFjZW1lbnQKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3BhcnNlQ29udHJvbFBsYWNlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlQ29udHJvbFBsYWNlbWVudCgpIHsKICAgICAgdGhpcy5jb250YWluZXJEaXIgPSBsb2NUb0Rpck1hcFt0aGlzLl9jb25maWcuY29udHJvbHNMb2NhdGlvbl07CgogICAgICBpZiAodGhpcy5jb250YWluZXJEaXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmICh0aGlzLl9jb25maWcuY29udHJvbHNMb2NhdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmNvbnRhaW5lckRpciA9ICdjb2x1bW4nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIudW5yZWNvZ25pemVkQ29udHJvbHNMb2NhdGlvblZhbHVlRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VucmVjb2duaXplZCB7Y29udHJvbHNMb2NhdGlvblBhcmFtfSB2YWx1ZS4gRXhwZWN0aW5nIG9uZSBvZiBbe2xvY1RvRGlyTWFwfV0nLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBsb2NUb0Rpck1hcDogIlwiIi5jb25jYXQobG9jVG9EaXJNYXAua2V5cygpLmpvaW4oJyIsICInKSwgIlwiIiksCiAgICAgICAgICAgICAgY29udHJvbHNMb2NhdGlvblBhcmFtOiAnY29udHJvbHNMb2NhdGlvbicKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGRpciA9IHRoaXMuX2NvbmZpZy5jb250cm9sc0RpcmVjdGlvbjsKCiAgICAgIGlmIChkaXIgIT09IHVuZGVmaW5lZCAmJiBkaXIgIT09ICdob3Jpem9udGFsJyAmJiBkaXIgIT09ICd2ZXJ0aWNhbCcpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIudW5yZWNvZ25pemVkRGlyVmFsdWVFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VucmVjb2duaXplZCB7ZGlyUGFyYW19IHZhbHVlLiBFeHBlY3Rpbmcgb25lIG9mIFt7ZXhwZWN0ZWRWYWx1ZXN9XScsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgZXhwZWN0ZWRWYWx1ZXM6ICciaG9yaXpvbnRhbCIsICJ2ZXJ0aWNhbCInLAogICAgICAgICAgICBkaXJQYXJhbTogJ2RpcicKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY29udHJvbHNEaXIgPSBkaXIgPT09ICdob3Jpem9udGFsJyA/ICdyb3cnIDogJ2NvbHVtbic7CiAgICB9CiAgICAvKioKICAgICAqIFBhcnNlIHtjb25maWc6IGtpYmFuYTogey4uLn19IHBvcnRpb24gb2YgdGhlIFZlZ2Egc3BlYyAob3Igcm9vdC1sZXZlbCBfaG9zdENvbmZpZyBmb3IgYmFja3dhcmQgY29tcGF0KQogICAgICogQHJldHVybnMge29iamVjdH0ga2liYW5hIGNvbmZpZwogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcGFyc2VDb25maWciLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9wYXJzZUNvbmZpZygpIHsKICAgICAgdmFyIHJlc3VsdDsKCiAgICAgIGlmICh0aGlzLnNwZWMuX2hvc3RDb25maWcgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJlc3VsdCA9IHRoaXMuc3BlYy5faG9zdENvbmZpZzsKICAgICAgICBkZWxldGUgdGhpcy5zcGVjLl9ob3N0Q29uZmlnOwoKICAgICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc1BsYWluT2JqZWN0KHJlc3VsdCkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5ob3N0Q29uZmlnVmFsdWVUeXBlRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0lmIHByZXNlbnQsIHtjb25maWdOYW1lfSBtdXN0IGJlIGFuIG9iamVjdCcsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIGNvbmZpZ05hbWU6ICciX2hvc3RDb25maWciJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9vbldhcm5pbmcoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuaG9zdENvbmZpZ0lzRGVwcmVjYXRlZFdhcm5pbmdNZXNzYWdlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7ZGVwcmVjYXRlZENvbmZpZ05hbWV9IGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSB7bmV3Q29uZmlnTmFtZX0gaW5zdGVhZC4nLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGRlcHJlY2F0ZWRDb25maWdOYW1lOiAnIl9ob3N0Q29uZmlnIicsCiAgICAgICAgICAgIG5ld0NvbmZpZ05hbWU6ICdjb25maWcua2liYW5hJwogICAgICAgICAgfQogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5pc1BsYWluT2JqZWN0KHRoaXMuc3BlYy5jb25maWcpICYmIHRoaXMuc3BlYy5jb25maWcua2liYW5hICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXN1bHQgPSB0aGlzLnNwZWMuY29uZmlnLmtpYmFuYTsKICAgICAgICBkZWxldGUgdGhpcy5zcGVjLmNvbmZpZy5raWJhbmE7CgogICAgICAgIGlmICghX2xvZGFzaC5kZWZhdWx0LmlzUGxhaW5PYmplY3QocmVzdWx0KSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLmtpYmFuYUNvbmZpZ1ZhbHVlVHlwZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdJZiBwcmVzZW50LCB7Y29uZmlnTmFtZX0gbXVzdCBiZSBhbiBvYmplY3QnLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBjb25maWdOYW1lOiAnY29uZmlnLmtpYmFuYScKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdCB8fCB7fTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcGFyc2VUb29sdGlwcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlVG9vbHRpcHMoKSB7CiAgICAgIGlmICh0aGlzLl9jb25maWcudG9vbHRpcHMgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgcmVzdWx0ID0gdGhpcy5fY29uZmlnLnRvb2x0aXBzIHx8IHt9OwoKICAgICAgaWYgKHJlc3VsdC5wb3NpdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmVzdWx0LnBvc2l0aW9uID0gJ3RvcCc7CiAgICAgIH0gZWxzZSBpZiAoWyd0b3AnLCAncmlnaHQnLCAnYm90dG9tJywgJ2xlZnQnXS5pbmRleE9mKHJlc3VsdC5wb3NpdGlvbikgPT09IC0xKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLnVuZXhwZWN0ZWRWYWx1ZUZvclBvc2l0aW9uQ29uZmlndXJhdGlvbkVycm9yTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5leHBlY3RlZCB2YWx1ZSBmb3IgdGhlIHtjb25maWd1cmF0aW9uTmFtZX0gY29uZmlndXJhdGlvbicsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgY29uZmlndXJhdGlvbk5hbWU6ICdyZXN1bHQucG9zaXRpb24nCiAgICAgICAgICB9CiAgICAgICAgfSkpOwogICAgICB9CgogICAgICBpZiAocmVzdWx0LnBhZGRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJlc3VsdC5wYWRkaW5nID0gMTY7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJlc3VsdC5wYWRkaW5nICE9PSAnbnVtYmVyJykgewogICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5wYWRkaW5nQ29uZmlnVmFsdWVUeXBlRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7Y29uZmlnTmFtZX0gaXMgZXhwZWN0ZWQgdG8gYmUgYSBudW1iZXInLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGNvbmZpZ05hbWU6ICdjb25maWcua2liYW5hLnJlc3VsdC5wYWRkaW5nJwogICAgICAgICAgfQogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgaWYgKHJlc3VsdC5jZW50ZXJPbk1hcmsgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIGlmIG1hcmsncyB3aWR0aCAmIGhlaWdodCBpcyBsZXNzIHRoYW4gdGhpcyB2YWx1ZSwgY2VudGVyIG9uIGl0CiAgICAgICAgcmVzdWx0LmNlbnRlck9uTWFyayA9IDUwOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXN1bHQuY2VudGVyT25NYXJrID09PSAnYm9vbGVhbicpIHsKICAgICAgICByZXN1bHQuY2VudGVyT25NYXJrID0gcmVzdWx0LmNlbnRlck9uTWFyayA/IE51bWJlci5NQVhfVkFMVUUgOiAtMTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzdWx0LmNlbnRlck9uTWFyayAhPT0gJ251bWJlcicpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuY2VudGVyT25NYXJrQ29uZmlnVmFsdWVUeXBlRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7Y29uZmlnTmFtZX0gaXMgZXhwZWN0ZWQgdG8gYmUge3RydWVWYWx1ZX0sIHtmYWxzZVZhbHVlfSwgb3IgYSBudW1iZXInLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGNvbmZpZ05hbWU6ICdjb25maWcua2liYW5hLnJlc3VsdC5jZW50ZXJPbk1hcmsnLAogICAgICAgICAgICB0cnVlVmFsdWU6ICd0cnVlJywKICAgICAgICAgICAgZmFsc2VWYWx1ZTogJ2ZhbHNlJwogICAgICAgICAgfQogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogUGFyc2UgbWFwLXNwZWNpZmljIGNvbmZpZ3VyYXRpb24KICAgICAqIEByZXR1cm5zIHt7bWFwU3R5bGU6ICp8c3RyaW5nLCBkZWxheVJlcGFpbnQ6IGJvb2xlYW4sIGxhdGl0dWRlOiBudW1iZXIsIGxvbmdpdHVkZTogbnVtYmVyLCB6b29tLCBtaW5ab29tLCBtYXhab29tLCB6b29tQ29udHJvbDogKnxib29sZWFuLCBtYXhCb3VuZHM6ICp9fQogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcGFyc2VNYXBDb25maWciLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9wYXJzZU1hcENvbmZpZygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciByZXMgPSB7CiAgICAgICAgZGVsYXlSZXBhaW50OiB0aGlzLl9jb25maWcuZGVsYXlSZXBhaW50ID09PSB1bmRlZmluZWQgPyB0cnVlIDogdGhpcy5fY29uZmlnLmRlbGF5UmVwYWludAogICAgICB9OwoKICAgICAgdmFyIHZhbGlkYXRlID0gZnVuY3Rpb24gdmFsaWRhdGUobmFtZSwgaXNab29tKSB7CiAgICAgICAgdmFyIHZhbCA9IF90aGlzLl9jb25maWdbbmFtZV07CgogICAgICAgIGlmICh2YWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIHBhcnNlZCA9IHBhcnNlRmxvYXQodmFsKTsKCiAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHBhcnNlZCkgJiYgKCFpc1pvb20gfHwgcGFyc2VkID49IDAgJiYgcGFyc2VkIDw9IDMwKSkgewogICAgICAgICAgICByZXNbbmFtZV0gPSBwYXJzZWQ7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpcy5fb25XYXJuaW5nKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLnNvbWVLaWJhbmFDb25maWd1cmF0aW9uSXNOb1ZhbGlkV2FybmluZ01lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne2NvbmZpZ05hbWV9IGlzIG5vdCB2YWxpZCcsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIGNvbmZpZ05hbWU6ICJjb25maWcua2liYW5hLiIuY29uY2F0KG5hbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIGlmICghaXNab29tKSByZXNbbmFtZV0gPSAwOwogICAgICB9OwoKICAgICAgdmFsaWRhdGUoImxhdGl0dWRlIiwgZmFsc2UpOwogICAgICB2YWxpZGF0ZSgibG9uZ2l0dWRlIiwgZmFsc2UpOwogICAgICB2YWxpZGF0ZSgiem9vbSIsIHRydWUpOwogICAgICB2YWxpZGF0ZSgibWluWm9vbSIsIHRydWUpOwogICAgICB2YWxpZGF0ZSgibWF4Wm9vbSIsIHRydWUpOyAvLyBgZmFsc2VgIGlzIGEgdmFsaWQgdmFsdWUKCiAgICAgIHJlcy5tYXBTdHlsZSA9IHRoaXMuX2NvbmZpZy5tYXBTdHlsZSA9PT0gdW5kZWZpbmVkID8gImRlZmF1bHQiIDogdGhpcy5fY29uZmlnLm1hcFN0eWxlOwoKICAgICAgaWYgKHJlcy5tYXBTdHlsZSAhPT0gImRlZmF1bHQiICYmIHJlcy5tYXBTdHlsZSAhPT0gZmFsc2UpIHsKICAgICAgICB0aGlzLl9vbldhcm5pbmcoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIubWFwU3R5bGVWYWx1ZVR5cGVXYXJuaW5nTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne21hcFN0eWxlQ29uZmlnTmFtZX0gbWF5IGVpdGhlciBiZSB7bWFwU3R5bGVDb25maWdGaXJzdEFsbG93ZWRWYWx1ZX0gb3Ige21hcFN0eWxlQ29uZmlnU2Vjb25kQWxsb3dlZFZhbHVlfScsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgbWFwU3R5bGVDb25maWdOYW1lOiAnY29uZmlnLmtpYmFuYS5tYXBTdHlsZScsCiAgICAgICAgICAgIG1hcFN0eWxlQ29uZmlnRmlyc3RBbGxvd2VkVmFsdWU6ICdmYWxzZScsCiAgICAgICAgICAgIG1hcFN0eWxlQ29uZmlnU2Vjb25kQWxsb3dlZFZhbHVlOiAnImRlZmF1bHQiJwogICAgICAgICAgfQogICAgICAgIH0pKTsKCiAgICAgICAgcmVzLm1hcFN0eWxlID0gImRlZmF1bHQiOwogICAgICB9CgogICAgICB0aGlzLl9wYXJzZUJvb2woJ3pvb21Db250cm9sJywgcmVzLCB0cnVlKTsKCiAgICAgIHRoaXMuX3BhcnNlQm9vbCgnc2Nyb2xsV2hlZWxab29tJywgcmVzLCBmYWxzZSk7CgogICAgICB2YXIgbWF4Qm91bmRzID0gdGhpcy5fY29uZmlnLm1heEJvdW5kczsKCiAgICAgIGlmIChtYXhCb3VuZHMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShtYXhCb3VuZHMpIHx8IG1heEJvdW5kcy5sZW5ndGggIT09IDQgfHwgIW1heEJvdW5kcy5ldmVyeShmdW5jdGlvbiAodikgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiB2ID09PSAnbnVtYmVyJyAmJiBOdW1iZXIuaXNGaW5pdGUodik7CiAgICAgICAgfSkpIHsKICAgICAgICAgIHRoaXMuX29uV2FybmluZyhfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5tYXhCb3VuZHNWYWx1ZVR5cGVXYXJuaW5nTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7bWF4Qm91bmRzQ29uZmlnTmFtZX0gbXVzdCBiZSBhbiBhcnJheSB3aXRoIGZvdXIgbnVtYmVycycsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIG1heEJvdW5kc0NvbmZpZ05hbWU6ICdjb25maWcua2liYW5hLm1heEJvdW5kcycKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXMubWF4Qm91bmRzID0gbWF4Qm91bmRzOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcGFyc2VCb29sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VCb29sKHBhcmFtTmFtZSwgZHN0T2JqLCBkZmx0KSB7CiAgICAgIHZhciB2YWwgPSB0aGlzLl9jb25maWdbcGFyYW1OYW1lXTsKCiAgICAgIGlmICh2YWwgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGRzdE9ialtwYXJhbU5hbWVdID0gZGZsdDsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsICE9PSAnYm9vbGVhbicpIHsKICAgICAgICB0aGlzLl9vbldhcm5pbmcoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuc29tZUtpYmFuYVBhcmFtVmFsdWVUeXBlV2FybmluZ01lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ3tjb25maWdOYW1lfSBtdXN0IGJlIGEgYm9vbGVhbiB2YWx1ZScsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgY29uZmlnTmFtZTogImNvbmZpZy5raWJhbmEuIi5jb25jYXQocGFyYW1OYW1lKQogICAgICAgICAgfQogICAgICAgIH0pKTsKCiAgICAgICAgZHN0T2JqW3BhcmFtTmFtZV0gPSBkZmx0OwogICAgICB9IGVsc2UgewogICAgICAgIGRzdE9ialtwYXJhbU5hbWVdID0gdmFsOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFBhcnNlIFZlZ2Egc2NoZW1hIGVsZW1lbnQKICAgICAqIEByZXR1cm5zIHtib29sZWFufSBpcyB0aGlzIGEgVmVnYUxpdGUgc2NoZW1hPwogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcGFyc2VTY2hlbWEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9wYXJzZVNjaGVtYSgpIHsKICAgICAgaWYgKCF0aGlzLnNwZWMuJHNjaGVtYSkgewogICAgICAgIHRoaXMuX29uV2FybmluZyhfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5pbnB1dFNwZWNEb2VzTm90U3BlY2lmeVNjaGVtYVdhcm5pbmdNZXNzYWdlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGUgaW5wdXQgc3BlYyBkb2VzIG5vdCBzcGVjaWZ5IGEge3NjaGVtYVBhcmFtfSwgZGVmYXVsdGluZyB0byB7ZGVmYXVsdFNjaGVtYX0nLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGRlZmF1bHRTY2hlbWE6ICJcIiIuY29uY2F0KERFRkFVTFRfU0NIRU1BLCAiXCIiKSwKICAgICAgICAgICAgc2NoZW1hUGFyYW06ICciJHNjaGVtYSInCiAgICAgICAgICB9CiAgICAgICAgfSkpOwoKICAgICAgICB0aGlzLnNwZWMuJHNjaGVtYSA9IERFRkFVTFRfU0NIRU1BOwogICAgICB9CgogICAgICB2YXIgc2NoZW1hID0gKDAsIF92ZWdhU2NoZW1hVXJsUGFyc2VyLmRlZmF1bHQpKHRoaXMuc3BlYy4kc2NoZW1hKTsKICAgICAgdmFyIGlzVmVnYUxpdGUgPSBzY2hlbWEubGlicmFyeSA9PT0gJ3ZlZ2EtbGl0ZSc7CiAgICAgIHZhciBsaWJWZXJzaW9uID0gaXNWZWdhTGl0ZSA/IHZlZ2FMaXRlLnZlcnNpb24gOiB2ZWdhLnZlcnNpb247CgogICAgICBpZiAoKDAsIF9jb21wYXJlVmVyc2lvbnMuZGVmYXVsdCkoc2NoZW1hLnZlcnNpb24sIGxpYlZlcnNpb24pID4gMCkgewogICAgICAgIHRoaXMuX29uV2FybmluZyhfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5ub3RWYWxpZExpYnJhcnlWZXJzaW9uRm9ySW5wdXRTcGVjV2FybmluZ01lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1RoZSBpbnB1dCBzcGVjIHVzZXMge3NjaGVtYUxpYnJhcnl9IHtzY2hlbWFWZXJzaW9ufSwgYnV0IGN1cnJlbnQgdmVyc2lvbiBvZiB7c2NoZW1hTGlicmFyeX0gaXMge2xpYnJhcnlWZXJzaW9ufS4nLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIHNjaGVtYUxpYnJhcnk6IHNjaGVtYS5saWJyYXJ5LAogICAgICAgICAgICBzY2hlbWFWZXJzaW9uOiBzY2hlbWEudmVyc2lvbiwKICAgICAgICAgICAgbGlicmFyeVZlcnNpb246IGxpYlZlcnNpb24KICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpc1ZlZ2FMaXRlOwogICAgfQogICAgLyoqCiAgICAgKiBSZXBsYWNlIGFsbCBpbnN0YW5jZXMgb2YgRVMgcmVxdWVzdHMgd2l0aCByYXcgdmFsdWVzLgogICAgICogQWxzbyBoYW5kbGUgYW55IG90aGVyIHR5cGUgb2YgdXJsOiB7dHlwZTogeHh4LCAuLi59CiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9yZXNvbHZlRGF0YVVybHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZXNvbHZlRGF0YVVybHMoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIHBlbmRpbmcsIHBlbmRpbmdQYXJzZXJzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9yZXNvbHZlRGF0YVVybHMkKF9jb250ZXh0MykgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHBlbmRpbmcgPSB7fTsKCiAgICAgICAgICAgICAgdGhpcy5fZmluZE9iamVjdERhdGFVcmxzKHRoaXMuc3BlYywgZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IG9iai51cmw7CiAgICAgICAgICAgICAgICBkZWxldGUgb2JqLnVybDsKICAgICAgICAgICAgICAgIHZhciB0eXBlID0gdXJsWycldHlwZSUnXTsKICAgICAgICAgICAgICAgIGRlbGV0ZSB1cmxbJyV0eXBlJSddOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgdHlwZSA9IERFRkFVTFRfUEFSU0VSOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBwYXJzZXIgPSBfdGhpczIuX3VybFBhcnNlcnNbdHlwZV07CgogICAgICAgICAgICAgICAgaWYgKHBhcnNlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5ub3RTdXBwb3J0ZWRVcmxUeXBlRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne3VybE9iamVjdH0gaXMgbm90IHN1cHBvcnRlZCcsCiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICB1cmxPYmplY3Q6ICd1cmw6IHsiJXR5cGUlIjogIiR7dHlwZX0ifScKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgcGVuZGluZ0FyciA9IHBlbmRpbmdbdHlwZV07CgogICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdBcnIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBwZW5kaW5nW3R5cGVdID0gcGVuZGluZ0FyciA9IFtdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHBlbmRpbmdBcnIucHVzaChwYXJzZXIucGFyc2VVcmwob2JqLCB1cmwpKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgcGVuZGluZ1BhcnNlcnMgPSBPYmplY3Qua2V5cyhwZW5kaW5nKTsKCiAgICAgICAgICAgICAgaWYgKCEocGVuZGluZ1BhcnNlcnMubGVuZ3RoID4gMCkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA2OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoUHJvbWlzZS5hbGwocGVuZGluZ1BhcnNlcnMubWFwKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLl91cmxQYXJzZXJzW3R5cGVdLnBvcHVsYXRlRGF0YShwZW5kaW5nW3R5cGVdKTsKICAgICAgICAgICAgICB9KSkpOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZWx5IGZpbmQgYW5kIGNhbGxiYWNrIGV2ZXJ5IGluc3RhbmNlIG9mIHRoZSBkYXRhLnVybCBhcyBhbiBvYmplY3QKICAgICAqIEBwYXJhbSB7Kn0gb2JqIGN1cnJlbnQgbG9jYXRpb24gaW4gdGhlIG9iamVjdCB0cmVlCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKHtvYmplY3R9KX0gb25GaW5kIENhbGwgdGhpcyBmdW5jdGlvbiBmb3IgYWxsIHVybCBvYmplY3RzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2tleV0gZmllbGQgbmFtZSBvZiB0aGUgY3VycmVudCBvYmplY3QKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2ZpbmRPYmplY3REYXRhVXJscyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRPYmplY3REYXRhVXJscyhvYmosIG9uRmluZCwga2V5KSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHsKICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gb2JqW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgZWxlbSA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgICAgdGhpcy5fZmluZE9iamVjdERhdGFVcmxzKGVsZW0sIG9uRmluZCwga2V5KTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChfbG9kYXNoLmRlZmF1bHQuaXNQbGFpbk9iamVjdChvYmopKSB7CiAgICAgICAgaWYgKGtleSA9PT0gJ2RhdGEnICYmIF9sb2Rhc2guZGVmYXVsdC5pc1BsYWluT2JqZWN0KG9iai51cmwpKSB7CiAgICAgICAgICAvLyBBc3N1bWUgdGhhdCBhbnkgICJkYXRhIjogeyJ1cmwiOiB7Li4ufX0gIGlzIGEgcmVxdWVzdCBmb3IgZGF0YQogICAgICAgICAgaWYgKG9iai52YWx1ZXMgIT09IHVuZGVmaW5lZCB8fCBvYmouc291cmNlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLmRhdGFFeGNlZWRzU29tZVBhcmFtc1VzZVRpbWVzTGltaXRFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEYXRhIG11c3Qgbm90IGhhdmUgbW9yZSB0aGFuIG9uZSBvZiB7dXJsUGFyYW19LCB7dmFsdWVzUGFyYW19LCBhbmQge3NvdXJjZVBhcmFtfScsCiAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICB1cmxQYXJhbTogJyJ1cmwiJywKICAgICAgICAgICAgICAgIHZhbHVlc1BhcmFtOiAnInZhbHVlcyInLAogICAgICAgICAgICAgICAgc291cmNlUGFyYW06ICcic291cmNlIicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICBvbkZpbmQob2JqKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyhvYmopOyBfaSA8IF9PYmplY3Qka2V5cy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIGsgPSBfT2JqZWN0JGtleXNbX2ldOwoKICAgICAgICAgICAgdGhpcy5fZmluZE9iamVjdERhdGFVcmxzKG9ialtrXSwgb25GaW5kLCBrKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogSW5qZWN0IGRlZmF1bHQgY29sb3JzIGludG8gdGhlIHNwZWMuY29uZmlnCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXREZWZhdWx0Q29sb3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0RGVmYXVsdENvbG9ycygpIHsKICAgICAgLy8gRGVmYXVsdCBjYXRlZ29yeSBjb2xvcmluZyB0byB0aGUgRWxhc3RpYyBjb2xvciBzY2hlbWUKICAgICAgdGhpcy5fc2V0RGVmYXVsdFZhbHVlKHsKICAgICAgICBzY2hlbWU6ICdlbGFzdGljJwogICAgICB9LCAnY29uZmlnJywgJ3JhbmdlJywgJ2NhdGVnb3J5Jyk7CgogICAgICBpZiAodGhpcy5pc1ZlZ2FMaXRlKSB7CiAgICAgICAgLy8gVmVnYS1MaXRlOiBzZXQgZGVmYXVsdCBjb2xvciwgd29ya3MgZm9yIGZpbGwgYW5kIHN0cmlrZSAtLSAgY29uZmlnOiB7IG1hcms6ICB7IGNvbG9yOiAnIzU0QjM5OScgfX0KICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ21hcmsnLCAnY29sb3InKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBWZWdhIC0gZ2xvYmFsIG1hcmsgaGFzIHZlcnkgc3RyYW5nZSBiZWhhdmlvciwgbXVzdCBjdXN0b21pemUgZWFjaCBtYXJrIHR5cGUgaW5kaXZpZHVhbGx5CiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3ZlZ2EvdmVnYS9pc3N1ZXMvMTA4MwogICAgICAgIC8vIERvbid0IHNldCBkZWZhdWx0cyBpZiBzcGVjLmNvbmZpZy5tYXJrLmNvbG9yIG9yIGZpbGwgYXJlIHNldAogICAgICAgIGlmICghdGhpcy5zcGVjLmNvbmZpZy5tYXJrIHx8IHRoaXMuc3BlYy5jb25maWcubWFyay5jb2xvciA9PT0gdW5kZWZpbmVkICYmIHRoaXMuc3BlYy5jb25maWcubWFyay5maWxsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuX3NldERlZmF1bHRWYWx1ZShkZWZhdWx0Q29sb3IsICdjb25maWcnLCAnYXJjJywgJ2ZpbGwnKTsKCiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ2FyZWEnLCAnZmlsbCcpOwoKICAgICAgICAgIHRoaXMuX3NldERlZmF1bHRWYWx1ZShkZWZhdWx0Q29sb3IsICdjb25maWcnLCAnbGluZScsICdzdHJva2UnKTsKCiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ3BhdGgnLCAnc3Ryb2tlJyk7CgogICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFZhbHVlKGRlZmF1bHRDb2xvciwgJ2NvbmZpZycsICdyZWN0JywgJ2ZpbGwnKTsKCiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ3J1bGUnLCAnc3Ryb2tlJyk7CgogICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFZhbHVlKGRlZmF1bHRDb2xvciwgJ2NvbmZpZycsICdzaGFwZScsICdzdHJva2UnKTsKCiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ3N5bWJvbCcsICdmaWxsJyk7CgogICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFZhbHVlKGRlZmF1bHRDb2xvciwgJ2NvbmZpZycsICd0cmFpbCcsICdmaWxsJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCBkZWZhdWx0IHZhbHVlIGlmIGl0IGRvZXNuJ3QgZXhpc3QuCiAgICAgKiBHaXZlbiBhbiBvYmplY3QsIGFuZCBhbiBhcnJheSBvZiBmaWVsZHMsIGVuc3VyZSB0aGF0IG9iai5mbGQxLmZsZDIuIC4uLiAuZmxkTiBpcyBzZXQgdG8gdmFsdWUgaWYgaXQgZG9lc24ndCBleGlzdC4KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmaWVsZHMKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3NldERlZmF1bHRWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldERlZmF1bHRWYWx1ZSh2YWx1ZSkgewogICAgICB2YXIgX3JlZjsKCiAgICAgIHZhciBvID0gdGhpcy5zcGVjOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAoYXJndW1lbnRzLmxlbmd0aCA8PSAxID8gMCA6IGFyZ3VtZW50cy5sZW5ndGggLSAxKSAtIDE7IGkrKykgewogICAgICAgIHZhciBmaWVsZCA9IGkgKyAxIDwgMSB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgKyAxID8gdW5kZWZpbmVkIDogYXJndW1lbnRzW2kgKyAxXTsKICAgICAgICB2YXIgc3ViT2JqID0gb1tmaWVsZF07CgogICAgICAgIGlmIChzdWJPYmogPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgb1tmaWVsZF0gPSB7fTsKICAgICAgICB9IGVsc2UgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNQbGFpbk9iamVjdChzdWJPYmopKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBvID0gb1tmaWVsZF07CiAgICAgIH0KCiAgICAgIHZhciBsYXN0RmllbGQgPSAoX3JlZiA9IChhcmd1bWVudHMubGVuZ3RoIDw9IDEgPyAwIDogYXJndW1lbnRzLmxlbmd0aCAtIDEpIC0gMSArIDEsIF9yZWYgPCAxIHx8IGFyZ3VtZW50cy5sZW5ndGggPD0gX3JlZiA/IHVuZGVmaW5lZCA6IGFyZ3VtZW50c1tfcmVmXSk7CgogICAgICBpZiAob1tsYXN0RmllbGRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICBvW2xhc3RGaWVsZF0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3YXJuaW5nIHRvIHRoZSB3YXJuaW5ncyBhcnJheQogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfb25XYXJuaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25XYXJuaW5nKCkgewogICAgICBpZiAoIXRoaXMuaGlkZVdhcm5pbmdzKSB7CiAgICAgICAgdGhpcy53YXJuaW5ncy5wdXNoKF91dGlscy5VdGlscy5mb3JtYXRXYXJuaW5nVG9TdHIuYXBwbHkoX3V0aWxzLlV0aWxzLCBhcmd1bWVudHMpKTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIFZlZ2FQYXJzZXI7Cn0oKTsKCmV4cG9ydHMuVmVnYVBhcnNlciA9IFZlZ2FQYXJzZXI7"},null]}