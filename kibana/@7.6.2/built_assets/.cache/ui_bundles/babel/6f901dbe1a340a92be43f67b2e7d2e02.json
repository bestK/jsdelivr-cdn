{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/siem/public/containers/detection_engine/rules/api.js","dependencies":[{"path":"x-pack/legacy/plugins/siem/public/containers/detection_engine/rules/api.js","mtime":1585205047779},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmdldFByZVBhY2thZ2VkUnVsZXNTdGF0dXMgPSBleHBvcnRzLmZldGNoVGFncyA9IGV4cG9ydHMuZ2V0UnVsZVN0YXR1c0J5SWQgPSBleHBvcnRzLmV4cG9ydFJ1bGVzID0gZXhwb3J0cy5pbXBvcnRSdWxlcyA9IGV4cG9ydHMuY3JlYXRlUHJlcGFja2FnZWRSdWxlcyA9IGV4cG9ydHMuZHVwbGljYXRlUnVsZXMgPSBleHBvcnRzLmRlbGV0ZVJ1bGVzID0gZXhwb3J0cy5lbmFibGVSdWxlcyA9IGV4cG9ydHMuZmV0Y2hSdWxlQnlJZCA9IGV4cG9ydHMuZmV0Y2hSdWxlcyA9IGV4cG9ydHMuYWRkUnVsZSA9IHZvaWQgMDsKCnZhciBfY2hyb21lID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1aS9jaHJvbWUiKSk7Cgp2YXIgX2FwaSA9IHJlcXVpcmUoIi4uLy4uLy4uL2hvb2tzL2FwaS9hcGkiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tbW9uL2NvbnN0YW50cyIpOwoKdmFyIGkxOG4gPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCIuLi8uLi8uLi9wYWdlcy9kZXRlY3Rpb25fZW5naW5lL3J1bGVzL3RyYW5zbGF0aW9ucyIpKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQovKioKICogQWRkIHByb3ZpZGVkIFJ1bGUKICoKICogQHBhcmFtIHJ1bGUgdG8gYWRkCiAqIEBwYXJhbSBzaWduYWwgdG8gY2FuY2VsIHJlcXVlc3QKICovCgoKdmFyIGFkZFJ1bGUgPSBmdW5jdGlvbiBhZGRSdWxlKF9yZWYpIHsKICB2YXIgcnVsZSwgc2lnbmFsLCByZXNwb25zZTsKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGFkZFJ1bGUkKF9jb250ZXh0KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcnVsZSA9IF9yZWYucnVsZSwgc2lnbmFsID0gX3JlZi5zaWduYWw7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZmV0Y2goIiIuY29uY2F0KF9jaHJvbWUuZGVmYXVsdC5nZXRCYXNlUGF0aCgpKS5jb25jYXQoX2NvbnN0YW50cy5ERVRFQ1RJT05fRU5HSU5FX1JVTEVTX1VSTCksIHsKICAgICAgICAgICAgbWV0aG9kOiBydWxlLmlkICE9IG51bGwgPyAnUFVUJyA6ICdQT1NUJywKICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICdrYm4teHNyZic6ICd0cnVlJwogICAgICAgICAgICB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShydWxlKSwKICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKCgwLCBfYXBpLnRocm93SWZOb3RPaykocmVzcG9uc2UpKTsKCiAgICAgICAgY2FzZSA2OgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UuanNvbigpKTsKCiAgICAgICAgY2FzZSA3OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn07Ci8qKgogKiBGZXRjaGVzIGFsbCBydWxlcyBmcm9tIHRoZSBEZXRlY3Rpb24gRW5naW5lIEFQSQogKgogKiBAcGFyYW0gZmlsdGVyT3B0aW9ucyBkZXNpcmVkIGZpbHRlcnMgKGUuZy4gZmlsdGVyL3NvcnRGaWVsZC9zb3J0T3JkZXIpCiAqIEBwYXJhbSBwYWdpbmF0aW9uIGRlc2lyZWQgcGFnaW5hdGlvbiBvcHRpb25zIChlLmcuIHBhZ2UvcGVyUGFnZSkKICogQHBhcmFtIHNpZ25hbCB0byBjYW5jZWwgcmVxdWVzdAogKgogKi8KCgpleHBvcnRzLmFkZFJ1bGUgPSBhZGRSdWxlOwoKdmFyIGZldGNoUnVsZXMgPSBmdW5jdGlvbiBmZXRjaFJ1bGVzKF9yZWYyKSB7CiAgdmFyIF9yZWYzLCBfZmlsdGVyT3B0aW9ucyR0YWdzOwoKICB2YXIgX3JlZjIkZmlsdGVyT3B0aW9ucywgZmlsdGVyT3B0aW9ucywgX3JlZjIkcGFnaW5hdGlvbiwgcGFnaW5hdGlvbiwgc2lnbmFsLCBmaWx0ZXJzLCBxdWVyeVBhcmFtcywgcmVzcG9uc2U7CgogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZmV0Y2hSdWxlcyQoX2NvbnRleHQyKSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBfcmVmMiRmaWx0ZXJPcHRpb25zID0gX3JlZjIuZmlsdGVyT3B0aW9ucywgZmlsdGVyT3B0aW9ucyA9IF9yZWYyJGZpbHRlck9wdGlvbnMgPT09IHZvaWQgMCA/IHsKICAgICAgICAgICAgZmlsdGVyOiAnJywKICAgICAgICAgICAgc29ydEZpZWxkOiAnZW5hYmxlZCcsCiAgICAgICAgICAgIHNvcnRPcmRlcjogJ2Rlc2MnLAogICAgICAgICAgICBzaG93Q3VzdG9tUnVsZXM6IGZhbHNlLAogICAgICAgICAgICBzaG93RWxhc3RpY1J1bGVzOiBmYWxzZSwKICAgICAgICAgICAgdGFnczogW10KICAgICAgICAgIH0gOiBfcmVmMiRmaWx0ZXJPcHRpb25zLCBfcmVmMiRwYWdpbmF0aW9uID0gX3JlZjIucGFnaW5hdGlvbiwgcGFnaW5hdGlvbiA9IF9yZWYyJHBhZ2luYXRpb24gPT09IHZvaWQgMCA/IHsKICAgICAgICAgICAgcGFnZTogMSwKICAgICAgICAgICAgcGVyUGFnZTogMjAsCiAgICAgICAgICAgIHRvdGFsOiAwCiAgICAgICAgICB9IDogX3JlZjIkcGFnaW5hdGlvbiwgc2lnbmFsID0gX3JlZjIuc2lnbmFsOwogICAgICAgICAgZmlsdGVycyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZmlsdGVyT3B0aW9ucy5maWx0ZXIubGVuZ3RoICE9PSAwID8gWyJhbGVydC5hdHRyaWJ1dGVzLm5hbWU6JTIwIi5jb25jYXQoZW5jb2RlVVJJQ29tcG9uZW50KGZpbHRlck9wdGlvbnMuZmlsdGVyKSldIDogW10pLCBfdG9Db25zdW1hYmxlQXJyYXkoZmlsdGVyT3B0aW9ucy5zaG93Q3VzdG9tUnVsZXMgPyBbJ2FsZXJ0LmF0dHJpYnV0ZXMudGFnczolMjAlMjJfX2ludGVybmFsX2ltbXV0YWJsZTpmYWxzZSUyMiddIDogW10pLCBfdG9Db25zdW1hYmxlQXJyYXkoZmlsdGVyT3B0aW9ucy5zaG93RWxhc3RpY1J1bGVzID8gWydhbGVydC5hdHRyaWJ1dGVzLnRhZ3M6JTIwJTIyX19pbnRlcm5hbF9pbW11dGFibGU6dHJ1ZSUyMiddIDogW10pLCBfdG9Db25zdW1hYmxlQXJyYXkoKF9yZWYzID0gKF9maWx0ZXJPcHRpb25zJHRhZ3MgPSBmaWx0ZXJPcHRpb25zLnRhZ3MpID09PSBudWxsIHx8IF9maWx0ZXJPcHRpb25zJHRhZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9maWx0ZXJPcHRpb25zJHRhZ3MubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiAiYWxlcnQuYXR0cmlidXRlcy50YWdzOiIuY29uY2F0KGVuY29kZVVSSUNvbXBvbmVudCh0KSk7CiAgICAgICAgICB9KSkgIT09IG51bGwgJiYgX3JlZjMgIT09IHZvaWQgMCA/IF9yZWYzIDogW10pKTsKICAgICAgICAgIHF1ZXJ5UGFyYW1zID0gWyJwYWdlPSIuY29uY2F0KHBhZ2luYXRpb24ucGFnZSksICJwZXJfcGFnZT0iLmNvbmNhdChwYWdpbmF0aW9uLnBlclBhZ2UpLCAic29ydF9maWVsZD0iLmNvbmNhdChmaWx0ZXJPcHRpb25zLnNvcnRGaWVsZCksICJzb3J0X29yZGVyPSIuY29uY2F0KGZpbHRlck9wdGlvbnMuc29ydE9yZGVyKV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShmaWx0ZXJzLmxlbmd0aCA+IDAgPyBbImZpbHRlcj0iLmNvbmNhdChmaWx0ZXJzLmpvaW4oJyUyMEFORCUyMCcpKV0gOiBbXSkpOwogICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChmZXRjaCgiIi5jb25jYXQoX2Nocm9tZS5kZWZhdWx0LmdldEJhc2VQYXRoKCkpLmNvbmNhdChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfUlVMRVNfVVJMLCAiL19maW5kPyIpLmNvbmNhdChxdWVyeVBhcmFtcy5qb2luKCcmJykpLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAna2JuLXhzcmYnOiAndHJ1ZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSA1OgogICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gODsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9hcGkudGhyb3dJZk5vdE9rKShyZXNwb25zZSkpOwoKICAgICAgICBjYXNlIDg6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UuanNvbigpKTsKCiAgICAgICAgY2FzZSA5OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9OwovKioKICogRmV0Y2ggYSBSdWxlIGJ5IHByb3ZpZGluZyBhIFJ1bGUgSUQKICoKICogQHBhcmFtIGlkIFJ1bGUgSUQncyAobm90IHJ1bGVfaWQpCiAqIEBwYXJhbSBzaWduYWwgdG8gY2FuY2VsIHJlcXVlc3QKICoKICovCgoKZXhwb3J0cy5mZXRjaFJ1bGVzID0gZmV0Y2hSdWxlczsKCnZhciBmZXRjaFJ1bGVCeUlkID0gZnVuY3Rpb24gZmV0Y2hSdWxlQnlJZChfcmVmNCkgewogIHZhciBpZCwgc2lnbmFsLCByZXNwb25zZSwgcnVsZTsKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGZldGNoUnVsZUJ5SWQkKF9jb250ZXh0MykgewogICAgd2hpbGUgKDEpIHsKICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgaWQgPSBfcmVmNC5pZCwgc2lnbmFsID0gX3JlZjQuc2lnbmFsOwogICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChmZXRjaCgiIi5jb25jYXQoX2Nocm9tZS5kZWZhdWx0LmdldEJhc2VQYXRoKCkpLmNvbmNhdChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfUlVMRVNfVVJMLCAiP2lkPSIpLmNvbmNhdChpZCksIHsKICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICdrYm4teHNyZic6ICd0cnVlJwogICAgICAgICAgICB9LAogICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgfSkpOwoKICAgICAgICBjYXNlIDM6CiAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA2OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2FwaS50aHJvd0lmTm90T2spKHJlc3BvbnNlKSk7CgogICAgICAgIGNhc2UgNjoKICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gODsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAocmVzcG9uc2UuanNvbigpKTsKCiAgICAgICAgY2FzZSA4OgogICAgICAgICAgcnVsZSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHJ1bGUpOwoKICAgICAgICBjYXNlIDEwOgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9OwovKioKICogRW5hYmxlcy9EaXNhYmxlcyBwcm92aWRlZCBSdWxlIElEJ3MKICoKICogQHBhcmFtIGlkcyBhcnJheSBvZiBSdWxlIElEJ3MgKG5vdCBydWxlX2lkKSB0byBlbmFibGUvZGlzYWJsZQogKiBAcGFyYW0gZW5hYmxlZCB0byBlbmFibGUgb3IgZGlzYWJsZQogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmZldGNoUnVsZUJ5SWQgPSBmZXRjaFJ1bGVCeUlkOwoKdmFyIGVuYWJsZVJ1bGVzID0gZnVuY3Rpb24gZW5hYmxlUnVsZXMoX3JlZjUpIHsKICB2YXIgaWRzLCBlbmFibGVkLCByZXNwb25zZTsKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGVuYWJsZVJ1bGVzJChfY29udGV4dDQpIHsKICAgIHdoaWxlICgxKSB7CiAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGlkcyA9IF9yZWY1LmlkcywgZW5hYmxlZCA9IF9yZWY1LmVuYWJsZWQ7CiAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGZldGNoKCIiLmNvbmNhdChfY2hyb21lLmRlZmF1bHQuZ2V0QmFzZVBhdGgoKSkuY29uY2F0KF9jb25zdGFudHMuREVURUNUSU9OX0VOR0lORV9SVUxFU19VUkwsICIvX2J1bGtfdXBkYXRlIiksIHsKICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLAogICAgICAgICAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJywKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgJ2tibi14c3JmJzogJ3RydWUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGlkcy5tYXAoZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBpZCwKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGVuYWJsZWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KSkKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNjsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9hcGkudGhyb3dJZk5vdE9rKShyZXNwb25zZSkpOwoKICAgICAgICBjYXNlIDY6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UuanNvbigpKTsKCiAgICAgICAgY2FzZSA3OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9OwovKioKICogRGVsZXRlcyBwcm92aWRlZCBSdWxlIElEJ3MKICoKICogQHBhcmFtIGlkcyBhcnJheSBvZiBSdWxlIElEJ3MgKG5vdCBydWxlX2lkKSB0byBkZWxldGUKICoKICogQHRocm93cyBBbiBlcnJvciBpZiByZXNwb25zZSBpcyBub3QgT0sKICovCgoKZXhwb3J0cy5lbmFibGVSdWxlcyA9IGVuYWJsZVJ1bGVzOwoKdmFyIGRlbGV0ZVJ1bGVzID0gZnVuY3Rpb24gZGVsZXRlUnVsZXMoX3JlZjYpIHsKICB2YXIgaWRzLCByZXNwb25zZTsKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGRlbGV0ZVJ1bGVzJChfY29udGV4dDUpIHsKICAgIHdoaWxlICgxKSB7CiAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGlkcyA9IF9yZWY2LmlkczsKICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZmV0Y2goIiIuY29uY2F0KF9jaHJvbWUuZGVmYXVsdC5nZXRCYXNlUGF0aCgpKS5jb25jYXQoX2NvbnN0YW50cy5ERVRFQ1RJT05fRU5HSU5FX1JVTEVTX1VSTCwgIi9fYnVsa19kZWxldGUiKSwgewogICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLAogICAgICAgICAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJywKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgJ2tibi14c3JmJzogJ3RydWUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGlkcy5tYXAoZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBpZAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pKQogICAgICAgICAgfSkpOwoKICAgICAgICBjYXNlIDM6CiAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0NS5zZW50OwogICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA2OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2FwaS50aHJvd0lmTm90T2spKHJlc3BvbnNlKSk7CgogICAgICAgIGNhc2UgNjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS5qc29uKCkpOwoKICAgICAgICBjYXNlIDc6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn07Ci8qKgogKiBEdXBsaWNhdGVzIHByb3ZpZGVkIFJ1bGVzCiAqCiAqIEBwYXJhbSBydWxlcyB0byBkdXBsaWNhdGUKICovCgoKZXhwb3J0cy5kZWxldGVSdWxlcyA9IGRlbGV0ZVJ1bGVzOwoKdmFyIGR1cGxpY2F0ZVJ1bGVzID0gZnVuY3Rpb24gZHVwbGljYXRlUnVsZXMoX3JlZjcpIHsKICB2YXIgcnVsZXMsIHJlc3BvbnNlOwogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZHVwbGljYXRlUnVsZXMkKF9jb250ZXh0NikgewogICAgd2hpbGUgKDEpIHsKICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcnVsZXMgPSBfcmVmNy5ydWxlczsKICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZmV0Y2goIiIuY29uY2F0KF9jaHJvbWUuZGVmYXVsdC5nZXRCYXNlUGF0aCgpKS5jb25jYXQoX2NvbnN0YW50cy5ERVRFQ1RJT05fRU5HSU5FX1JVTEVTX1VSTCwgIi9fYnVsa19jcmVhdGUiKSwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICdrYm4teHNyZic6ICd0cnVlJwogICAgICAgICAgICB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShydWxlcy5tYXAoZnVuY3Rpb24gKHJ1bGUpIHsKICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcnVsZSwgewogICAgICAgICAgICAgICAgbmFtZTogIiIuY29uY2F0KHJ1bGUubmFtZSwgIiBbIikuY29uY2F0KGkxOG4uRFVQTElDQVRFLCAiXSIpLAogICAgICAgICAgICAgICAgY3JlYXRlZF9hdDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgY3JlYXRlZF9ieTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgaWQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHJ1bGVfaWQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHVwZGF0ZWRfYnk6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHJ1bGUuZW5hYmxlZCwKICAgICAgICAgICAgICAgIGltbXV0YWJsZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgbGFzdF9zdWNjZXNzX2F0OiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBsYXN0X3N1Y2Nlc3NfbWVzc2FnZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgbGFzdF9mYWlsdXJlX2F0OiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBsYXN0X2ZhaWx1cmVfbWVzc2FnZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgc3RhdHVzOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBzdGF0dXNfZGF0ZTogdW5kZWZpbmVkCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pKQogICAgICAgICAgfSkpOwoKICAgICAgICBjYXNlIDM6CiAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2FwaS50aHJvd0lmTm90T2spKHJlc3BvbnNlKSk7CgogICAgICAgIGNhc2UgNjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS5qc29uKCkpOwoKICAgICAgICBjYXNlIDc6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn07Ci8qKgogKiBDcmVhdGUgUHJlcGFja2FnZWQgUnVsZXMKICoKICogQHBhcmFtIHNpZ25hbCBBYm9ydFNpZ25hbCBmb3IgY2FuY2VsbGluZyByZXF1ZXN0CiAqLwoKCmV4cG9ydHMuZHVwbGljYXRlUnVsZXMgPSBkdXBsaWNhdGVSdWxlczsKCnZhciBjcmVhdGVQcmVwYWNrYWdlZFJ1bGVzID0gZnVuY3Rpb24gY3JlYXRlUHJlcGFja2FnZWRSdWxlcyhfcmVmOCkgewogIHZhciBzaWduYWwsIHJlc3BvbnNlOwogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gY3JlYXRlUHJlcGFja2FnZWRSdWxlcyQoX2NvbnRleHQ3KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBzaWduYWwgPSBfcmVmOC5zaWduYWw7CiAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDM7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGZldGNoKCIiLmNvbmNhdChfY2hyb21lLmRlZmF1bHQuZ2V0QmFzZVBhdGgoKSkuY29uY2F0KF9jb25zdGFudHMuREVURUNUSU9OX0VOR0lORV9QUkVQQUNLQUdFRF9VUkwpLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsCiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAna2JuLXhzcmYnOiAndHJ1ZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNjsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9hcGkudGhyb3dJZk5vdE9rKShyZXNwb25zZSkpOwoKICAgICAgICBjYXNlIDY6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgIGNhc2UgNzoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgIH0KICAgIH0KICB9KTsKfTsKLyoqCiAqIEltcG9ydHMgcnVsZXMgaW4gdGhlIHNhbWUgZm9ybWF0IGFzIGV4cG9ydGVkIHZpYSB0aGUgX2V4cG9ydCBBUEkKICoKICogQHBhcmFtIGZpbGVUb0ltcG9ydCBGaWxlIHRvIHVwbG9hZCBjb250YWluaW5nIHJ1bGVzIHRvIGltcG9ydAogKiBAcGFyYW0gb3ZlcndyaXRlIHdoZXRoZXIgb3Igbm90IHRvIG92ZXJ3cml0ZSBydWxlcyB3aXRoIHRoZSBzYW1lIHJ1bGVJZAogKiBAcGFyYW0gc2lnbmFsIEFib3J0U2lnbmFsIGZvciBjYW5jZWxsaW5nIHJlcXVlc3QKICoKICogQHRocm93cyBBbiBlcnJvciBpZiByZXNwb25zZSBpcyBub3QgT0sKICovCgoKZXhwb3J0cy5jcmVhdGVQcmVwYWNrYWdlZFJ1bGVzID0gY3JlYXRlUHJlcGFja2FnZWRSdWxlczsKCnZhciBpbXBvcnRSdWxlcyA9IGZ1bmN0aW9uIGltcG9ydFJ1bGVzKF9yZWY5KSB7CiAgdmFyIGZpbGVUb0ltcG9ydCwgX3JlZjkkb3ZlcndyaXRlLCBvdmVyd3JpdGUsIHNpZ25hbCwgZm9ybURhdGEsIHJlc3BvbnNlOwoKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGltcG9ydFJ1bGVzJChfY29udGV4dDgpIHsKICAgIHdoaWxlICgxKSB7CiAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGZpbGVUb0ltcG9ydCA9IF9yZWY5LmZpbGVUb0ltcG9ydCwgX3JlZjkkb3ZlcndyaXRlID0gX3JlZjkub3ZlcndyaXRlLCBvdmVyd3JpdGUgPSBfcmVmOSRvdmVyd3JpdGUgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjkkb3ZlcndyaXRlLCBzaWduYWwgPSBfcmVmOS5zaWduYWw7CiAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgZmlsZVRvSW1wb3J0KTsKICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gNTsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZmV0Y2goIiIuY29uY2F0KF9jaHJvbWUuZGVmYXVsdC5nZXRCYXNlUGF0aCgpKS5jb25jYXQoX2NvbnN0YW50cy5ERVRFQ1RJT05fRU5HSU5FX1JVTEVTX1VSTCwgIi9faW1wb3J0P292ZXJ3cml0ZT0iKS5jb25jYXQob3ZlcndyaXRlKSwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAna2JuLXhzcmYnOiAndHJ1ZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYm9keTogZm9ybURhdGEsCiAgICAgICAgICAgIHNpZ25hbDogc2lnbmFsCiAgICAgICAgICB9KSk7CgogICAgICAgIGNhc2UgNToKICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDg7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKCgwLCBfYXBpLnRocm93SWZOb3RPaykocmVzcG9uc2UpKTsKCiAgICAgICAgY2FzZSA4OgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlLmpzb24oKSk7CgogICAgICAgIGNhc2UgOToKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgIH0KICAgIH0KICB9KTsKfTsKLyoqCiAqIEV4cG9ydCBydWxlcyBmcm9tIHRoZSBzZXJ2ZXIgYXMgYSBmaWxlIGRvd25sb2FkCiAqCiAqIEBwYXJhbSBleGNsdWRlRXhwb3J0RGV0YWlscyB3aGV0aGVyIG9yIG5vdCB0byBleGNsdWRlIGFkZGl0aW9uYWwgZGV0YWlscyBhdCBib3R0b20gb2YgZXhwb3J0ZWQgZmlsZSAoZGVmYXVsdHMgdG8gZmFsc2UpCiAqIEBwYXJhbSBmaWxlbmFtZSBvZiBleHBvcnRlZCBydWxlcy4gQmUgc3VyZSB0byBpbmNsdWRlIGAubmRqc29uYCBleHRlbnNpb24hIChkZWZhdWx0cyB0byBsb2NhbGl6ZWQgYHJ1bGVzX2V4cG9ydC5uZGpzb25gKQogKiBAcGFyYW0gcnVsZUlkcyBhcnJheSBvZiBydWxlX2lkJ3MgKG5vdCBpZCEpIHRvIGV4cG9ydCAoZW1wdHkgYXJyYXkgZXhwb3J0cyBfYWxsXyBydWxlcykKICogQHBhcmFtIHNpZ25hbCBBYm9ydFNpZ25hbCBmb3IgY2FuY2VsbGluZyByZXF1ZXN0CiAqCiAqIEB0aHJvd3MgQW4gZXJyb3IgaWYgcmVzcG9uc2UgaXMgbm90IE9LCiAqLwoKCmV4cG9ydHMuaW1wb3J0UnVsZXMgPSBpbXBvcnRSdWxlczsKCnZhciBleHBvcnRSdWxlcyA9IGZ1bmN0aW9uIGV4cG9ydFJ1bGVzKF9yZWYxMCkgewogIHZhciBfcmVmMTAkZXhjbHVkZUV4cG9ydEQsIGV4Y2x1ZGVFeHBvcnREZXRhaWxzLCBfcmVmMTAkZmlsZW5hbWUsIGZpbGVuYW1lLCBfcmVmMTAkcnVsZUlkcywgcnVsZUlkcywgc2lnbmFsLCBib2R5LCByZXNwb25zZTsKCiAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBleHBvcnRSdWxlcyQoX2NvbnRleHQ5KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBfcmVmMTAkZXhjbHVkZUV4cG9ydEQgPSBfcmVmMTAuZXhjbHVkZUV4cG9ydERldGFpbHMsIGV4Y2x1ZGVFeHBvcnREZXRhaWxzID0gX3JlZjEwJGV4Y2x1ZGVFeHBvcnREID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYxMCRleGNsdWRlRXhwb3J0RCwgX3JlZjEwJGZpbGVuYW1lID0gX3JlZjEwLmZpbGVuYW1lLCBmaWxlbmFtZSA9IF9yZWYxMCRmaWxlbmFtZSA9PT0gdm9pZCAwID8gIiIuY29uY2F0KGkxOG4uRVhQT1JUX0ZJTEVOQU1FLCAiLm5kanNvbiIpIDogX3JlZjEwJGZpbGVuYW1lLCBfcmVmMTAkcnVsZUlkcyA9IF9yZWYxMC5ydWxlSWRzLCBydWxlSWRzID0gX3JlZjEwJHJ1bGVJZHMgPT09IHZvaWQgMCA/IFtdIDogX3JlZjEwJHJ1bGVJZHMsIHNpZ25hbCA9IF9yZWYxMC5zaWduYWw7CiAgICAgICAgICBib2R5ID0gcnVsZUlkcy5sZW5ndGggPiAwID8gSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICBvYmplY3RzOiBydWxlSWRzLm1hcChmdW5jdGlvbiAocnVsZSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBydWxlX2lkOiBydWxlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0pIDogdW5kZWZpbmVkOwogICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA0OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChmZXRjaCgiIi5jb25jYXQoX2Nocm9tZS5kZWZhdWx0LmdldEJhc2VQYXRoKCkpLmNvbmNhdChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfUlVMRVNfVVJMLCAiL19leHBvcnQ/ZXhjbHVkZV9leHBvcnRfZGV0YWlscz0iKS5jb25jYXQoZXhjbHVkZUV4cG9ydERldGFpbHMsICImZmlsZV9uYW1lPSIpLmNvbmNhdChlbmNvZGVVUklDb21wb25lbnQoZmlsZW5hbWUpKSwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICdrYm4teHNyZic6ICd0cnVlJwogICAgICAgICAgICB9LAogICAgICAgICAgICBib2R5OiBib2R5LAogICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgfSkpOwoKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA3OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2FwaS50aHJvd0lmTm90T2spKHJlc3BvbnNlKSk7CgogICAgICAgIGNhc2UgNzoKICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS5ibG9iKCkpOwoKICAgICAgICBjYXNlIDg6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn07Ci8qKgogKiBHZXQgUnVsZSBTdGF0dXMgcHJvdmlkZWQgUnVsZSBJRAogKgogKiBAcGFyYW0gaWQgc3RyaW5nIG9mIFJ1bGUgSUQncyAobm90IHJ1bGVfaWQpCiAqIEBwYXJhbSBzaWduYWwgQWJvcnRTaWduYWwgZm9yIGNhbmNlbGxpbmcgcmVxdWVzdAogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmV4cG9ydFJ1bGVzID0gZXhwb3J0UnVsZXM7Cgp2YXIgZ2V0UnVsZVN0YXR1c0J5SWQgPSBmdW5jdGlvbiBnZXRSdWxlU3RhdHVzQnlJZChfcmVmMTEpIHsKICB2YXIgaWQsIHNpZ25hbCwgcmVzcG9uc2U7CiAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBnZXRSdWxlU3RhdHVzQnlJZCQoX2NvbnRleHQxMCkgewogICAgd2hpbGUgKDEpIHsKICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBpZCA9IF9yZWYxMS5pZCwgc2lnbmFsID0gX3JlZjExLnNpZ25hbDsKICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDM7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGZldGNoKCIiLmNvbmNhdChfY2hyb21lLmRlZmF1bHQuZ2V0QmFzZVBhdGgoKSkuY29uY2F0KF9jb25zdGFudHMuREVURUNUSU9OX0VOR0lORV9SVUxFU19TVEFUVVNfVVJMLCAiP2lkcz0iKS5jb25jYXQoZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KFtpZF0pKSksIHsKICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICdrYm4teHNyZic6ICd0cnVlJwogICAgICAgICAgICB9LAogICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgfSkpOwoKICAgICAgICBjYXNlIDM6CiAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0MTAuc2VudDsKICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDY7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKCgwLCBfYXBpLnRocm93SWZOb3RPaykocmVzcG9uc2UpKTsKCiAgICAgICAgY2FzZSA2OgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS5qc29uKCkpOwoKICAgICAgICBjYXNlIDc6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9OwovKioKICogRmV0Y2ggYWxsIHVuaXF1ZSBUYWdzIHVzZWQgYnkgUnVsZXMKICoKICogQHBhcmFtIHNpZ25hbCB0byBjYW5jZWwgcmVxdWVzdAogKgogKi8KCgpleHBvcnRzLmdldFJ1bGVTdGF0dXNCeUlkID0gZ2V0UnVsZVN0YXR1c0J5SWQ7Cgp2YXIgZmV0Y2hUYWdzID0gZnVuY3Rpb24gZmV0Y2hUYWdzKF9yZWYxMikgewogIHZhciBzaWduYWwsIHJlc3BvbnNlOwogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZmV0Y2hUYWdzJChfY29udGV4dDExKSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHNpZ25hbCA9IF9yZWYxMi5zaWduYWw7CiAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAzOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChmZXRjaCgiIi5jb25jYXQoX2Nocm9tZS5kZWZhdWx0LmdldEJhc2VQYXRoKCkpLmNvbmNhdChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfVEFHU19VUkwpLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAna2JuLXhzcmYnOiAndHJ1ZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgIH0pKTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDExLnNlbnQ7CiAgICAgICAgICBfY29udGV4dDExLm5leHQgPSA2OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2FwaS50aHJvd0lmTm90T2spKHJlc3BvbnNlKSk7CgogICAgICAgIGNhc2UgNjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UuanNvbigpKTsKCiAgICAgICAgY2FzZSA3OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgIH0KICAgIH0KICB9KTsKfTsKLyoqCiAqIEdldCBwcmUgcGFja2FnZWQgcnVsZXMgU3RhdHVzCiAqCiAqIEBwYXJhbSBzaWduYWwgQWJvcnRTaWduYWwgZm9yIGNhbmNlbGxpbmcgcmVxdWVzdAogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmZldGNoVGFncyA9IGZldGNoVGFnczsKCnZhciBnZXRQcmVQYWNrYWdlZFJ1bGVzU3RhdHVzID0gZnVuY3Rpb24gZ2V0UHJlUGFja2FnZWRSdWxlc1N0YXR1cyhfcmVmMTMpIHsKICB2YXIgc2lnbmFsLCByZXNwb25zZTsKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGdldFByZVBhY2thZ2VkUnVsZXNTdGF0dXMkKF9jb250ZXh0MTIpIHsKICAgIHdoaWxlICgxKSB7CiAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgc2lnbmFsID0gX3JlZjEzLnNpZ25hbDsKICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDM7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGZldGNoKCIiLmNvbmNhdChfY2hyb21lLmRlZmF1bHQuZ2V0QmFzZVBhdGgoKSkuY29uY2F0KF9jb25zdGFudHMuREVURUNUSU9OX0VOR0lORV9QUkVQQUNLQUdFRF9SVUxFU19TVEFUVVNfVVJMKSwgewogICAgICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgICAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJywKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgJ2tibi14c3JmJzogJ3RydWUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNpZ25hbDogc2lnbmFsCiAgICAgICAgICB9KSk7CgogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQxMi5zZW50OwogICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gNjsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9hcGkudGhyb3dJZk5vdE9rKShyZXNwb25zZSkpOwoKICAgICAgICBjYXNlIDY6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlLmpzb24oKSk7CgogICAgICAgIGNhc2UgNzoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn07CgpleHBvcnRzLmdldFByZVBhY2thZ2VkUnVsZXNTdGF0dXMgPSBnZXRQcmVQYWNrYWdlZFJ1bGVzU3RhdHVzOw=="},null]}