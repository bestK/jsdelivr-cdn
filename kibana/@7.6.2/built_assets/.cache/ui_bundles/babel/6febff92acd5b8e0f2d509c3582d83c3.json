{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/embeddable/public/lib/containers/container.js","dependencies":[{"path":"src/plugins/embeddable/public/lib/containers/container.js","mtime":1585205041650},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuQ29udGFpbmVyID0gdm9pZCAwOwoKdmFyIF91dWlkID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1dWlkIikpOwoKdmFyIF9yeGpzID0gcmVxdWlyZSgicnhqcyIpOwoKdmFyIF9lbWJlZGRhYmxlcyA9IHJlcXVpcmUoIi4uL2VtYmVkZGFibGVzIik7Cgp2YXIgX2Vycm9ycyA9IHJlcXVpcmUoIi4uL2Vycm9ycyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHsKICAgIF9nZXQgPSBSZWZsZWN0LmdldDsKICB9IGVsc2UgewogICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsKICAgICAgdmFyIGJhc2UgPSBfc3VwZXJQcm9wQmFzZSh0YXJnZXQsIHByb3BlcnR5KTsKCiAgICAgIGlmICghYmFzZSkgcmV0dXJuOwogICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkpOwoKICAgICAgaWYgKGRlc2MuZ2V0KSB7CiAgICAgICAgcmV0dXJuIGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIpOwogICAgICB9CgogICAgICByZXR1cm4gZGVzYy52YWx1ZTsKICAgIH07CiAgfQoKICByZXR1cm4gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlciB8fCB0YXJnZXQpOwp9CgpmdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7CiAgd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsKICAgIG9iamVjdCA9IF9nZXRQcm90b3R5cGVPZihvYmplY3QpOwogICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgYnJlYWs7CiAgfQoKICByZXR1cm4gb2JqZWN0Owp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBnZXRLZXlzID0gZnVuY3Rpb24gZ2V0S2V5cyhvKSB7CiAgcmV0dXJuIE9iamVjdC5rZXlzKG8pOwp9OwoKdmFyIENvbnRhaW5lciA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9FbWJlZGRhYmxlKSB7CiAgX2luaGVyaXRzKENvbnRhaW5lciwgX0VtYmVkZGFibGUpOwoKICBmdW5jdGlvbiBDb250YWluZXIoaW5wdXQsIG91dHB1dCwgZ2V0RmFjdG9yeSwgcGFyZW50KSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbnRhaW5lcik7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQ29udGFpbmVyKS5jYWxsKHRoaXMsIGlucHV0LCBvdXRwdXQsIHBhcmVudCkpOwogICAgX3RoaXMuZ2V0RmFjdG9yeSA9IGdldEZhY3Rvcnk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaXNDb250YWluZXIiLCB0cnVlKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjaGlsZHJlbiIsIHt9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdWJzY3JpcHRpb24iLCB2b2lkIDApOwoKICAgIF90aGlzLnN1YnNjcmlwdGlvbiA9IF90aGlzLmdldElucHV0JCgpLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpcy5tYXliZVVwZGF0ZUNoaWxkcmVuKCk7CiAgICB9KTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhDb250YWluZXIsIFt7CiAgICBrZXk6ICJ1cGRhdGVJbnB1dEZvckNoaWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVJbnB1dEZvckNoaWxkKGlkLCBjaGFuZ2VzKSB7CiAgICAgIGlmICghdGhpcy5pbnB1dC5wYW5lbHNbaWRdKSB7CiAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuUGFuZWxOb3RGb3VuZEVycm9yKCk7CiAgICAgIH0KCiAgICAgIHZhciBwYW5lbHMgPSB7CiAgICAgICAgcGFuZWxzOiBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmlucHV0LnBhbmVscywgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGhpcy5pbnB1dC5wYW5lbHNbaWRdLCB7CiAgICAgICAgICBleHBsaWNpdElucHV0OiBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmlucHV0LnBhbmVsc1tpZF0uZXhwbGljaXRJbnB1dCwge30sIGNoYW5nZXMpCiAgICAgICAgfSkpKQogICAgICB9OwogICAgICB0aGlzLnVwZGF0ZUlucHV0KHBhbmVscyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWxvYWQoKSB7CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5jaGlsZHJlbikuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICByZXR1cm4gY2hpbGQucmVsb2FkKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImFkZE5ld0VtYmVkZGFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZE5ld0VtYmVkZGFibGUodHlwZSwgZXhwbGljaXRJbnB1dCkgewogICAgICB2YXIgZmFjdG9yeSwgcGFuZWxTdGF0ZTsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBhZGROZXdFbWJlZGRhYmxlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBmYWN0b3J5ID0gdGhpcy5nZXRGYWN0b3J5KHR5cGUpOwoKICAgICAgICAgICAgICBpZiAoZmFjdG9yeSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRocm93IG5ldyBfZXJyb3JzLkVtYmVkZGFibGVGYWN0b3J5Tm90Rm91bmRFcnJvcih0eXBlKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBwYW5lbFN0YXRlID0gdGhpcy5jcmVhdGVOZXdQYW5lbFN0YXRlKGZhY3RvcnksIGV4cGxpY2l0SW5wdXQpOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHRoaXMuY3JlYXRlQW5kU2F2ZUVtYmVkZGFibGUodHlwZSwgcGFuZWxTdGF0ZSkpOwoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGRTYXZlZE9iamVjdEVtYmVkZGFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFNhdmVkT2JqZWN0RW1iZWRkYWJsZSh0eXBlLCBzYXZlZE9iamVjdElkKSB7CiAgICAgIHZhciBmYWN0b3J5LCBwYW5lbFN0YXRlOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGFkZFNhdmVkT2JqZWN0RW1iZWRkYWJsZSQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZmFjdG9yeSA9IHRoaXMuZ2V0RmFjdG9yeSh0eXBlKTsKICAgICAgICAgICAgICBwYW5lbFN0YXRlID0gdGhpcy5jcmVhdGVOZXdQYW5lbFN0YXRlKGZhY3RvcnkpOwogICAgICAgICAgICAgIHBhbmVsU3RhdGUuc2F2ZWRPYmplY3RJZCA9IHNhdmVkT2JqZWN0SWQ7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHRoaXMuY3JlYXRlQW5kU2F2ZUVtYmVkZGFibGUodHlwZSwgcGFuZWxTdGF0ZSkpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlRW1iZWRkYWJsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRW1iZWRkYWJsZShlbWJlZGRhYmxlSWQpIHsKICAgICAgLy8gSnVzdCBhIHNob3J0Y3V0IGZvciByZW1vdmluZyB0aGUgcGFuZWwgZnJvbSBpbnB1dCBzdGF0ZSwgYWxsIGludGVybmFsIHN0YXRlIHdpbGwgZ2V0IGNsZWFuZWQgdXAgbmF0dXJhbGx5CiAgICAgIC8vIGJ5IHRoZSBsaXN0ZW5lci4KICAgICAgdmFyIHBhbmVscyA9IF9vYmplY3RTcHJlYWQoe30sIHRoaXMuaW5wdXQucGFuZWxzKTsKCiAgICAgIGRlbGV0ZSBwYW5lbHNbZW1iZWRkYWJsZUlkXTsKICAgICAgdGhpcy51cGRhdGVJbnB1dCh7CiAgICAgICAgcGFuZWxzOiBwYW5lbHMKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Q2hpbGRJZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENoaWxkSWRzKCkgewogICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5jaGlsZHJlbik7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Q2hpbGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENoaWxkKGlkKSB7CiAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuW2lkXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRJbnB1dEZvckNoaWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbnB1dEZvckNoaWxkKGVtYmVkZGFibGVJZCkgewogICAgICB2YXIgY29udGFpbmVySW5wdXQgPSB0aGlzLmdldEluaGVyaXRlZElucHV0KGVtYmVkZGFibGVJZCk7CiAgICAgIHZhciBwYW5lbFN0YXRlID0gdGhpcy5nZXRQYW5lbFN0YXRlKGVtYmVkZGFibGVJZCk7CiAgICAgIHZhciBleHBsaWNpdElucHV0ID0gcGFuZWxTdGF0ZS5leHBsaWNpdElucHV0OwogICAgICB2YXIgZXhwbGljaXRGaWx0ZXJlZCA9IHt9OwogICAgICB2YXIga2V5cyA9IGdldEtleXMocGFuZWxTdGF0ZS5leHBsaWNpdElucHV0KTsgLy8gSWYgZXhwbGljaXQgaW5wdXQgZm9yIGEgcGFydGljdWxhciB2YWx1ZSBpcyB1bmRlZmluZWQsIGFuZCBjb250YWluZXIgaGFzIHRoYXQgaW5wdXQgZGVmaW5lZCwKICAgICAgLy8gd2Ugd2lsbCB1c2UgdGhlIGluaGVyaXRlZCBjb250YWluZXIgaW5wdXQuIFRoaXMgd2F5IGNoaWxkcmVuIGNhbiBzZXQgYSB2YWx1ZSB0byB1bmRlZmluZWQgaW4gb3JkZXIKICAgICAgLy8gdG8gZGVmYXVsdCBiYWNrIHRvIGluaGVyaXRlZCBpbnB1dC4gSG93ZXZlciwgaWYgdGhlIHBhcnRpY3VsYXIgdmFsdWUgaXMgbm90IHBhcnQgb2YgdGhlIGNvbnRhaW5lciwgdGhlbgogICAgICAvLyB0aGUgY2FsbGVyIG1heSBiZSB0cnlpbmcgdG8gZXhwbGljaXRseSB0ZWxsIHRoZSBjaGlsZCB0byBjbGVhciBvdXQgYSBnaXZlbiB2YWx1ZSwgc28gaW4gdGhhdCBjYXNlLCB3ZSB3YW50CiAgICAgIC8vIHRvIHBhc3MgaXQgYWxvbmcuCgogICAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIGlmIChleHBsaWNpdElucHV0W2tleV0gPT09IHVuZGVmaW5lZCAmJiBjb250YWluZXJJbnB1dFtrZXldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGV4cGxpY2l0RmlsdGVyZWRba2V5XSA9IGV4cGxpY2l0SW5wdXRba2V5XTsKICAgICAgfSk7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBjb250YWluZXJJbnB1dCwge30sIGV4cGxpY2l0RmlsdGVyZWQpOwogICAgfQogIH0sIHsKICAgIGtleTogImRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKENvbnRhaW5lci5wcm90b3R5cGUpLCAiZGVzdHJveSIsIHRoaXMpLmNhbGwodGhpcyk7CgogICAgICBPYmplY3QudmFsdWVzKHRoaXMuY2hpbGRyZW4pLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgcmV0dXJuIGNoaWxkLmRlc3Ryb3koKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAidW50aWxFbWJlZGRhYmxlTG9hZGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1bnRpbEVtYmVkZGFibGVMb2FkZWQoaWQpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIHVudGlsRW1iZWRkYWJsZUxvYWRlZCQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXQucGFuZWxzW2lkXSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgX2Vycm9ycy5QYW5lbE5vdEZvdW5kRXJyb3IoKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpZiAoIXRoaXMub3V0cHV0LmVtYmVkZGFibGVMb2FkZWRbaWRdKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB0aGlzLmNoaWxkcmVuW2lkXSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSAoMCwgX3J4anMubWVyZ2UpKF90aGlzMi5nZXRPdXRwdXQkKCksIF90aGlzMi5nZXRJbnB1dCQoKSkuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzMi5vdXRwdXQuZW1iZWRkYWJsZUxvYWRlZFtpZF0pIHsKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF90aGlzMi5jaGlsZHJlbltpZF0pOwogICAgICAgICAgICAgICAgICB9IC8vIElmIHdlIGhpdCB0aGlzLCB0aGUgcGFuZWwgd2FzIHJlbW92ZWQgYmVmb3JlIHRoZSBlbWJlZGRhYmxlIGZpbmlzaGVkIGxvYWRpbmcuCgoKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzMi5pbnB1dC5wYW5lbHNbaWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHVuZGVmaW5lZCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZU5ld1BhbmVsU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZU5ld1BhbmVsU3RhdGUoZmFjdG9yeSkgewogICAgICB2YXIgcGFydGlhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgogICAgICB2YXIgZW1iZWRkYWJsZUlkID0gcGFydGlhbC5pZCB8fCBfdXVpZC5kZWZhdWx0LnY0KCk7CgogICAgICB2YXIgZXhwbGljaXRJbnB1dCA9IHRoaXMuY3JlYXRlTmV3RXhwbGljaXRFbWJlZGRhYmxlSW5wdXQoZW1iZWRkYWJsZUlkLCBmYWN0b3J5LCBwYXJ0aWFsKTsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBmYWN0b3J5LnR5cGUsCiAgICAgICAgZXhwbGljaXRJbnB1dDogX29iamVjdFNwcmVhZCh7CiAgICAgICAgICBpZDogZW1iZWRkYWJsZUlkCiAgICAgICAgfSwgZXhwbGljaXRJbnB1dCkKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRQYW5lbFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQYW5lbFN0YXRlKGVtYmVkZGFibGVJZCkgewogICAgICBpZiAodGhpcy5pbnB1dC5wYW5lbHNbZW1iZWRkYWJsZUlkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuUGFuZWxOb3RGb3VuZEVycm9yKCk7CiAgICAgIH0KCiAgICAgIHZhciBwYW5lbFN0YXRlID0gdGhpcy5pbnB1dC5wYW5lbHNbZW1iZWRkYWJsZUlkXTsKICAgICAgcmV0dXJuIHBhbmVsU3RhdGU7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybiBzdGF0ZSB0aGF0IGNvbWVzIGZyb20gdGhlIGNvbnRhaW5lciBhbmQgaXMgcGFzc2VkIGRvd24gdG8gdGhlIGNoaWxkLiBGb3IgaW5zdGFuY2UsIHRpbWUgcmFuZ2UgYW5kCiAgICAgKiBmaWx0ZXJzIGFyZSBjb21tb24gaW5oZXJpdGVkIGlucHV0IHN0YXRlLiBOb3RlIHRoYXQgYW55IHN0YXRlIHN0b3JlZCBpbiBgdGhpcy5pbnB1dC5wYW5lbHNbZW1iZWRkYWJsZUlkXS5leHBsaWNpdElucHV0YAogICAgICogd2lsbCBvdmVycmlkZSBpbmhlcml0ZWQgaW5wdXQuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY3JlYXRlQW5kU2F2ZUVtYmVkZGFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUFuZFNhdmVFbWJlZGRhYmxlKHR5cGUsIHBhbmVsU3RhdGUpIHsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBjcmVhdGVBbmRTYXZlRW1iZWRkYWJsZSQoX2NvbnRleHQ0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgdGhpcy51cGRhdGVJbnB1dCh7CiAgICAgICAgICAgICAgICBwYW5lbHM6IF9vYmplY3RTcHJlYWQoe30sIHRoaXMuaW5wdXQucGFuZWxzLCBfZGVmaW5lUHJvcGVydHkoe30sIHBhbmVsU3RhdGUuZXhwbGljaXRJbnB1dC5pZCwgcGFuZWxTdGF0ZSkpLAogICAgICAgICAgICAgICAgaXNFbXB0eVN0YXRlOiBmYWxzZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMudW50aWxFbWJlZGRhYmxlTG9hZGVkKHBhbmVsU3RhdGUuZXhwbGljaXRJbnB1dC5pZCkpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDQuc2VudCk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVOZXdFeHBsaWNpdEVtYmVkZGFibGVJbnB1dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlTmV3RXhwbGljaXRFbWJlZGRhYmxlSW5wdXQoaWQsIGZhY3RvcnkpIHsKICAgICAgdmFyIHBhcnRpYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgaW5oZXJpdGVkSW5wdXQgPSB0aGlzLmdldEluaGVyaXRlZElucHV0KGlkKTsKICAgICAgdmFyIGRlZmF1bHRzID0gZmFjdG9yeS5nZXREZWZhdWx0SW5wdXQocGFydGlhbCk7IC8vIENvbnRhaW5lciBpbnB1dCBvdmVycmlkZXMgZGVmYXVsdHMuCgogICAgICB2YXIgZXhwbGljaXRJbnB1dCA9IHBhcnRpYWw7CiAgICAgIGdldEtleXMoZGVmYXVsdHMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIC8vIEB0cy1pZ25vcmUgV2Uga25vdyB0aGlzIGtleSBtaWdodCBub3QgZXhpc3Qgb24gaW5oZXJpdGVkSW5wdXQuCiAgICAgICAgdmFyIGluaGVyaXRlZFZhbHVlID0gaW5oZXJpdGVkSW5wdXRba2V5XTsKCiAgICAgICAgaWYgKGluaGVyaXRlZFZhbHVlID09PSB1bmRlZmluZWQgJiYgZXhwbGljaXRJbnB1dFtrZXldID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGV4cGxpY2l0SW5wdXRba2V5XSA9IGRlZmF1bHRzW2tleV07CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGV4cGxpY2l0SW5wdXQ7CiAgICB9CiAgfSwgewogICAga2V5OiAib25QYW5lbFJlbW92ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUGFuZWxSZW1vdmVkKGlkKSB7CiAgICAgIC8vIENsZWFuIHVwCiAgICAgIHZhciBlbWJlZGRhYmxlID0gdGhpcy5nZXRDaGlsZChpZCk7CgogICAgICBpZiAoZW1iZWRkYWJsZSkgewogICAgICAgIGVtYmVkZGFibGUuZGVzdHJveSgpOyAvLyBSZW1vdmUgcmVmZXJlbmNlcy4KCiAgICAgICAgZGVsZXRlIHRoaXMuY2hpbGRyZW5baWRdOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZU91dHB1dCh7CiAgICAgICAgZW1iZWRkYWJsZUxvYWRlZDogX29iamVjdFNwcmVhZCh7fSwgdGhpcy5vdXRwdXQuZW1iZWRkYWJsZUxvYWRlZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgdW5kZWZpbmVkKSkKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAib25QYW5lbEFkZGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblBhbmVsQWRkZWQocGFuZWwpIHsKICAgICAgdmFyIGVtYmVkZGFibGUsIGlucHV0Rm9yQ2hpbGQsIF9mYWN0b3J5OwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBvblBhbmVsQWRkZWQkKF9jb250ZXh0NSkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMudXBkYXRlT3V0cHV0KHsKICAgICAgICAgICAgICAgIGVtYmVkZGFibGVMb2FkZWQ6IF9vYmplY3RTcHJlYWQoe30sIHRoaXMub3V0cHV0LmVtYmVkZGFibGVMb2FkZWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgcGFuZWwuZXhwbGljaXRJbnB1dC5pZCwgZmFsc2UpKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlucHV0Rm9yQ2hpbGQgPSB0aGlzLmdldElucHV0Rm9yQ2hpbGQocGFuZWwuZXhwbGljaXRJbnB1dC5pZCk7CiAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAyOwogICAgICAgICAgICAgIF9mYWN0b3J5ID0gdGhpcy5nZXRGYWN0b3J5KHBhbmVsLnR5cGUpOwoKICAgICAgICAgICAgICBpZiAoX2ZhY3RvcnkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuRW1iZWRkYWJsZUZhY3RvcnlOb3RGb3VuZEVycm9yKHBhbmVsLnR5cGUpOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGlmICghcGFuZWwuc2F2ZWRPYmplY3RJZCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA5OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX2ZhY3RvcnkuY3JlYXRlRnJvbVNhdmVkT2JqZWN0KHBhbmVsLnNhdmVkT2JqZWN0SWQsIGlucHV0Rm9yQ2hpbGQsIHRoaXMpKTsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBfY29udGV4dDUudDAgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDE1OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDE0OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX2ZhY3RvcnkuY3JlYXRlKGlucHV0Rm9yQ2hpbGQsIHRoaXMpKTsKCiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgX2NvbnRleHQ1LnQwID0gX2NvbnRleHQ1LnNlbnQ7CgogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIGVtYmVkZGFibGUgPSBfY29udGV4dDUudDA7CiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAyMTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAxODsKICAgICAgICAgICAgICBfY29udGV4dDUudDEgPSBfY29udGV4dDVbImNhdGNoIl0oMik7CiAgICAgICAgICAgICAgZW1iZWRkYWJsZSA9IG5ldyBfZW1iZWRkYWJsZXMuRXJyb3JFbWJlZGRhYmxlKF9jb250ZXh0NS50MSwgewogICAgICAgICAgICAgICAgaWQ6IHBhbmVsLmV4cGxpY2l0SW5wdXQuaWQKICAgICAgICAgICAgICB9LCB0aGlzKTsKCiAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgaWYgKCFlbWJlZGRhYmxlKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodGhpcy5pbnB1dC5wYW5lbHNbcGFuZWwuZXhwbGljaXRJbnB1dC5pZF0pIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGVtYmVkZGFibGUuZGVzdHJveSgpOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgaWYgKGVtYmVkZGFibGUuZ2V0T3V0cHV0KCkuc2F2ZWRPYmplY3RJZCkgewogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVJbnB1dCh7CiAgICAgICAgICAgICAgICAgIHBhbmVsczogX29iamVjdFNwcmVhZCh7fSwgdGhpcy5pbnB1dC5wYW5lbHMsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgcGFuZWwuZXhwbGljaXRJbnB1dC5pZCwgX29iamVjdFNwcmVhZCh7fSwgdGhpcy5pbnB1dC5wYW5lbHNbcGFuZWwuZXhwbGljaXRJbnB1dC5pZF0sIHt9LCBlbWJlZGRhYmxlLmdldE91dHB1dCgpLnNhdmVkT2JqZWN0SWQgPyB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZWRPYmplY3RJZDogZW1iZWRkYWJsZS5nZXRPdXRwdXQoKS5zYXZlZE9iamVjdElkCiAgICAgICAgICAgICAgICAgIH0gOiB1bmRlZmluZWQsIHsKICAgICAgICAgICAgICAgICAgICBleHBsaWNpdElucHV0OiBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmlucHV0LnBhbmVsc1twYW5lbC5leHBsaWNpdElucHV0LmlkXS5leHBsaWNpdElucHV0KQogICAgICAgICAgICAgICAgICB9KSkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5bZW1iZWRkYWJsZS5pZF0gPSBlbWJlZGRhYmxlOwogICAgICAgICAgICAgIHRoaXMudXBkYXRlT3V0cHV0KHsKICAgICAgICAgICAgICAgIGVtYmVkZGFibGVMb2FkZWQ6IF9vYmplY3RTcHJlYWQoe30sIHRoaXMub3V0cHV0LmVtYmVkZGFibGVMb2FkZWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgcGFuZWwuZXhwbGljaXRJbnB1dC5pZCwgdHJ1ZSkpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAzMTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgaWYgKGVtYmVkZGFibGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVFbWJlZGRhYmxlKHBhbmVsLmV4cGxpY2l0SW5wdXQuaWQpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIGVtYmVkZGFibGUpOwoKICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMsIFtbMiwgMThdXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibWF5YmVVcGRhdGVDaGlsZHJlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbWF5YmVVcGRhdGVDaGlsZHJlbigpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgYWxsSWRzID0gT2JqZWN0LmtleXMoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5pbnB1dC5wYW5lbHMsIHt9LCB0aGlzLm91dHB1dC5lbWJlZGRhYmxlTG9hZGVkKSk7CiAgICAgIGFsbElkcy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICAgIGlmIChfdGhpczMuaW5wdXQucGFuZWxzW2lkXSAhPT0gdW5kZWZpbmVkICYmIF90aGlzMy5vdXRwdXQuZW1iZWRkYWJsZUxvYWRlZFtpZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgX3RoaXMzLm9uUGFuZWxBZGRlZChfdGhpczMuaW5wdXQucGFuZWxzW2lkXSk7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczMuaW5wdXQucGFuZWxzW2lkXSA9PT0gdW5kZWZpbmVkICYmIF90aGlzMy5vdXRwdXQuZW1iZWRkYWJsZUxvYWRlZFtpZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgX3RoaXMzLm9uUGFuZWxSZW1vdmVkKGlkKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIENvbnRhaW5lcjsKfShfZW1iZWRkYWJsZXMuRW1iZWRkYWJsZSk7CgpleHBvcnRzLkNvbnRhaW5lciA9IENvbnRhaW5lcjs="},null]}