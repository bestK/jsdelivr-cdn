{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/visualizations/public/np_ready/public/legacy/build_pipeline.js","dependencies":[{"path":"src/legacy/core_plugins/visualizations/public/np_ready/public/legacy/build_pipeline.js","mtime":1585205040499},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuYnVpbGRQaXBlbGluZSA9IGV4cG9ydHMuZ2V0VmlzUGFyYW1zID0gZXhwb3J0cy5idWlsZFZpc2xpYkRpbWVuc2lvbnMgPSBleHBvcnRzLmJ1aWxkUGlwZWxpbmVWaXNGdW5jdGlvbiA9IGV4cG9ydHMucHJlcGFyZURpbWVuc2lvbiA9IGV4cG9ydHMucHJlcGFyZVZhbHVlID0gZXhwb3J0cy5wcmVwYXJlU3RyaW5nID0gZXhwb3J0cy5lc2NhcGVTdHJpbmcgPSBleHBvcnRzLnByZXBhcmVKc29uID0gZXhwb3J0cy5nZXRTY2hlbWFzID0gdm9pZCAwOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfbW9tZW50ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJtb21lbnQiKSk7Cgp2YXIgX2xlZ2FjeV9pbXBvcnRzID0gcmVxdWlyZSgiLi4vLi4vLi4vbGVnYWN5X2ltcG9ydHMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgIGRlZmF1bHQ6IG9iagogIH07Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9Cgp2YXIgdmlzbGliQ2hhcnRzID0gWydhcmVhJywgJ2dhdWdlJywgJ2dvYWwnLCAnaGVhdG1hcCcsICdoaXN0b2dyYW0nLCAnaG9yaXpvbnRhbF9iYXInLCAnbGluZSddOwoKdmFyIGdldFNjaGVtYXMgPSBmdW5jdGlvbiBnZXRTY2hlbWFzKHZpcywgdGltZVJhbmdlKSB7CiAgdmFyIGNyZWF0ZVNjaGVtYUNvbmZpZyA9IGZ1bmN0aW9uIGNyZWF0ZVNjaGVtYUNvbmZpZyhhY2Nlc3NvciwgYWdnKSB7CiAgICBpZiAoKDAsIF9sZWdhY3lfaW1wb3J0cy5pc0RhdGVIaXN0b2dyYW1CdWNrZXRBZ2dDb25maWcpKGFnZykpIHsKICAgICAgYWdnLnBhcmFtcy50aW1lUmFuZ2UgPSB0aW1lUmFuZ2U7CiAgICAgICgwLCBfbGVnYWN5X2ltcG9ydHMuc2V0Qm91bmRzKShhZ2csIHRydWUpOwogICAgfQoKICAgIHZhciBoYXNTdWJBZ2cgPSBbJ2Rlcml2YXRpdmUnLCAnbW92aW5nX2F2ZycsICdzZXJpYWxfZGlmZicsICdjdW11bGF0aXZlX3N1bScsICdzdW1fYnVja2V0JywgJ2F2Z19idWNrZXQnLCAnbWluX2J1Y2tldCcsICdtYXhfYnVja2V0J10uaW5jbHVkZXMoYWdnLnR5cGUubmFtZSk7CiAgICB2YXIgZm9ybWF0ID0gKDAsIF9sZWdhY3lfaW1wb3J0cy5jcmVhdGVGb3JtYXQpKGhhc1N1YkFnZyA/IGFnZy5wYXJhbXMuY3VzdG9tTWV0cmljIHx8IGFnZy5hZ2dDb25maWdzLmdldFJlcXVlc3RBZ2dCeUlkKGFnZy5wYXJhbXMubWV0cmljQWdnKSA6IGFnZyk7CiAgICB2YXIgcGFyYW1zID0ge307CgogICAgaWYgKGFnZy50eXBlLm5hbWUgPT09ICdnZW9oYXNoX2dyaWQnKSB7CiAgICAgIHBhcmFtcy5wcmVjaXNpb24gPSBhZ2cucGFyYW1zLnByZWNpc2lvbjsKICAgICAgcGFyYW1zLnVzZUdlb2NlbnRyb2lkID0gYWdnLnBhcmFtcy51c2VHZW9jZW50cm9pZDsKICAgIH0KCiAgICB2YXIgbGFiZWwgPSBhZ2cubWFrZUxhYmVsICYmIGFnZy5tYWtlTGFiZWwoKTsKICAgIHJldHVybiB7CiAgICAgIGFjY2Vzc29yOiBhY2Nlc3NvciwKICAgICAgZm9ybWF0OiBmb3JtYXQsCiAgICAgIHBhcmFtczogcGFyYW1zLAogICAgICBsYWJlbDogbGFiZWwsCiAgICAgIGFnZ1R5cGU6IGFnZy50eXBlLm5hbWUKICAgIH07CiAgfTsKCiAgdmFyIGNudCA9IDA7CiAgdmFyIHNjaGVtYXMgPSB7CiAgICBtZXRyaWM6IFtdCiAgfTsKICB2YXIgcmVzcG9uc2VBZ2dzID0gdmlzLmFnZ3MuZ2V0UmVzcG9uc2VBZ2dzKCkuZmlsdGVyKGZ1bmN0aW9uIChhZ2cpIHsKICAgIHJldHVybiBhZ2cuZW5hYmxlZDsKICB9KTsKICB2YXIgaXNIaWVyYXJjaGljYWwgPSB2aXMuaXNIaWVyYXJjaGljYWwoKTsKICB2YXIgbWV0cmljcyA9IHJlc3BvbnNlQWdncy5maWx0ZXIoZnVuY3Rpb24gKGFnZykgewogICAgcmV0dXJuIGFnZy50eXBlLnR5cGUgPT09ICdtZXRyaWNzJzsKICB9KTsKICByZXNwb25zZUFnZ3MuZm9yRWFjaChmdW5jdGlvbiAoYWdnKSB7CiAgICB2YXIgc2tpcE1ldHJpY3MgPSBmYWxzZTsKICAgIHZhciBzY2hlbWFOYW1lID0gYWdnLnNjaGVtYSA/IGFnZy5zY2hlbWEubmFtZSB8fCBhZ2cuc2NoZW1hIDogbnVsbDsKCiAgICBpZiAoX3R5cGVvZihzY2hlbWFOYW1lKSA9PT0gJ29iamVjdCcpIHsKICAgICAgc2NoZW1hTmFtZSA9IG51bGw7CiAgICB9CgogICAgaWYgKCFzY2hlbWFOYW1lKSB7CiAgICAgIGlmIChhZ2cudHlwZS5uYW1lID09PSAnZ2VvX2NlbnRyb2lkJykgewogICAgICAgIHNjaGVtYU5hbWUgPSAnZ2VvX2NlbnRyb2lkJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBjbnQrKzsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KCiAgICBpZiAoc2NoZW1hTmFtZSA9PT0gJ3NwbGl0JykgewogICAgICBzY2hlbWFOYW1lID0gInNwbGl0XyIuY29uY2F0KGFnZy5wYXJhbXMucm93ID8gJ3JvdycgOiAnY29sdW1uJyk7CiAgICAgIHNraXBNZXRyaWNzID0gcmVzcG9uc2VBZ2dzLmxlbmd0aCAtIG1ldHJpY3MubGVuZ3RoID4gMTsKICAgIH0KCiAgICBpZiAoIXNjaGVtYXNbc2NoZW1hTmFtZV0pIHsKICAgICAgc2NoZW1hc1tzY2hlbWFOYW1lXSA9IFtdOwogICAgfQoKICAgIGlmICghaXNIaWVyYXJjaGljYWwgfHwgYWdnLnR5cGUudHlwZSAhPT0gJ21ldHJpY3MnKSB7CiAgICAgIHNjaGVtYXNbc2NoZW1hTmFtZV0ucHVzaChjcmVhdGVTY2hlbWFDb25maWcoY250KyssIGFnZykpOwogICAgfQoKICAgIGlmIChpc0hpZXJhcmNoaWNhbCAmJiAoYWdnLnR5cGUudHlwZSAhPT0gJ21ldHJpY3MnIHx8IG1ldHJpY3MubGVuZ3RoID09PSByZXNwb25zZUFnZ3MubGVuZ3RoKSkgewogICAgICBtZXRyaWNzLmZvckVhY2goZnVuY3Rpb24gKG1ldHJpYykgewogICAgICAgIHZhciBzY2hlbWFDb25maWcgPSBjcmVhdGVTY2hlbWFDb25maWcoY250KyssIG1ldHJpYyk7CgogICAgICAgIGlmICghc2tpcE1ldHJpY3MpIHsKICAgICAgICAgIHNjaGVtYXMubWV0cmljLnB1c2goc2NoZW1hQ29uZmlnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwogIHJldHVybiBzY2hlbWFzOwp9OwoKZXhwb3J0cy5nZXRTY2hlbWFzID0gZ2V0U2NoZW1hczsKCnZhciBwcmVwYXJlSnNvbiA9IGZ1bmN0aW9uIHByZXBhcmVKc29uKHZhcmlhYmxlLCBkYXRhKSB7CiAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuICcnOwogIH0KCiAgcmV0dXJuICIiLmNvbmNhdCh2YXJpYWJsZSwgIj0nIikuY29uY2F0KEpTT04uc3RyaW5naWZ5KGRhdGEpLnJlcGxhY2UoL1xcL2csICJcXFxcIikucmVwbGFjZSgvJy9nLCAiXFwnIiksICInICIpOwp9OwoKZXhwb3J0cy5wcmVwYXJlSnNvbiA9IHByZXBhcmVKc29uOwoKdmFyIGVzY2FwZVN0cmluZyA9IGZ1bmN0aW9uIGVzY2FwZVN0cmluZyhkYXRhKSB7CiAgcmV0dXJuIGRhdGEucmVwbGFjZSgvXFwvZywgIlxcXFwiKS5yZXBsYWNlKC8nL2csICJcXCciKTsKfTsKCmV4cG9ydHMuZXNjYXBlU3RyaW5nID0gZXNjYXBlU3RyaW5nOwoKdmFyIHByZXBhcmVTdHJpbmcgPSBmdW5jdGlvbiBwcmVwYXJlU3RyaW5nKHZhcmlhYmxlLCBkYXRhKSB7CiAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuICcnOwogIH0KCiAgcmV0dXJuICIiLmNvbmNhdCh2YXJpYWJsZSwgIj0nIikuY29uY2F0KGVzY2FwZVN0cmluZyhkYXRhKSwgIicgIik7Cn07CgpleHBvcnRzLnByZXBhcmVTdHJpbmcgPSBwcmVwYXJlU3RyaW5nOwoKdmFyIHByZXBhcmVWYWx1ZSA9IGZ1bmN0aW9uIHByZXBhcmVWYWx1ZSh2YXJpYWJsZSwgZGF0YSkgewogIHZhciByYXcgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwoKICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSB7CiAgICByZXR1cm4gJyc7CiAgfQoKICBpZiAocmF3KSB7CiAgICByZXR1cm4gIiIuY29uY2F0KHZhcmlhYmxlLCAiPSIpLmNvbmNhdChkYXRhLCAiICIpOwogIH0KCiAgc3dpdGNoIChfdHlwZW9mKGRhdGEpKSB7CiAgICBjYXNlICdzdHJpbmcnOgogICAgICByZXR1cm4gcHJlcGFyZVN0cmluZyh2YXJpYWJsZSwgZGF0YSk7CgogICAgY2FzZSAnb2JqZWN0JzoKICAgICAgcmV0dXJuIHByZXBhcmVKc29uKHZhcmlhYmxlLCBkYXRhKTsKCiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gIiIuY29uY2F0KHZhcmlhYmxlLCAiPSIpLmNvbmNhdChkYXRhLCAiICIpOwogIH0KfTsKCmV4cG9ydHMucHJlcGFyZVZhbHVlID0gcHJlcGFyZVZhbHVlOwoKdmFyIHByZXBhcmVEaW1lbnNpb24gPSBmdW5jdGlvbiBwcmVwYXJlRGltZW5zaW9uKHZhcmlhYmxlLCBkYXRhKSB7CiAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuICcnOwogIH0KCiAgdmFyIGV4cHIgPSAiIi5jb25jYXQodmFyaWFibGUsICI9e3Zpc2RpbWVuc2lvbiAiKS5jb25jYXQoZGF0YS5hY2Nlc3NvciwgIiAiKTsKCiAgaWYgKGRhdGEuZm9ybWF0KSB7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnZm9ybWF0JywgZGF0YS5mb3JtYXQuaWQpOwogICAgZXhwciArPSBwcmVwYXJlSnNvbignZm9ybWF0UGFyYW1zJywgZGF0YS5mb3JtYXQucGFyYW1zKTsKICB9CgogIGV4cHIgKz0gJ30gJzsKICByZXR1cm4gZXhwcjsKfTsKCmV4cG9ydHMucHJlcGFyZURpbWVuc2lvbiA9IHByZXBhcmVEaW1lbnNpb247Cgp2YXIgYWRqdXN0VmlzbGliRGltZW5zaW9uRm9ybW1hdGVycyA9IGZ1bmN0aW9uIGFkanVzdFZpc2xpYkRpbWVuc2lvbkZvcm1tYXRlcnModmlzLCBkaW1lbnNpb25zKSB7CiAgdmFyIHZpc1N0YXRlID0gdmlzLmdldEN1cnJlbnRTdGF0ZSgpOwogIHZhciB2aXNDb25maWcgPSB2aXNTdGF0ZS5wYXJhbXM7CiAgdmFyIHJlc3BvbnNlQWdncyA9IHZpcy5hZ2dzLmdldFJlc3BvbnNlQWdncygpLmZpbHRlcihmdW5jdGlvbiAoYWdnKSB7CiAgICByZXR1cm4gYWdnLmVuYWJsZWQ7CiAgfSk7CiAgKGRpbWVuc2lvbnMueSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbiAoeURpbWVuc2lvbikgewogICAgdmFyIHlBZ2cgPSByZXNwb25zZUFnZ3NbeURpbWVuc2lvbi5hY2Nlc3Nvcl07CiAgICB2YXIgc2VyaWVzUGFyYW0gPSAodmlzQ29uZmlnLnNlcmllc1BhcmFtcyB8fCBbXSkuZmluZChmdW5jdGlvbiAocGFyYW0pIHsKICAgICAgcmV0dXJuIHBhcmFtLmRhdGEuaWQgPT09IHlBZ2cuaWQ7CiAgICB9KTsKCiAgICBpZiAoc2VyaWVzUGFyYW0pIHsKICAgICAgdmFyIHVzZWRWYWx1ZUF4aXMgPSAodmlzQ29uZmlnLnZhbHVlQXhlcyB8fCBbXSkuZmluZChmdW5jdGlvbiAodmFsdWVBeGlzKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlQXhpcy5pZCA9PT0gc2VyaWVzUGFyYW0udmFsdWVBeGlzOwogICAgICB9KTsKCiAgICAgIGlmICgoMCwgX2xvZGFzaC5nZXQpKHVzZWRWYWx1ZUF4aXMsICdzY2FsZS5tb2RlJykgPT09ICdwZXJjZW50YWdlJykgewogICAgICAgIHlEaW1lbnNpb24uZm9ybWF0ID0gewogICAgICAgICAgaWQ6ICdwZXJjZW50JwogICAgICAgIH07CiAgICAgIH0KICAgIH0KCiAgICBpZiAoKDAsIF9sb2Rhc2guZ2V0KSh2aXNDb25maWcsICdnYXVnZS5wZXJjZW50YWdlTW9kZScpID09PSB0cnVlKSB7CiAgICAgIHlEaW1lbnNpb24uZm9ybWF0ID0gewogICAgICAgIGlkOiAncGVyY2VudCcKICAgICAgfTsKICAgIH0KICB9KTsKfTsKCnZhciBidWlsZFBpcGVsaW5lVmlzRnVuY3Rpb24gPSB7CiAgdmVnYTogZnVuY3Rpb24gdmVnYSh2aXNTdGF0ZSkgewogICAgcmV0dXJuICJ2ZWdhICIuY29uY2F0KHByZXBhcmVTdHJpbmcoJ3NwZWMnLCB2aXNTdGF0ZS5wYXJhbXMuc3BlYykpOwogIH0sCiAgaW5wdXRfY29udHJvbF92aXM6IGZ1bmN0aW9uIGlucHV0X2NvbnRyb2xfdmlzKHZpc1N0YXRlKSB7CiAgICByZXR1cm4gImlucHV0X2NvbnRyb2xfdmlzICIuY29uY2F0KHByZXBhcmVKc29uKCd2aXNDb25maWcnLCB2aXNTdGF0ZS5wYXJhbXMpKTsKICB9LAogIG1ldHJpY3M6IGZ1bmN0aW9uIG1ldHJpY3ModmlzU3RhdGUsIHNjaGVtYXMpIHsKICAgIHZhciB1aVN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKICAgIHZhciBtZXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB1bmRlZmluZWQ7CiAgICB2YXIgcGFyYW1zSnNvbiA9IHByZXBhcmVKc29uKCdwYXJhbXMnLCB2aXNTdGF0ZS5wYXJhbXMpOwogICAgdmFyIHVpU3RhdGVKc29uID0gcHJlcGFyZUpzb24oJ3VpU3RhdGUnLCB1aVN0YXRlKTsKICAgIHZhciBzYXZlZE9iamVjdElkUGFyYW0gPSBwcmVwYXJlU3RyaW5nKCdzYXZlZE9iamVjdElkJywgbWV0YSA9PT0gbnVsbCB8fCBtZXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtZXRhLnNhdmVkT2JqZWN0SWQpOwogICAgdmFyIHBhcmFtcyA9IFtwYXJhbXNKc29uLCB1aVN0YXRlSnNvbiwgc2F2ZWRPYmplY3RJZFBhcmFtXS5maWx0ZXIoZnVuY3Rpb24gKHBhcmFtKSB7CiAgICAgIHJldHVybiBCb29sZWFuKHBhcmFtKTsKICAgIH0pOwogICAgcmV0dXJuICJ0c3ZiICIuY29uY2F0KHBhcmFtcy5qb2luKCcgJykpOwogIH0sCiAgdGltZWxpb246IGZ1bmN0aW9uIHRpbWVsaW9uKHZpc1N0YXRlKSB7CiAgICB2YXIgZXhwcmVzc2lvbiA9IHByZXBhcmVTdHJpbmcoJ2V4cHJlc3Npb24nLCB2aXNTdGF0ZS5wYXJhbXMuZXhwcmVzc2lvbik7CiAgICB2YXIgaW50ZXJ2YWwgPSBwcmVwYXJlU3RyaW5nKCdpbnRlcnZhbCcsIHZpc1N0YXRlLnBhcmFtcy5pbnRlcnZhbCk7CiAgICByZXR1cm4gInRpbWVsaW9uX3ZpcyAiLmNvbmNhdChleHByZXNzaW9uKS5jb25jYXQoaW50ZXJ2YWwpOwogIH0sCiAgbWFya2Rvd246IGZ1bmN0aW9uIG1hcmtkb3duKHZpc1N0YXRlKSB7CiAgICB2YXIgX3Zpc1N0YXRlJHBhcmFtcyA9IHZpc1N0YXRlLnBhcmFtcywKICAgICAgICBtYXJrZG93biA9IF92aXNTdGF0ZSRwYXJhbXMubWFya2Rvd24sCiAgICAgICAgZm9udFNpemUgPSBfdmlzU3RhdGUkcGFyYW1zLmZvbnRTaXplLAogICAgICAgIG9wZW5MaW5rc0luTmV3VGFiID0gX3Zpc1N0YXRlJHBhcmFtcy5vcGVuTGlua3NJbk5ld1RhYjsKICAgIHZhciBlc2NhcGVkTWFya2Rvd24gPSAnJzsKCiAgICBpZiAodHlwZW9mIG1hcmtkb3duID09PSAnc3RyaW5nJyB8fCBtYXJrZG93biBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICBlc2NhcGVkTWFya2Rvd24gPSBlc2NhcGVTdHJpbmcobWFya2Rvd24udG9TdHJpbmcoKSk7CiAgICB9CgogICAgdmFyIGV4cHIgPSAibWFya2Rvd252aXMgJyIuY29uY2F0KGVzY2FwZWRNYXJrZG93biwgIicgIik7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnZm9udCcsICJ7Zm9udCBzaXplPSIuY29uY2F0KGZvbnRTaXplLCAifSIpLCB0cnVlKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdvcGVuTGlua3NJbk5ld1RhYicsIG9wZW5MaW5rc0luTmV3VGFiKTsKICAgIHJldHVybiBleHByOwogIH0sCiAgdGFibGU6IGZ1bmN0aW9uIHRhYmxlKHZpc1N0YXRlLCBzY2hlbWFzKSB7CiAgICB2YXIgdmlzQ29uZmlnID0gX29iamVjdFNwcmVhZCh7fSwgdmlzU3RhdGUucGFyYW1zLCB7fSwgYnVpbGRWaXNDb25maWcudGFibGUoc2NoZW1hcywgdmlzU3RhdGUucGFyYW1zKSk7CgogICAgcmV0dXJuICJraWJhbmFfdGFibGUgIi5jb25jYXQocHJlcGFyZUpzb24oJ3Zpc0NvbmZpZycsIHZpc0NvbmZpZykpOwogIH0sCiAgbWV0cmljOiBmdW5jdGlvbiBtZXRyaWModmlzU3RhdGUsIHNjaGVtYXMpIHsKICAgIHZhciBfdmlzU3RhdGUkcGFyYW1zJG1ldHIgPSB2aXNTdGF0ZS5wYXJhbXMubWV0cmljLAogICAgICAgIHBlcmNlbnRhZ2VNb2RlID0gX3Zpc1N0YXRlJHBhcmFtcyRtZXRyLnBlcmNlbnRhZ2VNb2RlLAogICAgICAgIHVzZVJhbmdlcyA9IF92aXNTdGF0ZSRwYXJhbXMkbWV0ci51c2VSYW5nZXMsCiAgICAgICAgY29sb3JTY2hlbWEgPSBfdmlzU3RhdGUkcGFyYW1zJG1ldHIuY29sb3JTY2hlbWEsCiAgICAgICAgbWV0cmljQ29sb3JNb2RlID0gX3Zpc1N0YXRlJHBhcmFtcyRtZXRyLm1ldHJpY0NvbG9yTW9kZSwKICAgICAgICBjb2xvcnNSYW5nZSA9IF92aXNTdGF0ZSRwYXJhbXMkbWV0ci5jb2xvcnNSYW5nZSwKICAgICAgICBsYWJlbHMgPSBfdmlzU3RhdGUkcGFyYW1zJG1ldHIubGFiZWxzLAogICAgICAgIGludmVydENvbG9ycyA9IF92aXNTdGF0ZSRwYXJhbXMkbWV0ci5pbnZlcnRDb2xvcnMsCiAgICAgICAgc3R5bGUgPSBfdmlzU3RhdGUkcGFyYW1zJG1ldHIuc3R5bGU7CiAgICB2YXIgX2J1aWxkVmlzQ29uZmlnJG1ldHJpID0gYnVpbGRWaXNDb25maWcubWV0cmljKHNjaGVtYXMpLmRpbWVuc2lvbnMsCiAgICAgICAgbWV0cmljcyA9IF9idWlsZFZpc0NvbmZpZyRtZXRyaS5tZXRyaWNzLAogICAgICAgIGJ1Y2tldCA9IF9idWlsZFZpc0NvbmZpZyRtZXRyaS5idWNrZXQ7IC8vIGZpeCBmb3JtYXR0ZXIgZm9yIHBlcmNlbnRhZ2UgbW9kZQoKICAgIGlmICgoMCwgX2xvZGFzaC5nZXQpKHZpc1N0YXRlLnBhcmFtcywgJ21ldHJpYy5wZXJjZW50YWdlTW9kZScpID09PSB0cnVlKSB7CiAgICAgIG1ldHJpY3MuZm9yRWFjaChmdW5jdGlvbiAobWV0cmljKSB7CiAgICAgICAgbWV0cmljLmZvcm1hdCA9IHsKICAgICAgICAgIGlkOiAncGVyY2VudCcKICAgICAgICB9OwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgZXhwciA9ICJtZXRyaWN2aXMgIjsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdwZXJjZW50YWdlJywgcGVyY2VudGFnZU1vZGUpOwogICAgZXhwciArPSBwcmVwYXJlVmFsdWUoJ2NvbG9yU2NoZW1lJywgY29sb3JTY2hlbWEpOwogICAgZXhwciArPSBwcmVwYXJlVmFsdWUoJ2NvbG9yTW9kZScsIG1ldHJpY0NvbG9yTW9kZSk7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgndXNlUmFuZ2VzJywgdXNlUmFuZ2VzKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdpbnZlcnRDb2xvcnMnLCBpbnZlcnRDb2xvcnMpOwogICAgZXhwciArPSBwcmVwYXJlVmFsdWUoJ3Nob3dMYWJlbHMnLCBsYWJlbHMgJiYgbGFiZWxzLnNob3cpOwoKICAgIGlmIChzdHlsZSkgewogICAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnYmdGaWxsJywgc3R5bGUuYmdGaWxsKTsKICAgICAgZXhwciArPSBwcmVwYXJlVmFsdWUoJ2ZvbnQnLCAie2ZvbnQgc2l6ZT0iLmNvbmNhdChzdHlsZS5mb250U2l6ZSwgIn0iKSwgdHJ1ZSk7CiAgICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdzdWJUZXh0Jywgc3R5bGUuc3ViVGV4dCk7CiAgICAgIGV4cHIgKz0gcHJlcGFyZURpbWVuc2lvbignYnVja2V0JywgYnVja2V0KTsKICAgIH0KCiAgICBpZiAoY29sb3JzUmFuZ2UpIHsKICAgICAgY29sb3JzUmFuZ2UuZm9yRWFjaChmdW5jdGlvbiAocmFuZ2UpIHsKICAgICAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnY29sb3JSYW5nZScsICJ7cmFuZ2UgZnJvbT0iLmNvbmNhdChyYW5nZS5mcm9tLCAiIHRvPSIpLmNvbmNhdChyYW5nZS50bywgIn0iKSwgdHJ1ZSk7CiAgICAgIH0pOwogICAgfQoKICAgIG1ldHJpY3MuZm9yRWFjaChmdW5jdGlvbiAobWV0cmljKSB7CiAgICAgIGV4cHIgKz0gcHJlcGFyZURpbWVuc2lvbignbWV0cmljJywgbWV0cmljKTsKICAgIH0pOwogICAgcmV0dXJuIGV4cHI7CiAgfSwKICB0YWdjbG91ZDogZnVuY3Rpb24gdGFnY2xvdWQodmlzU3RhdGUsIHNjaGVtYXMpIHsKICAgIHZhciBfdmlzU3RhdGUkcGFyYW1zMiA9IHZpc1N0YXRlLnBhcmFtcywKICAgICAgICBzY2FsZSA9IF92aXNTdGF0ZSRwYXJhbXMyLnNjYWxlLAogICAgICAgIG9yaWVudGF0aW9uID0gX3Zpc1N0YXRlJHBhcmFtczIub3JpZW50YXRpb24sCiAgICAgICAgbWluRm9udFNpemUgPSBfdmlzU3RhdGUkcGFyYW1zMi5taW5Gb250U2l6ZSwKICAgICAgICBtYXhGb250U2l6ZSA9IF92aXNTdGF0ZSRwYXJhbXMyLm1heEZvbnRTaXplLAogICAgICAgIHNob3dMYWJlbCA9IF92aXNTdGF0ZSRwYXJhbXMyLnNob3dMYWJlbDsKCiAgICB2YXIgX2J1aWxkVmlzQ29uZmlnJHRhZ2NsID0gYnVpbGRWaXNDb25maWcudGFnY2xvdWQoc2NoZW1hcyksCiAgICAgICAgbWV0cmljID0gX2J1aWxkVmlzQ29uZmlnJHRhZ2NsLm1ldHJpYywKICAgICAgICBidWNrZXQgPSBfYnVpbGRWaXNDb25maWckdGFnY2wuYnVja2V0OwoKICAgIHZhciBleHByID0gInRhZ2Nsb3VkIG1ldHJpYz17dmlzZGltZW5zaW9uICIuY29uY2F0KG1ldHJpYy5hY2Nlc3NvciwgIn0gIik7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnc2NhbGUnLCBzY2FsZSk7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnb3JpZW50YXRpb24nLCBvcmllbnRhdGlvbik7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnbWluRm9udFNpemUnLCBtaW5Gb250U2l6ZSk7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnbWF4Rm9udFNpemUnLCBtYXhGb250U2l6ZSk7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnc2hvd0xhYmVsJywgc2hvd0xhYmVsKTsKICAgIGV4cHIgKz0gcHJlcGFyZURpbWVuc2lvbignYnVja2V0JywgYnVja2V0KTsKICAgIHJldHVybiBleHByOwogIH0sCiAgcmVnaW9uX21hcDogZnVuY3Rpb24gcmVnaW9uX21hcCh2aXNTdGF0ZSwgc2NoZW1hcykgewogICAgdmFyIHZpc0NvbmZpZyA9IF9vYmplY3RTcHJlYWQoe30sIHZpc1N0YXRlLnBhcmFtcywge30sIGJ1aWxkVmlzQ29uZmlnLnJlZ2lvbl9tYXAoc2NoZW1hcykpOwoKICAgIHJldHVybiAicmVnaW9ubWFwICIuY29uY2F0KHByZXBhcmVKc29uKCd2aXNDb25maWcnLCB2aXNDb25maWcpKTsKICB9LAogIHRpbGVfbWFwOiBmdW5jdGlvbiB0aWxlX21hcCh2aXNTdGF0ZSwgc2NoZW1hcykgewogICAgdmFyIHZpc0NvbmZpZyA9IF9vYmplY3RTcHJlYWQoe30sIHZpc1N0YXRlLnBhcmFtcywge30sIGJ1aWxkVmlzQ29uZmlnLnRpbGVfbWFwKHNjaGVtYXMpKTsKCiAgICByZXR1cm4gInRpbGVtYXAgIi5jb25jYXQocHJlcGFyZUpzb24oJ3Zpc0NvbmZpZycsIHZpc0NvbmZpZykpOwogIH0sCiAgcGllOiBmdW5jdGlvbiBwaWUodmlzU3RhdGUsIHNjaGVtYXMpIHsKICAgIHZhciB2aXNDb25maWcgPSBfb2JqZWN0U3ByZWFkKHt9LCB2aXNTdGF0ZS5wYXJhbXMsIHt9LCBidWlsZFZpc0NvbmZpZy5waWUoc2NoZW1hcykpOwoKICAgIHJldHVybiAia2liYW5hX3BpZSAiLmNvbmNhdChwcmVwYXJlSnNvbigndmlzQ29uZmlnJywgdmlzQ29uZmlnKSk7CiAgfQp9OwpleHBvcnRzLmJ1aWxkUGlwZWxpbmVWaXNGdW5jdGlvbiA9IGJ1aWxkUGlwZWxpbmVWaXNGdW5jdGlvbjsKdmFyIGJ1aWxkVmlzQ29uZmlnID0gewogIHRhYmxlOiBmdW5jdGlvbiB0YWJsZShzY2hlbWFzKSB7CiAgICB2YXIgdmlzUGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgIHZhciB2aXNDb25maWcgPSB7fTsKICAgIHZhciBtZXRyaWNzID0gc2NoZW1hcy5tZXRyaWM7CiAgICB2YXIgYnVja2V0cyA9IHNjaGVtYXMuYnVja2V0IHx8IFtdOwogICAgdmlzQ29uZmlnLmRpbWVuc2lvbnMgPSB7CiAgICAgIG1ldHJpY3M6IG1ldHJpY3MsCiAgICAgIGJ1Y2tldHM6IGJ1Y2tldHMsCiAgICAgIHNwbGl0Um93OiBzY2hlbWFzLnNwbGl0X3JvdywKICAgICAgc3BsaXRDb2x1bW46IHNjaGVtYXMuc3BsaXRfY29sdW1uCiAgICB9OwoKICAgIGlmICh2aXNQYXJhbXMuc2hvd01ldHJpY3NBdEFsbExldmVscyA9PT0gZmFsc2UgJiYgdmlzUGFyYW1zLnNob3dQYXJ0aWFsUm93cyA9PT0gdHJ1ZSkgewogICAgICAvLyBIYW5kbGUgY2FzZSB3aGVyZSB1c2VyIHdhbnRzIHRvIHNlZSBwYXJ0aWFsIHJvd3MgYnV0IG5vdCBtZXRyaWNzIGF0IGFsbCBsZXZlbHMuCiAgICAgIC8vIFRoaXMgcmVxdWlyZXMgY2FsY3VsYXRpbmcgaG93IG1hbnkgbWV0cmljcyB3aWxsIGNvbWUgYmFjayBpbiB0aGUgdGFiaWZpZWQgcmVzcG9uc2UsCiAgICAgIC8vIGFuZCByZW1vdmluZyBhbGwgbWV0cmljcyBmcm9tIHRoZSBkaW1lbnNpb25zIGV4Y2VwdCB0aGUgbGFzdCBzZXQuCiAgICAgIHZhciBtZXRyaWNzUGVyQnVja2V0ID0gbWV0cmljcy5sZW5ndGggLyBidWNrZXRzLmxlbmd0aDsKICAgICAgdmlzQ29uZmlnLmRpbWVuc2lvbnMubWV0cmljcy5zcGxpY2UoMCwgbWV0cmljc1BlckJ1Y2tldCAqIGJ1Y2tldHMubGVuZ3RoIC0gbWV0cmljc1BlckJ1Y2tldCk7CiAgICB9CgogICAgcmV0dXJuIHZpc0NvbmZpZzsKICB9LAogIG1ldHJpYzogZnVuY3Rpb24gbWV0cmljKHNjaGVtYXMpIHsKICAgIHZhciB2aXNDb25maWcgPSB7CiAgICAgIGRpbWVuc2lvbnM6IHt9CiAgICB9OwogICAgdmlzQ29uZmlnLmRpbWVuc2lvbnMubWV0cmljcyA9IHNjaGVtYXMubWV0cmljOwoKICAgIGlmIChzY2hlbWFzLmdyb3VwKSB7CiAgICAgIHZpc0NvbmZpZy5kaW1lbnNpb25zLmJ1Y2tldCA9IHNjaGVtYXMuZ3JvdXBbMF07CiAgICB9CgogICAgcmV0dXJuIHZpc0NvbmZpZzsKICB9LAogIHRhZ2Nsb3VkOiBmdW5jdGlvbiB0YWdjbG91ZChzY2hlbWFzKSB7CiAgICB2YXIgdmlzQ29uZmlnID0ge307CiAgICB2aXNDb25maWcubWV0cmljID0gc2NoZW1hcy5tZXRyaWNbMF07CgogICAgaWYgKHNjaGVtYXMuc2VnbWVudCkgewogICAgICB2aXNDb25maWcuYnVja2V0ID0gc2NoZW1hcy5zZWdtZW50WzBdOwogICAgfQoKICAgIHJldHVybiB2aXNDb25maWc7CiAgfSwKICByZWdpb25fbWFwOiBmdW5jdGlvbiByZWdpb25fbWFwKHNjaGVtYXMpIHsKICAgIHZhciB2aXNDb25maWcgPSB7fTsKICAgIHZpc0NvbmZpZy5tZXRyaWMgPSBzY2hlbWFzLm1ldHJpY1swXTsKCiAgICBpZiAoc2NoZW1hcy5zZWdtZW50KSB7CiAgICAgIHZpc0NvbmZpZy5idWNrZXQgPSBzY2hlbWFzLnNlZ21lbnRbMF07CiAgICB9CgogICAgcmV0dXJuIHZpc0NvbmZpZzsKICB9LAogIHRpbGVfbWFwOiBmdW5jdGlvbiB0aWxlX21hcChzY2hlbWFzKSB7CiAgICB2YXIgdmlzQ29uZmlnID0ge307CiAgICB2aXNDb25maWcuZGltZW5zaW9ucyA9IHsKICAgICAgbWV0cmljOiBzY2hlbWFzLm1ldHJpY1swXSwKICAgICAgZ2VvaGFzaDogc2NoZW1hcy5zZWdtZW50ID8gc2NoZW1hcy5zZWdtZW50WzBdIDogbnVsbCwKICAgICAgZ2VvY2VudHJvaWQ6IHNjaGVtYXMuZ2VvX2NlbnRyb2lkID8gc2NoZW1hcy5nZW9fY2VudHJvaWRbMF0gOiBudWxsCiAgICB9OwogICAgcmV0dXJuIHZpc0NvbmZpZzsKICB9LAogIHBpZTogZnVuY3Rpb24gcGllKHNjaGVtYXMpIHsKICAgIHZhciB2aXNDb25maWcgPSB7fTsKICAgIHZpc0NvbmZpZy5kaW1lbnNpb25zID0gewogICAgICBtZXRyaWM6IHNjaGVtYXMubWV0cmljWzBdLAogICAgICBidWNrZXRzOiBzY2hlbWFzLnNlZ21lbnQsCiAgICAgIHNwbGl0Um93OiBzY2hlbWFzLnNwbGl0X3JvdywKICAgICAgc3BsaXRDb2x1bW46IHNjaGVtYXMuc3BsaXRfY29sdW1uCiAgICB9OwogICAgcmV0dXJuIHZpc0NvbmZpZzsKICB9Cn07Cgp2YXIgYnVpbGRWaXNsaWJEaW1lbnNpb25zID0gZnVuY3Rpb24gYnVpbGRWaXNsaWJEaW1lbnNpb25zKHZpcywgcGFyYW1zKSB7CiAgdmFyIHNjaGVtYXMsIGRpbWVuc2lvbnMsIHhBZ2csIF94QWdnJGJ1Y2tldHMkZ2V0SW50ZSwgZXNVbml0LCBlc1ZhbHVlLCBpbnRlcnZhbFBhcmFtLCBvdXRwdXQ7CgogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gYnVpbGRWaXNsaWJEaW1lbnNpb25zJChfY29udGV4dCkgewogICAgd2hpbGUgKDEpIHsKICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHNjaGVtYXMgPSBnZXRTY2hlbWFzKHZpcywgcGFyYW1zLnRpbWVSYW5nZSk7CiAgICAgICAgICBkaW1lbnNpb25zID0gewogICAgICAgICAgICB4OiBzY2hlbWFzLnNlZ21lbnQgPyBzY2hlbWFzLnNlZ21lbnRbMF0gOiBudWxsLAogICAgICAgICAgICB5OiBzY2hlbWFzLm1ldHJpYywKICAgICAgICAgICAgejogc2NoZW1hcy5yYWRpdXMsCiAgICAgICAgICAgIHdpZHRoOiBzY2hlbWFzLndpZHRoLAogICAgICAgICAgICBzZXJpZXM6IHNjaGVtYXMuZ3JvdXAsCiAgICAgICAgICAgIHNwbGl0Um93OiBzY2hlbWFzLnNwbGl0X3JvdywKICAgICAgICAgICAgc3BsaXRDb2x1bW46IHNjaGVtYXMuc3BsaXRfY29sdW1uCiAgICAgICAgICB9OwoKICAgICAgICAgIGlmICghc2NoZW1hcy5zZWdtZW50KSB7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgeEFnZyA9IHZpcy5hZ2dzLmdldFJlc3BvbnNlQWdncygpW2RpbWVuc2lvbnMueC5hY2Nlc3Nvcl07CgogICAgICAgICAgaWYgKCEoeEFnZy50eXBlLm5hbWUgPT09ICdkYXRlX2hpc3RvZ3JhbScpKSB7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgZGltZW5zaW9ucy54LnBhcmFtcy5kYXRlID0gdHJ1ZTsKICAgICAgICAgIF94QWdnJGJ1Y2tldHMkZ2V0SW50ZSA9IHhBZ2cuYnVja2V0cy5nZXRJbnRlcnZhbCgpLCBlc1VuaXQgPSBfeEFnZyRidWNrZXRzJGdldEludGUuZXNVbml0LCBlc1ZhbHVlID0gX3hBZ2ckYnVja2V0cyRnZXRJbnRlLmVzVmFsdWU7CiAgICAgICAgICBkaW1lbnNpb25zLngucGFyYW1zLmludGVydmFsID0gX21vbWVudC5kZWZhdWx0LmR1cmF0aW9uKGVzVmFsdWUsIGVzVW5pdCk7CiAgICAgICAgICBkaW1lbnNpb25zLngucGFyYW1zLmludGVydmFsRVNWYWx1ZSA9IGVzVmFsdWU7CiAgICAgICAgICBkaW1lbnNpb25zLngucGFyYW1zLmludGVydmFsRVNVbml0ID0gZXNVbml0OwogICAgICAgICAgZGltZW5zaW9ucy54LnBhcmFtcy5mb3JtYXQgPSB4QWdnLmJ1Y2tldHMuZ2V0U2NhbGVkRGF0ZUZvcm1hdCgpOwogICAgICAgICAgZGltZW5zaW9ucy54LnBhcmFtcy5ib3VuZHMgPSB4QWdnLmJ1Y2tldHMuZ2V0Qm91bmRzKCk7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjE7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxNDoKICAgICAgICAgIGlmICghKHhBZ2cudHlwZS5uYW1lID09PSAnaGlzdG9ncmFtJykpIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBpbnRlcnZhbFBhcmFtID0geEFnZy50eXBlLnBhcmFtQnlOYW1lKCdpbnRlcnZhbCcpOwogICAgICAgICAgb3V0cHV0ID0gewogICAgICAgICAgICBwYXJhbXM6IHt9CiAgICAgICAgICB9OwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE5OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChpbnRlcnZhbFBhcmFtLm1vZGlmeUFnZ0NvbmZpZ09uU2VhcmNoUmVxdWVzdFN0YXJ0KHhBZ2csIHBhcmFtcy5zZWFyY2hTb3VyY2UsIHsKICAgICAgICAgICAgYWJvcnRTaWduYWw6IHBhcmFtcy5hYm9ydFNpZ25hbAogICAgICAgICAgfSkpOwoKICAgICAgICBjYXNlIDE5OgogICAgICAgICAgaW50ZXJ2YWxQYXJhbS53cml0ZSh4QWdnLCBvdXRwdXQpOwogICAgICAgICAgZGltZW5zaW9ucy54LnBhcmFtcy5pbnRlcnZhbCA9IG91dHB1dC5wYXJhbXMuaW50ZXJ2YWw7CgogICAgICAgIGNhc2UgMjE6CiAgICAgICAgICBhZGp1c3RWaXNsaWJEaW1lbnNpb25Gb3JtbWF0ZXJzKHZpcywgZGltZW5zaW9ucyk7CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBkaW1lbnNpb25zKTsKCiAgICAgICAgY2FzZSAyMzoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9OyAvLyBJZiBub3QgdXNpbmcgdGhlIGV4cHJlc3Npb24gcGlwZWxpbmUgKGkuZS4gdmlzdWFsaXplX2RhdGFfbG9hZGVyKSwgd2UgbmVlZCBhIG1lY2hhbmlzbSB0bwovLyB0YWtlIGEgVmlzIG9iamVjdCBhbmQgZGVjb3JhdGUgaXQgd2l0aCB0aGUgbmVjZXNzYXJ5IHBhcmFtcyAoZGltZW5zaW9ucywgYnVja2V0LCBtZXRyaWMsIGV0YykKCgpleHBvcnRzLmJ1aWxkVmlzbGliRGltZW5zaW9ucyA9IGJ1aWxkVmlzbGliRGltZW5zaW9uczsKCnZhciBnZXRWaXNQYXJhbXMgPSBmdW5jdGlvbiBnZXRWaXNQYXJhbXModmlzLCBwYXJhbXMpIHsKICB2YXIgc2NoZW1hcywgdmlzQ29uZmlnOwogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZ2V0VmlzUGFyYW1zJChfY29udGV4dDIpIHsKICAgIHdoaWxlICgxKSB7CiAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHNjaGVtYXMgPSBnZXRTY2hlbWFzKHZpcywgcGFyYW1zLnRpbWVSYW5nZSk7CiAgICAgICAgICB2aXNDb25maWcgPSAoMCwgX2xvZGFzaC5jbG9uZURlZXApKHZpcy5wYXJhbXMpOwoKICAgICAgICAgIGlmICghYnVpbGRWaXNDb25maWdbdmlzLnR5cGUubmFtZV0pIHsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICB2aXNDb25maWcgPSBfb2JqZWN0U3ByZWFkKHt9LCB2aXNDb25maWcsIHt9LCBidWlsZFZpc0NvbmZpZ1t2aXMudHlwZS5uYW1lXShzY2hlbWFzLCB2aXNDb25maWcpKTsKICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTA7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSA2OgogICAgICAgICAgaWYgKCF2aXNsaWJDaGFydHMuaW5jbHVkZXModmlzLnR5cGUubmFtZSkpIHsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChidWlsZFZpc2xpYkRpbWVuc2lvbnModmlzLCBwYXJhbXMpKTsKCiAgICAgICAgY2FzZSA5OgogICAgICAgICAgdmlzQ29uZmlnLmRpbWVuc2lvbnMgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgY2FzZSAxMDoKICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB2aXNDb25maWcpOwoKICAgICAgICBjYXNlIDExOgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9OwoKZXhwb3J0cy5nZXRWaXNQYXJhbXMgPSBnZXRWaXNQYXJhbXM7Cgp2YXIgYnVpbGRQaXBlbGluZSA9IGZ1bmN0aW9uIGJ1aWxkUGlwZWxpbmUodmlzLCBwYXJhbXMpIHsKICB2YXIgc2VhcmNoU291cmNlLCBpbmRleFBhdHRlcm4sIHF1ZXJ5LCBmaWx0ZXJzLCB2aXNTdGF0ZSwgdWlTdGF0ZSwgcGlwZWxpbmUsIHNjaGVtYXMsIF92aXNDb25maWcsIF92aXNDb25maWcyOwoKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGJ1aWxkUGlwZWxpbmUkKF9jb250ZXh0MykgewogICAgd2hpbGUgKDEpIHsKICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgc2VhcmNoU291cmNlID0gcGFyYW1zLnNlYXJjaFNvdXJjZTsKICAgICAgICAgIGluZGV4UGF0dGVybiA9IHZpcy5pbmRleFBhdHRlcm47CiAgICAgICAgICBxdWVyeSA9IHNlYXJjaFNvdXJjZS5nZXRGaWVsZCgncXVlcnknKTsKICAgICAgICAgIGZpbHRlcnMgPSBzZWFyY2hTb3VyY2UuZ2V0RmllbGQoJ2ZpbHRlcicpOwogICAgICAgICAgdmlzU3RhdGUgPSB2aXMuZ2V0Q3VycmVudFN0YXRlKCk7CiAgICAgICAgICB1aVN0YXRlID0gdmlzLmdldFVpU3RhdGUoKTsgLy8gY29udGV4dAoKICAgICAgICAgIHBpcGVsaW5lID0gImtpYmFuYSB8IGtpYmFuYV9jb250ZXh0ICI7CgogICAgICAgICAgaWYgKHF1ZXJ5KSB7CiAgICAgICAgICAgIHBpcGVsaW5lICs9IHByZXBhcmVKc29uKCdxdWVyeScsIHF1ZXJ5KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZmlsdGVycykgewogICAgICAgICAgICBwaXBlbGluZSArPSBwcmVwYXJlSnNvbignZmlsdGVycycsIGZpbHRlcnMpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh2aXMuc2F2ZWRTZWFyY2hJZCkgewogICAgICAgICAgICBwaXBlbGluZSArPSBwcmVwYXJlU3RyaW5nKCdzYXZlZFNlYXJjaElkJywgdmlzLnNhdmVkU2VhcmNoSWQpOwogICAgICAgICAgfQoKICAgICAgICAgIHBpcGVsaW5lICs9ICd8ICc7IC8vIHJlcXVlc3QgaGFuZGxlcgoKICAgICAgICAgIGlmICh2aXMudHlwZS5yZXF1ZXN0SGFuZGxlciA9PT0gJ2NvdXJpZXInKSB7CiAgICAgICAgICAgIHBpcGVsaW5lICs9ICJlc2FnZ3NcbiAgICAiLmNvbmNhdChwcmVwYXJlU3RyaW5nKCdpbmRleCcsIGluZGV4UGF0dGVybi5pZCksICJcbiAgICBtZXRyaWNzQXRBbGxMZXZlbHM9IikuY29uY2F0KHZpcy5pc0hpZXJhcmNoaWNhbCgpLCAiXG4gICAgcGFydGlhbFJvd3M9IikuY29uY2F0KHZpcy50eXBlLnJlcXVpcmVzUGFydGlhbFJvd3MgfHwgdmlzLnBhcmFtcy5zaG93UGFydGlhbFJvd3MgfHwgZmFsc2UsICJcbiAgICAiKS5jb25jYXQocHJlcGFyZUpzb24oJ2FnZ0NvbmZpZ3MnLCB2aXNTdGF0ZS5hZ2dzKSwgIiB8ICIpOwogICAgICAgICAgfQoKICAgICAgICAgIHNjaGVtYXMgPSBnZXRTY2hlbWFzKHZpcywgcGFyYW1zLnRpbWVSYW5nZSk7CgogICAgICAgICAgaWYgKCFidWlsZFBpcGVsaW5lVmlzRnVuY3Rpb25bdmlzLnR5cGUubmFtZV0pIHsKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgcGlwZWxpbmUgKz0gYnVpbGRQaXBlbGluZVZpc0Z1bmN0aW9uW3Zpcy50eXBlLm5hbWVdKHZpc1N0YXRlLCBzY2hlbWFzLCB1aVN0YXRlLCB7CiAgICAgICAgICAgIHNhdmVkT2JqZWN0SWQ6IHBhcmFtcy5zYXZlZE9iamVjdElkCiAgICAgICAgICB9KTsKICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzY7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxNzoKICAgICAgICAgIGlmICghdmlzbGliQ2hhcnRzLmluY2x1ZGVzKHZpcy50eXBlLm5hbWUpKSB7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIF92aXNDb25maWcgPSB2aXNTdGF0ZS5wYXJhbXM7CiAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDIxOwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChidWlsZFZpc2xpYkRpbWVuc2lvbnModmlzLCBwYXJhbXMpKTsKCiAgICAgICAgY2FzZSAyMToKICAgICAgICAgIF92aXNDb25maWcuZGltZW5zaW9ucyA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgcGlwZWxpbmUgKz0gInZpc2xpYiB0eXBlPSciLmNvbmNhdCh2aXMudHlwZS5uYW1lLCAiJyAiKS5jb25jYXQocHJlcGFyZUpzb24oJ3Zpc0NvbmZpZycsIHZpc1N0YXRlLnBhcmFtcykpOwogICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzNjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDI1OgogICAgICAgICAgaWYgKCF2aXMudHlwZS50b0V4cHJlc3Npb24pIHsKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgX2NvbnRleHQzLnQwID0gcGlwZWxpbmU7CiAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI5OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh2aXMudHlwZS50b0V4cHJlc3Npb24odmlzLCBwYXJhbXMpKTsKCiAgICAgICAgY2FzZSAyOToKICAgICAgICAgIHBpcGVsaW5lID0gX2NvbnRleHQzLnQwICs9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzNjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDMyOgogICAgICAgICAgX3Zpc0NvbmZpZzIgPSB2aXNTdGF0ZS5wYXJhbXM7CiAgICAgICAgICBfdmlzQ29uZmlnMi5kaW1lbnNpb25zID0gc2NoZW1hczsKICAgICAgICAgIHBpcGVsaW5lICs9ICJ2aXN1YWxpemF0aW9uIHR5cGU9JyIuY29uY2F0KHZpcy50eXBlLm5hbWUsICInXG4gICAgIikuY29uY2F0KHByZXBhcmVKc29uKCd2aXNDb25maWcnLCBfdmlzQ29uZmlnMiksICJcbiAgICBtZXRyaWNzQXRBbGxMZXZlbHM9IikuY29uY2F0KHZpcy5pc0hpZXJhcmNoaWNhbCgpLCAiXG4gICAgcGFydGlhbFJvd3M9IikuY29uY2F0KHZpcy50eXBlLnJlcXVpcmVzUGFydGlhbFJvd3MgfHwgdmlzLnBhcmFtcy5zaG93UGFydGlhbFJvd3MgfHwgZmFsc2UsICIgIik7CgogICAgICAgICAgaWYgKGluZGV4UGF0dGVybikgewogICAgICAgICAgICBwaXBlbGluZSArPSAiIi5jb25jYXQocHJlcGFyZVN0cmluZygnaW5kZXgnLCBpbmRleFBhdHRlcm4uaWQpKTsKICAgICAgICAgIH0KCiAgICAgICAgY2FzZSAzNjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBwaXBlbGluZSk7CgogICAgICAgIGNhc2UgMzc6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICB9CiAgICB9CiAgfSk7Cn07CgpleHBvcnRzLmJ1aWxkUGlwZWxpbmUgPSBidWlsZFBpcGVsaW5lOw=="},null]}