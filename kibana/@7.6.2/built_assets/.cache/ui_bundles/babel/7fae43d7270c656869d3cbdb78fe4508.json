{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/ml/public/application/components/rule_editor/rule_editor_flyout.js","dependencies":[{"path":"x-pack/legacy/plugins/ml/public/application/components/rule_editor/rule_editor_flyout.js","mtime":1585205045509},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlJ1bGVFZGl0b3JGbHlvdXQgPSB2b2lkIDA7Cgp2YXIgX3Byb3BUeXBlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicHJvcC10eXBlcyIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX25vdGlmeSA9IHJlcXVpcmUoInVpL25vdGlmeSIpOwoKdmFyIF9kZXRlY3Rvcl9kZXNjcmlwdGlvbl9saXN0ID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL2RldGVjdG9yX2Rlc2NyaXB0aW9uX2xpc3QiKTsKCnZhciBfYWN0aW9uc19zZWN0aW9uID0gcmVxdWlyZSgiLi9hY3Rpb25zX3NlY3Rpb24iKTsKCnZhciBfY2hlY2tfcHJpdmlsZWdlID0gcmVxdWlyZSgiLi4vLi4vcHJpdmlsZWdlL2NoZWNrX3ByaXZpbGVnZSIpOwoKdmFyIF9jb25kaXRpb25zX3NlY3Rpb24gPSByZXF1aXJlKCIuL2NvbmRpdGlvbnNfc2VjdGlvbiIpOwoKdmFyIF9zY29wZV9zZWN0aW9uID0gcmVxdWlyZSgiLi9zY29wZV9zZWN0aW9uIik7Cgp2YXIgX3NlbGVjdF9ydWxlX2FjdGlvbiA9IHJlcXVpcmUoIi4vc2VsZWN0X3J1bGVfYWN0aW9uIik7Cgp2YXIgX3V0aWxzID0gcmVxdWlyZSgiLi91dGlscyIpOwoKdmFyIF9kZXRlY3Rvcl9ydWxlID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tbW9uL2NvbnN0YW50cy9kZXRlY3Rvcl9ydWxlIik7Cgp2YXIgX2pvYl91dGlscyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvbW1vbi91dGlsL2pvYl91dGlscyIpOwoKdmFyIF9qb2Jfc2VydmljZSA9IHJlcXVpcmUoIi4uLy4uL3NlcnZpY2VzL2pvYl9zZXJ2aWNlIik7Cgp2YXIgX21sX2FwaV9zZXJ2aWNlID0gcmVxdWlyZSgiLi4vLi4vc2VydmljZXMvbWxfYXBpX3NlcnZpY2UiKTsKCnZhciBfbWV0YWRhdGEgPSByZXF1aXJlKCJ1aS9tZXRhZGF0YSIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfY2xhc3MsIF90ZW1wOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCi8vIG1ldGFkYXRhLmJyYW5jaCBjb3JyZXNwb25kcyB0byB0aGUgdmVyc2lvbiB1c2VkIGluIGRvY3VtZW50YXRpb24gbGlua3MuCnZhciBkb2NzVXJsID0gImh0dHBzOi8vd3d3LmVsYXN0aWMuY28vZ3VpZGUvZW4vbWFjaGluZS1sZWFybmluZy8iLmNvbmNhdChfbWV0YWRhdGEubWV0YWRhdGEuYnJhbmNoLCAiL21sLXJ1bGVzLmh0bWwiKTsKdmFyIFJ1bGVFZGl0b3JGbHlvdXQgPSAoMCwgX3JlYWN0Mi5pbmplY3RJMThuKSgoX3RlbXAgPSBfY2xhc3MgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKFJ1bGVFZGl0b3JGbHlvdXQsIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBSdWxlRWRpdG9yRmx5b3V0KHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJ1bGVFZGl0b3JGbHlvdXQpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFJ1bGVFZGl0b3JGbHlvdXQpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzaG93Rmx5b3V0IiwgZnVuY3Rpb24gKGFub21hbHkpIHsKICAgICAgdmFyIHJ1bGVJbmRleCA9IC0xOwogICAgICB2YXIgaW50bCA9IF90aGlzLnByb3BzLmludGw7CgogICAgICB2YXIgam9iID0gX2pvYl9zZXJ2aWNlLm1sSm9iU2VydmljZS5nZXRKb2IoYW5vbWFseS5qb2JJZCk7CgogICAgICBpZiAoam9iID09PSB1bmRlZmluZWQpIHsKICAgICAgICAvLyBObyBkZXRhaWxzIGZvdW5kIGZvciB0aGlzIGpvYiwgZGlzcGxheSBhbiBlcnJvciBhbmQKICAgICAgICAvLyBkb24ndCBvcGVuIHRoZSBGbHlvdXQgYXMgbm8gZWRpdHMgY2FuIGJlIG1hZGUgd2l0aG91dCB0aGUgam9iLgogICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICd4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQudW5hYmxlVG9Db25maWd1cmVSdWxlc05vdGlmaWNhdGlvbk1lc3NzYWdlJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5hYmxlIHRvIGNvbmZpZ3VyZSBydWxlcyBhcyBhbiBlcnJvciBvY2N1cnJlZCBvYnRhaW5pbmcgZGV0YWlscyBmb3Igam9iIElEIHtqb2JJZH0nCiAgICAgICAgfSwgewogICAgICAgICAgam9iSWQ6IGFub21hbHkuam9iSWQKICAgICAgICB9KSk7CgogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGpvYjogam9iLAogICAgICAgICAgaXNGbHlvdXRWaXNpYmxlOiBmYWxzZQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIF90aGlzLnBhcnRpdGlvbmluZ0ZpZWxkTmFtZXMgPSAoMCwgX2pvYl91dGlscy5nZXRQYXJ0aXRpb25pbmdGaWVsZE5hbWVzKShqb2IsIGFub21hbHkuZGV0ZWN0b3JJbmRleCk7IC8vIENoZWNrIGlmIGFueSBydWxlcyBhcmUgY29uZmlndXJlZCBmb3IgdGhpcyBkZXRlY3Rvci4KCiAgICAgIHZhciBkZXRlY3RvckluZGV4ID0gYW5vbWFseS5kZXRlY3RvckluZGV4OwogICAgICB2YXIgZGV0ZWN0b3IgPSBqb2IuYW5hbHlzaXNfY29uZmlnLmRldGVjdG9yc1tkZXRlY3RvckluZGV4XTsKCiAgICAgIGlmIChkZXRlY3Rvci5jdXN0b21fcnVsZXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJ1bGVJbmRleCA9IDA7CiAgICAgIH0KCiAgICAgIHZhciBpc0NvbmRpdGlvbnNFbmFibGVkID0gZmFsc2U7CgogICAgICBpZiAocnVsZUluZGV4ID09PSAwKSB7CiAgICAgICAgLy8gQ29uZmlndXJpbmcgdGhlIGZpcnN0IHJ1bGUgZm9yIGEgZGV0ZWN0b3IuCiAgICAgICAgaXNDb25kaXRpb25zRW5hYmxlZCA9IF90aGlzLnBhcnRpdGlvbmluZ0ZpZWxkTmFtZXMubGVuZ3RoID09PSAwOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgYW5vbWFseTogYW5vbWFseSwKICAgICAgICBqb2I6IGpvYiwKICAgICAgICBydWxlSW5kZXg6IHJ1bGVJbmRleCwKICAgICAgICBpc0NvbmRpdGlvbnNFbmFibGVkOiBpc0NvbmRpdGlvbnNFbmFibGVkLAogICAgICAgIGlzU2NvcGVFbmFibGVkOiBmYWxzZSwKICAgICAgICBpc0ZseW91dFZpc2libGU6IHRydWUKICAgICAgfSk7CgogICAgICBpZiAoX3RoaXMucGFydGl0aW9uaW5nRmllbGROYW1lcy5sZW5ndGggPiAwICYmIF90aGlzLmNhbkdldEZpbHRlcnMpIHsKICAgICAgICAvLyBMb2FkIHRoZSBjdXJyZW50IGxpc3Qgb2YgZmlsdGVycy4gVGhlc2UgYXJlIHVzZWQgZm9yIGNvbmZpZ3VyaW5nIHJ1bGUgc2NvcGUuCiAgICAgICAgX21sX2FwaV9zZXJ2aWNlLm1sLmZpbHRlcnMuZmlsdGVycygpLnRoZW4oZnVuY3Rpb24gKGZpbHRlcnMpIHsKICAgICAgICAgIHZhciBmaWx0ZXJMaXN0SWRzID0gZmlsdGVycy5tYXAoZnVuY3Rpb24gKGZpbHRlcikgewogICAgICAgICAgICByZXR1cm4gZmlsdGVyLmZpbHRlcl9pZDsKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgZmlsdGVyTGlzdElkczogZmlsdGVyTGlzdElkcwogICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBsb2FkaW5nIGxpc3Qgb2YgZmlsdGVyczonLCByZXNwKTsKCiAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGREYW5nZXIoaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgaWQ6ICd4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuZXJyb3JXaXRoTG9hZGluZ0ZpbHRlckxpc3RzTm90aWZpY2F0aW9uTWVzc3NhZ2UnLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Vycm9yIGxvYWRpbmcgdGhlIGZpbHRlciBsaXN0cyB1c2VkIGluIHRoZSBydWxlIHNjb3BlJwogICAgICAgICAgfSkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjbG9zZUZseW91dCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGlzRmx5b3V0VmlzaWJsZTogZmFsc2UKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZXRFZGl0UnVsZUluZGV4IiwgZnVuY3Rpb24gKHJ1bGVJbmRleCkgewogICAgICB2YXIgZGV0ZWN0b3JJbmRleCA9IF90aGlzLnN0YXRlLmFub21hbHkuZGV0ZWN0b3JJbmRleDsKICAgICAgdmFyIGRldGVjdG9yID0gX3RoaXMuc3RhdGUuam9iLmFuYWx5c2lzX2NvbmZpZy5kZXRlY3RvcnNbZGV0ZWN0b3JJbmRleF07CiAgICAgIHZhciBydWxlcyA9IGRldGVjdG9yLmN1c3RvbV9ydWxlczsKICAgICAgdmFyIHJ1bGUgPSBydWxlcyA9PT0gdW5kZWZpbmVkIHx8IHJ1bGVJbmRleCA+PSBydWxlcy5sZW5ndGggPyAoMCwgX3V0aWxzLmdldE5ld1J1bGVEZWZhdWx0cykoKSA6IHJ1bGVzW3J1bGVJbmRleF07CiAgICAgIHZhciBpc0NvbmRpdGlvbnNFbmFibGVkID0gX3RoaXMucGFydGl0aW9uaW5nRmllbGROYW1lcy5sZW5ndGggPT09IDAgfHwgcnVsZS5jb25kaXRpb25zICE9PSB1bmRlZmluZWQgJiYgcnVsZS5jb25kaXRpb25zLmxlbmd0aCA+IDA7CiAgICAgIHZhciBpc1Njb3BlRW5hYmxlZCA9IHJ1bGUuc2NvcGUgIT09IHVuZGVmaW5lZCAmJiBPYmplY3Qua2V5cyhydWxlLnNjb3BlKS5sZW5ndGggPiAwOwoKICAgICAgaWYgKGlzU2NvcGVFbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgLy8gQWRkICdlbmFibGVkOnRydWUnIHRvIG1hcmsgdGhlbSBhcyBzZWxlY3RlZCBpbiB0aGUgVUkuCiAgICAgICAgT2JqZWN0LmtleXMocnVsZS5zY29wZSkuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgIHJ1bGUuc2NvcGVbZmllbGRdLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcnVsZUluZGV4OiBydWxlSW5kZXgsCiAgICAgICAgcnVsZTogcnVsZSwKICAgICAgICBpc0NvbmRpdGlvbnNFbmFibGVkOiBpc0NvbmRpdGlvbnNFbmFibGVkLAogICAgICAgIGlzU2NvcGVFbmFibGVkOiBpc1Njb3BlRW5hYmxlZAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2tpcFJlc3VsdENoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBjaGVja2VkID0gZS50YXJnZXQuY2hlY2tlZDsKCiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChwcmV2U3RhdGUpIHsKICAgICAgICB2YXIgYWN0aW9ucyA9IF90b0NvbnN1bWFibGVBcnJheShwcmV2U3RhdGUucnVsZS5hY3Rpb25zKTsKCiAgICAgICAgdmFyIGlkeCA9IGFjdGlvbnMuaW5kZXhPZihfZGV0ZWN0b3JfcnVsZS5BQ1RJT04uU0tJUF9SRVNVTFQpOwoKICAgICAgICBpZiAoaWR4ID09PSAtMSAmJiBjaGVja2VkKSB7CiAgICAgICAgICBhY3Rpb25zLnB1c2goX2RldGVjdG9yX3J1bGUuQUNUSU9OLlNLSVBfUkVTVUxUKTsKICAgICAgICB9IGVsc2UgaWYgKGlkeCA+IC0xICYmICFjaGVja2VkKSB7CiAgICAgICAgICBhY3Rpb25zLnNwbGljZShpZHgsIDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHJ1bGU6IF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZS5ydWxlLCB7CiAgICAgICAgICAgIGFjdGlvbnM6IGFjdGlvbnMKICAgICAgICAgIH0pCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblNraXBNb2RlbFVwZGF0ZUNoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBjaGVja2VkID0gZS50YXJnZXQuY2hlY2tlZDsKCiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChwcmV2U3RhdGUpIHsKICAgICAgICB2YXIgYWN0aW9ucyA9IF90b0NvbnN1bWFibGVBcnJheShwcmV2U3RhdGUucnVsZS5hY3Rpb25zKTsKCiAgICAgICAgdmFyIGlkeCA9IGFjdGlvbnMuaW5kZXhPZihfZGV0ZWN0b3JfcnVsZS5BQ1RJT04uU0tJUF9NT0RFTF9VUERBVEUpOwoKICAgICAgICBpZiAoaWR4ID09PSAtMSAmJiBjaGVja2VkKSB7CiAgICAgICAgICBhY3Rpb25zLnB1c2goX2RldGVjdG9yX3J1bGUuQUNUSU9OLlNLSVBfTU9ERUxfVVBEQVRFKTsKICAgICAgICB9IGVsc2UgaWYgKGlkeCA+IC0xICYmICFjaGVja2VkKSB7CiAgICAgICAgICBhY3Rpb25zLnNwbGljZShpZHgsIDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHJ1bGU6IF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZS5ydWxlLCB7CiAgICAgICAgICAgIGFjdGlvbnM6IGFjdGlvbnMKICAgICAgICAgIH0pCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkNvbmRpdGlvbnNFbmFibGVkQ2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIGlzQ29uZGl0aW9uc0VuYWJsZWQgPSBlLnRhcmdldC5jaGVja2VkOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKHByZXZTdGF0ZSkgewogICAgICAgIHZhciBjb25kaXRpb25zOwoKICAgICAgICBpZiAoaXNDb25kaXRpb25zRW5hYmxlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgIC8vIENsZWFyIGFueSBjb25kaXRpb25zIHRoYXQgaGF2ZSBiZWVuIGFkZGVkLgogICAgICAgICAgY29uZGl0aW9ucyA9IFtdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBBZGQgYSBkZWZhdWx0IG5ldyBjb25kaXRpb24uCiAgICAgICAgICBjb25kaXRpb25zID0gWygwLCBfdXRpbHMuZ2V0TmV3Q29uZGl0aW9uRGVmYXVsdHMpKCldOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHJ1bGU6IF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZS5ydWxlLCB7CiAgICAgICAgICAgIGNvbmRpdGlvbnM6IGNvbmRpdGlvbnMKICAgICAgICAgIH0pLAogICAgICAgICAgaXNDb25kaXRpb25zRW5hYmxlZDogaXNDb25kaXRpb25zRW5hYmxlZAogICAgICAgIH07CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiYWRkQ29uZGl0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAocHJldlN0YXRlKSB7CiAgICAgICAgdmFyIGNvbmRpdGlvbnMgPSBfdG9Db25zdW1hYmxlQXJyYXkocHJldlN0YXRlLnJ1bGUuY29uZGl0aW9ucyk7CgogICAgICAgIGNvbmRpdGlvbnMucHVzaCgoMCwgX3V0aWxzLmdldE5ld0NvbmRpdGlvbkRlZmF1bHRzKSgpKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcnVsZTogX29iamVjdFNwcmVhZCh7fSwgcHJldlN0YXRlLnJ1bGUsIHsKICAgICAgICAgICAgY29uZGl0aW9uczogY29uZGl0aW9ucwogICAgICAgICAgfSkKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInVwZGF0ZUNvbmRpdGlvbiIsIGZ1bmN0aW9uIChpbmRleCwgYXBwbGllc1RvLCBvcGVyYXRvciwgdmFsdWUpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKHByZXZTdGF0ZSkgewogICAgICAgIHZhciBjb25kaXRpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KHByZXZTdGF0ZS5ydWxlLmNvbmRpdGlvbnMpOwoKICAgICAgICBpZiAoaW5kZXggPCBjb25kaXRpb25zLmxlbmd0aCkgewogICAgICAgICAgY29uZGl0aW9uc1tpbmRleF0gPSB7CiAgICAgICAgICAgIGFwcGxpZXNfdG86IGFwcGxpZXNUbywKICAgICAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9yLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgcnVsZTogX29iamVjdFNwcmVhZCh7fSwgcHJldlN0YXRlLnJ1bGUsIHsKICAgICAgICAgICAgY29uZGl0aW9uczogY29uZGl0aW9ucwogICAgICAgICAgfSkKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRlbGV0ZUNvbmRpdGlvbiIsIGZ1bmN0aW9uIChpbmRleCkgewogICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAocHJldlN0YXRlKSB7CiAgICAgICAgdmFyIGNvbmRpdGlvbnMgPSBfdG9Db25zdW1hYmxlQXJyYXkocHJldlN0YXRlLnJ1bGUuY29uZGl0aW9ucyk7CgogICAgICAgIGlmIChpbmRleCA8IGNvbmRpdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICBjb25kaXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgcnVsZTogX29iamVjdFNwcmVhZCh7fSwgcHJldlN0YXRlLnJ1bGUsIHsKICAgICAgICAgICAgY29uZGl0aW9uczogY29uZGl0aW9ucwogICAgICAgICAgfSkKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2NvcGVFbmFibGVkQ2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIGlzU2NvcGVFbmFibGVkID0gZS50YXJnZXQuY2hlY2tlZDsKCiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChwcmV2U3RhdGUpIHsKICAgICAgICB2YXIgcnVsZSA9IF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZS5ydWxlKTsKCiAgICAgICAgaWYgKGlzU2NvcGVFbmFibGVkID09PSBmYWxzZSkgewogICAgICAgICAgLy8gQ2xlYXIgc2NvcGUgcHJvcGVydHkuCiAgICAgICAgICBkZWxldGUgcnVsZS5zY29wZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBydWxlOiBydWxlLAogICAgICAgICAgaXNTY29wZUVuYWJsZWQ6IGlzU2NvcGVFbmFibGVkCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ1cGRhdGVTY29wZSIsIGZ1bmN0aW9uIChmaWVsZE5hbWUsIGZpbHRlcklkLCBmaWx0ZXJUeXBlLCBlbmFibGVkKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChwcmV2U3RhdGUpIHsKICAgICAgICB2YXIgc2NvcGUgPSBfb2JqZWN0U3ByZWFkKHt9LCBwcmV2U3RhdGUucnVsZS5zY29wZSk7CgogICAgICAgIGlmIChzY29wZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBzY29wZSA9IHt9OwogICAgICAgIH0KCiAgICAgICAgc2NvcGVbZmllbGROYW1lXSA9IHsKICAgICAgICAgIGZpbHRlcl9pZDogZmlsdGVySWQsCiAgICAgICAgICBmaWx0ZXJfdHlwZTogZmlsdGVyVHlwZSwKICAgICAgICAgIGVuYWJsZWQ6IGVuYWJsZWQKICAgICAgICB9OwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBydWxlOiBfb2JqZWN0U3ByZWFkKHt9LCBwcmV2U3RhdGUucnVsZSwgewogICAgICAgICAgICBzY29wZTogc2NvcGUKICAgICAgICAgIH0pCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzYXZlRWRpdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlID0gX3RoaXMuc3RhdGUsCiAgICAgICAgICBydWxlID0gX3RoaXMkc3RhdGUucnVsZSwKICAgICAgICAgIHJ1bGVJbmRleCA9IF90aGlzJHN0YXRlLnJ1bGVJbmRleDsKCiAgICAgIF90aGlzLnVwZGF0ZVJ1bGVBdEluZGV4KHJ1bGVJbmRleCwgcnVsZSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ1cGRhdGVSdWxlQXRJbmRleCIsIGZ1bmN0aW9uIChydWxlSW5kZXgsIGVkaXRlZFJ1bGUpIHsKICAgICAgdmFyIGludGwgPSBfdGhpcy5wcm9wcy5pbnRsOwogICAgICB2YXIgX3RoaXMkc3RhdGUyID0gX3RoaXMuc3RhdGUsCiAgICAgICAgICBqb2IgPSBfdGhpcyRzdGF0ZTIuam9iLAogICAgICAgICAgYW5vbWFseSA9IF90aGlzJHN0YXRlMi5hbm9tYWx5OwogICAgICB2YXIgam9iSWQgPSBqb2Iuam9iX2lkOwogICAgICB2YXIgZGV0ZWN0b3JJbmRleCA9IGFub21hbHkuZGV0ZWN0b3JJbmRleDsKICAgICAgKDAsIF91dGlscy5zYXZlSm9iUnVsZSkoam9iLCBkZXRlY3RvckluZGV4LCBydWxlSW5kZXgsIGVkaXRlZFJ1bGUpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICBpZiAocmVzcC5zdWNjZXNzKSB7CiAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGQoewogICAgICAgICAgICB0aXRsZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgICBpZDogJ3hwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5jaGFuZ2VzVG9Kb2JEZXRlY3RvclJ1bGVzU2F2ZWROb3RpZmljYXRpb25NZXNzYWdlVGl0bGUnLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ2hhbmdlcyB0byB7am9iSWR9IGRldGVjdG9yIHJ1bGVzIHNhdmVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgam9iSWQ6IGpvYklkCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBjb2xvcjogJ3N1Y2Nlc3MnLAogICAgICAgICAgICBpY29uVHlwZTogJ2NoZWNrJywKICAgICAgICAgICAgdGV4dDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgICBpZDogJ3hwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5jaGFuZ2VzVG9Kb2JEZXRlY3RvclJ1bGVzU2F2ZWROb3RpZmljYXRpb25NZXNzYWdlRGVzY3JpcHRpb24nLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTm90ZSB0aGF0IGNoYW5nZXMgd2lsbCB0YWtlIGVmZmVjdCBmb3IgbmV3IHJlc3VsdHMgb25seS4nCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpcy5jbG9zZUZseW91dCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGREYW5nZXIoaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgaWQ6ICd4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuZXJyb3JXaXRoU2F2aW5nQ2hhbmdlc1RvSm9iRGV0ZWN0b3JSdWxlc05vdGlmaWNhdGlvbk1lc3NhZ2UnLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Vycm9yIHNhdmluZyBjaGFuZ2VzIHRvIHtqb2JJZH0gZGV0ZWN0b3IgcnVsZXMnCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGpvYklkOiBqb2JJZAogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CgogICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICd4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuZXJyb3JXaXRoU2F2aW5nQ2hhbmdlc1RvSm9iRGV0ZWN0b3JSdWxlc05vdGlmaWNhdGlvbk1lc3NhZ2UnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFcnJvciBzYXZpbmcgY2hhbmdlcyB0byB7am9iSWR9IGRldGVjdG9yIHJ1bGVzJwogICAgICAgIH0sIHsKICAgICAgICAgIGpvYklkOiBqb2JJZAogICAgICAgIH0pKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJkZWxldGVSdWxlQXRJbmRleCIsIGZ1bmN0aW9uIChpbmRleCkgewogICAgICB2YXIgaW50bCA9IF90aGlzLnByb3BzLmludGw7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTMgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgIGpvYiA9IF90aGlzJHN0YXRlMy5qb2IsCiAgICAgICAgICBhbm9tYWx5ID0gX3RoaXMkc3RhdGUzLmFub21hbHk7CiAgICAgIHZhciBqb2JJZCA9IGpvYi5qb2JfaWQ7CiAgICAgIHZhciBkZXRlY3RvckluZGV4ID0gYW5vbWFseS5kZXRlY3RvckluZGV4OwogICAgICAoMCwgX3V0aWxzLmRlbGV0ZUpvYlJ1bGUpKGpvYiwgZGV0ZWN0b3JJbmRleCwgaW5kZXgpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICBpZiAocmVzcC5zdWNjZXNzKSB7CiAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiAneHBhY2subWwucnVsZUVkaXRvci5ydWxlRWRpdG9yRmx5b3V0LnJ1bGVEZWxldGVkRnJvbUpvYkRldGVjdG9yTm90aWZpY2F0aW9uTWVzc2FnZScsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUnVsZSBkZWxldGVkIGZyb20ge2pvYklkfSBkZXRlY3RvcicKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgam9iSWQ6IGpvYklkCiAgICAgICAgICB9KSk7CgogICAgICAgICAgX3RoaXMuY2xvc2VGbHlvdXQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkRGFuZ2VyKGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiAneHBhY2subWwucnVsZUVkaXRvci5ydWxlRWRpdG9yRmx5b3V0LmVycm9yV2l0aERlbGV0aW5nUnVsZUZyb21Kb2JEZXRlY3Rvck5vdGlmaWNhdGlvbk1lc3NhZ2UnLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Vycm9yIGRlbGV0aW5nIHJ1bGUgZnJvbSB7am9iSWR9IGRldGVjdG9yJwogICAgICAgICAgfSwgewogICAgICAgICAgICBqb2JJZDogam9iSWQKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICd4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuZXJyb3JXaXRoRGVsZXRpbmdSdWxlRnJvbUpvYkRldGVjdG9yTm90aWZpY2F0aW9uTWVzc2FnZScsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Vycm9yIGRlbGV0aW5nIHJ1bGUgZnJvbSB7am9iSWR9IGRldGVjdG9yJwogICAgICAgIH0sIHsKICAgICAgICAgIGpvYklkOiBqb2JJZAogICAgICAgIH0pOwoKICAgICAgICBpZiAoZXJyb3IubWVzc2FnZSkgewogICAgICAgICAgZXJyb3JNZXNzYWdlICs9ICIgOiAiLmNvbmNhdChlcnJvci5tZXNzYWdlKTsKICAgICAgICB9CgogICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihlcnJvck1lc3NhZ2UpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImFkZEl0ZW1Ub0ZpbHRlckxpc3QiLCBmdW5jdGlvbiAoaXRlbSwgZmlsdGVySWQsIGNsb3NlRmx5b3V0T25BZGQpIHsKICAgICAgdmFyIGludGwgPSBfdGhpcy5wcm9wcy5pbnRsOwogICAgICAoMCwgX3V0aWxzLmFkZEl0ZW1Ub0ZpbHRlcikoaXRlbSwgZmlsdGVySWQpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChjbG9zZUZseW91dE9uQWRkID09PSB0cnVlKSB7CiAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGQoewogICAgICAgICAgICB0aXRsZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgICBpZDogJ3hwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5hZGRlZEl0ZW1Ub0ZpbHRlckxpc3ROb3RpZmljYXRpb25NZXNzYWdlVGl0bGUnLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQWRkZWQge2l0ZW19IHRvIHtmaWx0ZXJJZH0nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBpdGVtOiBpdGVtLAogICAgICAgICAgICAgIGZpbHRlcklkOiBmaWx0ZXJJZAogICAgICAgICAgICB9KSwKICAgICAgICAgICAgY29sb3I6ICdzdWNjZXNzJywKICAgICAgICAgICAgaWNvblR5cGU6ICdjaGVjaycsCiAgICAgICAgICAgIHRleHQ6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgICAgaWQ6ICd4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuYWRkZWRJdGVtVG9GaWx0ZXJMaXN0Tm90aWZpY2F0aW9uTWVzc2FnZURlc2NyaXB0aW9uJywKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ05vdGUgdGhhdCBjaGFuZ2VzIHdpbGwgdGFrZSBlZmZlY3QgZm9yIG5ldyByZXN1bHRzIG9ubHkuJwogICAgICAgICAgICB9KQogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXMuY2xvc2VGbHlvdXQoKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciBhZGRpbmcgIi5jb25jYXQoaXRlbSwgIiB0byBmaWx0ZXIgIikuY29uY2F0KGZpbHRlcklkLCAiOiIpLCBlcnJvcik7CgogICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcihpbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICd4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuZXJyb3JXaXRoQWRkaW5nSXRlbVRvRmlsdGVyTGlzdE5vdGlmaWNhdGlvbk1lc3NhZ2UnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdBbiBlcnJvciBvY2N1cnJlZCBhZGRpbmcge2l0ZW19IHRvIGZpbHRlciB7ZmlsdGVySWR9JwogICAgICAgIH0sIHsKICAgICAgICAgIGl0ZW06IGl0ZW0sCiAgICAgICAgICBmaWx0ZXJJZDogZmlsdGVySWQKICAgICAgICB9KSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIGFub21hbHk6IHt9LAogICAgICBqb2I6IHt9LAogICAgICBydWxlSW5kZXg6IC0xLAogICAgICBydWxlOiAoMCwgX3V0aWxzLmdldE5ld1J1bGVEZWZhdWx0cykoKSwKICAgICAgc2tpcE1vZGVsVXBkYXRlOiBmYWxzZSwKICAgICAgaXNDb25kaXRpb25zRW5hYmxlZDogZmFsc2UsCiAgICAgIGlzU2NvcGVFbmFibGVkOiBmYWxzZSwKICAgICAgZmlsdGVyTGlzdElkczogW10sCiAgICAgIGlzRmx5b3V0VmlzaWJsZTogZmFsc2UKICAgIH07CiAgICBfdGhpcy5wYXJ0aXRpb25pbmdGaWVsZE5hbWVzID0gW107CiAgICBfdGhpcy5jYW5HZXRGaWx0ZXJzID0gKDAsIF9jaGVja19wcml2aWxlZ2UuY2hlY2tQZXJtaXNzaW9uKSgnY2FuR2V0RmlsdGVycycpOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFJ1bGVFZGl0b3JGbHlvdXQsIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIGlmICh0eXBlb2YgdGhpcy5wcm9wcy5zZXRTaG93RnVuY3Rpb24gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB0aGlzLnByb3BzLnNldFNob3dGdW5jdGlvbih0aGlzLnNob3dGbHlvdXQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFVubW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkgewogICAgICBpZiAodHlwZW9mIHRoaXMucHJvcHMudW5zZXRTaG93RnVuY3Rpb24gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB0aGlzLnByb3BzLnVuc2V0U2hvd0Z1bmN0aW9uKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIGludGwgPSB0aGlzLnByb3BzLmludGw7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTQgPSB0aGlzLnN0YXRlLAogICAgICAgICAgaXNGbHlvdXRWaXNpYmxlID0gX3RoaXMkc3RhdGU0LmlzRmx5b3V0VmlzaWJsZSwKICAgICAgICAgIGpvYiA9IF90aGlzJHN0YXRlNC5qb2IsCiAgICAgICAgICBhbm9tYWx5ID0gX3RoaXMkc3RhdGU0LmFub21hbHksCiAgICAgICAgICBydWxlSW5kZXggPSBfdGhpcyRzdGF0ZTQucnVsZUluZGV4LAogICAgICAgICAgcnVsZSA9IF90aGlzJHN0YXRlNC5ydWxlLAogICAgICAgICAgZmlsdGVyTGlzdElkcyA9IF90aGlzJHN0YXRlNC5maWx0ZXJMaXN0SWRzLAogICAgICAgICAgaXNDb25kaXRpb25zRW5hYmxlZCA9IF90aGlzJHN0YXRlNC5pc0NvbmRpdGlvbnNFbmFibGVkLAogICAgICAgICAgaXNTY29wZUVuYWJsZWQgPSBfdGhpcyRzdGF0ZTQuaXNTY29wZUVuYWJsZWQ7CgogICAgICBpZiAoaXNGbHlvdXRWaXNpYmxlID09PSBmYWxzZSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgZmx5b3V0OwoKICAgICAgaWYgKHJ1bGVJbmRleCA9PT0gLTEpIHsKICAgICAgICBmbHlvdXQgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmx5b3V0LCB7CiAgICAgICAgICBjbGFzc05hbWU6ICJtbC1ydWxlLWVkaXRvci1mbHlvdXQiLAogICAgICAgICAgb25DbG9zZTogdGhpcy5jbG9zZUZseW91dCwKICAgICAgICAgICJhcmlhLWxhYmVsbGVkYnkiOiAiZmx5b3V0VGl0bGUiCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZseW91dEhlYWRlciwgewogICAgICAgICAgaGFzQm9yZGVyOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgICBzaXplOiAibSIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMSIsIHsKICAgICAgICAgIGlkOiAiZmx5b3V0VGl0bGUiCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2subWwucnVsZUVkaXRvci5ydWxlRWRpdG9yRmx5b3V0LmVkaXRSdWxlc1RpdGxlIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRWRpdCBydWxlcyIKICAgICAgICB9KSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZseW91dEJvZHksIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3NlbGVjdF9ydWxlX2FjdGlvbi5TZWxlY3RSdWxlQWN0aW9uLCB7CiAgICAgICAgICBqb2I6IGpvYiwKICAgICAgICAgIGFub21hbHk6IGFub21hbHksCiAgICAgICAgICBzZXRFZGl0UnVsZUluZGV4OiB0aGlzLnNldEVkaXRSdWxlSW5kZXgsCiAgICAgICAgICB1cGRhdGVSdWxlQXRJbmRleDogdGhpcy51cGRhdGVSdWxlQXRJbmRleCwKICAgICAgICAgIGRlbGV0ZVJ1bGVBdEluZGV4OiB0aGlzLmRlbGV0ZVJ1bGVBdEluZGV4LAogICAgICAgICAgYWRkSXRlbVRvRmlsdGVyTGlzdDogdGhpcy5hZGRJdGVtVG9GaWx0ZXJMaXN0CiAgICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmx5b3V0Rm9vdGVyLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgICBqdXN0aWZ5Q29udGVudDogInNwYWNlQmV0d2VlbiIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgICAgICBpY29uVHlwZTogImNyb3NzIiwKICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuY2xvc2VGbHlvdXQsCiAgICAgICAgICBmbHVzaDogImxlZnQiCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2subWwucnVsZUVkaXRvci5ydWxlRWRpdG9yRmx5b3V0LmNsb3NlQnV0dG9uTGFiZWwiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDbG9zZSIKICAgICAgICB9KSkpKSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBkZXRlY3RvckluZGV4ID0gYW5vbWFseS5kZXRlY3RvckluZGV4OwogICAgICAgIHZhciBkZXRlY3RvciA9IGpvYi5hbmFseXNpc19jb25maWcuZGV0ZWN0b3JzW2RldGVjdG9ySW5kZXhdOwogICAgICAgIHZhciBydWxlcyA9IGRldGVjdG9yLmN1c3RvbV9ydWxlczsKICAgICAgICB2YXIgaXNDcmVhdGUgPSBydWxlcyA9PT0gdW5kZWZpbmVkIHx8IHJ1bGVJbmRleCA+PSBydWxlcy5sZW5ndGg7CiAgICAgICAgdmFyIGhhc1BhcnRpdGlvbmluZ0ZpZWxkcyA9IHRoaXMucGFydGl0aW9uaW5nRmllbGROYW1lcyAmJiB0aGlzLnBhcnRpdGlvbmluZ0ZpZWxkTmFtZXMubGVuZ3RoID4gMDsKICAgICAgICB2YXIgY29uZGl0aW9uU3VwcG9ydGVkID0gX2RldGVjdG9yX3J1bGUuQ09ORElUSU9OU19OT1RfU1VQUE9SVEVEX0ZVTkNUSU9OUy5pbmRleE9mKGFub21hbHkuc291cmNlLmZ1bmN0aW9uKSA9PT0gLTE7CiAgICAgICAgdmFyIGNvbmRpdGlvbnNUZXh0ID0gaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAneHBhY2subWwucnVsZUVkaXRvci5ydWxlRWRpdG9yRmx5b3V0LmNvbmRpdGlvbnNEZXNjcmlwdGlvbicsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0FkZCBudW1lcmljIGNvbmRpdGlvbnMgZm9yIHdoZW4gdGhlIHJ1bGUgYXBwbGllcy4gTXVsdGlwbGUgY29uZGl0aW9ucyBhcmUgY29tYmluZWQgdXNpbmcgQU5ELicKICAgICAgICB9KTsKICAgICAgICBmbHlvdXQgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmx5b3V0LCB7CiAgICAgICAgICBjbGFzc05hbWU6ICJtbC1ydWxlLWVkaXRvci1mbHlvdXQiLAogICAgICAgICAgb25DbG9zZTogdGhpcy5jbG9zZUZseW91dCwKICAgICAgICAgICJhcmlhLWxhYmVsbGVkYnkiOiAiZmx5b3V0VGl0bGUiCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZseW91dEhlYWRlciwgewogICAgICAgICAgaGFzQm9yZGVyOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgICBzaXplOiAibSIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMSIsIHsKICAgICAgICAgIGlkOiAiZmx5b3V0VGl0bGUiCiAgICAgICAgfSwgaXNDcmVhdGUgPT09IHRydWUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuY3JlYXRlUnVsZVRpdGxlIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ3JlYXRlIHJ1bGUiCiAgICAgICAgfSkgOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuZWRpdFJ1bGVUaXRsZSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkVkaXQgcnVsZSIKICAgICAgICB9KSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZseW91dEJvZHksIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2RldGVjdG9yX2Rlc2NyaXB0aW9uX2xpc3QuRGV0ZWN0b3JEZXNjcmlwdGlvbkxpc3QsIHsKICAgICAgICAgIGpvYjogam9iLAogICAgICAgICAgZGV0ZWN0b3I6IGRldGVjdG9yLAogICAgICAgICAgYW5vbWFseTogYW5vbWFseQogICAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgICBzaXplOiAibSIKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQucnVsZXNEZXNjcmlwdGlvbiIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlJ1bGVzIGluc3RydWN0IGFub21hbHkgZGV0ZWN0b3JzIHRvIGNoYW5nZSB0aGVpciBiZWhhdmlvciBiYXNlZCBvbiBkb21haW4tc3BlY2lmaWMga25vd2xlZGdlIHRoYXQgeW91IHByb3ZpZGUuIFdoZW4geW91IGNyZWF0ZSBhIHJ1bGUsIHlvdSBjYW4gc3BlY2lmeSBjb25kaXRpb25zLCBzY29wZSwgYW5kIGFjdGlvbnMuIFdoZW4gdGhlIGNvbmRpdGlvbnMgb2YgYSBydWxlIGFyZSBzYXRpc2ZpZWQsIGl0cyBhY3Rpb25zIGFyZSB0cmlnZ2VyZWQuIHtsZWFybk1vcmVMaW5rfSIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgbGVhcm5Nb3JlTGluazogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxpbmssIHsKICAgICAgICAgICAgICBocmVmOiBkb2NzVXJsLAogICAgICAgICAgICAgIHRhcmdldDogIl9ibGFuayIKICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5ydWxlc0Rlc2NyaXB0aW9uLmxlYXJuTW9yZUxpbmtUZXh0IiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkxlYXJuIG1vcmUiCiAgICAgICAgICAgIH0pKQogICAgICAgICAgfQogICAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIG51bGwpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2subWwucnVsZUVkaXRvci5ydWxlRWRpdG9yRmx5b3V0LmFjdGlvblRpdGxlIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQWN0aW9uIgogICAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2FjdGlvbnNfc2VjdGlvbi5BY3Rpb25zU2VjdGlvbiwgewogICAgICAgICAgYWN0aW9uczogcnVsZS5hY3Rpb25zLAogICAgICAgICAgb25Ta2lwUmVzdWx0Q2hhbmdlOiB0aGlzLm9uU2tpcFJlc3VsdENoYW5nZSwKICAgICAgICAgIG9uU2tpcE1vZGVsVXBkYXRlQ2hhbmdlOiB0aGlzLm9uU2tpcE1vZGVsVXBkYXRlQ2hhbmdlCiAgICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICAgIHNpemU6ICJ4bCIKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5jb25kaXRpb25zVGl0bGUiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDb25kaXRpb25zIgogICAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICAgIHNpemU6ICJzIgogICAgICAgIH0pLCBjb25kaXRpb25TdXBwb3J0ZWQgPT09IHRydWUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2hlY2tib3gsIHsKICAgICAgICAgIGlkOiAiZW5hYmxlX2NvbmRpdGlvbnNfY2hlY2tib3giLAogICAgICAgICAgY2xhc3NOYW1lOiAic2NvcGUtZW5hYmxlLWNoZWNrYm94IiwKICAgICAgICAgIGxhYmVsOiBjb25kaXRpb25zVGV4dCwKICAgICAgICAgIGNoZWNrZWQ6IGlzQ29uZGl0aW9uc0VuYWJsZWQsCiAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkNvbmRpdGlvbnNFbmFibGVkQ2hhbmdlLAogICAgICAgICAgZGlzYWJsZWQ6ICFjb25kaXRpb25TdXBwb3J0ZWQgfHwgIWhhc1BhcnRpdGlvbmluZ0ZpZWxkcwogICAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5jb25kaXRpb25zTm90U3VwcG9ydGVkVGl0bGUiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNvbmRpdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQgZm9yIGRldGVjdG9ycyB1c2luZyB0aGUge2Z1bmN0aW9uTmFtZX0gZnVuY3Rpb24iLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBmdW5jdGlvbk5hbWU6IGFub21hbHkuc291cmNlLmZ1bmN0aW9uCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgaWNvblR5cGU6ICJpSW5DaXJjbGUiCiAgICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICAgIHNpemU6ICJzIgogICAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jb25kaXRpb25zX3NlY3Rpb24uQ29uZGl0aW9uc1NlY3Rpb24sIHsKICAgICAgICAgIGlzRW5hYmxlZDogaXNDb25kaXRpb25zRW5hYmxlZCwKICAgICAgICAgIGNvbmRpdGlvbnM6IHJ1bGUuY29uZGl0aW9ucywKICAgICAgICAgIGFkZENvbmRpdGlvbjogdGhpcy5hZGRDb25kaXRpb24sCiAgICAgICAgICB1cGRhdGVDb25kaXRpb246IHRoaXMudXBkYXRlQ29uZGl0aW9uLAogICAgICAgICAgZGVsZXRlQ29uZGl0aW9uOiB0aGlzLmRlbGV0ZUNvbmRpdGlvbgogICAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgICBzaXplOiAieGwiCiAgICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3Njb3BlX3NlY3Rpb24uU2NvcGVTZWN0aW9uLCB7CiAgICAgICAgICBpc0VuYWJsZWQ6IGlzU2NvcGVFbmFibGVkLAogICAgICAgICAgb25FbmFibGVkQ2hhbmdlOiB0aGlzLm9uU2NvcGVFbmFibGVkQ2hhbmdlLAogICAgICAgICAgcGFydGl0aW9uaW5nRmllbGROYW1lczogdGhpcy5wYXJ0aXRpb25pbmdGaWVsZE5hbWVzLAogICAgICAgICAgZmlsdGVyTGlzdElkczogZmlsdGVyTGlzdElkcywKICAgICAgICAgIHNjb3BlOiBydWxlLnNjb3BlLAogICAgICAgICAgdXBkYXRlU2NvcGU6IHRoaXMudXBkYXRlU2NvcGUKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5yZXJ1bkpvYlRpdGxlIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZXJ1biBqb2IiCiAgICAgICAgICB9KSwKICAgICAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgICAgICBpY29uVHlwZTogImhlbHAiCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC53aGVuQ2hhbmdlc1Rha2VFZmZlY3REZXNjcmlwdGlvbiIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNoYW5nZXMgdG8gcnVsZXMgdGFrZSBlZmZlY3QgZm9yIG5ldyByZXN1bHRzIG9ubHkuIgogICAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5ob3dUb0FwcGx5Q2hhbmdlc1RvRXhpc3RpbmdSZXN1bHRzRGVzY3JpcHRpb24iLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJUbyBhcHBseSB0aGVzZSBjaGFuZ2VzIHRvIGV4aXN0aW5nIHJlc3VsdHMgeW91IG11c3QgY2xvbmUgYW5kIHJlcnVuIHRoZSBqb2IuIE5vdGUgcmVydW5uaW5nIHRoZSBqb2IgbWF5IHRha2Ugc29tZSB0aW1lIGFuZCBzaG91bGQgb25seSBiZSBkb25lIG9uY2UgeW91IGhhdmUgY29tcGxldGVkIGFsbCB5b3VyIGNoYW5nZXMgdG8gdGhlIHJ1bGVzIGZvciB0aGlzIGpvYi4iCiAgICAgICAgfSkpKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbHlvdXRGb290ZXIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAic3BhY2VCZXR3ZWVuIgogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICAgIGljb25UeXBlOiAiY3Jvc3MiLAogICAgICAgICAgb25DbGljazogdGhpcy5jbG9zZUZseW91dCwKICAgICAgICAgIGZsdXNoOiAibGVmdCIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5tbC5ydWxlRWRpdG9yLnJ1bGVFZGl0b3JGbHlvdXQuY2xvc2VCdXR0b25MYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNsb3NlIgogICAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgICBvbkNsaWNrOiB0aGlzLnNhdmVFZGl0LAogICAgICAgICAgaXNEaXNhYmxlZDogISgwLCBfdXRpbHMuaXNWYWxpZFJ1bGUpKHJ1bGUpLAogICAgICAgICAgZmlsbDogdHJ1ZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLm1sLnJ1bGVFZGl0b3IucnVsZUVkaXRvckZseW91dC5zYXZlQnV0dG9uTGFiZWwiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlIgogICAgICAgIH0pKSkpKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBmbHlvdXQpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFJ1bGVFZGl0b3JGbHlvdXQ7Cn0oX3JlYWN0LkNvbXBvbmVudCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3MsICJwcm9wVHlwZXMiLCB7CiAgc2V0U2hvd0Z1bmN0aW9uOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkLAogIHVuc2V0U2hvd0Z1bmN0aW9uOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkCn0pLCBfdGVtcCkpOwpleHBvcnRzLlJ1bGVFZGl0b3JGbHlvdXQgPSBSdWxlRWRpdG9yRmx5b3V0Ow=="},null]}