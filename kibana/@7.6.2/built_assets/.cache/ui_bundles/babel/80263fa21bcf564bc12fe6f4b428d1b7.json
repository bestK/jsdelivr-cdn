{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/actions/map_actions.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/actions/map_actions.js","mtime":1585205045221},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmNhbmNlbEFsbEluRmxpZ2h0UmVxdWVzdHMgPSBjYW5jZWxBbGxJbkZsaWdodFJlcXVlc3RzOwpleHBvcnRzLnNldE1hcEluaXRFcnJvciA9IHNldE1hcEluaXRFcnJvcjsKZXhwb3J0cy50cmFja0N1cnJlbnRMYXllclN0YXRlID0gdHJhY2tDdXJyZW50TGF5ZXJTdGF0ZTsKZXhwb3J0cy5yb2xsYmFja1RvVHJhY2tlZExheWVyU3RhdGVGb3JTZWxlY3RlZExheWVyID0gcm9sbGJhY2tUb1RyYWNrZWRMYXllclN0YXRlRm9yU2VsZWN0ZWRMYXllcjsKZXhwb3J0cy5yZW1vdmVUcmFja2VkTGF5ZXJTdGF0ZUZvclNlbGVjdGVkTGF5ZXIgPSByZW1vdmVUcmFja2VkTGF5ZXJTdGF0ZUZvclNlbGVjdGVkTGF5ZXI7CmV4cG9ydHMucmVwbGFjZUxheWVyTGlzdCA9IHJlcGxhY2VMYXllckxpc3Q7CmV4cG9ydHMuY2xvbmVMYXllciA9IGNsb25lTGF5ZXI7CmV4cG9ydHMuYWRkTGF5ZXIgPSBhZGRMYXllcjsKZXhwb3J0cy5hZGRMYXllcldpdGhvdXREYXRhU3luYyA9IGFkZExheWVyV2l0aG91dERhdGFTeW5jOwpleHBvcnRzLmNsZWFuVG9vbHRpcFN0YXRlRm9yTGF5ZXIgPSBjbGVhblRvb2x0aXBTdGF0ZUZvckxheWVyOwpleHBvcnRzLnNldExheWVyVmlzaWJpbGl0eSA9IHNldExheWVyVmlzaWJpbGl0eTsKZXhwb3J0cy50b2dnbGVMYXllclZpc2libGUgPSB0b2dnbGVMYXllclZpc2libGU7CmV4cG9ydHMuc2V0U2VsZWN0ZWRMYXllciA9IHNldFNlbGVjdGVkTGF5ZXI7CmV4cG9ydHMucmVtb3ZlVHJhbnNpZW50TGF5ZXIgPSByZW1vdmVUcmFuc2llbnRMYXllcjsKZXhwb3J0cy5zZXRUcmFuc2llbnRMYXllciA9IHNldFRyYW5zaWVudExheWVyOwpleHBvcnRzLmNsZWFyVHJhbnNpZW50TGF5ZXJTdGF0ZUFuZENsb3NlRmx5b3V0ID0gY2xlYXJUcmFuc2llbnRMYXllclN0YXRlQW5kQ2xvc2VGbHlvdXQ7CmV4cG9ydHMudXBkYXRlTGF5ZXJPcmRlciA9IHVwZGF0ZUxheWVyT3JkZXI7CmV4cG9ydHMubWFwUmVhZHkgPSBtYXBSZWFkeTsKZXhwb3J0cy5tYXBEZXN0cm95ZWQgPSBtYXBEZXN0cm95ZWQ7CmV4cG9ydHMubWFwRXh0ZW50Q2hhbmdlZCA9IG1hcEV4dGVudENoYW5nZWQ7CmV4cG9ydHMuc2V0VG9vbHRpcFN0YXRlID0gc2V0VG9vbHRpcFN0YXRlOwpleHBvcnRzLnNldE1vdXNlQ29vcmRpbmF0ZXMgPSBzZXRNb3VzZUNvb3JkaW5hdGVzOwpleHBvcnRzLmNsZWFyTW91c2VDb29yZGluYXRlcyA9IGNsZWFyTW91c2VDb29yZGluYXRlczsKZXhwb3J0cy5kaXNhYmxlU2Nyb2xsWm9vbSA9IGRpc2FibGVTY3JvbGxab29tOwpleHBvcnRzLmZpdFRvTGF5ZXJFeHRlbnQgPSBmaXRUb0xheWVyRXh0ZW50OwpleHBvcnRzLnNldEdvdG9XaXRoQm91bmRzID0gc2V0R290b1dpdGhCb3VuZHM7CmV4cG9ydHMuc2V0R290b1dpdGhDZW50ZXIgPSBzZXRHb3RvV2l0aENlbnRlcjsKZXhwb3J0cy5jbGVhckdvdG8gPSBjbGVhckdvdG87CmV4cG9ydHMuc3RhcnREYXRhTG9hZCA9IHN0YXJ0RGF0YUxvYWQ7CmV4cG9ydHMudXBkYXRlU291cmNlRGF0YVJlcXVlc3QgPSB1cGRhdGVTb3VyY2VEYXRhUmVxdWVzdDsKZXhwb3J0cy5lbmREYXRhTG9hZCA9IGVuZERhdGFMb2FkOwpleHBvcnRzLm9uRGF0YUxvYWRFcnJvciA9IG9uRGF0YUxvYWRFcnJvcjsKZXhwb3J0cy51cGRhdGVTb3VyY2VQcm9wID0gdXBkYXRlU291cmNlUHJvcDsKZXhwb3J0cy5zeW5jRGF0YUZvckxheWVyID0gc3luY0RhdGFGb3JMYXllcjsKZXhwb3J0cy51cGRhdGVMYXllckxhYmVsID0gdXBkYXRlTGF5ZXJMYWJlbDsKZXhwb3J0cy51cGRhdGVMYXllck1pblpvb20gPSB1cGRhdGVMYXllck1pblpvb207CmV4cG9ydHMudXBkYXRlTGF5ZXJNYXhab29tID0gdXBkYXRlTGF5ZXJNYXhab29tOwpleHBvcnRzLnVwZGF0ZUxheWVyQWxwaGEgPSB1cGRhdGVMYXllckFscGhhOwpleHBvcnRzLnNldExheWVyUXVlcnkgPSBzZXRMYXllclF1ZXJ5OwpleHBvcnRzLnJlbW92ZVNlbGVjdGVkTGF5ZXIgPSByZW1vdmVTZWxlY3RlZExheWVyOwpleHBvcnRzLnJlbW92ZUxheWVyID0gcmVtb3ZlTGF5ZXI7CmV4cG9ydHMuc2V0UXVlcnkgPSBzZXRRdWVyeTsKZXhwb3J0cy5zZXRSZWZyZXNoQ29uZmlnID0gc2V0UmVmcmVzaENvbmZpZzsKZXhwb3J0cy50cmlnZ2VyUmVmcmVzaFRpbWVyID0gdHJpZ2dlclJlZnJlc2hUaW1lcjsKZXhwb3J0cy5jbGVhck1pc3NpbmdTdHlsZVByb3BlcnRpZXMgPSBjbGVhck1pc3NpbmdTdHlsZVByb3BlcnRpZXM7CmV4cG9ydHMudXBkYXRlTGF5ZXJTdHlsZSA9IHVwZGF0ZUxheWVyU3R5bGU7CmV4cG9ydHMudXBkYXRlU3R5bGVNZXRhID0gdXBkYXRlU3R5bGVNZXRhOwpleHBvcnRzLnVwZGF0ZUxheWVyU3R5bGVGb3JTZWxlY3RlZExheWVyID0gdXBkYXRlTGF5ZXJTdHlsZUZvclNlbGVjdGVkTGF5ZXI7CmV4cG9ydHMuc2V0Sm9pbnNGb3JMYXllciA9IHNldEpvaW5zRm9yTGF5ZXI7CmV4cG9ydHMudXBkYXRlRHJhd1N0YXRlID0gdXBkYXRlRHJhd1N0YXRlOwpleHBvcnRzLmRpc2FibGVJbnRlcmFjdGl2ZSA9IGRpc2FibGVJbnRlcmFjdGl2ZTsKZXhwb3J0cy5kaXNhYmxlVG9vbHRpcENvbnRyb2wgPSBkaXNhYmxlVG9vbHRpcENvbnRyb2w7CmV4cG9ydHMuaGlkZVRvb2xiYXJPdmVybGF5ID0gaGlkZVRvb2xiYXJPdmVybGF5OwpleHBvcnRzLmhpZGVMYXllckNvbnRyb2wgPSBoaWRlTGF5ZXJDb250cm9sOwpleHBvcnRzLmhpZGVWaWV3Q29udHJvbCA9IGhpZGVWaWV3Q29udHJvbDsKZXhwb3J0cy5zZXRIaWRkZW5MYXllcnMgPSBzZXRIaWRkZW5MYXllcnM7CmV4cG9ydHMuU0VUX1dBSVRJTkdfRk9SX1JFQURZX0hJRERFTl9MQVlFUlMgPSBleHBvcnRzLkhJREVfVklFV19DT05UUk9MID0gZXhwb3J0cy5ISURFX0xBWUVSX0NPTlRST0wgPSBleHBvcnRzLkhJREVfVE9PTEJBUl9PVkVSTEFZID0gZXhwb3J0cy5ESVNBQkxFX1RPT0xUSVBfQ09OVFJPTCA9IGV4cG9ydHMuU0VUX0lOVEVSQUNUSVZFID0gZXhwb3J0cy5TRVRfTUFQX0lOSVRfRVJST1IgPSBleHBvcnRzLlNFVF9TQ1JPTExfWk9PTSA9IGV4cG9ydHMuVVBEQVRFX0RSQVdfU1RBVEUgPSBleHBvcnRzLlNFVF9UT09MVElQX1NUQVRFID0gZXhwb3J0cy5SRU1PVkVfVFJBQ0tFRF9MQVlFUl9TVEFURSA9IGV4cG9ydHMuUk9MTEJBQ0tfVE9fVFJBQ0tFRF9MQVlFUl9TVEFURSA9IGV4cG9ydHMuVFJBQ0tfQ1VSUkVOVF9MQVlFUl9TVEFURSA9IGV4cG9ydHMuQ0xFQVJfR09UTyA9IGV4cG9ydHMuU0VUX0dPVE8gPSBleHBvcnRzLkNMRUFSX01PVVNFX0NPT1JESU5BVEVTID0gZXhwb3J0cy5TRVRfTU9VU0VfQ09PUkRJTkFURVMgPSBleHBvcnRzLlNFVF9SRUZSRVNIX0NPTkZJRyA9IGV4cG9ydHMuVVBEQVRFX1NPVVJDRV9QUk9QID0gZXhwb3J0cy5UT1VDSF9MQVlFUiA9IGV4cG9ydHMuU0VUX0xBWUVSX1NUWUxFX01FVEEgPSBleHBvcnRzLlVQREFURV9MQVlFUl9TVFlMRSA9IGV4cG9ydHMuVVBEQVRFX0xBWUVSX1BST1AgPSBleHBvcnRzLlRSSUdHRVJfUkVGUkVTSF9USU1FUiA9IGV4cG9ydHMuU0VUX1FVRVJZID0gZXhwb3J0cy5TRVRfSk9JTlMgPSBleHBvcnRzLlVQREFURV9TT1VSQ0VfREFUQV9SRVFVRVNUID0gZXhwb3J0cy5MQVlFUl9EQVRBX0xPQURfRVJST1IgPSBleHBvcnRzLkxBWUVSX0RBVEFfTE9BRF9FTkRFRCA9IGV4cG9ydHMuTEFZRVJfREFUQV9MT0FEX1NUQVJURUQgPSBleHBvcnRzLk1BUF9ERVNUUk9ZRUQgPSBleHBvcnRzLk1BUF9SRUFEWSA9IGV4cG9ydHMuTUFQX0VYVEVOVF9DSEFOR0VEID0gZXhwb3J0cy5TRVRfTEFZRVJfVklTSUJJTElUWSA9IGV4cG9ydHMuUkVNT1ZFX0xBWUVSID0gZXhwb3J0cy5DTEVBUl9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVJfTElTVCA9IGV4cG9ydHMuQUREX1dBSVRJTkdfRk9SX01BUF9SRUFEWV9MQVlFUiA9IGV4cG9ydHMuU0VUX0xBWUVSX0VSUk9SX1NUQVRVUyA9IGV4cG9ydHMuQUREX0xBWUVSID0gZXhwb3J0cy5VUERBVEVfTEFZRVJfT1JERVIgPSBleHBvcnRzLlNFVF9UUkFOU0lFTlRfTEFZRVIgPSBleHBvcnRzLlNFVF9TRUxFQ1RFRF9MQVlFUiA9IHZvaWQgMDsKCnZhciBfdHVyZiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidHVyZiIpKTsKCnZhciBfYm9vbGVhbkNvbnRhaW5zID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJAdHVyZi9ib29sZWFuLWNvbnRhaW5zIikpOwoKdmFyIF9tYXBfc2VsZWN0b3JzID0gcmVxdWlyZSgiLi4vc2VsZWN0b3JzL21hcF9zZWxlY3RvcnMiKTsKCnZhciBfdWkgPSByZXF1aXJlKCIuLi9yZWR1Y2Vycy91aSIpOwoKdmFyIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcyA9IHJlcXVpcmUoIi4uL3JlZHVjZXJzL25vbl9zZXJpYWxpemFibGVfaW5zdGFuY2VzIik7Cgp2YXIgX3VpX2FjdGlvbnMgPSByZXF1aXJlKCIuLi9hY3Rpb25zL3VpX2FjdGlvbnMiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vY29tbW9uL2NvbnN0YW50cyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBTRVRfU0VMRUNURURfTEFZRVIgPSAnU0VUX1NFTEVDVEVEX0xBWUVSJzsKZXhwb3J0cy5TRVRfU0VMRUNURURfTEFZRVIgPSBTRVRfU0VMRUNURURfTEFZRVI7CnZhciBTRVRfVFJBTlNJRU5UX0xBWUVSID0gJ1NFVF9UUkFOU0lFTlRfTEFZRVInOwpleHBvcnRzLlNFVF9UUkFOU0lFTlRfTEFZRVIgPSBTRVRfVFJBTlNJRU5UX0xBWUVSOwp2YXIgVVBEQVRFX0xBWUVSX09SREVSID0gJ1VQREFURV9MQVlFUl9PUkRFUic7CmV4cG9ydHMuVVBEQVRFX0xBWUVSX09SREVSID0gVVBEQVRFX0xBWUVSX09SREVSOwp2YXIgQUREX0xBWUVSID0gJ0FERF9MQVlFUic7CmV4cG9ydHMuQUREX0xBWUVSID0gQUREX0xBWUVSOwp2YXIgU0VUX0xBWUVSX0VSUk9SX1NUQVRVUyA9ICdTRVRfTEFZRVJfRVJST1JfU1RBVFVTJzsKZXhwb3J0cy5TRVRfTEFZRVJfRVJST1JfU1RBVFVTID0gU0VUX0xBWUVSX0VSUk9SX1NUQVRVUzsKdmFyIEFERF9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVIgPSAnQUREX1dBSVRJTkdfRk9SX01BUF9SRUFEWV9MQVlFUic7CmV4cG9ydHMuQUREX1dBSVRJTkdfRk9SX01BUF9SRUFEWV9MQVlFUiA9IEFERF9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVI7CnZhciBDTEVBUl9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVJfTElTVCA9ICdDTEVBUl9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVJfTElTVCc7CmV4cG9ydHMuQ0xFQVJfV0FJVElOR19GT1JfTUFQX1JFQURZX0xBWUVSX0xJU1QgPSBDTEVBUl9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVJfTElTVDsKdmFyIFJFTU9WRV9MQVlFUiA9ICdSRU1PVkVfTEFZRVInOwpleHBvcnRzLlJFTU9WRV9MQVlFUiA9IFJFTU9WRV9MQVlFUjsKdmFyIFNFVF9MQVlFUl9WSVNJQklMSVRZID0gJ1NFVF9MQVlFUl9WSVNJQklMSVRZJzsKZXhwb3J0cy5TRVRfTEFZRVJfVklTSUJJTElUWSA9IFNFVF9MQVlFUl9WSVNJQklMSVRZOwp2YXIgTUFQX0VYVEVOVF9DSEFOR0VEID0gJ01BUF9FWFRFTlRfQ0hBTkdFRCc7CmV4cG9ydHMuTUFQX0VYVEVOVF9DSEFOR0VEID0gTUFQX0VYVEVOVF9DSEFOR0VEOwp2YXIgTUFQX1JFQURZID0gJ01BUF9SRUFEWSc7CmV4cG9ydHMuTUFQX1JFQURZID0gTUFQX1JFQURZOwp2YXIgTUFQX0RFU1RST1lFRCA9ICdNQVBfREVTVFJPWUVEJzsKZXhwb3J0cy5NQVBfREVTVFJPWUVEID0gTUFQX0RFU1RST1lFRDsKdmFyIExBWUVSX0RBVEFfTE9BRF9TVEFSVEVEID0gJ0xBWUVSX0RBVEFfTE9BRF9TVEFSVEVEJzsKZXhwb3J0cy5MQVlFUl9EQVRBX0xPQURfU1RBUlRFRCA9IExBWUVSX0RBVEFfTE9BRF9TVEFSVEVEOwp2YXIgTEFZRVJfREFUQV9MT0FEX0VOREVEID0gJ0xBWUVSX0RBVEFfTE9BRF9FTkRFRCc7CmV4cG9ydHMuTEFZRVJfREFUQV9MT0FEX0VOREVEID0gTEFZRVJfREFUQV9MT0FEX0VOREVEOwp2YXIgTEFZRVJfREFUQV9MT0FEX0VSUk9SID0gJ0xBWUVSX0RBVEFfTE9BRF9FUlJPUic7CmV4cG9ydHMuTEFZRVJfREFUQV9MT0FEX0VSUk9SID0gTEFZRVJfREFUQV9MT0FEX0VSUk9SOwp2YXIgVVBEQVRFX1NPVVJDRV9EQVRBX1JFUVVFU1QgPSAnVVBEQVRFX1NPVVJDRV9EQVRBX1JFUVVFU1QnOwpleHBvcnRzLlVQREFURV9TT1VSQ0VfREFUQV9SRVFVRVNUID0gVVBEQVRFX1NPVVJDRV9EQVRBX1JFUVVFU1Q7CnZhciBTRVRfSk9JTlMgPSAnU0VUX0pPSU5TJzsKZXhwb3J0cy5TRVRfSk9JTlMgPSBTRVRfSk9JTlM7CnZhciBTRVRfUVVFUlkgPSAnU0VUX1FVRVJZJzsKZXhwb3J0cy5TRVRfUVVFUlkgPSBTRVRfUVVFUlk7CnZhciBUUklHR0VSX1JFRlJFU0hfVElNRVIgPSAnVFJJR0dFUl9SRUZSRVNIX1RJTUVSJzsKZXhwb3J0cy5UUklHR0VSX1JFRlJFU0hfVElNRVIgPSBUUklHR0VSX1JFRlJFU0hfVElNRVI7CnZhciBVUERBVEVfTEFZRVJfUFJPUCA9ICdVUERBVEVfTEFZRVJfUFJPUCc7CmV4cG9ydHMuVVBEQVRFX0xBWUVSX1BST1AgPSBVUERBVEVfTEFZRVJfUFJPUDsKdmFyIFVQREFURV9MQVlFUl9TVFlMRSA9ICdVUERBVEVfTEFZRVJfU1RZTEUnOwpleHBvcnRzLlVQREFURV9MQVlFUl9TVFlMRSA9IFVQREFURV9MQVlFUl9TVFlMRTsKdmFyIFNFVF9MQVlFUl9TVFlMRV9NRVRBID0gJ1NFVF9MQVlFUl9TVFlMRV9NRVRBJzsKZXhwb3J0cy5TRVRfTEFZRVJfU1RZTEVfTUVUQSA9IFNFVF9MQVlFUl9TVFlMRV9NRVRBOwp2YXIgVE9VQ0hfTEFZRVIgPSAnVE9VQ0hfTEFZRVInOwpleHBvcnRzLlRPVUNIX0xBWUVSID0gVE9VQ0hfTEFZRVI7CnZhciBVUERBVEVfU09VUkNFX1BST1AgPSAnVVBEQVRFX1NPVVJDRV9QUk9QJzsKZXhwb3J0cy5VUERBVEVfU09VUkNFX1BST1AgPSBVUERBVEVfU09VUkNFX1BST1A7CnZhciBTRVRfUkVGUkVTSF9DT05GSUcgPSAnU0VUX1JFRlJFU0hfQ09ORklHJzsKZXhwb3J0cy5TRVRfUkVGUkVTSF9DT05GSUcgPSBTRVRfUkVGUkVTSF9DT05GSUc7CnZhciBTRVRfTU9VU0VfQ09PUkRJTkFURVMgPSAnU0VUX01PVVNFX0NPT1JESU5BVEVTJzsKZXhwb3J0cy5TRVRfTU9VU0VfQ09PUkRJTkFURVMgPSBTRVRfTU9VU0VfQ09PUkRJTkFURVM7CnZhciBDTEVBUl9NT1VTRV9DT09SRElOQVRFUyA9ICdDTEVBUl9NT1VTRV9DT09SRElOQVRFUyc7CmV4cG9ydHMuQ0xFQVJfTU9VU0VfQ09PUkRJTkFURVMgPSBDTEVBUl9NT1VTRV9DT09SRElOQVRFUzsKdmFyIFNFVF9HT1RPID0gJ1NFVF9HT1RPJzsKZXhwb3J0cy5TRVRfR09UTyA9IFNFVF9HT1RPOwp2YXIgQ0xFQVJfR09UTyA9ICdDTEVBUl9HT1RPJzsKZXhwb3J0cy5DTEVBUl9HT1RPID0gQ0xFQVJfR09UTzsKdmFyIFRSQUNLX0NVUlJFTlRfTEFZRVJfU1RBVEUgPSAnVFJBQ0tfQ1VSUkVOVF9MQVlFUl9TVEFURSc7CmV4cG9ydHMuVFJBQ0tfQ1VSUkVOVF9MQVlFUl9TVEFURSA9IFRSQUNLX0NVUlJFTlRfTEFZRVJfU1RBVEU7CnZhciBST0xMQkFDS19UT19UUkFDS0VEX0xBWUVSX1NUQVRFID0gJ1JPTExCQUNLX1RPX1RSQUNLRURfTEFZRVJfU1RBVEUnOwpleHBvcnRzLlJPTExCQUNLX1RPX1RSQUNLRURfTEFZRVJfU1RBVEUgPSBST0xMQkFDS19UT19UUkFDS0VEX0xBWUVSX1NUQVRFOwp2YXIgUkVNT1ZFX1RSQUNLRURfTEFZRVJfU1RBVEUgPSAnUkVNT1ZFX1RSQUNLRURfTEFZRVJfU1RBVEUnOwpleHBvcnRzLlJFTU9WRV9UUkFDS0VEX0xBWUVSX1NUQVRFID0gUkVNT1ZFX1RSQUNLRURfTEFZRVJfU1RBVEU7CnZhciBTRVRfVE9PTFRJUF9TVEFURSA9ICdTRVRfVE9PTFRJUF9TVEFURSc7CmV4cG9ydHMuU0VUX1RPT0xUSVBfU1RBVEUgPSBTRVRfVE9PTFRJUF9TVEFURTsKdmFyIFVQREFURV9EUkFXX1NUQVRFID0gJ1VQREFURV9EUkFXX1NUQVRFJzsKZXhwb3J0cy5VUERBVEVfRFJBV19TVEFURSA9IFVQREFURV9EUkFXX1NUQVRFOwp2YXIgU0VUX1NDUk9MTF9aT09NID0gJ1NFVF9TQ1JPTExfWk9PTSc7CmV4cG9ydHMuU0VUX1NDUk9MTF9aT09NID0gU0VUX1NDUk9MTF9aT09NOwp2YXIgU0VUX01BUF9JTklUX0VSUk9SID0gJ1NFVF9NQVBfSU5JVF9FUlJPUic7CmV4cG9ydHMuU0VUX01BUF9JTklUX0VSUk9SID0gU0VUX01BUF9JTklUX0VSUk9SOwp2YXIgU0VUX0lOVEVSQUNUSVZFID0gJ1NFVF9JTlRFUkFDVElWRSc7CmV4cG9ydHMuU0VUX0lOVEVSQUNUSVZFID0gU0VUX0lOVEVSQUNUSVZFOwp2YXIgRElTQUJMRV9UT09MVElQX0NPTlRST0wgPSAnRElTQUJMRV9UT09MVElQX0NPTlRST0wnOwpleHBvcnRzLkRJU0FCTEVfVE9PTFRJUF9DT05UUk9MID0gRElTQUJMRV9UT09MVElQX0NPTlRST0w7CnZhciBISURFX1RPT0xCQVJfT1ZFUkxBWSA9ICdISURFX1RPT0xCQVJfT1ZFUkxBWSc7CmV4cG9ydHMuSElERV9UT09MQkFSX09WRVJMQVkgPSBISURFX1RPT0xCQVJfT1ZFUkxBWTsKdmFyIEhJREVfTEFZRVJfQ09OVFJPTCA9ICdISURFX0xBWUVSX0NPTlRST0wnOwpleHBvcnRzLkhJREVfTEFZRVJfQ09OVFJPTCA9IEhJREVfTEFZRVJfQ09OVFJPTDsKdmFyIEhJREVfVklFV19DT05UUk9MID0gJ0hJREVfVklFV19DT05UUk9MJzsKZXhwb3J0cy5ISURFX1ZJRVdfQ09OVFJPTCA9IEhJREVfVklFV19DT05UUk9MOwp2YXIgU0VUX1dBSVRJTkdfRk9SX1JFQURZX0hJRERFTl9MQVlFUlMgPSAnU0VUX1dBSVRJTkdfRk9SX1JFQURZX0hJRERFTl9MQVlFUlMnOwpleHBvcnRzLlNFVF9XQUlUSU5HX0ZPUl9SRUFEWV9ISURERU5fTEFZRVJTID0gU0VUX1dBSVRJTkdfRk9SX1JFQURZX0hJRERFTl9MQVlFUlM7CgpmdW5jdGlvbiBnZXRMYXllckxvYWRpbmdDYWxsYmFja3MoZGlzcGF0Y2gsIGxheWVySWQpIHsKICByZXR1cm4gewogICAgc3RhcnRMb2FkaW5nOiBmdW5jdGlvbiBzdGFydExvYWRpbmcoZGF0YUlkLCByZXF1ZXN0VG9rZW4sIG1ldGEpIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKHN0YXJ0RGF0YUxvYWQobGF5ZXJJZCwgZGF0YUlkLCByZXF1ZXN0VG9rZW4sIG1ldGEpKTsKICAgIH0sCiAgICBzdG9wTG9hZGluZzogZnVuY3Rpb24gc3RvcExvYWRpbmcoZGF0YUlkLCByZXF1ZXN0VG9rZW4sIGRhdGEsIG1ldGEpIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKGVuZERhdGFMb2FkKGxheWVySWQsIGRhdGFJZCwgcmVxdWVzdFRva2VuLCBkYXRhLCBtZXRhKSk7CiAgICB9LAogICAgb25Mb2FkRXJyb3I6IGZ1bmN0aW9uIG9uTG9hZEVycm9yKGRhdGFJZCwgcmVxdWVzdFRva2VuLCBlcnJvck1lc3NhZ2UpIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKG9uRGF0YUxvYWRFcnJvcihsYXllcklkLCBkYXRhSWQsIHJlcXVlc3RUb2tlbiwgZXJyb3JNZXNzYWdlKSk7CiAgICB9LAogICAgdXBkYXRlU291cmNlRGF0YTogZnVuY3Rpb24gdXBkYXRlU291cmNlRGF0YShuZXdEYXRhKSB7CiAgICAgIGRpc3BhdGNoKHVwZGF0ZVNvdXJjZURhdGFSZXF1ZXN0KGxheWVySWQsIG5ld0RhdGEpKTsKICAgIH0sCiAgICByZWdpc3RlckNhbmNlbENhbGxiYWNrOiBmdW5jdGlvbiByZWdpc3RlckNhbmNlbENhbGxiYWNrKHJlcXVlc3RUb2tlbiwgY2FsbGJhY2spIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKCgwLCBfbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMucmVnaXN0ZXJDYW5jZWxDYWxsYmFjaykocmVxdWVzdFRva2VuLCBjYWxsYmFjaykpOwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIGdldExheWVyQnlJZChsYXllcklkLCBzdGF0ZSkgewogIHJldHVybiAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0TGF5ZXJMaXN0KShzdGF0ZSkuZmluZChmdW5jdGlvbiAobGF5ZXIpIHsKICAgIHJldHVybiBsYXllcklkID09PSBsYXllci5nZXRJZCgpOwogIH0pOwp9CgpmdW5jdGlvbiBzeW5jRGF0YUZvckFsbExheWVycyhnZXRTdGF0ZSwgZGlzcGF0Y2gsIGRhdGFGaWx0ZXJzKSB7CiAgdmFyIHN0YXRlLCBsYXllckxpc3QsIHN5bmNzOwogIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gc3luY0RhdGFGb3JBbGxMYXllcnMkKF9jb250ZXh0KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgc3RhdGUgPSBnZXRTdGF0ZSgpOwogICAgICAgICAgbGF5ZXJMaXN0ID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldExheWVyTGlzdCkoc3RhdGUpOwogICAgICAgICAgc3luY3MgPSBsYXllckxpc3QubWFwKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgICAgICB2YXIgbG9hZGluZ0Z1bmN0aW9ucyA9IGdldExheWVyTG9hZGluZ0NhbGxiYWNrcyhkaXNwYXRjaCwgbGF5ZXIuZ2V0SWQoKSk7CiAgICAgICAgICAgIHJldHVybiBsYXllci5zeW5jRGF0YShfb2JqZWN0U3ByZWFkKHt9LCBsb2FkaW5nRnVuY3Rpb25zLCB7CiAgICAgICAgICAgICAgZGF0YUZpbHRlcnM6IGRhdGFGaWx0ZXJzCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0pOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKFByb21pc2UuYWxsKHN5bmNzKSk7CgogICAgICAgIGNhc2UgNToKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgfQogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBjYW5jZWxBbGxJbkZsaWdodFJlcXVlc3RzKCkgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0TGF5ZXJMaXN0KShnZXRTdGF0ZSgpKS5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICBsYXllci5nZXRJbkZsaWdodFJlcXVlc3RUb2tlbnMoKS5mb3JFYWNoKGZ1bmN0aW9uIChyZXF1ZXN0VG9rZW4pIHsKICAgICAgICBkaXNwYXRjaCgoMCwgX25vbl9zZXJpYWxpemFibGVfaW5zdGFuY2VzLmNhbmNlbFJlcXVlc3QpKHJlcXVlc3RUb2tlbikpOwogICAgICB9KTsKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHNldE1hcEluaXRFcnJvcihlcnJvck1lc3NhZ2UpIHsKICByZXR1cm4gewogICAgdHlwZTogU0VUX01BUF9JTklUX0VSUk9SLAogICAgZXJyb3JNZXNzYWdlOiBlcnJvck1lc3NhZ2UKICB9Owp9CgpmdW5jdGlvbiB0cmFja0N1cnJlbnRMYXllclN0YXRlKGxheWVySWQpIHsKICByZXR1cm4gewogICAgdHlwZTogVFJBQ0tfQ1VSUkVOVF9MQVlFUl9TVEFURSwKICAgIGxheWVySWQ6IGxheWVySWQKICB9Owp9CgpmdW5jdGlvbiByb2xsYmFja1RvVHJhY2tlZExheWVyU3RhdGVGb3JTZWxlY3RlZExheWVyKCkgewogIHJldHVybiBmdW5jdGlvbiBfY2FsbGVlKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIGxheWVySWQ7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0MikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBsYXllcklkID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldFNlbGVjdGVkTGF5ZXJJZCkoZ2V0U3RhdGUoKSk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkaXNwYXRjaCh7CiAgICAgICAgICAgICAgdHlwZTogUk9MTEJBQ0tfVE9fVFJBQ0tFRF9MQVlFUl9TVEFURSwKICAgICAgICAgICAgICBsYXllcklkOiBsYXllcklkCiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIC8vIEVuc3VyZSB1cGRhdGVTdHlsZU1ldGEgaXMgdHJpZ2dlcmVkCiAgICAgICAgICAgIC8vIHN5bmNEYXRhRm9yTGF5ZXIgbWF5IG5vdCB0cmlnZ2VyIGVuZERhdGFMb2FkIGlmIG5vIHJlLWZldGNoIGlzIHJlcXVpcmVkCiAgICAgICAgICAgIGRpc3BhdGNoKHVwZGF0ZVN0eWxlTWV0YShsYXllcklkKSk7CiAgICAgICAgICAgIGRpc3BhdGNoKHN5bmNEYXRhRm9yTGF5ZXIobGF5ZXJJZCkpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gcmVtb3ZlVHJhY2tlZExheWVyU3RhdGVGb3JTZWxlY3RlZExheWVyKCkgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgbGF5ZXJJZCA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRTZWxlY3RlZExheWVySWQpKGdldFN0YXRlKCkpOwogICAgZGlzcGF0Y2goewogICAgICB0eXBlOiBSRU1PVkVfVFJBQ0tFRF9MQVlFUl9TVEFURSwKICAgICAgbGF5ZXJJZDogbGF5ZXJJZAogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gcmVwbGFjZUxheWVyTGlzdChuZXdMYXllckxpc3QpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgKDAsIF9tYXBfc2VsZWN0b3JzLmdldExheWVyTGlzdFJhdykoZ2V0U3RhdGUoKSkuZm9yRWFjaChmdW5jdGlvbiAoX3JlZikgewogICAgICB2YXIgaWQgPSBfcmVmLmlkOwogICAgICBkaXNwYXRjaChyZW1vdmVMYXllckZyb21MYXllckxpc3QoaWQpKTsKICAgIH0pOwogICAgbmV3TGF5ZXJMaXN0LmZvckVhY2goZnVuY3Rpb24gKGxheWVyRGVzY3JpcHRvcikgewogICAgICBkaXNwYXRjaChhZGRMYXllcihsYXllckRlc2NyaXB0b3IpKTsKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIGNsb25lTGF5ZXIobGF5ZXJJZCkgewogIHJldHVybiBmdW5jdGlvbiBfY2FsbGVlMihkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBsYXllciwgY2xvbmVkRGVzY3JpcHRvcjsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MykgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBsYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICAgICAgICAgIGlmIChsYXllcikgewogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGxheWVyLmNsb25lRGVzY3JpcHRvcigpKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIGNsb25lZERlc2NyaXB0b3IgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgZGlzcGF0Y2goYWRkTGF5ZXIoY2xvbmVkRGVzY3JpcHRvcikpOwoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gYWRkTGF5ZXIobGF5ZXJEZXNjcmlwdG9yKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBpc01hcFJlYWR5ID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldE1hcFJlYWR5KShnZXRTdGF0ZSgpKTsKCiAgICBpZiAoIWlzTWFwUmVhZHkpIHsKICAgICAgZGlzcGF0Y2goewogICAgICAgIHR5cGU6IEFERF9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVIsCiAgICAgICAgbGF5ZXI6IGxheWVyRGVzY3JpcHRvcgogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGRpc3BhdGNoKHsKICAgICAgdHlwZTogQUREX0xBWUVSLAogICAgICBsYXllcjogbGF5ZXJEZXNjcmlwdG9yCiAgICB9KTsKICAgIGRpc3BhdGNoKHN5bmNEYXRhRm9yTGF5ZXIobGF5ZXJEZXNjcmlwdG9yLmlkKSk7CiAgfTsKfSAvLyBEbyBub3QgdXNlIHdoZW4gcmVuZGVyaW5nIGEgbWFwLiBNZXRob2QgZXhpc3RzIHRvIGVuYWJsZSBzZWxlY3RvcnMgZm9yIGdldExheWVyTGlzdCB3aGVuCi8vIHJlbmRlcmluZyBpcyBub3QgbmVlZGVkLgoKCmZ1bmN0aW9uIGFkZExheWVyV2l0aG91dERhdGFTeW5jKGxheWVyRGVzY3JpcHRvcikgewogIHJldHVybiB7CiAgICB0eXBlOiBBRERfTEFZRVIsCiAgICBsYXllcjogbGF5ZXJEZXNjcmlwdG9yCiAgfTsKfQoKZnVuY3Rpb24gc2V0TGF5ZXJEYXRhTG9hZEVycm9yU3RhdHVzKGxheWVySWQsIGVycm9yTWVzc2FnZSkgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gpIHsKICAgIGRpc3BhdGNoKHsKICAgICAgdHlwZTogU0VUX0xBWUVSX0VSUk9SX1NUQVRVUywKICAgICAgaXNJbkVycm9yU3RhdGU6IGVycm9yTWVzc2FnZSAhPT0gbnVsbCwKICAgICAgbGF5ZXJJZDogbGF5ZXJJZCwKICAgICAgZXJyb3JNZXNzYWdlOiBlcnJvck1lc3NhZ2UKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIGNsZWFuVG9vbHRpcFN0YXRlRm9yTGF5ZXIobGF5ZXJJZCkgewogIHZhciBsYXllckZlYXR1cmVzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBbXTsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIHRvb2x0aXBTdGF0ZSA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRUb29sdGlwU3RhdGUpKGdldFN0YXRlKCkpOwoKICAgIGlmICghdG9vbHRpcFN0YXRlKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgbmV4dFRvb2x0aXBGZWF0dXJlcyA9IHRvb2x0aXBTdGF0ZS5mZWF0dXJlcy5maWx0ZXIoZnVuY3Rpb24gKHRvb2x0aXBGZWF0dXJlKSB7CiAgICAgIGlmICh0b29sdGlwRmVhdHVyZS5sYXllcklkICE9PSBsYXllcklkKSB7CiAgICAgICAgLy8gZmVhdHVyZSBmcm9tIGFub3RoZXIgbGF5ZXIsIGtlZXAgaXQKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSAvLyBLZWVwIGZlYXR1cmUgaWYgaXQgaXMgc3RpbGwgaW4gbGF5ZXIKCgogICAgICByZXR1cm4gbGF5ZXJGZWF0dXJlcy5zb21lKGZ1bmN0aW9uIChsYXllckZlYXR1cmUpIHsKICAgICAgICByZXR1cm4gbGF5ZXJGZWF0dXJlLnByb3BlcnRpZXNbX2NvbnN0YW50cy5GRUFUVVJFX0lEX1BST1BFUlRZX05BTUVdID09PSB0b29sdGlwRmVhdHVyZS5pZDsKICAgICAgfSk7CiAgICB9KTsKCiAgICBpZiAodG9vbHRpcFN0YXRlLmZlYXR1cmVzLmxlbmd0aCA9PT0gbmV4dFRvb2x0aXBGZWF0dXJlcy5sZW5ndGgpIHsKICAgICAgLy8gbm8gZmVhdHVyZXMgZ290IHJlbW92ZWQsIG5vdGhpbmcgdG8gdXBkYXRlCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAobmV4dFRvb2x0aXBGZWF0dXJlcy5sZW5ndGggPT09IDApIHsKICAgICAgLy8gYWxsIGZlYXR1cmVzIHJlbW92ZWQgZnJvbSB0b29sdGlwLCBjbG9zZSB0b29sdGlwCiAgICAgIGRpc3BhdGNoKHNldFRvb2x0aXBTdGF0ZShudWxsKSk7CiAgICB9IGVsc2UgewogICAgICBkaXNwYXRjaChzZXRUb29sdGlwU3RhdGUoX29iamVjdFNwcmVhZCh7fSwgdG9vbHRpcFN0YXRlLCB7CiAgICAgICAgZmVhdHVyZXM6IG5leHRUb29sdGlwRmVhdHVyZXMKICAgICAgfSkpKTsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBzZXRMYXllclZpc2liaWxpdHkobGF5ZXJJZCwgbWFrZVZpc2libGUpIHsKICByZXR1cm4gZnVuY3Rpb24gX2NhbGxlZTMoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgbGF5ZXI7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgLy9pZiB0aGUgY3VycmVudC1zdGF0ZSBpcyBpbnZpc2libGUsIHdlIGFsc28gd2FudCB0byBzeW5jIGRhdGEKICAgICAgICAgICAgLy9lLmcuIGlmIGEgbGF5ZXIgd2FzIGludmlzaWJsZSBhdCBzdGFydC11cCwgaXQgd29uJ3QgaGF2ZSBhbnkgZGF0YSBsb2FkZWQKICAgICAgICAgICAgbGF5ZXIgPSBnZXRMYXllckJ5SWQobGF5ZXJJZCwgZ2V0U3RhdGUoKSk7IC8vIElmIHRoZSBsYXllciB2aXNpYmlsaXR5IGlzIGFscmVhZHkgd2hhdCB3ZSB3YW50IGl0IHRvIGJlLCBkbyBub3RoaW5nCgogICAgICAgICAgICBpZiAoISghbGF5ZXIgfHwgbGF5ZXIuaXNWaXNpYmxlKCkgPT09IG1ha2VWaXNpYmxlKSkgewogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgaWYgKCFtYWtlVmlzaWJsZSkgewogICAgICAgICAgICAgIGRpc3BhdGNoKGNsZWFuVG9vbHRpcFN0YXRlRm9yTGF5ZXIobGF5ZXJJZCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDY7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZGlzcGF0Y2goewogICAgICAgICAgICAgIHR5cGU6IFNFVF9MQVlFUl9WSVNJQklMSVRZLAogICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgdmlzaWJpbGl0eTogbWFrZVZpc2libGUKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgaWYgKG1ha2VWaXNpYmxlKSB7CiAgICAgICAgICAgICAgZGlzcGF0Y2goc3luY0RhdGFGb3JMYXllcihsYXllcklkKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHRvZ2dsZUxheWVyVmlzaWJsZShsYXllcklkKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIF9jYWxsZWU0KGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIGxheWVyLCBtYWtlVmlzaWJsZTsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NSkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBsYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICAgICAgICAgIGlmIChsYXllcikgewogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgbWFrZVZpc2libGUgPSAhbGF5ZXIuaXNWaXNpYmxlKCk7CiAgICAgICAgICAgIGRpc3BhdGNoKHNldExheWVyVmlzaWJpbGl0eShsYXllcklkLCBtYWtlVmlzaWJsZSkpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gc2V0U2VsZWN0ZWRMYXllcihsYXllcklkKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIF9jYWxsZWU1KGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIG9sZFNlbGVjdGVkTGF5ZXI7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDYpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgb2xkU2VsZWN0ZWRMYXllciA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRTZWxlY3RlZExheWVySWQpKGdldFN0YXRlKCkpOwoKICAgICAgICAgICAgaWYgKCFvbGRTZWxlY3RlZExheWVyKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZGlzcGF0Y2gocm9sbGJhY2tUb1RyYWNrZWRMYXllclN0YXRlRm9yU2VsZWN0ZWRMYXllcigpKSk7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBpZiAobGF5ZXJJZCkgewogICAgICAgICAgICAgIGRpc3BhdGNoKHRyYWNrQ3VycmVudExheWVyU3RhdGUobGF5ZXJJZCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgdHlwZTogU0VUX1NFTEVDVEVEX0xBWUVSLAogICAgICAgICAgICAgIHNlbGVjdGVkTGF5ZXJJZDogbGF5ZXJJZAogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHJlbW92ZVRyYW5zaWVudExheWVyKCkgewogIHJldHVybiBmdW5jdGlvbiBfY2FsbGVlNihkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciB0cmFuc2llbnRMYXllcklkOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ3KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHRyYW5zaWVudExheWVySWQgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0VHJhbnNpZW50TGF5ZXJJZCkoZ2V0U3RhdGUoKSk7CgogICAgICAgICAgICBpZiAoIXRyYW5zaWVudExheWVySWQpIHsKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNDsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkaXNwYXRjaChyZW1vdmVMYXllckZyb21MYXllckxpc3QodHJhbnNpZW50TGF5ZXJJZCkpKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNjsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkaXNwYXRjaChzZXRUcmFuc2llbnRMYXllcihudWxsKSkpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gc2V0VHJhbnNpZW50TGF5ZXIobGF5ZXJJZCkgewogIHJldHVybiB7CiAgICB0eXBlOiBTRVRfVFJBTlNJRU5UX0xBWUVSLAogICAgdHJhbnNpZW50TGF5ZXJJZDogbGF5ZXJJZAogIH07Cn0KCmZ1bmN0aW9uIGNsZWFyVHJhbnNpZW50TGF5ZXJTdGF0ZUFuZENsb3NlRmx5b3V0KCkgewogIHJldHVybiBmdW5jdGlvbiBfY2FsbGVlNyhkaXNwYXRjaCkgewogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ4KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMjsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkaXNwYXRjaCgoMCwgX3VpX2FjdGlvbnMudXBkYXRlRmx5b3V0KShfdWkuRkxZT1VUX1NUQVRFLk5PTkUpKSk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDQ7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZGlzcGF0Y2goc2V0U2VsZWN0ZWRMYXllcihudWxsKSkpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSA2OwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGRpc3BhdGNoKHJlbW92ZVRyYW5zaWVudExheWVyKCkpKTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZUxheWVyT3JkZXIobmV3TGF5ZXJPcmRlcikgewogIHJldHVybiB7CiAgICB0eXBlOiBVUERBVEVfTEFZRVJfT1JERVIsCiAgICBuZXdMYXllck9yZGVyOiBuZXdMYXllck9yZGVyCiAgfTsKfQoKZnVuY3Rpb24gbWFwUmVhZHkoKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIGRpc3BhdGNoKHsKICAgICAgdHlwZTogTUFQX1JFQURZCiAgICB9KTsKICAgICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRXYWl0aW5nRm9yTWFwUmVhZHlMYXllckxpc3RSYXcpKGdldFN0YXRlKCkpLmZvckVhY2goZnVuY3Rpb24gKGxheWVyRGVzY3JpcHRvcikgewogICAgICBkaXNwYXRjaChhZGRMYXllcihsYXllckRlc2NyaXB0b3IpKTsKICAgIH0pOwogICAgZGlzcGF0Y2goewogICAgICB0eXBlOiBDTEVBUl9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVJfTElTVAogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gbWFwRGVzdHJveWVkKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBNQVBfREVTVFJPWUVECiAgfTsKfQoKZnVuY3Rpb24gbWFwRXh0ZW50Q2hhbmdlZChuZXdNYXBDb25zdGFudHMpIHsKICByZXR1cm4gZnVuY3Rpb24gX2NhbGxlZTgoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgc3RhdGUsIGRhdGFGaWx0ZXJzLCBleHRlbnQsIG5ld1pvb20sIGJ1ZmZlciwgY3VycmVudFpvb20sIGRvZXNCdWZmZXJDb250YWluRXh0ZW50LCBidWZmZXJHZW9tZXRyeSwgZXh0ZW50R2VvbWV0cnksIHNjYWxlRmFjdG9yLCB3aWR0aCwgaGVpZ2h0LCBuZXdEYXRhRmlsdGVyczsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OSkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBzdGF0ZSA9IGdldFN0YXRlKCk7CiAgICAgICAgICAgIGRhdGFGaWx0ZXJzID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldERhdGFGaWx0ZXJzKShzdGF0ZSk7CiAgICAgICAgICAgIGV4dGVudCA9IG5ld01hcENvbnN0YW50cy5leHRlbnQsIG5ld1pvb20gPSBuZXdNYXBDb25zdGFudHMuem9vbTsKICAgICAgICAgICAgYnVmZmVyID0gZGF0YUZpbHRlcnMuYnVmZmVyLCBjdXJyZW50Wm9vbSA9IGRhdGFGaWx0ZXJzLnpvb207CgogICAgICAgICAgICBpZiAoZXh0ZW50KSB7CiAgICAgICAgICAgICAgZG9lc0J1ZmZlckNvbnRhaW5FeHRlbnQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKGJ1ZmZlcikgewogICAgICAgICAgICAgICAgYnVmZmVyR2VvbWV0cnkgPSBfdHVyZi5kZWZhdWx0LmJib3hQb2x5Z29uKFtidWZmZXIubWluTG9uLCBidWZmZXIubWluTGF0LCBidWZmZXIubWF4TG9uLCBidWZmZXIubWF4TGF0XSk7CiAgICAgICAgICAgICAgICBleHRlbnRHZW9tZXRyeSA9IF90dXJmLmRlZmF1bHQuYmJveFBvbHlnb24oW2V4dGVudC5taW5Mb24sIGV4dGVudC5taW5MYXQsIGV4dGVudC5tYXhMb24sIGV4dGVudC5tYXhMYXRdKTsKICAgICAgICAgICAgICAgIGRvZXNCdWZmZXJDb250YWluRXh0ZW50ID0gKDAsIF9ib29sZWFuQ29udGFpbnMuZGVmYXVsdCkoYnVmZmVyR2VvbWV0cnksIGV4dGVudEdlb21ldHJ5KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghZG9lc0J1ZmZlckNvbnRhaW5FeHRlbnQgfHwgY3VycmVudFpvb20gIT09IG5ld1pvb20pIHsKICAgICAgICAgICAgICAgIHNjYWxlRmFjdG9yID0gMC41OyAvLyBUT0RPIHB1dCBzY2FsZSBmYWN0b3IgaW4gc3RvcmUgYW5kIGZldGNoIHdpdGggc2VsZWN0b3IKCiAgICAgICAgICAgICAgICB3aWR0aCA9IGV4dGVudC5tYXhMb24gLSBleHRlbnQubWluTG9uOwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gZXh0ZW50Lm1heExhdCAtIGV4dGVudC5taW5MYXQ7CiAgICAgICAgICAgICAgICBkYXRhRmlsdGVycy5idWZmZXIgPSB7CiAgICAgICAgICAgICAgICAgIG1pbkxvbjogZXh0ZW50Lm1pbkxvbiAtIHdpZHRoICogc2NhbGVGYWN0b3IsCiAgICAgICAgICAgICAgICAgIG1pbkxhdDogZXh0ZW50Lm1pbkxhdCAtIGhlaWdodCAqIHNjYWxlRmFjdG9yLAogICAgICAgICAgICAgICAgICBtYXhMb246IGV4dGVudC5tYXhMb24gKyB3aWR0aCAqIHNjYWxlRmFjdG9yLAogICAgICAgICAgICAgICAgICBtYXhMYXQ6IGV4dGVudC5tYXhMYXQgKyBoZWlnaHQgKiBzY2FsZUZhY3RvcgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRpc3BhdGNoKHsKICAgICAgICAgICAgICB0eXBlOiBNQVBfRVhURU5UX0NIQU5HRUQsCiAgICAgICAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIGRhdGFGaWx0ZXJzLCB7fSwgbmV3TWFwQ29uc3RhbnRzKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbmV3RGF0YUZpbHRlcnMgPSBfb2JqZWN0U3ByZWFkKHt9LCBkYXRhRmlsdGVycywge30sIG5ld01hcENvbnN0YW50cyk7CiAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gOTsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChzeW5jRGF0YUZvckFsbExheWVycyhnZXRTdGF0ZSwgZGlzcGF0Y2gsIG5ld0RhdGFGaWx0ZXJzKSk7CgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBzZXRUb29sdGlwU3RhdGUodG9vbHRpcFN0YXRlKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6ICdTRVRfVE9PTFRJUF9TVEFURScsCiAgICB0b29sdGlwU3RhdGU6IHRvb2x0aXBTdGF0ZQogIH07Cn0KCmZ1bmN0aW9uIHNldE1vdXNlQ29vcmRpbmF0ZXMoX3JlZjIpIHsKICB2YXIgbGF0ID0gX3JlZjIubGF0LAogICAgICBsb24gPSBfcmVmMi5sb247CiAgdmFyIHNhZmVMb24gPSBsb247CgogIGlmIChsb24gPiAxODApIHsKICAgIHZhciBvdmVybGFwV2VzdE9mRGF0ZUxpbmUgPSBsb24gLSAxODA7CiAgICBzYWZlTG9uID0gLTE4MCArIG92ZXJsYXBXZXN0T2ZEYXRlTGluZTsKICB9IGVsc2UgaWYgKGxvbiA8IC0xODApIHsKICAgIHZhciBvdmVybGFwRWFzdE9mRGF0ZUxpbmUgPSBNYXRoLmFicyhsb24pIC0gMTgwOwogICAgc2FmZUxvbiA9IDE4MCAtIG92ZXJsYXBFYXN0T2ZEYXRlTGluZTsKICB9CgogIHJldHVybiB7CiAgICB0eXBlOiBTRVRfTU9VU0VfQ09PUkRJTkFURVMsCiAgICBsYXQ6IGxhdCwKICAgIGxvbjogc2FmZUxvbgogIH07Cn0KCmZ1bmN0aW9uIGNsZWFyTW91c2VDb29yZGluYXRlcygpIHsKICByZXR1cm4gewogICAgdHlwZTogQ0xFQVJfTU9VU0VfQ09PUkRJTkFURVMKICB9Owp9CgpmdW5jdGlvbiBkaXNhYmxlU2Nyb2xsWm9vbSgpIHsKICByZXR1cm4gewogICAgdHlwZTogU0VUX1NDUk9MTF9aT09NLAogICAgc2Nyb2xsWm9vbTogZmFsc2UKICB9Owp9CgpmdW5jdGlvbiBmaXRUb0xheWVyRXh0ZW50KGxheWVySWQpIHsKICByZXR1cm4gZnVuY3Rpb24gX2NhbGxlZTkoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgdGFyZ2V0TGF5ZXIsIF9kYXRhRmlsdGVycywgYm91bmRzOwoKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0MTApIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0YXJnZXRMYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICAgICAgICAgIGlmICghdGFyZ2V0TGF5ZXIpIHsKICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfZGF0YUZpbHRlcnMgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0RGF0YUZpbHRlcnMpKGdldFN0YXRlKCkpOwogICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA1OwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRhcmdldExheWVyLmdldEJvdW5kcyhfZGF0YUZpbHRlcnMpKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIGJvdW5kcyA9IF9jb250ZXh0MTAuc2VudDsKCiAgICAgICAgICAgIGlmICghYm91bmRzKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gOTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gOTsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkaXNwYXRjaChzZXRHb3RvV2l0aEJvdW5kcyhib3VuZHMpKSk7CgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gc2V0R290b1dpdGhCb3VuZHMoYm91bmRzKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6IFNFVF9HT1RPLAogICAgYm91bmRzOiBib3VuZHMKICB9Owp9CgpmdW5jdGlvbiBzZXRHb3RvV2l0aENlbnRlcihfcmVmMykgewogIHZhciBsYXQgPSBfcmVmMy5sYXQsCiAgICAgIGxvbiA9IF9yZWYzLmxvbiwKICAgICAgem9vbSA9IF9yZWYzLnpvb207CiAgcmV0dXJuIHsKICAgIHR5cGU6IFNFVF9HT1RPLAogICAgY2VudGVyOiB7CiAgICAgIGxhdDogbGF0LAogICAgICBsb246IGxvbiwKICAgICAgem9vbTogem9vbQogICAgfQogIH07Cn0KCmZ1bmN0aW9uIGNsZWFyR290bygpIHsKICByZXR1cm4gewogICAgdHlwZTogQ0xFQVJfR09UTwogIH07Cn0KCmZ1bmN0aW9uIHN0YXJ0RGF0YUxvYWQobGF5ZXJJZCwgZGF0YUlkLCByZXF1ZXN0VG9rZW4pIHsKICB2YXIgbWV0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDoge307CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBsYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICBpZiAobGF5ZXIpIHsKICAgICAgZGlzcGF0Y2goKDAsIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcy5jYW5jZWxSZXF1ZXN0KShsYXllci5nZXRQcmV2UmVxdWVzdFRva2VuKGRhdGFJZCkpKTsKICAgIH0KCiAgICB2YXIgZXZlbnRIYW5kbGVycyA9ICgwLCBfbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMuZ2V0RXZlbnRIYW5kbGVycykoZ2V0U3RhdGUoKSk7CgogICAgaWYgKGV2ZW50SGFuZGxlcnMgJiYgZXZlbnRIYW5kbGVycy5vbkRhdGFMb2FkKSB7CiAgICAgIGV2ZW50SGFuZGxlcnMub25EYXRhTG9hZCh7CiAgICAgICAgbGF5ZXJJZDogbGF5ZXJJZCwKICAgICAgICBkYXRhSWQ6IGRhdGFJZAogICAgICB9KTsKICAgIH0KCiAgICBkaXNwYXRjaCh7CiAgICAgIG1ldGE6IG1ldGEsCiAgICAgIHR5cGU6IExBWUVSX0RBVEFfTE9BRF9TVEFSVEVELAogICAgICBsYXllcklkOiBsYXllcklkLAogICAgICBkYXRhSWQ6IGRhdGFJZCwKICAgICAgcmVxdWVzdFRva2VuOiByZXF1ZXN0VG9rZW4KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZVNvdXJjZURhdGFSZXF1ZXN0KGxheWVySWQsIG5ld0RhdGEpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoKSB7CiAgICBkaXNwYXRjaCh7CiAgICAgIHR5cGU6IFVQREFURV9TT1VSQ0VfREFUQV9SRVFVRVNULAogICAgICBkYXRhSWQ6IF9jb25zdGFudHMuU09VUkNFX0RBVEFfSURfT1JJR0lOLAogICAgICBsYXllcklkOiBsYXllcklkLAogICAgICBuZXdEYXRhOiBuZXdEYXRhCiAgICB9KTsKICAgIGRpc3BhdGNoKHVwZGF0ZVN0eWxlTWV0YShsYXllcklkKSk7CiAgfTsKfQoKZnVuY3Rpb24gZW5kRGF0YUxvYWQobGF5ZXJJZCwgZGF0YUlkLCByZXF1ZXN0VG9rZW4sIGRhdGEsIG1ldGEpIHsKICByZXR1cm4gZnVuY3Rpb24gX2NhbGxlZTEwKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIGZlYXR1cmVzLCBldmVudEhhbmRsZXJzLCBfbGF5ZXIsIHJlc3VsdE1ldGE7CgogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTEpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBkaXNwYXRjaCgoMCwgX25vbl9zZXJpYWxpemFibGVfaW5zdGFuY2VzLnVucmVnaXN0ZXJDYW5jZWxDYWxsYmFjaykocmVxdWVzdFRva2VuKSk7CiAgICAgICAgICAgIGZlYXR1cmVzID0gZGF0YSAmJiBkYXRhLmZlYXR1cmVzID8gZGF0YS5mZWF0dXJlcyA6IFtdOwogICAgICAgICAgICBldmVudEhhbmRsZXJzID0gKDAsIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcy5nZXRFdmVudEhhbmRsZXJzKShnZXRTdGF0ZSgpKTsKCiAgICAgICAgICAgIGlmIChldmVudEhhbmRsZXJzICYmIGV2ZW50SGFuZGxlcnMub25EYXRhTG9hZEVuZCkgewogICAgICAgICAgICAgIF9sYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKICAgICAgICAgICAgICByZXN1bHRNZXRhID0ge307CgogICAgICAgICAgICAgIGlmIChfbGF5ZXIgJiYgX2xheWVyLmdldFR5cGUoKSA9PT0gX2NvbnN0YW50cy5MQVlFUl9UWVBFLlZFQ1RPUikgewogICAgICAgICAgICAgICAgcmVzdWx0TWV0YS5mZWF0dXJlc0NvdW50ID0gZmVhdHVyZXMubGVuZ3RoOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZXZlbnRIYW5kbGVycy5vbkRhdGFMb2FkRW5kKHsKICAgICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgICBkYXRhSWQ6IGRhdGFJZCwKICAgICAgICAgICAgICAgIHJlc3VsdE1ldGE6IHJlc3VsdE1ldGEKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGlzcGF0Y2goY2xlYW5Ub29sdGlwU3RhdGVGb3JMYXllcihsYXllcklkLCBmZWF0dXJlcykpOwogICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgdHlwZTogTEFZRVJfREFUQV9MT0FEX0VOREVELAogICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgZGF0YUlkOiBkYXRhSWQsCiAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICBtZXRhOiBtZXRhLAogICAgICAgICAgICAgIHJlcXVlc3RUb2tlbjogcmVxdWVzdFRva2VuCiAgICAgICAgICAgIH0pOyAvL0NsZWFyIGFueSBkYXRhLWxvYWQgZXJyb3JzIHdoZW4gdGhlcmUgaXMgYSBzdWNjZXNmdWwgZGF0YSByZXR1cm4uCiAgICAgICAgICAgIC8vQ28gdGhpcyBvbiBlbmQtZGF0YS1sb2FkIGlzbyBhdCBzdGFydC1kYXRhLWxvYWQgdG8gYXZvaWQgYmxpcHBpbmcgdGhlIGVycm9yIHN0YXR1cyBiZXR3ZWVuIHRydWUvZmFsc2UuCiAgICAgICAgICAgIC8vVGhpcyBhdm9pZHMgaml0dGVyIGluIHRoZSB3YXJuaW5nIGljb24gb2YgdGhlIFRPQyB3aGVuIHRoZSByZXF1ZXN0cyBjb250aW51ZXMgdG8gcmV0dXJuIGVycm9ycy4KCiAgICAgICAgICAgIGRpc3BhdGNoKHNldExheWVyRGF0YUxvYWRFcnJvclN0YXR1cyhsYXllcklkLCBudWxsKSk7CiAgICAgICAgICAgIGRpc3BhdGNoKHVwZGF0ZVN0eWxlTWV0YShsYXllcklkKSk7CgogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gb25EYXRhTG9hZEVycm9yKGxheWVySWQsIGRhdGFJZCwgcmVxdWVzdFRva2VuLCBlcnJvck1lc3NhZ2UpIHsKICByZXR1cm4gZnVuY3Rpb24gX2NhbGxlZTExKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIGV2ZW50SGFuZGxlcnM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGRpc3BhdGNoKCgwLCBfbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMudW5yZWdpc3RlckNhbmNlbENhbGxiYWNrKShyZXF1ZXN0VG9rZW4pKTsKICAgICAgICAgICAgZXZlbnRIYW5kbGVycyA9ICgwLCBfbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMuZ2V0RXZlbnRIYW5kbGVycykoZ2V0U3RhdGUoKSk7CgogICAgICAgICAgICBpZiAoZXZlbnRIYW5kbGVycyAmJiBldmVudEhhbmRsZXJzLm9uRGF0YUxvYWRFcnJvcikgewogICAgICAgICAgICAgIGV2ZW50SGFuZGxlcnMub25EYXRhTG9hZEVycm9yKHsKICAgICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgICBkYXRhSWQ6IGRhdGFJZCwKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZTogZXJyb3JNZXNzYWdlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRpc3BhdGNoKGNsZWFuVG9vbHRpcFN0YXRlRm9yTGF5ZXIobGF5ZXJJZCkpOwogICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgdHlwZTogTEFZRVJfREFUQV9MT0FEX0VSUk9SLAogICAgICAgICAgICAgIGRhdGE6IG51bGwsCiAgICAgICAgICAgICAgbGF5ZXJJZDogbGF5ZXJJZCwKICAgICAgICAgICAgICBkYXRhSWQ6IGRhdGFJZCwKICAgICAgICAgICAgICByZXF1ZXN0VG9rZW46IHJlcXVlc3RUb2tlbgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZGlzcGF0Y2goc2V0TGF5ZXJEYXRhTG9hZEVycm9yU3RhdHVzKGxheWVySWQsIGVycm9yTWVzc2FnZSkpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZVNvdXJjZVByb3AobGF5ZXJJZCwgcHJvcE5hbWUsIHZhbHVlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIF9jYWxsZWUxMihkaXNwYXRjaCkgewogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMTIkKF9jb250ZXh0MTMpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgdHlwZTogVVBEQVRFX1NPVVJDRV9QUk9QLAogICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgcHJvcE5hbWU6IHByb3BOYW1lLAogICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkaXNwYXRjaChjbGVhck1pc3NpbmdTdHlsZVByb3BlcnRpZXMobGF5ZXJJZCkpKTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGRpc3BhdGNoKHN5bmNEYXRhRm9yTGF5ZXIobGF5ZXJJZCkpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHN5bmNEYXRhRm9yTGF5ZXIobGF5ZXJJZCkgewogIHJldHVybiBmdW5jdGlvbiBfY2FsbGVlMTMoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgdGFyZ2V0TGF5ZXIsIF9kYXRhRmlsdGVyczIsIGxvYWRpbmdGdW5jdGlvbnM7CgogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTQucHJldiA9IF9jb250ZXh0MTQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0YXJnZXRMYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICAgICAgICAgIGlmICghdGFyZ2V0TGF5ZXIpIHsKICAgICAgICAgICAgICBfY29udGV4dDE0Lm5leHQgPSA2OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfZGF0YUZpbHRlcnMyID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldERhdGFGaWx0ZXJzKShnZXRTdGF0ZSgpKTsKICAgICAgICAgICAgbG9hZGluZ0Z1bmN0aW9ucyA9IGdldExheWVyTG9hZGluZ0NhbGxiYWNrcyhkaXNwYXRjaCwgbGF5ZXJJZCk7CiAgICAgICAgICAgIF9jb250ZXh0MTQubmV4dCA9IDY7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAodGFyZ2V0TGF5ZXIuc3luY0RhdGEoX29iamVjdFNwcmVhZCh7fSwgbG9hZGluZ0Z1bmN0aW9ucywgewogICAgICAgICAgICAgIGRhdGFGaWx0ZXJzOiBfZGF0YUZpbHRlcnMyCiAgICAgICAgICAgIH0pKSk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gdXBkYXRlTGF5ZXJMYWJlbChpZCwgbmV3TGFiZWwpIHsKICByZXR1cm4gewogICAgdHlwZTogVVBEQVRFX0xBWUVSX1BST1AsCiAgICBpZDogaWQsCiAgICBwcm9wTmFtZTogJ2xhYmVsJywKICAgIG5ld1ZhbHVlOiBuZXdMYWJlbAogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZUxheWVyTWluWm9vbShpZCwgbWluWm9vbSkgewogIHJldHVybiB7CiAgICB0eXBlOiBVUERBVEVfTEFZRVJfUFJPUCwKICAgIGlkOiBpZCwKICAgIHByb3BOYW1lOiAnbWluWm9vbScsCiAgICBuZXdWYWx1ZTogbWluWm9vbQogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZUxheWVyTWF4Wm9vbShpZCwgbWF4Wm9vbSkgewogIHJldHVybiB7CiAgICB0eXBlOiBVUERBVEVfTEFZRVJfUFJPUCwKICAgIGlkOiBpZCwKICAgIHByb3BOYW1lOiAnbWF4Wm9vbScsCiAgICBuZXdWYWx1ZTogbWF4Wm9vbQogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZUxheWVyQWxwaGEoaWQsIGFscGhhKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6IFVQREFURV9MQVlFUl9QUk9QLAogICAgaWQ6IGlkLAogICAgcHJvcE5hbWU6ICdhbHBoYScsCiAgICBuZXdWYWx1ZTogYWxwaGEKICB9Owp9CgpmdW5jdGlvbiBzZXRMYXllclF1ZXJ5KGlkLCBxdWVyeSkgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gpIHsKICAgIGRpc3BhdGNoKHsKICAgICAgdHlwZTogVVBEQVRFX0xBWUVSX1BST1AsCiAgICAgIGlkOiBpZCwKICAgICAgcHJvcE5hbWU6ICdxdWVyeScsCiAgICAgIG5ld1ZhbHVlOiBxdWVyeQogICAgfSk7CiAgICBkaXNwYXRjaChzeW5jRGF0YUZvckxheWVyKGlkKSk7CiAgfTsKfQoKZnVuY3Rpb24gcmVtb3ZlU2VsZWN0ZWRMYXllcigpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIHN0YXRlID0gZ2V0U3RhdGUoKTsKICAgIHZhciBsYXllcklkID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldFNlbGVjdGVkTGF5ZXJJZCkoc3RhdGUpOwogICAgZGlzcGF0Y2gocmVtb3ZlTGF5ZXIobGF5ZXJJZCkpOwogIH07Cn0KCmZ1bmN0aW9uIHJlbW92ZUxheWVyKGxheWVySWQpIHsKICByZXR1cm4gZnVuY3Rpb24gX2NhbGxlZTE0KGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIHN0YXRlLCBzZWxlY3RlZExheWVySWQ7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUxNCQoX2NvbnRleHQxNSkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHN0YXRlID0gZ2V0U3RhdGUoKTsKICAgICAgICAgICAgc2VsZWN0ZWRMYXllcklkID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldFNlbGVjdGVkTGF5ZXJJZCkoc3RhdGUpOwoKICAgICAgICAgICAgaWYgKCEobGF5ZXJJZCA9PT0gc2VsZWN0ZWRMYXllcklkKSkgewogICAgICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRpc3BhdGNoKCgwLCBfdWlfYWN0aW9ucy51cGRhdGVGbHlvdXQpKF91aS5GTFlPVVRfU1RBVEUuTk9ORSkpOwogICAgICAgICAgICBfY29udGV4dDE1Lm5leHQgPSA2OwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGRpc3BhdGNoKHNldFNlbGVjdGVkTGF5ZXIobnVsbCkpKTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGRpc3BhdGNoKHJlbW92ZUxheWVyRnJvbUxheWVyTGlzdChsYXllcklkKSk7CgogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gcmVtb3ZlTGF5ZXJGcm9tTGF5ZXJMaXN0KGxheWVySWQpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIGxheWVyR2V0dGluZ1JlbW92ZWQgPSBnZXRMYXllckJ5SWQobGF5ZXJJZCwgZ2V0U3RhdGUoKSk7CgogICAgaWYgKCFsYXllckdldHRpbmdSZW1vdmVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBsYXllckdldHRpbmdSZW1vdmVkLmdldEluRmxpZ2h0UmVxdWVzdFRva2VucygpLmZvckVhY2goZnVuY3Rpb24gKHJlcXVlc3RUb2tlbikgewogICAgICBkaXNwYXRjaCgoMCwgX25vbl9zZXJpYWxpemFibGVfaW5zdGFuY2VzLmNhbmNlbFJlcXVlc3QpKHJlcXVlc3RUb2tlbikpOwogICAgfSk7CiAgICBkaXNwYXRjaChjbGVhblRvb2x0aXBTdGF0ZUZvckxheWVyKGxheWVySWQpKTsKICAgIGxheWVyR2V0dGluZ1JlbW92ZWQuZGVzdHJveSgpOwogICAgZGlzcGF0Y2goewogICAgICB0eXBlOiBSRU1PVkVfTEFZRVIsCiAgICAgIGlkOiBsYXllcklkCiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBzZXRRdWVyeShfcmVmNCkgewogIHZhciBxdWVyeSA9IF9yZWY0LnF1ZXJ5LAogICAgICB0aW1lRmlsdGVycyA9IF9yZWY0LnRpbWVGaWx0ZXJzLAogICAgICBfcmVmNCRmaWx0ZXJzID0gX3JlZjQuZmlsdGVycywKICAgICAgZmlsdGVycyA9IF9yZWY0JGZpbHRlcnMgPT09IHZvaWQgMCA/IFtdIDogX3JlZjQkZmlsdGVycywKICAgICAgX3JlZjQkcmVmcmVzaCA9IF9yZWY0LnJlZnJlc2gsCiAgICAgIHJlZnJlc2ggPSBfcmVmNCRyZWZyZXNoID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY0JHJlZnJlc2g7CgogIGZ1bmN0aW9uIGdlbmVyYXRlUXVlcnlUaW1lc3RhbXAoKSB7CiAgICByZXR1cm4gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwogIH0KCiAgcmV0dXJuIGZ1bmN0aW9uIF9jYWxsZWUxNShkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBwcmV2UXVlcnksIHByZXZUcmlnZ2VyZWRBdCwgZGF0YUZpbHRlcnM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUxNSQoX2NvbnRleHQxNikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNi5wcmV2ID0gX2NvbnRleHQxNi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHByZXZRdWVyeSA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRRdWVyeSkoZ2V0U3RhdGUoKSk7CiAgICAgICAgICAgIHByZXZUcmlnZ2VyZWRBdCA9IHByZXZRdWVyeSAmJiBwcmV2UXVlcnkucXVlcnlMYXN0VHJpZ2dlcmVkQXQgPyBwcmV2UXVlcnkucXVlcnlMYXN0VHJpZ2dlcmVkQXQgOiBnZW5lcmF0ZVF1ZXJ5VGltZXN0YW1wKCk7CiAgICAgICAgICAgIGRpc3BhdGNoKHsKICAgICAgICAgICAgICB0eXBlOiBTRVRfUVVFUlksCiAgICAgICAgICAgICAgdGltZUZpbHRlcnM6IHRpbWVGaWx0ZXJzLAogICAgICAgICAgICAgIHF1ZXJ5OiBfb2JqZWN0U3ByZWFkKHt9LCBxdWVyeSwgewogICAgICAgICAgICAgICAgLy8gZW5zdXJlIHF1ZXJ5IGNoYW5nZXMgdG8gdHJpZ2dlciByZS1mZXRjaCB3aGVuICJSZWZyZXNoIiBjbGlja2VkCiAgICAgICAgICAgICAgICBxdWVyeUxhc3RUcmlnZ2VyZWRBdDogcmVmcmVzaCA/IGdlbmVyYXRlUXVlcnlUaW1lc3RhbXAoKSA6IHByZXZUcmlnZ2VyZWRBdAogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGZpbHRlcnM6IGZpbHRlcnMKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRhdGFGaWx0ZXJzID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldERhdGFGaWx0ZXJzKShnZXRTdGF0ZSgpKTsKICAgICAgICAgICAgX2NvbnRleHQxNi5uZXh0ID0gNjsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChzeW5jRGF0YUZvckFsbExheWVycyhnZXRTdGF0ZSwgZGlzcGF0Y2gsIGRhdGFGaWx0ZXJzKSk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gc2V0UmVmcmVzaENvbmZpZyhfcmVmNSkgewogIHZhciBpc1BhdXNlZCA9IF9yZWY1LmlzUGF1c2VkLAogICAgICBpbnRlcnZhbCA9IF9yZWY1LmludGVydmFsOwogIHJldHVybiB7CiAgICB0eXBlOiBTRVRfUkVGUkVTSF9DT05GSUcsCiAgICBpc1BhdXNlZDogaXNQYXVzZWQsCiAgICBpbnRlcnZhbDogaW50ZXJ2YWwKICB9Owp9CgpmdW5jdGlvbiB0cmlnZ2VyUmVmcmVzaFRpbWVyKCkgewogIHJldHVybiBmdW5jdGlvbiBfY2FsbGVlMTYoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgZGF0YUZpbHRlcnM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNykgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNy5wcmV2ID0gX2NvbnRleHQxNy5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGRpc3BhdGNoKHsKICAgICAgICAgICAgICB0eXBlOiBUUklHR0VSX1JFRlJFU0hfVElNRVIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRhdGFGaWx0ZXJzID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldERhdGFGaWx0ZXJzKShnZXRTdGF0ZSgpKTsKICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gNDsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChzeW5jRGF0YUZvckFsbExheWVycyhnZXRTdGF0ZSwgZGlzcGF0Y2gsIGRhdGFGaWx0ZXJzKSk7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gY2xlYXJNaXNzaW5nU3R5bGVQcm9wZXJ0aWVzKGxheWVySWQpIHsKICByZXR1cm4gZnVuY3Rpb24gX2NhbGxlZTE3KGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIHRhcmdldExheWVyLCBzdHlsZSwgbmV4dEZpZWxkcywgX3N0eWxlJGdldERlc2NyaXB0b3JXLCBoYXNDaGFuZ2VzLCBuZXh0U3R5bGVEZXNjcmlwdG9yOwoKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTE3JChfY29udGV4dDE4KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDE4LnByZXYgPSBfY29udGV4dDE4Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgdGFyZ2V0TGF5ZXIgPSBnZXRMYXllckJ5SWQobGF5ZXJJZCwgZ2V0U3RhdGUoKSk7CgogICAgICAgICAgICBpZiAodGFyZ2V0TGF5ZXIpIHsKICAgICAgICAgICAgICBfY29udGV4dDE4Lm5leHQgPSAzOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgc3R5bGUgPSB0YXJnZXRMYXllci5nZXRDdXJyZW50U3R5bGUoKTsKCiAgICAgICAgICAgIGlmIChzdHlsZSkgewogICAgICAgICAgICAgIF9jb250ZXh0MTgubmV4dCA9IDY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE4LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBfY29udGV4dDE4Lm5leHQgPSA4OwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRhcmdldExheWVyLmdldEZpZWxkcygpKTsKCiAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgIG5leHRGaWVsZHMgPSBfY29udGV4dDE4LnNlbnQ7CiAgICAgICAgICAgIC8vdGFrZSBpbnRvIGFjY291bnQgYWxsIGZpZWxkcywgc2luY2UgbGFiZWxzIGNhbiBiZSBkcml2ZW4gYnkgYW55IGZpZWxkIChzb3VyY2Ugb3Igam9pbikKICAgICAgICAgICAgX3N0eWxlJGdldERlc2NyaXB0b3JXID0gc3R5bGUuZ2V0RGVzY3JpcHRvcldpdGhNaXNzaW5nU3R5bGVQcm9wc1JlbW92ZWQobmV4dEZpZWxkcyksIGhhc0NoYW5nZXMgPSBfc3R5bGUkZ2V0RGVzY3JpcHRvclcuaGFzQ2hhbmdlcywgbmV4dFN0eWxlRGVzY3JpcHRvciA9IF9zdHlsZSRnZXREZXNjcmlwdG9yVy5uZXh0U3R5bGVEZXNjcmlwdG9yOwoKICAgICAgICAgICAgaWYgKGhhc0NoYW5nZXMpIHsKICAgICAgICAgICAgICBkaXNwYXRjaCh1cGRhdGVMYXllclN0eWxlKGxheWVySWQsIG5leHRTdHlsZURlc2NyaXB0b3IpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiB1cGRhdGVMYXllclN0eWxlKGxheWVySWQsIHN0eWxlRGVzY3JpcHRvcikgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gpIHsKICAgIGRpc3BhdGNoKHsKICAgICAgdHlwZTogVVBEQVRFX0xBWUVSX1NUWUxFLAogICAgICBsYXllcklkOiBsYXllcklkLAogICAgICBzdHlsZTogX29iamVjdFNwcmVhZCh7fSwgc3R5bGVEZXNjcmlwdG9yKQogICAgfSk7IC8vIEVuc3VyZSB1cGRhdGVTdHlsZU1ldGEgaXMgdHJpZ2dlcmVkCiAgICAvLyBzeW5jRGF0YUZvckxheWVyIG1heSBub3QgdHJpZ2dlciBlbmREYXRhTG9hZCBpZiBubyByZS1mZXRjaCBpcyByZXF1aXJlZAoKICAgIGRpc3BhdGNoKHVwZGF0ZVN0eWxlTWV0YShsYXllcklkKSk7IC8vIFN0eWxlIHVwZGF0ZSBtYXkgcmVxdWlyZSByZS1mZXRjaCwgZm9yIGV4YW1wbGUgRVMgc2VhcmNoIG1heSBuZWVkIHRvIHJldHJpZXZlIGZpZWxkIHVzZWQgZm9yIGR5bmFtaWMgc3R5bGluZwoKICAgIGRpc3BhdGNoKHN5bmNEYXRhRm9yTGF5ZXIobGF5ZXJJZCkpOwogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZVN0eWxlTWV0YShsYXllcklkKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIF9jYWxsZWUxOChkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBsYXllciwgc291cmNlRGF0YVJlcXVlc3QsIHN0eWxlLCBzdHlsZU1ldGE7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUxOCQoX2NvbnRleHQxOSkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQxOS5wcmV2ID0gX2NvbnRleHQxOS5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGxheWVyID0gZ2V0TGF5ZXJCeUlkKGxheWVySWQsIGdldFN0YXRlKCkpOwoKICAgICAgICAgICAgaWYgKGxheWVyKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gMzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHNvdXJjZURhdGFSZXF1ZXN0ID0gbGF5ZXIuZ2V0U291cmNlRGF0YVJlcXVlc3QoKTsKICAgICAgICAgICAgc3R5bGUgPSBsYXllci5nZXRDdXJyZW50U3R5bGUoKTsKCiAgICAgICAgICAgIGlmICghKCFzdHlsZSB8fCAhc291cmNlRGF0YVJlcXVlc3QpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gNzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIF9jb250ZXh0MTkubmV4dCA9IDk7CiAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoc3R5bGUucGx1Y2tTdHlsZU1ldGFGcm9tU291cmNlRGF0YVJlcXVlc3Qoc291cmNlRGF0YVJlcXVlc3QpKTsKCiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIHN0eWxlTWV0YSA9IF9jb250ZXh0MTkuc2VudDsKICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgIHR5cGU6IFNFVF9MQVlFUl9TVFlMRV9NRVRBLAogICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgc3R5bGVNZXRhOiBzdHlsZU1ldGEKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAxMToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE5LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZUxheWVyU3R5bGVGb3JTZWxlY3RlZExheWVyKHN0eWxlRGVzY3JpcHRvcikgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgc2VsZWN0ZWRMYXllcklkID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldFNlbGVjdGVkTGF5ZXJJZCkoZ2V0U3RhdGUoKSk7CgogICAgaWYgKCFzZWxlY3RlZExheWVySWQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGRpc3BhdGNoKHVwZGF0ZUxheWVyU3R5bGUoc2VsZWN0ZWRMYXllcklkLCBzdHlsZURlc2NyaXB0b3IpKTsKICB9Owp9CgpmdW5jdGlvbiBzZXRKb2luc0ZvckxheWVyKGxheWVyLCBqb2lucykgewogIHJldHVybiBmdW5jdGlvbiBfY2FsbGVlMTkoZGlzcGF0Y2gpIHsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTE5JChfY29udGV4dDIwKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQyMC5uZXh0ID0gMjsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkaXNwYXRjaCh7CiAgICAgICAgICAgICAgdHlwZTogU0VUX0pPSU5TLAogICAgICAgICAgICAgIGxheWVyOiBsYXllciwKICAgICAgICAgICAgICBqb2luczogam9pbnMKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgX2NvbnRleHQyMC5uZXh0ID0gNDsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChkaXNwYXRjaChjbGVhck1pc3NpbmdTdHlsZVByb3BlcnRpZXMobGF5ZXIuZ2V0SWQoKSkpKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGRpc3BhdGNoKHN5bmNEYXRhRm9yTGF5ZXIobGF5ZXIuZ2V0SWQoKSkpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZURyYXdTdGF0ZShkcmF3U3RhdGUpIHsKICByZXR1cm4gZnVuY3Rpb24gX2NhbGxlZTIwKGRpc3BhdGNoKSB7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUyMCQoX2NvbnRleHQyMSkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMS5wcmV2ID0gX2NvbnRleHQyMS5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGlmICghKGRyYXdTdGF0ZSAhPT0gbnVsbCkpIHsKICAgICAgICAgICAgICBfY29udGV4dDIxLm5leHQgPSAzOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dDIxLm5leHQgPSAzOwogICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGRpc3BhdGNoKHNldFRvb2x0aXBTdGF0ZShudWxsKSkpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgIHR5cGU6IFVQREFURV9EUkFXX1NUQVRFLAogICAgICAgICAgICAgIGRyYXdTdGF0ZTogZHJhd1N0YXRlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIxLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIGRpc2FibGVJbnRlcmFjdGl2ZSgpIHsKICByZXR1cm4gewogICAgdHlwZTogU0VUX0lOVEVSQUNUSVZFLAogICAgZGlzYWJsZUludGVyYWN0aXZlOiB0cnVlCiAgfTsKfQoKZnVuY3Rpb24gZGlzYWJsZVRvb2x0aXBDb250cm9sKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBESVNBQkxFX1RPT0xUSVBfQ09OVFJPTCwKICAgIGRpc2FibGVUb29sdGlwQ29udHJvbDogdHJ1ZQogIH07Cn0KCmZ1bmN0aW9uIGhpZGVUb29sYmFyT3ZlcmxheSgpIHsKICByZXR1cm4gewogICAgdHlwZTogSElERV9UT09MQkFSX09WRVJMQVksCiAgICBoaWRlVG9vbGJhck92ZXJsYXk6IHRydWUKICB9Owp9CgpmdW5jdGlvbiBoaWRlTGF5ZXJDb250cm9sKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBISURFX0xBWUVSX0NPTlRST0wsCiAgICBoaWRlTGF5ZXJDb250cm9sOiB0cnVlCiAgfTsKfQoKZnVuY3Rpb24gaGlkZVZpZXdDb250cm9sKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBISURFX1ZJRVdfQ09OVFJPTCwKICAgIGhpZGVWaWV3Q29udHJvbDogdHJ1ZQogIH07Cn0KCmZ1bmN0aW9uIHNldEhpZGRlbkxheWVycyhoaWRkZW5MYXllcklkcykgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgaXNNYXBSZWFkeSA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRNYXBSZWFkeSkoZ2V0U3RhdGUoKSk7CgogICAgaWYgKCFpc01hcFJlYWR5KSB7CiAgICAgIGRpc3BhdGNoKHsKICAgICAgICB0eXBlOiBTRVRfV0FJVElOR19GT1JfUkVBRFlfSElEREVOX0xBWUVSUywKICAgICAgICBoaWRkZW5MYXllcklkczogaGlkZGVuTGF5ZXJJZHMKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0TGF5ZXJMaXN0UmF3KShnZXRTdGF0ZSgpKS5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBkaXNwYXRjaChzZXRMYXllclZpc2liaWxpdHkobGF5ZXIuaWQsICFoaWRkZW5MYXllcklkcy5pbmNsdWRlcyhsYXllci5pZCkpKTsKICAgICAgfSk7CiAgICB9CiAgfTsKfQ=="},null]}