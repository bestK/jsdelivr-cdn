{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/layers/styles/vector/vector_style.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/layers/styles/vector/vector_style.js","mtime":1585205045365},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlZlY3RvclN0eWxlID0gdm9pZCAwOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF92ZWN0b3Jfc3R5bGVfZWRpdG9yID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL3ZlY3Rvcl9zdHlsZV9lZGl0b3IiKTsKCnZhciBfdmVjdG9yX3N0eWxlX2RlZmF1bHRzID0gcmVxdWlyZSgiLi92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMiKTsKCnZhciBfYWJzdHJhY3Rfc3R5bGUgPSByZXF1aXJlKCIuLi9hYnN0cmFjdF9zdHlsZSIpOwoKdmFyIF9jb25zdGFudHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vY29uc3RhbnRzIik7Cgp2YXIgX3ZlY3Rvcl9pY29uID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL2xlZ2VuZC92ZWN0b3JfaWNvbiIpOwoKdmFyIF92ZWN0b3Jfc3R5bGVfbGVnZW5kID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL2xlZ2VuZC92ZWN0b3Jfc3R5bGVfbGVnZW5kIik7Cgp2YXIgX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzID0gcmVxdWlyZSgiLi4vLi4vc291cmNlcy92ZWN0b3JfZmVhdHVyZV90eXBlcyIpOwoKdmFyIF92ZWN0b3JfY29uc3RhbnRzID0gcmVxdWlyZSgiLi92ZWN0b3JfY29uc3RhbnRzIik7Cgp2YXIgX3N5bWJvbF91dGlscyA9IHJlcXVpcmUoIi4vc3ltYm9sX3V0aWxzIik7Cgp2YXIgX3N0eWxlX3V0aWwgPSByZXF1aXJlKCIuL3N0eWxlX3V0aWwiKTsKCnZhciBfc3RhdGljX3N0eWxlX3Byb3BlcnR5ID0gcmVxdWlyZSgiLi9wcm9wZXJ0aWVzL3N0YXRpY19zdHlsZV9wcm9wZXJ0eSIpOwoKdmFyIF9keW5hbWljX3N0eWxlX3Byb3BlcnR5ID0gcmVxdWlyZSgiLi9wcm9wZXJ0aWVzL2R5bmFtaWNfc3R5bGVfcHJvcGVydHkiKTsKCnZhciBfZHluYW1pY19zaXplX3Byb3BlcnR5ID0gcmVxdWlyZSgiLi9wcm9wZXJ0aWVzL2R5bmFtaWNfc2l6ZV9wcm9wZXJ0eSIpOwoKdmFyIF9zdGF0aWNfc2l6ZV9wcm9wZXJ0eSA9IHJlcXVpcmUoIi4vcHJvcGVydGllcy9zdGF0aWNfc2l6ZV9wcm9wZXJ0eSIpOwoKdmFyIF9zdGF0aWNfY29sb3JfcHJvcGVydHkgPSByZXF1aXJlKCIuL3Byb3BlcnRpZXMvc3RhdGljX2NvbG9yX3Byb3BlcnR5Iik7Cgp2YXIgX2R5bmFtaWNfY29sb3JfcHJvcGVydHkgPSByZXF1aXJlKCIuL3Byb3BlcnRpZXMvZHluYW1pY19jb2xvcl9wcm9wZXJ0eSIpOwoKdmFyIF9zdGF0aWNfb3JpZW50YXRpb25fcHJvcGVydHkgPSByZXF1aXJlKCIuL3Byb3BlcnRpZXMvc3RhdGljX29yaWVudGF0aW9uX3Byb3BlcnR5Iik7Cgp2YXIgX2R5bmFtaWNfb3JpZW50YXRpb25fcHJvcGVydHkgPSByZXF1aXJlKCIuL3Byb3BlcnRpZXMvZHluYW1pY19vcmllbnRhdGlvbl9wcm9wZXJ0eSIpOwoKdmFyIF9zdGF0aWNfdGV4dF9wcm9wZXJ0eSA9IHJlcXVpcmUoIi4vcHJvcGVydGllcy9zdGF0aWNfdGV4dF9wcm9wZXJ0eSIpOwoKdmFyIF9keW5hbWljX3RleHRfcHJvcGVydHkgPSByZXF1aXJlKCIuL3Byb3BlcnRpZXMvZHluYW1pY190ZXh0X3Byb3BlcnR5Iik7Cgp2YXIgX2xhYmVsX2JvcmRlcl9zaXplX3Byb3BlcnR5ID0gcmVxdWlyZSgiLi9wcm9wZXJ0aWVzL2xhYmVsX2JvcmRlcl9zaXplX3Byb3BlcnR5Iik7Cgp2YXIgX2V4dHJhY3RfY29sb3JfZnJvbV9zdHlsZV9wcm9wZXJ0eSA9IHJlcXVpcmUoIi4vY29tcG9uZW50cy9sZWdlbmQvZXh0cmFjdF9jb2xvcl9mcm9tX3N0eWxlX3Byb3BlcnR5Iik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIFBPSU5UUyA9IFtfY29uc3RhbnRzLkdFT19KU09OX1RZUEUuUE9JTlQsIF9jb25zdGFudHMuR0VPX0pTT05fVFlQRS5NVUxUSV9QT0lOVF07CnZhciBMSU5FUyA9IFtfY29uc3RhbnRzLkdFT19KU09OX1RZUEUuTElORV9TVFJJTkcsIF9jb25zdGFudHMuR0VPX0pTT05fVFlQRS5NVUxUSV9MSU5FX1NUUklOR107CnZhciBQT0xZR09OUyA9IFtfY29uc3RhbnRzLkdFT19KU09OX1RZUEUuUE9MWUdPTiwgX2NvbnN0YW50cy5HRU9fSlNPTl9UWVBFLk1VTFRJX1BPTFlHT05dOwoKdmFyIFZlY3RvclN0eWxlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0Fic3RyYWN0U3R5bGUpIHsKICBfaW5oZXJpdHMoVmVjdG9yU3R5bGUsIF9BYnN0cmFjdFN0eWxlKTsKCiAgX2NyZWF0ZUNsYXNzKFZlY3RvclN0eWxlLCBudWxsLCBbewogICAga2V5OiAiY3JlYXRlRGVzY3JpcHRvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRGVzY3JpcHRvcigpIHsKICAgICAgdmFyIHByb3BlcnRpZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgaXNUaW1lQXdhcmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRydWU7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogVmVjdG9yU3R5bGUudHlwZSwKICAgICAgICBwcm9wZXJ0aWVzOiBfb2JqZWN0U3ByZWFkKHt9LCAoMCwgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5nZXREZWZhdWx0UHJvcGVydGllcykoKSwge30sIHByb3BlcnRpZXMpLAogICAgICAgIGlzVGltZUF3YXJlOiBpc1RpbWVBd2FyZQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZURlZmF1bHRTdHlsZVByb3BlcnRpZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRTdHlsZVByb3BlcnRpZXMobWFwQ29sb3JzKSB7CiAgICAgIHJldHVybiAoMCwgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5nZXREZWZhdWx0UHJvcGVydGllcykobWFwQ29sb3JzKTsKICAgIH0KICB9XSk7CgogIGZ1bmN0aW9uIFZlY3RvclN0eWxlKCkgewogICAgdmFyIF90aGlzOwoKICAgIHZhciBkZXNjcmlwdG9yID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgIHZhciBsYXllciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBWZWN0b3JTdHlsZSk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVmVjdG9yU3R5bGUpLmNhbGwodGhpcykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9nZXRJc1BvaW50c09ubHkiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuZ2V0KF90aGlzLl9nZXRTdHlsZU1ldGEoKSwgJ2dlb21ldHJ5VHlwZXMuaXNQb2ludHNPbmx5JywgZmFsc2UpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2dldElzTGluZXNPbmx5IiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LmdldChfdGhpcy5fZ2V0U3R5bGVNZXRhKCksICdnZW9tZXRyeVR5cGVzLmlzTGluZXNPbmx5JywgZmFsc2UpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2dldElzUG9seWdvbnNPbmx5IiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LmdldChfdGhpcy5fZ2V0U3R5bGVNZXRhKCksICdnZW9tZXRyeVR5cGVzLmlzUG9seWdvbnNPbmx5JywgZmFsc2UpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2dldEZpZWxkTWV0YSIsIGZ1bmN0aW9uIChmaWVsZE5hbWUpIHsKICAgICAgdmFyIGZpZWxkTWV0YUZyb21Mb2NhbEZlYXR1cmVzID0gX2xvZGFzaC5kZWZhdWx0LmdldChfdGhpcy5fZGVzY3JpcHRvciwgWydfX3N0eWxlTWV0YScsIGZpZWxkTmFtZV0pOwoKICAgICAgdmFyIGR5bmFtaWNQcm9wID0gX3RoaXMuX2dldER5bmFtaWNQcm9wZXJ0eUJ5RmllbGROYW1lKGZpZWxkTmFtZSk7CgogICAgICBpZiAoIWR5bmFtaWNQcm9wIHx8ICFkeW5hbWljUHJvcC5pc0ZpZWxkTWV0YUVuYWJsZWQoKSkgewogICAgICAgIHJldHVybiBmaWVsZE1ldGFGcm9tTG9jYWxGZWF0dXJlczsKICAgICAgfQoKICAgICAgdmFyIGRhdGFSZXF1ZXN0SWQ7CgogICAgICBpZiAoZHluYW1pY1Byb3AuZ2V0RmllbGRPcmlnaW4oKSA9PT0gX2NvbnN0YW50cy5GSUVMRF9PUklHSU4uU09VUkNFKSB7CiAgICAgICAgZGF0YVJlcXVlc3RJZCA9IF9jb25zdGFudHMuU09VUkNFX01FVEFfSURfT1JJR0lOOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBqb2luID0gX3RoaXMuX2xheWVyLmdldFZhbGlkSm9pbnMoKS5maW5kKGZ1bmN0aW9uIChqb2luKSB7CiAgICAgICAgICByZXR1cm4gam9pbi5nZXRSaWdodEpvaW5Tb3VyY2UoKS5oYXNNYXRjaGluZ01ldHJpY0ZpZWxkKGZpZWxkTmFtZSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChqb2luKSB7CiAgICAgICAgICBkYXRhUmVxdWVzdElkID0gam9pbi5nZXRTb3VyY2VNZXRhRGF0YVJlcXVlc3RJZCgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFkYXRhUmVxdWVzdElkKSB7CiAgICAgICAgcmV0dXJuIGZpZWxkTWV0YUZyb21Mb2NhbEZlYXR1cmVzOwogICAgICB9CgogICAgICB2YXIgc3R5bGVNZXRhRGF0YVJlcXVlc3QgPSBfdGhpcy5fbGF5ZXIuX2ZpbmREYXRhUmVxdWVzdEJ5SWQoZGF0YVJlcXVlc3RJZCk7CgogICAgICBpZiAoIXN0eWxlTWV0YURhdGFSZXF1ZXN0IHx8ICFzdHlsZU1ldGFEYXRhUmVxdWVzdC5oYXNEYXRhKCkpIHsKICAgICAgICByZXR1cm4gZmllbGRNZXRhRnJvbUxvY2FsRmVhdHVyZXM7CiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gc3R5bGVNZXRhRGF0YVJlcXVlc3QuZ2V0RGF0YSgpOwogICAgICB2YXIgZmllbGRNZXRhID0gZHluYW1pY1Byb3AucGx1Y2tTdHlsZU1ldGFGcm9tRmllbGRNZXRhRGF0YShkYXRhKTsKICAgICAgcmV0dXJuIGZpZWxkTWV0YSA/IGZpZWxkTWV0YSA6IGZpZWxkTWV0YUZyb21Mb2NhbEZlYXR1cmVzOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2dldEZpZWxkRm9ybWF0dGVyIiwgZnVuY3Rpb24gKGZpZWxkTmFtZSkgewogICAgICB2YXIgZHluYW1pY1Byb3AgPSBfdGhpcy5fZ2V0RHluYW1pY1Byb3BlcnR5QnlGaWVsZE5hbWUoZmllbGROYW1lKTsKCiAgICAgIGlmICghZHluYW1pY1Byb3ApIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGRhdGFSZXF1ZXN0SWQ7CgogICAgICBpZiAoZHluYW1pY1Byb3AuZ2V0RmllbGRPcmlnaW4oKSA9PT0gX2NvbnN0YW50cy5GSUVMRF9PUklHSU4uU09VUkNFKSB7CiAgICAgICAgZGF0YVJlcXVlc3RJZCA9IF9jb25zdGFudHMuU09VUkNFX0ZPUk1BVFRFUlNfSURfT1JJR0lOOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBqb2luID0gX3RoaXMuX2xheWVyLmdldFZhbGlkSm9pbnMoKS5maW5kKGZ1bmN0aW9uIChqb2luKSB7CiAgICAgICAgICByZXR1cm4gam9pbi5nZXRSaWdodEpvaW5Tb3VyY2UoKS5oYXNNYXRjaGluZ01ldHJpY0ZpZWxkKGZpZWxkTmFtZSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChqb2luKSB7CiAgICAgICAgICBkYXRhUmVxdWVzdElkID0gam9pbi5nZXRTb3VyY2VGb3JtYXR0ZXJzRGF0YVJlcXVlc3RJZCgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFkYXRhUmVxdWVzdElkKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBmb3JtYXR0ZXJzRGF0YVJlcXVlc3QgPSBfdGhpcy5fbGF5ZXIuX2ZpbmREYXRhUmVxdWVzdEJ5SWQoZGF0YVJlcXVlc3RJZCk7CgogICAgICBpZiAoIWZvcm1hdHRlcnNEYXRhUmVxdWVzdCB8fCAhZm9ybWF0dGVyc0RhdGFSZXF1ZXN0Lmhhc0RhdGEoKSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgZm9ybWF0dGVycyA9IGZvcm1hdHRlcnNEYXRhUmVxdWVzdC5nZXREYXRhKCk7CiAgICAgIHJldHVybiBmb3JtYXR0ZXJzW2ZpZWxkTmFtZV07CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfZ2V0U3R5bGVNZXRhIiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX2xvZGFzaC5kZWZhdWx0LmdldChfdGhpcy5fZGVzY3JpcHRvciwgJ19fc3R5bGVNZXRhJywge30pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0SWNvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGlzTGluZXNPbmx5ID0gX3RoaXMuX2dldElzTGluZXNPbmx5KCk7CgogICAgICB2YXIgc3Ryb2tlQ29sb3IgPSBpc0xpbmVzT25seSA/ICgwLCBfZXh0cmFjdF9jb2xvcl9mcm9tX3N0eWxlX3Byb3BlcnR5LmV4dHJhY3RDb2xvckZyb21TdHlsZVByb3BlcnR5KShfdGhpcy5fZGVzY3JpcHRvci5wcm9wZXJ0aWVzW192ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MSU5FX0NPTE9SXSwgJ2dyZXknKSA6ICgwLCBfZXh0cmFjdF9jb2xvcl9mcm9tX3N0eWxlX3Byb3BlcnR5LmV4dHJhY3RDb2xvckZyb21TdHlsZVByb3BlcnR5KShfdGhpcy5fZGVzY3JpcHRvci5wcm9wZXJ0aWVzW192ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MSU5FX0NPTE9SXSwgJ25vbmUnKTsKICAgICAgdmFyIGZpbGxDb2xvciA9IGlzTGluZXNPbmx5ID8gbnVsbCA6ICgwLCBfZXh0cmFjdF9jb2xvcl9mcm9tX3N0eWxlX3Byb3BlcnR5LmV4dHJhY3RDb2xvckZyb21TdHlsZVByb3BlcnR5KShfdGhpcy5fZGVzY3JpcHRvci5wcm9wZXJ0aWVzW192ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5GSUxMX0NPTE9SXSwgJ2dyZXknKTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3ZlY3Rvcl9pY29uLlZlY3Rvckljb24sIHsKICAgICAgICBpc1BvaW50c09ubHk6IF90aGlzLl9nZXRJc1BvaW50c09ubHkoKSwKICAgICAgICBpc0xpbmVzT25seTogaXNMaW5lc09ubHksCiAgICAgICAgc3ltYm9sSWQ6IF90aGlzLl9nZXRTeW1ib2xJZCgpLAogICAgICAgIHN0cm9rZUNvbG9yOiBzdHJva2VDb2xvciwKICAgICAgICBmaWxsQ29sb3I6IGZpbGxDb2xvcgogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9nZXRMZWdlbmREZXRhaWxTdHlsZVByb3BlcnRpZXMiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpcy5nZXREeW5hbWljUHJvcGVydGllc0FycmF5KCkuZmlsdGVyKGZ1bmN0aW9uIChzdHlsZVByb3BlcnR5KSB7CiAgICAgICAgdmFyIHN0eWxlTmFtZSA9IHN0eWxlUHJvcGVydHkuZ2V0U3R5bGVOYW1lKCk7CgogICAgICAgIGlmIChbX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLklDT05fT1JJRU5UQVRJT04sIF92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9URVhUXS5pbmNsdWRlcyhzdHlsZU5hbWUpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3RoaXMuX2dldElzTGluZXNPbmx5KCkpIHsKICAgICAgICAgIHJldHVybiBfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLkxJTkVfU1RZTEVTLmluY2x1ZGVzKHN0eWxlTmFtZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3RoaXMuX2dldElzUG9seWdvbnNPbmx5KCkpIHsKICAgICAgICAgIHJldHVybiBfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlBPTFlHT05fU1RZTEVTLmluY2x1ZGVzKHN0eWxlTmFtZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfdGhpcy5fc291cmNlID0gc291cmNlOwogICAgX3RoaXMuX2xheWVyID0gbGF5ZXI7CiAgICBfdGhpcy5fZGVzY3JpcHRvciA9IF9vYmplY3RTcHJlYWQoe30sIGRlc2NyaXB0b3IsIHt9LCBWZWN0b3JTdHlsZS5jcmVhdGVEZXNjcmlwdG9yKGRlc2NyaXB0b3IucHJvcGVydGllcywgZGVzY3JpcHRvci5pc1RpbWVBd2FyZSkpOwogICAgX3RoaXMuX2xpbmVDb2xvclN0eWxlUHJvcGVydHkgPSBfdGhpcy5fbWFrZUNvbG9yUHJvcGVydHkoX3RoaXMuX2Rlc2NyaXB0b3IucHJvcGVydGllc1tfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlZFQ1RPUl9TVFlMRVMuTElORV9DT0xPUl0sIF92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MSU5FX0NPTE9SKTsKICAgIF90aGlzLl9maWxsQ29sb3JTdHlsZVByb3BlcnR5ID0gX3RoaXMuX21ha2VDb2xvclByb3BlcnR5KF90aGlzLl9kZXNjcmlwdG9yLnByb3BlcnRpZXNbX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLkZJTExfQ09MT1JdLCBfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlZFQ1RPUl9TVFlMRVMuRklMTF9DT0xPUik7CiAgICBfdGhpcy5fbGluZVdpZHRoU3R5bGVQcm9wZXJ0eSA9IF90aGlzLl9tYWtlU2l6ZVByb3BlcnR5KF90aGlzLl9kZXNjcmlwdG9yLnByb3BlcnRpZXNbX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLkxJTkVfV0lEVEhdLCBfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlZFQ1RPUl9TVFlMRVMuTElORV9XSURUSCk7CiAgICBfdGhpcy5faWNvblNpemVTdHlsZVByb3BlcnR5ID0gX3RoaXMuX21ha2VTaXplUHJvcGVydHkoX3RoaXMuX2Rlc2NyaXB0b3IucHJvcGVydGllc1tfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9TSVpFXSwgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLklDT05fU0laRSwgX3RoaXMuX2Rlc2NyaXB0b3IucHJvcGVydGllc1tfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlZFQ1RPUl9TVFlMRVMuU1lNQk9MXS5vcHRpb25zLnN5bWJvbGl6ZUFzID09PSBfdmVjdG9yX2NvbnN0YW50cy5TWU1CT0xJWkVfQVNfSUNPTik7CiAgICBfdGhpcy5faWNvbk9yaWVudGF0aW9uUHJvcGVydHkgPSBfdGhpcy5fbWFrZU9yaWVudGF0aW9uUHJvcGVydHkoX3RoaXMuX2Rlc2NyaXB0b3IucHJvcGVydGllc1tfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9PUklFTlRBVElPTl0sIF92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5JQ09OX09SSUVOVEFUSU9OKTsKICAgIF90aGlzLl9sYWJlbFN0eWxlUHJvcGVydHkgPSBfdGhpcy5fbWFrZUxhYmVsUHJvcGVydHkoX3RoaXMuX2Rlc2NyaXB0b3IucHJvcGVydGllc1tfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfVEVYVF0pOwogICAgX3RoaXMuX2xhYmVsU2l6ZVN0eWxlUHJvcGVydHkgPSBfdGhpcy5fbWFrZVNpemVQcm9wZXJ0eShfdGhpcy5fZGVzY3JpcHRvci5wcm9wZXJ0aWVzW192ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9TSVpFXSwgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLkxBQkVMX1NJWkUpOwogICAgX3RoaXMuX2xhYmVsQ29sb3JTdHlsZVByb3BlcnR5ID0gX3RoaXMuX21ha2VDb2xvclByb3BlcnR5KF90aGlzLl9kZXNjcmlwdG9yLnByb3BlcnRpZXNbX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLkxBQkVMX0NPTE9SXSwgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLkxBQkVMX0NPTE9SKTsKICAgIF90aGlzLl9sYWJlbEJvcmRlckNvbG9yU3R5bGVQcm9wZXJ0eSA9IF90aGlzLl9tYWtlQ29sb3JQcm9wZXJ0eShfdGhpcy5fZGVzY3JpcHRvci5wcm9wZXJ0aWVzW192ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9CT1JERVJfQ09MT1JdLCBfdmVjdG9yX3N0eWxlX2RlZmF1bHRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfQk9SREVSX0NPTE9SKTsKICAgIF90aGlzLl9sYWJlbEJvcmRlclNpemVTdHlsZVByb3BlcnR5ID0gbmV3IF9sYWJlbF9ib3JkZXJfc2l6ZV9wcm9wZXJ0eS5MYWJlbEJvcmRlclNpemVQcm9wZXJ0eShfdGhpcy5fZGVzY3JpcHRvci5wcm9wZXJ0aWVzW192ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9CT1JERVJfU0laRV0ub3B0aW9ucywgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLkxBQkVMX0JPUkRFUl9TSVpFLCBfdGhpcy5fbGFiZWxTaXplU3R5bGVQcm9wZXJ0eSk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoVmVjdG9yU3R5bGUsIFt7CiAgICBrZXk6ICJfZ2V0QWxsU3R5bGVQcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0QWxsU3R5bGVQcm9wZXJ0aWVzKCkgewogICAgICByZXR1cm4gW3RoaXMuX2xpbmVDb2xvclN0eWxlUHJvcGVydHksIHRoaXMuX2ZpbGxDb2xvclN0eWxlUHJvcGVydHksIHRoaXMuX2xpbmVXaWR0aFN0eWxlUHJvcGVydHksIHRoaXMuX2ljb25TaXplU3R5bGVQcm9wZXJ0eSwgdGhpcy5faWNvbk9yaWVudGF0aW9uUHJvcGVydHksIHRoaXMuX2xhYmVsU3R5bGVQcm9wZXJ0eSwgdGhpcy5fbGFiZWxTaXplU3R5bGVQcm9wZXJ0eSwgdGhpcy5fbGFiZWxDb2xvclN0eWxlUHJvcGVydHksIHRoaXMuX2xhYmVsQm9yZGVyQ29sb3JTdHlsZVByb3BlcnR5LCB0aGlzLl9sYWJlbEJvcmRlclNpemVTdHlsZVByb3BlcnR5XTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJFZGl0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckVkaXRvcihfcmVmKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGxheWVyID0gX3JlZi5sYXllciwKICAgICAgICAgIG9uU3R5bGVEZXNjcmlwdG9yQ2hhbmdlID0gX3JlZi5vblN0eWxlRGVzY3JpcHRvckNoYW5nZTsKICAgICAgdmFyIHJhd1Byb3BlcnRpZXMgPSB0aGlzLmdldFJhd1Byb3BlcnRpZXMoKTsKCiAgICAgIHZhciBoYW5kbGVQcm9wZXJ0eUNoYW5nZSA9IGZ1bmN0aW9uIGhhbmRsZVByb3BlcnR5Q2hhbmdlKHByb3BlcnR5TmFtZSwgc2V0dGluZ3MpIHsKICAgICAgICByYXdQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0gPSBzZXR0aW5nczsgLy9vdmVycmlkZSBzaW5nbGUgcHJvcGVydHksIGJ1dCBwcmVzZXJ2ZSB0aGUgcmVzdAoKICAgICAgICB2YXIgdmVjdG9yU3R5bGVEZXNjcmlwdG9yID0gVmVjdG9yU3R5bGUuY3JlYXRlRGVzY3JpcHRvcihyYXdQcm9wZXJ0aWVzLCBfdGhpczIuaXNUaW1lQXdhcmUoKSk7CiAgICAgICAgb25TdHlsZURlc2NyaXB0b3JDaGFuZ2UodmVjdG9yU3R5bGVEZXNjcmlwdG9yKTsKICAgICAgfTsKCiAgICAgIHZhciBvbklzVGltZUF3YXJlQ2hhbmdlID0gZnVuY3Rpb24gb25Jc1RpbWVBd2FyZUNoYW5nZShpc1RpbWVBd2FyZSkgewogICAgICAgIHZhciB2ZWN0b3JTdHlsZURlc2NyaXB0b3IgPSBWZWN0b3JTdHlsZS5jcmVhdGVEZXNjcmlwdG9yKHJhd1Byb3BlcnRpZXMsIGlzVGltZUF3YXJlKTsKICAgICAgICBvblN0eWxlRGVzY3JpcHRvckNoYW5nZSh2ZWN0b3JTdHlsZURlc2NyaXB0b3IpOwogICAgICB9OwoKICAgICAgdmFyIHByb3BlcnRpZXNXaXRoRmllbGRNZXRhID0gdGhpcy5nZXREeW5hbWljUHJvcGVydGllc0FycmF5KCkuZmlsdGVyKGZ1bmN0aW9uIChkeW5hbWljU3R5bGVQcm9wKSB7CiAgICAgICAgcmV0dXJuIGR5bmFtaWNTdHlsZVByb3AuaXNGaWVsZE1ldGFFbmFibGVkKCk7CiAgICAgIH0pOwogICAgICB2YXIgc3R5bGVQcm9wZXJ0aWVzID0ge307CgogICAgICB0aGlzLl9nZXRBbGxTdHlsZVByb3BlcnRpZXMoKS5mb3JFYWNoKGZ1bmN0aW9uIChzdHlsZVByb3BlcnR5KSB7CiAgICAgICAgc3R5bGVQcm9wZXJ0aWVzW3N0eWxlUHJvcGVydHkuZ2V0U3R5bGVOYW1lKCldID0gc3R5bGVQcm9wZXJ0eTsKICAgICAgfSk7CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfdmVjdG9yX3N0eWxlX2VkaXRvci5WZWN0b3JTdHlsZUVkaXRvciwgewogICAgICAgIGhhbmRsZVByb3BlcnR5Q2hhbmdlOiBoYW5kbGVQcm9wZXJ0eUNoYW5nZSwKICAgICAgICBzdHlsZVByb3BlcnRpZXM6IHN0eWxlUHJvcGVydGllcywKICAgICAgICBzeW1ib2xEZXNjcmlwdG9yOiB0aGlzLl9kZXNjcmlwdG9yLnByb3BlcnRpZXNbX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLlNZTUJPTF0sCiAgICAgICAgbGF5ZXI6IGxheWVyLAogICAgICAgIGlzUG9pbnRzT25seTogdGhpcy5fZ2V0SXNQb2ludHNPbmx5KCksCiAgICAgICAgaXNMaW5lc09ubHk6IHRoaXMuX2dldElzTGluZXNPbmx5KCksCiAgICAgICAgb25Jc1RpbWVBd2FyZUNoYW5nZTogb25Jc1RpbWVBd2FyZUNoYW5nZSwKICAgICAgICBpc1RpbWVBd2FyZTogdGhpcy5pc1RpbWVBd2FyZSgpLAogICAgICAgIHNob3dJc1RpbWVBd2FyZTogcHJvcGVydGllc1dpdGhGaWVsZE1ldGEubGVuZ3RoID4gMAogICAgICB9KTsKICAgIH0KICAgIC8qCiAgICAgKiBDaGFuZ2VzIHRvIHNvdXJjZSBkZXNjcmlwdG9yIGFuZCBqb2luIGRlc2NyaXB0b3Igd2lsbCBpbXBhY3Qgc3R5bGUgcHJvcGVydGllcy4KICAgICAqIEZvciBpbnN0YW5jZSwgYSBzdHlsZSBwcm9wZXJ0eSBtYXkgYmUgZHluYW1pY2FsbHkgdGllZCB0byB0aGUgdmFsdWUgb2YgYW4gb3JkaW5hbCBmaWVsZCBkZWZpbmVkCiAgICAgKiBieSBhIGpvaW4gb3IgYSBtZXRyaWMgYWdncmVnYXRpb24uIFRoZSBtZXRyaWMgYWdncmVnYXRpb24gb3Igam9pbiBtYXkgYmUgZWRpdGVkIG9yIHJlbW92ZWQuCiAgICAgKiBXaGVuIHRoaXMgaGFwcGVucywgdGhlIHN0eWxlIHdpbGwgYmUgbGlua2VkIHRvIGEgbm8tbG9uZ2VyLWV4aXN0aW5nIG9yZGluYWwgZmllbGQuCiAgICAgKiBUaGlzIG1ldGhvZCBwcm92aWRlcyBhIHdheSBmb3IgYSBzdHlsZSB0byBjbGVhbiBpdHNlbGYgYW5kIHJldHVybiBhIGRlc2NyaXB0b3IgdGhhdCB1bnNldHMgYW55IGR5bmFtaWMKICAgICAqIHByb3BlcnRpZXMgdGhhdCBhcmUgdGllZCB0byBtaXNzaW5nIG9yaWRpbmFsIGZpZWxkcwogICAgICoKICAgICAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IHVwZGF0ZSBpdHMgZGVzY3JpcHRvci4gSXQganVzdCByZXR1cm5zIGEgbmV3IGRlc2NyaXB0b3IgdGhhdCB0aGUgY2FsbGVyCiAgICAgKiBjYW4gdGhlbiB1c2UgdG8gdXBkYXRlIHN0b3JlIHN0YXRlIHZpYSBkaXNwYXRjaC4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREZXNjcmlwdG9yV2l0aE1pc3NpbmdTdHlsZVByb3BzUmVtb3ZlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVzY3JpcHRvcldpdGhNaXNzaW5nU3R5bGVQcm9wc1JlbW92ZWQobmV4dEZpZWxkcykgewogICAgICB2YXIgb3JpZ2luYWxQcm9wZXJ0aWVzID0gdGhpcy5nZXRSYXdQcm9wZXJ0aWVzKCk7CiAgICAgIHZhciB1cGRhdGVkUHJvcGVydGllcyA9IHt9OwogICAgICB2YXIgZHluYW1pY1Byb3BlcnRpZXMgPSBPYmplY3Qua2V5cyhvcmlnaW5hbFByb3BlcnRpZXMpLmZpbHRlcihmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgdmFyIF9yZWYyID0gb3JpZ2luYWxQcm9wZXJ0aWVzW2tleV0gfHwge30sCiAgICAgICAgICAgIHR5cGUgPSBfcmVmMi50eXBlLAogICAgICAgICAgICBvcHRpb25zID0gX3JlZjIub3B0aW9uczsKCiAgICAgICAgcmV0dXJuIHR5cGUgPT09IF9jb25zdGFudHMuU1RZTEVfVFlQRS5EWU5BTUlDICYmIG9wdGlvbnMuZmllbGQgJiYgb3B0aW9ucy5maWVsZC5uYW1lOwogICAgICB9KTsKICAgICAgZHluYW1pY1Byb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgdmFyIGR5bmFtaWNQcm9wZXJ0eSA9IG9yaWdpbmFsUHJvcGVydGllc1trZXldOwogICAgICAgIHZhciBmaWVsZE5hbWUgPSBkeW5hbWljUHJvcGVydHkgJiYgZHluYW1pY1Byb3BlcnR5Lm9wdGlvbnMuZmllbGQgJiYgZHluYW1pY1Byb3BlcnR5Lm9wdGlvbnMuZmllbGQubmFtZTsKCiAgICAgICAgaWYgKCFmaWVsZE5hbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBtYXRjaGluZ09yZGluYWxGaWVsZCA9IG5leHRGaWVsZHMuZmluZChmdW5jdGlvbiAob3JkaW5hbEZpZWxkKSB7CiAgICAgICAgICByZXR1cm4gZmllbGROYW1lID09PSBvcmRpbmFsRmllbGQuZ2V0TmFtZSgpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAobWF0Y2hpbmdPcmRpbmFsRmllbGQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZWRQcm9wZXJ0aWVzW2tleV0gPSB7CiAgICAgICAgICB0eXBlOiBfZHluYW1pY19zdHlsZV9wcm9wZXJ0eS5EeW5hbWljU3R5bGVQcm9wZXJ0eS50eXBlLAogICAgICAgICAgb3B0aW9uczogX29iamVjdFNwcmVhZCh7fSwgb3JpZ2luYWxQcm9wZXJ0aWVzW2tleV0ub3B0aW9ucykKICAgICAgICB9OwogICAgICAgIGRlbGV0ZSB1cGRhdGVkUHJvcGVydGllc1trZXldLm9wdGlvbnMuZmllbGQ7CiAgICAgIH0pOwoKICAgICAgaWYgKE9iamVjdC5rZXlzKHVwZGF0ZWRQcm9wZXJ0aWVzKS5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaGFzQ2hhbmdlczogZmFsc2UsCiAgICAgICAgICBuZXh0U3R5bGVEZXNjcmlwdG9yOiBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLl9kZXNjcmlwdG9yKQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgaGFzQ2hhbmdlczogdHJ1ZSwKICAgICAgICBuZXh0U3R5bGVEZXNjcmlwdG9yOiBWZWN0b3JTdHlsZS5jcmVhdGVEZXNjcmlwdG9yKF9vYmplY3RTcHJlYWQoe30sIG9yaWdpbmFsUHJvcGVydGllcywge30sIHVwZGF0ZWRQcm9wZXJ0aWVzKSwgdGhpcy5pc1RpbWVBd2FyZSgpKQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogInBsdWNrU3R5bGVNZXRhRnJvbVNvdXJjZURhdGFSZXF1ZXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwbHVja1N0eWxlTWV0YUZyb21Tb3VyY2VEYXRhUmVxdWVzdChzb3VyY2VEYXRhUmVxdWVzdCkgewogICAgICB2YXIgX2hhc0ZlYXR1cmVUeXBlOwoKICAgICAgdmFyIGZlYXR1cmVzLCBzdXBwb3J0ZWRGZWF0dXJlcywgaGFzRmVhdHVyZVR5cGUsIGksIGZlYXR1cmUsIGZlYXR1cmVzTWV0YSwgZHluYW1pY1Byb3BlcnRpZXM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gcGx1Y2tTdHlsZU1ldGFGcm9tU291cmNlRGF0YVJlcXVlc3QkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZlYXR1cmVzID0gX2xvZGFzaC5kZWZhdWx0LmdldChzb3VyY2VEYXRhUmVxdWVzdC5nZXREYXRhKCksICdmZWF0dXJlcycsIFtdKTsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3NvdXJjZS5nZXRTdXBwb3J0ZWRTaGFwZVR5cGVzKCkpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHN1cHBvcnRlZEZlYXR1cmVzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICBoYXNGZWF0dXJlVHlwZSA9IChfaGFzRmVhdHVyZVR5cGUgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9oYXNGZWF0dXJlVHlwZSwgX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5QT0lOVCwgZmFsc2UpLCBfZGVmaW5lUHJvcGVydHkoX2hhc0ZlYXR1cmVUeXBlLCBfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLkxJTkUsIGZhbHNlKSwgX2RlZmluZVByb3BlcnR5KF9oYXNGZWF0dXJlVHlwZSwgX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5QT0xZR09OLCBmYWxzZSksIF9oYXNGZWF0dXJlVHlwZSk7CgogICAgICAgICAgICAgIGlmIChzdXBwb3J0ZWRGZWF0dXJlcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmVhdHVyZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgZmVhdHVyZSA9IGZlYXR1cmVzW2ldOwoKICAgICAgICAgICAgICAgICAgaWYgKCFoYXNGZWF0dXJlVHlwZVtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPSU5UXSAmJiBQT0lOVFMuaW5jbHVkZXMoZmVhdHVyZS5nZW9tZXRyeS50eXBlKSkgewogICAgICAgICAgICAgICAgICAgIGhhc0ZlYXR1cmVUeXBlW192ZWN0b3JfZmVhdHVyZV90eXBlcy5WRUNUT1JfU0hBUEVfVFlQRVMuUE9JTlRdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKCFoYXNGZWF0dXJlVHlwZVtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLkxJTkVdICYmIExJTkVTLmluY2x1ZGVzKGZlYXR1cmUuZ2VvbWV0cnkudHlwZSkpIHsKICAgICAgICAgICAgICAgICAgICBoYXNGZWF0dXJlVHlwZVtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLkxJTkVdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKCFoYXNGZWF0dXJlVHlwZVtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPTFlHT05dICYmIFBPTFlHT05TLmluY2x1ZGVzKGZlYXR1cmUuZ2VvbWV0cnkudHlwZSkpIHsKICAgICAgICAgICAgICAgICAgICBoYXNGZWF0dXJlVHlwZVtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPTFlHT05dID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZmVhdHVyZXNNZXRhID0gewogICAgICAgICAgICAgICAgZ2VvbWV0cnlUeXBlczogewogICAgICAgICAgICAgICAgICBpc1BvaW50c09ubHk6ICgwLCBfc3R5bGVfdXRpbC5pc09ubHlTaW5nbGVGZWF0dXJlVHlwZSkoX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5QT0lOVCwgc3VwcG9ydGVkRmVhdHVyZXMsIGhhc0ZlYXR1cmVUeXBlKSwKICAgICAgICAgICAgICAgICAgaXNMaW5lc09ubHk6ICgwLCBfc3R5bGVfdXRpbC5pc09ubHlTaW5nbGVGZWF0dXJlVHlwZSkoX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5MSU5FLCBzdXBwb3J0ZWRGZWF0dXJlcywgaGFzRmVhdHVyZVR5cGUpLAogICAgICAgICAgICAgICAgICBpc1BvbHlnb25zT25seTogKDAsIF9zdHlsZV91dGlsLmlzT25seVNpbmdsZUZlYXR1cmVUeXBlKShfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPTFlHT04sIHN1cHBvcnRlZEZlYXR1cmVzLCBoYXNGZWF0dXJlVHlwZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGR5bmFtaWNQcm9wZXJ0aWVzID0gdGhpcy5nZXREeW5hbWljUHJvcGVydGllc0FycmF5KCk7CgogICAgICAgICAgICAgIGlmICghKGR5bmFtaWNQcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMCB8fCBmZWF0dXJlcy5sZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGZlYXR1cmVzTWV0YSk7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGR5bmFtaWNQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKGR5bmFtaWNQcm9wZXJ0eSkgewogICAgICAgICAgICAgICAgdmFyIHN0eWxlTWV0YSA9IGR5bmFtaWNQcm9wZXJ0eS5wbHVja1N0eWxlTWV0YUZyb21GZWF0dXJlcyhmZWF0dXJlcyk7CgogICAgICAgICAgICAgICAgaWYgKHN0eWxlTWV0YSkgewogICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGR5bmFtaWNQcm9wZXJ0eS5nZXRGaWVsZCgpLmdldE5hbWUoKTsKICAgICAgICAgICAgICAgICAgZmVhdHVyZXNNZXRhW25hbWVdID0gc3R5bGVNZXRhOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGZlYXR1cmVzTWV0YSk7CgogICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTb3VyY2VGaWVsZE5hbWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTb3VyY2VGaWVsZE5hbWVzKCkgewogICAgICB2YXIgZmllbGROYW1lcyA9IFtdOwogICAgICB0aGlzLmdldER5bmFtaWNQcm9wZXJ0aWVzQXJyYXkoKS5mb3JFYWNoKGZ1bmN0aW9uIChzdHlsZVByb3BlcnR5KSB7CiAgICAgICAgaWYgKHN0eWxlUHJvcGVydHkuZ2V0RmllbGRPcmlnaW4oKSA9PT0gX2NvbnN0YW50cy5GSUVMRF9PUklHSU4uU09VUkNFKSB7CiAgICAgICAgICBmaWVsZE5hbWVzLnB1c2goc3R5bGVQcm9wZXJ0eS5nZXRGaWVsZCgpLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGZpZWxkTmFtZXM7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNUaW1lQXdhcmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVGltZUF3YXJlKCkgewogICAgICByZXR1cm4gdGhpcy5fZGVzY3JpcHRvci5pc1RpbWVBd2FyZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRSYXdQcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSYXdQcm9wZXJ0aWVzKCkgewogICAgICByZXR1cm4gdGhpcy5fZGVzY3JpcHRvci5wcm9wZXJ0aWVzIHx8IHt9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldER5bmFtaWNQcm9wZXJ0aWVzQXJyYXkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldER5bmFtaWNQcm9wZXJ0aWVzQXJyYXkoKSB7CiAgICAgIHZhciBzdHlsZVByb3BlcnRpZXMgPSB0aGlzLl9nZXRBbGxTdHlsZVByb3BlcnRpZXMoKTsKCiAgICAgIHJldHVybiBzdHlsZVByb3BlcnRpZXMuZmlsdGVyKGZ1bmN0aW9uIChzdHlsZVByb3BlcnR5KSB7CiAgICAgICAgcmV0dXJuIHN0eWxlUHJvcGVydHkuaXNEeW5hbWljKCkgJiYgc3R5bGVQcm9wZXJ0eS5pc0NvbXBsZXRlKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXREeW5hbWljUHJvcGVydHlCeUZpZWxkTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldER5bmFtaWNQcm9wZXJ0eUJ5RmllbGROYW1lKGZpZWxkTmFtZSkgewogICAgICB2YXIgZHluYW1pY1Byb3BzID0gdGhpcy5nZXREeW5hbWljUHJvcGVydGllc0FycmF5KCk7CiAgICAgIHJldHVybiBkeW5hbWljUHJvcHMuZmluZChmdW5jdGlvbiAoZHluYW1pY1Byb3ApIHsKICAgICAgICByZXR1cm4gZmllbGROYW1lID09PSBkeW5hbWljUHJvcC5nZXRGaWVsZCgpLmdldE5hbWUoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2dldFN5bWJvbElkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0U3ltYm9sSWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmFyZVBvaW50c1N5bWJvbGl6ZWRBc0NpcmNsZXMoKSA/IHVuZGVmaW5lZCA6IHRoaXMuX2Rlc2NyaXB0b3IucHJvcGVydGllcy5zeW1ib2wub3B0aW9ucy5zeW1ib2xJZDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYXNMZWdlbmREZXRhaWxzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNMZWdlbmREZXRhaWxzKCkgewogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGhhc0xlZ2VuZERldGFpbHMkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB0aGlzLl9nZXRMZWdlbmREZXRhaWxTdHlsZVByb3BlcnRpZXMoKS5sZW5ndGggPiAwKTsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckxlZ2VuZERldGFpbHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckxlZ2VuZERldGFpbHMoKSB7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF92ZWN0b3Jfc3R5bGVfbGVnZW5kLlZlY3RvclN0eWxlTGVnZW5kLCB7CiAgICAgICAgc3R5bGVzOiB0aGlzLl9nZXRMZWdlbmREZXRhaWxTdHlsZVByb3BlcnRpZXMoKSwKICAgICAgICBpc1BvaW50c09ubHk6IHRoaXMuX2dldElzUG9pbnRzT25seSgpLAogICAgICAgIGlzTGluZXNPbmx5OiB0aGlzLl9nZXRJc0xpbmVzT25seSgpLAogICAgICAgIHN5bWJvbElkOiB0aGlzLl9nZXRTeW1ib2xJZCgpCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNsZWFyRmVhdHVyZVN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhckZlYXR1cmVTdGF0ZShmZWF0dXJlQ29sbGVjdGlvbiwgbWJNYXAsIHNvdXJjZUlkKSB7CiAgICAgIHZhciB0bXBGZWF0dXJlSWRlbnRpZmllciA9IHsKICAgICAgICBzb3VyY2U6IG51bGwsCiAgICAgICAgaWQ6IG51bGwKICAgICAgfTsKCiAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBmZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcy5sZW5ndGg7IF9pKyspIHsKICAgICAgICB2YXIgX2ZlYXR1cmUgPSBmZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlc1tfaV07CiAgICAgICAgdG1wRmVhdHVyZUlkZW50aWZpZXIuc291cmNlID0gc291cmNlSWQ7CiAgICAgICAgdG1wRmVhdHVyZUlkZW50aWZpZXIuaWQgPSBfZmVhdHVyZS5pZDsKICAgICAgICBtYk1hcC5yZW1vdmVGZWF0dXJlU3RhdGUodG1wRmVhdHVyZUlkZW50aWZpZXIpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0RmVhdHVyZVN0YXRlQW5kU3R5bGVQcm9wcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RmVhdHVyZVN0YXRlQW5kU3R5bGVQcm9wcyhmZWF0dXJlQ29sbGVjdGlvbiwgbWJNYXAsIG1iU291cmNlSWQpIHsKICAgICAgaWYgKCFmZWF0dXJlQ29sbGVjdGlvbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGR5bmFtaWNTdHlsZVByb3BzID0gdGhpcy5nZXREeW5hbWljUHJvcGVydGllc0FycmF5KCk7CgogICAgICBpZiAoZHluYW1pY1N0eWxlUHJvcHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdG1wRmVhdHVyZUlkZW50aWZpZXIgPSB7CiAgICAgICAgc291cmNlOiBudWxsLAogICAgICAgIGlkOiBudWxsCiAgICAgIH07CiAgICAgIHZhciB0bXBGZWF0dXJlU3RhdGUgPSB7fTsKCiAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IGZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVzLmxlbmd0aDsgX2kyKyspIHsKICAgICAgICB2YXIgX2ZlYXR1cmUyID0gZmVhdHVyZUNvbGxlY3Rpb24uZmVhdHVyZXNbX2kyXTsKCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkeW5hbWljU3R5bGVQcm9wcy5sZW5ndGg7IGorKykgewogICAgICAgICAgdmFyIGR5bmFtaWNTdHlsZVByb3AgPSBkeW5hbWljU3R5bGVQcm9wc1tqXTsKICAgICAgICAgIHZhciBuYW1lID0gZHluYW1pY1N0eWxlUHJvcC5nZXRGaWVsZCgpLmdldE5hbWUoKTsKICAgICAgICAgIHZhciBjb21wdXRlZE5hbWUgPSAoMCwgX3N0eWxlX3V0aWwuZ2V0Q29tcHV0ZWRGaWVsZE5hbWUpKGR5bmFtaWNTdHlsZVByb3AuZ2V0U3R5bGVOYW1lKCksIG5hbWUpOwogICAgICAgICAgdmFyIHN0eWxlVmFsdWUgPSBkeW5hbWljU3R5bGVQcm9wLmdldE1iVmFsdWUoX2ZlYXR1cmUyLnByb3BlcnRpZXNbbmFtZV0pOwoKICAgICAgICAgIGlmIChkeW5hbWljU3R5bGVQcm9wLnN1cHBvcnRzRmVhdHVyZVN0YXRlKCkpIHsKICAgICAgICAgICAgdG1wRmVhdHVyZVN0YXRlW2NvbXB1dGVkTmFtZV0gPSBzdHlsZVZhbHVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2ZlYXR1cmUyLnByb3BlcnRpZXNbY29tcHV0ZWROYW1lXSA9IHN0eWxlVmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0bXBGZWF0dXJlSWRlbnRpZmllci5zb3VyY2UgPSBtYlNvdXJjZUlkOwogICAgICAgIHRtcEZlYXR1cmVJZGVudGlmaWVyLmlkID0gX2ZlYXR1cmUyLmlkOwogICAgICAgIG1iTWFwLnNldEZlYXR1cmVTdGF0ZSh0bXBGZWF0dXJlSWRlbnRpZmllciwgdG1wRmVhdHVyZVN0YXRlKTsKICAgICAgfSAvL3JldHVybnMgYm9vbGVhbiBpbmRpY2F0aW5nIGlmIHN0eWxlcyBkbyBub3Qgc3VwcG9ydCBmZWF0dXJlLXN0YXRlIGFuZCBzb21lIHZhbHVlcyBhcmUgc3RvcmVkIGluIGdlb2pzb24gcHJvcGVydGllcwogICAgICAvL3RoaXMgcmV0dXJuLXZhbHVlIGlzIHVzZWQgaW4gYW4gb3B0aW1pemF0aW9uIGZvciBzdHlsZS11cGRhdGVzIHdpdGggbWFwYm94LWdsLgogICAgICAvL2B0cnVlYCBpbmRpY2F0ZXMgdGhlIGVudGlyZSBkYXRhIG5lZWRzIHRvIHJlc2V0IG9uIHRoZSBzb3VyY2UgKG90aGVyd2lzZSB0aGUgc3R5bGUtcnVsZXMgd2lsbCBub3QgYmUgcmVhcHBsaWVkKQogICAgICAvL2BmYWxzZWAgaW5kaWNhdGVzIHRoZSBkYXRhIGRvZXMgbm90IG5lZWQgdG8gYmUgcmVzZXQgb24gdGhlIHN0b3JlLCBiZWNhdXNlIHN0eWxlcyBhcmUgcmUtZXZhbHVhdGVkIGlmIHRoZXkgdXNlIGZlYXR1cmVTdGF0ZQoKCiAgICAgIHJldHVybiBkeW5hbWljU3R5bGVQcm9wcy5zb21lKGZ1bmN0aW9uIChkeW5hbWljU3R5bGVQcm9wKSB7CiAgICAgICAgcmV0dXJuICFkeW5hbWljU3R5bGVQcm9wLnN1cHBvcnRzRmVhdHVyZVN0YXRlKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImFyZVBvaW50c1N5bWJvbGl6ZWRBc0NpcmNsZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFyZVBvaW50c1N5bWJvbGl6ZWRBc0NpcmNsZXMoKSB7CiAgICAgIHJldHVybiB0aGlzLl9kZXNjcmlwdG9yLnByb3BlcnRpZXMuc3ltYm9sLm9wdGlvbnMuc3ltYm9saXplQXMgPT09IF92ZWN0b3JfY29uc3RhbnRzLlNZTUJPTElaRV9BU19DSVJDTEU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TUJQYWludFByb3BlcnRpZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldE1CUGFpbnRQcm9wZXJ0aWVzKF9yZWYzKSB7CiAgICAgIHZhciBhbHBoYSA9IF9yZWYzLmFscGhhLAogICAgICAgICAgbWJNYXAgPSBfcmVmMy5tYk1hcCwKICAgICAgICAgIGZpbGxMYXllcklkID0gX3JlZjMuZmlsbExheWVySWQsCiAgICAgICAgICBsaW5lTGF5ZXJJZCA9IF9yZWYzLmxpbmVMYXllcklkOwoKICAgICAgdGhpcy5fZmlsbENvbG9yU3R5bGVQcm9wZXJ0eS5zeW5jRmlsbENvbG9yV2l0aE1iKGZpbGxMYXllcklkLCBtYk1hcCwgYWxwaGEpOwoKICAgICAgdGhpcy5fbGluZUNvbG9yU3R5bGVQcm9wZXJ0eS5zeW5jTGluZUNvbG9yV2l0aE1iKGxpbmVMYXllcklkLCBtYk1hcCwgYWxwaGEpOwoKICAgICAgdGhpcy5fbGluZVdpZHRoU3R5bGVQcm9wZXJ0eS5zeW5jTGluZVdpZHRoV2l0aE1iKGxpbmVMYXllcklkLCBtYk1hcCk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TUJQYWludFByb3BlcnRpZXNGb3JQb2ludHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldE1CUGFpbnRQcm9wZXJ0aWVzRm9yUG9pbnRzKF9yZWY0KSB7CiAgICAgIHZhciBhbHBoYSA9IF9yZWY0LmFscGhhLAogICAgICAgICAgbWJNYXAgPSBfcmVmNC5tYk1hcCwKICAgICAgICAgIHBvaW50TGF5ZXJJZCA9IF9yZWY0LnBvaW50TGF5ZXJJZDsKCiAgICAgIHRoaXMuX2ZpbGxDb2xvclN0eWxlUHJvcGVydHkuc3luY0NpcmNsZUNvbG9yV2l0aE1iKHBvaW50TGF5ZXJJZCwgbWJNYXAsIGFscGhhKTsKCiAgICAgIHRoaXMuX2xpbmVDb2xvclN0eWxlUHJvcGVydHkuc3luY0NpcmNsZVN0cm9rZVdpdGhNYihwb2ludExheWVySWQsIG1iTWFwLCBhbHBoYSk7CgogICAgICB0aGlzLl9saW5lV2lkdGhTdHlsZVByb3BlcnR5LnN5bmNDaXJjbGVTdHJva2VXaWR0aFdpdGhNYihwb2ludExheWVySWQsIG1iTWFwKTsKCiAgICAgIHRoaXMuX2ljb25TaXplU3R5bGVQcm9wZXJ0eS5zeW5jQ2lyY2xlUmFkaXVzV2l0aE1iKHBvaW50TGF5ZXJJZCwgbWJNYXApOwogICAgfQogIH0sIHsKICAgIGtleTogInNldE1CUHJvcGVydGllc0ZvckxhYmVsVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TUJQcm9wZXJ0aWVzRm9yTGFiZWxUZXh0KF9yZWY1KSB7CiAgICAgIHZhciBhbHBoYSA9IF9yZWY1LmFscGhhLAogICAgICAgICAgbWJNYXAgPSBfcmVmNS5tYk1hcCwKICAgICAgICAgIHRleHRMYXllcklkID0gX3JlZjUudGV4dExheWVySWQ7CiAgICAgIG1iTWFwLnNldExheW91dFByb3BlcnR5KHRleHRMYXllcklkLCAnaWNvbi1hbGxvdy1vdmVybGFwJywgdHJ1ZSk7CiAgICAgIG1iTWFwLnNldExheW91dFByb3BlcnR5KHRleHRMYXllcklkLCAndGV4dC1hbGxvdy1vdmVybGFwJywgdHJ1ZSk7CgogICAgICB0aGlzLl9sYWJlbFN0eWxlUHJvcGVydHkuc3luY1RleHRGaWVsZFdpdGhNYih0ZXh0TGF5ZXJJZCwgbWJNYXApOwoKICAgICAgdGhpcy5fbGFiZWxDb2xvclN0eWxlUHJvcGVydHkuc3luY0xhYmVsQ29sb3JXaXRoTWIodGV4dExheWVySWQsIG1iTWFwLCBhbHBoYSk7CgogICAgICB0aGlzLl9sYWJlbFNpemVTdHlsZVByb3BlcnR5LnN5bmNMYWJlbFNpemVXaXRoTWIodGV4dExheWVySWQsIG1iTWFwKTsKCiAgICAgIHRoaXMuX2xhYmVsQm9yZGVyU2l6ZVN0eWxlUHJvcGVydHkuc3luY0xhYmVsQm9yZGVyU2l6ZVdpdGhNYih0ZXh0TGF5ZXJJZCwgbWJNYXApOwoKICAgICAgdGhpcy5fbGFiZWxCb3JkZXJDb2xvclN0eWxlUHJvcGVydHkuc3luY0xhYmVsQm9yZGVyQ29sb3JXaXRoTWIodGV4dExheWVySWQsIG1iTWFwKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRNQlN5bWJvbFByb3BlcnRpZXNGb3JQb2ludHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldE1CU3ltYm9sUHJvcGVydGllc0ZvclBvaW50cyhfcmVmNikgewogICAgICB2YXIgbWJNYXAgPSBfcmVmNi5tYk1hcCwKICAgICAgICAgIHN5bWJvbExheWVySWQgPSBfcmVmNi5zeW1ib2xMYXllcklkLAogICAgICAgICAgYWxwaGEgPSBfcmVmNi5hbHBoYTsKICAgICAgdmFyIHN5bWJvbElkID0gdGhpcy5fZGVzY3JpcHRvci5wcm9wZXJ0aWVzLnN5bWJvbC5vcHRpb25zLnN5bWJvbElkOwogICAgICBtYk1hcC5zZXRMYXlvdXRQcm9wZXJ0eShzeW1ib2xMYXllcklkLCAnaWNvbi1pZ25vcmUtcGxhY2VtZW50JywgdHJ1ZSk7CiAgICAgIG1iTWFwLnNldExheW91dFByb3BlcnR5KHN5bWJvbExheWVySWQsICdpY29uLWFuY2hvcicsICgwLCBfc3ltYm9sX3V0aWxzLmdldE1ha2lTeW1ib2xBbmNob3IpKHN5bWJvbElkKSk7CiAgICAgIG1iTWFwLnNldFBhaW50UHJvcGVydHkoc3ltYm9sTGF5ZXJJZCwgJ2ljb24tb3BhY2l0eScsIGFscGhhKTsgLy8gaWNvbi1jb2xvciBpcyBvbmx5IHN1cHBvcnRlZCBvbiBTREYgaWNvbnMuCgogICAgICB0aGlzLl9maWxsQ29sb3JTdHlsZVByb3BlcnR5LnN5bmNJY29uQ29sb3JXaXRoTWIoc3ltYm9sTGF5ZXJJZCwgbWJNYXApOwoKICAgICAgdGhpcy5fbGluZUNvbG9yU3R5bGVQcm9wZXJ0eS5zeW5jSGFsb0JvcmRlckNvbG9yV2l0aE1iKHN5bWJvbExheWVySWQsIG1iTWFwKTsKCiAgICAgIHRoaXMuX2xpbmVXaWR0aFN0eWxlUHJvcGVydHkuc3luY0hhbG9XaWR0aFdpdGhNYihzeW1ib2xMYXllcklkLCBtYk1hcCk7CgogICAgICB0aGlzLl9pY29uU2l6ZVN0eWxlUHJvcGVydHkuc3luY0ljb25JbWFnZUFuZFNpemVXaXRoTWIoc3ltYm9sTGF5ZXJJZCwgbWJNYXAsIHN5bWJvbElkKTsKCiAgICAgIHRoaXMuX2ljb25PcmllbnRhdGlvblByb3BlcnR5LnN5bmNJY29uUm90YXRpb25XaXRoTWIoc3ltYm9sTGF5ZXJJZCwgbWJNYXApOwogICAgfQogIH0sIHsKICAgIGtleTogImFyZVBvaW50c1N5bWJvbGl6ZWRBc0NpcmNsZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFyZVBvaW50c1N5bWJvbGl6ZWRBc0NpcmNsZXMoKSB7CiAgICAgIHJldHVybiB0aGlzLl9kZXNjcmlwdG9yLnByb3BlcnRpZXMuc3ltYm9sLm9wdGlvbnMuc3ltYm9saXplQXMgPT09IF92ZWN0b3JfY29uc3RhbnRzLlNZTUJPTElaRV9BU19DSVJDTEU7CiAgICB9CiAgfSwgewogICAga2V5OiAiX21ha2VGaWVsZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX21ha2VGaWVsZChmaWVsZERlc2NyaXB0b3IpIHsKICAgICAgaWYgKCFmaWVsZERlc2NyaXB0b3IgfHwgIWZpZWxkRGVzY3JpcHRvci5uYW1lKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0gLy9maWVsZERlc2NyaXB0b3IubGFiZWwgaXMgaWdub3JlZC4gVGhpcyBpcyBlc3NlbnRpYWxseSBjcnVmdCBkdXBsaWNhdGluZyBsYWJlbC1pbmZvIGZyb20gdGhlIG1ldHJpYy1zZWxlY3Rpb24KICAgICAgLy9JZ25vcmUgdGhpcyBjdXN0b20gbGFiZWwKCgogICAgICBpZiAoZmllbGREZXNjcmlwdG9yLm9yaWdpbiA9PT0gX2NvbnN0YW50cy5GSUVMRF9PUklHSU4uU09VUkNFKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZS5nZXRGaWVsZEJ5TmFtZShmaWVsZERlc2NyaXB0b3IubmFtZSk7CiAgICAgIH0gZWxzZSBpZiAoZmllbGREZXNjcmlwdG9yLm9yaWdpbiA9PT0gX2NvbnN0YW50cy5GSUVMRF9PUklHSU4uSk9JTikgewogICAgICAgIHZhciBqb2luID0gdGhpcy5fbGF5ZXIuZ2V0VmFsaWRKb2lucygpLmZpbmQoZnVuY3Rpb24gKGpvaW4pIHsKICAgICAgICAgIHJldHVybiBqb2luLmdldFJpZ2h0Sm9pblNvdXJjZSgpLmhhc01hdGNoaW5nTWV0cmljRmllbGQoZmllbGREZXNjcmlwdG9yLm5hbWUpOwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gam9pbiA/IGpvaW4uZ2V0UmlnaHRKb2luU291cmNlKCkuZ2V0TWV0cmljRmllbGRGb3JOYW1lKGZpZWxkRGVzY3JpcHRvci5uYW1lKSA6IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIG9yaWdpbi10eXBlICIuY29uY2F0KGZpZWxkRGVzY3JpcHRvci5vcmlnaW4pKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9tYWtlU2l6ZVByb3BlcnR5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfbWFrZVNpemVQcm9wZXJ0eShkZXNjcmlwdG9yLCBzdHlsZU5hbWUsIGlzU3ltYm9saXplZEFzSWNvbikgewogICAgICBpZiAoIWRlc2NyaXB0b3IgfHwgIWRlc2NyaXB0b3Iub3B0aW9ucykgewogICAgICAgIHJldHVybiBuZXcgX3N0YXRpY19zaXplX3Byb3BlcnR5LlN0YXRpY1NpemVQcm9wZXJ0eSh7CiAgICAgICAgICBzaXplOiAwCiAgICAgICAgfSwgc3R5bGVOYW1lKTsKICAgICAgfSBlbHNlIGlmIChkZXNjcmlwdG9yLnR5cGUgPT09IF9zdGF0aWNfc3R5bGVfcHJvcGVydHkuU3RhdGljU3R5bGVQcm9wZXJ0eS50eXBlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBfc3RhdGljX3NpemVfcHJvcGVydHkuU3RhdGljU2l6ZVByb3BlcnR5KGRlc2NyaXB0b3Iub3B0aW9ucywgc3R5bGVOYW1lKTsKICAgICAgfSBlbHNlIGlmIChkZXNjcmlwdG9yLnR5cGUgPT09IF9keW5hbWljX3N0eWxlX3Byb3BlcnR5LkR5bmFtaWNTdHlsZVByb3BlcnR5LnR5cGUpIHsKICAgICAgICB2YXIgZmllbGQgPSB0aGlzLl9tYWtlRmllbGQoZGVzY3JpcHRvci5vcHRpb25zLmZpZWxkKTsKCiAgICAgICAgcmV0dXJuIG5ldyBfZHluYW1pY19zaXplX3Byb3BlcnR5LkR5bmFtaWNTaXplUHJvcGVydHkoZGVzY3JpcHRvci5vcHRpb25zLCBzdHlsZU5hbWUsIGZpZWxkLCB0aGlzLl9nZXRGaWVsZE1ldGEsIHRoaXMuX2dldEZpZWxkRm9ybWF0dGVyLCBpc1N5bWJvbGl6ZWRBc0ljb24pOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiIi5jb25jYXQoZGVzY3JpcHRvciwgIiBub3QgaW1wbGVtZW50ZWQiKSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfbWFrZUNvbG9yUHJvcGVydHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlQ29sb3JQcm9wZXJ0eShkZXNjcmlwdG9yLCBzdHlsZU5hbWUpIHsKICAgICAgaWYgKCFkZXNjcmlwdG9yIHx8ICFkZXNjcmlwdG9yLm9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gbmV3IF9zdGF0aWNfY29sb3JfcHJvcGVydHkuU3RhdGljQ29sb3JQcm9wZXJ0eSh7CiAgICAgICAgICBjb2xvcjogbnVsbAogICAgICAgIH0sIHN0eWxlTmFtZSk7CiAgICAgIH0gZWxzZSBpZiAoZGVzY3JpcHRvci50eXBlID09PSBfc3RhdGljX3N0eWxlX3Byb3BlcnR5LlN0YXRpY1N0eWxlUHJvcGVydHkudHlwZSkgewogICAgICAgIHJldHVybiBuZXcgX3N0YXRpY19jb2xvcl9wcm9wZXJ0eS5TdGF0aWNDb2xvclByb3BlcnR5KGRlc2NyaXB0b3Iub3B0aW9ucywgc3R5bGVOYW1lKTsKICAgICAgfSBlbHNlIGlmIChkZXNjcmlwdG9yLnR5cGUgPT09IF9keW5hbWljX3N0eWxlX3Byb3BlcnR5LkR5bmFtaWNTdHlsZVByb3BlcnR5LnR5cGUpIHsKICAgICAgICB2YXIgZmllbGQgPSB0aGlzLl9tYWtlRmllbGQoZGVzY3JpcHRvci5vcHRpb25zLmZpZWxkKTsKCiAgICAgICAgcmV0dXJuIG5ldyBfZHluYW1pY19jb2xvcl9wcm9wZXJ0eS5EeW5hbWljQ29sb3JQcm9wZXJ0eShkZXNjcmlwdG9yLm9wdGlvbnMsIHN0eWxlTmFtZSwgZmllbGQsIHRoaXMuX2dldEZpZWxkTWV0YSwgdGhpcy5fZ2V0RmllbGRGb3JtYXR0ZXIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiIi5jb25jYXQoZGVzY3JpcHRvciwgIiBub3QgaW1wbGVtZW50ZWQiKSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfbWFrZU9yaWVudGF0aW9uUHJvcGVydHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlT3JpZW50YXRpb25Qcm9wZXJ0eShkZXNjcmlwdG9yLCBzdHlsZU5hbWUpIHsKICAgICAgaWYgKCFkZXNjcmlwdG9yIHx8ICFkZXNjcmlwdG9yLm9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gbmV3IF9zdGF0aWNfb3JpZW50YXRpb25fcHJvcGVydHkuU3RhdGljT3JpZW50YXRpb25Qcm9wZXJ0eSh7CiAgICAgICAgICBvcmllbnRhdGlvbjogMAogICAgICAgIH0sIHN0eWxlTmFtZSk7CiAgICAgIH0gZWxzZSBpZiAoZGVzY3JpcHRvci50eXBlID09PSBfc3RhdGljX3N0eWxlX3Byb3BlcnR5LlN0YXRpY1N0eWxlUHJvcGVydHkudHlwZSkgewogICAgICAgIHJldHVybiBuZXcgX3N0YXRpY19vcmllbnRhdGlvbl9wcm9wZXJ0eS5TdGF0aWNPcmllbnRhdGlvblByb3BlcnR5KGRlc2NyaXB0b3Iub3B0aW9ucywgc3R5bGVOYW1lKTsKICAgICAgfSBlbHNlIGlmIChkZXNjcmlwdG9yLnR5cGUgPT09IF9keW5hbWljX3N0eWxlX3Byb3BlcnR5LkR5bmFtaWNTdHlsZVByb3BlcnR5LnR5cGUpIHsKICAgICAgICB2YXIgZmllbGQgPSB0aGlzLl9tYWtlRmllbGQoZGVzY3JpcHRvci5vcHRpb25zLmZpZWxkKTsKCiAgICAgICAgcmV0dXJuIG5ldyBfZHluYW1pY19vcmllbnRhdGlvbl9wcm9wZXJ0eS5EeW5hbWljT3JpZW50YXRpb25Qcm9wZXJ0eShkZXNjcmlwdG9yLm9wdGlvbnMsIHN0eWxlTmFtZSwgZmllbGQpOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiIi5jb25jYXQoZGVzY3JpcHRvciwgIiBub3QgaW1wbGVtZW50ZWQiKSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfbWFrZUxhYmVsUHJvcGVydHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlTGFiZWxQcm9wZXJ0eShkZXNjcmlwdG9yKSB7CiAgICAgIGlmICghZGVzY3JpcHRvciB8fCAhZGVzY3JpcHRvci5vcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIG5ldyBfc3RhdGljX3RleHRfcHJvcGVydHkuU3RhdGljVGV4dFByb3BlcnR5KHsKICAgICAgICAgIHZhbHVlOiAnJwogICAgICAgIH0sIF92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9URVhUKTsKICAgICAgfSBlbHNlIGlmIChkZXNjcmlwdG9yLnR5cGUgPT09IF9zdGF0aWNfc3R5bGVfcHJvcGVydHkuU3RhdGljU3R5bGVQcm9wZXJ0eS50eXBlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBfc3RhdGljX3RleHRfcHJvcGVydHkuU3RhdGljVGV4dFByb3BlcnR5KGRlc2NyaXB0b3Iub3B0aW9ucywgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5WRUNUT1JfU1RZTEVTLkxBQkVMX1RFWFQpOwogICAgICB9IGVsc2UgaWYgKGRlc2NyaXB0b3IudHlwZSA9PT0gX2R5bmFtaWNfc3R5bGVfcHJvcGVydHkuRHluYW1pY1N0eWxlUHJvcGVydHkudHlwZSkgewogICAgICAgIHZhciBmaWVsZCA9IHRoaXMuX21ha2VGaWVsZChkZXNjcmlwdG9yLm9wdGlvbnMuZmllbGQpOwoKICAgICAgICByZXR1cm4gbmV3IF9keW5hbWljX3RleHRfcHJvcGVydHkuRHluYW1pY1RleHRQcm9wZXJ0eShkZXNjcmlwdG9yLm9wdGlvbnMsIF92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9URVhULCBmaWVsZCwgdGhpcy5fZ2V0RmllbGRNZXRhLCB0aGlzLl9nZXRGaWVsZEZvcm1hdHRlcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiLmNvbmNhdChkZXNjcmlwdG9yLCAiIG5vdCBpbXBsZW1lbnRlZCIpKTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIFZlY3RvclN0eWxlOwp9KF9hYnN0cmFjdF9zdHlsZS5BYnN0cmFjdFN0eWxlKTsKCmV4cG9ydHMuVmVjdG9yU3R5bGUgPSBWZWN0b3JTdHlsZTsKCl9kZWZpbmVQcm9wZXJ0eShWZWN0b3JTdHlsZSwgInR5cGUiLCBfY29uc3RhbnRzLkxBWUVSX1NUWUxFX1RZUEUuVkVDVE9SKTsKCl9kZWZpbmVQcm9wZXJ0eShWZWN0b3JTdHlsZSwgIlNUWUxFX1RZUEUiLCBfY29uc3RhbnRzLlNUWUxFX1RZUEUpOw=="},null]}