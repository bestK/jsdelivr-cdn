{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/canvas/public/components/expression_input/expression_input.js","dependencies":[{"path":"x-pack/legacy/plugins/canvas/public/components/expression_input/expression_input.js","mtime":1585205043669},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuRXhwcmVzc2lvbklucHV0ID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX3Byb3BUeXBlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicHJvcC10eXBlcyIpKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIG1vbmFjb0VkaXRvciA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoIm1vbmFjby1lZGl0b3IvZXNtL3ZzL2VkaXRvci9lZGl0b3IuYXBpIikpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9raWJhbmFfcmVhY3QvcHVibGljIik7Cgp2YXIgX2F1dG9jb21wbGV0ZSA9IHJlcXVpcmUoIi4uLy4uLy4uL2NvbW1vbi9saWIvYXV0b2NvbXBsZXRlIik7Cgp2YXIgX21vbmFjb19sYW5ndWFnZV9kZWYgPSByZXF1aXJlKCIuLi8uLi9saWIvbW9uYWNvX2xhbmd1YWdlX2RlZiIpOwoKdmFyIF9yZWZlcmVuY2UgPSByZXF1aXJlKCIuL3JlZmVyZW5jZSIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgcmV0dXJuIGNhbGw7CiAgfQoKICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsKfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsKICB9OwogIHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBFeHByZXNzaW9uSW5wdXQgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKEV4cHJlc3Npb25JbnB1dCwgX1JlYWN0JENvbXBvbmVudCk7CgogIGZ1bmN0aW9uIEV4cHJlc3Npb25JbnB1dChwcm9wcykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFeHByZXNzaW9uSW5wdXQpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEV4cHJlc3Npb25JbnB1dCkuY2FsbCh0aGlzLCBwcm9wcykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImVkaXRvciIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidW5kb0hpc3RvcnkiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlZG9IaXN0b3J5Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGFzaCIsICgwLCBfbG9kYXNoLmRlYm91bmNlKShmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgX3RoaXMudW5kb0hpc3RvcnkucHVzaCh2YWx1ZSk7CgogICAgICBfdGhpcy5yZWRvSGlzdG9yeSA9IFtdOwogICAgfSwgNTAwLCB7CiAgICAgIGxlYWRpbmc6IHRydWUsCiAgICAgIHRyYWlsaW5nOiBmYWxzZQogICAgfSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uS2V5RG93biIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSB7CiAgICAgICAgaWYgKGUua2V5ID09PSAneicpIHsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICBpZiAoZS5zaGlmdEtleSkgewogICAgICAgICAgICBfdGhpcy5yZWRvKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpcy51bmRvKCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZS5rZXkgPT09ICd5JykgewogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgIF90aGlzLnJlZG8oKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ2hhbmdlIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIF90aGlzLnVwZGF0ZVN0YXRlKHsKICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ1cGRhdGVTdGF0ZSIsIGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgIHZhciB2YWx1ZSA9IF9yZWYudmFsdWU7CgogICAgICBfdGhpcy5zdGFzaChfdGhpcy5wcm9wcy52YWx1ZSk7CgogICAgICBfdGhpcy5wcm9wcy5vbkNoYW5nZSh2YWx1ZSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwcm92aWRlU3VnZ2VzdGlvbnMiLCBmdW5jdGlvbiAobW9kZWwsIHBvc2l0aW9uKSB7CiAgICAgIHZhciB0ZXh0ID0gbW9kZWwuZ2V0VmFsdWUoKTsKICAgICAgdmFyIHRleHRSYW5nZSA9IG1vZGVsLmdldEZ1bGxNb2RlbFJhbmdlKCk7CiAgICAgIHZhciBsZW5ndGhBZnRlclBvc2l0aW9uID0gbW9kZWwuZ2V0VmFsdWVMZW5ndGhJblJhbmdlKHsKICAgICAgICBzdGFydExpbmVOdW1iZXI6IHBvc2l0aW9uLmxpbmVOdW1iZXIsCiAgICAgICAgc3RhcnRDb2x1bW46IHBvc2l0aW9uLmNvbHVtbiwKICAgICAgICBlbmRMaW5lTnVtYmVyOiB0ZXh0UmFuZ2UuZW5kTGluZU51bWJlciwKICAgICAgICBlbmRDb2x1bW46IHRleHRSYW5nZS5lbmRDb2x1bW4KICAgICAgfSk7CiAgICAgIHZhciB3b3JkVW50aWwgPSBtb2RlbC5nZXRXb3JkVW50aWxQb3NpdGlvbihwb3NpdGlvbik7CiAgICAgIHZhciB3b3JkUmFuZ2UgPSBuZXcgbW9uYWNvRWRpdG9yLlJhbmdlKHBvc2l0aW9uLmxpbmVOdW1iZXIsIHdvcmRVbnRpbC5zdGFydENvbHVtbiwgcG9zaXRpb24ubGluZU51bWJlciwgd29yZFVudGlsLmVuZENvbHVtbik7CiAgICAgIHZhciBhU3VnZ2VzdGlvbnMgPSAoMCwgX2F1dG9jb21wbGV0ZS5nZXRBdXRvY29tcGxldGVTdWdnZXN0aW9ucykoX3RoaXMucHJvcHMuZnVuY3Rpb25EZWZpbml0aW9ucywgdGV4dCwgdGV4dC5sZW5ndGggLSBsZW5ndGhBZnRlclBvc2l0aW9uKTsKICAgICAgdmFyIHN1Z2dlc3Rpb25zID0gYVN1Z2dlc3Rpb25zLm1hcChmdW5jdGlvbiAocykgewogICAgICAgIGlmIChzLnR5cGUgPT09ICdhcmd1bWVudCcpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxhYmVsOiBzLmFyZ0RlZi5uYW1lLAogICAgICAgICAgICBraW5kOiBtb25hY29FZGl0b3IubGFuZ3VhZ2VzLkNvbXBsZXRpb25JdGVtS2luZC5GaWVsZCwKICAgICAgICAgICAgZG9jdW1lbnRhdGlvbjogewogICAgICAgICAgICAgIHZhbHVlOiAoMCwgX3JlZmVyZW5jZS5nZXRBcmdSZWZlcmVuY2VTdHIpKHMuYXJnRGVmKSwKICAgICAgICAgICAgICBpc1RydXN0ZWQ6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW5zZXJ0VGV4dDogcy50ZXh0LAogICAgICAgICAgICBjb21tYW5kOiB7CiAgICAgICAgICAgICAgdGl0bGU6ICdUcmlnZ2VyIFN1Z2dlc3Rpb24gRGlhbG9nJywKICAgICAgICAgICAgICBpZDogJ2VkaXRvci5hY3Rpb24udHJpZ2dlclN1Z2dlc3QnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJhbmdlOiB3b3JkUmFuZ2UKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmIChzLnR5cGUgPT09ICd2YWx1ZScpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxhYmVsOiBzLnRleHQsCiAgICAgICAgICAgIGtpbmQ6IG1vbmFjb0VkaXRvci5sYW5ndWFnZXMuQ29tcGxldGlvbkl0ZW1LaW5kLlZhbHVlLAogICAgICAgICAgICBpbnNlcnRUZXh0OiBzLnRleHQsCiAgICAgICAgICAgIGNvbW1hbmQ6IHsKICAgICAgICAgICAgICB0aXRsZTogJ1RyaWdnZXIgU3VnZ2VzdGlvbiBEaWFsb2cnLAogICAgICAgICAgICAgIGlkOiAnZWRpdG9yLmFjdGlvbi50cmlnZ2VyU3VnZ2VzdCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmFuZ2U6IHdvcmRSYW5nZQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGFiZWw6IHMuZm5EZWYubmFtZSwKICAgICAgICAgICAga2luZDogbW9uYWNvRWRpdG9yLmxhbmd1YWdlcy5Db21wbGV0aW9uSXRlbUtpbmQuRnVuY3Rpb24sCiAgICAgICAgICAgIGRvY3VtZW50YXRpb246IHsKICAgICAgICAgICAgICB2YWx1ZTogKDAsIF9yZWZlcmVuY2UuZ2V0RnVuY3Rpb25SZWZlcmVuY2VTdHIpKHMuZm5EZWYpLAogICAgICAgICAgICAgIGlzVHJ1c3RlZDogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBpbnNlcnRUZXh0OiBzLnRleHQsCiAgICAgICAgICAgIGNvbW1hbmQ6IHsKICAgICAgICAgICAgICB0aXRsZTogJ1RyaWdnZXIgU3VnZ2VzdGlvbiBEaWFsb2cnLAogICAgICAgICAgICAgIGlkOiAnZWRpdG9yLmFjdGlvbi50cmlnZ2VyU3VnZ2VzdCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmFuZ2U6IHdvcmRSYW5nZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gewogICAgICAgIHN1Z2dlc3Rpb25zOiBzdWdnZXN0aW9ucwogICAgICB9OwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicHJvdmlkZXJIb3ZlciIsIGZ1bmN0aW9uIChtb2RlbCwgcG9zaXRpb24pIHsKICAgICAgdmFyIHRleHQgPSBtb2RlbC5nZXRWYWx1ZSgpOwogICAgICB2YXIgd29yZCA9IG1vZGVsLmdldFdvcmRBdFBvc2l0aW9uKHBvc2l0aW9uKTsKCiAgICAgIGlmICghd29yZCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjb250ZW50czogW10KICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgYWJzUG9zaXRpb24gPSBtb2RlbC5nZXRWYWx1ZUxlbmd0aEluUmFuZ2UoewogICAgICAgIHN0YXJ0TGluZU51bWJlcjogMCwKICAgICAgICBzdGFydENvbHVtbjogMCwKICAgICAgICBlbmRMaW5lTnVtYmVyOiBwb3NpdGlvbi5saW5lTnVtYmVyLAogICAgICAgIGVuZENvbHVtbjogd29yZC5lbmRDb2x1bW4KICAgICAgfSk7CgogICAgICB2YXIgX2dldEZuQXJnRGVmQXRQb3NpdGlvID0gKDAsIF9hdXRvY29tcGxldGUuZ2V0Rm5BcmdEZWZBdFBvc2l0aW9uKShfdGhpcy5wcm9wcy5mdW5jdGlvbkRlZmluaXRpb25zLCB0ZXh0LCBhYnNQb3NpdGlvbiksCiAgICAgICAgICBmbkRlZiA9IF9nZXRGbkFyZ0RlZkF0UG9zaXRpby5mbkRlZiwKICAgICAgICAgIGFyZ0RlZiA9IF9nZXRGbkFyZ0RlZkF0UG9zaXRpby5hcmdEZWYsCiAgICAgICAgICBhcmdTdGFydCA9IF9nZXRGbkFyZ0RlZkF0UG9zaXRpby5hcmdTdGFydCwKICAgICAgICAgIGFyZ0VuZCA9IF9nZXRGbkFyZ0RlZkF0UG9zaXRpby5hcmdFbmQ7CgogICAgICBpZiAoYXJnRGVmICYmIGFyZ1N0YXJ0ICYmIGFyZ0VuZCkgewogICAgICAgIC8vIFVzZSB0aGUgc3RhcnQvZW5kIHBvc2l0aW9uIG9mIHRoZSBhcmcgdG8gZ2VuZXJhdGUgYSBjb21wbGV0ZSByYW5nZSB0byBoaWdobGlnaHQKICAgICAgICAvLyB0aGF0IGluY2x1ZGVzIHRoZSBhcmcgbmFtZSBhbmQgaXRzIGNvbXBsZXRlIHZhbHVlCiAgICAgICAgdmFyIHN0YXJ0UG9zID0gbW9kZWwuZ2V0UG9zaXRpb25BdChhcmdTdGFydCk7CiAgICAgICAgdmFyIGVuZFBvcyA9IG1vZGVsLmdldFBvc2l0aW9uQXQoYXJnRW5kKTsKICAgICAgICB2YXIgYXJnUmFuZ2UgPSBuZXcgbW9uYWNvRWRpdG9yLlJhbmdlKHN0YXJ0UG9zLmxpbmVOdW1iZXIsIHN0YXJ0UG9zLmNvbHVtbiwgZW5kUG9zLmxpbmVOdW1iZXIsIGVuZFBvcy5jb2x1bW4pOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjb250ZW50czogW3sKICAgICAgICAgICAgdmFsdWU6ICgwLCBfcmVmZXJlbmNlLmdldEFyZ1JlZmVyZW5jZVN0cikoYXJnRGVmKSwKICAgICAgICAgICAgaXNUcnVzdGVkOiB0cnVlCiAgICAgICAgICB9XSwKICAgICAgICAgIHJhbmdlOiBhcmdSYW5nZQogICAgICAgIH07CiAgICAgIH0gZWxzZSBpZiAoZm5EZWYpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgY29udGVudHM6IFt7CiAgICAgICAgICAgIHZhbHVlOiAoMCwgX3JlZmVyZW5jZS5nZXRGdW5jdGlvblJlZmVyZW5jZVN0cikoZm5EZWYpLAogICAgICAgICAgICBpc1RydXN0ZWQ6IHRydWUKICAgICAgICAgIH1dCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBjb250ZW50czogW10KICAgICAgfTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImVkaXRvckRpZE1vdW50IiwgZnVuY3Rpb24gKGVkaXRvciwgbW9uYWNvKSB7CiAgICAgIC8vIFVwZGF0aW5nIHRhYiBzaXplIGZvciB0aGUgZWRpdG9yCiAgICAgIHZhciBtb2RlbCA9IGVkaXRvci5nZXRNb2RlbCgpOwoKICAgICAgaWYgKG1vZGVsKSB7CiAgICAgICAgbW9kZWwudXBkYXRlT3B0aW9ucyh7CiAgICAgICAgICB0YWJTaXplOiAyCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIF90aGlzLmVkaXRvciA9IGVkaXRvcjsKICAgIH0pOwoKICAgIF90aGlzLnVuZG9IaXN0b3J5ID0gW107CiAgICBfdGhpcy5yZWRvSGlzdG9yeSA9IFtdOwogICAgX3RoaXMuZWRpdG9yID0gbnVsbDsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhFeHByZXNzaW9uSW5wdXQsIFt7CiAgICBrZXk6ICJ1bmRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1bmRvKCkgewogICAgICBpZiAoIXRoaXMudW5kb0hpc3RvcnkubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdmFsdWUgPSB0aGlzLnVuZG9IaXN0b3J5LnBvcCgpOwogICAgICB0aGlzLnJlZG9IaXN0b3J5LnB1c2godGhpcy5wcm9wcy52YWx1ZSk7CiAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UodmFsdWUpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZG8oKSB7CiAgICAgIGlmICghdGhpcy5yZWRvSGlzdG9yeS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB2YWx1ZSA9IHRoaXMucmVkb0hpc3RvcnkucG9wKCk7CiAgICAgIHRoaXMudW5kb0hpc3RvcnkucHVzaCh0aGlzLnByb3BzLnZhbHVlKTsKICAgICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh2YWx1ZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wcyA9IHRoaXMucHJvcHMsCiAgICAgICAgICB2YWx1ZSA9IF90aGlzJHByb3BzLnZhbHVlLAogICAgICAgICAgZXJyb3IgPSBfdGhpcyRwcm9wcy5lcnJvciwKICAgICAgICAgIGlzQ29tcGFjdCA9IF90aGlzJHByb3BzLmlzQ29tcGFjdDsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJjYW52YXNFeHByZXNzaW9uSW5wdXQiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgY2xhc3NOYW1lOiAiY2FudmFzRXhwcmVzc2lvbklucHV0X19pbm5lciIsCiAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgIGlzSW52YWxpZDogQm9vbGVhbihlcnJvciksCiAgICAgICAgZXJyb3I6IGVycm9yCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJjYW52YXNFeHByZXNzaW9uSW5wdXRfX2VkaXRvciIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcHVibGljLkNvZGVFZGl0b3IsIHsKICAgICAgICBsYW5ndWFnZUlkOiBfbW9uYWNvX2xhbmd1YWdlX2RlZi5MQU5HVUFHRV9JRCwKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgb25DaGFuZ2U6IHRoaXMub25DaGFuZ2UsCiAgICAgICAgc3VnZ2VzdGlvblByb3ZpZGVyOiB7CiAgICAgICAgICB0cmlnZ2VyQ2hhcmFjdGVyczogWycgJ10sCiAgICAgICAgICBwcm92aWRlQ29tcGxldGlvbkl0ZW1zOiB0aGlzLnByb3ZpZGVTdWdnZXN0aW9ucwogICAgICAgIH0sCiAgICAgICAgaG92ZXJQcm92aWRlcjogewogICAgICAgICAgcHJvdmlkZUhvdmVyOiB0aGlzLnByb3ZpZGVySG92ZXIKICAgICAgICB9LAogICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgIGZvbnRTaXplOiBpc0NvbXBhY3QgPyAxMiA6IDE2LAogICAgICAgICAgc2Nyb2xsQmV5b25kTGFzdExpbmU6IGZhbHNlLAogICAgICAgICAgcXVpY2tTdWdnZXN0aW9uczogdHJ1ZSwKICAgICAgICAgIG1pbmltYXA6IHsKICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UKICAgICAgICAgIH0sCiAgICAgICAgICB3b3JkQmFzZWRTdWdnZXN0aW9uczogZmFsc2UsCiAgICAgICAgICB3b3JkV3JhcDogJ29uJywKICAgICAgICAgIHdyYXBwaW5nSW5kZW50OiAnaW5kZW50JwogICAgICAgIH0sCiAgICAgICAgZWRpdG9yRGlkTW91bnQ6IHRoaXMuZWRpdG9yRGlkTW91bnQKICAgICAgfSkpKSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRXhwcmVzc2lvbklucHV0Owp9KF9yZWFjdC5kZWZhdWx0LkNvbXBvbmVudCk7CgpleHBvcnRzLkV4cHJlc3Npb25JbnB1dCA9IEV4cHJlc3Npb25JbnB1dDsKCl9kZWZpbmVQcm9wZXJ0eShFeHByZXNzaW9uSW5wdXQsICJwcm9wVHlwZXMiLCB7CiAgZnVuY3Rpb25EZWZpbml0aW9uczogX3Byb3BUeXBlcy5kZWZhdWx0LmFycmF5LmlzUmVxdWlyZWQsCiAgdmFsdWU6IF9wcm9wVHlwZXMuZGVmYXVsdC5zdHJpbmcuaXNSZXF1aXJlZCwKICBlcnJvcjogX3Byb3BUeXBlcy5kZWZhdWx0LnN0cmluZywKICBvbkNoYW5nZTogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZAp9KTs="},null]}