{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/security/public/views/management/role_mappings/edit_role_mapping/components/rule_editor_panel/rule_editor_panel.js","dependencies":[{"path":"x-pack/legacy/plugins/security/public/views/management/role_mappings/edit_role_mapping/components/rule_editor_panel/rule_editor_panel.js","mtime":1585205047244},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuUnVsZUVkaXRvclBhbmVsID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfdmlzdWFsX3J1bGVfZWRpdG9yID0gcmVxdWlyZSgiLi92aXN1YWxfcnVsZV9lZGl0b3IiKTsKCnZhciBfanNvbl9ydWxlX2VkaXRvciA9IHJlcXVpcmUoIi4vanNvbl9ydWxlX2VkaXRvciIpOwoKdmFyIF9yb2xlX21hcHBpbmdfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vc2VydmljZXMvcm9sZV9tYXBwaW5nX2NvbnN0YW50cyIpOwoKdmFyIF9tb2RlbCA9IHJlcXVpcmUoIi4uLy4uLy4uL21vZGVsIik7Cgp2YXIgX3JvbGVfbWFwcGluZ192YWxpZGF0aW9uID0gcmVxdWlyZSgiLi4vLi4vc2VydmljZXMvcm9sZV9tYXBwaW5nX3ZhbGlkYXRpb24iKTsKCnZhciBfZG9jdW1lbnRhdGlvbl9saW5rcyA9IHJlcXVpcmUoIi4uLy4uLy4uL3NlcnZpY2VzL2RvY3VtZW50YXRpb25fbGlua3MiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgfTsKICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwp9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsKICBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7CiAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwogIH0KCiAgcmV0dXJuIHNlbGY7Cn0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgewogIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOwogIH0KCiAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICBjb25zdHJ1Y3RvcjogewogICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0KICB9KTsKICBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsKfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICAgIG8uX19wcm90b19fID0gcDsKICAgIHJldHVybiBvOwogIH07CgogIHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9Cgp2YXIgUnVsZUVkaXRvclBhbmVsID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhSdWxlRWRpdG9yUGFuZWwsIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBSdWxlRWRpdG9yUGFuZWwocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUnVsZUVkaXRvclBhbmVsKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihSdWxlRWRpdG9yUGFuZWwpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJpbml0aWFsaXplRnJvbVJhd1J1bGVzIiwgZnVuY3Rpb24gKHJhd1J1bGVzKSB7CiAgICAgIHZhciBfZ2VuZXJhdGVSdWxlc0Zyb21SYXcgPSAoMCwgX21vZGVsLmdlbmVyYXRlUnVsZXNGcm9tUmF3KShyYXdSdWxlcyksCiAgICAgICAgICBydWxlcyA9IF9nZW5lcmF0ZVJ1bGVzRnJvbVJhdy5ydWxlcywKICAgICAgICAgIG1heERlcHRoID0gX2dlbmVyYXRlUnVsZXNGcm9tUmF3Lm1heERlcHRoOwoKICAgICAgdmFyIG1vZGUgPSBtYXhEZXB0aCA+PSBfcm9sZV9tYXBwaW5nX2NvbnN0YW50cy5WSVNVQUxfTUFYX1JVTEVfREVQVEggPyAnanNvbicgOiAndmlzdWFsJzsKICAgICAgcmV0dXJuIHsKICAgICAgICBydWxlczogcnVsZXMsCiAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICBtYXhEZXB0aDogbWF4RGVwdGgKICAgICAgfTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldENvbmZpcm1Nb2RlQ2hhbmdlUHJvbXB0IiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoIV90aGlzLnN0YXRlLnNob3dDb25maXJtTW9kZUNoYW5nZSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aU92ZXJsYXlNYXNrLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29uZmlybU1vZGFsLCB7CiAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuZWRpdFJvbGVNYXBwaW5nLmNvbmZpcm1Nb2RlQ2hhbmdlUHJvbXB0VGl0bGUiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTd2l0Y2ggd2l0aCBpbnZhbGlkIHJ1bGVzPyIKICAgICAgICB9KSwKICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24gb25DYW5jZWwoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICBzaG93Q29uZmlybU1vZGVDaGFuZ2U6IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uQ29uZmlybTogZnVuY3Rpb24gb25Db25maXJtKCkgewogICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICBtb2RlOiAndmlzdWFsJywKICAgICAgICAgICAgc2hvd0NvbmZpcm1Nb2RlQ2hhbmdlOiBmYWxzZQogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXMub25WYWxpZGl0eUNoYW5nZSh0cnVlKTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuZWRpdFJvbGVNYXBwaW5nLmNvbmZpcm1Nb2RlQ2hhbmdlUHJvbXB0Q2FuY2VsQnV0dG9uIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuY2VsIgogICAgICAgIH0pLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmVkaXRSb2xlTWFwcGluZy5jb25maXJtTW9kZUNoYW5nZVByb21wdENvbmZpcm1CdXR0b24iLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTd2l0Y2ggYW55d2F5IgogICAgICAgIH0pCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5lZGl0Um9sZU1hcHBpbmcuY29uZmlybU1vZGVDaGFuZ2VQcm9tcHRCb2R5IiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoZSBydWxlcyBkZWZpbmVkIGFyZSBub3QgdmFsaWQsIGFuZCBjYW5ub3QgYmUgdHJhbnNsYXRlZCB0byB0aGUgdmlzdWFsIGVkaXRvci4gWW91IG1heSBsb3NlIHNvbWUgb3IgYWxsIG9mIHlvdXIgY2hhbmdlcyBkdXJpbmcgdGhlIGNvbnZlcnNpb24uIERvIHlvdSB3aXNoIHRvIGNvbnRpbnVlPyIKICAgICAgfSkpKSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblJ1bGVDaGFuZ2UiLCBmdW5jdGlvbiAodXBkYXRlZFJ1bGUpIHsKICAgICAgdmFyIHJhdyA9IHVwZGF0ZWRSdWxlID8gdXBkYXRlZFJ1bGUudG9SYXcoKSA6IHt9OwoKICAgICAgX3RoaXMucHJvcHMub25DaGFuZ2UocmF3KTsKCiAgICAgIF90aGlzLnNldFN0YXRlKF9vYmplY3RTcHJlYWQoe30sICgwLCBfbW9kZWwuZ2VuZXJhdGVSdWxlc0Zyb21SYXcpKHJhdykpKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uVmFsaWRpdHlDaGFuZ2UiLCBmdW5jdGlvbiAoaXNSdWxlVmFsaWQpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGlzUnVsZVZhbGlkOiBpc1J1bGVWYWxpZAogICAgICB9KTsKCiAgICAgIF90aGlzLnByb3BzLm9uVmFsaWRpdHlDaGFuZ2UoaXNSdWxlVmFsaWQpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidHJ5U3dpdGNoRWRpdG9yTW9kZSIsIGZ1bmN0aW9uIChuZXdNb2RlKSB7CiAgICAgIHN3aXRjaCAobmV3TW9kZSkgewogICAgICAgIGNhc2UgJ3Zpc3VhbCc6CiAgICAgICAgICB7CiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5pc1J1bGVWYWxpZCkgewogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIG1vZGU6IG5ld01vZGUKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMub25WYWxpZGl0eUNoYW5nZSh0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBzaG93Q29uZmlybU1vZGVDaGFuZ2U6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgIGNhc2UgJ2pzb24nOgogICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICBtb2RlOiBuZXdNb2RlCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpcy5vblZhbGlkaXR5Q2hhbmdlKHRydWUpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIHJ1bGUgZWRpdG9yIG1vZGU6ICIuY29uY2F0KF90aGlzLnN0YXRlLm1vZGUpKTsKICAgICAgfQogICAgfSk7CgogICAgX3RoaXMuc3RhdGUgPSBfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5pbml0aWFsaXplRnJvbVJhd1J1bGVzKHByb3BzLnJhd1J1bGVzKSwgewogICAgICBpc1J1bGVWYWxpZDogdHJ1ZSwKICAgICAgc2hvd0NvbmZpcm1Nb2RlQ2hhbmdlOiBmYWxzZSwKICAgICAgc2hvd1Zpc3VhbEVkaXRvckRpc2FibGVkQWxlcnQ6IGZhbHNlCiAgICB9KTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhSdWxlRWRpdG9yUGFuZWwsIFt7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIHZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnByb3BzLnZhbGlkYXRlRm9ybSAmJiAoMCwgX3JvbGVfbWFwcGluZ192YWxpZGF0aW9uLnZhbGlkYXRlUm9sZU1hcHBpbmdSdWxlcykoewogICAgICAgIHJ1bGVzOiB0aGlzLnN0YXRlLnJ1bGVzID8gdGhpcy5zdGF0ZS5ydWxlcy50b1JhdygpIDoge30KICAgICAgfSk7CiAgICAgIHZhciB2YWxpZGF0aW9uV2FybmluZyA9IG51bGw7CgogICAgICBpZiAodmFsaWRhdGlvblJlc3VsdCAmJiB2YWxpZGF0aW9uUmVzdWx0LmVycm9yKSB7CiAgICAgICAgdmFsaWRhdGlvbldhcm5pbmcgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICAgIGNvbG9yOiAiZGFuZ2VyIiwKICAgICAgICAgIHRpdGxlOiB2YWxpZGF0aW9uUmVzdWx0LmVycm9yLAogICAgICAgICAgc2l6ZTogInMiCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhbmVsLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuZWRpdFJvbGVNYXBwaW5nLm1hcHBpbmdSdWxlc1BhbmVsVGl0bGUiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiTWFwcGluZyBydWxlcyIKICAgICAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgIGRpcmVjdGlvbjogImNvbHVtbiIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgewogICAgICAgIHNpemU6ICJzIiwKICAgICAgICBjb2xvcjogInN1YmR1ZWQiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5lZGl0Um9sZU1hcHBpbmcucm9sZU1hcHBpbmdSdWxlc0Zvcm1Sb3dIZWxwVGV4dCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJBc3NpZ24gcm9sZXMgdG8gdXNlcnMgd2hvIG1hdGNoIHRoZXNlIHJ1bGVzLiB7bGVhcm5Nb3JlTGlua30iLAogICAgICAgIHZhbHVlczogewogICAgICAgICAgbGVhcm5Nb3JlTGluazogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxpbmssIHsKICAgICAgICAgICAgaHJlZjogX2RvY3VtZW50YXRpb25fbGlua3MuZG9jdW1lbnRhdGlvbkxpbmtzLmdldFJvbGVNYXBwaW5nRmllbGRSdWxlc0RvY1VybCgpLAogICAgICAgICAgICB0YXJnZXQ6ICJfYmxhbmsiLAogICAgICAgICAgICBleHRlcm5hbDogdHJ1ZQogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmVkaXRSb2xlTWFwcGluZy5maWVsZFJ1bGVFZGl0b3IuZmllbGRWYWx1ZUhlbHAiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkxlYXJuIGFib3V0IHN1cHBvcnRlZCBmaWVsZCB2YWx1ZXMuIgogICAgICAgICAgfSkpCiAgICAgICAgfQogICAgICB9KSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICBpc0ludmFsaWQ6IHZhbGlkYXRpb25SZXN1bHQgJiYgdmFsaWRhdGlvblJlc3VsdC5pc0ludmFsaWQKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUVycm9yQm91bmRhcnksIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCB2YWxpZGF0aW9uV2FybmluZywgdGhpcy5nZXRFZGl0b3IoKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJ4bCIKICAgICAgfSksIHRoaXMuZ2V0TW9kZVRvZ2dsZSgpLCB0aGlzLmdldENvbmZpcm1Nb2RlQ2hhbmdlUHJvbXB0KCkpKSkpKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TW9kZVRvZ2dsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TW9kZVRvZ2dsZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zdGF0ZS5tb2RlID09PSAnanNvbicgJiYgdGhpcy5zdGF0ZS5tYXhEZXB0aCA+IF9yb2xlX21hcHBpbmdfY29uc3RhbnRzLlZJU1VBTF9NQVhfUlVMRV9ERVBUSCkgewogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2FsbE91dCwgewogICAgICAgICAgc2l6ZTogInMiLAogICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmVkaXRSb2xlTWFwcGluZy52aXN1YWxFZGl0b3JVbmF2YWlsYWJsZVRpdGxlJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1Zpc3VhbCBlZGl0b3IgdW5hdmFpbGFibGUnCiAgICAgICAgICB9KQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuZWRpdFJvbGVNYXBwaW5nLnZpc3VhbEVkaXRvclVuYXZhaWxhYmxlTWVzc2FnZSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlJ1bGUgZGVmaW5pdGlvbiBpcyB0b28gY29tcGxleCBmb3IgdGhlIHZpc3VhbCBlZGl0b3IuIgogICAgICAgIH0pKTsKICAgICAgfSAvLyBEb24ndCBvZmZlciBzd2l0aCBpZiBubyBydWxlcyBhcmUgcHJlc2VudCB5ZXQKCgogICAgICBpZiAodGhpcy5zdGF0ZS5tb2RlID09PSAndmlzdWFsJyAmJiB0aGlzLnN0YXRlLnJ1bGVzID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZS5tb2RlKSB7CiAgICAgICAgY2FzZSAndmlzdWFsJzoKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAicm9sZU1hcHBpbmdzSlNPTlJ1bGVFZGl0b3JCdXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIF90aGlzMi50cnlTd2l0Y2hFZGl0b3JNb2RlKCdqc29uJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuZWRpdFJvbGVNYXBwaW5nLnN3aXRjaFRvSlNPTkVkaXRvckxpbmsiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlN3aXRjaCB0byBKU09OIGVkaXRvciIKICAgICAgICAgIH0pLCAnICcsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlJY29uLCB7CiAgICAgICAgICAgIHR5cGU6ICJpbnB1dE91dHB1dCIsCiAgICAgICAgICAgIHNpemU6ICJzIgogICAgICAgICAgfSkpKTsKCiAgICAgICAgY2FzZSAnanNvbic6CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxpbmssIHsKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInJvbGVNYXBwaW5nc1Zpc3VhbFJ1bGVFZGl0b3JCdXR0b24iLAogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgIF90aGlzMi50cnlTd2l0Y2hFZGl0b3JNb2RlKCd2aXN1YWwnKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5lZGl0Um9sZU1hcHBpbmcuc3dpdGNoVG9WaXN1YWxFZGl0b3JMaW5rIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTd2l0Y2ggdG8gdmlzdWFsIGVkaXRvciIKICAgICAgICAgIH0pLCAnICcsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlJY29uLCB7CiAgICAgICAgICAgIHR5cGU6ICJpbnB1dE91dHB1dCIsCiAgICAgICAgICAgIHNpemU6ICJzIgogICAgICAgICAgfSkpKTsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBydWxlIGVkaXRvciBtb2RlOiAiLmNvbmNhdCh0aGlzLnN0YXRlLm1vZGUpKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldEVkaXRvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RWRpdG9yKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZS5tb2RlKSB7CiAgICAgICAgY2FzZSAndmlzdWFsJzoKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF92aXN1YWxfcnVsZV9lZGl0b3IuVmlzdWFsUnVsZUVkaXRvciwgewogICAgICAgICAgICBydWxlczogdGhpcy5zdGF0ZS5ydWxlcywKICAgICAgICAgICAgbWF4RGVwdGg6IHRoaXMuc3RhdGUubWF4RGVwdGgsCiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uUnVsZUNoYW5nZSwKICAgICAgICAgICAgb25Td2l0Y2hFZGl0b3JNb2RlOiBmdW5jdGlvbiBvblN3aXRjaEVkaXRvck1vZGUoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMy50cnlTd2l0Y2hFZGl0b3JNb2RlKCdqc29uJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICBjYXNlICdqc29uJzoKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9qc29uX3J1bGVfZWRpdG9yLkpTT05SdWxlRWRpdG9yLCB7CiAgICAgICAgICAgIHJ1bGVzOiB0aGlzLnN0YXRlLnJ1bGVzLAogICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vblJ1bGVDaGFuZ2UsCiAgICAgICAgICAgIG9uVmFsaWRpdHlDaGFuZ2U6IHRoaXMub25WYWxpZGl0eUNoYW5nZQogICAgICAgICAgfSk7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgcnVsZSBlZGl0b3IgbW9kZTogIi5jb25jYXQodGhpcy5zdGF0ZS5tb2RlKSk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBSdWxlRWRpdG9yUGFuZWw7Cn0oX3JlYWN0LkNvbXBvbmVudCk7CgpleHBvcnRzLlJ1bGVFZGl0b3JQYW5lbCA9IFJ1bGVFZGl0b3JQYW5lbDs="},null]}