{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/security/public/views/management/api_keys_grid/components/api_keys_grid_page.js","dependencies":[{"path":"x-pack/legacy/plugins/security/public/views/management/api_keys_grid/components/api_keys_grid_page.js","mtime":1585205047164},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuQXBpS2V5c0dyaWRQYWdlID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfbW9tZW50VGltZXpvbmUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIm1vbWVudC10aW1lem9uZSIpKTsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2giKSk7Cgp2YXIgX25vdGlmeSA9IHJlcXVpcmUoInVpL25vdGlmeSIpOwoKdmFyIF9zZWN0aW9uX2xvYWRpbmcgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9lc191aV9zaGFyZWQvcHVibGljL2NvbXBvbmVudHMvc2VjdGlvbl9sb2FkaW5nIik7Cgp2YXIgX2FwaV9rZXlzX2FwaSA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2xpYi9hcGlfa2V5c19hcGkiKTsKCnZhciBfcGVybWlzc2lvbl9kZW5pZWQgPSByZXF1aXJlKCIuL3Blcm1pc3Npb25fZGVuaWVkIik7Cgp2YXIgX2VtcHR5X3Byb21wdCA9IHJlcXVpcmUoIi4vZW1wdHlfcHJvbXB0Iik7Cgp2YXIgX25vdF9lbmFibGVkID0gcmVxdWlyZSgiLi9ub3RfZW5hYmxlZCIpOwoKdmFyIF9pbnZhbGlkYXRlX3Byb3ZpZGVyID0gcmVxdWlyZSgiLi9pbnZhbGlkYXRlX3Byb3ZpZGVyIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgX3R5cGVvZjIoU3ltYm9sLml0ZXJhdG9yKSA9PT0gInN5bWJvbCIpIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfSBlbHNlIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9CgogIHJldHVybiBfdHlwZW9mKG9iaik7Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogIH0KfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICByZXR1cm4gQ29uc3RydWN0b3I7Cn0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CiAgICByZXR1cm4gY2FsbDsKICB9CgogIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOwp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIERBVEVfRk9STUFUID0gJ01NTU0gRG8gWVlZWSBISDptbTpzcyc7Cgp2YXIgQXBpS2V5c0dyaWRQYWdlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhBcGlLZXlzR3JpZFBhZ2UsIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBBcGlLZXlzR3JpZFBhZ2UocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXBpS2V5c0dyaWRQYWdlKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihBcGlLZXlzR3JpZFBhZ2UpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZW5kZXJUYWJsZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlID0gX3RoaXMuc3RhdGUsCiAgICAgICAgICBhcGlLZXlzID0gX3RoaXMkc3RhdGUuYXBpS2V5cywKICAgICAgICAgIHNlbGVjdGVkSXRlbXMgPSBfdGhpcyRzdGF0ZS5zZWxlY3RlZEl0ZW1zLAogICAgICAgICAgaXNMb2FkaW5nVGFibGUgPSBfdGhpcyRzdGF0ZS5pc0xvYWRpbmdUYWJsZSwKICAgICAgICAgIGlzQWRtaW4gPSBfdGhpcyRzdGF0ZS5pc0FkbWluOwogICAgICB2YXIgbWVzc2FnZSA9IGlzTG9hZGluZ1RhYmxlID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5hcGlLZXlzVGFibGVMb2FkaW5nTWVzc2FnZSIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJMb2FkaW5nIEFQSSBrZXlzXHUyMDI2IgogICAgICB9KSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHNvcnRpbmcgPSB7CiAgICAgICAgc29ydDogewogICAgICAgICAgZmllbGQ6ICdleHBpcmF0aW9uJywKICAgICAgICAgIGRpcmVjdGlvbjogJ2FzYycKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBwYWdpbmF0aW9uID0gewogICAgICAgIGluaXRpYWxQYWdlU2l6ZTogMjAsCiAgICAgICAgcGFnZVNpemVPcHRpb25zOiBbMTAsIDIwLCA1MF0KICAgICAgfTsKICAgICAgdmFyIHNlbGVjdGlvbiA9IHsKICAgICAgICBvblNlbGVjdGlvbkNoYW5nZTogZnVuY3Rpb24gb25TZWxlY3Rpb25DaGFuZ2UobmV3U2VsZWN0ZWRJdGVtcykgewogICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICBzZWxlY3RlZEl0ZW1zOiBuZXdTZWxlY3RlZEl0ZW1zCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBzZWFyY2ggPSB7CiAgICAgICAgdG9vbHNMZWZ0OiBzZWxlY3RlZEl0ZW1zLmxlbmd0aCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2ludmFsaWRhdGVfcHJvdmlkZXIuSW52YWxpZGF0ZVByb3ZpZGVyLCB7CiAgICAgICAgICBpc0FkbWluOiBpc0FkbWluCiAgICAgICAgfSwgZnVuY3Rpb24gKGludmFsaWRhdGVBcGlLZXlQcm9tcHQpIHsKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGludmFsaWRhdGVBcGlLZXlQcm9tcHQoc2VsZWN0ZWRJdGVtcy5tYXAoZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICAgICAgICAgIHZhciBuYW1lID0gX3JlZi5uYW1lLAogICAgICAgICAgICAgICAgICAgIGlkID0gX3JlZi5pZDsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICAgICAgICAgIGlkOiBpZAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KSwgX3RoaXMub25BcGlLZXlzSW52YWxpZGF0ZWQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJidWxrSW52YWxpZGF0ZUFjdGlvbkJ1dHRvbiIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5hcGlLZXlzLnRhYmxlLmludmFsaWRhdGVBcGlLZXlCdXR0b24iLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkludmFsaWRhdGUge2NvdW50LCBwbHVyYWwsIG9uZSB7QVBJIGtleX0gb3RoZXIge0FQSSBrZXlzfX0iLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBjb3VudDogc2VsZWN0ZWRJdGVtcy5sZW5ndGgKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0pIDogdW5kZWZpbmVkLAogICAgICAgIHRvb2xzUmlnaHQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICAgIGNvbG9yOiAic2Vjb25kYXJ5IiwKICAgICAgICAgIGljb25UeXBlOiAicmVmcmVzaCIsCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMucmVsb2FkQXBpS2V5cygpOwogICAgICAgICAgfSwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJyZWxvYWRCdXR0b24iCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5hcGlLZXlzLnRhYmxlLnJlbG9hZEFwaUtleXNCdXR0b24iLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZWxvYWQiCiAgICAgICAgfSkpLAogICAgICAgIGJveDogewogICAgICAgICAgaW5jcmVtZW50YWw6IHRydWUKICAgICAgICB9LAogICAgICAgIGZpbHRlcnM6IGlzQWRtaW4gPyBbewogICAgICAgICAgdHlwZTogJ2ZpZWxkX3ZhbHVlX3NlbGVjdGlvbicsCiAgICAgICAgICBmaWVsZDogJ3VzZXJuYW1lJywKICAgICAgICAgIG5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmFwaUtleXMudGFibGUudXNlckZpbHRlckxhYmVsJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VzZXInCiAgICAgICAgICB9KSwKICAgICAgICAgIG11bHRpU2VsZWN0OiBmYWxzZSwKICAgICAgICAgIG9wdGlvbnM6IE9iamVjdC5rZXlzKGFwaUtleXMucmVkdWNlKGZ1bmN0aW9uIChhcGlLZXlzTWFwLCBhcGlLZXkpIHsKICAgICAgICAgICAgYXBpS2V5c01hcFthcGlLZXkudXNlcm5hbWVdID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGFwaUtleXNNYXA7CiAgICAgICAgICB9LCB7fSkpLm1hcChmdW5jdGlvbiAodXNlcm5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB2YWx1ZTogdXNlcm5hbWUsCiAgICAgICAgICAgICAgdmlldzogdXNlcm5hbWUKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pCiAgICAgICAgfSwgewogICAgICAgICAgdHlwZTogJ2ZpZWxkX3ZhbHVlX3NlbGVjdGlvbicsCiAgICAgICAgICBmaWVsZDogJ3JlYWxtJywKICAgICAgICAgIG5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmFwaUtleXMudGFibGUucmVhbG1GaWx0ZXJMYWJlbCcsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZWFsbScKICAgICAgICAgIH0pLAogICAgICAgICAgbXVsdGlTZWxlY3Q6IGZhbHNlLAogICAgICAgICAgb3B0aW9uczogT2JqZWN0LmtleXMoYXBpS2V5cy5yZWR1Y2UoZnVuY3Rpb24gKGFwaUtleXNNYXAsIGFwaUtleSkgewogICAgICAgICAgICBhcGlLZXlzTWFwW2FwaUtleS5yZWFsbV0gPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gYXBpS2V5c01hcDsKICAgICAgICAgIH0sIHt9KSkubWFwKGZ1bmN0aW9uIChyZWFsbSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHZhbHVlOiByZWFsbSwKICAgICAgICAgICAgICB2aWV3OiByZWFsbQogICAgICAgICAgICB9OwogICAgICAgICAgfSkKICAgICAgICB9XSA6IHVuZGVmaW5lZAogICAgICB9OwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgaXNBZG1pbiA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5hZG1pblRleHQiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJZb3UgYXJlIGFuIEFQSSBLZXkgYWRtaW5pc3RyYXRvci4iCiAgICAgICAgfSksCiAgICAgICAgY29sb3I6ICJzdWNjZXNzIiwKICAgICAgICBpY29uVHlwZTogInVzZXIiLAogICAgICAgIHNpemU6ICJzIiwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiYXBpS2V5QWRtaW5EZXNjcmlwdGlvbkNhbGxPdXQiCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pKSA6IHVuZGVmaW5lZCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUluTWVtb3J5VGFibGUsIHsKICAgICAgICBpdGVtczogYXBpS2V5cywKICAgICAgICBpdGVtSWQ6ICJpZCIsCiAgICAgICAgY29sdW1uczogX3RoaXMuZ2V0Q29sdW1uQ29uZmlnKCksCiAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgc29ydGluZzogc29ydGluZywKICAgICAgICBzZWxlY3Rpb246IHNlbGVjdGlvbiwKICAgICAgICBwYWdpbmF0aW9uOiBwYWdpbmF0aW9uLAogICAgICAgIGxvYWRpbmc6IGlzTG9hZGluZ1RhYmxlLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgaXNTZWxlY3RhYmxlOiB0cnVlLAogICAgICAgIHJvd1Byb3BzOiBmdW5jdGlvbiByb3dQcm9wcygpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICdkYXRhLXRlc3Qtc3Viaic6ICdhcGlLZXlSb3cnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0Q29sdW1uQ29uZmlnIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgaXNBZG1pbiA9IF90aGlzLnN0YXRlLmlzQWRtaW47CiAgICAgIHZhciBjb25maWcgPSBbewogICAgICAgIGZpZWxkOiAnbmFtZScsCiAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5uYW1lQ29sdW1uTmFtZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTmFtZScKICAgICAgICB9KSwKICAgICAgICBzb3J0YWJsZTogdHJ1ZQogICAgICB9XTsKCiAgICAgIGlmIChpc0FkbWluKSB7CiAgICAgICAgY29uZmlnID0gY29uZmlnLmNvbmNhdChbewogICAgICAgICAgZmllbGQ6ICd1c2VybmFtZScsCiAgICAgICAgICBuYW1lOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5hcGlLZXlzLnRhYmxlLnVzZXJOYW1lQ29sdW1uTmFtZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdVc2VyJwogICAgICAgICAgfSksCiAgICAgICAgICBzb3J0YWJsZTogdHJ1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGZpZWxkOiAncmVhbG0nLAogICAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5yZWFsbUNvbHVtbk5hbWUnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVhbG0nCiAgICAgICAgICB9KSwKICAgICAgICAgIHNvcnRhYmxlOiB0cnVlCiAgICAgICAgfV0pOwogICAgICB9CgogICAgICBjb25maWcgPSBjb25maWcuY29uY2F0KFt7CiAgICAgICAgZmllbGQ6ICdjcmVhdGlvbicsCiAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5jcmVhdGlvbkRhdGVDb2x1bW5OYW1lJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDcmVhdGVkJwogICAgICAgIH0pLAogICAgICAgIHNvcnRhYmxlOiB0cnVlLAogICAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihjcmVhdGlvbkRhdGVNcykgewogICAgICAgICAgcmV0dXJuICgwLCBfbW9tZW50VGltZXpvbmUuZGVmYXVsdCkoY3JlYXRpb25EYXRlTXMpLmZvcm1hdChEQVRFX0ZPUk1BVCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZmllbGQ6ICdleHBpcmF0aW9uJywKICAgICAgICBuYW1lOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5hcGlLZXlzLnRhYmxlLmV4cGlyYXRpb25EYXRlQ29sdW1uTmFtZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXhwaXJlcycKICAgICAgICB9KSwKICAgICAgICBzb3J0YWJsZTogdHJ1ZSwKICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoZXhwaXJhdGlvbkRhdGVNcykgewogICAgICAgICAgaWYgKGV4cGlyYXRpb25EYXRlTXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIHsKICAgICAgICAgICAgICBjb2xvcjogInN1YmR1ZWQiCiAgICAgICAgICAgIH0sIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmFwaUtleXMudGFibGUuZXhwaXJhdGlvbkRhdGVOZXZlck1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdOZXZlcicKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoMCwgX21vbWVudFRpbWV6b25lLmRlZmF1bHQpKGV4cGlyYXRpb25EYXRlTXMpLmZvcm1hdChEQVRFX0ZPUk1BVCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5zdGF0dXNDb2x1bW5OYW1lJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTdGF0dXMnCiAgICAgICAgfSksCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoX3JlZjIpIHsKICAgICAgICAgIHZhciBleHBpcmF0aW9uID0gX3JlZjIuZXhwaXJhdGlvbjsKICAgICAgICAgIHZhciBub3cgPSBEYXRlLm5vdygpOwoKICAgICAgICAgIGlmIChub3cgPiBleHBpcmF0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQmFkZ2UsIHsKICAgICAgICAgICAgICBjb2xvcjogImhvbGxvdyIKICAgICAgICAgICAgfSwgIkV4cGlyZWQiKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJhZGdlLCB7CiAgICAgICAgICAgIGNvbG9yOiAic2Vjb25kYXJ5IgogICAgICAgICAgfSwgIkFjdGl2ZSIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIG5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmFwaUtleXMudGFibGUuYWN0aW9uc0NvbHVtbk5hbWUnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0FjdGlvbnMnCiAgICAgICAgfSksCiAgICAgICAgYWN0aW9uczogW3sKICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKF9yZWYzKSB7CiAgICAgICAgICAgIHZhciBuYW1lID0gX3JlZjMubmFtZSwKICAgICAgICAgICAgICAgIGlkID0gX3JlZjMuaWQ7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgICAgICAgZ3V0dGVyU2l6ZTogInMiCiAgICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfaW52YWxpZGF0ZV9wcm92aWRlci5JbnZhbGlkYXRlUHJvdmlkZXIsIHsKICAgICAgICAgICAgICBpc0FkbWluOiBpc0FkbWluCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChpbnZhbGlkYXRlQXBpS2V5UHJvbXB0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUb29sVGlwLCB7CiAgICAgICAgICAgICAgICBjb250ZW50OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5hcGlLZXlzLnRhYmxlLmFjdGlvbkRlbGV0ZVRvb2x0aXAnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnSW52YWxpZGF0ZScKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkljb24sIHsKICAgICAgICAgICAgICAgICJhcmlhLWxhYmVsIjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5hY3Rpb25EZWxldGVBcmlhTGFiZWwnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW52YWxpZGF0ZSAne25hbWV9JyIsCiAgICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBpY29uVHlwZTogIm1pbnVzSW5DaXJjbGUiLAogICAgICAgICAgICAgICAgY29sb3I6ICJkYW5nZXIiLAogICAgICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImludmFsaWRhdGVBcGlLZXlCdXR0b24iLAogICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGludmFsaWRhdGVBcGlLZXlQcm9tcHQoW3sKICAgICAgICAgICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgICAgICAgICB9XSwgX3RoaXMub25BcGlLZXlzSW52YWxpZGF0ZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSkpKTsKICAgICAgICAgIH0KICAgICAgICB9XQogICAgICB9XSk7CiAgICAgIHJldHVybiBjb25maWc7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkFwaUtleXNJbnZhbGlkYXRlZCIsIGZ1bmN0aW9uIChhcGlLZXlzSW52YWxpZGF0ZWQpIHsKICAgICAgaWYgKGFwaUtleXNJbnZhbGlkYXRlZC5sZW5ndGgpIHsKICAgICAgICBfdGhpcy5yZWxvYWRBcGlLZXlzKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImluaXRpYWxseUxvYWRBcGlLZXlzIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaXNMb2FkaW5nQXBwOiB0cnVlLAogICAgICAgIGlzTG9hZGluZ1RhYmxlOiBmYWxzZQogICAgICB9KTsKCiAgICAgIF90aGlzLmxvYWRBcGlLZXlzKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZWxvYWRBcGlLZXlzIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgYXBpS2V5czogW10sCiAgICAgICAgaXNMb2FkaW5nQXBwOiBmYWxzZSwKICAgICAgICBpc0xvYWRpbmdUYWJsZTogdHJ1ZQogICAgICB9KTsKCiAgICAgIF90aGlzLmxvYWRBcGlLZXlzKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJsb2FkQXBpS2V5cyIsIGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHZhciBpc0FkbWluLCBfcmVmNCwgYXBpS2V5czsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDA7CiAgICAgICAgICAgICAgaXNBZG1pbiA9IF90aGlzLnN0YXRlLmlzQWRtaW47CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfYXBpX2tleXNfYXBpLkFwaUtleXNBcGkuZ2V0QXBpS2V5cyhpc0FkbWluKSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgX3JlZjQgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgIGFwaUtleXMgPSBfcmVmNC5hcGlLZXlzOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBhcGlLZXlzOiBhcGlLZXlzCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMjsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gOTsKICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDApOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQudDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNMb2FkaW5nQXBwOiBmYWxzZSwKICAgICAgICAgICAgICAgIGlzTG9hZGluZ1RhYmxlOiBmYWxzZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgbnVsbCwgW1swLCA5XV0pOwogICAgfSk7CgogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIGlzTG9hZGluZ0FwcDogdHJ1ZSwKICAgICAgaXNMb2FkaW5nVGFibGU6IGZhbHNlLAogICAgICBpc0FkbWluOiBmYWxzZSwKICAgICAgYXJlQXBpS2V5c0VuYWJsZWQ6IGZhbHNlLAogICAgICBhcGlLZXlzOiBbXSwKICAgICAgcGVybWlzc2lvbkRlbmllZDogZmFsc2UsCiAgICAgIHNlbGVjdGVkSXRlbXM6IFtdLAogICAgICBlcnJvcjogdW5kZWZpbmVkCiAgICB9OwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEFwaUtleXNHcmlkUGFnZSwgW3sKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdGhpcy5jaGVja1ByaXZpbGVnZXMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBwZXJtaXNzaW9uRGVuaWVkID0gX3RoaXMkc3RhdGUyLnBlcm1pc3Npb25EZW5pZWQsCiAgICAgICAgICBpc0xvYWRpbmdBcHAgPSBfdGhpcyRzdGF0ZTIuaXNMb2FkaW5nQXBwLAogICAgICAgICAgaXNMb2FkaW5nVGFibGUgPSBfdGhpcyRzdGF0ZTIuaXNMb2FkaW5nVGFibGUsCiAgICAgICAgICBhcmVBcGlLZXlzRW5hYmxlZCA9IF90aGlzJHN0YXRlMi5hcmVBcGlLZXlzRW5hYmxlZCwKICAgICAgICAgIGlzQWRtaW4gPSBfdGhpcyRzdGF0ZTIuaXNBZG1pbiwKICAgICAgICAgIGVycm9yID0gX3RoaXMkc3RhdGUyLmVycm9yLAogICAgICAgICAgYXBpS2V5cyA9IF90aGlzJHN0YXRlMi5hcGlLZXlzOwoKICAgICAgaWYgKHBlcm1pc3Npb25EZW5pZWQpIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcGVybWlzc2lvbl9kZW5pZWQuUGVybWlzc2lvbkRlbmllZCwgbnVsbCk7CiAgICAgIH0KCiAgICAgIGlmIChpc0xvYWRpbmdBcHApIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhZ2VDb250ZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zZWN0aW9uX2xvYWRpbmcuU2VjdGlvbkxvYWRpbmcsIHsKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhcGlLZXlzU2VjdGlvbkxvYWRpbmciCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5hcGlLZXlzLnRhYmxlLmxvYWRpbmdBcGlLZXlzRGVzY3JpcHRpb24iLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJMb2FkaW5nIEFQSSBrZXlzXHUyMDI2IgogICAgICAgIH0pKSk7CiAgICAgIH0KCiAgICAgIGlmIChlcnJvcikgewogICAgICAgIHZhciBfZXJyb3IkYm9keSA9IGVycm9yLmJvZHksCiAgICAgICAgICAgIGVycm9yVGl0bGUgPSBfZXJyb3IkYm9keS5lcnJvciwKICAgICAgICAgICAgbWVzc2FnZSA9IF9lcnJvciRib2R5Lm1lc3NhZ2UsCiAgICAgICAgICAgIHN0YXR1c0NvZGUgPSBfZXJyb3IkYm9keS5zdGF0dXNDb2RlOwogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmFwaUtleXMudGFibGUubG9hZGluZ0FwaUtleXNFcnJvclRpdGxlIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJFcnJvciBsb2FkaW5nIEFQSSBrZXlzIgogICAgICAgICAgfSksCiAgICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgICBpY29uVHlwZTogImFsZXJ0IiwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhcGlLZXlzRXJyb3IiCiAgICAgICAgfSwgc3RhdHVzQ29kZSwgIjogIiwgZXJyb3JUaXRsZSwgIiAtICIsIG1lc3NhZ2UpKTsKICAgICAgfQoKICAgICAgaWYgKCFhcmVBcGlLZXlzRW5hYmxlZCkgewogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX25vdF9lbmFibGVkLk5vdEVuYWJsZWQsIG51bGwpKTsKICAgICAgfQoKICAgICAgaWYgKCFpc0xvYWRpbmdUYWJsZSAmJiBhcGlLZXlzICYmIGFwaUtleXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQYWdlQ29udGVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZW1wdHlfcHJvbXB0LkVtcHR5UHJvbXB0LCB7CiAgICAgICAgICBpc0FkbWluOiBpc0FkbWluCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICB2YXIgZGVzY3JpcHRpb24gPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgewogICAgICAgIGNvbG9yOiAic3ViZHVlZCIsCiAgICAgICAgc2l6ZTogInMiLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhcGlLZXlzRGVzY3JpcHRpb25UZXh0IgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgaXNBZG1pbiA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmFwaUtleXMudGFibGUuYXBpS2V5c0FsbERlc2NyaXB0aW9uIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlZpZXcgYW5kIGludmFsaWRhdGUgQVBJIGtleXMuIEFuIEFQSSBrZXkgc2VuZHMgcmVxdWVzdHMgb24gYmVoYWxmIG9mIGEgdXNlci4iCiAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5hcGlLZXlzT3duRGVzY3JpcHRpb24iLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVmlldyBhbmQgaW52YWxpZGF0ZSB5b3VyIEFQSSBrZXlzLiBBbiBBUEkga2V5IHNlbmRzIHJlcXVlc3RzIG9uIHlvdXIgYmVoYWxmLiIKICAgICAgfSkpKTsKCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQYWdlQ29udGVudEhlYWRlciwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhZ2VDb250ZW50SGVhZGVyU2VjdGlvbiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LmFwaUtleXMudGFibGUuYXBpS2V5c1RpdGxlIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkFQSSBLZXlzIgogICAgICB9KSkpLCBkZXNjcmlwdGlvbikpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnRCb2R5LCBudWxsLCB0aGlzLnJlbmRlclRhYmxlKCkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjaGVja1ByaXZpbGVnZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrUHJpdmlsZWdlcygpIHsKICAgICAgdmFyIF9yZWY1LCBfaXNBZG1pbiwgYXJlQXBpS2V5c0VuYWJsZWQ7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGNoZWNrUHJpdmlsZWdlcyQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAwOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF9hcGlfa2V5c19hcGkuQXBpS2V5c0FwaS5jaGVja1ByaXZpbGVnZXMoKSk7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgX3JlZjUgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICBfaXNBZG1pbiA9IF9yZWY1LmlzQWRtaW47CiAgICAgICAgICAgICAgYXJlQXBpS2V5c0VuYWJsZWQgPSBfcmVmNS5hcmVBcGlLZXlzRW5hYmxlZDsKICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzQWRtaW46IF9pc0FkbWluLAogICAgICAgICAgICAgICAgYXJlQXBpS2V5c0VuYWJsZWQ6IGFyZUFwaUtleXNFbmFibGVkCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChhcmVBcGlLZXlzRW5hYmxlZCkgewogICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsbHlMb2FkQXBpS2V5cygpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBXZSdyZSBkb25lIGxvYWRpbmcgYW5kIHdpbGwganVzdCBzaG93IHRoZSAiRGlzYWJsZWQiIGVycm9yLgogICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGlzTG9hZGluZ0FwcDogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMzsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxMDsKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CgogICAgICAgICAgICAgIGlmIChfbG9kYXNoLmRlZmF1bHQuZ2V0KF9jb250ZXh0Mi50MCwgJ2JvZHkuc3RhdHVzQ29kZScpID09PSA0MDMpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uRGVuaWVkOiB0cnVlLAogICAgICAgICAgICAgICAgICBpc0xvYWRpbmdBcHA6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkRGFuZ2VyKHRoaXMucHJvcHMuaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQuYXBpS2V5cy50YWJsZS5mZXRjaGluZ0FwaUtleXNFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXJyb3IgY2hlY2tpbmcgcHJpdmlsZWdlczoge21lc3NhZ2V9JywKICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogX2xvZGFzaC5kZWZhdWx0LmdldChfY29udGV4dDIudDAsICdib2R5Lm1lc3NhZ2UnLCAnJykKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzLCBbWzAsIDEwXV0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEFwaUtleXNHcmlkUGFnZTsKfShfcmVhY3QuQ29tcG9uZW50KTsKCmV4cG9ydHMuQXBpS2V5c0dyaWRQYWdlID0gQXBpS2V5c0dyaWRQYWdlOw=="},null]}