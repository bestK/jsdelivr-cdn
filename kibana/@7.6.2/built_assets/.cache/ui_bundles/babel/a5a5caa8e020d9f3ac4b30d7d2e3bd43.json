{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/field_editor/field_editor.js","dependencies":[{"path":"src/legacy/ui/public/field_editor/field_editor.js","mtime":1585205041027},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkZpZWxkRWRpdG9yID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInByb3AtdHlwZXMiKSk7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIF9zY3JpcHRpbmdfbGFuZ3VhZ2VzID0gcmVxdWlyZSgidWkvc2NyaXB0aW5nX2xhbmd1YWdlcyIpOwoKdmFyIF9kb2N1bWVudGF0aW9uX2xpbmtzID0gcmVxdWlyZSgidWkvZG9jdW1lbnRhdGlvbl9saW5rcyIpOwoKdmFyIF9ub3RpZnkgPSByZXF1aXJlKCJ1aS9ub3RpZnkiKTsKCnZhciBfbmV3X3BsYXRmb3JtID0gcmVxdWlyZSgidWkvbmV3X3BsYXRmb3JtIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9zY3JpcHRpbmdfY2FsbF9vdXRzID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL3NjcmlwdGluZ19jYWxsX291dHMiKTsKCnZhciBfc2NyaXB0aW5nX2hlbHAgPSByZXF1aXJlKCIuL2NvbXBvbmVudHMvc2NyaXB0aW5nX2hlbHAiKTsKCnZhciBfZmllbGRfZm9ybWF0X2VkaXRvciA9IHJlcXVpcmUoIi4vY29tcG9uZW50cy9maWVsZF9mb3JtYXRfZWRpdG9yIik7Cgp2YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4vY29uc3RhbnRzIik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4vbGliIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7CgpyZXF1aXJlKCJicmFjZS9tb2RlL2dyb292eSIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH0KCmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgeyByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsgdmFyIF9hcnIgPSBbXTsgdmFyIF9uID0gdHJ1ZTsgdmFyIF9kID0gZmFsc2U7IHZhciBfZSA9IHVuZGVmaW5lZDsgdHJ5IHsgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgeyBfYXJyLnB1c2goX3MudmFsdWUpOyBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7IH0gfSBjYXRjaCAoZXJyKSB7IF9kID0gdHJ1ZTsgX2UgPSBlcnI7IH0gZmluYWxseSB7IHRyeSB7IGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoX2QpIHRocm93IF9lOyB9IH0gcmV0dXJuIF9hcnI7IH0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBnZXRGaWVsZEZvcm1hdHMgPSBmdW5jdGlvbiBnZXRGaWVsZEZvcm1hdHMoKSB7CiAgcmV0dXJuIF9uZXdfcGxhdGZvcm0ubnBTdGFydC5wbHVnaW5zLmRhdGEuZmllbGRGb3JtYXRzOwp9OwoKdmFyIEZpZWxkRWRpdG9yID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1B1cmVDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoRmllbGRFZGl0b3IsIF9QdXJlQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gRmllbGRFZGl0b3IocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRmllbGRFZGl0b3IpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZpZWxkRWRpdG9yKS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZENoYW5nZSIsIGZ1bmN0aW9uIChmaWVsZE5hbWUsIHZhbHVlKSB7CiAgICAgIHZhciBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkOwogICAgICBmaWVsZFtmaWVsZE5hbWVdID0gdmFsdWU7CgogICAgICBfdGhpcy5mb3JjZVVwZGF0ZSgpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25UeXBlQ2hhbmdlIiwgZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgdmFyIGdldENvbmZpZyA9IF90aGlzLnByb3BzLmhlbHBlcnMuZ2V0Q29uZmlnOwogICAgICB2YXIgZmllbGQgPSBfdGhpcy5zdGF0ZS5maWVsZDsKICAgICAgdmFyIGZpZWxkRm9ybWF0cyA9IGdldEZpZWxkRm9ybWF0cygpOwogICAgICB2YXIgRGVmYXVsdEZpZWxkRm9ybWF0ID0gZmllbGRGb3JtYXRzLmdldERlZmF1bHRUeXBlKHR5cGUpOwogICAgICBmaWVsZC50eXBlID0gdHlwZTsKICAgICAgdmFyIGZpZWxkVHlwZUZvcm1hdHMgPSBbKDAsIF9saWIuZ2V0RGVmYXVsdEZvcm1hdCkoRGVmYXVsdEZpZWxkRm9ybWF0KV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShnZXRGaWVsZEZvcm1hdHMoKS5nZXRCeUZpZWxkVHlwZShmaWVsZC50eXBlKSkpOwogICAgICB2YXIgRmllbGRGb3JtYXQgPSBmaWVsZFR5cGVGb3JtYXRzWzBdOwogICAgICBmaWVsZC5mb3JtYXQgPSBuZXcgRmllbGRGb3JtYXQobnVsbCwgZ2V0Q29uZmlnKTsKCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBmaWVsZFR5cGVGb3JtYXRzOiBmaWVsZFR5cGVGb3JtYXRzLAogICAgICAgIGZpZWxkRm9ybWF0SWQ6IEZpZWxkRm9ybWF0LmlkLAogICAgICAgIGZpZWxkRm9ybWF0UGFyYW1zOiBmaWVsZC5mb3JtYXQucGFyYW1zKCkKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkxhbmdDaGFuZ2UiLCBmdW5jdGlvbiAobGFuZykgewogICAgICB2YXIgZmllbGQgPSBfdGhpcy5zdGF0ZS5maWVsZDsKICAgICAgdmFyIGZpZWxkVHlwZXMgPSAoMCwgX2xvZGFzaC5nZXQpKF9jb25zdGFudHMuRklFTERfVFlQRVNfQllfTEFORywgbGFuZywgX2NvbnN0YW50cy5ERUZBVUxUX0ZJRUxEX1RZUEVTKTsKICAgICAgZmllbGQubGFuZyA9IGxhbmc7CiAgICAgIGZpZWxkLnR5cGUgPSBmaWVsZFR5cGVzLmluY2x1ZGVzKGZpZWxkLnR5cGUpID8gZmllbGQudHlwZSA6IGZpZWxkVHlwZXNbMF07CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmllbGRUeXBlczogZmllbGRUeXBlcwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uRm9ybWF0Q2hhbmdlIiwgZnVuY3Rpb24gKGZvcm1hdElkLCBwYXJhbXMpIHsKICAgICAgdmFyIGdldENvbmZpZyA9IF90aGlzLnByb3BzLmhlbHBlcnMuZ2V0Q29uZmlnOwogICAgICB2YXIgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGUuZmllbGQsCiAgICAgICAgICBmaWVsZFR5cGVGb3JtYXRzID0gX3RoaXMkc3RhdGUuZmllbGRUeXBlRm9ybWF0czsKICAgICAgdmFyIEZpZWxkRm9ybWF0ID0gZmllbGRUeXBlRm9ybWF0cy5maW5kKGZ1bmN0aW9uIChmb3JtYXQpIHsKICAgICAgICByZXR1cm4gZm9ybWF0LmlkID09PSBmb3JtYXRJZDsKICAgICAgfSkgfHwgZmllbGRUeXBlRm9ybWF0c1swXTsKICAgICAgZmllbGQuZm9ybWF0ID0gbmV3IEZpZWxkRm9ybWF0KHBhcmFtcywgZ2V0Q29uZmlnKTsKCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBmaWVsZEZvcm1hdElkOiBGaWVsZEZvcm1hdC5pZCwKICAgICAgICBmaWVsZEZvcm1hdFBhcmFtczogZmllbGQuZm9ybWF0LnBhcmFtcygpCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Gb3JtYXRQYXJhbXNDaGFuZ2UiLCBmdW5jdGlvbiAobmV3UGFyYW1zKSB7CiAgICAgIHZhciBmaWVsZEZvcm1hdElkID0gX3RoaXMuc3RhdGUuZmllbGRGb3JtYXRJZDsKCiAgICAgIF90aGlzLm9uRm9ybWF0Q2hhbmdlKGZpZWxkRm9ybWF0SWQsIG5ld1BhcmFtcyk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZvcm1hdFBhcmFtc0Vycm9yIiwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBoYXNGb3JtYXRFcnJvcjogISFlcnJvcgogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2NyaXB0Q2hhbmdlIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBoYXNTY3JpcHRFcnJvcjogZmFsc2UKICAgICAgfSk7CgogICAgICBfdGhpcy5vbkZpZWxkQ2hhbmdlKCdzY3JpcHQnLCB2YWx1ZSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzaG93U2NyaXB0aW5nSGVscCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHNob3dTY3JpcHRpbmdIZWxwOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGlkZVNjcmlwdGluZ0hlbHAiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBzaG93U2NyaXB0aW5nSGVscDogZmFsc2UKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZW5kZXJEZWxldGVNb2RhbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGZpZWxkID0gX3RoaXMuc3RhdGUuZmllbGQ7CiAgICAgIHJldHVybiBfdGhpcy5zdGF0ZS5zaG93RGVsZXRlTW9kYWwgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpT3ZlcmxheU1hc2ssIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb25maXJtTW9kYWwsIHsKICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZEhlYWRlcicsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVsZXRlIGZpZWxkICd7ZmllbGROYW1lfSciLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgICAgfQogICAgICAgIH0pLAogICAgICAgIG9uQ2FuY2VsOiBfdGhpcy5oaWRlRGVsZXRlTW9kYWwsCiAgICAgICAgb25Db25maXJtOiBmdW5jdGlvbiBvbkNvbmZpcm0oKSB7CiAgICAgICAgICBfdGhpcy5oaWRlRGVsZXRlTW9kYWwoKTsKCiAgICAgICAgICBfdGhpcy5kZWxldGVGaWVsZCgpOwogICAgICAgIH0sCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZC5jYW5jZWxCdXR0b24nLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0NhbmNlbCcKICAgICAgICB9KSwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZC5kZWxldGVCdXR0b24nLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0RlbGV0ZScKICAgICAgICB9KSwKICAgICAgICBidXR0b25Db2xvcjogImRhbmdlciIsCiAgICAgICAgZGVmYXVsdEZvY3VzZWRCdXR0b246IF9ldWkuRVVJX01PREFMX0NPTkZJUk1fQlVUVE9OCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLmRlbGV0ZUZpZWxkTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiWW91IGNhbid0IHJlY292ZXIgYSBkZWxldGVkIGZpZWxkLntzZXBhcmF0b3J9QXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRvIHRoaXM/IiwKICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgIHNlcGFyYXRvcjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImJyIiwgbnVsbCksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImJyIiwgbnVsbCkpCiAgICAgICAgfQogICAgICB9KSkpKSA6IG51bGw7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzaG93RGVsZXRlTW9kYWwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBzaG93RGVsZXRlTW9kYWw6IHRydWUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJoaWRlRGVsZXRlTW9kYWwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBzaG93RGVsZXRlTW9kYWw6IGZhbHNlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyU2NyaXB0aW5nUGFuZWxzIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUyID0gX3RoaXMuc3RhdGUsCiAgICAgICAgICBzY3JpcHRpbmdMYW5ncyA9IF90aGlzJHN0YXRlMi5zY3JpcHRpbmdMYW5ncywKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGUyLmZpZWxkLAogICAgICAgICAgc2hvd1NjcmlwdGluZ0hlbHAgPSBfdGhpcyRzdGF0ZTIuc2hvd1NjcmlwdGluZ0hlbHA7CgogICAgICBpZiAoIWZpZWxkLnNjcmlwdGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3NjcmlwdGluZ19jYWxsX291dHMuU2NyaXB0aW5nRGlzYWJsZWRDYWxsT3V0LCB7CiAgICAgICAgaXNWaXNpYmxlOiAhc2NyaXB0aW5nTGFuZ3MubGVuZ3RoCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zY3JpcHRpbmdfY2FsbF9vdXRzLlNjcmlwdGluZ1dhcm5pbmdDYWxsT3V0LCB7CiAgICAgICAgaXNWaXNpYmxlOiB0cnVlCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zY3JpcHRpbmdfaGVscC5TY3JpcHRpbmdIZWxwRmx5b3V0LCB7CiAgICAgICAgaXNWaXNpYmxlOiBzaG93U2NyaXB0aW5nSGVscCwKICAgICAgICBvbkNsb3NlOiBfdGhpcy5oaWRlU2NyaXB0aW5nSGVscCwKICAgICAgICBpbmRleFBhdHRlcm46IF90aGlzLnByb3BzLmluZGV4UGF0dGVybiwKICAgICAgICBsYW5nOiBmaWVsZC5sYW5nLAogICAgICAgIG5hbWU6IGZpZWxkLm5hbWUsCiAgICAgICAgc2NyaXB0OiBmaWVsZC5zY3JpcHQsCiAgICAgICAgZXhlY3V0ZVNjcmlwdDogX2xpYi5leGVjdXRlU2NyaXB0CiAgICAgIH0pKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRlbGV0ZUZpZWxkIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgcmVkaXJlY3RBd2F5ID0gX3RoaXMucHJvcHMuaGVscGVycy5yZWRpcmVjdEF3YXk7CiAgICAgIHZhciBpbmRleFBhdHRlcm4gPSBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm47CiAgICAgIHZhciBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkOwogICAgICB2YXIgcmVtb3ZlID0gaW5kZXhQYXR0ZXJuLnJlbW92ZVNjcmlwdGVkRmllbGQoZmllbGQpOwoKICAgICAgaWYgKHJlbW92ZSkgewogICAgICAgIHJlbW92ZS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBtZXNzYWdlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZC5kZWxldGVkSGVhZGVyJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlbGV0ZWQgJ3tmaWVsZE5hbWV9JyIsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKG1lc3NhZ2UpOwoKICAgICAgICAgIHJlZGlyZWN0QXdheSgpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJlZGlyZWN0QXdheSgpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzYXZlRmllbGQiLCBmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgZmllbGQsIGluZGV4UGF0dGVybiwgZmllbGRGb3JtYXRJZCwgaXNWYWxpZCwgcmVkaXJlY3RBd2F5LCBpbmRleDsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkLnRvQWN0dWFsRmllbGQoKTsKICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm47CiAgICAgICAgICAgICAgZmllbGRGb3JtYXRJZCA9IF90aGlzLnN0YXRlLmZpZWxkRm9ybWF0SWQ7CgogICAgICAgICAgICAgIGlmICghZmllbGQuc2NyaXB0ZWQpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNTYXZpbmc6IHRydWUKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2xpYi5pc1NjcmlwdFZhbGlkKSh7CiAgICAgICAgICAgICAgICBuYW1lOiBmaWVsZC5uYW1lLAogICAgICAgICAgICAgICAgbGFuZzogZmllbGQubGFuZywKICAgICAgICAgICAgICAgIHNjcmlwdDogZmllbGQuc2NyaXB0LAogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuVGl0bGU6IGluZGV4UGF0dGVybi50aXRsZQogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBpc1ZhbGlkID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICAgICAgaWYgKGlzVmFsaWQpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaGFzU2NyaXB0RXJyb3I6IHRydWUsCiAgICAgICAgICAgICAgICBpc1NhdmluZzogZmFsc2UKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIHJlZGlyZWN0QXdheSA9IF90aGlzLnByb3BzLmhlbHBlcnMucmVkaXJlY3RBd2F5OwogICAgICAgICAgICAgIGluZGV4ID0gaW5kZXhQYXR0ZXJuLmZpZWxkcy5maW5kSW5kZXgoZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmLm5hbWUgPT09IGZpZWxkLm5hbWU7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4uZmllbGRzLnVwZGF0ZShmaWVsZCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybi5maWVsZHMuYWRkKGZpZWxkKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghZmllbGRGb3JtYXRJZCkgewogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuLmZpZWxkRm9ybWF0TWFwW2ZpZWxkLm5hbWVdID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4uZmllbGRGb3JtYXRNYXBbZmllbGQubmFtZV0gPSBmaWVsZC5mb3JtYXQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBpbmRleFBhdHRlcm4uc2F2ZSgpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLmRlbGV0ZUZpZWxkLnNhdmVkSGVhZGVyJywgewogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmVkICd7ZmllbGROYW1lfSciLAogICAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgICBmaWVsZE5hbWU6IGZpZWxkLm5hbWUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkU3VjY2VzcyhtZXNzYWdlKTsKCiAgICAgICAgICAgICAgICByZWRpcmVjdEF3YXkoKTsKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIHZhciBfZmllbGQgPSBwcm9wcy5maWVsZCwKICAgICAgICBfaW5kZXhQYXR0ZXJuID0gcHJvcHMuaW5kZXhQYXR0ZXJuLAogICAgICAgIEZpZWxkID0gcHJvcHMuaGVscGVycy5GaWVsZDsKICAgIF90aGlzLnN0YXRlID0gewogICAgICBpc1JlYWR5OiBmYWxzZSwKICAgICAgaXNDcmVhdGluZzogZmFsc2UsCiAgICAgIGlzRGVwcmVjYXRlZExhbmc6IGZhbHNlLAogICAgICBzY3JpcHRpbmdMYW5nczogW10sCiAgICAgIGZpZWxkVHlwZXM6IFtdLAogICAgICBmaWVsZFR5cGVGb3JtYXRzOiBbXSwKICAgICAgZXhpc3RpbmdGaWVsZE5hbWVzOiBfaW5kZXhQYXR0ZXJuLmZpZWxkcy5tYXAoZnVuY3Rpb24gKGYpIHsKICAgICAgICByZXR1cm4gZi5uYW1lOwogICAgICB9KSwKICAgICAgZmllbGQ6ICgwLCBfbGliLmNvcHlGaWVsZCkoX2ZpZWxkLCBfaW5kZXhQYXR0ZXJuLCBGaWVsZCksCiAgICAgIGZpZWxkRm9ybWF0SWQ6IHVuZGVmaW5lZCwKICAgICAgZmllbGRGb3JtYXRQYXJhbXM6IHt9LAogICAgICBzaG93U2NyaXB0aW5nSGVscDogZmFsc2UsCiAgICAgIHNob3dEZWxldGVNb2RhbDogZmFsc2UsCiAgICAgIGhhc0Zvcm1hdEVycm9yOiBmYWxzZSwKICAgICAgaGFzU2NyaXB0RXJyb3I6IGZhbHNlLAogICAgICBpc1NhdmluZzogZmFsc2UKICAgIH07CiAgICBfdGhpcy5zdXBwb3J0ZWRMYW5ncyA9ICgwLCBfc2NyaXB0aW5nX2xhbmd1YWdlcy5nZXRTdXBwb3J0ZWRTY3JpcHRpbmdMYW5ndWFnZXMpKCk7CiAgICBfdGhpcy5kZXByZWNhdGVkTGFuZ3MgPSAoMCwgX3NjcmlwdGluZ19sYW5ndWFnZXMuZ2V0RGVwcmVjYXRlZFNjcmlwdGluZ0xhbmd1YWdlcykoKTsKCiAgICBfdGhpcy5pbml0KCk7CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEZpZWxkRWRpdG9yLCBbewogICAga2V5OiAiaW5pdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgdmFyICRodHRwLCBmaWVsZCwgaW5kZXhQYXR0ZXJuLCBnZXRFbmFibGVkU2NyaXB0aW5nTGFuZ3VhZ2VzLCBlbmFibGVkTGFuZ3MsIHNjcmlwdGluZ0xhbmdzLCBmaWVsZFR5cGVzLCBmaWVsZEZvcm1hdHMsIGZpZWxkVHlwZUZvcm1hdHM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gaW5pdCQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgJGh0dHAgPSB0aGlzLnByb3BzLmhlbHBlcnMuJGh0dHA7CiAgICAgICAgICAgICAgZmllbGQgPSB0aGlzLnN0YXRlLmZpZWxkOwogICAgICAgICAgICAgIGluZGV4UGF0dGVybiA9IHRoaXMucHJvcHMuaW5kZXhQYXR0ZXJuOwogICAgICAgICAgICAgIGdldEVuYWJsZWRTY3JpcHRpbmdMYW5ndWFnZXMgPSBuZXcgX3NjcmlwdGluZ19sYW5ndWFnZXMuR2V0RW5hYmxlZFNjcmlwdGluZ0xhbmd1YWdlc1Byb3ZpZGVyKCRodHRwKTsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDY7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChnZXRFbmFibGVkU2NyaXB0aW5nTGFuZ3VhZ2VzKCkpOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGVuYWJsZWRMYW5ncyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIHNjcmlwdGluZ0xhbmdzID0gKDAsIF9sb2Rhc2guaW50ZXJzZWN0aW9uKShlbmFibGVkTGFuZ3MsICgwLCBfbG9kYXNoLnVuaW9uKSh0aGlzLnN1cHBvcnRlZExhbmdzLCB0aGlzLmRlcHJlY2F0ZWRMYW5ncykpOwogICAgICAgICAgICAgIGZpZWxkLmxhbmcgPSBzY3JpcHRpbmdMYW5ncy5pbmNsdWRlcyhmaWVsZC5sYW5nKSA/IGZpZWxkLmxhbmcgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgZmllbGRUeXBlcyA9ICgwLCBfbG9kYXNoLmdldCkoX2NvbnN0YW50cy5GSUVMRF9UWVBFU19CWV9MQU5HLCBmaWVsZC5sYW5nLCBfY29uc3RhbnRzLkRFRkFVTFRfRklFTERfVFlQRVMpOwogICAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBmaWVsZFR5cGVzLmluY2x1ZGVzKGZpZWxkLnR5cGUpID8gZmllbGQudHlwZSA6IGZpZWxkVHlwZXNbMF07CiAgICAgICAgICAgICAgZmllbGRGb3JtYXRzID0gZ2V0RmllbGRGb3JtYXRzKCk7CiAgICAgICAgICAgICAgZmllbGRUeXBlRm9ybWF0cyA9IFsoMCwgX2xpYi5nZXREZWZhdWx0Rm9ybWF0KShmaWVsZEZvcm1hdHMuZ2V0RGVmYXVsdFR5cGUoZmllbGQudHlwZSwgZmllbGQuZXNUeXBlcykpXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGZpZWxkRm9ybWF0cy5nZXRCeUZpZWxkVHlwZShmaWVsZC50eXBlKSkpOwogICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNSZWFkeTogdHJ1ZSwKICAgICAgICAgICAgICAgIGlzQ3JlYXRpbmc6ICFpbmRleFBhdHRlcm4uZmllbGRzLmdldEJ5TmFtZShmaWVsZC5uYW1lKSwKICAgICAgICAgICAgICAgIGlzRGVwcmVjYXRlZExhbmc6IHRoaXMuZGVwcmVjYXRlZExhbmdzLmluY2x1ZGVzKGZpZWxkLmxhbmcpLAogICAgICAgICAgICAgICAgZXJyb3JzOiBbXSwKICAgICAgICAgICAgICAgIHNjcmlwdGluZ0xhbmdzOiBzY3JpcHRpbmdMYW5ncywKICAgICAgICAgICAgICAgIGZpZWxkVHlwZXM6IGZpZWxkVHlwZXMsCiAgICAgICAgICAgICAgICBmaWVsZFR5cGVGb3JtYXRzOiBmaWVsZFR5cGVGb3JtYXRzLAogICAgICAgICAgICAgICAgZmllbGRGb3JtYXRJZDogKDAsIF9sb2Rhc2guZ2V0KShpbmRleFBhdHRlcm4sIFsnZmllbGRGb3JtYXRNYXAnLCBmaWVsZC5uYW1lLCAndHlwZScsICdpZCddKSwKICAgICAgICAgICAgICAgIGZpZWxkRm9ybWF0UGFyYW1zOiBmaWVsZC5mb3JtYXQucGFyYW1zKCkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc0R1cGxpY2F0ZU5hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzRHVwbGljYXRlTmFtZSgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMyA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBpc0NyZWF0aW5nID0gX3RoaXMkc3RhdGUzLmlzQ3JlYXRpbmcsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlMy5maWVsZCwKICAgICAgICAgIGV4aXN0aW5nRmllbGROYW1lcyA9IF90aGlzJHN0YXRlMy5leGlzdGluZ0ZpZWxkTmFtZXM7CiAgICAgIHJldHVybiBpc0NyZWF0aW5nICYmIGV4aXN0aW5nRmllbGROYW1lcy5pbmNsdWRlcyhmaWVsZC5uYW1lKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJOYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJOYW1lKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyRzdGF0ZTQgPSB0aGlzLnN0YXRlLAogICAgICAgICAgaXNDcmVhdGluZyA9IF90aGlzJHN0YXRlNC5pc0NyZWF0aW5nLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTQuZmllbGQ7CiAgICAgIHZhciBpc0ludmFsaWQgPSAhZmllbGQubmFtZSB8fCAhZmllbGQubmFtZS50cmltKCk7CiAgICAgIHJldHVybiBpc0NyZWF0aW5nID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5uYW1lTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ05hbWUnCiAgICAgICAgfSksCiAgICAgICAgaGVscFRleHQ6IHRoaXMuaXNEdXBsaWNhdGVOYW1lKCkgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUljb24sIHsKICAgICAgICAgIHR5cGU6ICJhbGVydCIsCiAgICAgICAgICBjb2xvcjogIndhcm5pbmciLAogICAgICAgICAgc2l6ZTogInMiCiAgICAgICAgfSksICJceEEwIiwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLm1hcHBpbmdDb25mbGljdExhYmVsLm1hcHBpbmdDb25mbGljdERldGFpbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogInttYXBwaW5nQ29uZmxpY3R9IFlvdSBhbHJlYWR5IGhhdmUgYSBmaWVsZCB3aXRoIHRoZSBuYW1lIHtmaWVsZE5hbWV9LiBOYW1pbmcgeW91ciBzY3JpcHRlZCBmaWVsZCB3aXRoIHRoZSBzYW1lIG5hbWUgbWVhbnMgeW91IHdvbid0IGJlIGFibGUgdG8gcXVlcnkgYm90aCBmaWVsZHMgYXQgdGhlIHNhbWUgdGltZS4iLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIG1hcHBpbmdDb25mbGljdDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3Ryb25nIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5tYXBwaW5nQ29uZmxpY3RMYWJlbC5tYXBwaW5nQ29uZmxpY3RMYWJlbCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJNYXBwaW5nIENvbmZsaWN0OiIKICAgICAgICAgICAgfSkpLAogICAgICAgICAgICBmaWVsZE5hbWU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2RlLCBudWxsLCBmaWVsZC5uYW1lKQogICAgICAgICAgfQogICAgICAgIH0pKSA6IG51bGwsCiAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQsCiAgICAgICAgZXJyb3I6IGlzSW52YWxpZCA/IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3IubmFtZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTmFtZSBpcyByZXF1aXJlZCcKICAgICAgICB9KSA6IG51bGwKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkVGV4dCwgewogICAgICAgIHZhbHVlOiBmaWVsZC5uYW1lIHx8ICcnLAogICAgICAgIHBsYWNlaG9sZGVyOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLm5hbWVQbGFjZWhvbGRlcicsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTmV3IHNjcmlwdGVkIGZpZWxkJwogICAgICAgIH0pLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJlZGl0b3JGaWVsZE5hbWUiLAogICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICBfdGhpczIub25GaWVsZENoYW5nZSgnbmFtZScsIGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9LAogICAgICAgIGlzSW52YWxpZDogaXNJbnZhbGlkCiAgICAgIH0pKSA6IG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyTGFuZ3VhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckxhbmd1YWdlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyRzdGF0ZTUgPSB0aGlzLnN0YXRlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTUuZmllbGQsCiAgICAgICAgICBzY3JpcHRpbmdMYW5ncyA9IF90aGlzJHN0YXRlNS5zY3JpcHRpbmdMYW5ncywKICAgICAgICAgIGlzRGVwcmVjYXRlZExhbmcgPSBfdGhpcyRzdGF0ZTUuaXNEZXByZWNhdGVkTGFuZzsKICAgICAgcmV0dXJuIGZpZWxkLnNjcmlwdGVkID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5sYW5ndWFnZUxhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdMYW5ndWFnZScKICAgICAgICB9KSwKICAgICAgICBoZWxwVGV4dDogaXNEZXByZWNhdGVkTGFuZyA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvbiwgewogICAgICAgICAgdHlwZTogImFsZXJ0IiwKICAgICAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgICAgICBzaXplOiAicyIKICAgICAgICB9KSwgIlx4QTAiLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzdHJvbmciLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iud2FybmluZ0hlYWRlciIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlcHJlY2F0aW9uIFdhcm5pbmc6IgogICAgICAgIH0pKSwgIlx4QTAiLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iud2FybmluZ0xhYmVsLndhcm5pbmdEZXRhaWwiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJ7bGFuZ3VhZ2V9IGlzIGRlcHJlY2F0ZWQgYW5kIHN1cHBvcnQgd2lsbCBiZSByZW1vdmVkIGluIHRoZSBuZXh0IG1ham9yIHZlcnNpb24gb2YgS2liYW5hIGFuZCBFbGFzdGljc2VhcmNoLiBXZSByZWNvbW1lbmQgdXNpbmcge3BhaW5sZXNzTGlua30gZm9yIG5ldyBzY3JpcHRlZCBmaWVsZHMuIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBsYW5ndWFnZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvZGUsIG51bGwsIGZpZWxkLmxhbmcpLAogICAgICAgICAgICBwYWlubGVzc0xpbms6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMaW5rLCB7CiAgICAgICAgICAgICAgdGFyZ2V0OiAiX2JsYW5rIiwKICAgICAgICAgICAgICBocmVmOiAoMCwgX2RvY3VtZW50YXRpb25fbGlua3MuZ2V0RG9jTGluaykoJ3NjcmlwdGVkRmllbGRzLnBhaW5sZXNzJykKICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci53YXJuaW5nTGFiZWwucGFpbmxlc3NMaW5rTGFiZWwiLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUGFpbmxlc3MiCiAgICAgICAgICAgIH0pKQogICAgICAgICAgfQogICAgICAgIH0pKSA6IG51bGwKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNlbGVjdCwgewogICAgICAgIHZhbHVlOiBmaWVsZC5sYW5nLAogICAgICAgIG9wdGlvbnM6IHNjcmlwdGluZ0xhbmdzLm1hcChmdW5jdGlvbiAobGFuZykgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IGxhbmcsCiAgICAgICAgICAgIHRleHQ6IGxhbmcKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRvckZpZWxkTGFuZyIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIF90aGlzMy5vbkxhbmdDaGFuZ2UoZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0KICAgICAgfSkpIDogbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJUeXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJUeXBlKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyRzdGF0ZTYgPSB0aGlzLnN0YXRlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTYuZmllbGQsCiAgICAgICAgICBmaWVsZFR5cGVzID0gX3RoaXMkc3RhdGU2LmZpZWxkVHlwZXM7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLnR5cGVMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVHlwZScKICAgICAgICB9KQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU2VsZWN0LCB7CiAgICAgICAgdmFsdWU6IGZpZWxkLnR5cGUsCiAgICAgICAgZGlzYWJsZWQ6ICFmaWVsZC5zY3JpcHRlZCwKICAgICAgICBvcHRpb25zOiBmaWVsZFR5cGVzLm1hcChmdW5jdGlvbiAodHlwZSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IHR5cGUsCiAgICAgICAgICAgIHRleHQ6IHR5cGUKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRvckZpZWxkVHlwZSIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIF90aGlzNC5vblR5cGVDaGFuZ2UoZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0KICAgICAgfSkpOwogICAgfQogICAgLyoqCiAgICAgKiByZW5kZXJzIGEgd2FybmluZyBhbmQgYSB0YWJsZSBvZiBjb25mbGljdGluZyBpbmRpY2VzCiAgICAgKiBpbiBjYXNlIHRoZXJlIGFyZSBpbmRpY2VzIHdpdGggZGlmZmVyZW50IHR5cGVzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVuZGVyVHlwZUNvbmZsaWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJUeXBlQ29uZmxpY3QoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZSRmaWVsZCA9IHRoaXMuc3RhdGUuZmllbGQsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlJGZpZWxkID09PSB2b2lkIDAgPyB7fSA6IF90aGlzJHN0YXRlJGZpZWxkOwoKICAgICAgaWYgKCFmaWVsZC5jb25mbGljdERlc2NyaXB0aW9ucyB8fCBfdHlwZW9mKGZpZWxkLmNvbmZsaWN0RGVzY3JpcHRpb25zKSAhPT0gJ29iamVjdCcpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGNvbHVtbnMgPSBbewogICAgICAgIGZpZWxkOiAndHlwZScsCiAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci50eXBlTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1R5cGUnCiAgICAgICAgfSksCiAgICAgICAgd2lkdGg6ICcxMDBweCcKICAgICAgfSwgewogICAgICAgIGZpZWxkOiAnaW5kaWNlcycsCiAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5pbmRleE5hbWVMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnSW5kZXggbmFtZXMnCiAgICAgICAgfSkKICAgICAgfV07CiAgICAgIHZhciBpdGVtcyA9IE9iamVjdC5lbnRyaWVzKGZpZWxkLmNvbmZsaWN0RGVzY3JpcHRpb25zKS5tYXAoZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAyKSwKICAgICAgICAgICAgdHlwZSA9IF9yZWYyWzBdLAogICAgICAgICAgICBpbmRpY2VzID0gX3JlZjJbMV07CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgaW5kaWNlczogQXJyYXkuaXNBcnJheShpbmRpY2VzKSA/IGluZGljZXMuam9pbignLCAnKSA6ICdJbmRleCBuYW1lcyB1bmF2YWlsYWJsZScKICAgICAgICB9OwogICAgICB9KTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICAgICAgY29sb3I6ICJ3YXJuaW5nIiwKICAgICAgICBpY29uVHlwZTogImFsZXJ0IiwKICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLmZpZWxkVHlwZUNvbmZsaWN0IiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRmllbGQgdHlwZSBjb25mbGljdCIKICAgICAgICB9KSwKICAgICAgICBzaXplOiAicyIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5tdWx0aVR5cGVMYWJlbERlc2MiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVGhlIHR5cGUgb2YgdGhpcyBmaWVsZCBjaGFuZ2VzIGFjcm9zcyBpbmRpY2VzLiBJdCBpcyB1bmF2YWlsYWJsZSBmb3IgbWFueSBhbmFseXNpcyBmdW5jdGlvbnMuIFRoZSBpbmRpY2VzIHBlciB0eXBlIGFyZSBhcyBmb2xsb3dzOiIKICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQmFzaWNUYWJsZSwgewogICAgICAgIGl0ZW1zOiBpdGVtcywKICAgICAgICBjb2x1bW5zOiBjb2x1bW5zCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJGb3JtYXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckZvcm1hdCgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgX3RoaXMkc3RhdGU3ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGU3LmZpZWxkLAogICAgICAgICAgZmllbGRUeXBlRm9ybWF0cyA9IF90aGlzJHN0YXRlNy5maWVsZFR5cGVGb3JtYXRzLAogICAgICAgICAgZmllbGRGb3JtYXRJZCA9IF90aGlzJHN0YXRlNy5maWVsZEZvcm1hdElkLAogICAgICAgICAgZmllbGRGb3JtYXRQYXJhbXMgPSBfdGhpcyRzdGF0ZTcuZmllbGRGb3JtYXRQYXJhbXM7CiAgICAgIHZhciBmaWVsZEZvcm1hdEVkaXRvcnMgPSB0aGlzLnByb3BzLmhlbHBlcnMuZmllbGRGb3JtYXRFZGl0b3JzOwogICAgICB2YXIgZGVmYXVsdEZvcm1hdCA9IGZpZWxkVHlwZUZvcm1hdHNbMF0gJiYgZmllbGRUeXBlRm9ybWF0c1swXS5yZXNvbHZlZFRpdGxlOwogICAgICB2YXIgbGFiZWwgPSBkZWZhdWx0Rm9ybWF0ID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5kZWZhdWx0Rm9ybWF0SGVhZGVyIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZvcm1hdCAoRGVmYXVsdDoge2RlZmF1bHRGb3JtYXR9KSIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBkZWZhdWx0Rm9ybWF0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29kZSwgbnVsbCwgZGVmYXVsdEZvcm1hdCkKICAgICAgICB9CiAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5mb3JtYXRIZWFkZXIiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRm9ybWF0IgogICAgICB9KTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiBsYWJlbCwKICAgICAgICBoZWxwVGV4dDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLmZvcm1hdExhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRm9ybWF0dGluZyBhbGxvd3MgeW91IHRvIGNvbnRyb2wgdGhlIHdheSB0aGF0IHNwZWNpZmljIHZhbHVlcyBhcmUgZGlzcGxheWVkLiBJdCBjYW4gYWxzbyBjYXVzZSB2YWx1ZXMgdG8gYmUgY29tcGxldGVseSBjaGFuZ2VkIGFuZCBwcmV2ZW50IGhpZ2hsaWdodGluZyBpbiBEaXNjb3ZlciBmcm9tIHdvcmtpbmcuIgogICAgICAgIH0pCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTZWxlY3QsIHsKICAgICAgICB2YWx1ZTogZmllbGRGb3JtYXRJZCwKICAgICAgICBvcHRpb25zOiBmaWVsZFR5cGVGb3JtYXRzLm1hcChmdW5jdGlvbiAoZm9ybWF0KSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogZm9ybWF0LmlkIHx8ICcnLAogICAgICAgICAgICB0ZXh0OiBmb3JtYXQudGl0bGUKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRvclNlbGVjdGVkRm9ybWF0SWQiLAogICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICBfdGhpczUub25Gb3JtYXRDaGFuZ2UoZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0KICAgICAgfSkpLCBmaWVsZEZvcm1hdElkID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZmllbGRfZm9ybWF0X2VkaXRvci5GaWVsZEZvcm1hdEVkaXRvciwgewogICAgICAgIGZpZWxkVHlwZTogZmllbGQudHlwZSwKICAgICAgICBmaWVsZEZvcm1hdDogZmllbGQuZm9ybWF0LAogICAgICAgIGZpZWxkRm9ybWF0SWQ6IGZpZWxkRm9ybWF0SWQsCiAgICAgICAgZmllbGRGb3JtYXRQYXJhbXM6IGZpZWxkRm9ybWF0UGFyYW1zLAogICAgICAgIGZpZWxkRm9ybWF0RWRpdG9yczogZmllbGRGb3JtYXRFZGl0b3JzLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uRm9ybWF0UGFyYW1zQ2hhbmdlLAogICAgICAgIG9uRXJyb3I6IHRoaXMub25Gb3JtYXRQYXJhbXNFcnJvcgogICAgICB9KSA6IG51bGwpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlclBvcHVsYXJpdHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclBvcHVsYXJpdHkoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIGZpZWxkID0gdGhpcy5zdGF0ZS5maWVsZDsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3IucG9wdWxhcml0eUxhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdQb3B1bGFyaXR5JywKICAgICAgICAgIGRlc2NyaXB0aW9uOiAnIlBvcHVsYXJpdHkiIHJlZmVycyB0byBLaWJhbmFcJ3MgbWVhc3VyZW1lbnQgaG93IHBvcHVsYXIgYSBmaWVsZCBpcyAoaS5lLiBob3cgY29tbW9ubHkgaXQgaXMgdXNlZCkuJwogICAgICAgIH0pCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZE51bWJlciwgewogICAgICAgIHZhbHVlOiBmaWVsZC5jb3VudCwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZWRpdG9yRmllbGRDb3VudCIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIF90aGlzNi5vbkZpZWxkQ2hhbmdlKCdjb3VudCcsIGUudGFyZ2V0LnZhbHVlID8gTnVtYmVyKGUudGFyZ2V0LnZhbHVlKSA6ICcnKTsKICAgICAgICB9CiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJTY3JpcHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclNjcmlwdCgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlOCA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlOC5maWVsZCwKICAgICAgICAgIGhhc1NjcmlwdEVycm9yID0gX3RoaXMkc3RhdGU4Lmhhc1NjcmlwdEVycm9yOwogICAgICB2YXIgaXNJbnZhbGlkID0gIWZpZWxkLnNjcmlwdCB8fCAhZmllbGQuc2NyaXB0LnRyaW0oKSB8fCBoYXNTY3JpcHRFcnJvcjsKICAgICAgdmFyIGVycm9yTXNnID0gaGFzU2NyaXB0RXJyb3IgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbnZhbGlkU2NyaXB0RXJyb3IiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iuc2NyaXB0SW52YWxpZEVycm9yTWVzc2FnZSIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTY3JpcHQgaXMgaW52YWxpZC4gVmlldyBzY3JpcHQgcHJldmlldyBmb3IgZGV0YWlscyIKICAgICAgfSkpIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5zY3JpcHRSZXF1aXJlZEVycm9yTWVzc2FnZSIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTY3JpcHQgaXMgcmVxdWlyZWQiCiAgICAgIH0pOwogICAgICByZXR1cm4gZmllbGQuc2NyaXB0ZWQgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBmdWxsV2lkdGg6IHRydWUsCiAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3Iuc2NyaXB0TGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NjcmlwdCcKICAgICAgICB9KSwKICAgICAgICBpc0ludmFsaWQ6IGlzSW52YWxpZCwKICAgICAgICBlcnJvcjogaXNJbnZhbGlkID8gZXJyb3JNc2cgOiBudWxsCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2RlRWRpdG9yLCB7CiAgICAgICAgdmFsdWU6IGZpZWxkLnNjcmlwdCwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZWRpdG9yRmllbGRTY3JpcHQiLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uU2NyaXB0Q2hhbmdlLAogICAgICAgIG1vZGU6ICJncm9vdnkiLAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgaGVpZ2h0OiAiMzAwcHgiCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5zY3JpcHQuYWNjZXNzV2l0aExhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkFjY2VzcyBmaWVsZHMgd2l0aCB7Y29kZX0uIiwKICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgIGNvZGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImNvZGUiLCBudWxsLCAiZG9jWydzb21lX2ZpZWxkJ10udmFsdWUiKQogICAgICAgIH0KICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgIG9uQ2xpY2s6IHRoaXMuc2hvd1NjcmlwdGluZ0hlbHAsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInNjcmlwdGVkRmllbGRzSGVscExpbmsiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iuc2NyaXB0LmdldEhlbHBMYWJlbCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJHZXQgaGVscCB3aXRoIHRoZSBzeW50YXggYW5kIHByZXZpZXcgdGhlIHJlc3VsdHMgb2YgeW91ciBzY3JpcHQuIgogICAgICB9KSkpKSkgOiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckFjdGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckFjdGlvbnMoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTkgPSB0aGlzLnN0YXRlLAogICAgICAgICAgaXNDcmVhdGluZyA9IF90aGlzJHN0YXRlOS5pc0NyZWF0aW5nLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTkuZmllbGQsCiAgICAgICAgICBpc1NhdmluZyA9IF90aGlzJHN0YXRlOS5pc1NhdmluZzsKICAgICAgdmFyIHJlZGlyZWN0QXdheSA9IHRoaXMucHJvcHMuaGVscGVycy5yZWRpcmVjdEF3YXk7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgb25DbGljazogdGhpcy5zYXZlRmllbGQsCiAgICAgICAgaXNEaXNhYmxlZDogdGhpcy5pc1NhdmluZ0Rpc2FibGVkKCksCiAgICAgICAgaXNMb2FkaW5nOiBpc1NhdmluZywKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZmllbGRTYXZlQnV0dG9uIgogICAgICB9LCBpc0NyZWF0aW5nID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5hY3Rpb25zLmNyZWF0ZUJ1dHRvbiIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDcmVhdGUgZmllbGQiCiAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5hY3Rpb25zLnNhdmVCdXR0b24iLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSBmaWVsZCIKICAgICAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgICAgb25DbGljazogcmVkaXJlY3RBd2F5LAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJmaWVsZENhbmNlbEJ1dHRvbiIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5hY3Rpb25zLmNhbmNlbEJ1dHRvbiIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDYW5jZWwiCiAgICAgIH0pKSksICFpc0NyZWF0aW5nICYmIGZpZWxkLnNjcmlwdGVkID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJmbGV4RW5kIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgb25DbGljazogdGhpcy5zaG93RGVsZXRlTW9kYWwKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5hY3Rpb25zLmRlbGV0ZUJ1dHRvbiIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJEZWxldGUiCiAgICAgIH0pKSkpKSA6IG51bGwpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1NhdmluZ0Rpc2FibGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc1NhdmluZ0Rpc2FibGVkKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUxMCA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlMTAuZmllbGQsCiAgICAgICAgICBoYXNGb3JtYXRFcnJvciA9IF90aGlzJHN0YXRlMTAuaGFzRm9ybWF0RXJyb3IsCiAgICAgICAgICBoYXNTY3JpcHRFcnJvciA9IF90aGlzJHN0YXRlMTAuaGFzU2NyaXB0RXJyb3I7CgogICAgICBpZiAoaGFzRm9ybWF0RXJyb3IgfHwgaGFzU2NyaXB0RXJyb3IgfHwgIWZpZWxkLm5hbWUgfHwgIWZpZWxkLm5hbWUudHJpbSgpIHx8IGZpZWxkLnNjcmlwdGVkICYmICghZmllbGQuc2NyaXB0IHx8ICFmaWVsZC5zY3JpcHQudHJpbSgpKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTExID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGlzUmVhZHkgPSBfdGhpcyRzdGF0ZTExLmlzUmVhZHksCiAgICAgICAgICBpc0NyZWF0aW5nID0gX3RoaXMkc3RhdGUxMS5pc0NyZWF0aW5nLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTExLmZpZWxkOwogICAgICByZXR1cm4gaXNSZWFkeSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUZXh0LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMyIsIG51bGwsIGlzQ3JlYXRpbmcgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLmNyZWF0ZUhlYWRlciIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDcmVhdGUgc2NyaXB0ZWQgZmllbGQiCiAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5lZGl0SGVhZGVyIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkVkaXQge2ZpZWxkTmFtZX0iLAogICAgICAgIHZhbHVlczogewogICAgICAgICAgZmllbGROYW1lOiBmaWVsZC5uYW1lCiAgICAgICAgfQogICAgICB9KSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybSwgbnVsbCwgdGhpcy5yZW5kZXJTY3JpcHRpbmdQYW5lbHMoKSwgdGhpcy5yZW5kZXJOYW1lKCksIHRoaXMucmVuZGVyTGFuZ3VhZ2UoKSwgdGhpcy5yZW5kZXJUeXBlKCksIHRoaXMucmVuZGVyVHlwZUNvbmZsaWN0KCksIHRoaXMucmVuZGVyRm9ybWF0KCksIHRoaXMucmVuZGVyUG9wdWxhcml0eSgpLCB0aGlzLnJlbmRlclNjcmlwdCgpLCB0aGlzLnJlbmRlckFjdGlvbnMoKSwgdGhpcy5yZW5kZXJEZWxldGVNb2RhbCgpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJsIgogICAgICB9KSkgOiBudWxsOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEZpZWxkRWRpdG9yOwp9KF9yZWFjdC5QdXJlQ29tcG9uZW50KTsKCmV4cG9ydHMuRmllbGRFZGl0b3IgPSBGaWVsZEVkaXRvcjsKCl9kZWZpbmVQcm9wZXJ0eShGaWVsZEVkaXRvciwgInByb3BUeXBlcyIsIHsKICBpbmRleFBhdHRlcm46IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QuaXNSZXF1aXJlZCwKICBmaWVsZDogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdC5pc1JlcXVpcmVkLAogIGhlbHBlcnM6IF9wcm9wVHlwZXMuZGVmYXVsdC5zaGFwZSh7CiAgICBGaWVsZDogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICAgIGdldENvbmZpZzogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICAgICRodHRwOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkLAogICAgZmllbGRGb3JtYXRFZGl0b3JzOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LmlzUmVxdWlyZWQsCiAgICByZWRpcmVjdEF3YXk6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQKICB9KQp9KTs="},null]}