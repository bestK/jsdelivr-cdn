{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/ml/public/application/datavisualizer/file_based/components/import_view/import_view.js","dependencies":[{"path":"x-pack/legacy/plugins/ml/public/application/datavisualizer/file_based/components/import_view/import_view.js","mtime":1585205045628},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkltcG9ydFZpZXcgPSB2b2lkIDA7Cgp2YXIgX3JlYWN0ID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9pbXBvcnRlciA9IHJlcXVpcmUoIi4vaW1wb3J0ZXIiKTsKCnZhciBfcmVzdWx0c19saW5rcyA9IHJlcXVpcmUoIi4uL3Jlc3VsdHNfbGlua3MiKTsKCnZhciBfaW1wb3J0X3Byb2dyZXNzID0gcmVxdWlyZSgiLi4vaW1wb3J0X3Byb2dyZXNzIik7Cgp2YXIgX2ltcG9ydF9lcnJvcnMgPSByZXF1aXJlKCIuLi9pbXBvcnRfZXJyb3JzIik7Cgp2YXIgX2ltcG9ydF9zdW1tYXJ5ID0gcmVxdWlyZSgiLi4vaW1wb3J0X3N1bW1hcnkiKTsKCnZhciBfaW1wb3J0X3NldHRpbmdzID0gcmVxdWlyZSgiLi4vaW1wb3J0X3NldHRpbmdzIik7Cgp2YXIgX2V4cGVyaW1lbnRhbF9iYWRnZSA9IHJlcXVpcmUoIi4uL2V4cGVyaW1lbnRhbF9iYWRnZSIpOwoKdmFyIF9pbmRleF91dGlscyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL3V0aWwvaW5kZXhfdXRpbHMiKTsKCnZhciBfbWxfYXBpX3NlcnZpY2UgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9zZXJ2aWNlcy9tbF9hcGlfc2VydmljZSIpOwoKdmFyIF91dGlscyA9IHJlcXVpcmUoIi4uL3V0aWxzIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9Cgp2YXIgREVGQVVMVF9USU1FX0ZJRUxEID0gJ0B0aW1lc3RhbXAnOwp2YXIgREVGQVVMVF9JTkRFWF9TRVRUSU5HUyA9IHsKICBudW1iZXJfb2Zfc2hhcmRzOiAxCn07CnZhciBDT05GSUdfTU9ERSA9IHsKICBTSU1QTEU6IDAsCiAgQURWQU5DRUQ6IDEKfTsKdmFyIERFRkFVTFRfU1RBVEUgPSB7CiAgaW5kZXg6ICcnLAogIGltcG9ydGluZzogZmFsc2UsCiAgaW1wb3J0ZWQ6IGZhbHNlLAogIGluaXRpYWxpemVkOiBmYWxzZSwKICByZWFkaW5nOiBmYWxzZSwKICByZWFkUHJvZ3Jlc3M6IDAsCiAgcmVhZFN0YXR1czogX2ltcG9ydF9wcm9ncmVzcy5JTVBPUlRfU1RBVFVTLklOQ09NUExFVEUsCiAgcGFyc2VKU09OU3RhdHVzOiBfaW1wb3J0X3Byb2dyZXNzLklNUE9SVF9TVEFUVVMuSU5DT01QTEVURSwKICBpbmRleENyZWF0ZWRTdGF0dXM6IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5JTkNPTVBMRVRFLAogIGluZGV4UGF0dGVybkNyZWF0ZWRTdGF0dXM6IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5JTkNPTVBMRVRFLAogIGluZ2VzdFBpcGVsaW5lQ3JlYXRlZFN0YXR1czogX2ltcG9ydF9wcm9ncmVzcy5JTVBPUlRfU1RBVFVTLklOQ09NUExFVEUsCiAgcGVybWlzc2lvbkNoZWNrU3RhdHVzOiBfaW1wb3J0X3Byb2dyZXNzLklNUE9SVF9TVEFUVVMuSU5DT01QTEVURSwKICB1cGxvYWRQcm9ncmVzczogMCwKICB1cGxvYWRTdGF0dXM6IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5JTkNPTVBMRVRFLAogIGNyZWF0ZUluZGV4UGF0dGVybjogdHJ1ZSwKICBpbmRleFBhdHRlcm46ICcnLAogIGluZGV4UGF0dGVybklkOiAnJywKICBpbmdlc3RQaXBlbGluZUlkOiAnJywKICBlcnJvcnM6IFtdLAogIGltcG9ydEZhaWx1cmVzOiBbXSwKICBkb2NDb3VudDogMCwKICBjb25maWdNb2RlOiBDT05GSUdfTU9ERS5TSU1QTEUsCiAgaW5kZXhTZXR0aW5nc1N0cmluZzogJycsCiAgbWFwcGluZ3NTdHJpbmc6ICcnLAogIHBpcGVsaW5lU3RyaW5nOiAnJywKICBpbmRleE5hbWVzOiBbXSwKICBpbmRleFBhdHRlcm5OYW1lczogW10sCiAgaW5kZXhOYW1lRXJyb3I6ICcnLAogIGluZGV4UGF0dGVybk5hbWVFcnJvcjogJycsCiAgdGltZUZpZWxkTmFtZTogdW5kZWZpbmVkCn07Cgp2YXIgSW1wb3J0VmlldyA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoSW1wb3J0VmlldywgX0NvbXBvbmVudCk7CgogIGZ1bmN0aW9uIEltcG9ydFZpZXcocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSW1wb3J0Vmlldyk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSW1wb3J0VmlldykuY2FsbCh0aGlzLCBwcm9wcykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNsaWNrUmVzZXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzdGF0ZSA9IGdldERlZmF1bHRTdGF0ZShfdGhpcy5zdGF0ZSwgX3RoaXMucHJvcHMucmVzdWx0cyk7CgogICAgICBfdGhpcy5zZXRTdGF0ZShzdGF0ZSwgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLmxvYWRJbmRleE5hbWVzKCk7CgogICAgICAgIF90aGlzLmxvYWRJbmRleFBhdHRlcm5OYW1lcygpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNsaWNrSW1wb3J0IiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5pbXBvcnQoKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ29uZmlnTW9kZUNoYW5nZSIsIGZ1bmN0aW9uIChjb25maWdNb2RlKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBjb25maWdNb2RlOiBjb25maWdNb2RlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25JbmRleENoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBuYW1lID0gZS50YXJnZXQudmFsdWU7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaW5kZXg6IG5hbWUsCiAgICAgICAgaW5kZXhOYW1lRXJyb3I6IGlzSW5kZXhOYW1lVmFsaWQobmFtZSwgX3RoaXMuc3RhdGUuaW5kZXhOYW1lcykKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkluZGV4UGF0dGVybkNoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBuYW1lID0gZS50YXJnZXQudmFsdWU7CiAgICAgIHZhciBfdGhpcyRzdGF0ZSA9IF90aGlzLnN0YXRlLAogICAgICAgICAgaW5kZXhQYXR0ZXJuTmFtZXMgPSBfdGhpcyRzdGF0ZS5pbmRleFBhdHRlcm5OYW1lcywKICAgICAgICAgIGluZGV4ID0gX3RoaXMkc3RhdGUuaW5kZXg7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaW5kZXhQYXR0ZXJuOiBuYW1lLAogICAgICAgIGluZGV4UGF0dGVybk5hbWVFcnJvcjogaXNJbmRleFBhdHRlcm5OYW1lVmFsaWQobmFtZSwgaW5kZXhQYXR0ZXJuTmFtZXMsIGluZGV4KQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ3JlYXRlSW5kZXhQYXR0ZXJuQ2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGNyZWF0ZUluZGV4UGF0dGVybjogZS50YXJnZXQuY2hlY2tlZAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uSW5kZXhTZXR0aW5nc1N0cmluZ0NoYW5nZSIsIGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpbmRleFNldHRpbmdzU3RyaW5nOiB0ZXh0CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25NYXBwaW5nc1N0cmluZ0NoYW5nZSIsIGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBtYXBwaW5nc1N0cmluZzogdGV4dAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uUGlwZWxpbmVTdHJpbmdDaGFuZ2UiLCBmdW5jdGlvbiAodGV4dCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcGlwZWxpbmVTdHJpbmc6IHRleHQKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZXRJbXBvcnRQcm9ncmVzcyIsIGZ1bmN0aW9uIChwcm9ncmVzcykgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdXBsb2FkUHJvZ3Jlc3M6IHByb2dyZXNzCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2V0UmVhZFByb2dyZXNzIiwgZnVuY3Rpb24gKHByb2dyZXNzKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICByZWFkUHJvZ3Jlc3M6IHByb2dyZXNzCiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMuc3RhdGUgPSBnZXREZWZhdWx0U3RhdGUoREVGQVVMVF9TVEFURSwgX3RoaXMucHJvcHMucmVzdWx0cyk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoSW1wb3J0VmlldywgW3sKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdGhpcy5sb2FkSW5kZXhOYW1lcygpOwogICAgICB0aGlzLmxvYWRJbmRleFBhdHRlcm5OYW1lcygpOwogICAgfQogIH0sIHsKICAgIGtleTogImltcG9ydCIsCiAgICAvLyBUT0RPIC0gc29ydCB0aGlzIGZ1bmN0aW9uIG91dC4gaXQncyBhIG1lc3MKICAgIHZhbHVlOiBmdW5jdGlvbiBfaW1wb3J0KCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyRwcm9wcywgZmlsZUNvbnRlbnRzLCByZXN1bHRzLCBpbmRleFBhdHRlcm5zLCBraWJhbmFDb25maWcsIHNob3dCb3R0b21CYXIsIGZvcm1hdCwgdGltZUZpZWxkTmFtZSwgX3RoaXMkc3RhdGUyLCBpbmRleCwgaW5kZXhQYXR0ZXJuLCBjcmVhdGVJbmRleFBhdHRlcm4sIGluZGV4U2V0dGluZ3NTdHJpbmcsIG1hcHBpbmdzU3RyaW5nLCBwaXBlbGluZVN0cmluZywgZXJyb3JzOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfaW1wb3J0JChfY29udGV4dDMpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpcyRwcm9wcyA9IHRoaXMucHJvcHMsIGZpbGVDb250ZW50cyA9IF90aGlzJHByb3BzLmZpbGVDb250ZW50cywgcmVzdWx0cyA9IF90aGlzJHByb3BzLnJlc3VsdHMsIGluZGV4UGF0dGVybnMgPSBfdGhpcyRwcm9wcy5pbmRleFBhdHRlcm5zLCBraWJhbmFDb25maWcgPSBfdGhpcyRwcm9wcy5raWJhbmFDb25maWcsIHNob3dCb3R0b21CYXIgPSBfdGhpcyRwcm9wcy5zaG93Qm90dG9tQmFyOwogICAgICAgICAgICAgIGZvcm1hdCA9IHJlc3VsdHMuZm9ybWF0OwogICAgICAgICAgICAgIHRpbWVGaWVsZE5hbWUgPSB0aGlzLnN0YXRlLnRpbWVGaWVsZE5hbWU7CiAgICAgICAgICAgICAgX3RoaXMkc3RhdGUyID0gdGhpcy5zdGF0ZSwgaW5kZXggPSBfdGhpcyRzdGF0ZTIuaW5kZXgsIGluZGV4UGF0dGVybiA9IF90aGlzJHN0YXRlMi5pbmRleFBhdHRlcm4sIGNyZWF0ZUluZGV4UGF0dGVybiA9IF90aGlzJHN0YXRlMi5jcmVhdGVJbmRleFBhdHRlcm4sIGluZGV4U2V0dGluZ3NTdHJpbmcgPSBfdGhpcyRzdGF0ZTIuaW5kZXhTZXR0aW5nc1N0cmluZywgbWFwcGluZ3NTdHJpbmcgPSBfdGhpcyRzdGF0ZTIubWFwcGluZ3NTdHJpbmcsIHBpcGVsaW5lU3RyaW5nID0gX3RoaXMkc3RhdGUyLnBpcGVsaW5lU3RyaW5nOwogICAgICAgICAgICAgIGVycm9ycyA9IFtdOwoKICAgICAgICAgICAgICBpZiAoaW5kZXggIT09ICcnKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgaW1wb3J0aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKCgwLCBfdXRpbHMuaGFzSW1wb3J0UGVybWlzc2lvbikoaW5kZXgpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoX2NvbnRleHQyLnQwID09PSBmYWxzZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1sLmZpbGVEYXRhdmlzdWFsaXplci5pbXBvcnRWaWV3LmltcG9ydFBlcm1pc3Npb25FcnJvcicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gY3JlYXRlIG9yIGltcG9ydCBkYXRhIGludG8gaW5kZXgge2luZGV4fS4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25DaGVja1N0YXR1czogX2ltcG9ydF9wcm9ncmVzcy5JTVBPUlRfU1RBVFVTLkZBSUxFRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGluZzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRlZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGVkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25DaGVja1N0YXR1czogX2ltcG9ydF9wcm9ncmVzcy5JTVBPUlRfU1RBVFVTLkNPTVBMRVRFCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnByb3BzLmhpZGVCb3R0b21CYXIoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzLCBjcmVhdGVQaXBlbGluZSwgc2V0dGluZ3MsIG1hcHBpbmdzLCBwaXBlbGluZSwgcGFyc2VFcnJvciwgX3BhcnNlRXJyb3IsIGluZGV4Q3JlYXRpb25TZXR0aW5ncywgX3BhcnNlRXJyb3IyLCBpbXBvcnRlciwgcmVhZFJlc3AsIGluaXRpYWxpemVJbXBvcnRSZXNwLCBpbmRleENyZWF0ZWQsIHBpcGVsaW5lQ3JlYXRlZCwgaW1wb3J0SWQsIHBpcGVsaW5lSWQsIGltcG9ydFJlc3AsIGluZGV4UGF0dGVybk5hbWUsIGluZGV4UGF0dGVyblJlc3A7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVBpcGVsaW5lID0gcGlwZWxpbmVTdHJpbmcgIT09ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZ3MgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXBlbGluZSA9IHt9OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBKU09OLnBhcnNlKGluZGV4U2V0dGluZ3NTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUVycm9yID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1sLmZpbGVEYXRhdmlzdWFsaXplci5pbXBvcnRWaWV3LnBhcnNlU2V0dGluZ3NFcnJvcicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFcnJvciBwYXJzaW5nIHNldHRpbmdzOicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goIiIuY29uY2F0KHBhcnNlRXJyb3IsICIgIikuY29uY2F0KGVycm9yLm1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5ncyA9IEpTT04ucGFyc2UobWFwcGluZ3NTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGFyc2VFcnJvciA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tbC5maWxlRGF0YXZpc3VhbGl6ZXIuaW1wb3J0Vmlldy5wYXJzZU1hcHBpbmdzRXJyb3InLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXJyb3IgcGFyc2luZyBtYXBwaW5nczonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKCIiLmNvbmNhdChfcGFyc2VFcnJvciwgIiAiKS5jb25jYXQoZXJyb3IubWVzc2FnZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhDcmVhdGlvblNldHRpbmdzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHNldHRpbmdzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZ3M6IG1hcHBpbmdzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjcmVhdGVQaXBlbGluZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaXBlbGluZSA9IEpTT04ucGFyc2UocGlwZWxpbmVTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleENyZWF0aW9uU2V0dGluZ3MucGlwZWxpbmUgPSBwaXBlbGluZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3BhcnNlRXJyb3IyID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1sLmZpbGVEYXRhdmlzdWFsaXplci5pbXBvcnRWaWV3LnBhcnNlUGlwZWxpbmVFcnJvcicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFcnJvciBwYXJzaW5nIGluZ2VzdCBwaXBlbGluZTonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKCIiLmNvbmNhdChfcGFyc2VFcnJvcjIsICIgIikuY29uY2F0KGVycm9yLm1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUpTT05TdGF0dXM6IHN1Y2Nlc3MgPyBfaW1wb3J0X3Byb2dyZXNzLklNUE9SVF9TVEFUVVMuQ09NUExFVEUgOiBfaW1wb3J0X3Byb2dyZXNzLklNUE9SVF9TVEFUVVMuRkFJTEVECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7IC8vIGlmIGFuIEB0aW1lc3RhbXAgZmllbGQgaGFzIGJlZW4gYWRkZWQgdG8gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFwcGluZ3MsIHVzZSB0aGlzIGZpZWxkIGFzIHRoZSB0aW1lIGZpZWxkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVsaWVzIG9uIHRoZSBmaWVsZCBiZWluZyBwb3B1bGF0ZWQgYnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaW5nZXN0IHBpcGVsaW5lIG9uIGluZ2VzdAoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcHBpbmdzW0RFRkFVTFRfVElNRV9GSUVMRF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZUZpZWxkTmFtZSA9IERFRkFVTFRfVElNRV9GSUVMRDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lRmllbGROYW1lOiB0aW1lRmllbGROYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDUwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRlciA9ICgwLCBfaW1wb3J0ZXIuaW1wb3J0ZXJGYWN0b3J5KShmb3JtYXQsIHJlc3VsdHMsIGluZGV4Q3JlYXRpb25TZXR0aW5ncyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGltcG9ydGVyICE9PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGltcG9ydGVyLnJlYWQoZmlsZUNvbnRlbnRzLCBfdGhpczIuc2V0UmVhZFByb2dyZXNzKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRSZXNwID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gcmVhZFJlc3Auc3VjY2VzczsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRTdGF0dXM6IHN1Y2Nlc3MgPyBfaW1wb3J0X3Byb2dyZXNzLklNUE9SVF9TVEFUVVMuQ09NUExFVEUgOiBfaW1wb3J0X3Byb2dyZXNzLklNUE9SVF9TVEFUVVMuRkFJTEVELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGluZzogZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWRSZXNwLnN1Y2Nlc3MgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlYWRSZXNwLmVycm9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKHJlYWRSZXNwLmVycm9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDUwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChpbXBvcnRlci5pbml0aWFsaXplSW1wb3J0KGluZGV4KSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVJbXBvcnRSZXNwID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleENyZWF0ZWQgPSBpbml0aWFsaXplSW1wb3J0UmVzcC5pbmRleCAhPT0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhDcmVhdGVkU3RhdHVzOiBpbmRleENyZWF0ZWQgPyBfaW1wb3J0X3Byb2dyZXNzLklNUE9SVF9TVEFUVVMuQ09NUExFVEUgOiBfaW1wb3J0X3Byb2dyZXNzLklNUE9SVF9TVEFUVVMuRkFJTEVECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjcmVhdGVQaXBlbGluZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlwZWxpbmVDcmVhdGVkID0gaW5pdGlhbGl6ZUltcG9ydFJlc3AucGlwZWxpbmVJZCAhPT0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleENyZWF0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmdlc3RQaXBlbGluZUNyZWF0ZWRTdGF0dXM6IHBpcGVsaW5lQ3JlYXRlZCA/IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5DT01QTEVURSA6IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5GQUlMRUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5nZXN0UGlwZWxpbmVJZDogcGlwZWxpbmVDcmVhdGVkID8gaW5pdGlhbGl6ZUltcG9ydFJlc3AucGlwZWxpbmVJZCA6ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBpbmRleENyZWF0ZWQgJiYgcGlwZWxpbmVDcmVhdGVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gaW5kZXhDcmVhdGVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydElkID0gaW5pdGlhbGl6ZUltcG9ydFJlc3AuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlwZWxpbmVJZCA9IGluaXRpYWxpemVJbXBvcnRSZXNwLnBpcGVsaW5lSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoaW1wb3J0ZXIuaW1wb3J0KGltcG9ydElkLCBpbmRleCwgcGlwZWxpbmVJZCwgX3RoaXMyLnNldEltcG9ydFByb2dyZXNzKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydFJlc3AgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBpbXBvcnRSZXNwLnN1Y2Nlc3M7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRTdGF0dXM6IGltcG9ydFJlc3Auc3VjY2VzcyA/IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5DT01QTEVURSA6IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5GQUlMRUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRGYWlsdXJlczogaW1wb3J0UmVzcC5mYWlsdXJlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY0NvdW50OiBpbXBvcnRSZXNwLmRvY0NvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNyZWF0ZUluZGV4UGF0dGVybikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm5OYW1lID0gaW5kZXhQYXR0ZXJuID09PSAnJyA/IGluZGV4IDogaW5kZXhQYXR0ZXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0MDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGNyZWF0ZUtpYmFuYUluZGV4UGF0dGVybihpbmRleFBhdHRlcm5OYW1lLCBpbmRleFBhdHRlcm5zLCB0aW1lRmllbGROYW1lLCBraWJhbmFDb25maWcpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuUmVzcCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGluZGV4UGF0dGVyblJlc3Auc3VjY2VzczsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybkNyZWF0ZWRTdGF0dXM6IGluZGV4UGF0dGVyblJlc3Auc3VjY2VzcyA/IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5DT01QTEVURSA6IF9pbXBvcnRfcHJvZ3Jlc3MuSU1QT1JUX1NUQVRVUy5GQUlMRUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm5JZDogaW5kZXhQYXR0ZXJuUmVzcC5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhQYXR0ZXJuUmVzcC5zdWNjZXNzID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goaW5kZXhQYXR0ZXJuUmVzcC5lcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0NDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKGltcG9ydFJlc3AuZXJyb3IpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0NzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKGluaXRpYWxpemVJbXBvcnRSZXNwLmVycm9yKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0JvdHRvbUJhcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0aW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGVkOiBzdWNjZXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJvcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNTI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAibG9hZEluZGV4TmFtZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRJbmRleE5hbWVzKCkgewogICAgICB2YXIgaW5kaWNlcywgaW5kZXhOYW1lczsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBsb2FkSW5kZXhOYW1lcyQoX2NvbnRleHQ0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX21sX2FwaV9zZXJ2aWNlLm1sLmdldEluZGljZXMoKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgaW5kaWNlcyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgIGluZGV4TmFtZXMgPSBpbmRpY2VzLm1hcChmdW5jdGlvbiAoaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGkubmFtZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGluZGV4TmFtZXM6IGluZGV4TmFtZXMKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImxvYWRJbmRleFBhdHRlcm5OYW1lcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZEluZGV4UGF0dGVybk5hbWVzKCkgewogICAgICB2YXIgaW5kZXhQYXR0ZXJuTmFtZXM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gbG9hZEluZGV4UGF0dGVybk5hbWVzJChfY29udGV4dDUpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2luZGV4X3V0aWxzLmxvYWRJbmRleFBhdHRlcm5zKSh0aGlzLnByb3BzLmluZGV4UGF0dGVybnMpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpbmRleFBhdHRlcm5OYW1lcyA9ICgwLCBfaW5kZXhfdXRpbHMuZ2V0SW5kZXhQYXR0ZXJuTmFtZXMpKCk7CiAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm5OYW1lczogaW5kZXhQYXR0ZXJuTmFtZXMKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUzID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGluZGV4ID0gX3RoaXMkc3RhdGUzLmluZGV4LAogICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX3RoaXMkc3RhdGUzLmluZGV4UGF0dGVybiwKICAgICAgICAgIGluZGV4UGF0dGVybklkID0gX3RoaXMkc3RhdGUzLmluZGV4UGF0dGVybklkLAogICAgICAgICAgaW5nZXN0UGlwZWxpbmVJZCA9IF90aGlzJHN0YXRlMy5pbmdlc3RQaXBlbGluZUlkLAogICAgICAgICAgaW1wb3J0aW5nID0gX3RoaXMkc3RhdGUzLmltcG9ydGluZywKICAgICAgICAgIGltcG9ydGVkID0gX3RoaXMkc3RhdGUzLmltcG9ydGVkLAogICAgICAgICAgcmVhZGluZyA9IF90aGlzJHN0YXRlMy5yZWFkaW5nLAogICAgICAgICAgaW5pdGlhbGl6ZWQgPSBfdGhpcyRzdGF0ZTMuaW5pdGlhbGl6ZWQsCiAgICAgICAgICByZWFkU3RhdHVzID0gX3RoaXMkc3RhdGUzLnJlYWRTdGF0dXMsCiAgICAgICAgICBwYXJzZUpTT05TdGF0dXMgPSBfdGhpcyRzdGF0ZTMucGFyc2VKU09OU3RhdHVzLAogICAgICAgICAgaW5kZXhDcmVhdGVkU3RhdHVzID0gX3RoaXMkc3RhdGUzLmluZGV4Q3JlYXRlZFN0YXR1cywKICAgICAgICAgIGluZ2VzdFBpcGVsaW5lQ3JlYXRlZFN0YXR1cyA9IF90aGlzJHN0YXRlMy5pbmdlc3RQaXBlbGluZUNyZWF0ZWRTdGF0dXMsCiAgICAgICAgICBpbmRleFBhdHRlcm5DcmVhdGVkU3RhdHVzID0gX3RoaXMkc3RhdGUzLmluZGV4UGF0dGVybkNyZWF0ZWRTdGF0dXMsCiAgICAgICAgICBwZXJtaXNzaW9uQ2hlY2tTdGF0dXMgPSBfdGhpcyRzdGF0ZTMucGVybWlzc2lvbkNoZWNrU3RhdHVzLAogICAgICAgICAgdXBsb2FkUHJvZ3Jlc3MgPSBfdGhpcyRzdGF0ZTMudXBsb2FkUHJvZ3Jlc3MsCiAgICAgICAgICB1cGxvYWRTdGF0dXMgPSBfdGhpcyRzdGF0ZTMudXBsb2FkU3RhdHVzLAogICAgICAgICAgY3JlYXRlSW5kZXhQYXR0ZXJuID0gX3RoaXMkc3RhdGUzLmNyZWF0ZUluZGV4UGF0dGVybiwKICAgICAgICAgIGVycm9ycyA9IF90aGlzJHN0YXRlMy5lcnJvcnMsCiAgICAgICAgICBkb2NDb3VudCA9IF90aGlzJHN0YXRlMy5kb2NDb3VudCwKICAgICAgICAgIGltcG9ydEZhaWx1cmVzID0gX3RoaXMkc3RhdGUzLmltcG9ydEZhaWx1cmVzLAogICAgICAgICAgaW5kZXhTZXR0aW5nc1N0cmluZyA9IF90aGlzJHN0YXRlMy5pbmRleFNldHRpbmdzU3RyaW5nLAogICAgICAgICAgbWFwcGluZ3NTdHJpbmcgPSBfdGhpcyRzdGF0ZTMubWFwcGluZ3NTdHJpbmcsCiAgICAgICAgICBwaXBlbGluZVN0cmluZyA9IF90aGlzJHN0YXRlMy5waXBlbGluZVN0cmluZywKICAgICAgICAgIGluZGV4TmFtZUVycm9yID0gX3RoaXMkc3RhdGUzLmluZGV4TmFtZUVycm9yLAogICAgICAgICAgaW5kZXhQYXR0ZXJuTmFtZUVycm9yID0gX3RoaXMkc3RhdGUzLmluZGV4UGF0dGVybk5hbWVFcnJvciwKICAgICAgICAgIHRpbWVGaWVsZE5hbWUgPSBfdGhpcyRzdGF0ZTMudGltZUZpZWxkTmFtZTsKICAgICAgdmFyIGNyZWF0ZVBpcGVsaW5lID0gcGlwZWxpbmVTdHJpbmcgIT09ICcnOwogICAgICB2YXIgc3RhdHVzZXMgPSB7CiAgICAgICAgcmVhZGluZzogcmVhZGluZywKICAgICAgICByZWFkU3RhdHVzOiByZWFkU3RhdHVzLAogICAgICAgIHBhcnNlSlNPTlN0YXR1czogcGFyc2VKU09OU3RhdHVzLAogICAgICAgIGluZGV4Q3JlYXRlZFN0YXR1czogaW5kZXhDcmVhdGVkU3RhdHVzLAogICAgICAgIGluZ2VzdFBpcGVsaW5lQ3JlYXRlZFN0YXR1czogaW5nZXN0UGlwZWxpbmVDcmVhdGVkU3RhdHVzLAogICAgICAgIGluZGV4UGF0dGVybkNyZWF0ZWRTdGF0dXM6IGluZGV4UGF0dGVybkNyZWF0ZWRTdGF0dXMsCiAgICAgICAgcGVybWlzc2lvbkNoZWNrU3RhdHVzOiBwZXJtaXNzaW9uQ2hlY2tTdGF0dXMsCiAgICAgICAgdXBsb2FkUHJvZ3Jlc3M6IHVwbG9hZFByb2dyZXNzLAogICAgICAgIHVwbG9hZFN0YXR1czogdXBsb2FkU3RhdHVzLAogICAgICAgIGNyZWF0ZUluZGV4UGF0dGVybjogY3JlYXRlSW5kZXhQYXR0ZXJuLAogICAgICAgIGNyZWF0ZVBpcGVsaW5lOiBjcmVhdGVQaXBlbGluZQogICAgICB9OwogICAgICB2YXIgZGlzYWJsZUltcG9ydCA9IGluZGV4ID09PSAnJyB8fCBpbmRleE5hbWVFcnJvciAhPT0gJycgfHwgY3JlYXRlSW5kZXhQYXR0ZXJuID09PSB0cnVlICYmIGluZGV4UGF0dGVybk5hbWVFcnJvciAhPT0gJycgfHwgaW5pdGlhbGl6ZWQgPT09IHRydWU7CiAgICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFuZWwsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIHsKICAgICAgICBzaXplOiAicyIKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgzIiwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLm1sLmZpbGVEYXRhdmlzdWFsaXplci5pbXBvcnRWaWV3LmltcG9ydERhdGFUaXRsZSIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJbXBvcnQgZGF0YSIKICAgICAgfSksICJceEEwIiwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V4cGVyaW1lbnRhbF9iYWRnZS5FeHBlcmltZW50YWxCYWRnZSwgewogICAgICAgIHRvb2x0aXBDb250ZW50OiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5tbC5maWxlRGF0YXZpc3VhbGl6ZXIuaW1wb3J0Vmlldy5leHBlcmltZW50YWxGZWF0dXJlVG9vbHRpcCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkV4cGVyaW1lbnRhbCBmZWF0dXJlLiBXZSdkIGxvdmUgdG8gaGVhciB5b3VyIGZlZWRiYWNrLiIKICAgICAgICB9KQogICAgICB9KSkpLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfaW1wb3J0X3NldHRpbmdzLkltcG9ydFNldHRpbmdzLCB7CiAgICAgICAgaW5kZXg6IGluZGV4LAogICAgICAgIGluZGV4UGF0dGVybjogaW5kZXhQYXR0ZXJuLAogICAgICAgIGluaXRpYWxpemVkOiBpbml0aWFsaXplZCwKICAgICAgICBvbkluZGV4Q2hhbmdlOiB0aGlzLm9uSW5kZXhDaGFuZ2UsCiAgICAgICAgY3JlYXRlSW5kZXhQYXR0ZXJuOiBjcmVhdGVJbmRleFBhdHRlcm4sCiAgICAgICAgb25DcmVhdGVJbmRleFBhdHRlcm5DaGFuZ2U6IHRoaXMub25DcmVhdGVJbmRleFBhdHRlcm5DaGFuZ2UsCiAgICAgICAgb25JbmRleFBhdHRlcm5DaGFuZ2U6IHRoaXMub25JbmRleFBhdHRlcm5DaGFuZ2UsCiAgICAgICAgaW5kZXhTZXR0aW5nc1N0cmluZzogaW5kZXhTZXR0aW5nc1N0cmluZywKICAgICAgICBtYXBwaW5nc1N0cmluZzogbWFwcGluZ3NTdHJpbmcsCiAgICAgICAgcGlwZWxpbmVTdHJpbmc6IHBpcGVsaW5lU3RyaW5nLAogICAgICAgIG9uSW5kZXhTZXR0aW5nc1N0cmluZ0NoYW5nZTogdGhpcy5vbkluZGV4U2V0dGluZ3NTdHJpbmdDaGFuZ2UsCiAgICAgICAgb25NYXBwaW5nc1N0cmluZ0NoYW5nZTogdGhpcy5vbk1hcHBpbmdzU3RyaW5nQ2hhbmdlLAogICAgICAgIG9uUGlwZWxpbmVTdHJpbmdDaGFuZ2U6IHRoaXMub25QaXBlbGluZVN0cmluZ0NoYW5nZSwKICAgICAgICBpbmRleE5hbWVFcnJvcjogaW5kZXhOYW1lRXJyb3IsCiAgICAgICAgaW5kZXhQYXR0ZXJuTmFtZUVycm9yOiBpbmRleFBhdHRlcm5OYW1lRXJyb3IKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCAoaW5pdGlhbGl6ZWQgPT09IGZhbHNlIHx8IGltcG9ydGluZyA9PT0gdHJ1ZSkgJiYgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICBpc0Rpc2FibGVkOiBkaXNhYmxlSW1wb3J0LAogICAgICAgIG9uQ2xpY2s6IHRoaXMuY2xpY2tJbXBvcnQsCiAgICAgICAgaXNMb2FkaW5nOiBpbXBvcnRpbmcsCiAgICAgICAgaWNvblNpZGU6ICJyaWdodCIsCiAgICAgICAgZmlsbDogdHJ1ZQogICAgICB9LCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAieHBhY2subWwuZmlsZURhdGF2aXN1YWxpemVyLmltcG9ydFZpZXcuaW1wb3J0QnV0dG9uTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW1wb3J0IgogICAgICB9KSksIGluaXRpYWxpemVkID09PSB0cnVlICYmIGltcG9ydGluZyA9PT0gZmFsc2UgJiYgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICBvbkNsaWNrOiB0aGlzLmNsaWNrUmVzZXQKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLm1sLmZpbGVEYXRhdmlzdWFsaXplci5pbXBvcnRWaWV3LnJlc2V0QnV0dG9uTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUmVzZXQiCiAgICAgIH0pKSksIGluaXRpYWxpemVkID09PSB0cnVlICYmIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFuZWwsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9pbXBvcnRfcHJvZ3Jlc3MuSW1wb3J0UHJvZ3Jlc3MsIHsKICAgICAgICBzdGF0dXNlczogc3RhdHVzZXMKICAgICAgfSksIGltcG9ydGVkID09PSB0cnVlICYmIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9pbXBvcnRfc3VtbWFyeS5JbXBvcnRTdW1tYXJ5LCB7CiAgICAgICAgaW5kZXg6IGluZGV4LAogICAgICAgIGluZGV4UGF0dGVybjogaW5kZXhQYXR0ZXJuID09PSAnJyA/IGluZGV4IDogaW5kZXhQYXR0ZXJuLAogICAgICAgIGluZ2VzdFBpcGVsaW5lSWQ6IGluZ2VzdFBpcGVsaW5lSWQsCiAgICAgICAgZG9jQ291bnQ6IGRvY0NvdW50LAogICAgICAgIGltcG9ydEZhaWx1cmVzOiBpbXBvcnRGYWlsdXJlcywKICAgICAgICBjcmVhdGVJbmRleFBhdHRlcm46IGNyZWF0ZUluZGV4UGF0dGVybiwKICAgICAgICBjcmVhdGVQaXBlbGluZTogY3JlYXRlUGlwZWxpbmUKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogImwiCiAgICAgIH0pLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVzdWx0c19saW5rcy5SZXN1bHRzTGlua3MsIHsKICAgICAgICBpbmRleDogaW5kZXgsCiAgICAgICAgaW5kZXhQYXR0ZXJuSWQ6IGluZGV4UGF0dGVybklkLAogICAgICAgIHRpbWVGaWVsZE5hbWU6IHRpbWVGaWVsZE5hbWUsCiAgICAgICAgY3JlYXRlSW5kZXhQYXR0ZXJuOiBjcmVhdGVJbmRleFBhdHRlcm4KICAgICAgfSkpKSksIGVycm9ycy5sZW5ndGggPiAwICYmIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9pbXBvcnRfZXJyb3JzLkltcG9ydEVycm9ycywgewogICAgICAgIGVycm9yczogZXJyb3JzLAogICAgICAgIHN0YXR1c2VzOiBzdGF0dXNlcwogICAgICB9KSkpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEltcG9ydFZpZXc7Cn0oX3JlYWN0Mi5Db21wb25lbnQpOwoKZXhwb3J0cy5JbXBvcnRWaWV3ID0gSW1wb3J0VmlldzsKCmZ1bmN0aW9uIGNyZWF0ZUtpYmFuYUluZGV4UGF0dGVybihpbmRleFBhdHRlcm5OYW1lLCBpbmRleFBhdHRlcm5zLCB0aW1lRmllbGROYW1lLCBraWJhbmFDb25maWcpIHsKICB2YXIgZW1wdHlQYXR0ZXJuLCBpZDsKICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGNyZWF0ZUtpYmFuYUluZGV4UGF0dGVybiQoX2NvbnRleHQ2KSB7CiAgICB3aGlsZSAoMSkgewogICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBfY29udGV4dDYucHJldiA9IDA7CiAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM7CiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGluZGV4UGF0dGVybnMubWFrZSgpKTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgICAgZW1wdHlQYXR0ZXJuID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICBPYmplY3QuYXNzaWduKGVtcHR5UGF0dGVybiwgewogICAgICAgICAgICBpZDogJycsCiAgICAgICAgICAgIHRpdGxlOiBpbmRleFBhdHRlcm5OYW1lLAogICAgICAgICAgICB0aW1lRmllbGROYW1lOiB0aW1lRmllbGROYW1lCiAgICAgICAgICB9KTsKICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNzsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoZW1wdHlQYXR0ZXJuLmNyZWF0ZSgpKTsKCiAgICAgICAgY2FzZSA3OgogICAgICAgICAgaWQgPSBfY29udGV4dDYuc2VudDsKCiAgICAgICAgICBpZiAoa2liYW5hQ29uZmlnLmdldCgnZGVmYXVsdEluZGV4JykpIHsKICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMTsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoa2liYW5hQ29uZmlnLnNldCgnZGVmYXVsdEluZGV4JywgaWQpKTsKCiAgICAgICAgY2FzZSAxMToKICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgICAgICAgIGlkOiBpZAogICAgICAgICAgfSk7CgogICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICBfY29udGV4dDYucHJldiA9IDE0OwogICAgICAgICAgX2NvbnRleHQ2LnQwID0gX2NvbnRleHQ2WyJjYXRjaCJdKDApOwogICAgICAgICAgY29uc29sZS5lcnJvcihfY29udGV4dDYudDApOwogICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsCiAgICAgICAgICAgIGVycm9yOiBfY29udGV4dDYudDAKICAgICAgICAgIH0pOwoKICAgICAgICBjYXNlIDE4OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgfQogICAgfQogIH0sIG51bGwsIG51bGwsIFtbMCwgMTRdXSk7Cn0KCmZ1bmN0aW9uIGdldERlZmF1bHRTdGF0ZShzdGF0ZSwgcmVzdWx0cykgewogIHZhciBpbmRleFNldHRpbmdzU3RyaW5nID0gc3RhdGUuaW5kZXhTZXR0aW5nc1N0cmluZyA9PT0gJycgPyBKU09OLnN0cmluZ2lmeShERUZBVUxUX0lOREVYX1NFVFRJTkdTLCBudWxsLCAyKSA6IHN0YXRlLmluZGV4U2V0dGluZ3NTdHJpbmc7CiAgdmFyIG1hcHBpbmdzU3RyaW5nID0gc3RhdGUubWFwcGluZ3NTdHJpbmcgPT09ICcnID8gSlNPTi5zdHJpbmdpZnkocmVzdWx0cy5tYXBwaW5ncywgbnVsbCwgMikgOiBzdGF0ZS5tYXBwaW5nc1N0cmluZzsKICB2YXIgcGlwZWxpbmVTdHJpbmcgPSBzdGF0ZS5waXBlbGluZVN0cmluZyA9PT0gJycgJiYgcmVzdWx0cy5pbmdlc3RfcGlwZWxpbmUgIT09IHVuZGVmaW5lZCA/IEpTT04uc3RyaW5naWZ5KHJlc3VsdHMuaW5nZXN0X3BpcGVsaW5lLCBudWxsLCAyKSA6IHN0YXRlLnBpcGVsaW5lU3RyaW5nOwogIHZhciB0aW1lRmllbGROYW1lID0gcmVzdWx0cy50aW1lc3RhbXBfZmllbGQ7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIERFRkFVTFRfU1RBVEUsIHsKICAgIGluZGV4U2V0dGluZ3NTdHJpbmc6IGluZGV4U2V0dGluZ3NTdHJpbmcsCiAgICBtYXBwaW5nc1N0cmluZzogbWFwcGluZ3NTdHJpbmcsCiAgICBwaXBlbGluZVN0cmluZzogcGlwZWxpbmVTdHJpbmcsCiAgICB0aW1lRmllbGROYW1lOiB0aW1lRmllbGROYW1lCiAgfSk7Cn0KCmZ1bmN0aW9uIGlzSW5kZXhOYW1lVmFsaWQobmFtZSwgaW5kZXhOYW1lcykgewogIGlmIChpbmRleE5hbWVzLmZpbmQoZnVuY3Rpb24gKGkpIHsKICAgIHJldHVybiBpID09PSBuYW1lOwogIH0pKSB7CiAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgaWQ6ICJ4cGFjay5tbC5maWxlRGF0YXZpc3VhbGl6ZXIuaW1wb3J0Vmlldy5pbmRleE5hbWVBbHJlYWR5RXhpc3RzRXJyb3JNZXNzYWdlIiwKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJbmRleCBuYW1lIGFscmVhZHkgZXhpc3RzIgogICAgfSk7CiAgfQoKICB2YXIgcmVnID0gbmV3IFJlZ0V4cCgnW1xcXFwvKj8iPD58XFxzLCNdKycpOwoKICBpZiAobmFtZSAhPT0gbmFtZS50b0xvd2VyQ2FzZSgpIHx8IC8vIG5hbWUgc2hvdWxkIGJlIGxvd2VyY2FzZQogIG5hbWUgPT09ICcuJyB8fCBuYW1lID09PSAnLi4nIHx8IC8vIG5hbWUgY2FuJ3QgYmUgLiBvciAuLgogIG5hbWUubWF0Y2goL15bLV8rXS8pICE9PSBudWxsIHx8IC8vIG5hbWUgY2FuJ3Qgc3RhcnQgd2l0aCB0aGVzZSBjaGFycwogIG5hbWUubWF0Y2gocmVnKSAhPT0gbnVsbCAvLyBuYW1lIGNhbid0IGNvbnRhaW4gdGhlc2UgY2hhcnMKICApIHsKICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5tbC5maWxlRGF0YXZpc3VhbGl6ZXIuaW1wb3J0Vmlldy5pbmRleE5hbWVDb250YWluc0lsbGVnYWxDaGFyYWN0ZXJzRXJyb3JNZXNzYWdlIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkluZGV4IG5hbWUgY29udGFpbnMgaWxsZWdhbCBjaGFyYWN0ZXJzIgogICAgICB9KTsKICAgIH0KCiAgcmV0dXJuICcnOwp9CgpmdW5jdGlvbiBpc0luZGV4UGF0dGVybk5hbWVWYWxpZChuYW1lLCBpbmRleFBhdHRlcm5OYW1lcywgaW5kZXgpIHsKICAvLyBpZiBhIGJsYW5rIG5hbWUgaXMgZW50ZXJlZCwgdGhlIGluZGV4IG5hbWUgd2lsbCBiZSB1c2VkIHNvIGF2b2lkIHZhbGlkYXRpb24KICBpZiAobmFtZSA9PT0gJycpIHsKICAgIHJldHVybiAnJzsKICB9CgogIGlmIChpbmRleFBhdHRlcm5OYW1lcy5maW5kKGZ1bmN0aW9uIChpKSB7CiAgICByZXR1cm4gaSA9PT0gbmFtZTsKICB9KSkgewogICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgIGlkOiAieHBhY2subWwuZmlsZURhdGF2aXN1YWxpemVyLmltcG9ydFZpZXcuaW5kZXhQYXR0ZXJuTmFtZUFscmVhZHlFeGlzdHNFcnJvck1lc3NhZ2UiLAogICAgICBkZWZhdWx0TWVzc2FnZTogIkluZGV4IHBhdHRlcm4gbmFtZSBhbHJlYWR5IGV4aXN0cyIKICAgIH0pOwogIH0gLy8gZXNjYXBlIC4gYW5kICsgdG8gc3RvcCB0aGUgcmVnZXggbWF0Y2hpbmcgbW9yZSB0aGFuIGl0IHNob3VsZC4KCgogIHZhciBuZXdOYW1lID0gbmFtZS5yZXBsYWNlKC9cLi9nLCAnXFwuJyk7CiAgbmV3TmFtZSA9IG5ld05hbWUucmVwbGFjZSgvXCsvZywgJ1xcKycpOyAvLyByZXBsYWNlICogd2l0aCAuKiB0byBtYWtlIHRoZSB3aWxkY2FyZCBtYXRjaCB3b3JrLgoKICBuZXdOYW1lID0gbmV3TmFtZS5yZXBsYWNlKC9cKi9nLCAnLionKTsKICB2YXIgcmVnID0gbmV3IFJlZ0V4cCgiXiIuY29uY2F0KG5ld05hbWUsICIkIikpOwoKICBpZiAoaW5kZXgubWF0Y2gocmVnKSA9PT0gbnVsbCkgewogICAgLy8gbmFtZSBzaG91bGQgbWF0Y2ggaW5kZXgKICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICBpZDogInhwYWNrLm1sLmZpbGVEYXRhdmlzdWFsaXplci5pbXBvcnRWaWV3LmluZGV4UGF0dGVybkRvZXNOb3RNYXRjaEluZGV4TmFtZUVycm9yTWVzc2FnZSIsCiAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW5kZXggcGF0dGVybiBkb2VzIG5vdCBtYXRjaCBpbmRleCBuYW1lIgogICAgfSk7CiAgfQoKICByZXR1cm4gJyc7Cn0="},null]}