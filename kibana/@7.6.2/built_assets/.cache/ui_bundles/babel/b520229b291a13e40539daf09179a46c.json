{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/layers/vector_layer.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/layers/vector_layer.js","mtime":1585205045317},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlZlY3RvckxheWVyID0gdm9pZCAwOwoKdmFyIF90dXJmID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ0dXJmIikpOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX2xheWVyID0gcmVxdWlyZSgiLi9sYXllciIpOwoKdmFyIF92ZWN0b3Jfc3R5bGUgPSByZXF1aXJlKCIuL3N0eWxlcy92ZWN0b3IvdmVjdG9yX3N0eWxlIik7Cgp2YXIgX2lubmVyX2pvaW4gPSByZXF1aXJlKCIuL2pvaW5zL2lubmVyX2pvaW4iKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vY29tbW9uL2NvbnN0YW50cyIpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfam9pbl90b29sdGlwX3Byb3BlcnR5ID0gcmVxdWlyZSgiLi90b29sdGlwcy9qb2luX3Rvb2x0aXBfcHJvcGVydHkiKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfZGF0YV9yZXF1ZXN0ID0gcmVxdWlyZSgiLi91dGlsL2RhdGFfcmVxdWVzdCIpOwoKdmFyIF9jYW5fc2tpcF9mZXRjaCA9IHJlcXVpcmUoIi4vdXRpbC9jYW5fc2tpcF9mZXRjaCIpOwoKdmFyIF9hc3NpZ25fZmVhdHVyZV9pZHMgPSByZXF1aXJlKCIuL3V0aWwvYXNzaWduX2ZlYXR1cmVfaWRzIik7Cgp2YXIgX21iX2ZpbHRlcl9leHByZXNzaW9ucyA9IHJlcXVpcmUoIi4vdXRpbC9tYl9maWx0ZXJfZXhwcmVzc2lvbnMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsgaWYgKHR5cGVvZiBSZWZsZWN0ICE9PSAidW5kZWZpbmVkIiAmJiBSZWZsZWN0LmdldCkgeyBfZ2V0ID0gUmVmbGVjdC5nZXQ7IH0gZWxzZSB7IF9nZXQgPSBmdW5jdGlvbiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyKSB7IHZhciBiYXNlID0gX3N1cGVyUHJvcEJhc2UodGFyZ2V0LCBwcm9wZXJ0eSk7IGlmICghYmFzZSkgcmV0dXJuOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkpOyBpZiAoZGVzYy5nZXQpIHsgcmV0dXJuIGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIpOyB9IHJldHVybiBkZXNjLnZhbHVlOyB9OyB9IHJldHVybiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyIHx8IHRhcmdldCk7IH0KCmZ1bmN0aW9uIF9zdXBlclByb3BCYXNlKG9iamVjdCwgcHJvcGVydHkpIHsgd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsgb2JqZWN0ID0gX2dldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChvYmplY3QgPT09IG51bGwpIGJyZWFrOyB9IHJldHVybiBvYmplY3Q7IH0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9Cgp2YXIgVmVjdG9yTGF5ZXIgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQWJzdHJhY3RMYXllcikgewogIF9pbmhlcml0cyhWZWN0b3JMYXllciwgX0Fic3RyYWN0TGF5ZXIpOwoKICBfY3JlYXRlQ2xhc3MoVmVjdG9yTGF5ZXIsIG51bGwsIFt7CiAgICBrZXk6ICJjcmVhdGVEZXNjcmlwdG9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVEZXNjcmlwdG9yKG9wdGlvbnMsIG1hcENvbG9ycykgewogICAgICB2YXIgbGF5ZXJEZXNjcmlwdG9yID0gX2dldChfZ2V0UHJvdG90eXBlT2YoVmVjdG9yTGF5ZXIpLCAiY3JlYXRlRGVzY3JpcHRvciIsIHRoaXMpLmNhbGwodGhpcywgb3B0aW9ucyk7CgogICAgICBsYXllckRlc2NyaXB0b3IudHlwZSA9IFZlY3RvckxheWVyLnR5cGU7CgogICAgICBpZiAoIW9wdGlvbnMuc3R5bGUpIHsKICAgICAgICB2YXIgc3R5bGVQcm9wZXJ0aWVzID0gX3ZlY3Rvcl9zdHlsZS5WZWN0b3JTdHlsZS5jcmVhdGVEZWZhdWx0U3R5bGVQcm9wZXJ0aWVzKG1hcENvbG9ycyk7CgogICAgICAgIGxheWVyRGVzY3JpcHRvci5zdHlsZSA9IF92ZWN0b3Jfc3R5bGUuVmVjdG9yU3R5bGUuY3JlYXRlRGVzY3JpcHRvcihzdHlsZVByb3BlcnRpZXMpOwogICAgICB9CgogICAgICByZXR1cm4gbGF5ZXJEZXNjcmlwdG9yOwogICAgfQogIH1dKTsKCiAgZnVuY3Rpb24gVmVjdG9yTGF5ZXIob3B0aW9ucykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBWZWN0b3JMYXllcik7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVmVjdG9yTGF5ZXIpLmNhbGwodGhpcywgb3B0aW9ucykpOwogICAgX3RoaXMuX2pvaW5zID0gW107CgogICAgaWYgKG9wdGlvbnMubGF5ZXJEZXNjcmlwdG9yLmpvaW5zKSB7CiAgICAgIG9wdGlvbnMubGF5ZXJEZXNjcmlwdG9yLmpvaW5zLmZvckVhY2goZnVuY3Rpb24gKGpvaW5EZXNjcmlwdG9yKSB7CiAgICAgICAgdmFyIGpvaW4gPSBuZXcgX2lubmVyX2pvaW4uSW5uZXJKb2luKGpvaW5EZXNjcmlwdG9yLCBfdGhpcy5fc291cmNlKTsKCiAgICAgICAgX3RoaXMuX2pvaW5zLnB1c2goam9pbik7CiAgICAgIH0pOwogICAgfQoKICAgIF90aGlzLl9zdHlsZSA9IG5ldyBfdmVjdG9yX3N0eWxlLlZlY3RvclN0eWxlKF90aGlzLl9kZXNjcmlwdG9yLnN0eWxlLCBfdGhpcy5fc291cmNlLCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoVmVjdG9yTGF5ZXIsIFt7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBpZiAodGhpcy5fc291cmNlKSB7CiAgICAgICAgdGhpcy5fc291cmNlLmRlc3Ryb3koKTsKICAgICAgfQoKICAgICAgdGhpcy5fam9pbnMuZm9yRWFjaChmdW5jdGlvbiAoam9pblNvdXJjZSkgewogICAgICAgIGpvaW5Tb3VyY2UuZGVzdHJveSgpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRKb2lucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Sm9pbnMoKSB7CiAgICAgIHJldHVybiB0aGlzLl9qb2lucy5zbGljZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZhbGlkSm9pbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZhbGlkSm9pbnMoKSB7CiAgICAgIHJldHVybiB0aGlzLl9qb2lucy5maWx0ZXIoZnVuY3Rpb24gKGpvaW4pIHsKICAgICAgICByZXR1cm4gam9pbi5oYXNDb21wbGV0ZUNvbmZpZygpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaGFzSm9pbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYXNKb2lucygpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsaWRKb2lucygpLmxlbmd0aCA+IDA7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNEYXRhTG9hZGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0RhdGFMb2FkZWQoKSB7CiAgICAgIHZhciBzb3VyY2VEYXRhUmVxdWVzdCA9IHRoaXMuZ2V0U291cmNlRGF0YVJlcXVlc3QoKTsKCiAgICAgIGlmICghc291cmNlRGF0YVJlcXVlc3QgfHwgIXNvdXJjZURhdGFSZXF1ZXN0Lmhhc0RhdGEoKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIGpvaW5zID0gdGhpcy5nZXRWYWxpZEpvaW5zKCk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGpvaW5EYXRhUmVxdWVzdCA9IHRoaXMuZ2V0RGF0YVJlcXVlc3Qoam9pbnNbaV0uZ2V0U291cmNlRGF0YVJlcXVlc3RJZCgpKTsKCiAgICAgICAgaWYgKCFqb2luRGF0YVJlcXVlc3QgfHwgIWpvaW5EYXRhUmVxdWVzdC5oYXNEYXRhKCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEN1c3RvbUljb25BbmRUb29sdGlwQ29udGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q3VzdG9tSWNvbkFuZFRvb2x0aXBDb250ZW50KCkgewogICAgICB2YXIgZmVhdHVyZUNvbGxlY3Rpb24gPSB0aGlzLl9nZXRTb3VyY2VGZWF0dXJlQ29sbGVjdGlvbigpOwoKICAgICAgdmFyIG5vUmVzdWx0c0ljb24gPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvbiwgewogICAgICAgIHNpemU6ICJtIiwKICAgICAgICBjb2xvcjogInN1YmR1ZWQiLAogICAgICAgIHR5cGU6ICJtaW51c0luQ2lyY2xlIgogICAgICB9KTsKCiAgICAgIGlmICghZmVhdHVyZUNvbGxlY3Rpb24gfHwgZmVhdHVyZUNvbGxlY3Rpb24uZmVhdHVyZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGljb246IG5vUmVzdWx0c0ljb24sCiAgICAgICAgICB0b29sdGlwQ29udGVudDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMudmVjdG9yTGF5ZXIubm9SZXN1bHRzRm91bmRUb29sdGlwJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk5vIHJlc3VsdHMgZm91bmQuIgogICAgICAgICAgfSkKICAgICAgICB9OwogICAgICB9CgogICAgICBpZiAodGhpcy5fam9pbnMubGVuZ3RoICYmICFmZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcy5zb21lKGZ1bmN0aW9uIChmZWF0dXJlKSB7CiAgICAgICAgcmV0dXJuIGZlYXR1cmUucHJvcGVydGllc1tfY29uc3RhbnRzLkZFQVRVUkVfVklTSUJMRV9QUk9QRVJUWV9OQU1FXTsKICAgICAgfSkpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaWNvbjogbm9SZXN1bHRzSWNvbiwKICAgICAgICAgIHRvb2x0aXBDb250ZW50OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy52ZWN0b3JMYXllci5ub1Jlc3VsdHNGb3VuZEluSm9pblRvb2x0aXAnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiTm8gbWF0Y2hpbmcgcmVzdWx0cyBmb3VuZCBpbiB0ZXJtIGpvaW5zIgogICAgICAgICAgfSkKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgc291cmNlRGF0YVJlcXVlc3QgPSB0aGlzLmdldFNvdXJjZURhdGFSZXF1ZXN0KCk7CgogICAgICB2YXIgX3RoaXMkX3NvdXJjZSRnZXRTb3VyID0gdGhpcy5fc291cmNlLmdldFNvdXJjZVRvb2x0aXBDb250ZW50KHNvdXJjZURhdGFSZXF1ZXN0KSwKICAgICAgICAgIHRvb2x0aXBDb250ZW50ID0gX3RoaXMkX3NvdXJjZSRnZXRTb3VyLnRvb2x0aXBDb250ZW50LAogICAgICAgICAgYXJlUmVzdWx0c1RyaW1tZWQgPSBfdGhpcyRfc291cmNlJGdldFNvdXIuYXJlUmVzdWx0c1RyaW1tZWQ7CgogICAgICByZXR1cm4gewogICAgICAgIGljb246IHRoaXMuX3N0eWxlLmdldEljb24oKSwKICAgICAgICB0b29sdGlwQ29udGVudDogdG9vbHRpcENvbnRlbnQsCiAgICAgICAgYXJlUmVzdWx0c1RyaW1tZWQ6IGFyZVJlc3VsdHNUcmltbWVkCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGF5ZXJUeXBlSWNvbk5hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExheWVyVHlwZUljb25OYW1lKCkgewogICAgICByZXR1cm4gJ3ZlY3Rvcic7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGFzTGVnZW5kRGV0YWlscyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFzTGVnZW5kRGV0YWlscygpIHsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBoYXNMZWdlbmREZXRhaWxzJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB0aGlzLl9zdHlsZS5oYXNMZWdlbmREZXRhaWxzKCkpOwoKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJMZWdlbmREZXRhaWxzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJMZWdlbmREZXRhaWxzKCkgewogICAgICByZXR1cm4gdGhpcy5fc3R5bGUucmVuZGVyTGVnZW5kRGV0YWlscygpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRCb3VuZHNCYXNlZE9uRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldEJvdW5kc0Jhc2VkT25EYXRhKCkgewogICAgICB2YXIgZmVhdHVyZUNvbGxlY3Rpb24gPSB0aGlzLl9nZXRTb3VyY2VGZWF0dXJlQ29sbGVjdGlvbigpOwoKICAgICAgaWYgKCFmZWF0dXJlQ29sbGVjdGlvbikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgdmlzaWJsZUZlYXR1cmVzID0gZmVhdHVyZUNvbGxlY3Rpb24uZmVhdHVyZXMuZmlsdGVyKGZ1bmN0aW9uIChmZWF0dXJlKSB7CiAgICAgICAgcmV0dXJuIGZlYXR1cmUucHJvcGVydGllc1tfY29uc3RhbnRzLkZFQVRVUkVfVklTSUJMRV9QUk9QRVJUWV9OQU1FXTsKICAgICAgfSk7CgogICAgICB2YXIgYmJveCA9IF90dXJmLmRlZmF1bHQuYmJveCh7CiAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywKICAgICAgICBmZWF0dXJlczogdmlzaWJsZUZlYXR1cmVzCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBtaW5fbG9uOiBiYm94WzBdLAogICAgICAgIG1pbl9sYXQ6IGJib3hbMV0sCiAgICAgICAgbWF4X2xvbjogYmJveFsyXSwKICAgICAgICBtYXhfbGF0OiBiYm94WzNdCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Qm91bmRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCb3VuZHMoZGF0YUZpbHRlcnMpIHsKICAgICAgdmFyIGlzU3RhdGljTGF5ZXIsIHNlYXJjaEZpbHRlcnM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZ2V0Qm91bmRzJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpc1N0YXRpY0xheWVyID0gIXRoaXMuX3NvdXJjZS5pc0JvdW5kc0F3YXJlKCkgfHwgIXRoaXMuX3NvdXJjZS5pc0ZpbHRlckJ5TWFwQm91bmRzKCk7CgogICAgICAgICAgICAgIGlmICghaXNTdGF0aWNMYXllcikgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdGhpcy5fZ2V0Qm91bmRzQmFzZWRPbkRhdGEoKSk7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgc2VhcmNoRmlsdGVycyA9IHRoaXMuX2dldFNlYXJjaEZpbHRlcnMoZGF0YUZpbHRlcnMpOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3NvdXJjZS5nZXRCb3VuZHNGb3JGaWx0ZXJzKHNlYXJjaEZpbHRlcnMpKTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQyLnNlbnQpOwoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGVmdEpvaW5GaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExlZnRKb2luRmllbGRzKCkgewogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGdldExlZnRKb2luRmllbGRzJChfY29udGV4dDMpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9zb3VyY2UuZ2V0TGVmdEpvaW5GaWVsZHMoKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0My5zZW50KTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFNvdXJjZU5hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNvdXJjZU5hbWUoKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZ2V0U291cmNlTmFtZSQoX2NvbnRleHQ0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHRoaXMuX3NvdXJjZS5nZXREaXNwbGF5TmFtZSgpKTsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRKb2luRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0Sm9pbkZpZWxkcygpIHsKICAgICAgdmFyIGpvaW5GaWVsZHMgPSBbXTsKICAgICAgdGhpcy5nZXRWYWxpZEpvaW5zKCkuZm9yRWFjaChmdW5jdGlvbiAoam9pbikgewogICAgICAgIHZhciBmaWVsZHMgPSBqb2luLmdldEpvaW5GaWVsZHMoKTsKICAgICAgICBqb2luRmllbGRzLnB1c2guYXBwbHkoam9pbkZpZWxkcywgX3RvQ29uc3VtYWJsZUFycmF5KGZpZWxkcykpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGpvaW5GaWVsZHM7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RGF0ZUZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGF0ZUZpZWxkcygpIHsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBnZXREYXRlRmllbGRzJChfY29udGV4dDUpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9zb3VyY2UuZ2V0RGF0ZUZpZWxkcygpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ1LnNlbnQpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TnVtYmVyRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXROdW1iZXJGaWVsZHMoKSB7CiAgICAgIHZhciBudW1iZXJGaWVsZE9wdGlvbnM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZ2V0TnVtYmVyRmllbGRzJChfY29udGV4dDYpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9zb3VyY2UuZ2V0TnVtYmVyRmllbGRzKCkpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIG51bWJlckZpZWxkT3B0aW9ucyA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KG51bWJlckZpZWxkT3B0aW9ucyksIF90b0NvbnN1bWFibGVBcnJheSh0aGlzLl9nZXRKb2luRmllbGRzKCkpKSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRDYXRlZ29yaWNhbEZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2F0ZWdvcmljYWxGaWVsZHMoKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZ2V0Q2F0ZWdvcmljYWxGaWVsZHMkKF9jb250ZXh0NykgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3NvdXJjZS5nZXRDYXRlZ29yaWNhbEZpZWxkcygpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ3LnNlbnQpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZHMoKSB7CiAgICAgIHZhciBzb3VyY2VGaWVsZHM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gZ2V0RmllbGRzJChfY29udGV4dDgpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9zb3VyY2UuZ2V0RmllbGRzKCkpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHNvdXJjZUZpZWxkcyA9IF9jb250ZXh0OC5zZW50OwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHNvdXJjZUZpZWxkcyksIF90b0NvbnN1bWFibGVBcnJheSh0aGlzLl9nZXRKb2luRmllbGRzKCkpKSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRJbmRleFBhdHRlcm5JZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEluZGV4UGF0dGVybklkcygpIHsKICAgICAgdmFyIGluZGV4UGF0dGVybklkcyA9IHRoaXMuX3NvdXJjZS5nZXRJbmRleFBhdHRlcm5JZHMoKTsKCiAgICAgIHRoaXMuZ2V0VmFsaWRKb2lucygpLmZvckVhY2goZnVuY3Rpb24gKGpvaW4pIHsKICAgICAgICBpbmRleFBhdHRlcm5JZHMucHVzaC5hcHBseShpbmRleFBhdHRlcm5JZHMsIF90b0NvbnN1bWFibGVBcnJheShqb2luLmdldEluZGV4UGF0dGVybklkcygpKSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gaW5kZXhQYXR0ZXJuSWRzOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFF1ZXJ5YWJsZUluZGV4UGF0dGVybklkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UXVlcnlhYmxlSW5kZXhQYXR0ZXJuSWRzKCkgewogICAgICB2YXIgaW5kZXhQYXR0ZXJuSWRzID0gdGhpcy5fc291cmNlLmdldFF1ZXJ5YWJsZUluZGV4UGF0dGVybklkcygpOwoKICAgICAgdGhpcy5nZXRWYWxpZEpvaW5zKCkuZm9yRWFjaChmdW5jdGlvbiAoam9pbikgewogICAgICAgIGluZGV4UGF0dGVybklkcy5wdXNoLmFwcGx5KGluZGV4UGF0dGVybklkcywgX3RvQ29uc3VtYWJsZUFycmF5KGpvaW4uZ2V0UXVlcnlhYmxlSW5kZXhQYXR0ZXJuSWRzKCkpKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBpbmRleFBhdHRlcm5JZHM7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2ZpbmREYXRhUmVxdWVzdEJ5SWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kRGF0YVJlcXVlc3RCeUlkKHNvdXJjZURhdGFJZCkgewogICAgICByZXR1cm4gdGhpcy5fZGF0YVJlcXVlc3RzLmZpbmQoZnVuY3Rpb24gKGRhdGFSZXF1ZXN0KSB7CiAgICAgICAgcmV0dXJuIGRhdGFSZXF1ZXN0LmdldERhdGFJZCgpID09PSBzb3VyY2VEYXRhSWQ7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zeW5jSm9pbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3N5bmNKb2luKF9yZWYpIHsKICAgICAgdmFyIGpvaW4sIHN0YXJ0TG9hZGluZywgc3RvcExvYWRpbmcsIG9uTG9hZEVycm9yLCByZWdpc3RlckNhbmNlbENhbGxiYWNrLCBkYXRhRmlsdGVycywgam9pblNvdXJjZSwgc291cmNlRGF0YUlkLCByZXF1ZXN0VG9rZW4sIHNlYXJjaEZpbHRlcnMsIHByZXZEYXRhUmVxdWVzdCwgY2FuU2tpcEZldGNoLCBsZWZ0U291cmNlTmFtZSwgX3JlZjIsIHByb3BlcnRpZXNNYXA7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9zeW5jSm9pbiQoX2NvbnRleHQ5KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgam9pbiA9IF9yZWYuam9pbiwgc3RhcnRMb2FkaW5nID0gX3JlZi5zdGFydExvYWRpbmcsIHN0b3BMb2FkaW5nID0gX3JlZi5zdG9wTG9hZGluZywgb25Mb2FkRXJyb3IgPSBfcmVmLm9uTG9hZEVycm9yLCByZWdpc3RlckNhbmNlbENhbGxiYWNrID0gX3JlZi5yZWdpc3RlckNhbmNlbENhbGxiYWNrLCBkYXRhRmlsdGVycyA9IF9yZWYuZGF0YUZpbHRlcnM7CiAgICAgICAgICAgICAgam9pblNvdXJjZSA9IGpvaW4uZ2V0UmlnaHRKb2luU291cmNlKCk7CiAgICAgICAgICAgICAgc291cmNlRGF0YUlkID0gam9pbi5nZXRTb3VyY2VEYXRhUmVxdWVzdElkKCk7CiAgICAgICAgICAgICAgcmVxdWVzdFRva2VuID0gU3ltYm9sKCJsYXllci1qb2luLXJlZnJlc2g6Ii5jb25jYXQodGhpcy5nZXRJZCgpLCAiIC0gIikuY29uY2F0KHNvdXJjZURhdGFJZCkpOwogICAgICAgICAgICAgIHNlYXJjaEZpbHRlcnMgPSBfb2JqZWN0U3ByZWFkKHt9LCBkYXRhRmlsdGVycywgewogICAgICAgICAgICAgICAgZmllbGROYW1lczogam9pblNvdXJjZS5nZXRGaWVsZE5hbWVzKCksCiAgICAgICAgICAgICAgICBzb3VyY2VRdWVyeTogam9pblNvdXJjZS5nZXRXaGVyZVF1ZXJ5KCksCiAgICAgICAgICAgICAgICBhcHBseUdsb2JhbFF1ZXJ5OiBqb2luU291cmNlLmdldEFwcGx5R2xvYmFsUXVlcnkoKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHByZXZEYXRhUmVxdWVzdCA9IHRoaXMuX2ZpbmREYXRhUmVxdWVzdEJ5SWQoc291cmNlRGF0YUlkKTsKICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDg7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2Nhbl9za2lwX2ZldGNoLmNhblNraXBTb3VyY2VVcGRhdGUpKHsKICAgICAgICAgICAgICAgIHNvdXJjZTogam9pblNvdXJjZSwKICAgICAgICAgICAgICAgIHByZXZEYXRhUmVxdWVzdDogcHJldkRhdGFSZXF1ZXN0LAogICAgICAgICAgICAgICAgbmV4dE1ldGE6IHNlYXJjaEZpbHRlcnMKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FuU2tpcEZldGNoID0gX2NvbnRleHQ5LnNlbnQ7CgogICAgICAgICAgICAgIGlmICghY2FuU2tpcEZldGNoKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDExOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgZGF0YUhhc0NoYW5nZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgam9pbjogam9pbiwKICAgICAgICAgICAgICAgIHByb3BlcnRpZXNNYXA6IHByZXZEYXRhUmVxdWVzdC5nZXREYXRhKCkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgX2NvbnRleHQ5LnByZXYgPSAxMTsKICAgICAgICAgICAgICBzdGFydExvYWRpbmcoc291cmNlRGF0YUlkLCByZXF1ZXN0VG9rZW4sIHNlYXJjaEZpbHRlcnMpOwogICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLmdldFNvdXJjZU5hbWUoKSk7CgogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIGxlZnRTb3VyY2VOYW1lID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxODsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKGpvaW5Tb3VyY2UuZ2V0UHJvcGVydGllc01hcChzZWFyY2hGaWx0ZXJzLCBsZWZ0U291cmNlTmFtZSwgam9pbi5nZXRMZWZ0RmllbGQoKS5nZXROYW1lKCksIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2suYmluZChudWxsLCByZXF1ZXN0VG9rZW4pKSk7CgogICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgIF9yZWYyID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgcHJvcGVydGllc01hcCA9IF9yZWYyLnByb3BlcnRpZXNNYXA7CiAgICAgICAgICAgICAgc3RvcExvYWRpbmcoc291cmNlRGF0YUlkLCByZXF1ZXN0VG9rZW4sIHByb3BlcnRpZXNNYXApOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICBkYXRhSGFzQ2hhbmdlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIGpvaW46IGpvaW4sCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzTWFwOiBwcm9wZXJ0aWVzTWFwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgIF9jb250ZXh0OS5wcmV2ID0gMjQ7CiAgICAgICAgICAgICAgX2NvbnRleHQ5LnQwID0gX2NvbnRleHQ5WyJjYXRjaCJdKDExKTsKCiAgICAgICAgICAgICAgaWYgKCEoX2NvbnRleHQ5LnQwIGluc3RhbmNlb2YgX2RhdGFfcmVxdWVzdC5EYXRhUmVxdWVzdEFib3J0RXJyb3IpKSB7CiAgICAgICAgICAgICAgICBvbkxvYWRFcnJvcihzb3VyY2VEYXRhSWQsIHJlcXVlc3RUb2tlbiwgIkpvaW4gZXJyb3I6ICIuY29uY2F0KF9jb250ZXh0OS50MC5tZXNzYWdlKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgZGF0YUhhc0NoYW5nZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBqb2luOiBqb2luLAogICAgICAgICAgICAgICAgcHJvcGVydGllc01hcDogbnVsbAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMsIFtbMTEsIDI0XV0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zeW5jSm9pbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zeW5jSm9pbnMoc3luY0NvbnRleHQpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgam9pblN5bmNzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9zeW5jSm9pbnMkKF9jb250ZXh0MTEpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGpvaW5TeW5jcyA9IHRoaXMuZ2V0VmFsaWRKb2lucygpLm1hcChmdW5jdGlvbiBfY2FsbGVlKGpvaW4pIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQxMCkgewogICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX3RoaXMyLl9zeW5jSm9pblN0eWxlTWV0YShzeW5jQ29udGV4dCwgam9pbikpOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpczIuX3N5bmNKb2luRm9ybWF0dGVycyhzeW5jQ29udGV4dCwgam9pbikpOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCBfdGhpczIuX3N5bmNKb2luKF9vYmplY3RTcHJlYWQoewogICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW46IGpvaW4KICAgICAgICAgICAgICAgICAgICAgICAgfSwgc3luY0NvbnRleHQpKSk7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKFByb21pc2UuYWxsKGpvaW5TeW5jcykpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQxMS5zZW50KTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0U2VhcmNoRmlsdGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldFNlYXJjaEZpbHRlcnMoZGF0YUZpbHRlcnMpIHsKICAgICAgdmFyIGZpZWxkTmFtZXMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuX3NvdXJjZS5nZXRGaWVsZE5hbWVzKCkpLCBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5fc3R5bGUuZ2V0U291cmNlRmllbGROYW1lcygpKSwgX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuZ2V0VmFsaWRKb2lucygpLm1hcChmdW5jdGlvbiAoam9pbikgewogICAgICAgIHJldHVybiBqb2luLmdldExlZnRGaWVsZCgpLmdldE5hbWUoKTsKICAgICAgfSkpKTsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIGRhdGFGaWx0ZXJzLCB7CiAgICAgICAgZmllbGROYW1lczogX2xvZGFzaC5kZWZhdWx0LnVuaXEoZmllbGROYW1lcykuc29ydCgpLAogICAgICAgIGdlb2dyaWRQcmVjaXNpb246IHRoaXMuX3NvdXJjZS5nZXRHZW9HcmlkUHJlY2lzaW9uKGRhdGFGaWx0ZXJzLnpvb20pLAogICAgICAgIHNvdXJjZVF1ZXJ5OiB0aGlzLmdldFF1ZXJ5KCksCiAgICAgICAgYXBwbHlHbG9iYWxRdWVyeTogdGhpcy5fc291cmNlLmdldEFwcGx5R2xvYmFsUXVlcnkoKSwKICAgICAgICBzb3VyY2VNZXRhOiB0aGlzLl9zb3VyY2UuZ2V0U3luY01ldGEoKQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcGVyZm9ybUlubmVySm9pbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9wZXJmb3JtSW5uZXJKb2lucyhzb3VyY2VSZXN1bHQsIGpvaW5TdGF0ZXMsIHVwZGF0ZVNvdXJjZURhdGEpIHsKICAgICAgdmFyIHNob3VsZFVwZGF0ZVN0b3JlLCBpLCBmZWF0dXJlLCBvbGRWaXNiaWxpdHksIGlzRmVhdHVyZVZpc2libGUsIGosIGpvaW5TdGF0ZSwgaW5uZXJKb2luLCBjYW5Kb2luT25DdXJyZW50OwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9wZXJmb3JtSW5uZXJKb2lucyQoX2NvbnRleHQxMikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgLy9zaG91bGQgdXBkYXRlIHRoZSBzdG9yZSBpZgogICAgICAgICAgICAgIC8vLS0gc291cmNlIHJlc3VsdCB3YXMgcmVmcmVzaGVkCiAgICAgICAgICAgICAgLy8tLSBhbnkgb2YgdGhlIGpvaW4gY29uZmlndXJhdGlvbnMgY2hhbmdlZCAoam9pblN0YXRlIGNoYW5nZWQpCiAgICAgICAgICAgICAgLy8tLSB2aXNpYmlsaXR5IG9mIGFueSBvZiB0aGUgZmVhdHVyZXMgaGFzIGNoYW5nZWQKICAgICAgICAgICAgICBzaG91bGRVcGRhdGVTdG9yZSA9IHNvdXJjZVJlc3VsdC5yZWZyZXNoZWQgfHwgam9pblN0YXRlcy5zb21lKGZ1bmN0aW9uIChqb2luU3RhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBqb2luU3RhdGUuZGF0YUhhc0NoYW5nZWQ7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChzaG91bGRVcGRhdGVTdG9yZSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc291cmNlUmVzdWx0LmZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBmZWF0dXJlID0gc291cmNlUmVzdWx0LmZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVzW2ldOwogICAgICAgICAgICAgICAgb2xkVmlzYmlsaXR5ID0gZmVhdHVyZS5wcm9wZXJ0aWVzW19jb25zdGFudHMuRkVBVFVSRV9WSVNJQkxFX1BST1BFUlRZX05BTUVdOwogICAgICAgICAgICAgICAgaXNGZWF0dXJlVmlzaWJsZSA9IHRydWU7CgogICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGpvaW5TdGF0ZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgam9pblN0YXRlID0gam9pblN0YXRlc1tqXTsKICAgICAgICAgICAgICAgICAgaW5uZXJKb2luID0gam9pblN0YXRlLmpvaW47CiAgICAgICAgICAgICAgICAgIGNhbkpvaW5PbkN1cnJlbnQgPSBpbm5lckpvaW4uam9pblByb3BlcnRpZXNUb0ZlYXR1cmUoZmVhdHVyZSwgam9pblN0YXRlLnByb3BlcnRpZXNNYXApOwogICAgICAgICAgICAgICAgICBpc0ZlYXR1cmVWaXNpYmxlID0gaXNGZWF0dXJlVmlzaWJsZSAmJiBjYW5Kb2luT25DdXJyZW50OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvbGRWaXNiaWxpdHkgIT09IGlzRmVhdHVyZVZpc2libGUpIHsKICAgICAgICAgICAgICAgICAgc2hvdWxkVXBkYXRlU3RvcmUgPSB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZlYXR1cmUucHJvcGVydGllc1tfY29uc3RhbnRzLkZFQVRVUkVfVklTSUJMRV9QUk9QRVJUWV9OQU1FXSA9IGlzRmVhdHVyZVZpc2libGU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlU3RvcmUpIHsKICAgICAgICAgICAgICAgIHVwZGF0ZVNvdXJjZURhdGEoX29iamVjdFNwcmVhZCh7fSwgc291cmNlUmVzdWx0LmZlYXR1cmVDb2xsZWN0aW9uKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zeW5jU291cmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc3luY1NvdXJjZShfcmVmMykgewogICAgICB2YXIgc3RhcnRMb2FkaW5nLCBzdG9wTG9hZGluZywgb25Mb2FkRXJyb3IsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2ssIGRhdGFGaWx0ZXJzLCByZXF1ZXN0VG9rZW4sIHNlYXJjaEZpbHRlcnMsIHByZXZEYXRhUmVxdWVzdCwgY2FuU2tpcEZldGNoLCBsYXllck5hbWUsIF9yZWY0LCBzb3VyY2VGZWF0dXJlQ29sbGVjdGlvbiwgbWV0YSwgbGF5ZXJGZWF0dXJlQ29sbGVjdGlvbjsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX3N5bmNTb3VyY2UkKF9jb250ZXh0MTMpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDEzLnByZXYgPSBfY29udGV4dDEzLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHN0YXJ0TG9hZGluZyA9IF9yZWYzLnN0YXJ0TG9hZGluZywgc3RvcExvYWRpbmcgPSBfcmVmMy5zdG9wTG9hZGluZywgb25Mb2FkRXJyb3IgPSBfcmVmMy5vbkxvYWRFcnJvciwgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjayA9IF9yZWYzLnJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2ssIGRhdGFGaWx0ZXJzID0gX3JlZjMuZGF0YUZpbHRlcnM7CiAgICAgICAgICAgICAgcmVxdWVzdFRva2VuID0gU3ltYm9sKCJsYXllci0iLmNvbmNhdCh0aGlzLmdldElkKCksICItIikuY29uY2F0KF9jb25zdGFudHMuU09VUkNFX0RBVEFfSURfT1JJR0lOKSk7CiAgICAgICAgICAgICAgc2VhcmNoRmlsdGVycyA9IHRoaXMuX2dldFNlYXJjaEZpbHRlcnMoZGF0YUZpbHRlcnMpOwogICAgICAgICAgICAgIHByZXZEYXRhUmVxdWVzdCA9IHRoaXMuZ2V0U291cmNlRGF0YVJlcXVlc3QoKTsKICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSA2OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9jYW5fc2tpcF9mZXRjaC5jYW5Ta2lwU291cmNlVXBkYXRlKSh7CiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuX3NvdXJjZSwKICAgICAgICAgICAgICAgIHByZXZEYXRhUmVxdWVzdDogcHJldkRhdGFSZXF1ZXN0LAogICAgICAgICAgICAgICAgbmV4dE1ldGE6IHNlYXJjaEZpbHRlcnMKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FuU2tpcEZldGNoID0gX2NvbnRleHQxMy5zZW50OwoKICAgICAgICAgICAgICBpZiAoIWNhblNraXBGZXRjaCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICByZWZyZXNoZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgZmVhdHVyZUNvbGxlY3Rpb246IHByZXZEYXRhUmVxdWVzdC5nZXREYXRhKCkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBfY29udGV4dDEzLnByZXYgPSA5OwogICAgICAgICAgICAgIHN0YXJ0TG9hZGluZyhfY29uc3RhbnRzLlNPVVJDRV9EQVRBX0lEX09SSUdJTiwgcmVxdWVzdFRva2VuLCBzZWFyY2hGaWx0ZXJzKTsKICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSAxMzsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuZ2V0RGlzcGxheU5hbWUoKSk7CgogICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIGxheWVyTmFtZSA9IF9jb250ZXh0MTMuc2VudDsKICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSAxNjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3NvdXJjZS5nZXRHZW9Kc29uV2l0aE1ldGEobGF5ZXJOYW1lLCBzZWFyY2hGaWx0ZXJzLCByZWdpc3RlckNhbmNlbENhbGxiYWNrLmJpbmQobnVsbCwgcmVxdWVzdFRva2VuKSkpOwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBfcmVmNCA9IF9jb250ZXh0MTMuc2VudDsKICAgICAgICAgICAgICBzb3VyY2VGZWF0dXJlQ29sbGVjdGlvbiA9IF9yZWY0LmRhdGE7CiAgICAgICAgICAgICAgbWV0YSA9IF9yZWY0Lm1ldGE7CiAgICAgICAgICAgICAgbGF5ZXJGZWF0dXJlQ29sbGVjdGlvbiA9ICgwLCBfYXNzaWduX2ZlYXR1cmVfaWRzLmFzc2lnbkZlYXR1cmVJZHMpKHNvdXJjZUZlYXR1cmVDb2xsZWN0aW9uKTsKICAgICAgICAgICAgICBzdG9wTG9hZGluZyhfY29uc3RhbnRzLlNPVVJDRV9EQVRBX0lEX09SSUdJTiwgcmVxdWVzdFRva2VuLCBsYXllckZlYXR1cmVDb2xsZWN0aW9uLCBtZXRhKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgIHJlZnJlc2hlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZlYXR1cmVDb2xsZWN0aW9uOiBsYXllckZlYXR1cmVDb2xsZWN0aW9uCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgIF9jb250ZXh0MTMucHJldiA9IDI0OwogICAgICAgICAgICAgIF9jb250ZXh0MTMudDAgPSBfY29udGV4dDEzWyJjYXRjaCJdKDkpOwoKICAgICAgICAgICAgICBpZiAoIShfY29udGV4dDEzLnQwIGluc3RhbmNlb2YgX2RhdGFfcmVxdWVzdC5EYXRhUmVxdWVzdEFib3J0RXJyb3IpKSB7CiAgICAgICAgICAgICAgICBvbkxvYWRFcnJvcihfY29uc3RhbnRzLlNPVVJDRV9EQVRBX0lEX09SSUdJTiwgcmVxdWVzdFRva2VuLCBfY29udGV4dDEzLnQwLm1lc3NhZ2UpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICByZWZyZXNoZWQ6IGZhbHNlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMsIFtbOSwgMjRdXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3N5bmNTb3VyY2VTdHlsZU1ldGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zeW5jU291cmNlU3R5bGVNZXRhKHN5bmNDb250ZXh0KSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX3N5bmNTb3VyY2VTdHlsZU1ldGEkKF9jb250ZXh0MTQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDE0LnByZXYgPSBfY29udGV4dDE0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGlmICghKHRoaXMuX3N0eWxlLmNvbnN0cnVjdG9yLnR5cGUgIT09IF9jb25zdGFudHMuTEFZRVJfU1RZTEVfVFlQRS5WRUNUT1IpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDE0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5fc3luY1N0eWxlTWV0YShfb2JqZWN0U3ByZWFkKHsKICAgICAgICAgICAgICAgIHNvdXJjZTogdGhpcy5fc291cmNlLAogICAgICAgICAgICAgICAgc291cmNlUXVlcnk6IHRoaXMuZ2V0UXVlcnkoKSwKICAgICAgICAgICAgICAgIGRhdGFSZXF1ZXN0SWQ6IF9jb25zdGFudHMuU09VUkNFX01FVEFfSURfT1JJR0lOLAogICAgICAgICAgICAgICAgZHluYW1pY1N0eWxlUHJvcHM6IHRoaXMuX3N0eWxlLmdldER5bmFtaWNQcm9wZXJ0aWVzQXJyYXkoKS5maWx0ZXIoZnVuY3Rpb24gKGR5bmFtaWNTdHlsZVByb3ApIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGR5bmFtaWNTdHlsZVByb3AuZ2V0RmllbGRPcmlnaW4oKSA9PT0gX2NvbnN0YW50cy5GSUVMRF9PUklHSU4uU09VUkNFICYmIGR5bmFtaWNTdHlsZVByb3AuaXNGaWVsZE1ldGFFbmFibGVkKCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0sIHN5bmNDb250ZXh0KSkpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zeW5jSm9pblN0eWxlTWV0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3N5bmNKb2luU3R5bGVNZXRhKHN5bmNDb250ZXh0LCBqb2luKSB7CiAgICAgIHZhciBqb2luU291cmNlOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9zeW5jSm9pblN0eWxlTWV0YSQoX2NvbnRleHQxNSkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgam9pblNvdXJjZSA9IGpvaW4uZ2V0UmlnaHRKb2luU291cmNlKCk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLCB0aGlzLl9zeW5jU3R5bGVNZXRhKF9vYmplY3RTcHJlYWQoewogICAgICAgICAgICAgICAgc291cmNlOiBqb2luU291cmNlLAogICAgICAgICAgICAgICAgc291cmNlUXVlcnk6IGpvaW5Tb3VyY2UuZ2V0V2hlcmVRdWVyeSgpLAogICAgICAgICAgICAgICAgZGF0YVJlcXVlc3RJZDogam9pbi5nZXRTb3VyY2VNZXRhRGF0YVJlcXVlc3RJZCgpLAogICAgICAgICAgICAgICAgZHluYW1pY1N0eWxlUHJvcHM6IHRoaXMuX3N0eWxlLmdldER5bmFtaWNQcm9wZXJ0aWVzQXJyYXkoKS5maWx0ZXIoZnVuY3Rpb24gKGR5bmFtaWNTdHlsZVByb3ApIHsKICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoaW5nRmllbGQgPSBqb2luU291cmNlLmdldE1ldHJpY0ZpZWxkRm9yTmFtZShkeW5hbWljU3R5bGVQcm9wLmdldEZpZWxkKCkuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGR5bmFtaWNTdHlsZVByb3AuZ2V0RmllbGRPcmlnaW4oKSA9PT0gX2NvbnN0YW50cy5GSUVMRF9PUklHSU4uSk9JTiAmJiAhIW1hdGNoaW5nRmllbGQgJiYgZHluYW1pY1N0eWxlUHJvcC5pc0ZpZWxkTWV0YUVuYWJsZWQoKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSwgc3luY0NvbnRleHQpKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3N5bmNTdHlsZU1ldGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zeW5jU3R5bGVNZXRhKF9yZWY1KSB7CiAgICAgIHZhciBzb3VyY2UsIHNvdXJjZVF1ZXJ5LCBkYXRhUmVxdWVzdElkLCBkeW5hbWljU3R5bGVQcm9wcywgZGF0YUZpbHRlcnMsIHN0YXJ0TG9hZGluZywgc3RvcExvYWRpbmcsIG9uTG9hZEVycm9yLCByZWdpc3RlckNhbmNlbENhbGxiYWNrLCBkeW5hbWljU3R5bGVGaWVsZHMsIG5leHRNZXRhLCBwcmV2RGF0YVJlcXVlc3QsIGNhblNraXBGZXRjaCwgcmVxdWVzdFRva2VuLCBfbGF5ZXJOYW1lLCBzdHlsZU1ldGE7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9zeW5jU3R5bGVNZXRhJChfY29udGV4dDE2KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNi5wcmV2ID0gX2NvbnRleHQxNi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBzb3VyY2UgPSBfcmVmNS5zb3VyY2UsIHNvdXJjZVF1ZXJ5ID0gX3JlZjUuc291cmNlUXVlcnksIGRhdGFSZXF1ZXN0SWQgPSBfcmVmNS5kYXRhUmVxdWVzdElkLCBkeW5hbWljU3R5bGVQcm9wcyA9IF9yZWY1LmR5bmFtaWNTdHlsZVByb3BzLCBkYXRhRmlsdGVycyA9IF9yZWY1LmRhdGFGaWx0ZXJzLCBzdGFydExvYWRpbmcgPSBfcmVmNS5zdGFydExvYWRpbmcsIHN0b3BMb2FkaW5nID0gX3JlZjUuc3RvcExvYWRpbmcsIG9uTG9hZEVycm9yID0gX3JlZjUub25Mb2FkRXJyb3IsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2sgPSBfcmVmNS5yZWdpc3RlckNhbmNlbENhbGxiYWNrOwoKICAgICAgICAgICAgICBpZiAoISghc291cmNlLmlzRVNTb3VyY2UoKSB8fCBkeW5hbWljU3R5bGVQcm9wcy5sZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGR5bmFtaWNTdHlsZUZpZWxkcyA9IGR5bmFtaWNTdHlsZVByb3BzLm1hcChmdW5jdGlvbiAoZHluYW1pY1N0eWxlUHJvcCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGR5bmFtaWNTdHlsZVByb3AuZ2V0RmllbGQoKS5nZXROYW1lKCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX2NvbnRleHQxNi50MCA9IF9sb2Rhc2guZGVmYXVsdC51bmlxKGR5bmFtaWNTdHlsZUZpZWxkcykuc29ydCgpOwogICAgICAgICAgICAgIF9jb250ZXh0MTYudDEgPSBzb3VyY2VRdWVyeTsKICAgICAgICAgICAgICBfY29udGV4dDE2LnQyID0gdGhpcy5fc3R5bGUuaXNUaW1lQXdhcmUoKTsKCiAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDE2LnQyKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQxNi5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChzb3VyY2UuaXNUaW1lQXdhcmUoKSk7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIF9jb250ZXh0MTYudDIgPSBfY29udGV4dDE2LnNlbnQ7CgogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIF9jb250ZXh0MTYudDMgPSBfY29udGV4dDE2LnQyOwogICAgICAgICAgICAgIF9jb250ZXh0MTYudDQgPSBkYXRhRmlsdGVycy50aW1lRmlsdGVyczsKICAgICAgICAgICAgICBuZXh0TWV0YSA9IHsKICAgICAgICAgICAgICAgIGR5bmFtaWNTdHlsZUZpZWxkczogX2NvbnRleHQxNi50MCwKICAgICAgICAgICAgICAgIHNvdXJjZVF1ZXJ5OiBfY29udGV4dDE2LnQxLAogICAgICAgICAgICAgICAgaXNUaW1lQXdhcmU6IF9jb250ZXh0MTYudDMsCiAgICAgICAgICAgICAgICB0aW1lRmlsdGVyczogX2NvbnRleHQxNi50NAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcHJldkRhdGFSZXF1ZXN0ID0gdGhpcy5fZmluZERhdGFSZXF1ZXN0QnlJZChkYXRhUmVxdWVzdElkKTsKICAgICAgICAgICAgICBjYW5Ta2lwRmV0Y2ggPSAoMCwgX2Nhbl9za2lwX2ZldGNoLmNhblNraXBTdHlsZU1ldGFVcGRhdGUpKHsKICAgICAgICAgICAgICAgIHByZXZEYXRhUmVxdWVzdDogcHJldkRhdGFSZXF1ZXN0LAogICAgICAgICAgICAgICAgbmV4dE1ldGE6IG5leHRNZXRhCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmICghY2FuU2tpcEZldGNoKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgcmVxdWVzdFRva2VuID0gU3ltYm9sKCJsYXllci0iLmNvbmNhdCh0aGlzLmdldElkKCksICItIikuY29uY2F0KGRhdGFSZXF1ZXN0SWQpKTsKICAgICAgICAgICAgICBfY29udGV4dDE2LnByZXYgPSAxOTsKICAgICAgICAgICAgICBzdGFydExvYWRpbmcoZGF0YVJlcXVlc3RJZCwgcmVxdWVzdFRva2VuLCBuZXh0TWV0YSk7CiAgICAgICAgICAgICAgX2NvbnRleHQxNi5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLmdldERpc3BsYXlOYW1lKCkpOwoKICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICBfbGF5ZXJOYW1lID0gX2NvbnRleHQxNi5zZW50OwogICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDI2OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoc291cmNlLmxvYWRTdHlsZVByb3BzTWV0YShfbGF5ZXJOYW1lLCB0aGlzLl9zdHlsZSwgZHluYW1pY1N0eWxlUHJvcHMsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2ssIG5leHRNZXRhKSk7CgogICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgIHN0eWxlTWV0YSA9IF9jb250ZXh0MTYuc2VudDsKICAgICAgICAgICAgICBzdG9wTG9hZGluZyhkYXRhUmVxdWVzdElkLCByZXF1ZXN0VG9rZW4sIHN0eWxlTWV0YSwgbmV4dE1ldGEpOwogICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDMzOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICBfY29udGV4dDE2LnByZXYgPSAzMDsKICAgICAgICAgICAgICBfY29udGV4dDE2LnQ1ID0gX2NvbnRleHQxNlsiY2F0Y2giXSgxOSk7CgogICAgICAgICAgICAgIGlmICghKF9jb250ZXh0MTYudDUgaW5zdGFuY2VvZiBfZGF0YV9yZXF1ZXN0LkRhdGFSZXF1ZXN0QWJvcnRFcnJvcikpIHsKICAgICAgICAgICAgICAgIG9uTG9hZEVycm9yKGRhdGFSZXF1ZXN0SWQsIHJlcXVlc3RUb2tlbiwgX2NvbnRleHQxNi50NS5tZXNzYWdlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE2LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMsIFtbMTksIDMwXV0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zeW5jU291cmNlRm9ybWF0dGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3N5bmNTb3VyY2VGb3JtYXR0ZXJzKHN5bmNDb250ZXh0KSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX3N5bmNTb3VyY2VGb3JtYXR0ZXJzJChfY29udGV4dDE3KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNy5wcmV2ID0gX2NvbnRleHQxNy5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoISh0aGlzLl9zdHlsZS5jb25zdHJ1Y3Rvci50eXBlICE9PSBfY29uc3RhbnRzLkxBWUVSX1NUWUxFX1RZUEUuVkVDVE9SKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsIHRoaXMuX3N5bmNGb3JtYXR0ZXJzKF9vYmplY3RTcHJlYWQoewogICAgICAgICAgICAgICAgc291cmNlOiB0aGlzLl9zb3VyY2UsCiAgICAgICAgICAgICAgICBkYXRhUmVxdWVzdElkOiBfY29uc3RhbnRzLlNPVVJDRV9GT1JNQVRURVJTX0lEX09SSUdJTiwKICAgICAgICAgICAgICAgIGZpZWxkczogdGhpcy5fc3R5bGUuZ2V0RHluYW1pY1Byb3BlcnRpZXNBcnJheSgpLmZpbHRlcihmdW5jdGlvbiAoZHluYW1pY1N0eWxlUHJvcCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZHluYW1pY1N0eWxlUHJvcC5nZXRGaWVsZE9yaWdpbigpID09PSBfY29uc3RhbnRzLkZJRUxEX09SSUdJTi5TT1VSQ0U7CiAgICAgICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGR5bmFtaWNTdHlsZVByb3ApIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGR5bmFtaWNTdHlsZVByb3AuZ2V0RmllbGQoKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSwgc3luY0NvbnRleHQpKSk7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3N5bmNKb2luRm9ybWF0dGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3N5bmNKb2luRm9ybWF0dGVycyhzeW5jQ29udGV4dCwgam9pbikgewogICAgICB2YXIgam9pblNvdXJjZTsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfc3luY0pvaW5Gb3JtYXR0ZXJzJChfY29udGV4dDE4KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxOC5wcmV2ID0gX2NvbnRleHQxOC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBqb2luU291cmNlID0gam9pbi5nZXRSaWdodEpvaW5Tb3VyY2UoKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOC5hYnJ1cHQoInJldHVybiIsIHRoaXMuX3N5bmNGb3JtYXR0ZXJzKF9vYmplY3RTcHJlYWQoewogICAgICAgICAgICAgICAgc291cmNlOiBqb2luU291cmNlLAogICAgICAgICAgICAgICAgZGF0YVJlcXVlc3RJZDogam9pbi5nZXRTb3VyY2VGb3JtYXR0ZXJzRGF0YVJlcXVlc3RJZCgpLAogICAgICAgICAgICAgICAgZmllbGRzOiB0aGlzLl9zdHlsZS5nZXREeW5hbWljUHJvcGVydGllc0FycmF5KCkuZmlsdGVyKGZ1bmN0aW9uIChkeW5hbWljU3R5bGVQcm9wKSB7CiAgICAgICAgICAgICAgICAgIHZhciBtYXRjaGluZ0ZpZWxkID0gam9pblNvdXJjZS5nZXRNZXRyaWNGaWVsZEZvck5hbWUoZHluYW1pY1N0eWxlUHJvcC5nZXRGaWVsZCgpLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkeW5hbWljU3R5bGVQcm9wLmdldEZpZWxkT3JpZ2luKCkgPT09IF9jb25zdGFudHMuRklFTERfT1JJR0lOLkpPSU4gJiYgISFtYXRjaGluZ0ZpZWxkOwogICAgICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChkeW5hbWljU3R5bGVQcm9wKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkeW5hbWljU3R5bGVQcm9wLmdldEZpZWxkKCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0sIHN5bmNDb250ZXh0KSkpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE4LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zeW5jRm9ybWF0dGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3N5bmNGb3JtYXR0ZXJzKF9yZWY2KSB7CiAgICAgIHZhciBzb3VyY2UsIGRhdGFSZXF1ZXN0SWQsIGZpZWxkcywgc3RhcnRMb2FkaW5nLCBzdG9wTG9hZGluZywgb25Mb2FkRXJyb3IsIGZpZWxkTmFtZXMsIG5leHRNZXRhLCBwcmV2RGF0YVJlcXVlc3QsIGNhblNraXBVcGRhdGUsIHJlcXVlc3RUb2tlbiwgZm9ybWF0dGVycywgcHJvbWlzZXM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX3N5bmNGb3JtYXR0ZXJzJChfY29udGV4dDIwKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMC5wcmV2ID0gX2NvbnRleHQyMC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBzb3VyY2UgPSBfcmVmNi5zb3VyY2UsIGRhdGFSZXF1ZXN0SWQgPSBfcmVmNi5kYXRhUmVxdWVzdElkLCBmaWVsZHMgPSBfcmVmNi5maWVsZHMsIHN0YXJ0TG9hZGluZyA9IF9yZWY2LnN0YXJ0TG9hZGluZywgc3RvcExvYWRpbmcgPSBfcmVmNi5zdG9wTG9hZGluZywgb25Mb2FkRXJyb3IgPSBfcmVmNi5vbkxvYWRFcnJvcjsKCiAgICAgICAgICAgICAgaWYgKCEoZmllbGRzLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgZmllbGROYW1lcyA9IGZpZWxkcy5tYXAoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQuZ2V0TmFtZSgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIG5leHRNZXRhID0gewogICAgICAgICAgICAgICAgZmllbGROYW1lczogX2xvZGFzaC5kZWZhdWx0LnVuaXEoZmllbGROYW1lcykuc29ydCgpCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBwcmV2RGF0YVJlcXVlc3QgPSB0aGlzLl9maW5kRGF0YVJlcXVlc3RCeUlkKGRhdGFSZXF1ZXN0SWQpOwogICAgICAgICAgICAgIGNhblNraXBVcGRhdGUgPSAoMCwgX2Nhbl9za2lwX2ZldGNoLmNhblNraXBGb3JtYXR0ZXJzVXBkYXRlKSh7CiAgICAgICAgICAgICAgICBwcmV2RGF0YVJlcXVlc3Q6IHByZXZEYXRhUmVxdWVzdCwKICAgICAgICAgICAgICAgIG5leHRNZXRhOiBuZXh0TWV0YQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoIWNhblNraXBVcGRhdGUpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgcmVxdWVzdFRva2VuID0gU3ltYm9sKCJsYXllci0iLmNvbmNhdCh0aGlzLmdldElkKCksICItIikuY29uY2F0KGRhdGFSZXF1ZXN0SWQpKTsKICAgICAgICAgICAgICBfY29udGV4dDIwLnByZXYgPSAxMDsKICAgICAgICAgICAgICBzdGFydExvYWRpbmcoZGF0YVJlcXVlc3RJZCwgcmVxdWVzdFRva2VuLCBuZXh0TWV0YSk7CiAgICAgICAgICAgICAgZm9ybWF0dGVycyA9IHt9OwogICAgICAgICAgICAgIHByb21pc2VzID0gZmllbGRzLm1hcChmdW5jdGlvbiBfY2FsbGVlMihmaWVsZCkgewogICAgICAgICAgICAgICAgdmFyIGZpZWxkTmFtZTsKICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MTkpIHsKICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTkucHJldiA9IF9jb250ZXh0MTkubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZE5hbWUgPSBmaWVsZC5nZXROYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTkubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoc291cmNlLmdldEZpZWxkRm9ybWF0dGVyKGZpZWxkTmFtZSkpOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVyc1tmaWVsZE5hbWVdID0gX2NvbnRleHQxOS5zZW50OwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE5LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDE2OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoUHJvbWlzZS5hbGwocHJvbWlzZXMpKTsKCiAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgc3RvcExvYWRpbmcoZGF0YVJlcXVlc3RJZCwgcmVxdWVzdFRva2VuLCBmb3JtYXR0ZXJzLCBuZXh0TWV0YSk7CiAgICAgICAgICAgICAgX2NvbnRleHQyMC5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgIF9jb250ZXh0MjAucHJldiA9IDE5OwogICAgICAgICAgICAgIF9jb250ZXh0MjAudDAgPSBfY29udGV4dDIwWyJjYXRjaCJdKDEwKTsKICAgICAgICAgICAgICBvbkxvYWRFcnJvcihkYXRhUmVxdWVzdElkLCByZXF1ZXN0VG9rZW4sIF9jb250ZXh0MjAudDAubWVzc2FnZSk7CgogICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMsIFtbMTAsIDE5XV0pOwogICAgfQogIH0sIHsKICAgIGtleTogInN5bmNEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzeW5jRGF0YShzeW5jQ29udGV4dCkgewogICAgICB2YXIgc291cmNlUmVzdWx0LCBqb2luU3RhdGVzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIHN5bmNEYXRhJChfY29udGV4dDIxKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMS5wcmV2ID0gX2NvbnRleHQyMS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoISghdGhpcy5pc1Zpc2libGUoKSB8fCAhdGhpcy5zaG93QXRab29tTGV2ZWwoc3luY0NvbnRleHQuZGF0YUZpbHRlcnMuem9vbSkpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIxLm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMS5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIF9jb250ZXh0MjEubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9zeW5jU291cmNlU3R5bGVNZXRhKHN5bmNDb250ZXh0KSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgX2NvbnRleHQyMS5uZXh0ID0gNjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3N5bmNTb3VyY2VGb3JtYXR0ZXJzKHN5bmNDb250ZXh0KSk7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgX2NvbnRleHQyMS5uZXh0ID0gODsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3N5bmNTb3VyY2Uoc3luY0NvbnRleHQpKTsKCiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBzb3VyY2VSZXN1bHQgPSBfY29udGV4dDIxLnNlbnQ7CgogICAgICAgICAgICAgIGlmICghKCFzb3VyY2VSZXN1bHQuZmVhdHVyZUNvbGxlY3Rpb24gfHwgIXNvdXJjZVJlc3VsdC5mZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcy5sZW5ndGggfHwgIXRoaXMuX2hhc0pvaW5zKCkpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIxLm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjEuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgX2NvbnRleHQyMS5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLl9zeW5jSm9pbnMoc3luY0NvbnRleHQpKTsKCiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgam9pblN0YXRlcyA9IF9jb250ZXh0MjEuc2VudDsKICAgICAgICAgICAgICBfY29udGV4dDIxLm5leHQgPSAxNjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3BlcmZvcm1Jbm5lckpvaW5zKHNvdXJjZVJlc3VsdCwgam9pblN0YXRlcywgc3luY0NvbnRleHQudXBkYXRlU291cmNlRGF0YSkpOwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0U291cmNlRmVhdHVyZUNvbGxlY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRTb3VyY2VGZWF0dXJlQ29sbGVjdGlvbigpIHsKICAgICAgdmFyIHNvdXJjZURhdGFSZXF1ZXN0ID0gdGhpcy5nZXRTb3VyY2VEYXRhUmVxdWVzdCgpOwogICAgICByZXR1cm4gc291cmNlRGF0YVJlcXVlc3QgPyBzb3VyY2VEYXRhUmVxdWVzdC5nZXREYXRhKCkgOiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zeW5jRmVhdHVyZUNvbGxlY3Rpb25XaXRoTWIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zeW5jRmVhdHVyZUNvbGxlY3Rpb25XaXRoTWIobWJNYXApIHsKICAgICAgdmFyIG1iR2VvSlNPTlNvdXJjZSA9IG1iTWFwLmdldFNvdXJjZSh0aGlzLmdldElkKCkpOwoKICAgICAgdmFyIGZlYXR1cmVDb2xsZWN0aW9uID0gdGhpcy5fZ2V0U291cmNlRmVhdHVyZUNvbGxlY3Rpb24oKTsKCiAgICAgIHZhciBmZWF0dXJlQ29sbGVjdGlvbk9uTWFwID0gX2xheWVyLkFic3RyYWN0TGF5ZXIuZ2V0Qm91bmREYXRhRm9yU291cmNlKG1iTWFwLCB0aGlzLmdldElkKCkpOwoKICAgICAgaWYgKCFmZWF0dXJlQ29sbGVjdGlvbikgewogICAgICAgIGlmIChmZWF0dXJlQ29sbGVjdGlvbk9uTWFwKSB7CiAgICAgICAgICB0aGlzLl9zdHlsZS5jbGVhckZlYXR1cmVTdGF0ZShmZWF0dXJlQ29sbGVjdGlvbk9uTWFwLCBtYk1hcCwgdGhpcy5nZXRJZCgpKTsKICAgICAgICB9CgogICAgICAgIG1iR2VvSlNPTlNvdXJjZS5zZXREYXRhKF9jb25zdGFudHMuRU1QVFlfRkVBVFVSRV9DT0xMRUNUSU9OKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gImZlYXR1cmUtc3RhdGUiIGRhdGEgZXhwcmVzc2lvbnMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBsYXlvdXQgcHJvcGVydGllcy4KICAgICAgLy8gVG8gd29yayBhcm91bmQgdGhpcyBsaW1pdGF0aW9uLAogICAgICAvLyBzY2FsZWQgbGF5b3V0IHByb3BlcnRpZXMgKGxpa2UgaWNvbi1zaXplKSBtdXN0IGZhbGwgYmFjayB0byBnZW9qc29uIHByb3BlcnR5IHZhbHVlcyA6KAoKCiAgICAgIHZhciBoYXNHZW9Kc29uUHJvcGVydGllcyA9IHRoaXMuX3N0eWxlLnNldEZlYXR1cmVTdGF0ZUFuZFN0eWxlUHJvcHMoZmVhdHVyZUNvbGxlY3Rpb24sIG1iTWFwLCB0aGlzLmdldElkKCkpOwoKICAgICAgaWYgKGZlYXR1cmVDb2xsZWN0aW9uICE9PSBmZWF0dXJlQ29sbGVjdGlvbk9uTWFwIHx8IGhhc0dlb0pzb25Qcm9wZXJ0aWVzKSB7CiAgICAgICAgbWJHZW9KU09OU291cmNlLnNldERhdGEoZmVhdHVyZUNvbGxlY3Rpb24pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX3NldE1iUG9pbnRzUHJvcGVydGllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldE1iUG9pbnRzUHJvcGVydGllcyhtYk1hcCkgewogICAgICB2YXIgcG9pbnRMYXllcklkID0gdGhpcy5fZ2V0TWJQb2ludExheWVySWQoKTsKCiAgICAgIHZhciBzeW1ib2xMYXllcklkID0gdGhpcy5fZ2V0TWJTeW1ib2xMYXllcklkKCk7CgogICAgICB2YXIgcG9pbnRMYXllciA9IG1iTWFwLmdldExheWVyKHBvaW50TGF5ZXJJZCk7CiAgICAgIHZhciBzeW1ib2xMYXllciA9IG1iTWFwLmdldExheWVyKHN5bWJvbExheWVySWQpOyAvLyBQb2ludCBsYXllcnMgc3ltYm9saXplZCBhcyBjaXJjbGVzIHJlcXVpcmUgMiBtYXBib3ggbGF5ZXJzIGJlY2F1c2UKICAgICAgLy8gImNpcmNsZSIgbGF5ZXJzIGRvIG5vdCBzdXBwb3J0ICJ0ZXh0IiBzdHlsZSBwcm9wZXJ0aWVzCiAgICAgIC8vIFBvaW50IGxheWVycyBzeW1ib2xpemVkIGFzIGljb25zIG9ubHkgY29udGFpbiBhIHNpbmdsZSBtYXBib3ggbGF5ZXIuCgogICAgICB2YXIgbWFya2VyTGF5ZXJJZDsKICAgICAgdmFyIHRleHRMYXllcklkOwoKICAgICAgaWYgKHRoaXMuX3N0eWxlLmFyZVBvaW50c1N5bWJvbGl6ZWRBc0NpcmNsZXMoKSkgewogICAgICAgIG1hcmtlckxheWVySWQgPSBwb2ludExheWVySWQ7CiAgICAgICAgdGV4dExheWVySWQgPSB0aGlzLl9nZXRNYlRleHRMYXllcklkKCk7CgogICAgICAgIGlmIChzeW1ib2xMYXllcikgewogICAgICAgICAgbWJNYXAuc2V0TGF5b3V0UHJvcGVydHkoc3ltYm9sTGF5ZXJJZCwgJ3Zpc2liaWxpdHknLCAnbm9uZScpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fc2V0TWJDaXJjbGVQcm9wZXJ0aWVzKG1iTWFwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtYXJrZXJMYXllcklkID0gc3ltYm9sTGF5ZXJJZDsKICAgICAgICB0ZXh0TGF5ZXJJZCA9IHN5bWJvbExheWVySWQ7CgogICAgICAgIGlmIChwb2ludExheWVyKSB7CiAgICAgICAgICBtYk1hcC5zZXRMYXlvdXRQcm9wZXJ0eShwb2ludExheWVySWQsICd2aXNpYmlsaXR5JywgJ25vbmUnKTsKICAgICAgICAgIG1iTWFwLnNldExheW91dFByb3BlcnR5KHRoaXMuX2dldE1iVGV4dExheWVySWQoKSwgJ3Zpc2liaWxpdHknLCAnbm9uZScpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fc2V0TWJTeW1ib2xQcm9wZXJ0aWVzKG1iTWFwKTsKICAgICAgfQoKICAgICAgdGhpcy5zeW5jVmlzaWJpbGl0eVdpdGhNYihtYk1hcCwgbWFya2VyTGF5ZXJJZCk7CiAgICAgIG1iTWFwLnNldExheWVyWm9vbVJhbmdlKG1hcmtlckxheWVySWQsIHRoaXMuX2Rlc2NyaXB0b3IubWluWm9vbSwgdGhpcy5fZGVzY3JpcHRvci5tYXhab29tKTsKCiAgICAgIGlmIChtYXJrZXJMYXllcklkICE9PSB0ZXh0TGF5ZXJJZCkgewogICAgICAgIHRoaXMuc3luY1Zpc2liaWxpdHlXaXRoTWIobWJNYXAsIHRleHRMYXllcklkKTsKICAgICAgICBtYk1hcC5zZXRMYXllclpvb21SYW5nZSh0ZXh0TGF5ZXJJZCwgdGhpcy5fZGVzY3JpcHRvci5taW5ab29tLCB0aGlzLl9kZXNjcmlwdG9yLm1heFpvb20pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX3NldE1iQ2lyY2xlUHJvcGVydGllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldE1iQ2lyY2xlUHJvcGVydGllcyhtYk1hcCkgewogICAgICB2YXIgc291cmNlSWQgPSB0aGlzLmdldElkKCk7CgogICAgICB2YXIgcG9pbnRMYXllcklkID0gdGhpcy5fZ2V0TWJQb2ludExheWVySWQoKTsKCiAgICAgIHZhciBwb2ludExheWVyID0gbWJNYXAuZ2V0TGF5ZXIocG9pbnRMYXllcklkKTsKCiAgICAgIGlmICghcG9pbnRMYXllcikgewogICAgICAgIG1iTWFwLmFkZExheWVyKHsKICAgICAgICAgIGlkOiBwb2ludExheWVySWQsCiAgICAgICAgICB0eXBlOiAnY2lyY2xlJywKICAgICAgICAgIHNvdXJjZTogc291cmNlSWQsCiAgICAgICAgICBwYWludDoge30KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIHRleHRMYXllcklkID0gdGhpcy5fZ2V0TWJUZXh0TGF5ZXJJZCgpOwoKICAgICAgdmFyIHRleHRMYXllciA9IG1iTWFwLmdldExheWVyKHRleHRMYXllcklkKTsKCiAgICAgIGlmICghdGV4dExheWVyKSB7CiAgICAgICAgbWJNYXAuYWRkTGF5ZXIoewogICAgICAgICAgaWQ6IHRleHRMYXllcklkLAogICAgICAgICAgdHlwZTogJ3N5bWJvbCcsCiAgICAgICAgICBzb3VyY2U6IHNvdXJjZUlkCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBmaWx0ZXJFeHByID0gKDAsIF9tYl9maWx0ZXJfZXhwcmVzc2lvbnMuZ2V0UG9pbnRGaWx0ZXJFeHByZXNzaW9uKSh0aGlzLl9oYXNKb2lucygpKTsKCiAgICAgIGlmIChmaWx0ZXJFeHByICE9PSBtYk1hcC5nZXRGaWx0ZXIocG9pbnRMYXllcklkKSkgewogICAgICAgIG1iTWFwLnNldEZpbHRlcihwb2ludExheWVySWQsIGZpbHRlckV4cHIpOwogICAgICAgIG1iTWFwLnNldEZpbHRlcih0ZXh0TGF5ZXJJZCwgZmlsdGVyRXhwcik7CiAgICAgIH0KCiAgICAgIHRoaXMuX3N0eWxlLnNldE1CUGFpbnRQcm9wZXJ0aWVzRm9yUG9pbnRzKHsKICAgICAgICBhbHBoYTogdGhpcy5nZXRBbHBoYSgpLAogICAgICAgIG1iTWFwOiBtYk1hcCwKICAgICAgICBwb2ludExheWVySWQ6IHBvaW50TGF5ZXJJZAogICAgICB9KTsKCiAgICAgIHRoaXMuX3N0eWxlLnNldE1CUHJvcGVydGllc0ZvckxhYmVsVGV4dCh7CiAgICAgICAgYWxwaGE6IHRoaXMuZ2V0QWxwaGEoKSwKICAgICAgICBtYk1hcDogbWJNYXAsCiAgICAgICAgdGV4dExheWVySWQ6IHRleHRMYXllcklkCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zZXRNYlN5bWJvbFByb3BlcnRpZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXRNYlN5bWJvbFByb3BlcnRpZXMobWJNYXApIHsKICAgICAgdmFyIHNvdXJjZUlkID0gdGhpcy5nZXRJZCgpOwoKICAgICAgdmFyIHN5bWJvbExheWVySWQgPSB0aGlzLl9nZXRNYlN5bWJvbExheWVySWQoKTsKCiAgICAgIHZhciBzeW1ib2xMYXllciA9IG1iTWFwLmdldExheWVyKHN5bWJvbExheWVySWQpOwoKICAgICAgaWYgKCFzeW1ib2xMYXllcikgewogICAgICAgIG1iTWFwLmFkZExheWVyKHsKICAgICAgICAgIGlkOiBzeW1ib2xMYXllcklkLAogICAgICAgICAgdHlwZTogJ3N5bWJvbCcsCiAgICAgICAgICBzb3VyY2U6IHNvdXJjZUlkCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBmaWx0ZXJFeHByID0gKDAsIF9tYl9maWx0ZXJfZXhwcmVzc2lvbnMuZ2V0UG9pbnRGaWx0ZXJFeHByZXNzaW9uKSh0aGlzLl9oYXNKb2lucygpKTsKCiAgICAgIGlmIChmaWx0ZXJFeHByICE9PSBtYk1hcC5nZXRGaWx0ZXIoc3ltYm9sTGF5ZXJJZCkpIHsKICAgICAgICBtYk1hcC5zZXRGaWx0ZXIoc3ltYm9sTGF5ZXJJZCwgZmlsdGVyRXhwcik7CiAgICAgIH0KCiAgICAgIHRoaXMuX3N0eWxlLnNldE1CU3ltYm9sUHJvcGVydGllc0ZvclBvaW50cyh7CiAgICAgICAgYWxwaGE6IHRoaXMuZ2V0QWxwaGEoKSwKICAgICAgICBtYk1hcDogbWJNYXAsCiAgICAgICAgc3ltYm9sTGF5ZXJJZDogc3ltYm9sTGF5ZXJJZAogICAgICB9KTsKCiAgICAgIHRoaXMuX3N0eWxlLnNldE1CUHJvcGVydGllc0ZvckxhYmVsVGV4dCh7CiAgICAgICAgYWxwaGE6IHRoaXMuZ2V0QWxwaGEoKSwKICAgICAgICBtYk1hcDogbWJNYXAsCiAgICAgICAgdGV4dExheWVySWQ6IHN5bWJvbExheWVySWQKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3NldE1iTGluZVBvbHlnb25Qcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0TWJMaW5lUG9seWdvblByb3BlcnRpZXMobWJNYXApIHsKICAgICAgdmFyIHNvdXJjZUlkID0gdGhpcy5nZXRJZCgpOwoKICAgICAgdmFyIGZpbGxMYXllcklkID0gdGhpcy5fZ2V0TWJQb2x5Z29uTGF5ZXJJZCgpOwoKICAgICAgdmFyIGxpbmVMYXllcklkID0gdGhpcy5fZ2V0TWJMaW5lTGF5ZXJJZCgpOwoKICAgICAgdmFyIGhhc0pvaW5zID0gdGhpcy5faGFzSm9pbnMoKTsKCiAgICAgIGlmICghbWJNYXAuZ2V0TGF5ZXIoZmlsbExheWVySWQpKSB7CiAgICAgICAgbWJNYXAuYWRkTGF5ZXIoewogICAgICAgICAgaWQ6IGZpbGxMYXllcklkLAogICAgICAgICAgdHlwZTogJ2ZpbGwnLAogICAgICAgICAgc291cmNlOiBzb3VyY2VJZCwKICAgICAgICAgIHBhaW50OiB7fQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAoIW1iTWFwLmdldExheWVyKGxpbmVMYXllcklkKSkgewogICAgICAgIG1iTWFwLmFkZExheWVyKHsKICAgICAgICAgIGlkOiBsaW5lTGF5ZXJJZCwKICAgICAgICAgIHR5cGU6ICdsaW5lJywKICAgICAgICAgIHNvdXJjZTogc291cmNlSWQsCiAgICAgICAgICBwYWludDoge30KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5fc3R5bGUuc2V0TUJQYWludFByb3BlcnRpZXMoewogICAgICAgIGFscGhhOiB0aGlzLmdldEFscGhhKCksCiAgICAgICAgbWJNYXA6IG1iTWFwLAogICAgICAgIGZpbGxMYXllcklkOiBmaWxsTGF5ZXJJZCwKICAgICAgICBsaW5lTGF5ZXJJZDogbGluZUxheWVySWQKICAgICAgfSk7CgogICAgICB0aGlzLnN5bmNWaXNpYmlsaXR5V2l0aE1iKG1iTWFwLCBmaWxsTGF5ZXJJZCk7CiAgICAgIG1iTWFwLnNldExheWVyWm9vbVJhbmdlKGZpbGxMYXllcklkLCB0aGlzLl9kZXNjcmlwdG9yLm1pblpvb20sIHRoaXMuX2Rlc2NyaXB0b3IubWF4Wm9vbSk7CiAgICAgIHZhciBmaWxsRmlsdGVyRXhwciA9ICgwLCBfbWJfZmlsdGVyX2V4cHJlc3Npb25zLmdldEZpbGxGaWx0ZXJFeHByZXNzaW9uKShoYXNKb2lucyk7CgogICAgICBpZiAoZmlsbEZpbHRlckV4cHIgIT09IG1iTWFwLmdldEZpbHRlcihmaWxsTGF5ZXJJZCkpIHsKICAgICAgICBtYk1hcC5zZXRGaWx0ZXIoZmlsbExheWVySWQsIGZpbGxGaWx0ZXJFeHByKTsKICAgICAgfQoKICAgICAgdGhpcy5zeW5jVmlzaWJpbGl0eVdpdGhNYihtYk1hcCwgbGluZUxheWVySWQpOwogICAgICBtYk1hcC5zZXRMYXllclpvb21SYW5nZShsaW5lTGF5ZXJJZCwgdGhpcy5fZGVzY3JpcHRvci5taW5ab29tLCB0aGlzLl9kZXNjcmlwdG9yLm1heFpvb20pOwogICAgICB2YXIgbGluZUZpbHRlckV4cHIgPSAoMCwgX21iX2ZpbHRlcl9leHByZXNzaW9ucy5nZXRMaW5lRmlsdGVyRXhwcmVzc2lvbikoaGFzSm9pbnMpOwoKICAgICAgaWYgKGxpbmVGaWx0ZXJFeHByICE9PSBtYk1hcC5nZXRGaWx0ZXIobGluZUxheWVySWQpKSB7CiAgICAgICAgbWJNYXAuc2V0RmlsdGVyKGxpbmVMYXllcklkLCBsaW5lRmlsdGVyRXhwcik7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfc3luY1N0eWxlUHJvcGVydGllc1dpdGhNYiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3N5bmNTdHlsZVByb3BlcnRpZXNXaXRoTWIobWJNYXApIHsKICAgICAgdGhpcy5fc2V0TWJQb2ludHNQcm9wZXJ0aWVzKG1iTWFwKTsKCiAgICAgIHRoaXMuX3NldE1iTGluZVBvbHlnb25Qcm9wZXJ0aWVzKG1iTWFwKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfc3luY1NvdXJjZUJpbmRpbmdXaXRoTWIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zeW5jU291cmNlQmluZGluZ1dpdGhNYihtYk1hcCkgewogICAgICB2YXIgbWJTb3VyY2UgPSBtYk1hcC5nZXRTb3VyY2UodGhpcy5nZXRJZCgpKTsKCiAgICAgIGlmICghbWJTb3VyY2UpIHsKICAgICAgICBtYk1hcC5hZGRTb3VyY2UodGhpcy5nZXRJZCgpLCB7CiAgICAgICAgICB0eXBlOiAnZ2VvanNvbicsCiAgICAgICAgICBkYXRhOiBfY29uc3RhbnRzLkVNUFRZX0ZFQVRVUkVfQ09MTEVDVElPTgogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic3luY0xheWVyV2l0aE1CIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzeW5jTGF5ZXJXaXRoTUIobWJNYXApIHsKICAgICAgdGhpcy5fc3luY1NvdXJjZUJpbmRpbmdXaXRoTWIobWJNYXApOwoKICAgICAgdGhpcy5fc3luY0ZlYXR1cmVDb2xsZWN0aW9uV2l0aE1iKG1iTWFwKTsKCiAgICAgIHRoaXMuX3N5bmNTdHlsZVByb3BlcnRpZXNXaXRoTWIobWJNYXApOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRNYlBvaW50TGF5ZXJJZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldE1iUG9pbnRMYXllcklkKCkgewogICAgICByZXR1cm4gdGhpcy5tYWtlTWJMYXllcklkKCdjaXJjbGUnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0TWJUZXh0TGF5ZXJJZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldE1iVGV4dExheWVySWQoKSB7CiAgICAgIHJldHVybiB0aGlzLm1ha2VNYkxheWVySWQoJ3RleHQnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0TWJTeW1ib2xMYXllcklkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0TWJTeW1ib2xMYXllcklkKCkgewogICAgICByZXR1cm4gdGhpcy5tYWtlTWJMYXllcklkKCdzeW1ib2wnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0TWJMaW5lTGF5ZXJJZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldE1iTGluZUxheWVySWQoKSB7CiAgICAgIHJldHVybiB0aGlzLm1ha2VNYkxheWVySWQoJ2xpbmUnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZ2V0TWJQb2x5Z29uTGF5ZXJJZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldE1iUG9seWdvbkxheWVySWQoKSB7CiAgICAgIHJldHVybiB0aGlzLm1ha2VNYkxheWVySWQoJ2ZpbGwnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRNYkxheWVySWRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNYkxheWVySWRzKCkgewogICAgICByZXR1cm4gW3RoaXMuX2dldE1iUG9pbnRMYXllcklkKCksIHRoaXMuX2dldE1iVGV4dExheWVySWQoKSwgdGhpcy5fZ2V0TWJTeW1ib2xMYXllcklkKCksIHRoaXMuX2dldE1iTGluZUxheWVySWQoKSwgdGhpcy5fZ2V0TWJQb2x5Z29uTGF5ZXJJZCgpXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvd25zTWJMYXllcklkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvd25zTWJMYXllcklkKG1iTGF5ZXJJZCkgewogICAgICByZXR1cm4gdGhpcy5nZXRNYkxheWVySWRzKCkuaW5jbHVkZXMobWJMYXllcklkKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvd25zTWJTb3VyY2VJZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb3duc01iU291cmNlSWQobWJTb3VyY2VJZCkgewogICAgICByZXR1cm4gdGhpcy5nZXRJZCgpID09PSBtYlNvdXJjZUlkOwogICAgfQogIH0sIHsKICAgIGtleTogIl9hZGRKb2luc1RvU291cmNlVG9vbHRpcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRKb2luc1RvU291cmNlVG9vbHRpcHModG9vbHRpcHNGcm9tU291cmNlKSB7CiAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCB0b29sdGlwc0Zyb21Tb3VyY2UubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgdmFyIHRvb2x0aXBQcm9wZXJ0eSA9IHRvb2x0aXBzRnJvbVNvdXJjZVtfaV07CiAgICAgICAgdmFyIG1hdGNoaW5nSm9pbnMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgX2ogPSAwOyBfaiA8IHRoaXMuX2pvaW5zLmxlbmd0aDsgX2orKykgewogICAgICAgICAgaWYgKHRoaXMuX2pvaW5zW19qXS5nZXRMZWZ0RmllbGQoKS5nZXROYW1lKCkgPT09IHRvb2x0aXBQcm9wZXJ0eS5nZXRQcm9wZXJ0eUtleSgpKSB7CiAgICAgICAgICAgIG1hdGNoaW5nSm9pbnMucHVzaCh0aGlzLl9qb2luc1tfal0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG1hdGNoaW5nSm9pbnMubGVuZ3RoKSB7CiAgICAgICAgICB0b29sdGlwc0Zyb21Tb3VyY2VbX2ldID0gbmV3IF9qb2luX3Rvb2x0aXBfcHJvcGVydHkuSm9pblRvb2x0aXBQcm9wZXJ0eSh0b29sdGlwUHJvcGVydHksIG1hdGNoaW5nSm9pbnMpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldFByb3BlcnRpZXNGb3JUb29sdGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQcm9wZXJ0aWVzRm9yVG9vbHRpcChwcm9wZXJ0aWVzKSB7CiAgICAgIHZhciBhbGxUb29sdGlwcywgX2kyLCBwcm9wc0Zyb21Kb2luOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBnZXRQcm9wZXJ0aWVzRm9yVG9vbHRpcCQoX2NvbnRleHQyMikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjIucHJldiA9IF9jb250ZXh0MjIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQyMi5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX3NvdXJjZS5maWx0ZXJBbmRGb3JtYXRQcm9wZXJ0aWVzVG9IdG1sKHByb3BlcnRpZXMpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBhbGxUb29sdGlwcyA9IF9jb250ZXh0MjIuc2VudDsKCiAgICAgICAgICAgICAgdGhpcy5fYWRkSm9pbnNUb1NvdXJjZVRvb2x0aXBzKGFsbFRvb2x0aXBzKTsKCiAgICAgICAgICAgICAgX2kyID0gMDsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBpZiAoIShfaTIgPCB0aGlzLl9qb2lucy5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIyLm5leHQgPSAxMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQyMi5uZXh0ID0gODsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHRoaXMuX2pvaW5zW19pMl0uZmlsdGVyQW5kRm9ybWF0UHJvcGVydGllc0ZvclRvb2x0aXAocHJvcGVydGllcykpOwoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIHByb3BzRnJvbUpvaW4gPSBfY29udGV4dDIyLnNlbnQ7CiAgICAgICAgICAgICAgYWxsVG9vbHRpcHMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGFsbFRvb2x0aXBzKSwgX3RvQ29uc3VtYWJsZUFycmF5KHByb3BzRnJvbUpvaW4pKTsKCiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgX2kyKys7CiAgICAgICAgICAgICAgX2NvbnRleHQyMi5uZXh0ID0gNTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjIuYWJydXB0KCJyZXR1cm4iLCBhbGxUb29sdGlwcyk7CgogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImNhblNob3dUb29sdGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5TaG93VG9vbHRpcCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNWaXNpYmxlKCkgJiYgKHRoaXMuX3NvdXJjZS5jYW5Gb3JtYXRGZWF0dXJlUHJvcGVydGllcygpIHx8IHRoaXMuX2pvaW5zLmxlbmd0aCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RmVhdHVyZUJ5SWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZlYXR1cmVCeUlkKGlkKSB7CiAgICAgIHZhciBmZWF0dXJlQ29sbGVjdGlvbiA9IHRoaXMuX2dldFNvdXJjZUZlYXR1cmVDb2xsZWN0aW9uKCk7CgogICAgICBpZiAoIWZlYXR1cmVDb2xsZWN0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXR1cm4gZmVhdHVyZUNvbGxlY3Rpb24uZmVhdHVyZXMuZmluZChmdW5jdGlvbiAoZmVhdHVyZSkgewogICAgICAgIHJldHVybiBmZWF0dXJlLnByb3BlcnRpZXNbX2NvbnN0YW50cy5GRUFUVVJFX0lEX1BST1BFUlRZX05BTUVdID09PSBpZDsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gVmVjdG9yTGF5ZXI7Cn0oX2xheWVyLkFic3RyYWN0TGF5ZXIpOwoKZXhwb3J0cy5WZWN0b3JMYXllciA9IFZlY3RvckxheWVyOwoKX2RlZmluZVByb3BlcnR5KFZlY3RvckxheWVyLCAidHlwZSIsIF9jb25zdGFudHMuTEFZRVJfVFlQRS5WRUNUT1IpOw=="},null]}