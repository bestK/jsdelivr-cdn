{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/vis/map/kibana_map.js","dependencies":[{"path":"src/legacy/ui/public/vis/map/kibana_map.js","mtime":1585205041307},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLktpYmFuYU1hcCA9IHZvaWQgMDsKCnZhciBfZXZlbnRzID0gcmVxdWlyZSgiZXZlbnRzIik7Cgp2YXIgX21hcF9tZXNzYWdlcyA9IHJlcXVpcmUoIi4vbWFwX21lc3NhZ2VzIik7Cgp2YXIgX2xlYWZsZXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxlYWZsZXQiKSk7Cgp2YXIgX2pxdWVyeSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgianF1ZXJ5IikpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfem9vbV90b19wcmVjaXNpb24gPSByZXF1aXJlKCIuL3pvb21fdG9fcHJlY2lzaW9uIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfb3JpZ2luID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29yZV9wbHVnaW5zL3RpbGVfbWFwL2NvbW1vbi9vcmlnaW4iKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKZnVuY3Rpb24gbWFrZUZpdENvbnRyb2woZml0Q29udGFpbmVyLCBraWJhbmFNYXApIHsKICB2YXIgRml0Q29udHJvbCA9IF9sZWFmbGV0LmRlZmF1bHQuQ29udHJvbC5leHRlbmQoewogICAgb3B0aW9uczogewogICAgICBwb3NpdGlvbjogJ3RvcGxlZnQnCiAgICB9LAogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShmaXRDb250YWluZXIsIGtpYmFuYU1hcCkgewogICAgICB0aGlzLl9maXRDb250YWluZXIgPSBmaXRDb250YWluZXI7CiAgICAgIHRoaXMuX2tpYmFuYU1hcCA9IGtpYmFuYU1hcDsKICAgICAgdGhpcy5fbGVhZmxldE1hcCA9IG51bGw7CiAgICB9LAogICAgb25BZGQ6IGZ1bmN0aW9uIG9uQWRkKGxlYWZsZXRNYXApIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHRoaXMuX2xlYWZsZXRNYXAgPSBsZWFmbGV0TWFwOwoKICAgICAgdmFyIGZpdERhdEJvdW5kc0xhYmVsID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS52aXMua2liYW5hTWFwLmxlYWZsZXQuZml0RGF0YUJvdW5kc0FyaWFMYWJlbCcsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0ZpdCBEYXRhIEJvdW5kcycKICAgICAgfSk7CgogICAgICAoMCwgX2pxdWVyeS5kZWZhdWx0KSh0aGlzLl9maXRDb250YWluZXIpLmh0bWwoIjxhIGNsYXNzPVwia3VpSWNvbiBmYS1jcm9wXCIgaHJlZj1cIiNcIiB0aXRsZT1cIiIuY29uY2F0KGZpdERhdEJvdW5kc0xhYmVsLCAiXCIgYXJpYS1sYWJlbD1cIiIpLmNvbmNhdChmaXREYXRCb3VuZHNMYWJlbCwgIlwiPjwvYT4iKSkub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgIF90aGlzLl9raWJhbmFNYXAuZml0VG9EYXRhKCk7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5fZml0Q29udGFpbmVyOwogICAgfSwKICAgIG9uUmVtb3ZlOiBmdW5jdGlvbiBvblJlbW92ZSgpIHsKICAgICAgKDAsIF9qcXVlcnkuZGVmYXVsdCkodGhpcy5fZml0Q29udGFpbmVyKS5vZmYoJ2NsaWNrJyk7CiAgICB9CiAgfSk7CgogIHJldHVybiBuZXcgRml0Q29udHJvbChmaXRDb250YWluZXIsIGtpYmFuYU1hcCk7Cn0KCmZ1bmN0aW9uIG1ha2VMZWdlbmRDb250cm9sKGNvbnRhaW5lciwga2liYW5hTWFwLCBwb3NpdGlvbikgewogIHZhciBMZWdlbmRDb250cm9sID0gX2xlYWZsZXQuZGVmYXVsdC5Db250cm9sLmV4dGVuZCh7CiAgICBvcHRpb25zOiB7CiAgICAgIHBvc2l0aW9uOiAndG9wcmlnaHQnCiAgICB9LAogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShjb250YWluZXIsIGtpYmFuYU1hcCwgcG9zaXRpb24pIHsKICAgICAgdGhpcy5fbGVnZW5kQ29udGFpbmVyID0gY29udGFpbmVyOwogICAgICB0aGlzLl9raWJhbmFNYXAgPSBraWJhbmFNYXA7CiAgICAgIHRoaXMub3B0aW9ucy5wb3NpdGlvbiA9IHBvc2l0aW9uOwogICAgfSwKICAgIHVwZGF0ZUNvbnRlbnRzOiBmdW5jdGlvbiB1cGRhdGVDb250ZW50cygpIHsKICAgICAgdGhpcy5fbGVnZW5kQ29udGFpbmVyLmVtcHR5KCk7CgogICAgICB2YXIgJGRpdiA9ICgwLCBfanF1ZXJ5LmRlZmF1bHQpKCc8ZGl2PicpLmFkZENsYXNzKCd2aXNNYXBMZWdlbmQnKTsKCiAgICAgIHRoaXMuX2xlZ2VuZENvbnRhaW5lci5hcHBlbmQoJGRpdik7CgogICAgICB2YXIgbGF5ZXJzID0gdGhpcy5fa2liYW5hTWFwLmdldExheWVycygpOwoKICAgICAgbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIGxheWVyLmFwcGVuZExlZ2VuZENvbnRlbnRzKCRkaXYpOwogICAgICB9KTsKICAgIH0sCiAgICBvbkFkZDogZnVuY3Rpb24gb25BZGQoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy5fbGF5ZXJVcGRhdGVIYW5kbGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi51cGRhdGVDb250ZW50cygpOwogICAgICB9OwoKICAgICAgdGhpcy5fa2liYW5hTWFwLm9uKCdsYXllcnM6dXBkYXRlJywgdGhpcy5fbGF5ZXJVcGRhdGVIYW5kbGUpOwoKICAgICAgdGhpcy51cGRhdGVDb250ZW50cygpOwogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kQ29udGFpbmVyLmdldCgwKTsKICAgIH0sCiAgICBvblJlbW92ZTogZnVuY3Rpb24gb25SZW1vdmUoKSB7CiAgICAgIHRoaXMuX2tpYmFuYU1hcC5yZW1vdmVMaXN0ZW5lcignbGF5ZXJzOnVwZGF0ZScsIHRoaXMuX2xheWVyVXBkYXRlSGFuZGxlKTsKCiAgICAgIHRoaXMuX2xlZ2VuZENvbnRhaW5lci5lbXB0eSgpOwogICAgfQogIH0pOwoKICByZXR1cm4gbmV3IExlZ2VuZENvbnRyb2woY29udGFpbmVyLCBraWJhbmFNYXAsIHBvc2l0aW9uKTsKfQovKioKICogQ29sbGVjdHMgbWFwIGZ1bmN0aW9uYWxpdHkgcmVxdWlyZWQgZm9yIEtpYmFuYS4KICogU2VydmVzIGFzIHNpbXBsZSBhYnN0cmFjdGlvbiBmb3IgbGVhZmxldCBhcyB3ZWxsLgogKi8KCgp2YXIgS2liYW5hTWFwID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0V2ZW50RW1pdHRlcikgewogIF9pbmhlcml0cyhLaWJhbmFNYXAsIF9FdmVudEVtaXR0ZXIpOwoKICBmdW5jdGlvbiBLaWJhbmFNYXAoY29udGFpbmVyTm9kZSwgb3B0aW9ucykgewogICAgdmFyIF90aGlzMzsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgS2liYW5hTWFwKTsKCiAgICBfdGhpczMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoS2liYW5hTWFwKS5jYWxsKHRoaXMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpczMpLCAiZ2V0Wm9vbUxldmVsIiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX3RoaXMzLl9sZWFmbGV0TWFwLmdldFpvb20oKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzMyksICJnZXRNYXhab29tTGV2ZWwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpczMuX2xlYWZsZXRNYXAuZ2V0TWF4Wm9vbSgpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMzKSwgIl9hZGRNYXhab29tTWVzc2FnZSIsIGZ1bmN0aW9uIChsYXllcikgewogICAgICB2YXIgem9vbVdhcm5pbmdNc2cgPSAoMCwgX21hcF9tZXNzYWdlcy5jcmVhdGVab29tV2FybmluZ01zZykoX3RoaXMzLmdldFpvb21MZXZlbCwgX3RoaXMzLmdldE1heFpvb21MZXZlbCk7CgogICAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ3pvb21lbmQnLCB6b29tV2FybmluZ01zZyk7CgogICAgICBfdGhpczMuX2NvbnRhaW5lck5vZGUuc2V0QXR0cmlidXRlKCdkYXRhLXRlc3Qtc3ViaicsICd6b29tV2FybmluZ0VuYWJsZWQnKTsKCiAgICAgIGxheWVyLm9uKCdyZW1vdmUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9mZignem9vbWVuZCcsIHpvb21XYXJuaW5nTXNnKTsKCiAgICAgICAgX3RoaXMzLl9jb250YWluZXJOb2RlLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS10ZXN0LXN1YmonKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfdGhpczMuX2NvbnRhaW5lck5vZGUgPSBjb250YWluZXJOb2RlOwogICAgX3RoaXMzLl9sZWFmbGV0QmFzZUxheWVyID0gbnVsbDsKICAgIF90aGlzMy5fYmFzZUxheWVyU2V0dGluZ3MgPSBudWxsOwogICAgX3RoaXMzLl9iYXNlTGF5ZXJJc0Rlc2F0dXJhdGVkID0gdHJ1ZTsKICAgIF90aGlzMy5fbGVhZmxldERyYXdDb250cm9sID0gbnVsbDsKICAgIF90aGlzMy5fbGVhZmxldEZpdENvbnRyb2wgPSBudWxsOwogICAgX3RoaXMzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCA9IG51bGw7CiAgICBfdGhpczMuX2xlZ2VuZFBvc2l0aW9uID0gJ3RvcHJpZ2h0JzsKICAgIF90aGlzMy5fbGF5ZXJzID0gW107CiAgICBfdGhpczMuX2xpc3RlbmVycyA9IFtdOwogICAgX3RoaXMzLl9zaG93VG9vbHRpcCA9IGZhbHNlOwogICAgdmFyIGxlYWZsZXRPcHRpb25zID0gewogICAgICBtaW5ab29tOiBvcHRpb25zLm1pblpvb20sCiAgICAgIG1heFpvb206IG9wdGlvbnMubWF4Wm9vbSwKICAgICAgY2VudGVyOiBvcHRpb25zLmNlbnRlciA/IG9wdGlvbnMuY2VudGVyIDogWzAsIDBdLAogICAgICB6b29tOiBvcHRpb25zLnpvb20gPyBvcHRpb25zLnpvb20gOiAyLAogICAgICByZW5kZXJlcjogX2xlYWZsZXQuZGVmYXVsdC5jYW52YXMoKSwKICAgICAgem9vbUFuaW1hdGlvbjogZmFsc2UsCiAgICAgIC8vIERlc2F0dXJhdGUgbWFwIHRpbGVzIGNhdXNlcyBhbmltYXRpb24gcmVuZGVyaW5nIGFydGlmYWN0cwogICAgICB6b29tQ29udHJvbDogb3B0aW9ucy56b29tQ29udHJvbCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IG9wdGlvbnMuem9vbUNvbnRyb2wKICAgIH07CiAgICBfdGhpczMuX2xlYWZsZXRNYXAgPSBfbGVhZmxldC5kZWZhdWx0Lm1hcChjb250YWluZXJOb2RlLCBsZWFmbGV0T3B0aW9ucyk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLmF0dHJpYnV0aW9uQ29udHJvbC5zZXRQcmVmaXgoJycpOwoKICAgIGlmICghb3B0aW9ucy5zY3JvbGxXaGVlbFpvb20pIHsKICAgICAgX3RoaXMzLl9sZWFmbGV0TWFwLnNjcm9sbFdoZWVsWm9vbS5kaXNhYmxlKCk7CiAgICB9CgogICAgdmFyIHByZXZpb3VzWm9vbSA9IF90aGlzMy5fbGVhZmxldE1hcC5nZXRab29tKCk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCd6b29tZW5kJywgZnVuY3Rpb24gKCkgewogICAgICBpZiAocHJldmlvdXNab29tICE9PSBfdGhpczMuX2xlYWZsZXRNYXAuZ2V0Wm9vbSgpKSB7CiAgICAgICAgcHJldmlvdXNab29tID0gX3RoaXMzLl9sZWFmbGV0TWFwLmdldFpvb20oKTsKCiAgICAgICAgX3RoaXMzLmVtaXQoJ3pvb21jaGFuZ2UnKTsKICAgICAgfQogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCd6b29tZW5kJywgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX3RoaXMzLmVtaXQoJ3pvb21lbmQnKTsKICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignZHJhZ2VuZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzMy5lbWl0KCdkcmFnZW5kJyk7CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ3pvb21lbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpczMuX3VwZGF0ZUV4dGVudCgpOwogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCdkcmFnZW5kJywgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX3RoaXMzLl91cGRhdGVFeHRlbnQoKTsKICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIF90aGlzMy5fbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIGxheWVyLm1vdmVQb2ludGVyKCdtb3VzZW1vdmUnLCBlKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIF90aGlzMy5fbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIGxheWVyLm1vdmVQb2ludGVyKCdtb3VzZW91dCcsIGUpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIF90aGlzMy5fbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIGxheWVyLm1vdmVQb2ludGVyKCdtb3VzZWRvd24nLCBlKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ21vdXNldXAnLCBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gX3RoaXMzLl9sYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gbGF5ZXIubW92ZVBvaW50ZXIoJ21vdXNldXAnLCBlKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ2RyYXc6Y3JlYXRlZCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICB2YXIgZHJhd1R5cGUgPSBldmVudC5sYXllclR5cGU7CgogICAgICBpZiAoZHJhd1R5cGUgPT09ICdyZWN0YW5nbGUnKSB7CiAgICAgICAgdmFyIGJvdW5kcyA9IGV2ZW50LmxheWVyLmdldEJvdW5kcygpOwogICAgICAgIHZhciBzb3V0aEVhc3QgPSBib3VuZHMuZ2V0U291dGhFYXN0KCk7CiAgICAgICAgdmFyIG5vcnRoV2VzdCA9IGJvdW5kcy5nZXROb3J0aFdlc3QoKTsKICAgICAgICB2YXIgc291dGhFYXN0TG5nID0gc291dGhFYXN0LmxuZzsKCiAgICAgICAgaWYgKHNvdXRoRWFzdExuZyA+IDE4MCkgewogICAgICAgICAgc291dGhFYXN0TG5nIC09IDM2MDsKICAgICAgICB9CgogICAgICAgIHZhciBub3J0aFdlc3RMbmcgPSBub3J0aFdlc3QubG5nOwoKICAgICAgICBpZiAobm9ydGhXZXN0TG5nIDwgLTE4MCkgewogICAgICAgICAgbm9ydGhXZXN0TG5nICs9IDM2MDsKICAgICAgICB9CgogICAgICAgIHZhciBzb3V0aEVhc3RMYXQgPSBzb3V0aEVhc3QubGF0OwogICAgICAgIHZhciBub3J0aFdlc3RMYXQgPSBub3J0aFdlc3QubGF0OyAvL0JvdW5kcyBjYW5ub3QgYmUgY3JlYXRlZCB1bmxlc3MgdGhleSBmb3JtIGEgYm94IHdpdGggbGFyZ2VyIHRoYW4gMCBkaW1lbnNpb25zCiAgICAgICAgLy9JbnZhbGlkIGFyZWFzIGFyZSByZWplY3RlZCBieSBFUy4KCiAgICAgICAgaWYgKHNvdXRoRWFzdExhdCA9PT0gbm9ydGhXZXN0TGF0IHx8IHNvdXRoRWFzdExuZyA9PT0gbm9ydGhXZXN0TG5nKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfdGhpczMuZW1pdCgnZHJhd0NyZWF0ZWQ6cmVjdGFuZ2xlJywgewogICAgICAgICAgYm91bmRzOiB7CiAgICAgICAgICAgIGJvdHRvbV9yaWdodDogewogICAgICAgICAgICAgIGxhdDogc291dGhFYXN0TGF0LAogICAgICAgICAgICAgIGxvbjogc291dGhFYXN0TG5nCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvcF9sZWZ0OiB7CiAgICAgICAgICAgICAgbGF0OiBub3J0aFdlc3RMYXQsCiAgICAgICAgICAgICAgbG9uOiBub3J0aFdlc3RMbmcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKGRyYXdUeXBlID09PSAncG9seWdvbicpIHsKICAgICAgICB2YXIgbGF0TG9uZ3MgPSBldmVudC5sYXllci5nZXRMYXRMbmdzKClbMF07CgogICAgICAgIF90aGlzMy5lbWl0KCdkcmF3Q3JlYXRlZDpwb2x5Z29uJywgewogICAgICAgICAgcG9pbnRzOiBsYXRMb25ncy5tYXAoZnVuY3Rpb24gKGxlYWZsZXRMYXRMbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBsYXQ6IGxlYWZsZXRMYXRMbmcubGF0LAogICAgICAgICAgICAgIGxvbjogbGVhZmxldExhdExuZy5sbmcKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF90aGlzMy5yZXNpemUoKTsKCiAgICByZXR1cm4gX3RoaXMzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEtpYmFuYU1hcCwgW3sKICAgIGtleTogInNldFNob3dUb29sdGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTaG93VG9vbHRpcChzaG93VG9vbHRpcCkgewogICAgICB0aGlzLl9zaG93VG9vbHRpcCA9IHNob3dUb29sdGlwOwogICAgfQogIH0sIHsKICAgIGtleTogImdldExheWVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGF5ZXJzKCkgewogICAgICByZXR1cm4gdGhpcy5fbGF5ZXJzLnNsaWNlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRkTGF5ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZExheWVyKGtpYmFuYUxheWVyKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIG9uc2hvd1Rvb2x0aXAgPSBmdW5jdGlvbiBvbnNob3dUb29sdGlwKGV2ZW50KSB7CiAgICAgICAgaWYgKCFfdGhpczQuX3Nob3dUb29sdGlwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIV90aGlzNC5fcG9wdXApIHsKICAgICAgICAgIF90aGlzNC5fcG9wdXAgPSBfbGVhZmxldC5kZWZhdWx0LnJlc3BvbnNpdmVQb3B1cCh7CiAgICAgICAgICAgIGF1dG9QYW46IGZhbHNlCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczQuX3BvcHVwLnNldExhdExuZyhldmVudC5wb3NpdGlvbik7CgogICAgICAgICAgX3RoaXM0Ll9wb3B1cC5zZXRDb250ZW50KGV2ZW50LmNvbnRlbnQpOwoKICAgICAgICAgIF90aGlzNC5fcG9wdXAub3Blbk9uKF90aGlzNC5fbGVhZmxldE1hcCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICghX3RoaXM0Ll9wb3B1cC5nZXRMYXRMbmcoKS5lcXVhbHMoZXZlbnQucG9zaXRpb24pKSB7CiAgICAgICAgICAgIF90aGlzNC5fcG9wdXAuc2V0TGF0TG5nKGV2ZW50LnBvc2l0aW9uKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX3RoaXM0Ll9wb3B1cC5nZXRDb250ZW50KCkgIT09IGV2ZW50LmNvbnRlbnQpIHsKICAgICAgICAgICAgX3RoaXM0Ll9wb3B1cC5zZXRDb250ZW50KGV2ZW50LmNvbnRlbnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGtpYmFuYUxheWVyLm9uKCdzaG93VG9vbHRpcCcsIG9uc2hvd1Rvb2x0aXApOwoKICAgICAgdGhpcy5fbGlzdGVuZXJzLnB1c2goewogICAgICAgIG5hbWU6ICdzaG93VG9vbHRpcCcsCiAgICAgICAgaGFuZGxlOiBvbnNob3dUb29sdGlwLAogICAgICAgIGxheWVyOiBraWJhbmFMYXllcgogICAgICB9KTsKCiAgICAgIHZhciBvbkhpZGVUb29sdGlwID0gZnVuY3Rpb24gb25IaWRlVG9vbHRpcCgpIHsKICAgICAgICBfdGhpczQuX2xlYWZsZXRNYXAuY2xvc2VQb3B1cCgpOwoKICAgICAgICBfdGhpczQuX3BvcHVwID0gbnVsbDsKICAgICAgfTsKCiAgICAgIGtpYmFuYUxheWVyLm9uKCdoaWRlVG9vbHRpcCcsIG9uSGlkZVRvb2x0aXApOwoKICAgICAgdGhpcy5fbGlzdGVuZXJzLnB1c2goewogICAgICAgIG5hbWU6ICdoaWRlVG9vbHRpcCcsCiAgICAgICAgaGFuZGxlOiBvbkhpZGVUb29sdGlwLAogICAgICAgIGxheWVyOiBraWJhbmFMYXllcgogICAgICB9KTsKCiAgICAgIHZhciBvblN0eWxlQ2hhbmdlZCA9IGZ1bmN0aW9uIG9uU3R5bGVDaGFuZ2VkKCkgewogICAgICAgIGlmIChfdGhpczQuX2xlYWZsZXRMZWdlbmRDb250cm9sKSB7CiAgICAgICAgICBfdGhpczQuX2xlYWZsZXRMZWdlbmRDb250cm9sLnVwZGF0ZUNvbnRlbnRzKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAga2liYW5hTGF5ZXIub24oJ3N0eWxlQ2hhbmdlZCcsIG9uU3R5bGVDaGFuZ2VkKTsKCiAgICAgIHRoaXMuX2xpc3RlbmVycy5wdXNoKHsKICAgICAgICBuYW1lOiAnc3R5bGVDaGFuZ2VkJywKICAgICAgICBoYW5kbGU6IG9uU3R5bGVDaGFuZ2VkLAogICAgICAgIGxheWVyOiBraWJhbmFMYXllcgogICAgICB9KTsKCiAgICAgIHRoaXMuX2xheWVycy5wdXNoKGtpYmFuYUxheWVyKTsKCiAgICAgIGtpYmFuYUxheWVyLmFkZFRvTGVhZmxldE1hcCh0aGlzLl9sZWFmbGV0TWFwKTsKICAgICAgdGhpcy5lbWl0KCdsYXllcnM6dXBkYXRlJyk7CgogICAgICB0aGlzLl9hZGRBdHRyaWJ1dGlvbnMoa2liYW5hTGF5ZXIuZ2V0QXR0cmlidXRpb25zKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbW92ZUxheWVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVMYXllcihraWJhbmFMYXllcikgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIGlmICgha2liYW5hTGF5ZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX3JlbW92ZUF0dHJpYnV0aW9ucyhraWJhbmFMYXllci5nZXRBdHRyaWJ1dGlvbnMoKSk7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLl9sYXllcnMuaW5kZXhPZihraWJhbmFMYXllcik7CgogICAgICBpZiAoaW5kZXggPj0gMCkgewogICAgICAgIHRoaXMuX2xheWVycy5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgICBraWJhbmFMYXllci5yZW1vdmVGcm9tTGVhZmxldE1hcCh0aGlzLl9sZWFmbGV0TWFwKTsKICAgICAgfQoKICAgICAgdGhpcy5fbGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGxpc3RlbmVyKSB7CiAgICAgICAgaWYgKGxpc3RlbmVyLmxheWVyID09PSBraWJhbmFMYXllcikgewogICAgICAgICAgbGlzdGVuZXIubGF5ZXIucmVtb3ZlTGlzdGVuZXIobGlzdGVuZXIubmFtZSwgbGlzdGVuZXIuaGFuZGxlKTsKICAgICAgICB9CiAgICAgIH0pOyAvL211c3QgcmVhZGQgYWxsIGF0dHJpYnV0aW9ucywgYmVjYXVzZSB3ZSBtaWdodCBoYXZlIHJlbW92ZWQgZHVwZXMKCgogICAgICB0aGlzLl9sYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gX3RoaXM1Ll9hZGRBdHRyaWJ1dGlvbnMobGF5ZXIuZ2V0QXR0cmlidXRpb25zKCkpOwogICAgICB9KTsKCiAgICAgIGlmICh0aGlzLl9iYXNlTGF5ZXJTZXR0aW5ncykgewogICAgICAgIHRoaXMuX2FkZEF0dHJpYnV0aW9ucyh0aGlzLl9iYXNlTGF5ZXJTZXR0aW5ncy5vcHRpb25zLmF0dHJpYnV0aW9uKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9hZGRBdHRyaWJ1dGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRBdHRyaWJ1dGlvbnMoYXR0cmlidXRpb24pIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB2YXIgYXR0cmlidXRpb25zID0gZ2V0QXR0cmlidXRpb25BcnJheShhdHRyaWJ1dGlvbik7CiAgICAgIGF0dHJpYnV0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChhdHRyaWJ1dGlvbikgewogICAgICAgIF90aGlzNi5fbGVhZmxldE1hcC5hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlQXR0cmlidXRpb24oYXR0cmlidXRpb24pOyAvL3RoaXMgZW5zdXJlcyB3ZSBkbyBub3QgYWRkIGR1cGxpY2F0ZXMKCgogICAgICAgIF90aGlzNi5fbGVhZmxldE1hcC5hdHRyaWJ1dGlvbkNvbnRyb2wuYWRkQXR0cmlidXRpb24oYXR0cmlidXRpb24pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcmVtb3ZlQXR0cmlidXRpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVtb3ZlQXR0cmlidXRpb25zKGF0dHJpYnV0aW9uKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgdmFyIGF0dHJpYnV0aW9ucyA9IGdldEF0dHJpYnV0aW9uQXJyYXkoYXR0cmlidXRpb24pOwogICAgICBhdHRyaWJ1dGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoYXR0cmlidXRpb24pIHsKICAgICAgICBfdGhpczcuX2xlYWZsZXRNYXAuYXR0cmlidXRpb25Db250cm9sLnJlbW92ZUF0dHJpYnV0aW9uKGF0dHJpYnV0aW9uKTsgLy90aGlzIGVuc3VyZXMgd2UgZG8gbm90IGFkZCBkdXBsaWNhdGVzCgogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBpZiAodGhpcy5fbGVhZmxldEZpdENvbnRyb2wpIHsKICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnJlbW92ZUNvbnRyb2wodGhpcy5fbGVhZmxldEZpdENvbnRyb2wpOwogICAgICB9CgogICAgICBpZiAodGhpcy5fbGVhZmxldERyYXdDb250cm9sKSB7CiAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5yZW1vdmVDb250cm9sKHRoaXMuX2xlYWZsZXREcmF3Q29udHJvbCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCkgewogICAgICAgIHRoaXMuX2xlYWZsZXRNYXAucmVtb3ZlQ29udHJvbCh0aGlzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCk7CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0QmFzZUxheWVyKG51bGwpOwogICAgICB2YXIgbGF5ZXI7CgogICAgICB3aGlsZSAodGhpcy5fbGF5ZXJzLmxlbmd0aCkgewogICAgICAgIGxheWVyID0gdGhpcy5fbGF5ZXJzLnBvcCgpOwogICAgICAgIGxheWVyLnJlbW92ZUZyb21MZWFmbGV0TWFwKHRoaXMuX2xlYWZsZXRNYXApOwogICAgICB9CgogICAgICB0aGlzLl9sZWFmbGV0TWFwLnJlbW92ZSgpOwoKICAgICAgdGhpcy5fY29udGFpbmVyTm9kZS5pbm5lckhUTUwgPSAnJzsKCiAgICAgIHRoaXMuX2xpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChsaXN0ZW5lcikgewogICAgICAgIHJldHVybiBsaXN0ZW5lci5sYXllci5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lci5uYW1lLCBsaXN0ZW5lci5oYW5kbGUpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRDZW50ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENlbnRlcigpIHsKICAgICAgdmFyIGNlbnRlciA9IHRoaXMuX2xlYWZsZXRNYXAuZ2V0Q2VudGVyKCk7CgogICAgICByZXR1cm4gewogICAgICAgIGxvbjogY2VudGVyLmxuZywKICAgICAgICBsYXQ6IGNlbnRlci5sYXQKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRDZW50ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldENlbnRlcihsYXRpdHVkZSwgbG9uZ2l0dWRlKSB7CiAgICAgIHZhciBsYXRMb25nID0gX2xlYWZsZXQuZGVmYXVsdC5sYXRMbmcobGF0aXR1ZGUsIGxvbmdpdHVkZSk7CgogICAgICBpZiAobGF0TG9uZy5lcXVhbHMgJiYgIWxhdExvbmcuZXF1YWxzKHRoaXMuX2xlYWZsZXRNYXAuZ2V0Q2VudGVyKCkpKSB7CiAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5zZXRWaWV3KGxhdExvbmcpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Wm9vbUxldmVsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRab29tTGV2ZWwoem9vbUxldmVsKSB7CiAgICAgIGlmICh0aGlzLl9sZWFmbGV0TWFwLmdldFpvb20oKSAhPT0gem9vbUxldmVsKSB7CiAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5zZXRab29tKHpvb21MZXZlbCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRHZW9oYXNoUHJlY2lzaW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRHZW9oYXNoUHJlY2lzaW9uKCkgewogICAgICByZXR1cm4gKDAsIF96b29tX3RvX3ByZWNpc2lvbi56b29tVG9QcmVjaXNpb24pKHRoaXMuX2xlYWZsZXRNYXAuZ2V0Wm9vbSgpLCAxMiwgdGhpcy5fbGVhZmxldE1hcC5nZXRNYXhab29tKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldExlYWZsZXRCb3VuZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExlYWZsZXRCb3VuZHMoKSB7CiAgICAgIHJldHVybiB0aGlzLl9sZWFmbGV0TWFwLmdldEJvdW5kcygpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldE1ldGVyc1BlclBpeGVsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNZXRlcnNQZXJQaXhlbCgpIHsKICAgICAgdmFyIHBvaW50QyA9IHRoaXMuX2xlYWZsZXRNYXAubGF0TG5nVG9Db250YWluZXJQb2ludCh0aGlzLl9sZWFmbGV0TWFwLmdldENlbnRlcigpKTsgLy8gY2VudGVyIChwaXhlbHMpCgoKICAgICAgdmFyIHBvaW50WCA9IFtwb2ludEMueCArIDEsIHBvaW50Qy55XTsgLy8gYWRkIG9uZSBwaXhlbCB0byB4CgogICAgICB2YXIgcG9pbnRZID0gW3BvaW50Qy54LCBwb2ludEMueSArIDFdOyAvLyBhZGQgb25lIHBpeGVsIHRvIHkKCiAgICAgIHZhciBsYXRMbmdDID0gdGhpcy5fbGVhZmxldE1hcC5jb250YWluZXJQb2ludFRvTGF0TG5nKHBvaW50Qyk7CgogICAgICB2YXIgbGF0TG5nWCA9IHRoaXMuX2xlYWZsZXRNYXAuY29udGFpbmVyUG9pbnRUb0xhdExuZyhwb2ludFgpOwoKICAgICAgdmFyIGxhdExuZ1kgPSB0aGlzLl9sZWFmbGV0TWFwLmNvbnRhaW5lclBvaW50VG9MYXRMbmcocG9pbnRZKTsKCiAgICAgIHZhciBkaXN0YW5jZVggPSBsYXRMbmdDLmRpc3RhbmNlVG8obGF0TG5nWCk7IC8vIGNhbGN1bGF0ZSBkaXN0YW5jZSBiZXR3ZWVuIGMgYW5kIHggKGxhdGl0dWRlKQoKICAgICAgdmFyIGRpc3RhbmNlWSA9IGxhdExuZ0MuZGlzdGFuY2VUbyhsYXRMbmdZKTsgLy8gY2FsY3VsYXRlIGRpc3RhbmNlIGJldHdlZW4gYyBhbmQgeSAobG9uZ2l0dWRlKQoKICAgICAgcmV0dXJuIF9sb2Rhc2guZGVmYXVsdC5taW4oW2Rpc3RhbmNlWCwgZGlzdGFuY2VZXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2dldExlYWZsZXRCb3VuZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRMZWFmbGV0Qm91bmRzKHJlc2l6ZU9uRmFpbCkgewogICAgICB2YXIgYm91bmRzUmF3ID0gdGhpcy5fbGVhZmxldE1hcC5nZXRCb3VuZHMoKTsKCiAgICAgIHZhciBib3VuZHMgPSB0aGlzLl9sZWFmbGV0TWFwLndyYXBMYXRMbmdCb3VuZHMoYm91bmRzUmF3KTsKCiAgICAgIGlmICghYm91bmRzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBzb3V0aEVhc3QgPSBib3VuZHMuZ2V0U291dGhFYXN0KCk7CiAgICAgIHZhciBub3J0aFdlc3QgPSBib3VuZHMuZ2V0Tm9ydGhXZXN0KCk7CgogICAgICBpZiAoc291dGhFYXN0LmxuZyA9PT0gbm9ydGhXZXN0LmxuZyB8fCBzb3V0aEVhc3QubGF0ID09PSBub3J0aFdlc3QubGF0KSB7CiAgICAgICAgaWYgKHJlc2l6ZU9uRmFpbCkgewogICAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5pbnZhbGlkYXRlU2l6ZSgpOwoKICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRMZWFmbGV0Qm91bmRzKGZhbHNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBib3VuZHM7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRCb3VuZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEJvdW5kcygpIHsKICAgICAgdmFyIGJvdW5kcyA9IHRoaXMuX2dldExlYWZsZXRCb3VuZHModHJ1ZSk7CgogICAgICBpZiAoIWJvdW5kcykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgc291dGhFYXN0ID0gYm91bmRzLmdldFNvdXRoRWFzdCgpOwogICAgICB2YXIgbm9ydGhXZXN0ID0gYm91bmRzLmdldE5vcnRoV2VzdCgpOwogICAgICB2YXIgc291dGhFYXN0TG5nID0gc291dGhFYXN0LmxuZzsKICAgICAgdmFyIG5vcnRoV2VzdExuZyA9IG5vcnRoV2VzdC5sbmc7CiAgICAgIHZhciBzb3V0aEVhc3RMYXQgPSBzb3V0aEVhc3QubGF0OwogICAgICB2YXIgbm9ydGhXZXN0TGF0ID0gbm9ydGhXZXN0LmxhdDsgLy8gV2hlbiBtYXAgaGFzIG5vdCB3aWR0aCBvciBoZWlnaHQsIHRoZSBtYXAgaGFzIG5vIGRpbWVuc2lvbnMuCiAgICAgIC8vIFRoZXNlIGRpbWVuc2lvbnMgYXJlIGVuZm9yY2VkIGR1ZSB0byBDU1Mgc3R5bGUgcnVsZXMgdGhhdCBlbmZvcmNlIG1pbi13aWR0aC9oZWlnaHQgb2YgMAogICAgICAvLyB0aGF0IGVuZm9yY2VtZW50IGFsc28gcmVzb2x2ZXMgZXJyb3JzIHdpdGggdGhlIGhlYXRtYXAgbGF5ZXIgcGx1Z2luLgoKICAgICAgcmV0dXJuIHsKICAgICAgICBib3R0b21fcmlnaHQ6IHsKICAgICAgICAgIGxhdDogc291dGhFYXN0TGF0LAogICAgICAgICAgbG9uOiBzb3V0aEVhc3RMbmcKICAgICAgICB9LAogICAgICAgIHRvcF9sZWZ0OiB7CiAgICAgICAgICBsYXQ6IG5vcnRoV2VzdExhdCwKICAgICAgICAgIGxvbjogbm9ydGhXZXN0TG5nCiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogInNldERlc2F0dXJhdGVCYXNlTGF5ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldERlc2F0dXJhdGVCYXNlTGF5ZXIoaXNEZXNhdHVyYXRlZCkgewogICAgICBpZiAoaXNEZXNhdHVyYXRlZCA9PT0gdGhpcy5fYmFzZUxheWVySXNEZXNhdHVyYXRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5fYmFzZUxheWVySXNEZXNhdHVyYXRlZCA9IGlzRGVzYXR1cmF0ZWQ7CgogICAgICB0aGlzLl91cGRhdGVEZXNhdHVyYXRpb24oKTsKCiAgICAgIGlmICh0aGlzLl9sZWFmbGV0QmFzZUxheWVyKSB7CiAgICAgICAgdGhpcy5fbGVhZmxldEJhc2VMYXllci5yZWRyYXcoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImFkZERyYXdDb250cm9sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGREcmF3Q29udHJvbCgpIHsKICAgICAgdmFyIGRyYXdDb2xvciA9ICcjMDAwJzsKICAgICAgdmFyIGRyYXdPcHRpb25zID0gewogICAgICAgIGRyYXc6IHsKICAgICAgICAgIHBvbHlsaW5lOiBmYWxzZSwKICAgICAgICAgIG1hcmtlcjogZmFsc2UsCiAgICAgICAgICBjaXJjbGU6IGZhbHNlLAogICAgICAgICAgcmVjdGFuZ2xlOiB7CiAgICAgICAgICAgIHNoYXBlT3B0aW9uczogewogICAgICAgICAgICAgIHN0cm9rZTogZmFsc2UsCiAgICAgICAgICAgICAgY29sb3I6IGRyYXdDb2xvcgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgcG9seWdvbjogewogICAgICAgICAgICBzaGFwZU9wdGlvbnM6IHsKICAgICAgICAgICAgICBjb2xvcjogZHJhd0NvbG9yCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBjaXJjbGVtYXJrZXI6IGZhbHNlCiAgICAgICAgfQogICAgICB9OwogICAgICB0aGlzLl9sZWFmbGV0RHJhd0NvbnRyb2wgPSBuZXcgX2xlYWZsZXQuZGVmYXVsdC5Db250cm9sLkRyYXcoZHJhd09wdGlvbnMpOwoKICAgICAgdGhpcy5fbGVhZmxldE1hcC5hZGRDb250cm9sKHRoaXMuX2xlYWZsZXREcmF3Q29udHJvbCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRkRml0Q29udHJvbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRml0Q29udHJvbCgpIHsKICAgICAgaWYgKHRoaXMuX2xlYWZsZXRGaXRDb250cm9sIHx8ICF0aGlzLl9sZWFmbGV0TWFwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZml0Q29udGFpbmVyID0gX2xlYWZsZXQuZGVmYXVsdC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgJ2xlYWZsZXQtY29udHJvbCBsZWFmbGV0LWJhciBsZWFmbGV0LWNvbnRyb2wtZml0Jyk7CgogICAgICB0aGlzLl9sZWFmbGV0Rml0Q29udHJvbCA9IG1ha2VGaXRDb250cm9sKGZpdENvbnRhaW5lciwgdGhpcyk7CgogICAgICB0aGlzLl9sZWFmbGV0TWFwLmFkZENvbnRyb2wodGhpcy5fbGVhZmxldEZpdENvbnRyb2wpOwogICAgfQogIH0sIHsKICAgIGtleTogImFkZExlZ2VuZENvbnRyb2wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZExlZ2VuZENvbnRyb2woKSB7CiAgICAgIGlmICh0aGlzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCB8fCAhdGhpcy5fbGVhZmxldE1hcCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5fdXBkYXRlTGVnZW5kKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TGVnZW5kUG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldExlZ2VuZFBvc2l0aW9uKHBvc2l0aW9uKSB7CiAgICAgIGlmICh0aGlzLl9sZWdlbmRQb3NpdGlvbiA9PT0gcG9zaXRpb24pIHsKICAgICAgICBpZiAoIXRoaXMuX2xlYWZsZXRMZWdlbmRDb250cm9sKSB7CiAgICAgICAgICB0aGlzLl91cGRhdGVMZWdlbmQoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fbGVnZW5kUG9zaXRpb24gPSBwb3NpdGlvbjsKCiAgICAgICAgdGhpcy5fdXBkYXRlTGVnZW5kKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfdXBkYXRlTGVnZW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlTGVnZW5kKCkgewogICAgICBpZiAodGhpcy5fbGVhZmxldExlZ2VuZENvbnRyb2wpIHsKICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnJlbW92ZUNvbnRyb2wodGhpcy5fbGVhZmxldExlZ2VuZENvbnRyb2wpOwogICAgICB9CgogICAgICB2YXIgJHdyYXBwZXIgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KSgnPGRpdj4nKS5hZGRDbGFzcygndmlzTWFwTGVnZW5kX193cmFwcGVyJyk7CiAgICAgIHRoaXMuX2xlYWZsZXRMZWdlbmRDb250cm9sID0gbWFrZUxlZ2VuZENvbnRyb2woJHdyYXBwZXIsIHRoaXMsIHRoaXMuX2xlZ2VuZFBvc2l0aW9uKTsKCiAgICAgIHRoaXMuX2xlYWZsZXRNYXAuYWRkQ29udHJvbCh0aGlzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVzaXplIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXNpemUoKSB7CiAgICAgIHRoaXMuX2xlYWZsZXRNYXAuaW52YWxpZGF0ZVNpemUoKTsKCiAgICAgIHRoaXMuX3VwZGF0ZUV4dGVudCgpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldE1pblpvb20iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldE1pblpvb20oem9vbSkgewogICAgICB0aGlzLl9sZWFmbGV0TWFwLnNldE1pblpvb20oem9vbSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TWF4Wm9vbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TWF4Wm9vbSh6b29tKSB7CiAgICAgIHRoaXMuX2xlYWZsZXRNYXAuc2V0TWF4Wm9vbSh6b29tKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMZWFmbGV0QmFzZUxheWVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMZWFmbGV0QmFzZUxheWVyKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVhZmxldEJhc2VMYXllcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRCYXNlTGF5ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEJhc2VMYXllcihzZXR0aW5ncykgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGlmIChfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChzZXR0aW5ncywgdGhpcy5fYmFzZUxheWVyU2V0dGluZ3MpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2V0dGluZ3MgPT09IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5fbGVhZmxldEJhc2VMYXllciAmJiB0aGlzLl9sZWFmbGV0TWFwKSB7CiAgICAgICAgICB0aGlzLl9yZW1vdmVBdHRyaWJ1dGlvbnModGhpcy5fYmFzZUxheWVyU2V0dGluZ3Mub3B0aW9ucy5hdHRyaWJ1dGlvbik7CgogICAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5yZW1vdmVMYXllcih0aGlzLl9sZWFmbGV0QmFzZUxheWVyKTsKCiAgICAgICAgICB0aGlzLl9sZWFmbGV0QmFzZUxheWVyID0gbnVsbDsKICAgICAgICAgIHRoaXMuX2Jhc2VMYXllclNldHRpbmdzID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5fYmFzZUxheWVyU2V0dGluZ3MgPSBzZXR0aW5nczsKCiAgICAgIGlmICh0aGlzLl9sZWFmbGV0QmFzZUxheWVyKSB7CiAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5yZW1vdmVMYXllcih0aGlzLl9sZWFmbGV0QmFzZUxheWVyKTsKCiAgICAgICAgdGhpcy5fbGVhZmxldEJhc2VMYXllciA9IG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBiYXNlTGF5ZXI7CgogICAgICBpZiAoc2V0dGluZ3MuYmFzZUxheWVyVHlwZSA9PT0gJ3dtcycpIHsKICAgICAgICAvL1RoaXMgaXMgdXNlci1pbnB1dCB0aGF0IGlzIHJlbmRlcmVkIHdpdGggdGhlIExlYWZsZXQgYXR0cmlidXRpb24gY29udHJvbC4gTmVlZHMgdG8gYmUgc2FuaXRpemVkLgogICAgICAgIHRoaXMuX2Jhc2VMYXllclNldHRpbmdzLm9wdGlvbnMuYXR0cmlidXRpb24gPSBfbG9kYXNoLmRlZmF1bHQuZXNjYXBlKHNldHRpbmdzLm9wdGlvbnMuYXR0cmlidXRpb24pOwogICAgICAgIGJhc2VMYXllciA9IHRoaXMuX2dldFdNU0Jhc2VMYXllcihzZXR0aW5ncy5vcHRpb25zKTsKICAgICAgfSBlbHNlIGlmIChzZXR0aW5ncy5iYXNlTGF5ZXJUeXBlID09PSAndG1zJykgewogICAgICAgIGJhc2VMYXllciA9IHRoaXMuX2dldFRNU0Jhc2VMYXllcihzZXR0aW5ncy5vcHRpb25zKTsKICAgICAgfQoKICAgICAgaWYgKGJhc2VMYXllcikgewogICAgICAgIGJhc2VMYXllci5vbigndGlsZWxvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXM4Ll91cGRhdGVEZXNhdHVyYXRpb24oKTsKICAgICAgICB9KTsKICAgICAgICBiYXNlTGF5ZXIub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczguZW1pdCgnYmFzZUxheWVyOmxvYWRlZCcpOwogICAgICAgIH0pOwogICAgICAgIGJhc2VMYXllci5vbignbG9hZGluZycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzOC5lbWl0KCdiYXNlTGF5ZXI6bG9hZGluZycpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIgPSBiYXNlTGF5ZXI7CgogICAgICAgIGlmIChzZXR0aW5ncy5vcHRpb25zLnNob3dab29tTWVzc2FnZSkgewogICAgICAgICAgYmFzZUxheWVyLm9uKCdhZGQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzOC5fYWRkTWF4Wm9vbU1lc3NhZ2UoYmFzZUxheWVyKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fbGVhZmxldEJhc2VMYXllci5hZGRUbyh0aGlzLl9sZWFmbGV0TWFwKTsKCiAgICAgICAgdGhpcy5fbGVhZmxldEJhc2VMYXllci5icmluZ1RvQmFjaygpOwoKICAgICAgICBpZiAoc2V0dGluZ3Mub3B0aW9ucy5taW5ab29tID4gdGhpcy5fbGVhZmxldE1hcC5nZXRab29tKCkpIHsKICAgICAgICAgIHRoaXMuX2xlYWZsZXRNYXAuc2V0Wm9vbShzZXR0aW5ncy5vcHRpb25zLm1pblpvb20pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fYWRkQXR0cmlidXRpb25zKHNldHRpbmdzLm9wdGlvbnMuYXR0cmlidXRpb24pOwoKICAgICAgICB0aGlzLnJlc2l6ZSgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNJbnNpZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzSW5zaWRlKGJ1Y2tldFJlY3RCb3VuZHMpIHsKICAgICAgdmFyIG1hcEJvdW5kcyA9IHRoaXMuX2xlYWZsZXRNYXAuZ2V0Qm91bmRzKCk7CgogICAgICByZXR1cm4gbWFwQm91bmRzLmludGVyc2VjdHMoYnVja2V0UmVjdEJvdW5kcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZml0VG9EYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaXRUb0RhdGEoKSB7CiAgICAgIHZhciBib3VuZHNBcnJheSwgYm91bmRzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIGZpdFRvRGF0YSQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWYgKHRoaXMuX2xlYWZsZXRNYXApIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKFByb21pc2UuYWxsKHRoaXMuX2xheWVycy5tYXAoZnVuY3Rpb24gX2NhbGxlZShsYXllcikgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAobGF5ZXIuZ2V0Qm91bmRzKCkpOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQuc2VudCk7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pKSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgYm91bmRzQXJyYXkgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICBib3VuZHMgPSBudWxsOwogICAgICAgICAgICAgIGJvdW5kc0FycmF5LmZvckVhY2goZnVuY3Rpb24gX2NhbGxlZTIoYikgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChib3VuZHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBib3VuZHMuZXh0ZW5kKGIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kcyA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoYm91bmRzICYmIGJvdW5kcy5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2xlYWZsZXRNYXAuZml0Qm91bmRzKGJvdW5kcyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgdGhpcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2dldFRNU0Jhc2VMYXllciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldFRNU0Jhc2VMYXllcihvcHRpb25zKSB7CiAgICAgIHJldHVybiBfbGVhZmxldC5kZWZhdWx0LnRpbGVMYXllcihvcHRpb25zLnVybCwgewogICAgICAgIG1pblpvb206IG9wdGlvbnMubWluWm9vbSwKICAgICAgICBtYXhab29tOiBvcHRpb25zLm1heFpvb20sCiAgICAgICAgc3ViZG9tYWluczogb3B0aW9ucy5zdWJkb21haW5zIHx8IFtdCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRXTVNCYXNlTGF5ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRXTVNCYXNlTGF5ZXIob3B0aW9ucykgewogICAgICB2YXIgd21zT3B0aW9ucyA9IHsKICAgICAgICBmb3JtYXQ6IG9wdGlvbnMuZm9ybWF0IHx8ICcnLAogICAgICAgIGxheWVyczogb3B0aW9ucy5sYXllcnMgfHwgJycsCiAgICAgICAgbWluWm9vbTogb3B0aW9ucy5taW5ab29tLAogICAgICAgIG1heFpvb206IG9wdGlvbnMubWF4Wm9vbSwKICAgICAgICBzdHlsZXM6IG9wdGlvbnMuc3R5bGVzIHx8ICcnLAogICAgICAgIHRyYW5zcGFyZW50OiBvcHRpb25zLnRyYW5zcGFyZW50LAogICAgICAgIHZlcnNpb246IG9wdGlvbnMudmVyc2lvbiB8fCAnMS4zLjAnCiAgICAgIH07CiAgICAgIHJldHVybiB0eXBlb2Ygb3B0aW9ucy51cmwgPT09ICdzdHJpbmcnICYmIG9wdGlvbnMudXJsLmxlbmd0aCA/IF9sZWFmbGV0LmRlZmF1bHQudGlsZUxheWVyLndtcyhvcHRpb25zLnVybCwgd21zT3B0aW9ucykgOiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogIl91cGRhdGVFeHRlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF91cGRhdGVFeHRlbnQoKSB7CiAgICAgIHRoaXMuX2xheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBsYXllci51cGRhdGVFeHRlbnQoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3VwZGF0ZURlc2F0dXJhdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZURlc2F0dXJhdGlvbigpIHsKICAgICAgdmFyIHRpbGVzID0gKDAsIF9qcXVlcnkuZGVmYXVsdCkoJ2ltZy5sZWFmbGV0LXRpbGUtbG9hZGVkJyk7IC8vIERvbid0IGFwcGx5IGNsaWVudC1zaWRlIHN0eWxpbmcgdG8gRU1TIGJhc2VtYXBzCgogICAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmdldCh0aGlzLl9iYXNlTGF5ZXJTZXR0aW5ncywgJ29wdGlvbnMub3JpZ2luJykgPT09IF9vcmlnaW4uT1JJR0lOLkVNUykgewogICAgICAgIHRpbGVzLmFkZENsYXNzKCdmaWx0ZXJzLW9mZicpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLl9iYXNlTGF5ZXJJc0Rlc2F0dXJhdGVkKSB7CiAgICAgICAgICB0aWxlcy5yZW1vdmVDbGFzcygnZmlsdGVycy1vZmYnKTsKICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLl9iYXNlTGF5ZXJJc0Rlc2F0dXJhdGVkKSB7CiAgICAgICAgICB0aWxlcy5hZGRDbGFzcygnZmlsdGVycy1vZmYnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJwZXJzaXN0VWlTdGF0ZUZvclZpc3VhbGl6YXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBlcnNpc3RVaVN0YXRlRm9yVmlzdWFsaXphdGlvbih2aXN1YWxpemF0aW9uKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgZnVuY3Rpb24gcGVyc2lzdE1hcFN0YXRlSW5VaVN0YXRlKCkgewogICAgICAgIHZhciB1aVN0YXRlID0gdmlzdWFsaXphdGlvbi5nZXRVaVN0YXRlKCk7CiAgICAgICAgdmFyIGNlbnRlckZyb21VSVN0YXRlID0gdWlTdGF0ZS5nZXQoJ21hcENlbnRlcicpOwogICAgICAgIHZhciB6b29tRnJvbVVpU3RhdGUgPSBwYXJzZUludCh1aVN0YXRlLmdldCgnbWFwWm9vbScpKTsKCiAgICAgICAgaWYgKGlzTmFOKHpvb21Gcm9tVWlTdGF0ZSkgfHwgdGhpcy5nZXRab29tTGV2ZWwoKSAhPT0gem9vbUZyb21VaVN0YXRlKSB7CiAgICAgICAgICB2aXN1YWxpemF0aW9uLnVpU3RhdGVWYWwoJ21hcFpvb20nLCB0aGlzLmdldFpvb21MZXZlbCgpKTsKICAgICAgICB9CgogICAgICAgIHZhciBjZW50ZXJGcm9tTWFwID0gdGhpcy5nZXRDZW50ZXIoKTsKCiAgICAgICAgaWYgKCFjZW50ZXJGcm9tVUlTdGF0ZSB8fCBjZW50ZXJGcm9tTWFwLmxvbiAhPT0gY2VudGVyRnJvbVVJU3RhdGVbMV0gfHwgY2VudGVyRnJvbU1hcC5sYXQgIT09IGNlbnRlckZyb21VSVN0YXRlWzBdKSB7CiAgICAgICAgICB2aXN1YWxpemF0aW9uLnVpU3RhdGVWYWwoJ21hcENlbnRlcicsIFtjZW50ZXJGcm9tTWFwLmxhdCwgY2VudGVyRnJvbU1hcC5sb25dKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuX2xlYWZsZXRNYXAub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2aXN1YWxpemF0aW9uLnNlc3Npb25TdGF0ZS5tYXBCb3VuZHMgPSBfdGhpczkuZ2V0Qm91bmRzKCk7CiAgICAgIH0pOwoKICAgICAgdGhpcy5fbGVhZmxldE1hcC5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2aXN1YWxpemF0aW9uLnNlc3Npb25TdGF0ZS5tYXBCb3VuZHMgPSBfdGhpczkuZ2V0Qm91bmRzKCk7CiAgICAgIH0pOwoKICAgICAgdGhpcy5vbignZHJhZ2VuZCcsIHBlcnNpc3RNYXBTdGF0ZUluVWlTdGF0ZSk7CiAgICAgIHRoaXMub24oJ3pvb21lbmQnLCBwZXJzaXN0TWFwU3RhdGVJblVpU3RhdGUpOwogICAgfQogIH0sIHsKICAgIGtleTogInVzZVVpU3RhdGVGcm9tVmlzdWFsaXphdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXNlVWlTdGF0ZUZyb21WaXN1YWxpemF0aW9uKHZpc3VhbGl6YXRpb24pIHsKICAgICAgdmFyIHVpU3RhdGUgPSB2aXN1YWxpemF0aW9uLmdldFVpU3RhdGUoKTsKICAgICAgdmFyIHpvb21Gcm9tVWlTdGF0ZSA9IHBhcnNlSW50KHVpU3RhdGUuZ2V0KCdtYXBab29tJykpOwogICAgICB2YXIgY2VudGVyRnJvbVVJU3RhdGUgPSB1aVN0YXRlLmdldCgnbWFwQ2VudGVyJyk7CgogICAgICBpZiAoIWlzTmFOKHpvb21Gcm9tVWlTdGF0ZSkpIHsKICAgICAgICB0aGlzLnNldFpvb21MZXZlbCh6b29tRnJvbVVpU3RhdGUpOwogICAgICB9CgogICAgICBpZiAoY2VudGVyRnJvbVVJU3RhdGUpIHsKICAgICAgICB0aGlzLnNldENlbnRlcihjZW50ZXJGcm9tVUlTdGF0ZVswXSwgY2VudGVyRnJvbVVJU3RhdGVbMV0pOwogICAgICB9CiAgICB9CiAgfV0pOwoKICByZXR1cm4gS2liYW5hTWFwOwp9KF9ldmVudHMuRXZlbnRFbWl0dGVyKTsKCmV4cG9ydHMuS2liYW5hTWFwID0gS2liYW5hTWFwOwoKZnVuY3Rpb24gZ2V0QXR0cmlidXRpb25BcnJheShhdHRyaWJ1dGlvbikgewogIHZhciBhdHRyaWJ1dGlvblN0cmluZyA9IGF0dHJpYnV0aW9uIHx8ICcnOwogIHZhciBhdHRyaWJ1dGlvbnMgPSBhdHRyaWJ1dGlvblN0cmluZy5zcGxpdCgvXHMqXHxccyovKTsKCiAgaWYgKGF0dHJpYnV0aW9ucy5sZW5ndGggPT09IDEpIHsKICAgIC8vdGVtcCB3b3JrLWFyb3VuZCBkdWUgdG8gaW5jb25zaXN0ZW5jeSBpbiBtYW5pZmVzdHMgb2YgaG93IGF0dHJpYnV0aW9ucyBhcmUgZGVsaW1pdGVkCiAgICBhdHRyaWJ1dGlvbnMgPSBhdHRyaWJ1dGlvbnNbMF0uc3BsaXQoJywnKTsKICB9CgogIHJldHVybiBhdHRyaWJ1dGlvbnM7Cn0="},null]}