{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/security/public/views/management/role_mappings/role_mappings_grid/components/role_mappings_grid_page.js","dependencies":[{"path":"x-pack/legacy/plugins/security/public/views/management/role_mappings/role_mappings_grid/components/role_mappings_grid_page.js","mtime":1585205047276},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuUm9sZU1hcHBpbmdzR3JpZFBhZ2UgPSB2b2lkIDA7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3JlYWN0MiA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9lbXB0eV9wcm9tcHQgPSByZXF1aXJlKCIuL2VtcHR5X3Byb21wdCIpOwoKdmFyIF9jb21wb25lbnRzID0gcmVxdWlyZSgiLi4vLi4vY29tcG9uZW50cyIpOwoKdmFyIF9kb2N1bWVudGF0aW9uX2xpbmtzID0gcmVxdWlyZSgiLi4vLi4vc2VydmljZXMvZG9jdW1lbnRhdGlvbl9saW5rcyIpOwoKdmFyIF9tYW5hZ2VtZW50X3VybHMgPSByZXF1aXJlKCIuLi8uLi8uLi9tYW5hZ2VtZW50X3VybHMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgfTsKICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwp9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsKICBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7CiAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwogIH0KCiAgcmV0dXJuIHNlbGY7Cn0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgewogIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOwogIH0KCiAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICBjb25zdHJ1Y3RvcjogewogICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0KICB9KTsKICBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsKfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICAgIG8uX19wcm90b19fID0gcDsKICAgIHJldHVybiBvOwogIH07CgogIHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9Cgp2YXIgUm9sZU1hcHBpbmdzR3JpZFBhZ2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKFJvbGVNYXBwaW5nc0dyaWRQYWdlLCBfQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gUm9sZU1hcHBpbmdzR3JpZFBhZ2UocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUm9sZU1hcHBpbmdzR3JpZFBhZ2UpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFJvbGVNYXBwaW5nc0dyaWRQYWdlKS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyVGFibGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZSA9IF90aGlzLnN0YXRlLAogICAgICAgICAgcm9sZU1hcHBpbmdzID0gX3RoaXMkc3RhdGUucm9sZU1hcHBpbmdzLAogICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IF90aGlzJHN0YXRlLnNlbGVjdGVkSXRlbXMsCiAgICAgICAgICBsb2FkU3RhdGUgPSBfdGhpcyRzdGF0ZS5sb2FkU3RhdGU7CiAgICAgIHZhciBtZXNzYWdlID0gbG9hZFN0YXRlID09PSAnbG9hZGluZ1RhYmxlJyA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LnJvbGVNYXBwaW5ncy5yb2xlTWFwcGluZ1RhYmxlTG9hZGluZ01lc3NhZ2UiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiTG9hZGluZyByb2xlIG1hcHBpbmdzXHUyMDI2IgogICAgICB9KSA6IHVuZGVmaW5lZDsKICAgICAgdmFyIHNvcnRpbmcgPSB7CiAgICAgICAgc29ydDogewogICAgICAgICAgZmllbGQ6ICduYW1lJywKICAgICAgICAgIGRpcmVjdGlvbjogJ2FzYycKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBwYWdpbmF0aW9uID0gewogICAgICAgIGluaXRpYWxQYWdlU2l6ZTogMjAsCiAgICAgICAgcGFnZVNpemVPcHRpb25zOiBbMTAsIDIwLCA1MF0KICAgICAgfTsKICAgICAgdmFyIHNlbGVjdGlvbiA9IHsKICAgICAgICBvblNlbGVjdGlvbkNoYW5nZTogZnVuY3Rpb24gb25TZWxlY3Rpb25DaGFuZ2UobmV3U2VsZWN0ZWRJdGVtcykgewogICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICBzZWxlY3RlZEl0ZW1zOiBuZXdTZWxlY3RlZEl0ZW1zCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBzZWFyY2ggPSB7CiAgICAgICAgdG9vbHNMZWZ0OiBzZWxlY3RlZEl0ZW1zLmxlbmd0aCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NvbXBvbmVudHMuRGVsZXRlUHJvdmlkZXIsIHsKICAgICAgICAgIHJvbGVNYXBwaW5nc0FQSTogX3RoaXMucHJvcHMucm9sZU1hcHBpbmdzQVBJCiAgICAgICAgfSwgZnVuY3Rpb24gKGRlbGV0ZVJvbGVNYXBwaW5nc1Byb21wdCkgewogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gZGVsZXRlUm9sZU1hcHBpbmdzUHJvbXB0KHNlbGVjdGVkSXRlbXMsIF90aGlzLm9uUm9sZU1hcHBpbmdzRGVsZXRlZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbG9yOiAiZGFuZ2VyIiwKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImJ1bGtEZWxldGVBY3Rpb25CdXR0b24iCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQucm9sZU1hcHBpbmdzLmRlbGV0ZVJvbGVNYXBwaW5nQnV0dG9uIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJEZWxldGUge2NvdW50LCBwbHVyYWwsIG9uZSB7cm9sZSBtYXBwaW5nfSBvdGhlciB7cm9sZSBtYXBwaW5nc319IiwKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgY291bnQ6IHNlbGVjdGVkSXRlbXMubGVuZ3RoCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9KSA6IHVuZGVmaW5lZCwKICAgICAgICB0b29sc1JpZ2h0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgICBjb2xvcjogInNlY29uZGFyeSIsCiAgICAgICAgICBpY29uVHlwZTogInJlZnJlc2giLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlbG9hZFJvbGVNYXBwaW5ncygpOwogICAgICAgICAgfSwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJyZWxvYWRCdXR0b24iCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5yb2xlTWFwcGluZ3MucmVsb2FkUm9sZU1hcHBpbmdzQnV0dG9uIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUmVsb2FkIgogICAgICAgIH0pKSwKICAgICAgICBib3g6IHsKICAgICAgICAgIGluY3JlbWVudGFsOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBmaWx0ZXJzOiB1bmRlZmluZWQKICAgICAgfTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlJbk1lbW9yeVRhYmxlLCB7CiAgICAgICAgaXRlbXM6IHJvbGVNYXBwaW5ncywKICAgICAgICBpdGVtSWQ6ICJuYW1lIiwKICAgICAgICBjb2x1bW5zOiBfdGhpcy5nZXRDb2x1bW5Db25maWcoKSwKICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICBzb3J0aW5nOiBzb3J0aW5nLAogICAgICAgIHNlbGVjdGlvbjogc2VsZWN0aW9uLAogICAgICAgIHBhZ2luYXRpb246IHBhZ2luYXRpb24sCiAgICAgICAgbG9hZGluZzogbG9hZFN0YXRlID09PSAnbG9hZGluZ1RhYmxlJywKICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLAogICAgICAgIGlzU2VsZWN0YWJsZTogdHJ1ZSwKICAgICAgICByb3dQcm9wczogZnVuY3Rpb24gcm93UHJvcHMoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnZGF0YS10ZXN0LXN1YmonOiAncm9sZU1hcHBpbmdSb3cnCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRDb2x1bW5Db25maWciLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjb25maWcgPSBbewogICAgICAgIGZpZWxkOiAnbmFtZScsCiAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQucm9sZU1hcHBpbmdzLm5hbWVDb2x1bW5OYW1lJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdOYW1lJwogICAgICAgIH0pLAogICAgICAgIHNvcnRhYmxlOiB0cnVlLAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKHJvbGVNYXBwaW5nTmFtZSkgewogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMaW5rLCB7CiAgICAgICAgICAgIGhyZWY6ICgwLCBfbWFuYWdlbWVudF91cmxzLmdldEVkaXRSb2xlTWFwcGluZ0hyZWYpKHJvbGVNYXBwaW5nTmFtZSksCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJyb2xlTWFwcGluZ05hbWUiCiAgICAgICAgICB9LCByb2xlTWFwcGluZ05hbWUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGZpZWxkOiAncm9sZXMnLAogICAgICAgIG5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LnJvbGVNYXBwaW5ncy5yb2xlc0NvbHVtbk5hbWUnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1JvbGVzJwogICAgICAgIH0pLAogICAgICAgIHNvcnRhYmxlOiB0cnVlLAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGVudHJ5LCByZWNvcmQpIHsKICAgICAgICAgIHZhciBfcmVjb3JkJHJvbGVzID0gcmVjb3JkLnJvbGVzLAogICAgICAgICAgICAgIHJvbGVzID0gX3JlY29yZCRyb2xlcyA9PT0gdm9pZCAwID8gW10gOiBfcmVjb3JkJHJvbGVzLAogICAgICAgICAgICAgIF9yZWNvcmQkcm9sZV90ZW1wbGF0ZSA9IHJlY29yZC5yb2xlX3RlbXBsYXRlcywKICAgICAgICAgICAgICByb2xlVGVtcGxhdGVzID0gX3JlY29yZCRyb2xlX3RlbXBsYXRlID09PSB2b2lkIDAgPyBbXSA6IF9yZWNvcmQkcm9sZV90ZW1wbGF0ZTsKCiAgICAgICAgICBpZiAocm9sZVRlbXBsYXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJyb2xlTWFwcGluZ1JvbGVzIgogICAgICAgICAgICB9LCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5yb2xlTWFwcGluZ3Mucm9sZVRlbXBsYXRlcycsIHsKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ3t0ZW1wbGF0ZUNvdW50LCBwbHVyYWwsIG9uZXsjIHJvbGUgdGVtcGxhdGV9IG90aGVyIHsjIHJvbGUgdGVtcGxhdGVzfX0gZGVmaW5lZCcsCiAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICB0ZW1wbGF0ZUNvdW50OiByb2xlVGVtcGxhdGVzLmxlbmd0aAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByb2xlTGlua3MgPSByb2xlcy5tYXAoZnVuY3Rpb24gKHJvbGVuYW1lLCBpbmRleCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIHsKICAgICAgICAgICAgICBrZXk6IHJvbGVuYW1lCiAgICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMaW5rLCB7CiAgICAgICAgICAgICAgaHJlZjogKDAsIF9tYW5hZ2VtZW50X3VybHMuZ2V0RWRpdFJvbGVIcmVmKShyb2xlbmFtZSkKICAgICAgICAgICAgfSwgcm9sZW5hbWUpLCBpbmRleCA9PT0gcm9sZXMubGVuZ3RoIC0gMSA/IG51bGwgOiAnLCAnKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInJvbGVNYXBwaW5nUm9sZXMiCiAgICAgICAgICB9LCByb2xlTGlua3MpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGZpZWxkOiAnZW5hYmxlZCcsCiAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQucm9sZU1hcHBpbmdzLmVuYWJsZWRDb2x1bW5OYW1lJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFbmFibGVkJwogICAgICAgIH0pLAogICAgICAgIHNvcnRhYmxlOiB0cnVlLAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGVuYWJsZWQpIHsKICAgICAgICAgIGlmIChlbmFibGVkKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQmFkZ2UsIHsKICAgICAgICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAicm9sZU1hcHBpbmdFbmFibGVkIiwKICAgICAgICAgICAgICBjb2xvcjogInNlY29uZGFyeSIKICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQucm9sZU1hcHBpbmdzLmVuYWJsZWRCYWRnZSIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJFbmFibGVkIgogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCYWRnZSwgewogICAgICAgICAgICBjb2xvcjogImhvbGxvdyIsCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJyb2xlTWFwcGluZ0VuYWJsZWQiCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQucm9sZU1hcHBpbmdzLmRpc2FibGVkQmFkZ2UiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRpc2FibGVkIgogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIG5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LnJvbGVNYXBwaW5ncy5hY3Rpb25zQ29sdW1uTmFtZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQWN0aW9ucycKICAgICAgICB9KSwKICAgICAgICBhY3Rpb25zOiBbewogICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIocmVjb3JkKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVG9vbFRpcCwgewogICAgICAgICAgICAgIGNvbnRlbnQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LnJvbGVNYXBwaW5ncy5hY3Rpb25FZGl0VG9vbHRpcCcsIHsKICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRWRpdCcKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uSWNvbiwgewogICAgICAgICAgICAgICJhcmlhLWxhYmVsIjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQucm9sZU1hcHBpbmdzLmFjdGlvbkVkaXRBcmlhTGFiZWwnLCB7CiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkVkaXQgJ3tuYW1lfSciLAogICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgIG5hbWU6IHJlY29yZC5uYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaWNvblR5cGU6ICJwZW5jaWwiLAogICAgICAgICAgICAgIGNvbG9yOiAicHJpbWFyeSIsCiAgICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRSb2xlTWFwcGluZ0J1dHRvbi0iLmNvbmNhdChyZWNvcmQubmFtZSksCiAgICAgICAgICAgICAgaHJlZjogKDAsIF9tYW5hZ2VtZW50X3VybHMuZ2V0RWRpdFJvbGVNYXBwaW5nSHJlZikocmVjb3JkLm5hbWUpCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihyZWNvcmQpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICAgICAgICBndXR0ZXJTaXplOiAicyIKICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jb21wb25lbnRzLkRlbGV0ZVByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgcm9sZU1hcHBpbmdzQVBJOiBfdGhpcy5wcm9wcy5yb2xlTWFwcGluZ3NBUEkKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGRlbGV0ZVJvbGVNYXBwaW5nUHJvbXB0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUb29sVGlwLCB7CiAgICAgICAgICAgICAgICBjb250ZW50OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5yb2xlTWFwcGluZ3MuYWN0aW9uRGVsZXRlVG9vbHRpcCcsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEZWxldGUnCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25JY29uLCB7CiAgICAgICAgICAgICAgICAiYXJpYS1sYWJlbCI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LnJvbGVNYXBwaW5ncy5hY3Rpb25EZWxldGVBcmlhTGFiZWwnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVsZXRlICd7bmFtZX0nIiwKICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGljb25UeXBlOiAidHJhc2giLAogICAgICAgICAgICAgICAgY29sb3I6ICJkYW5nZXIiLAogICAgICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImRlbGV0ZVJvbGVNYXBwaW5nQnV0dG9uLSIuY29uY2F0KHJlY29yZC5uYW1lKSwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxldGVSb2xlTWFwcGluZ1Byb21wdChbcmVjb3JkXSwgX3RoaXMub25Sb2xlTWFwcGluZ3NEZWxldGVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0pKSk7CiAgICAgICAgICB9CiAgICAgICAgfV0KICAgICAgfV07CiAgICAgIHJldHVybiBjb25maWc7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblJvbGVNYXBwaW5nc0RlbGV0ZWQiLCBmdW5jdGlvbiAocm9sZU1hcHBpbmdzKSB7CiAgICAgIGlmIChyb2xlTWFwcGluZ3MubGVuZ3RoKSB7CiAgICAgICAgX3RoaXMucmVsb2FkUm9sZU1hcHBpbmdzKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbG9hZFJvbGVNYXBwaW5ncyIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHJvbGVNYXBwaW5nczogW10sCiAgICAgICAgbG9hZFN0YXRlOiAnbG9hZGluZ1RhYmxlJwogICAgICB9KTsKCiAgICAgIF90aGlzLmxvYWRSb2xlTWFwcGluZ3MoKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImxvYWRSb2xlTWFwcGluZ3MiLCBmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgcm9sZU1hcHBpbmdzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAwOwogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX3RoaXMucHJvcHMucm9sZU1hcHBpbmdzQVBJLmdldFJvbGVNYXBwaW5ncygpKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICByb2xlTWFwcGluZ3MgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICByb2xlTWFwcGluZ3M6IHJvbGVNYXBwaW5ncwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDc7CiAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgwKTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgZXJyb3I6IF9jb250ZXh0LnQwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGxvYWRTdGF0ZTogJ2ZpbmlzaGVkJwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgbnVsbCwgW1swLCA3XV0pOwogICAgfSk7CgogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIGxvYWRTdGF0ZTogJ2xvYWRpbmdBcHAnLAogICAgICByb2xlTWFwcGluZ3M6IG51bGwsCiAgICAgIGhhc0NvbXBhdGlibGVSZWFsbXM6IHRydWUsCiAgICAgIHNlbGVjdGVkSXRlbXM6IFtdLAogICAgICBlcnJvcjogdW5kZWZpbmVkCiAgICB9OwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFJvbGVNYXBwaW5nc0dyaWRQYWdlLCBbewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICB0aGlzLmNoZWNrUHJpdmlsZWdlcygpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUyID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGxvYWRTdGF0ZSA9IF90aGlzJHN0YXRlMi5sb2FkU3RhdGUsCiAgICAgICAgICBlcnJvciA9IF90aGlzJHN0YXRlMi5lcnJvciwKICAgICAgICAgIHJvbGVNYXBwaW5ncyA9IF90aGlzJHN0YXRlMi5yb2xlTWFwcGluZ3M7CgogICAgICBpZiAobG9hZFN0YXRlID09PSAncGVybWlzc2lvbkRlbmllZCcpIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY29tcG9uZW50cy5QZXJtaXNzaW9uRGVuaWVkLCBudWxsKTsKICAgICAgfQoKICAgICAgaWYgKGxvYWRTdGF0ZSA9PT0gJ2xvYWRpbmdBcHAnKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQYWdlQ29udGVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY29tcG9uZW50cy5TZWN0aW9uTG9hZGluZywgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5yb2xlTWFwcGluZ3MubG9hZGluZ1JvbGVNYXBwaW5nc0Rlc2NyaXB0aW9uIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiTG9hZGluZyByb2xlIG1hcHBpbmdzXHUyMDI2IgogICAgICAgIH0pKSk7CiAgICAgIH0KCiAgICAgIGlmIChlcnJvcikgewogICAgICAgIHZhciBfZXJyb3IkYm9keSA9IGVycm9yLmJvZHksCiAgICAgICAgICAgIGVycm9yVGl0bGUgPSBfZXJyb3IkYm9keS5lcnJvciwKICAgICAgICAgICAgbWVzc2FnZSA9IF9lcnJvciRib2R5Lm1lc3NhZ2UsCiAgICAgICAgICAgIHN0YXR1c0NvZGUgPSBfZXJyb3IkYm9keS5zdGF0dXNDb2RlOwogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LnJvbGVNYXBwaW5ncy5sb2FkaW5nUm9sZU1hcHBpbmdzRXJyb3JUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXJyb3IgbG9hZGluZyBSb2xlIG1hcHBpbmdzIgogICAgICAgICAgfSksCiAgICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgICBpY29uVHlwZTogImFsZXJ0IgogICAgICAgIH0sIHN0YXR1c0NvZGUsICI6ICIsIGVycm9yVGl0bGUsICIgLSAiLCBtZXNzYWdlKSk7CiAgICAgIH0KCiAgICAgIGlmIChsb2FkU3RhdGUgPT09ICdmaW5pc2hlZCcgJiYgcm9sZU1hcHBpbmdzICYmIHJvbGVNYXBwaW5ncy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhZ2VDb250ZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9lbXB0eV9wcm9tcHQuRW1wdHlQcm9tcHQsIG51bGwpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQYWdlQ29udGVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhZ2VDb250ZW50SGVhZGVyLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnRIZWFkZXJTZWN0aW9uLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQucm9sZU1hcHBpbmdzLnJvbGVNYXBwaW5nVGl0bGUiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUm9sZSBNYXBwaW5ncyIKICAgICAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIHsKICAgICAgICBjb2xvcjogInN1YmR1ZWQiLAogICAgICAgIHNpemU6ICJzIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLnNlY3VyaXR5Lm1hbmFnZW1lbnQucm9sZU1hcHBpbmdzLnJvbGVNYXBwaW5nRGVzY3JpcHRpb24iLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUm9sZSBtYXBwaW5ncyBkZWZpbmUgd2hpY2ggcm9sZXMgYXJlIGFzc2lnbmVkIHRvIHVzZXJzIGZyb20gYW4gZXh0ZXJuYWwgaWRlbnRpdHkgcHJvdmlkZXIuIHtsZWFybk1vcmVMaW5rfSIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBsZWFybk1vcmVMaW5rOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTGluaywgewogICAgICAgICAgICBocmVmOiBfZG9jdW1lbnRhdGlvbl9saW5rcy5kb2N1bWVudGF0aW9uTGlua3MuZ2V0Um9sZU1hcHBpbmdEb2NVcmwoKSwKICAgICAgICAgICAgZXh0ZXJuYWw6IHRydWUsCiAgICAgICAgICAgIHRhcmdldDogIl9ibGFuayIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suc2VjdXJpdHkubWFuYWdlbWVudC5yb2xlTWFwcGluZ3MubGVhcm5Nb3JlTGlua1RleHQiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkxlYXJuIG1vcmUuIgogICAgICAgICAgfSkpCiAgICAgICAgfQogICAgICB9KSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhZ2VDb250ZW50SGVhZGVyU2VjdGlvbiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJjcmVhdGVSb2xlTWFwcGluZ0J1dHRvbiIsCiAgICAgICAgaHJlZjogKDAsIF9tYW5hZ2VtZW50X3VybHMuZ2V0Q3JlYXRlUm9sZU1hcHBpbmdIcmVmKSgpCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5zZWN1cml0eS5tYW5hZ2VtZW50LnJvbGVNYXBwaW5ncy5jcmVhdGVSb2xlTWFwcGluZ0J1dHRvbkxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNyZWF0ZSByb2xlIG1hcHBpbmciCiAgICAgIH0pKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnRCb2R5LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgIXRoaXMuc3RhdGUuaGFzQ29tcGF0aWJsZVJlYWxtcyAmJiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jb21wb25lbnRzLk5vQ29tcGF0aWJsZVJlYWxtcywgbnVsbCksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIG51bGwpKSwgdGhpcy5yZW5kZXJUYWJsZSgpKSkpOwogICAgfQogIH0sIHsKICAgIGtleTogImNoZWNrUHJpdmlsZWdlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tQcml2aWxlZ2VzKCkgewogICAgICB2YXIgX3JlZiwgY2FuTWFuYWdlUm9sZU1hcHBpbmdzLCBoYXNDb21wYXRpYmxlUmVhbG1zOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBjaGVja1ByaXZpbGVnZXMkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMDsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLnByb3BzLnJvbGVNYXBwaW5nc0FQSS5jaGVja1JvbGVNYXBwaW5nRmVhdHVyZXMoKSk7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgX3JlZiA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIGNhbk1hbmFnZVJvbGVNYXBwaW5ncyA9IF9yZWYuY2FuTWFuYWdlUm9sZU1hcHBpbmdzOwogICAgICAgICAgICAgIGhhc0NvbXBhdGlibGVSZWFsbXMgPSBfcmVmLmhhc0NvbXBhdGlibGVSZWFsbXM7CiAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBsb2FkU3RhdGU6IGNhbk1hbmFnZVJvbGVNYXBwaW5ncyA/IHRoaXMuc3RhdGUubG9hZFN0YXRlIDogJ3Blcm1pc3Npb25EZW5pZWQnLAogICAgICAgICAgICAgICAgaGFzQ29tcGF0aWJsZVJlYWxtczogaGFzQ29tcGF0aWJsZVJlYWxtcwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoY2FuTWFuYWdlUm9sZU1hcHBpbmdzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRSb2xlTWFwcGluZ3MoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMTA7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gX2NvbnRleHQyWyJjYXRjaCJdKDApOwogICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgZXJyb3I6IF9jb250ZXh0Mi50MCwKICAgICAgICAgICAgICAgIGxvYWRTdGF0ZTogJ2ZpbmlzaGVkJwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG51bGwsIHRoaXMsIFtbMCwgMTBdXSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gUm9sZU1hcHBpbmdzR3JpZFBhZ2U7Cn0oX3JlYWN0LkNvbXBvbmVudCk7CgpleHBvcnRzLlJvbGVNYXBwaW5nc0dyaWRQYWdlID0gUm9sZU1hcHBpbmdzR3JpZFBhZ2U7"},null]}