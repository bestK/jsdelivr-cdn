{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/data/public/ui/search_bar/search_bar.js","dependencies":[{"path":"src/plugins/data/public/ui/search_bar/search_bar.js","mtime":1585205041602},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuU2VhcmNoQmFyID0gdm9pZCAwOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfcmVhY3QgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfY2xhc3NuYW1lcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiY2xhc3NuYW1lcyIpKTsKCnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX3Jlc2l6ZU9ic2VydmVyUG9seWZpbGwgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbCIpKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4va2liYW5hX3JlYWN0L3B1YmxpYyIpOwoKdmFyIF8gPSByZXF1aXJlKCIuLi8uLiIpOwoKdmFyIF9xdWVyeV9iYXJfdG9wX3JvdyA9IHJlcXVpcmUoIi4uL3F1ZXJ5X3N0cmluZ19pbnB1dC9xdWVyeV9iYXJfdG9wX3JvdyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgcmV0dXJuIGNhbGw7CiAgfQoKICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsKfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsKICB9OwogIHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBTZWFyY2hCYXJVSSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoU2VhcmNoQmFyVUksIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBTZWFyY2hCYXJVSSgpIHsKICAgIHZhciBfZ2V0UHJvdG90eXBlT2YyOwoKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2VhcmNoQmFyVUkpOwoKICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgfQoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgKF9nZXRQcm90b3R5cGVPZjIgPSBfZ2V0UHJvdG90eXBlT2YoU2VhcmNoQmFyVUkpKS5jYWxsLmFwcGx5KF9nZXRQcm90b3R5cGVPZjIsIFt0aGlzXS5jb25jYXQoYXJncykpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZXJ2aWNlcyIsIF90aGlzLnByb3BzLmtpYmFuYS5zZXJ2aWNlcyk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2F2ZWRRdWVyeVNlcnZpY2UiLCBfdGhpcy5zZXJ2aWNlcy5kYXRhLnF1ZXJ5LnNhdmVkUXVlcmllcyk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmlsdGVyQmFyUmVmIiwgbnVsbCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmlsdGVyQmFyV3JhcHBlclJlZiIsIG51bGwpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInN0YXRlIiwgewogICAgICBpc0ZpbHRlcnNWaXNpYmxlOiB0cnVlLAogICAgICBzaG93U2F2ZVF1ZXJ5TW9kYWw6IGZhbHNlLAogICAgICBzaG93U2F2ZU5ld1F1ZXJ5TW9kYWw6IGZhbHNlLAogICAgICBzaG93U2F2ZWRRdWVyeVBvcG92ZXI6IGZhbHNlLAogICAgICBjdXJyZW50UHJvcHM6IF90aGlzLnByb3BzLAogICAgICBxdWVyeTogX3RoaXMucHJvcHMucXVlcnkgPyBfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5wcm9wcy5xdWVyeSkgOiB1bmRlZmluZWQsCiAgICAgIGRhdGVSYW5nZUZyb206ICgwLCBfbG9kYXNoLmdldCkoX3RoaXMucHJvcHMsICdkYXRlUmFuZ2VGcm9tJywgJ25vdy0xNW0nKSwKICAgICAgZGF0ZVJhbmdlVG86ICgwLCBfbG9kYXNoLmdldCkoX3RoaXMucHJvcHMsICdkYXRlUmFuZ2VUbycsICdub3cnKQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaXNEaXJ0eSIsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCFfdGhpcy5wcm9wcy5zaG93RGF0ZVBpY2tlciAmJiBfdGhpcy5zdGF0ZS5xdWVyeSAmJiBfdGhpcy5wcm9wcy5xdWVyeSkgewogICAgICAgIHJldHVybiBfdGhpcy5zdGF0ZS5xdWVyeS5xdWVyeSAhPT0gX3RoaXMucHJvcHMucXVlcnkucXVlcnk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfdGhpcy5zdGF0ZS5xdWVyeSAmJiBfdGhpcy5wcm9wcy5xdWVyeSAmJiBfdGhpcy5zdGF0ZS5xdWVyeS5xdWVyeSAhPT0gX3RoaXMucHJvcHMucXVlcnkucXVlcnkgfHwgX3RoaXMuc3RhdGUuZGF0ZVJhbmdlRnJvbSAhPT0gX3RoaXMucHJvcHMuZGF0ZVJhbmdlRnJvbSB8fCBfdGhpcy5zdGF0ZS5kYXRlUmFuZ2VUbyAhPT0gX3RoaXMucHJvcHMuZGF0ZVJhbmdlVG87CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZXRGaWx0ZXJCYXJIZWlnaHQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGhlaWdodCA9IF90aGlzLmZpbHRlckJhclJlZiAmJiBfdGhpcy5zdGF0ZS5pc0ZpbHRlcnNWaXNpYmxlID8gX3RoaXMuZmlsdGVyQmFyUmVmLmNsaWVudEhlaWdodCA6IDA7CgogICAgICAgIGlmIChfdGhpcy5maWx0ZXJCYXJXcmFwcGVyUmVmKSB7CiAgICAgICAgICBfdGhpcy5maWx0ZXJCYXJXcmFwcGVyUmVmLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAiaGVpZ2h0OiAiLmNvbmNhdChoZWlnaHQsICJweCIpKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicm8iLCBuZXcgX3Jlc2l6ZU9ic2VydmVyUG9seWZpbGwuZGVmYXVsdChfdGhpcy5zZXRGaWx0ZXJCYXJIZWlnaHQpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblNhdmUiLCBmdW5jdGlvbiBfY2FsbGVlKHNhdmVkUXVlcnlNZXRhKSB7CiAgICAgIHZhciBzYXZlQXNOZXcsCiAgICAgICAgICBzYXZlZFF1ZXJ5QXR0cmlidXRlcywKICAgICAgICAgIHJlc3BvbnNlLAogICAgICAgICAgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgc2F2ZUFzTmV3ID0gX2FyZ3MubGVuZ3RoID4gMSAmJiBfYXJnc1sxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3NbMV0gOiBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLnF1ZXJ5KSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgc2F2ZWRRdWVyeUF0dHJpYnV0ZXMgPSB7CiAgICAgICAgICAgICAgICB0aXRsZTogc2F2ZWRRdWVyeU1ldGEudGl0bGUsCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogc2F2ZWRRdWVyeU1ldGEuZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBxdWVyeTogX3RoaXMuc3RhdGUucXVlcnkKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoc2F2ZWRRdWVyeU1ldGEuc2hvdWxkSW5jbHVkZUZpbHRlcnMpIHsKICAgICAgICAgICAgICAgIHNhdmVkUXVlcnlBdHRyaWJ1dGVzLmZpbHRlcnMgPSBfdGhpcy5wcm9wcy5maWx0ZXJzOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHNhdmVkUXVlcnlNZXRhLnNob3VsZEluY2x1ZGVUaW1lZmlsdGVyICYmIF90aGlzLnN0YXRlLmRhdGVSYW5nZVRvICE9PSB1bmRlZmluZWQgJiYgX3RoaXMuc3RhdGUuZGF0ZVJhbmdlRnJvbSAhPT0gdW5kZWZpbmVkICYmIF90aGlzLnByb3BzLnJlZnJlc2hJbnRlcnZhbCAhPT0gdW5kZWZpbmVkICYmIF90aGlzLnByb3BzLmlzUmVmcmVzaFBhdXNlZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBzYXZlZFF1ZXJ5QXR0cmlidXRlcy50aW1lZmlsdGVyID0gewogICAgICAgICAgICAgICAgICBmcm9tOiBfdGhpcy5zdGF0ZS5kYXRlUmFuZ2VGcm9tLAogICAgICAgICAgICAgICAgICB0bzogX3RoaXMuc3RhdGUuZGF0ZVJhbmdlVG8sCiAgICAgICAgICAgICAgICAgIHJlZnJlc2hJbnRlcnZhbDogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBfdGhpcy5wcm9wcy5yZWZyZXNoSW50ZXJ2YWwsCiAgICAgICAgICAgICAgICAgICAgcGF1c2U6IF90aGlzLnByb3BzLmlzUmVmcmVzaFBhdXNlZAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDY7CgogICAgICAgICAgICAgIGlmICghKF90aGlzLnByb3BzLnNhdmVkUXVlcnkgJiYgIXNhdmVBc05ldykpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEwOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoX3RoaXMuc2F2ZWRRdWVyeVNlcnZpY2Uuc2F2ZVF1ZXJ5KHNhdmVkUXVlcnlBdHRyaWJ1dGVzLCB7CiAgICAgICAgICAgICAgICBvdmVyd3JpdGU6IHRydWUKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLnNhdmVkUXVlcnlTZXJ2aWNlLnNhdmVRdWVyeShzYXZlZFF1ZXJ5QXR0cmlidXRlcykpOwoKICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgIF90aGlzLnNlcnZpY2VzLm5vdGlmaWNhdGlvbnMudG9hc3RzLmFkZFN1Y2Nlc3MoIllvdXIgcXVlcnkgXCIiLmNvbmNhdChyZXNwb25zZS5hdHRyaWJ1dGVzLnRpdGxlLCAiXCIgd2FzIHNhdmVkIikpOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBzaG93U2F2ZVF1ZXJ5TW9kYWw6IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd1NhdmVOZXdRdWVyeU1vZGFsOiBmYWxzZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMucHJvcHMub25TYXZlZCkgewogICAgICAgICAgICAgICAgX3RoaXMucHJvcHMub25TYXZlZChyZXNwb25zZSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyMTsKICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDYpOwoKICAgICAgICAgICAgICBfdGhpcy5zZXJ2aWNlcy5ub3RpZmljYXRpb25zLnRvYXN0cy5hZGREYW5nZXIoIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgc2F2aW5nIHlvdXIgcXVlcnk6ICIuY29uY2F0KF9jb250ZXh0LnQwLm1lc3NhZ2UpKTsKCiAgICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQudDA7CgogICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCBudWxsLCBbWzYsIDIxXV0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Jbml0aWF0ZVNhdmUiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBzaG93U2F2ZVF1ZXJ5TW9kYWw6IHRydWUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkluaXRpYXRlU2F2ZU5ldyIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHNob3dTYXZlTmV3UXVlcnlNb2RhbDogdHJ1ZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uUXVlcnlCYXJDaGFuZ2UiLCBmdW5jdGlvbiAocXVlcnlBbmREYXRlUmFuZ2UpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHF1ZXJ5OiBxdWVyeUFuZERhdGVSYW5nZS5xdWVyeSwKICAgICAgICBkYXRlUmFuZ2VGcm9tOiBxdWVyeUFuZERhdGVSYW5nZS5kYXRlUmFuZ2UuZnJvbSwKICAgICAgICBkYXRlUmFuZ2VUbzogcXVlcnlBbmREYXRlUmFuZ2UuZGF0ZVJhbmdlLnRvCiAgICAgIH0pOwoKICAgICAgaWYgKF90aGlzLnByb3BzLm9uUXVlcnlDaGFuZ2UpIHsKICAgICAgICBfdGhpcy5wcm9wcy5vblF1ZXJ5Q2hhbmdlKHF1ZXJ5QW5kRGF0ZVJhbmdlKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25RdWVyeUJhclN1Ym1pdCIsIGZ1bmN0aW9uIChxdWVyeUFuZERhdGVSYW5nZSkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcXVlcnk6IHF1ZXJ5QW5kRGF0ZVJhbmdlLnF1ZXJ5LAogICAgICAgIGRhdGVSYW5nZUZyb206IHF1ZXJ5QW5kRGF0ZVJhbmdlLmRhdGVSYW5nZSAmJiBxdWVyeUFuZERhdGVSYW5nZS5kYXRlUmFuZ2UuZnJvbSB8fCBfdGhpcy5zdGF0ZS5kYXRlUmFuZ2VGcm9tLAogICAgICAgIGRhdGVSYW5nZVRvOiBxdWVyeUFuZERhdGVSYW5nZS5kYXRlUmFuZ2UgJiYgcXVlcnlBbmREYXRlUmFuZ2UuZGF0ZVJhbmdlLnRvIHx8IF90aGlzLnN0YXRlLmRhdGVSYW5nZVRvCiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXMucHJvcHMub25RdWVyeVN1Ym1pdCkgewogICAgICAgICAgX3RoaXMucHJvcHMub25RdWVyeVN1Ym1pdCh7CiAgICAgICAgICAgIHF1ZXJ5OiBfdGhpcy5zdGF0ZS5xdWVyeSwKICAgICAgICAgICAgZGF0ZVJhbmdlOiB7CiAgICAgICAgICAgICAgZnJvbTogX3RoaXMuc3RhdGUuZGF0ZVJhbmdlRnJvbSwKICAgICAgICAgICAgICB0bzogX3RoaXMuc3RhdGUuZGF0ZVJhbmdlVG8KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uTG9hZFNhdmVkUXVlcnkiLCBmdW5jdGlvbiAoc2F2ZWRRdWVyeSkgewogICAgICB2YXIgZGF0ZVJhbmdlRnJvbSA9ICgwLCBfbG9kYXNoLmdldCkoc2F2ZWRRdWVyeSwgJ2F0dHJpYnV0ZXMudGltZWZpbHRlci5mcm9tJywgX3RoaXMuc3RhdGUuZGF0ZVJhbmdlRnJvbSk7CiAgICAgIHZhciBkYXRlUmFuZ2VUbyA9ICgwLCBfbG9kYXNoLmdldCkoc2F2ZWRRdWVyeSwgJ2F0dHJpYnV0ZXMudGltZWZpbHRlci50bycsIF90aGlzLnN0YXRlLmRhdGVSYW5nZVRvKTsKCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBxdWVyeTogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnF1ZXJ5LAogICAgICAgIGRhdGVSYW5nZUZyb206IGRhdGVSYW5nZUZyb20sCiAgICAgICAgZGF0ZVJhbmdlVG86IGRhdGVSYW5nZVRvCiAgICAgIH0pOwoKICAgICAgaWYgKF90aGlzLnByb3BzLm9uU2F2ZWRRdWVyeVVwZGF0ZWQpIHsKICAgICAgICBfdGhpcy5wcm9wcy5vblNhdmVkUXVlcnlVcGRhdGVkKHNhdmVkUXVlcnkpOwogICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoU2VhcmNoQmFyVUksIFt7CiAgICBrZXk6ICJzaG91bGRSZW5kZXJRdWVyeUJhciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdWxkUmVuZGVyUXVlcnlCYXIoKSB7CiAgICAgIHZhciBzaG93RGF0ZVBpY2tlciA9IHRoaXMucHJvcHMuc2hvd0RhdGVQaWNrZXIgfHwgdGhpcy5wcm9wcy5zaG93QXV0b1JlZnJlc2hPbmx5OwogICAgICB2YXIgc2hvd1F1ZXJ5SW5wdXQgPSB0aGlzLnByb3BzLnNob3dRdWVyeUlucHV0ICYmIHRoaXMucHJvcHMuaW5kZXhQYXR0ZXJucyAmJiB0aGlzLnN0YXRlLnF1ZXJ5OwogICAgICByZXR1cm4gdGhpcy5wcm9wcy5zaG93UXVlcnlCYXIgJiYgKHNob3dEYXRlUGlja2VyIHx8IHNob3dRdWVyeUlucHV0KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzaG91bGRSZW5kZXJGaWx0ZXJCYXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3VsZFJlbmRlckZpbHRlckJhcigpIHsKICAgICAgcmV0dXJuIHRoaXMucHJvcHMuc2hvd0ZpbHRlckJhciAmJiB0aGlzLnByb3BzLmZpbHRlcnMgJiYgdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zICYmICgwLCBfbG9kYXNoLmNvbXBhY3QpKHRoaXMucHJvcHMuaW5kZXhQYXR0ZXJucykubGVuZ3RoID4gMDsKICAgIH0KICAgIC8qCiAgICAgKiBUaGlzIEZ1bmN0aW9uIGlzIGhlcmUgdG8gc2hvdyB0aGUgdG9nZ2xlIGluIHNhdmVkIHF1ZXJ5IGZvcm0KICAgICAqIGluIGNhc2UgeW91IHRoZSBkYXRlIHJhbmdlIChmcm9tL3RvKQogICAgICovCgogIH0sIHsKICAgIGtleTogInNob3VsZFJlbmRlclRpbWVGaWx0ZXJJblNhdmVkUXVlcnlGb3JtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRSZW5kZXJUaW1lRmlsdGVySW5TYXZlZFF1ZXJ5Rm9ybSgpIHsKICAgICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgIGRhdGVSYW5nZUZyb20gPSBfdGhpcyRwcm9wcy5kYXRlUmFuZ2VGcm9tLAogICAgICAgICAgZGF0ZVJhbmdlVG8gPSBfdGhpcyRwcm9wcy5kYXRlUmFuZ2VUbywKICAgICAgICAgIHNob3dEYXRlUGlja2VyID0gX3RoaXMkcHJvcHMuc2hvd0RhdGVQaWNrZXI7CiAgICAgIHJldHVybiBzaG93RGF0ZVBpY2tlciB8fCAhc2hvd0RhdGVQaWNrZXIgJiYgZGF0ZVJhbmdlRnJvbSAhPT0gdW5kZWZpbmVkICYmIGRhdGVSYW5nZVRvICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICBpZiAodGhpcy5maWx0ZXJCYXJSZWYpIHsKICAgICAgICB0aGlzLnNldEZpbHRlckJhckhlaWdodCgpOwogICAgICAgIHRoaXMucm8ub2JzZXJ2ZSh0aGlzLmZpbHRlckJhclJlZik7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnREaWRVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZSgpIHsKICAgICAgaWYgKHRoaXMuZmlsdGVyQmFyUmVmKSB7CiAgICAgICAgdGhpcy5zZXRGaWx0ZXJCYXJIZWlnaHQoKTsKICAgICAgICB0aGlzLnJvLnVub2JzZXJ2ZSh0aGlzLmZpbHRlckJhclJlZik7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgc2F2ZWRRdWVyeU1hbmFnZW1lbnQgPSB0aGlzLnN0YXRlLnF1ZXJ5ICYmIHRoaXMucHJvcHMub25DbGVhclNhdmVkUXVlcnkgJiYgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXy5TYXZlZFF1ZXJ5TWFuYWdlbWVudENvbXBvbmVudCwgewogICAgICAgIHNob3dTYXZlUXVlcnk6IHRoaXMucHJvcHMuc2hvd1NhdmVRdWVyeSwKICAgICAgICBsb2FkZWRTYXZlZFF1ZXJ5OiB0aGlzLnByb3BzLnNhdmVkUXVlcnksCiAgICAgICAgb25TYXZlOiB0aGlzLm9uSW5pdGlhdGVTYXZlLAogICAgICAgIG9uU2F2ZUFzTmV3OiB0aGlzLm9uSW5pdGlhdGVTYXZlTmV3LAogICAgICAgIG9uTG9hZDogdGhpcy5vbkxvYWRTYXZlZFF1ZXJ5LAogICAgICAgIHNhdmVkUXVlcnlTZXJ2aWNlOiB0aGlzLnNhdmVkUXVlcnlTZXJ2aWNlLAogICAgICAgIG9uQ2xlYXJTYXZlZFF1ZXJ5OiB0aGlzLnByb3BzLm9uQ2xlYXJTYXZlZFF1ZXJ5CiAgICAgIH0pOwoKICAgICAgdmFyIHF1ZXJ5QmFyOwoKICAgICAgaWYgKHRoaXMuc2hvdWxkUmVuZGVyUXVlcnlCYXIoKSkgewogICAgICAgIHF1ZXJ5QmFyID0gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3F1ZXJ5X2Jhcl90b3Bfcm93LlF1ZXJ5QmFyVG9wUm93LCB7CiAgICAgICAgICB0aW1lSGlzdG9yeTogdGhpcy5wcm9wcy50aW1lSGlzdG9yeSwKICAgICAgICAgIHF1ZXJ5OiB0aGlzLnN0YXRlLnF1ZXJ5LAogICAgICAgICAgc2NyZWVuVGl0bGU6IHRoaXMucHJvcHMuc2NyZWVuVGl0bGUsCiAgICAgICAgICBvblN1Ym1pdDogdGhpcy5vblF1ZXJ5QmFyU3VibWl0LAogICAgICAgICAgaW5kZXhQYXR0ZXJuczogdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zLAogICAgICAgICAgaXNMb2FkaW5nOiB0aGlzLnByb3BzLmlzTG9hZGluZywKICAgICAgICAgIHByZXBlbmQ6IHRoaXMucHJvcHMuc2hvd0ZpbHRlckJhciA/IHNhdmVkUXVlcnlNYW5hZ2VtZW50IDogdW5kZWZpbmVkLAogICAgICAgICAgc2hvd0RhdGVQaWNrZXI6IHRoaXMucHJvcHMuc2hvd0RhdGVQaWNrZXIsCiAgICAgICAgICBkYXRlUmFuZ2VGcm9tOiB0aGlzLnN0YXRlLmRhdGVSYW5nZUZyb20sCiAgICAgICAgICBkYXRlUmFuZ2VUbzogdGhpcy5zdGF0ZS5kYXRlUmFuZ2VUbywKICAgICAgICAgIGlzUmVmcmVzaFBhdXNlZDogdGhpcy5wcm9wcy5pc1JlZnJlc2hQYXVzZWQsCiAgICAgICAgICByZWZyZXNoSW50ZXJ2YWw6IHRoaXMucHJvcHMucmVmcmVzaEludGVydmFsLAogICAgICAgICAgc2hvd0F1dG9SZWZyZXNoT25seTogdGhpcy5wcm9wcy5zaG93QXV0b1JlZnJlc2hPbmx5LAogICAgICAgICAgc2hvd1F1ZXJ5SW5wdXQ6IHRoaXMucHJvcHMuc2hvd1F1ZXJ5SW5wdXQsCiAgICAgICAgICBvblJlZnJlc2g6IHRoaXMucHJvcHMub25SZWZyZXNoLAogICAgICAgICAgb25SZWZyZXNoQ2hhbmdlOiB0aGlzLnByb3BzLm9uUmVmcmVzaENoYW5nZSwKICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uUXVlcnlCYXJDaGFuZ2UsCiAgICAgICAgICBpc0RpcnR5OiB0aGlzLmlzRGlydHkoKSwKICAgICAgICAgIGN1c3RvbVN1Ym1pdEJ1dHRvbjogdGhpcy5wcm9wcy5jdXN0b21TdWJtaXRCdXR0b24gPyB0aGlzLnByb3BzLmN1c3RvbVN1Ym1pdEJ1dHRvbiA6IHVuZGVmaW5lZCwKICAgICAgICAgIGRhdGFUZXN0U3ViajogdGhpcy5wcm9wcy5kYXRhVGVzdFN1YmoKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIGZpbHRlckJhcjsKCiAgICAgIGlmICh0aGlzLnNob3VsZFJlbmRlckZpbHRlckJhcigpKSB7CiAgICAgICAgdmFyIGZpbHRlckdyb3VwQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lcy5kZWZhdWx0KSgnZ2xvYmFsRmlsdGVyR3JvdXBfX3dyYXBwZXInLCB7CiAgICAgICAgICAnZ2xvYmFsRmlsdGVyR3JvdXBfX3dyYXBwZXItaXNWaXNpYmxlJzogdGhpcy5zdGF0ZS5pc0ZpbHRlcnNWaXNpYmxlCiAgICAgICAgfSk7CiAgICAgICAgZmlsdGVyQmFyID0gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgIGlkOiAiR2xvYmFsRmlsdGVyR3JvdXAiLAogICAgICAgICAgcmVmOiBmdW5jdGlvbiByZWYobm9kZSkgewogICAgICAgICAgICBfdGhpczIuZmlsdGVyQmFyV3JhcHBlclJlZiA9IG5vZGU7CiAgICAgICAgICB9LAogICAgICAgICAgY2xhc3NOYW1lOiBmaWx0ZXJHcm91cENsYXNzZXMKICAgICAgICB9LCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgcmVmOiBmdW5jdGlvbiByZWYobm9kZSkgewogICAgICAgICAgICBfdGhpczIuZmlsdGVyQmFyUmVmID0gbm9kZTsKICAgICAgICAgIH0KICAgICAgICB9LCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfLkZpbHRlckJhciwgewogICAgICAgICAgY2xhc3NOYW1lOiAiZ2xvYmFsRmlsdGVyR3JvdXBfX2ZpbHRlckJhciIsCiAgICAgICAgICBmaWx0ZXJzOiB0aGlzLnByb3BzLmZpbHRlcnMsCiAgICAgICAgICBvbkZpbHRlcnNVcGRhdGVkOiB0aGlzLnByb3BzLm9uRmlsdGVyc1VwZGF0ZWQsCiAgICAgICAgICBpbmRleFBhdHRlcm5zOiB0aGlzLnByb3BzLmluZGV4UGF0dGVybnMKICAgICAgICB9KSkpOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJnbG9iYWxRdWVyeUJhciIKICAgICAgfSwgcXVlcnlCYXIsIGZpbHRlckJhciwgdGhpcy5zdGF0ZS5zaG93U2F2ZVF1ZXJ5TW9kYWwgPyBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfLlNhdmVRdWVyeUZvcm0sIHsKICAgICAgICBzYXZlZFF1ZXJ5OiB0aGlzLnByb3BzLnNhdmVkUXVlcnkgPyB0aGlzLnByb3BzLnNhdmVkUXVlcnkuYXR0cmlidXRlcyA6IHVuZGVmaW5lZCwKICAgICAgICBzYXZlZFF1ZXJ5U2VydmljZTogdGhpcy5zYXZlZFF1ZXJ5U2VydmljZSwKICAgICAgICBvblNhdmU6IHRoaXMub25TYXZlLAogICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgc2hvd1NhdmVRdWVyeU1vZGFsOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBzaG93RmlsdGVyT3B0aW9uOiB0aGlzLnByb3BzLnNob3dGaWx0ZXJCYXIsCiAgICAgICAgc2hvd1RpbWVGaWx0ZXJPcHRpb246IHRoaXMuc2hvdWxkUmVuZGVyVGltZUZpbHRlckluU2F2ZWRRdWVyeUZvcm0oKQogICAgICB9KSA6IG51bGwsIHRoaXMuc3RhdGUuc2hvd1NhdmVOZXdRdWVyeU1vZGFsID8gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXy5TYXZlUXVlcnlGb3JtLCB7CiAgICAgICAgc2F2ZWRRdWVyeVNlcnZpY2U6IHRoaXMuc2F2ZWRRdWVyeVNlcnZpY2UsCiAgICAgICAgb25TYXZlOiBmdW5jdGlvbiBvblNhdmUoc2F2ZWRRdWVyeU1ldGEpIHsKICAgICAgICAgIHJldHVybiBfdGhpczIub25TYXZlKHNhdmVkUXVlcnlNZXRhLCB0cnVlKTsKICAgICAgICB9LAogICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgc2hvd1NhdmVOZXdRdWVyeU1vZGFsOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBzaG93RmlsdGVyT3B0aW9uOiB0aGlzLnByb3BzLnNob3dGaWx0ZXJCYXIsCiAgICAgICAgc2hvd1RpbWVGaWx0ZXJPcHRpb246IHRoaXMuc2hvdWxkUmVuZGVyVGltZUZpbHRlckluU2F2ZWRRdWVyeUZvcm0oKQogICAgICB9KSA6IG51bGwpOwogICAgfQogIH1dLCBbewogICAga2V5OiAiZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMobmV4dFByb3BzLCBwcmV2U3RhdGUpIHsKICAgICAgaWYgKCgwLCBfbG9kYXNoLmlzRXF1YWwpKHByZXZTdGF0ZS5jdXJyZW50UHJvcHMsIG5leHRQcm9wcykpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIG5leHRRdWVyeSA9IG51bGw7CgogICAgICBpZiAobmV4dFByb3BzLnF1ZXJ5ICYmIG5leHRQcm9wcy5xdWVyeS5xdWVyeSAhPT0gKDAsIF9sb2Rhc2guZ2V0KShwcmV2U3RhdGUsICdjdXJyZW50UHJvcHMucXVlcnkucXVlcnknKSkgewogICAgICAgIG5leHRRdWVyeSA9IHsKICAgICAgICAgIHF1ZXJ5OiBuZXh0UHJvcHMucXVlcnkucXVlcnksCiAgICAgICAgICBsYW5ndWFnZTogbmV4dFByb3BzLnF1ZXJ5Lmxhbmd1YWdlCiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmIChuZXh0UHJvcHMucXVlcnkgJiYgcHJldlN0YXRlLnF1ZXJ5ICYmIG5leHRQcm9wcy5xdWVyeS5sYW5ndWFnZSAhPT0gcHJldlN0YXRlLnF1ZXJ5Lmxhbmd1YWdlKSB7CiAgICAgICAgbmV4dFF1ZXJ5ID0gewogICAgICAgICAgcXVlcnk6ICcnLAogICAgICAgICAgbGFuZ3VhZ2U6IG5leHRQcm9wcy5xdWVyeS5sYW5ndWFnZQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBuZXh0RGF0ZVJhbmdlID0gbnVsbDsKCiAgICAgIGlmIChuZXh0UHJvcHMuZGF0ZVJhbmdlRnJvbSAhPT0gKDAsIF9sb2Rhc2guZ2V0KShwcmV2U3RhdGUsICdjdXJyZW50UHJvcHMuZGF0ZVJhbmdlRnJvbScpIHx8IG5leHRQcm9wcy5kYXRlUmFuZ2VUbyAhPT0gKDAsIF9sb2Rhc2guZ2V0KShwcmV2U3RhdGUsICdjdXJyZW50UHJvcHMuZGF0ZVJhbmdlVG8nKSkgewogICAgICAgIG5leHREYXRlUmFuZ2UgPSB7CiAgICAgICAgICBkYXRlUmFuZ2VGcm9tOiBuZXh0UHJvcHMuZGF0ZVJhbmdlRnJvbSwKICAgICAgICAgIGRhdGVSYW5nZVRvOiBuZXh0UHJvcHMuZGF0ZVJhbmdlVG8KICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgbmV4dFN0YXRlID0gewogICAgICAgIGN1cnJlbnRQcm9wczogbmV4dFByb3BzCiAgICAgIH07CgogICAgICBpZiAobmV4dFF1ZXJ5KSB7CiAgICAgICAgbmV4dFN0YXRlLnF1ZXJ5ID0gbmV4dFF1ZXJ5OwogICAgICB9CgogICAgICBpZiAobmV4dERhdGVSYW5nZSkgewogICAgICAgIG5leHRTdGF0ZS5kYXRlUmFuZ2VGcm9tID0gbmV4dERhdGVSYW5nZS5kYXRlUmFuZ2VGcm9tOwogICAgICAgIG5leHRTdGF0ZS5kYXRlUmFuZ2VUbyA9IG5leHREYXRlUmFuZ2UuZGF0ZVJhbmdlVG87CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXh0U3RhdGU7CiAgICB9CiAgICAvKgogICAgIEtlZXAgdGhlICJkcmFmdCIgdmFsdWUgaW4gbG9jYWwgc3RhdGUgdW50aWwgdGhlIHVzZXIgYWN0dWFsbHkgc3VibWl0cyB0aGUgcXVlcnkuIFRoZXJlIGFyZSBhIGNvdXBsZSBhZHZhbnRhZ2VzOgogICAgICAgMS4gRWFjaCBhcHAgZG9lc24ndCBoYXZlIHRvIG1haW50YWluIGl0cyBvd24gImRyYWZ0IiB2YWx1ZSBpZiBpdCB3YW50cyB0byBwdXQgb2ZmIHVwZGF0aW5nIHRoZSBxdWVyeSBpbiBhcHAgc3RhdGUKICAgICAgdW50aWwgdGhlIHVzZXIgbWFudWFsbHkgc3VibWl0cyB0aGVpciBjaGFuZ2VzLiBNb3N0IGFwcHMgaGF2ZSB3YXRjaGVzIG9uIHRoZSBxdWVyeSB2YWx1ZSBpbiBhcHAgc3RhdGUgc28gd2UgZG9uJ3QKICAgICAgd2FudCB0byB0cmlnZ2VyIHRob3NlIG9uIGV2ZXJ5IGtleXByZXNzLiBBbHNvLCBzb21lIGFwcHMgKGUuZy4gZGFzaGJvYXJkKSBhbHJlYWR5IGp1Z2dsZSBtdWx0aXBsZSBxdWVyeSB2YWx1ZXMsCiAgICAgIGVhY2ggd2l0aCBzbGlnaHRseSBkaWZmZXJlbnQgc2VtYW50aWNzIGFuZCBJJ2QgcmF0aGVyIG5vdCBhZGQgeWV0IGFub3RoZXIgdmFyaWFibGUgdG8gdGhlIG1peC4KICAgICAgIDIuIENoYW5nZXMgdG8gdGhlIGxvY2FsIGNvbXBvbmVudCBzdGF0ZSB3b24ndCB0cmlnZ2VyIGFuIEFuZ3VsYXIgZGlnZXN0IGN5Y2xlLiBUcmlnZ2VyaW5nIGRpZ2VzdCBjeWNsZXMgb24gZXZlcnkKICAgICAga2V5cHJlc3MgaGFzIGJlZW4gYSBtYWpvciBzb3VyY2Ugb2YgcGVyZm9ybWFuY2UgaXNzdWVzIGZvciB1cyBpbiBwcmV2aW91cyBpbXBsZW1lbnRhdGlvbnMgb2YgdGhlIHF1ZXJ5IGJhci4KICAgICAgU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGFzdGljL2tpYmFuYS9pc3N1ZXMvMTQwODYKICAgICovCgogIH1dKTsKCiAgcmV0dXJuIFNlYXJjaEJhclVJOwp9KF9yZWFjdDIuQ29tcG9uZW50KTsKCl9kZWZpbmVQcm9wZXJ0eShTZWFyY2hCYXJVSSwgImRlZmF1bHRQcm9wcyIsIHsKICBzaG93UXVlcnlCYXI6IHRydWUsCiAgc2hvd0ZpbHRlckJhcjogdHJ1ZSwKICBzaG93RGF0ZVBpY2tlcjogdHJ1ZSwKICBzaG93QXV0b1JlZnJlc2hPbmx5OiBmYWxzZQp9KTsKCnZhciBTZWFyY2hCYXIgPSAoMCwgX3JlYWN0LmluamVjdEkxOG4pKCgwLCBfcHVibGljLndpdGhLaWJhbmEpKFNlYXJjaEJhclVJKSk7CmV4cG9ydHMuU2VhcmNoQmFyID0gU2VhcmNoQmFyOw=="},null]}