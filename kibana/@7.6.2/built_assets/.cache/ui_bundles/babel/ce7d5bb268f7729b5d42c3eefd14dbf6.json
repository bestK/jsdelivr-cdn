{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/canvas/public/state/actions/elements.js","dependencies":[{"path":"x-pack/legacy/plugins/canvas/public/state/actions/elements.js","mtime":1585205043777},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmdldFNpYmxpbmdDb250ZXh0ID0gZ2V0U2libGluZ0NvbnRleHQ7CmV4cG9ydHMuYWRkRWxlbWVudCA9IGV4cG9ydHMuZGVsZXRlQXJndW1lbnRBdEluZGV4ID0gZXhwb3J0cy5hZGRBcmd1bWVudFZhbHVlQXRJbmRleCA9IGV4cG9ydHMuc2V0QXJndW1lbnRBdEluZGV4ID0gZXhwb3J0cy5zZXRBc3RBdEluZGV4ID0gZXhwb3J0cy5zZXRFeHByZXNzaW9uID0gZXhwb3J0cy5zZXRGaWx0ZXIgPSBleHBvcnRzLnJlbW92ZUVsZW1lbnRzID0gZXhwb3J0cy5pbnNlcnROb2RlcyA9IGV4cG9ydHMuZmV0Y2hBbGxSZW5kZXJhYmxlcyA9IGV4cG9ydHMuZmV0Y2hSZW5kZXJhYmxlID0gZXhwb3J0cy5mZXRjaFJlbmRlcmFibGVXaXRoQ29udGV4dCA9IGV4cG9ydHMuZmV0Y2hDb250ZXh0ID0gZXhwb3J0cy5mbHVzaENvbnRleHRBZnRlckluZGV4ID0gZXhwb3J0cy5mbHVzaENvbnRleHQgPSBleHBvcnRzLnNldE11bHRpcGxlUG9zaXRpb25zID0gZXhwb3J0cy5lbGVtZW50TGF5ZXIgPSB2b2lkIDA7Cgp2YXIgX3JlZHV4QWN0aW9ucyA9IHJlcXVpcmUoInJlZHV4LWFjdGlvbnMiKTsKCnZhciBfcmVkdXhUaHVua3MgPSByZXF1aXJlKCJyZWR1eC10aHVua3MiKTsKCnZhciBfb2JqZWN0UGF0aEltbXV0YWJsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgib2JqZWN0LXBhdGgtaW1tdXRhYmxlIikpOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfY29tbW9uID0gcmVxdWlyZSgiQGtibi9pbnRlcnByZXRlci9jb21tb24iKTsKCnZhciBfaW50ZXJwcmV0ZXIgPSByZXF1aXJlKCJwbHVnaW5zL2ludGVycHJldGVyL2ludGVycHJldGVyIik7Cgp2YXIgX3dvcmtwYWQgPSByZXF1aXJlKCIuLi9zZWxlY3RvcnMvd29ya3BhZCIpOwoKdmFyIF9yZXNvbHZlZF9hcmdzID0gcmVxdWlyZSgiLi4vc2VsZWN0b3JzL3Jlc29sdmVkX2FyZ3MiKTsKCnZhciBfZGVmYXVsdHMgPSByZXF1aXJlKCIuLi9kZWZhdWx0cyIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiLi4vLi4vLi4vaTE4biIpOwoKdmFyIF9ub3RpZnkgPSByZXF1aXJlKCIuLi8uLi9saWIvbm90aWZ5Iik7Cgp2YXIgX3J1bl9pbnRlcnByZXRlciA9IHJlcXVpcmUoIi4uLy4uL2xpYi9ydW5faW50ZXJwcmV0ZXIiKTsKCnZhciBfZnVuY3Rpb25hbCA9IHJlcXVpcmUoIi4uLy4uL2xpYi9hZXJvZWxhc3RpYy9mdW5jdGlvbmFsIik7Cgp2YXIgX3RyYW5zaWVudCA9IHJlcXVpcmUoIi4vdHJhbnNpZW50Iik7Cgp2YXIgYXJncyA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoIi4vcmVzb2x2ZWRfYXJncyIpKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9Cgp2YXIgc3RyaW5ncyA9IF9pMThuLkVycm9yU3RyaW5ncy5hY3Rpb25zRWxlbWVudHM7CnZhciBzZXQgPSBfb2JqZWN0UGF0aEltbXV0YWJsZS5kZWZhdWx0LnNldCwKICAgIGRlbCA9IF9vYmplY3RQYXRoSW1tdXRhYmxlLmRlZmF1bHQuZGVsOwoKZnVuY3Rpb24gZ2V0U2libGluZ0NvbnRleHQoc3RhdGUsIGVsZW1lbnRJZCwgY2hlY2tJbmRleCkgewogIHZhciBwcmV2Q29udGV4dFBhdGggPSBbZWxlbWVudElkLCAnZXhwcmVzc2lvbkNvbnRleHQnLCBjaGVja0luZGV4XTsKICB2YXIgcHJldkNvbnRleHRWYWx1ZSA9ICgwLCBfcmVzb2x2ZWRfYXJncy5nZXRWYWx1ZSkoc3RhdGUsIHByZXZDb250ZXh0UGF0aCk7IC8vIGlmIGEgdmFsdWUgaXMgZm91bmQsIHJldHVybiBpdCwgYWxvbmcgd2l0aCB0aGUgaW5kZXggaXQgd2FzIGZvdW5kIGF0CgogIGlmIChwcmV2Q29udGV4dFZhbHVlICE9IG51bGwpIHsKICAgIHJldHVybiB7CiAgICAgIGluZGV4OiBjaGVja0luZGV4LAogICAgICBjb250ZXh0OiBwcmV2Q29udGV4dFZhbHVlCiAgICB9OwogIH0gLy8gY2hlY2sgcHJldmlvdXMgaW5kZXggd2hpbGUgd2UncmUgc3RpbGwgYWJvdmUgMAoKCiAgdmFyIHByZXZDb250ZXh0SW5kZXggPSBjaGVja0luZGV4IC0gMTsKCiAgaWYgKHByZXZDb250ZXh0SW5kZXggPCAwKSB7CiAgICByZXR1cm4ge307CiAgfSAvLyB3YWxrIGJhY2sgdXAgdG8gZmluZCB0aGUgY2xvc2VzdCBjYWNoZWQgY29udGV4dCBhdmFpbGFibGUKCgogIHJldHVybiBnZXRTaWJsaW5nQ29udGV4dChzdGF0ZSwgZWxlbWVudElkLCBwcmV2Q29udGV4dEluZGV4KTsKfQoKZnVuY3Rpb24gZ2V0QmFyZUVsZW1lbnQoZWwpIHsKICB2YXIgaW5jbHVkZUlkID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICB2YXIgcHJvcHMgPSBbJ3Bvc2l0aW9uJywgJ2V4cHJlc3Npb24nLCAnZmlsdGVyJ107CgogIGlmIChpbmNsdWRlSWQpIHsKICAgIHJldHVybiAoMCwgX2xvZGFzaC5waWNrKShlbCwgcHJvcHMuY29uY2F0KCdpZCcpKTsKICB9CgogIHJldHVybiAoMCwgX2xvZGFzaC5jbG9uZURlZXApKCgwLCBfbG9kYXNoLnBpY2spKGVsLCBwcm9wcykpOwp9Cgp2YXIgZWxlbWVudExheWVyID0gKDAsIF9yZWR1eEFjdGlvbnMuY3JlYXRlQWN0aW9uKSgnZWxlbWVudExheWVyJyk7CmV4cG9ydHMuZWxlbWVudExheWVyID0gZWxlbWVudExheWVyOwp2YXIgc2V0TXVsdGlwbGVQb3NpdGlvbnMgPSAoMCwgX3JlZHV4QWN0aW9ucy5jcmVhdGVBY3Rpb24pKCdzZXRNdWx0aXBsZVBvc2l0aW9uJywgZnVuY3Rpb24gKHJlcG9zaXRpb25lZEVsZW1lbnRzKSB7CiAgcmV0dXJuIHsKICAgIHJlcG9zaXRpb25lZEVsZW1lbnRzOiByZXBvc2l0aW9uZWRFbGVtZW50cwogIH07Cn0pOwpleHBvcnRzLnNldE11bHRpcGxlUG9zaXRpb25zID0gc2V0TXVsdGlwbGVQb3NpdGlvbnM7CnZhciBmbHVzaENvbnRleHQgPSAoMCwgX3JlZHV4QWN0aW9ucy5jcmVhdGVBY3Rpb24pKCdmbHVzaENvbnRleHQnKTsKZXhwb3J0cy5mbHVzaENvbnRleHQgPSBmbHVzaENvbnRleHQ7CnZhciBmbHVzaENvbnRleHRBZnRlckluZGV4ID0gKDAsIF9yZWR1eEFjdGlvbnMuY3JlYXRlQWN0aW9uKSgnZmx1c2hDb250ZXh0QWZ0ZXJJbmRleCcpOwpleHBvcnRzLmZsdXNoQ29udGV4dEFmdGVySW5kZXggPSBmbHVzaENvbnRleHRBZnRlckluZGV4Owp2YXIgZmV0Y2hDb250ZXh0ID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ2ZldGNoQ29udGV4dCcsIGZ1bmN0aW9uIChfcmVmLCBpbmRleCwgZWxlbWVudCkgewogIHZhciBkaXNwYXRjaCA9IF9yZWYuZGlzcGF0Y2gsCiAgICAgIGdldFN0YXRlID0gX3JlZi5nZXRTdGF0ZTsKICB2YXIgZnVsbFJlZnJlc2ggPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IGZhbHNlOwogIHZhciBjaGFpbiA9ICgwLCBfbG9kYXNoLmdldCkoZWxlbWVudCwgJ2FzdC5jaGFpbicpOwogIHZhciBpbnZhbGlkSW5kZXggPSBjaGFpbiA/IGluZGV4ID49IGNoYWluLmxlbmd0aCA6IHRydWU7CgogIGlmICghZWxlbWVudCB8fCAhY2hhaW4gfHwgaW52YWxpZEluZGV4KSB7CiAgICB0aHJvdyBuZXcgRXJyb3Ioc3RyaW5ncy5nZXRJbnZhbGlkQXJnSW5kZXhFcnJvck1lc3NhZ2UoaW5kZXgpKTsKICB9IC8vIGNhY2hlIGNvbnRleHQgYXMgdGhlIHByZXZpb3VzIGluZGV4CgoKICB2YXIgY29udGV4dEluZGV4ID0gaW5kZXggLSAxOwogIHZhciBjb250ZXh0UGF0aCA9IFtlbGVtZW50LmlkLCAnZXhwcmVzc2lvbkNvbnRleHQnLCBjb250ZXh0SW5kZXhdOyAvLyBzZXQgY29udGV4dCBzdGF0ZSB0byBsb2FkaW5nCgogIGRpc3BhdGNoKGFyZ3Muc2V0TG9hZGluZyh7CiAgICBwYXRoOiBjb250ZXh0UGF0aAogIH0pKTsgLy8gZnVuY3Rpb24gdG8gd2FsayBiYWNrIHVwIHRvIGZpbmQgdGhlIGNsb3Nlc3QgY29udGV4dCBhdmFpbGFibGUKCiAgdmFyIGdldENvbnRleHQgPSBmdW5jdGlvbiBnZXRDb250ZXh0KCkgewogICAgcmV0dXJuIGdldFNpYmxpbmdDb250ZXh0KGdldFN0YXRlKCksIGVsZW1lbnQuaWQsIGNvbnRleHRJbmRleCAtIDEpOwogIH07CgogIHZhciBfcmVmMiA9IGZ1bGxSZWZyZXNoICE9PSB0cnVlID8gZ2V0Q29udGV4dCgpIDoge30sCiAgICAgIHByZXZDb250ZXh0SW5kZXggPSBfcmVmMi5pbmRleCwKICAgICAgcHJldkNvbnRleHRWYWx1ZSA9IF9yZWYyLmNvbnRleHQ7IC8vIG1vZGlmeSB0aGUgYXN0IGNoYWluIHBhc3NlZCB0byB0aGUgaW50ZXJwcmV0ZXIKCgogIHZhciBhc3RDaGFpbiA9IGVsZW1lbnQuYXN0LmNoYWluLmZpbHRlcihmdW5jdGlvbiAoZXhwLCBpKSB7CiAgICBpZiAocHJldkNvbnRleHRWYWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBpID4gcHJldkNvbnRleHRJbmRleCAmJiBpIDwgaW5kZXg7CiAgICB9CgogICAgcmV0dXJuIGkgPCBpbmRleDsKICB9KTsgLy8gZ2V0IGNvbnRleHQgZGF0YSBmcm9tIGEgcGFydGlhbCBBU1QKCiAgcmV0dXJuICgwLCBfaW50ZXJwcmV0ZXIuaW50ZXJwcmV0QXN0KShfb2JqZWN0U3ByZWFkKHt9LCBlbGVtZW50LmFzdCwgewogICAgY2hhaW46IGFzdENoYWluCiAgfSksIHByZXZDb250ZXh0VmFsdWUpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICBkaXNwYXRjaChhcmdzLnNldFZhbHVlKHsKICAgICAgcGF0aDogY29udGV4dFBhdGgsCiAgICAgIHZhbHVlOiB2YWx1ZQogICAgfSkpOwogIH0pOwp9KTsKZXhwb3J0cy5mZXRjaENvbnRleHQgPSBmZXRjaENvbnRleHQ7Cgp2YXIgZmV0Y2hSZW5kZXJhYmxlV2l0aENvbnRleHRGbiA9IGZ1bmN0aW9uIGZldGNoUmVuZGVyYWJsZVdpdGhDb250ZXh0Rm4oX3JlZjMsIGVsZW1lbnQsIGFzdCwgY29udGV4dCkgewogIHZhciBkaXNwYXRjaCA9IF9yZWYzLmRpc3BhdGNoOwogIHZhciBhcmd1bWVudFBhdGggPSBbZWxlbWVudC5pZCwgJ2V4cHJlc3Npb25SZW5kZXJhYmxlJ107CiAgZGlzcGF0Y2goYXJncy5zZXRMb2FkaW5nKHsKICAgIHBhdGg6IGFyZ3VtZW50UGF0aAogIH0pKTsKCiAgdmFyIGdldEFjdGlvbiA9IGZ1bmN0aW9uIGdldEFjdGlvbihyZW5kZXJhYmxlKSB7CiAgICByZXR1cm4gYXJncy5zZXRWYWx1ZSh7CiAgICAgIHBhdGg6IGFyZ3VtZW50UGF0aCwKICAgICAgdmFsdWU6IHJlbmRlcmFibGUKICAgIH0pOwogIH07CgogIHJldHVybiAoMCwgX3J1bl9pbnRlcnByZXRlci5ydW5JbnRlcnByZXRlcikoYXN0LCBjb250ZXh0LCB7CiAgICBjYXN0VG9SZW5kZXI6IHRydWUKICB9KS50aGVuKGZ1bmN0aW9uIChyZW5kZXJhYmxlKSB7CiAgICBkaXNwYXRjaChnZXRBY3Rpb24ocmVuZGVyYWJsZSkpOwogIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgIF9ub3RpZnkubm90aWZ5LmVycm9yKGVycik7CgogICAgZGlzcGF0Y2goZ2V0QWN0aW9uKGVycikpOwogIH0pOwp9OwoKdmFyIGZldGNoUmVuZGVyYWJsZVdpdGhDb250ZXh0ID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ2ZldGNoUmVuZGVyYWJsZVdpdGhDb250ZXh0JywgZmV0Y2hSZW5kZXJhYmxlV2l0aENvbnRleHRGbik7CmV4cG9ydHMuZmV0Y2hSZW5kZXJhYmxlV2l0aENvbnRleHQgPSBmZXRjaFJlbmRlcmFibGVXaXRoQ29udGV4dDsKdmFyIGZldGNoUmVuZGVyYWJsZSA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdmZXRjaFJlbmRlcmFibGUnLCBmdW5jdGlvbiAoX3JlZjQsIGVsZW1lbnQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmNC5kaXNwYXRjaDsKICB2YXIgYXN0ID0gZWxlbWVudC5hc3QgfHwgKDAsIF9jb21tb24uc2FmZUVsZW1lbnRGcm9tRXhwcmVzc2lvbikoZWxlbWVudC5leHByZXNzaW9uKTsKICBkaXNwYXRjaChmZXRjaFJlbmRlcmFibGVXaXRoQ29udGV4dChlbGVtZW50LCBhc3QsIG51bGwpKTsKfSk7CmV4cG9ydHMuZmV0Y2hSZW5kZXJhYmxlID0gZmV0Y2hSZW5kZXJhYmxlOwp2YXIgZmV0Y2hBbGxSZW5kZXJhYmxlcyA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdmZXRjaEFsbFJlbmRlcmFibGVzJywgZnVuY3Rpb24gKF9yZWY1KSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZjUuZGlzcGF0Y2gsCiAgICAgIGdldFN0YXRlID0gX3JlZjUuZ2V0U3RhdGU7CgogIHZhciBfcmVmNiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge30sCiAgICAgIF9yZWY2JG9ubHlBY3RpdmVQYWdlID0gX3JlZjYub25seUFjdGl2ZVBhZ2UsCiAgICAgIG9ubHlBY3RpdmVQYWdlID0gX3JlZjYkb25seUFjdGl2ZVBhZ2UgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjYkb25seUFjdGl2ZVBhZ2U7CgogIHZhciB3b3JrcGFkUGFnZXMgPSAoMCwgX3dvcmtwYWQuZ2V0UGFnZXMpKGdldFN0YXRlKCkpOwogIHZhciBjdXJyZW50UGFnZUluZGV4ID0gKDAsIF93b3JrcGFkLmdldFNlbGVjdGVkUGFnZUluZGV4KShnZXRTdGF0ZSgpKTsKICB2YXIgY3VycmVudFBhZ2UgPSB3b3JrcGFkUGFnZXNbY3VycmVudFBhZ2VJbmRleF07CiAgdmFyIG90aGVyUGFnZXMgPSAoMCwgX2xvZGFzaC53aXRob3V0KSh3b3JrcGFkUGFnZXMsIGN1cnJlbnRQYWdlKTsKICBkaXNwYXRjaChhcmdzLmluRmxpZ2h0QWN0aXZlKCkpOwoKICBmdW5jdGlvbiBmZXRjaEVsZW1lbnRzT25QYWdlcyhwYWdlcykgewogICAgdmFyIGVsZW1lbnRzID0gW107CiAgICBwYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgIHBhZ2UuZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgIGVsZW1lbnRzLnB1c2goZWxlbWVudCk7CiAgICAgIH0pOwogICAgfSk7CiAgICB2YXIgcmVuZGVyYWJsZVByb21pc2VzID0gZWxlbWVudHMubWFwKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgIHZhciBhc3QgPSBlbGVtZW50LmFzdCB8fCAoMCwgX2NvbW1vbi5zYWZlRWxlbWVudEZyb21FeHByZXNzaW9uKShlbGVtZW50LmV4cHJlc3Npb24pOwogICAgICB2YXIgYXJndW1lbnRQYXRoID0gW2VsZW1lbnQuaWQsICdleHByZXNzaW9uUmVuZGVyYWJsZSddOwogICAgICByZXR1cm4gKDAsIF9ydW5faW50ZXJwcmV0ZXIucnVuSW50ZXJwcmV0ZXIpKGFzdCwgbnVsbCwgewogICAgICAgIGNhc3RUb1JlbmRlcjogdHJ1ZQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZW5kZXJhYmxlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHBhdGg6IGFyZ3VtZW50UGF0aCwKICAgICAgICAgIHZhbHVlOiByZW5kZXJhYmxlCiAgICAgICAgfTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgIF9ub3RpZnkubm90aWZ5LmVycm9yKGVycik7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwYXRoOiBhcmd1bWVudFBhdGgsCiAgICAgICAgICB2YWx1ZTogZXJyCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiBQcm9taXNlLmFsbChyZW5kZXJhYmxlUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKHJlbmRlcmFibGVzKSB7CiAgICAgIGRpc3BhdGNoKGFyZ3Muc2V0VmFsdWVzKHJlbmRlcmFibGVzKSk7CiAgICB9KTsKICB9CgogIGlmIChvbmx5QWN0aXZlUGFnZSkgewogICAgZmV0Y2hFbGVtZW50c09uUGFnZXMoW2N1cnJlbnRQYWdlXSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBkaXNwYXRjaChhcmdzLmluRmxpZ2h0Q29tcGxldGUoKSk7CiAgICB9KTsKICB9IGVsc2UgewogICAgZmV0Y2hFbGVtZW50c09uUGFnZXMoW2N1cnJlbnRQYWdlXSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBvdGhlclBhZ2VzLnJlZHVjZShmdW5jdGlvbiAoY2hhaW4sIHBhZ2UpIHsKICAgICAgICByZXR1cm4gY2hhaW4udGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZmV0Y2hFbGVtZW50c09uUGFnZXMoW3BhZ2VdKTsKICAgICAgICB9KTsKICAgICAgfSwgUHJvbWlzZS5yZXNvbHZlKCkpOwogICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBkaXNwYXRjaChhcmdzLmluRmxpZ2h0Q29tcGxldGUoKSk7CiAgICB9KTsKICB9Cn0pOwpleHBvcnRzLmZldGNoQWxsUmVuZGVyYWJsZXMgPSBmZXRjaEFsbFJlbmRlcmFibGVzOwp2YXIgaW5zZXJ0Tm9kZXMgPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnaW5zZXJ0Tm9kZXMnLCBmdW5jdGlvbiAoX3JlZjcsIGVsZW1lbnRzLCBwYWdlSWQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmNy5kaXNwYXRjaCwKICAgICAgdHlwZSA9IF9yZWY3LnR5cGU7CgogIHZhciBfaW5zZXJ0Tm9kZXMgPSAoMCwgX3JlZHV4QWN0aW9ucy5jcmVhdGVBY3Rpb24pKHR5cGUpOwoKICB2YXIgbmV3RWxlbWVudHMgPSBlbGVtZW50cy5tYXAoX2xvZGFzaC5jbG9uZURlZXApOyAvLyBtb3ZlIHRoZSByb290IGVsZW1lbnQgc28gdXNlcnMgY2FuIHNlZSB0aGF0IGl0IHdhcyBhZGRlZAoKICBuZXdFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChuZXdFbGVtZW50KSB7CiAgICBuZXdFbGVtZW50LnBvc2l0aW9uLnRvcCA9IG5ld0VsZW1lbnQucG9zaXRpb24udG9wICsgMTA7CiAgICBuZXdFbGVtZW50LnBvc2l0aW9uLmxlZnQgPSBuZXdFbGVtZW50LnBvc2l0aW9uLmxlZnQgKyAxMDsKICB9KTsKICBkaXNwYXRjaChfaW5zZXJ0Tm9kZXMoewogICAgcGFnZUlkOiBwYWdlSWQsCiAgICBlbGVtZW50czogbmV3RWxlbWVudHMKICB9KSk7IC8vIHJlZnJlc2ggYWxsIGVsZW1lbnRzIGp1c3Qgb25jZSBwZXIgYGluc2VydE5vZGVzIGNhbGxgIGlmIHRoZXJlJ3MgYSBmaWx0ZXIgb24gYW55LCBvdGhlcndpc2UganVzdCByZW5kZXIgdGhlIG5ldyBlbGVtZW50CgogIGlmIChlbGVtZW50cy5zb21lKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudC5maWx0ZXI7CiAgfSkpIHsKICAgIGRpc3BhdGNoKGZldGNoQWxsUmVuZGVyYWJsZXMoKSk7CiAgfSBlbHNlIHsKICAgIG5ld0VsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKG5ld0VsZW1lbnQpIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKGZldGNoUmVuZGVyYWJsZShuZXdFbGVtZW50KSk7CiAgICB9KTsKICB9Cn0pOwpleHBvcnRzLmluc2VydE5vZGVzID0gaW5zZXJ0Tm9kZXM7CnZhciByZW1vdmVFbGVtZW50cyA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdyZW1vdmVFbGVtZW50cycsIGZ1bmN0aW9uIChfcmVmOCwgcm9vdEVsZW1lbnRJZHMsIHBhZ2VJZCkgewogIHZhciBkaXNwYXRjaCA9IF9yZWY4LmRpc3BhdGNoLAogICAgICBnZXRTdGF0ZSA9IF9yZWY4LmdldFN0YXRlOwogIHZhciBzdGF0ZSA9IGdldFN0YXRlKCk7IC8vIHRvZG8gY29uc2lkZXIgZG9pbmcgdGhlIGdyb3VwIG1lbWJlcnNoaXAgY29sbGF0aW9uIGluIGFlcm9lbGFzdGljLCBvciB0aGUgUmVkdXggcmVkdWNlciwgd2hlbiBhZGRpbmcgdGVtcGxhdGVzCgogIHZhciBhbGxFbGVtZW50cyA9ICgwLCBfd29ya3BhZC5nZXROb2Rlcykoc3RhdGUsIHBhZ2VJZCk7CiAgdmFyIGFsbFJvb3RzID0gcm9vdEVsZW1lbnRJZHMubWFwKGZ1bmN0aW9uIChpZCkgewogICAgcmV0dXJuIGFsbEVsZW1lbnRzLmZpbmQoZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIGlkID09PSBlLmlkOwogICAgfSk7CiAgfSkuZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICByZXR1cm4gZDsKICB9KTsKICB2YXIgZWxlbWVudElkcyA9ICgwLCBfZnVuY3Rpb25hbC5zdWJNdWx0aXRyZWUpKGZ1bmN0aW9uIChlKSB7CiAgICByZXR1cm4gZS5pZDsKICB9LCBmdW5jdGlvbiAoZSkgewogICAgcmV0dXJuIGUucG9zaXRpb24ucGFyZW50OwogIH0sIGFsbEVsZW1lbnRzLCBhbGxSb290cykubWFwKGZ1bmN0aW9uIChlKSB7CiAgICByZXR1cm4gZS5pZDsKICB9KTsKICB2YXIgc2hvdWxkUmVmcmVzaCA9IGVsZW1lbnRJZHMuc29tZShmdW5jdGlvbiAoZWxlbWVudElkKSB7CiAgICB2YXIgZWxlbWVudCA9ICgwLCBfd29ya3BhZC5nZXROb2RlQnlJZCkoc3RhdGUsIGVsZW1lbnRJZCwgcGFnZUlkKTsKICAgIHZhciBmaWx0ZXJJc0FwcGxpZWQgPSBlbGVtZW50LmZpbHRlciAmJiBlbGVtZW50LmZpbHRlci5sZW5ndGggPiAwOwogICAgcmV0dXJuIGZpbHRlcklzQXBwbGllZDsKICB9KTsKCiAgdmFyIF9yZW1vdmVFbGVtZW50cyA9ICgwLCBfcmVkdXhBY3Rpb25zLmNyZWF0ZUFjdGlvbikoJ3JlbW92ZUVsZW1lbnRzJywgZnVuY3Rpb24gKGVsZW1lbnRJZHMsIHBhZ2VJZCkgewogICAgcmV0dXJuIHsKICAgICAgZWxlbWVudElkczogZWxlbWVudElkcywKICAgICAgcGFnZUlkOiBwYWdlSWQKICAgIH07CiAgfSk7CgogIGRpc3BhdGNoKF9yZW1vdmVFbGVtZW50cyhlbGVtZW50SWRzLCBwYWdlSWQpKTsKCiAgaWYgKHNob3VsZFJlZnJlc2gpIHsKICAgIGRpc3BhdGNoKGZldGNoQWxsUmVuZGVyYWJsZXMoKSk7CiAgfQp9KTsKZXhwb3J0cy5yZW1vdmVFbGVtZW50cyA9IHJlbW92ZUVsZW1lbnRzOwp2YXIgc2V0RmlsdGVyID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ3NldEZpbHRlcicsIGZ1bmN0aW9uIChfcmVmOSwgZmlsdGVyLCBlbGVtZW50SWQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmOS5kaXNwYXRjaDsKICB2YXIgZG9SZW5kZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IHRydWU7CgogIHZhciBfc2V0RmlsdGVyID0gKDAsIF9yZWR1eEFjdGlvbnMuY3JlYXRlQWN0aW9uKSgnc2V0RmlsdGVyJyk7CgogIGRpc3BhdGNoKF9zZXRGaWx0ZXIoewogICAgZmlsdGVyOiBmaWx0ZXIsCiAgICBlbGVtZW50SWQ6IGVsZW1lbnRJZAogIH0pKTsKCiAgaWYgKGRvUmVuZGVyID09PSB0cnVlKSB7CiAgICBkaXNwYXRjaChmZXRjaEFsbFJlbmRlcmFibGVzKCkpOwogIH0KfSk7CmV4cG9ydHMuc2V0RmlsdGVyID0gc2V0RmlsdGVyOwp2YXIgc2V0RXhwcmVzc2lvbiA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdzZXRFeHByZXNzaW9uJywgc2V0RXhwcmVzc2lvbkZuKTsKZXhwb3J0cy5zZXRFeHByZXNzaW9uID0gc2V0RXhwcmVzc2lvbjsKCmZ1bmN0aW9uIHNldEV4cHJlc3Npb25GbihfcmVmMTAsIGV4cHJlc3Npb24sIGVsZW1lbnRJZCwgcGFnZUlkKSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZjEwLmRpc3BhdGNoLAogICAgICBnZXRTdGF0ZSA9IF9yZWYxMC5nZXRTdGF0ZTsKICB2YXIgZG9SZW5kZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6IHRydWU7CgogIC8vIGRpc3BhdGNoIGFjdGlvbiB0byB1cGRhdGUgdGhlIGVsZW1lbnQgaW4gc3RhdGUKICB2YXIgX3NldEV4cHJlc3Npb24gPSAoMCwgX3JlZHV4QWN0aW9ucy5jcmVhdGVBY3Rpb24pKCdzZXRFeHByZXNzaW9uJyk7CgogIGRpc3BhdGNoKF9zZXRFeHByZXNzaW9uKHsKICAgIGV4cHJlc3Npb246IGV4cHJlc3Npb24sCiAgICBlbGVtZW50SWQ6IGVsZW1lbnRJZCwKICAgIHBhZ2VJZDogcGFnZUlkCiAgfSkpOyAvLyByZWFkIHVwZGF0ZWQgZWxlbWVudCBmcm9tIHN0YXRlIGFuZCBmZXRjaCByZW5kZXJhYmxlCgogIHZhciB1cGRhdGVkRWxlbWVudCA9ICgwLCBfd29ya3BhZC5nZXROb2RlQnlJZCkoZ2V0U3RhdGUoKSwgZWxlbWVudElkLCBwYWdlSWQpOyAvLyByZXNldCBlbGVtZW50LmZpbHRlciBpZiBlbGVtZW50IGlzIG5vIGxvbmdlciBhIGZpbHRlcgogIC8vIFRPRE86IGZpbmQgYSB3YXkgdG8gZXh0cmFjdCBhIGxpc3Qgb2YgZmlsdGVyIHJlbmRlcmVycyBmcm9tIHRoZSBmdW5jdGlvbnMgcmVnaXN0cnkKCiAgaWYgKHVwZGF0ZWRFbGVtZW50LmZpbHRlciAmJiAhWydkcm9wZG93bkNvbnRyb2wnLCAndGltZWZpbHRlckNvbnRyb2wnLCAnZXhhY3RseSddLnNvbWUoZnVuY3Rpb24gKGZpbHRlcikgewogICAgcmV0dXJuIHVwZGF0ZWRFbGVtZW50LmV4cHJlc3Npb24uaW5jbHVkZXMoZmlsdGVyKTsKICB9KSkgewogICAgdmFyIGZpbHRlciA9ICcnOwogICAgZGlzcGF0Y2goc2V0RmlsdGVyKGZpbHRlciwgZWxlbWVudElkLCBwYWdlSWQsIGRvUmVuZGVyKSk7IC8vIHNldEZpbHRlciB3aWxsIHRyaWdnZXIgYSByZS1yZW5kZXIgc28gd2UgY2FuIHNraXAgdGhlIGZldGNoIGhlcmUKICB9IGVsc2UgaWYgKGRvUmVuZGVyID09PSB0cnVlKSB7CiAgICBkaXNwYXRjaChmZXRjaFJlbmRlcmFibGUodXBkYXRlZEVsZW1lbnQpKTsKICB9Cn0KCnZhciBzZXRBc3QgPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnc2V0QXN0JywgZnVuY3Rpb24gKF9yZWYxMSwgYXN0LCBlbGVtZW50LCBwYWdlSWQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmMTEuZGlzcGF0Y2g7CiAgdmFyIGRvUmVuZGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiB0cnVlOwoKICB0cnkgewogICAgdmFyIGV4cHJlc3Npb24gPSAoMCwgX2NvbW1vbi50b0V4cHJlc3Npb24pKGFzdCk7CiAgICBkaXNwYXRjaChzZXRFeHByZXNzaW9uKGV4cHJlc3Npb24sIGVsZW1lbnQuaWQsIHBhZ2VJZCwgZG9SZW5kZXIpKTsKICB9IGNhdGNoIChlcnIpIHsKICAgIF9ub3RpZnkubm90aWZ5LmVycm9yKGVycik7IC8vIFRPRE86IHJlbW92ZSB0aGlzLCBtYXkgaGF2ZSBiZWVuIGFkZGVkIGp1c3QgdG8gY2F1c2UgYSByZS1yZW5kZXIsIGJ1dCB3aHk/CgoKICAgIGRpc3BhdGNoKHNldEV4cHJlc3Npb24oZWxlbWVudC5leHByZXNzaW9uLCBlbGVtZW50LmlkLCBwYWdlSWQsIGRvUmVuZGVyKSk7CiAgfQp9KTsgLy8gaW5kZXggaGVyZSBpcyB0aGUgdG9wLWxldmVsIGFyZ3VtZW50IGluIHRoZSBleHByZXNzaW9uLiBmb3IgZXhhbXBsZSBpbiB0aGUgZXhwcmVzc2lvbgovLyBkZW1vZGF0YSgpLnBvaW50c2VyaWVzKCkucGxvdCgpLCBkZW1vZGF0YSBpcyAwLCBwb2ludHNlcmllcyBpcyAxLCBhbmQgcGxvdCBpcyAyCgp2YXIgc2V0QXN0QXRJbmRleCA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdzZXRBc3RBdEluZGV4JywgZnVuY3Rpb24gKF9yZWYxMiwgaW5kZXgsIGFzdCwgZWxlbWVudCwgcGFnZUlkKSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZjEyLmRpc3BhdGNoLAogICAgICBnZXRTdGF0ZSA9IF9yZWYxMi5nZXRTdGF0ZTsKICAvLyBpbnZhbGlkYXRlIGNhY2hlZCBjb250ZXh0IGZvciBlbGVtZW50cyBhZnRlciB0aGlzIGluZGV4CiAgZGlzcGF0Y2goZmx1c2hDb250ZXh0QWZ0ZXJJbmRleCh7CiAgICBlbGVtZW50SWQ6IGVsZW1lbnQuaWQsCiAgICBpbmRleDogaW5kZXgKICB9KSk7CiAgdmFyIG5ld0VsZW1lbnQgPSBzZXQoZWxlbWVudCwgImFzdC5jaGFpbi4iLmNvbmNhdChpbmRleCksIGFzdCk7CiAgdmFyIG5ld0FzdCA9ICgwLCBfbG9kYXNoLmdldCkobmV3RWxlbWVudCwgJ2FzdCcpOyAvLyBmZXRjaCByZW5kZXJhYmxlIHVzaW5nIGV4aXN0aW5nIGNvbnRleHQsIGlmIGF2YWlsYWJsZSAodmFsdWUgaXMgbnVsbCBpZiBub3QgY2FjaGVkKQoKICB2YXIgX2dldFNpYmxpbmdDb250ZXh0ID0gZ2V0U2libGluZ0NvbnRleHQoZ2V0U3RhdGUoKSwgZWxlbWVudC5pZCwgaW5kZXggLSAxKSwKICAgICAgY29udGV4dEluZGV4ID0gX2dldFNpYmxpbmdDb250ZXh0LmluZGV4LAogICAgICBjb250ZXh0VmFsdWUgPSBfZ2V0U2libGluZ0NvbnRleHQuY29udGV4dDsgLy8gaWYgd2UgaGF2ZSBhIGNhY2hlZCBjb250ZXh0LCB1cGRhdGUgdGhlIGV4cHJlc3Npb24sIGJ1dCB1c2UgY2FjaGUgd2hlbiB1cGRhdGluZyB0aGUgcmVuZGVyYWJsZQoKCiAgaWYgKGNvbnRleHRWYWx1ZSkgewogICAgLy8gc2V0IHRoZSBleHByZXNzaW9uLCBidXQgc2tpcCB0aGUgZmV0Y2hSZW5kZXJhYmxlIHN0ZXAKICAgIGRpc3BhdGNoKHNldEFzdChuZXdBc3QsIGVsZW1lbnQsIHBhZ2VJZCwgZmFsc2UpKTsgLy8gdXNlIGNvbnRleHQgd2hlbiB1cGRhdGluZyB0aGUgZXhwcmVzc2lvbiwgaXQgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGludGVwcmV0ZXIKCiAgICB2YXIgcGFydGlhbEFzdCA9IF9vYmplY3RTcHJlYWQoe30sIG5ld0FzdCwgewogICAgICBjaGFpbjogbmV3QXN0LmNoYWluLmZpbHRlcihmdW5jdGlvbiAoZXhwLCBpKSB7CiAgICAgICAgaWYgKGNvbnRleHRWYWx1ZSkgewogICAgICAgICAgcmV0dXJuIGkgPiBjb250ZXh0SW5kZXg7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaSA+PSBpbmRleDsKICAgICAgfSkKICAgIH0pOwoKICAgIHJldHVybiBkaXNwYXRjaChmZXRjaFJlbmRlcmFibGVXaXRoQ29udGV4dChuZXdFbGVtZW50LCBwYXJ0aWFsQXN0LCBjb250ZXh0VmFsdWUpKTsKICB9IC8vIGlmIG5vIGNhY2hlZCBjb250ZXh0LCB1cGRhdGUgdGhlIGFzdCBsaWtlIG5vcm1hbAoKCiAgZGlzcGF0Y2goc2V0QXN0KG5ld0FzdCwgZWxlbWVudCwgcGFnZUlkKSk7Cn0pOyAvLyBpbmRleCBoZXJlIGlzIHRoZSB0b3AtbGV2ZWwgYXJndW1lbnQgaW4gdGhlIGV4cHJlc3Npb24uIGZvciBleGFtcGxlIGluIHRoZSBleHByZXNzaW9uCi8vIGRlbW9kYXRhKCkucG9pbnRzZXJpZXMoKS5wbG90KCksIGRlbW9kYXRhIGlzIDAsIHBvaW50c2VyaWVzIGlzIDEsIGFuZCBwbG90IGlzIDIKLy8gYXJnSW5kZXggaXMgdGhlIGluZGV4IGluIG11bHRpLXZhbHVlIGFyZ3VtZW50cywgYW5kIGlzIG9wdGlvbmFsLiBleGNsdWRpbmcgaXQgd2lsbCBjYXVzZQovLyB0aGUgZW50aXJlIGFyZ3VtZW50IGZyb20gYmUgc2V0IHRvIHRoZSBwYXNzZWQgdmFsdWUKCmV4cG9ydHMuc2V0QXN0QXRJbmRleCA9IHNldEFzdEF0SW5kZXg7CnZhciBzZXRBcmd1bWVudEF0SW5kZXggPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnc2V0QXJndW1lbnRBdEluZGV4JywgZnVuY3Rpb24gKF9yZWYxMywgYXJncykgewogIHZhciBkaXNwYXRjaCA9IF9yZWYxMy5kaXNwYXRjaDsKICB2YXIgaW5kZXggPSBhcmdzLmluZGV4LAogICAgICBhcmdOYW1lID0gYXJncy5hcmdOYW1lLAogICAgICB2YWx1ZSA9IGFyZ3MudmFsdWUsCiAgICAgIHZhbHVlSW5kZXggPSBhcmdzLnZhbHVlSW5kZXgsCiAgICAgIGVsZW1lbnQgPSBhcmdzLmVsZW1lbnQsCiAgICAgIHBhZ2VJZCA9IGFyZ3MucGFnZUlkOwogIHZhciBzZWxlY3RvciA9ICJhc3QuY2hhaW4uIi5jb25jYXQoaW5kZXgsICIuYXJndW1lbnRzLiIpLmNvbmNhdChhcmdOYW1lKTsKCiAgaWYgKHZhbHVlSW5kZXggIT0gbnVsbCkgewogICAgc2VsZWN0b3IgKz0gJy4nICsgdmFsdWVJbmRleDsKICB9CgogIHZhciBuZXdFbGVtZW50ID0gc2V0KGVsZW1lbnQsIHNlbGVjdG9yLCB2YWx1ZSk7CiAgdmFyIG5ld0FzdCA9ICgwLCBfbG9kYXNoLmdldCkobmV3RWxlbWVudCwgWydhc3QnLCAnY2hhaW4nLCBpbmRleF0pOwogIGRpc3BhdGNoKHNldEFzdEF0SW5kZXgoaW5kZXgsIG5ld0FzdCwgZWxlbWVudCwgcGFnZUlkKSk7Cn0pOyAvLyBpbmRleCBoZXJlIGlzIHRoZSB0b3AtbGV2ZWwgYXJndW1lbnQgaW4gdGhlIGV4cHJlc3Npb24uIGZvciBleGFtcGxlIGluIHRoZSBleHByZXNzaW9uCi8vIGRlbW9kYXRhKCkucG9pbnRzZXJpZXMoKS5wbG90KCksIGRlbW9kYXRhIGlzIDAsIHBvaW50c2VyaWVzIGlzIDEsIGFuZCBwbG90IGlzIDIKCmV4cG9ydHMuc2V0QXJndW1lbnRBdEluZGV4ID0gc2V0QXJndW1lbnRBdEluZGV4Owp2YXIgYWRkQXJndW1lbnRWYWx1ZUF0SW5kZXggPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnYWRkQXJndW1lbnRWYWx1ZUF0SW5kZXgnLCBmdW5jdGlvbiAoX3JlZjE0LCBhcmdzKSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZjE0LmRpc3BhdGNoOwogIHZhciBpbmRleCA9IGFyZ3MuaW5kZXgsCiAgICAgIGFyZ05hbWUgPSBhcmdzLmFyZ05hbWUsCiAgICAgIHZhbHVlID0gYXJncy52YWx1ZSwKICAgICAgZWxlbWVudCA9IGFyZ3MuZWxlbWVudDsKICB2YXIgdmFsdWVzID0gKDAsIF9sb2Rhc2guZ2V0KShlbGVtZW50LCBbJ2FzdCcsICdjaGFpbicsIGluZGV4LCAnYXJndW1lbnRzJywgYXJnTmFtZV0sIFtdKTsKICB2YXIgbmV3VmFsdWUgPSB2YWx1ZXMuY29uY2F0KHZhbHVlKTsKICBkaXNwYXRjaChzZXRBcmd1bWVudEF0SW5kZXgoX29iamVjdFNwcmVhZCh7fSwgYXJncywgewogICAgdmFsdWU6IG5ld1ZhbHVlCiAgfSkpKTsKfSk7IC8vIGluZGV4IGhlcmUgaXMgdGhlIHRvcC1sZXZlbCBhcmd1bWVudCBpbiB0aGUgZXhwcmVzc2lvbi4gZm9yIGV4YW1wbGUgaW4gdGhlIGV4cHJlc3Npb24KLy8gZGVtb2RhdGEoKS5wb2ludHNlcmllcygpLnBsb3QoKSwgZGVtb2RhdGEgaXMgMCwgcG9pbnRzZXJpZXMgaXMgMSwgYW5kIHBsb3QgaXMgMgovLyBhcmdJbmRleCBpcyB0aGUgaW5kZXggaW4gbXVsdGktdmFsdWUgYXJndW1lbnRzLCBhbmQgaXMgb3B0aW9uYWwuIGV4Y2x1ZGluZyBpdCB3aWxsIHJlbW92ZQovLyB0aGUgZW50aXJlIGFyZ3VtZW50IGZyb20gdGhlIGV4cHJlc2lvbgoKZXhwb3J0cy5hZGRBcmd1bWVudFZhbHVlQXRJbmRleCA9IGFkZEFyZ3VtZW50VmFsdWVBdEluZGV4Owp2YXIgZGVsZXRlQXJndW1lbnRBdEluZGV4ID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ2RlbGV0ZUFyZ3VtZW50QXRJbmRleCcsIGZ1bmN0aW9uIChfcmVmMTUsIGFyZ3MpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmMTUuZGlzcGF0Y2g7CiAgdmFyIGluZGV4ID0gYXJncy5pbmRleCwKICAgICAgZWxlbWVudCA9IGFyZ3MuZWxlbWVudCwKICAgICAgcGFnZUlkID0gYXJncy5wYWdlSWQsCiAgICAgIGFyZ05hbWUgPSBhcmdzLmFyZ05hbWUsCiAgICAgIGFyZ0luZGV4ID0gYXJncy5hcmdJbmRleDsKICB2YXIgY3VyVmFsID0gKDAsIF9sb2Rhc2guZ2V0KShlbGVtZW50LCBbJ2FzdCcsICdjaGFpbicsIGluZGV4LCAnYXJndW1lbnRzJywgYXJnTmFtZV0pOwogIHZhciBuZXdFbGVtZW50ID0gYXJnSW5kZXggIT0gbnVsbCAmJiBjdXJWYWwubGVuZ3RoID4gMSA/IC8vIGlmIG1vcmUgdGhhbiBvbmUgdmFsLCByZW1vdmUgdGhlIHNwZWNpZmllZCB2YWwKICBkZWwoZWxlbWVudCwgImFzdC5jaGFpbi4iLmNvbmNhdChpbmRleCwgIi5hcmd1bWVudHMuIikuY29uY2F0KGFyZ05hbWUsICIuIikuY29uY2F0KGFyZ0luZGV4KSkgOiAvLyBvdGhlcndpc2UsIHJlbW92ZSB0aGUgZW50aXJlIGtleQogIGRlbChlbGVtZW50LCAiYXN0LmNoYWluLiIuY29uY2F0KGluZGV4LCAiLmFyZ3VtZW50cy4iKS5jb25jYXQoYXJnTmFtZSkpOwogIGRpc3BhdGNoKHNldEFzdEF0SW5kZXgoaW5kZXgsICgwLCBfbG9kYXNoLmdldCkobmV3RWxlbWVudCwgWydhc3QnLCAnY2hhaW4nLCBpbmRleF0pLCBlbGVtZW50LCBwYWdlSWQpKTsKfSk7Ci8qCiAgcGF5bG9hZDogZWxlbWVudCBkZWZhdWx0cy4gRWcge2V4cHJlc3Npb246ICdmb28nfQoqLwoKZXhwb3J0cy5kZWxldGVBcmd1bWVudEF0SW5kZXggPSBkZWxldGVBcmd1bWVudEF0SW5kZXg7CnZhciBhZGRFbGVtZW50ID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ2FkZEVsZW1lbnQnLCBmdW5jdGlvbiAoX3JlZjE2LCBwYWdlSWQsIGVsZW1lbnQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmMTYuZGlzcGF0Y2g7CgogIHZhciBuZXdFbGVtZW50ID0gX29iamVjdFNwcmVhZCh7fSwgKDAsIF9kZWZhdWx0cy5nZXREZWZhdWx0RWxlbWVudCkoKSwge30sIGdldEJhcmVFbGVtZW50KGVsZW1lbnQsIHRydWUpKTsKCiAgaWYgKGVsZW1lbnQud2lkdGgpIHsKICAgIG5ld0VsZW1lbnQucG9zaXRpb24ud2lkdGggPSBlbGVtZW50LndpZHRoOwogIH0KCiAgaWYgKGVsZW1lbnQuaGVpZ2h0KSB7CiAgICBuZXdFbGVtZW50LnBvc2l0aW9uLmhlaWdodCA9IGVsZW1lbnQuaGVpZ2h0OwogIH0KCiAgdmFyIF9hZGRFbGVtZW50ID0gKDAsIF9yZWR1eEFjdGlvbnMuY3JlYXRlQWN0aW9uKSgnYWRkRWxlbWVudCcpOwoKICBkaXNwYXRjaChfYWRkRWxlbWVudCh7CiAgICBwYWdlSWQ6IHBhZ2VJZCwKICAgIGVsZW1lbnQ6IG5ld0VsZW1lbnQKICB9KSk7IC8vIHJlZnJlc2ggYWxsIGVsZW1lbnRzIGlmIHRoZXJlJ3MgYSBmaWx0ZXIsIG90aGVyd2lzZSBqdXN0IHJlbmRlciB0aGUgbmV3IGVsZW1lbnQKCiAgaWYgKGVsZW1lbnQuZmlsdGVyKSB7CiAgICBkaXNwYXRjaChmZXRjaEFsbFJlbmRlcmFibGVzKCkpOwogIH0gZWxzZSB7CiAgICBkaXNwYXRjaChmZXRjaFJlbmRlcmFibGUobmV3RWxlbWVudCkpOwogIH0gLy8gc2VsZWN0IHRoZSBuZXcgZWxlbWVudAoKCiAgZGlzcGF0Y2goKDAsIF90cmFuc2llbnQuc2VsZWN0VG9wbGV2ZWxOb2RlcykoW25ld0VsZW1lbnQuaWRdKSk7Cn0pOwpleHBvcnRzLmFkZEVsZW1lbnQgPSBhZGRFbGVtZW50Ow=="},null]}