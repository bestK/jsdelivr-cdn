{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/ml/public/application/explorer/explorer_swimlane.js","dependencies":[{"path":"x-pack/legacy/plugins/ml/public/application/explorer/explorer_swimlane.js","mtime":1585205045692},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkV4cGxvcmVyU3dpbWxhbmUgPSB2b2lkIDA7Cgp2YXIgX3Byb3BUeXBlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicHJvcC10eXBlcyIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfZCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiZDMiKSk7Cgp2YXIgX21vbWVudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibW9tZW50IikpOwoKdmFyIF9kYXRlX3V0aWxzID0gcmVxdWlyZSgiLi4vdXRpbC9kYXRlX3V0aWxzIik7Cgp2YXIgX2NoYXJ0X3V0aWxzID0gcmVxdWlyZSgiLi4vdXRpbC9jaGFydF91dGlscyIpOwoKdmFyIF9hbm9tYWx5X3V0aWxzID0gcmVxdWlyZSgiLi4vLi4vLi4vY29tbW9uL3V0aWwvYW5vbWFseV91dGlscyIpOwoKdmFyIF9zdHJpbmdfdXRpbHMgPSByZXF1aXJlKCIuLi91dGlsL3N0cmluZ191dGlscyIpOwoKdmFyIF9jaGFydF90b29sdGlwX3NlcnZpY2UgPSByZXF1aXJlKCIuLi9jb21wb25lbnRzL2NoYXJ0X3Rvb2x0aXAvY2hhcnRfdG9vbHRpcF9zZXJ2aWNlIik7Cgp2YXIgX2V4cGxvcmVyX2Rhc2hib2FyZF9zZXJ2aWNlID0gcmVxdWlyZSgiLi9leHBsb3Jlcl9kYXNoYm9hcmRfc2VydmljZSIpOwoKdmFyIF9leHBsb3Jlcl9jb25zdGFudHMgPSByZXF1aXJlKCIuL2V4cGxvcmVyX2NvbnN0YW50cyIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9jbGFzcywgX3RlbXA7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBTQ1NTID0gewogIG1sRHJhZ3NlbGVjdERyYWdnaW5nOiAnbWxEcmFnc2VsZWN0RHJhZ2dpbmcnLAogIG1sSGlkZVJhbmdlU2VsZWN0aW9uOiAnbWxIaWRlUmFuZ2VTZWxlY3Rpb24nCn07CnZhciBFeHBsb3JlclN3aW1sYW5lID0gKDAsIF9yZWFjdDIuaW5qZWN0STE4bikoKF90ZW1wID0gX2NsYXNzID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1JlYWN0JENvbXBvbmVudCkgewogIF9pbmhlcml0cyhFeHBsb3JlclN3aW1sYW5lLCBfUmVhY3QkQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gRXhwbG9yZXJTd2ltbGFuZSgpIHsKICAgIHZhciBfZ2V0UHJvdG90eXBlT2YyOwoKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRXhwbG9yZXJTd2ltbGFuZSk7CgogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoX2dldFByb3RvdHlwZU9mMiA9IF9nZXRQcm90b3R5cGVPZihFeHBsb3JlclN3aW1sYW5lKSkuY2FsbC5hcHBseShfZ2V0UHJvdG90eXBlT2YyLCBbdGhpc10uY29uY2F0KGFyZ3MpKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiY2VsbE1vdXNlb3ZlckFjdGl2ZSIsIHRydWUpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRyYWdTZWxlY3RTdWJzY3JpYmVyIiwgbnVsbCk7CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEV4cGxvcmVyU3dpbWxhbmUsIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgLy8gcHJvcGVydHkgZm9yIGRhdGEgY29tcGFyaXNvbiB0byBiZSBhYmxlIHRvIGZpbHRlcgogICAgICAvLyBjb25zZWN1dGl2ZSBjbGljayBldmVudHMgd2l0aCB0aGUgc2FtZSBkYXRhLgogICAgICB2YXIgcHJldmlvdXNTZWxlY3RlZERhdGEgPSBudWxsOyAvLyBMaXN0ZW4gZm9yIGRyYWdTZWxlY3QgZXZlbnRzCgogICAgICB0aGlzLmRyYWdTZWxlY3RTdWJzY3JpYmVyID0gX2V4cGxvcmVyX2Rhc2hib2FyZF9zZXJ2aWNlLmRyYWdTZWxlY3QkLnN1YnNjcmliZShmdW5jdGlvbiAoX3JlZikgewogICAgICAgIHZhciBhY3Rpb24gPSBfcmVmLmFjdGlvbiwKICAgICAgICAgICAgX3JlZiRlbGVtZW50cyA9IF9yZWYuZWxlbWVudHMsCiAgICAgICAgICAgIGVsZW1lbnRzID0gX3JlZiRlbGVtZW50cyA9PT0gdm9pZCAwID8gW10gOiBfcmVmJGVsZW1lbnRzOwoKICAgICAgICB2YXIgZWxlbWVudCA9IF9kLmRlZmF1bHQuc2VsZWN0KF90aGlzMi5yb290Tm9kZS5wYXJlbnROb2RlKTsKCiAgICAgICAgdmFyIHN3aW1sYW5lVHlwZSA9IF90aGlzMi5wcm9wcy5zd2ltbGFuZVR5cGU7CgogICAgICAgIGlmIChhY3Rpb24gPT09IF9leHBsb3Jlcl9jb25zdGFudHMuRFJBR19TRUxFQ1RfQUNUSU9OLk5FV19TRUxFQ1RJT04gJiYgZWxlbWVudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgZWxlbWVudC5jbGFzc2VkKFNDU1MubWxEcmFnc2VsZWN0RHJhZ2dpbmcsIGZhbHNlKTsKCiAgICAgICAgICB2YXIgZmlyc3RTZWxlY3RlZENlbGwgPSBfZC5kZWZhdWx0LnNlbGVjdChlbGVtZW50c1swXSkubm9kZSgpLl9fY2xpY2tEYXRhX187CgogICAgICAgICAgaWYgKHR5cGVvZiBmaXJzdFNlbGVjdGVkQ2VsbCAhPT0gJ3VuZGVmaW5lZCcgJiYgc3dpbWxhbmVUeXBlID09PSBmaXJzdFNlbGVjdGVkQ2VsbC5zd2ltbGFuZVR5cGUpIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkRGF0YSA9IGVsZW1lbnRzLnJlZHVjZShmdW5jdGlvbiAoZCwgZSkgewogICAgICAgICAgICAgIHZhciBjZWxsID0gX2QuZGVmYXVsdC5zZWxlY3QoZSkubm9kZSgpLl9fY2xpY2tEYXRhX187CgogICAgICAgICAgICAgIGQuYnVja2V0U2NvcmUgPSBNYXRoLm1heChkLmJ1Y2tldFNjb3JlLCBjZWxsLmJ1Y2tldFNjb3JlKTsKICAgICAgICAgICAgICBkLmxhbmVMYWJlbHMucHVzaChjZWxsLmxhbmVMYWJlbCk7CiAgICAgICAgICAgICAgZC50aW1lcy5wdXNoKGNlbGwudGltZSk7CiAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBidWNrZXRTY29yZTogMCwKICAgICAgICAgICAgICBsYW5lTGFiZWxzOiBbXSwKICAgICAgICAgICAgICB0aW1lczogW10KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGVjdGVkRGF0YS5sYW5lTGFiZWxzID0gX2xvZGFzaC5kZWZhdWx0LnVuaXEoc2VsZWN0ZWREYXRhLmxhbmVMYWJlbHMpOwogICAgICAgICAgICBzZWxlY3RlZERhdGEudGltZXMgPSBfbG9kYXNoLmRlZmF1bHQudW5pcShzZWxlY3RlZERhdGEudGltZXMpOwoKICAgICAgICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHNlbGVjdGVkRGF0YSwgcHJldmlvdXNTZWxlY3RlZERhdGEpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIC8vIElmIG5vIGNlbGxzIGNvbnRhaW5pbmcgYW5vbWFsaWVzIGhhdmUgYmVlbiBzZWxlY3RlZCwKICAgICAgICAgICAgICAvLyBpbW1lZGlhdGVseSBjbGVhciB0aGUgc2VsZWN0aW9uLCBvdGhlcndpc2UgdHJpZ2dlcgogICAgICAgICAgICAgIC8vIGEgcmVsb2FkIHdpdGggdGhlIHVwZGF0ZWQgc2VsZWN0ZWQgY2VsbHMuCiAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkRGF0YS5idWNrZXRTY29yZSA9PT0gMCkgewogICAgICAgICAgICAgICAgZWxlbWVudHMubWFwKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfZC5kZWZhdWx0LnNlbGVjdChlKS5jbGFzc2VkKCdkcy1zZWxlY3RlZCcsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIF90aGlzMi5zZWxlY3RDZWxsKFtdLCBzZWxlY3RlZERhdGEpOwoKICAgICAgICAgICAgICAgIHByZXZpb3VzU2VsZWN0ZWREYXRhID0gbnVsbDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXMyLnNlbGVjdENlbGwoZWxlbWVudHMsIHNlbGVjdGVkRGF0YSk7CgogICAgICAgICAgICAgICAgcHJldmlvdXNTZWxlY3RlZERhdGEgPSBzZWxlY3RlZERhdGE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyLmNlbGxNb3VzZW92ZXJBY3RpdmUgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSBfZXhwbG9yZXJfY29uc3RhbnRzLkRSQUdfU0VMRUNUX0FDVElPTi5FTEVNRU5UX1NFTEVDVCkgewogICAgICAgICAgZWxlbWVudC5jbGFzc2VkKFNDU1MubWxEcmFnc2VsZWN0RHJhZ2dpbmcsIHRydWUpOwogICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSBfZXhwbG9yZXJfY29uc3RhbnRzLkRSQUdfU0VMRUNUX0FDVElPTi5EUkFHX1NUQVJUKSB7CiAgICAgICAgICBwcmV2aW91c1NlbGVjdGVkRGF0YSA9IG51bGw7CiAgICAgICAgICBfdGhpczIuY2VsbE1vdXNlb3ZlckFjdGl2ZSA9IGZhbHNlOwoKICAgICAgICAgIF9jaGFydF90b29sdGlwX3NlcnZpY2UubWxDaGFydFRvb2x0aXBTZXJ2aWNlLmhpZGUodHJ1ZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5yZW5kZXJTd2ltbGFuZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudERpZFVwZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkVXBkYXRlKCkgewogICAgICB0aGlzLnJlbmRlclN3aW1sYW5lKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFVubW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkgewogICAgICBpZiAodGhpcy5kcmFnU2VsZWN0U3Vic2NyaWJlciAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuZHJhZ1NlbGVjdFN1YnNjcmliZXIudW5zdWJzY3JpYmUoKTsKICAgICAgfQoKICAgICAgdmFyIGVsZW1lbnQgPSBfZC5kZWZhdWx0LnNlbGVjdCh0aGlzLnJvb3ROb2RlKTsKCiAgICAgIGVsZW1lbnQuaHRtbCgnJyk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2VsZWN0Q2VsbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VsZWN0Q2VsbChjZWxsc1RvU2VsZWN0LCBfcmVmMikgewogICAgICB2YXIgbGFuZUxhYmVscyA9IF9yZWYyLmxhbmVMYWJlbHMsCiAgICAgICAgICBidWNrZXRTY29yZSA9IF9yZWYyLmJ1Y2tldFNjb3JlLAogICAgICAgICAgdGltZXMgPSBfcmVmMi50aW1lczsKICAgICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgIHNlbGVjdGlvbiA9IF90aGlzJHByb3BzLnNlbGVjdGlvbiwKICAgICAgICAgIHN3aW1sYW5lQ2VsbENsaWNrID0gX3RoaXMkcHJvcHMuc3dpbWxhbmVDZWxsQ2xpY2ssCiAgICAgICAgICBzd2ltbGFuZURhdGEgPSBfdGhpcyRwcm9wcy5zd2ltbGFuZURhdGEsCiAgICAgICAgICBzd2ltbGFuZVR5cGUgPSBfdGhpcyRwcm9wcy5zd2ltbGFuZVR5cGU7CiAgICAgIHZhciB0cmlnZ2VyTmV3U2VsZWN0aW9uID0gZmFsc2U7CgogICAgICBpZiAoY2VsbHNUb1NlbGVjdC5sZW5ndGggPiAxIHx8IGJ1Y2tldFNjb3JlID4gMCkgewogICAgICAgIHRyaWdnZXJOZXdTZWxlY3Rpb24gPSB0cnVlOwogICAgICB9IC8vIENoZWNrIGlmIHRoZSBzYW1lIGNlbGxzIHdlcmUgc2VsZWN0ZWQgYWdhaW4sIGlmIHNvIGNsZWFyIHRoZSBzZWxlY3Rpb24sCiAgICAgIC8vIG90aGVyd2lzZSBhY3RpdmF0ZSB0aGUgbmV3IHNlbGVjdGlvbi4gVGhlIHR3byBvYmplY3RzIGFyZSBidWlsdCBmb3IKICAgICAgLy8gY29tcGFyaXNvbiBiZWNhdXNlIHdlIGNhbm5vdCBzaW1wbHkgY29tcGFyZSB0byAiYXBwU3RhdGUubWxFeHBsb3JlclN3aW1sYW5lIgogICAgICAvLyBzaW5jZSBpdCBhbHNvIGluY2x1ZGVzIHRoZSAidmlld0J5IiBhdHRyaWJ1dGUgd2hpY2ggbWlnaHQgZGlmZmVyIGRlcGVuZGluZwogICAgICAvLyBvbiB3aGV0aGVyIHRoZSBvdmVyYWxsIG9yIHZpZXdieSBzd2ltbGFuZSB3YXMgc2VsZWN0ZWQuCgoKICAgICAgdmFyIG9sZFNlbGVjdGlvbiA9IHsKICAgICAgICBzZWxlY3RlZFR5cGU6IHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24udHlwZSwKICAgICAgICBzZWxlY3RlZExhbmVzOiBzZWxlY3Rpb24gJiYgc2VsZWN0aW9uLmxhbmVzLAogICAgICAgIHNlbGVjdGVkVGltZXM6IHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24udGltZXMKICAgICAgfTsKICAgICAgdmFyIG5ld1NlbGVjdGlvbiA9IHsKICAgICAgICBzZWxlY3RlZFR5cGU6IHN3aW1sYW5lVHlwZSwKICAgICAgICBzZWxlY3RlZExhbmVzOiBsYW5lTGFiZWxzLAogICAgICAgIHNlbGVjdGVkVGltZXM6IF9kLmRlZmF1bHQuZXh0ZW50KHRpbWVzKQogICAgICB9OwoKICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKG9sZFNlbGVjdGlvbiwgbmV3U2VsZWN0aW9uKSkgewogICAgICAgIHRyaWdnZXJOZXdTZWxlY3Rpb24gPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHRyaWdnZXJOZXdTZWxlY3Rpb24gPT09IGZhbHNlKSB7CiAgICAgICAgc3dpbWxhbmVDZWxsQ2xpY2soe30pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHNlbGVjdGVkQ2VsbHMgPSB7CiAgICAgICAgdmlld0J5RmllbGROYW1lOiBzd2ltbGFuZURhdGEuZmllbGROYW1lLAogICAgICAgIGxhbmVzOiBsYW5lTGFiZWxzLAogICAgICAgIHRpbWVzOiBfZC5kZWZhdWx0LmV4dGVudCh0aW1lcyksCiAgICAgICAgdHlwZTogc3dpbWxhbmVUeXBlCiAgICAgIH07CiAgICAgIHN3aW1sYW5lQ2VsbENsaWNrKHNlbGVjdGVkQ2VsbHMpOwogICAgfQogIH0sIHsKICAgIGtleTogImhpZ2hsaWdodE92ZXJhbGwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhpZ2hsaWdodE92ZXJhbGwodGltZXMpIHsKICAgICAgdmFyIG92ZXJhbGxTd2ltbGFuZSA9IF9kLmRlZmF1bHQuc2VsZWN0KCcubWwtc3dpbWxhbmUtb3ZlcmFsbCcpOwoKICAgICAgdGltZXMuZm9yRWFjaChmdW5jdGlvbiAodGltZSkgewogICAgICAgIHZhciBvdmVyYWxsQ2VsbCA9IG92ZXJhbGxTd2ltbGFuZS5zZWxlY3RBbGwoImRpdltkYXRhLXRpbWU9XCIiLmNvbmNhdCh0aW1lLCAiXCJdIikpLnNlbGVjdEFsbCgnLnNsLWNlbGwtaW5uZXIsLnNsLWNlbGwtaW5uZXItZHJhZ3NlbGVjdCcpOwogICAgICAgIG92ZXJhbGxDZWxsLmNsYXNzZWQoJ3NsLWNlbGwtaW5uZXItc2VsZWN0ZWQnLCB0cnVlKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGlnaGxpZ2h0U2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoaWdobGlnaHRTZWxlY3Rpb24oY2VsbHNUb1NlbGVjdCwgbGFuZUxhYmVscywgdGltZXMpIHsKICAgICAgdmFyIHN3aW1sYW5lVHlwZSA9IHRoaXMucHJvcHMuc3dpbWxhbmVUeXBlOyAvLyBUaGlzIHNlbGVjdHMgYm90aCBvdmVyYWxsIGFuZCB2aWV3Ynkgc3dpbWxhbmUKCiAgICAgIHZhciB3cmFwcGVyID0gX2QuZGVmYXVsdC5zZWxlY3RBbGwoJy5tbC1leHBsb3Jlci1zd2ltbGFuZScpOwoKICAgICAgd3JhcHBlci5zZWxlY3RBbGwoJy5sYW5lLWxhYmVsJykuY2xhc3NlZCgnbGFuZS1sYWJlbC1tYXNrZWQnLCB0cnVlKTsKICAgICAgd3JhcHBlci5zZWxlY3RBbGwoJy5zbC1jZWxsLWlubmVyLC5zbC1jZWxsLWlubmVyLWRyYWdzZWxlY3QnKS5jbGFzc2VkKCdzbC1jZWxsLWlubmVyLW1hc2tlZCcsIHRydWUpOwogICAgICB3cmFwcGVyLnNlbGVjdEFsbCgnLnNsLWNlbGwtaW5uZXIuc2wtY2VsbC1pbm5lci1zZWxlY3RlZCwuc2wtY2VsbC1pbm5lci1kcmFnc2VsZWN0LnNsLWNlbGwtaW5uZXItc2VsZWN0ZWQnKS5jbGFzc2VkKCdzbC1jZWxsLWlubmVyLXNlbGVjdGVkJywgZmFsc2UpOwoKICAgICAgX2QuZGVmYXVsdC5zZWxlY3RBbGwoY2VsbHNUb1NlbGVjdCkuc2VsZWN0QWxsKCcuc2wtY2VsbC1pbm5lciwuc2wtY2VsbC1pbm5lci1kcmFnc2VsZWN0JykuY2xhc3NlZCgnc2wtY2VsbC1pbm5lci1tYXNrZWQnLCBmYWxzZSkuY2xhc3NlZCgnc2wtY2VsbC1pbm5lci1zZWxlY3RlZCcsIHRydWUpOwoKICAgICAgdmFyIHJvb3RQYXJlbnQgPSBfZC5kZWZhdWx0LnNlbGVjdCh0aGlzLnJvb3ROb2RlLnBhcmVudE5vZGUpOwoKICAgICAgcm9vdFBhcmVudC5zZWxlY3RBbGwoJy5sYW5lLWxhYmVsJykuY2xhc3NlZCgnbGFuZS1sYWJlbC1tYXNrZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGxhbmVMYWJlbHMuaW5kZXhPZihfZC5kZWZhdWx0LnNlbGVjdCh0aGlzKS50ZXh0KCkpID09PSAtMTsKICAgICAgfSk7CgogICAgICBpZiAoc3dpbWxhbmVUeXBlID09PSAndmlld0J5JykgewogICAgICAgIC8vIElmIHNlbGVjdGluZyBhIGNlbGwgaW4gdGhlICd2aWV3IGJ5JyBzd2ltbGFuZSwgaW5kaWNhdGUgdGhlIGNvcnJlc3BvbmRpbmcgdGltZSBpbiB0aGUgT3ZlcmFsbCBzd2ltbGFuZS4KICAgICAgICB0aGlzLmhpZ2hsaWdodE92ZXJhbGwodGltZXMpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAibWFza0lycmVsZXZhbnRTd2ltbGFuZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1hc2tJcnJlbGV2YW50U3dpbWxhbmVzKG1hc2tBbGwpIHsKICAgICAgaWYgKG1hc2tBbGwgPT09IHRydWUpIHsKICAgICAgICAvLyBUaGlzIHNlbGVjdHMgYm90aCBvdmVyYWxsIGFuZCB2aWV3Ynkgc3dpbWxhbmUKICAgICAgICB2YXIgYWxsU3dpbWxhbmVzID0gX2QuZGVmYXVsdC5zZWxlY3RBbGwoJy5tbC1leHBsb3Jlci1zd2ltbGFuZScpOwoKICAgICAgICBhbGxTd2ltbGFuZXMuc2VsZWN0QWxsKCcubGFuZS1sYWJlbCcpLmNsYXNzZWQoJ2xhbmUtbGFiZWwtbWFza2VkJywgdHJ1ZSk7CiAgICAgICAgYWxsU3dpbWxhbmVzLnNlbGVjdEFsbCgnLnNsLWNlbGwtaW5uZXIsLnNsLWNlbGwtaW5uZXItZHJhZ3NlbGVjdCcpLmNsYXNzZWQoJ3NsLWNlbGwtaW5uZXItbWFza2VkJywgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIG92ZXJhbGxTd2ltbGFuZSA9IF9kLmRlZmF1bHQuc2VsZWN0KCcubWwtc3dpbWxhbmUtb3ZlcmFsbCcpOwoKICAgICAgICBvdmVyYWxsU3dpbWxhbmUuc2VsZWN0QWxsKCcubGFuZS1sYWJlbCcpLmNsYXNzZWQoJ2xhbmUtbGFiZWwtbWFza2VkJywgdHJ1ZSk7CiAgICAgICAgb3ZlcmFsbFN3aW1sYW5lLnNlbGVjdEFsbCgnLnNsLWNlbGwtaW5uZXIsLnNsLWNlbGwtaW5uZXItZHJhZ3NlbGVjdCcpLmNsYXNzZWQoJ3NsLWNlbGwtaW5uZXItbWFza2VkJywgdHJ1ZSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjbGVhclNlbGVjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXJTZWxlY3Rpb24oKSB7CiAgICAgIC8vIFRoaXMgc2VsZWN0cyBib3RoIG92ZXJhbGwgYW5kIHZpZXdieSBzd2ltbGFuZQogICAgICB2YXIgd3JhcHBlciA9IF9kLmRlZmF1bHQuc2VsZWN0QWxsKCcubWwtZXhwbG9yZXItc3dpbWxhbmUnKTsKCiAgICAgIHdyYXBwZXIuc2VsZWN0QWxsKCcubGFuZS1sYWJlbCcpLmNsYXNzZWQoJ2xhbmUtbGFiZWwtbWFza2VkJywgZmFsc2UpOwogICAgICB3cmFwcGVyLnNlbGVjdEFsbCgnLnNsLWNlbGwtaW5uZXInKS5jbGFzc2VkKCdzbC1jZWxsLWlubmVyLW1hc2tlZCcsIGZhbHNlKTsKICAgICAgd3JhcHBlci5zZWxlY3RBbGwoJy5zbC1jZWxsLWlubmVyLnNsLWNlbGwtaW5uZXItc2VsZWN0ZWQnKS5jbGFzc2VkKCdzbC1jZWxsLWlubmVyLXNlbGVjdGVkJywgZmFsc2UpOwogICAgICB3cmFwcGVyLnNlbGVjdEFsbCgnLnNsLWNlbGwtaW5uZXItZHJhZ3NlbGVjdC5zbC1jZWxsLWlubmVyLXNlbGVjdGVkJykuY2xhc3NlZCgnc2wtY2VsbC1pbm5lci1zZWxlY3RlZCcsIGZhbHNlKTsKICAgICAgd3JhcHBlci5zZWxlY3RBbGwoJy5kcy1zZWxlY3RlZCcpLmNsYXNzZWQoJ3NsLWNlbGwtaW5uZXItc2VsZWN0ZWQnLCBmYWxzZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyU3dpbWxhbmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclN3aW1sYW5lKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBlbGVtZW50ID0gX2QuZGVmYXVsdC5zZWxlY3QodGhpcy5yb290Tm9kZS5wYXJlbnROb2RlKTsgLy8gQ29uc2lkZXIgdGhlIHNldHRpbmcgdG8gc3VwcG9ydCB0byBzZWxlY3QgYSByYW5nZSBvZiBjZWxscwoKCiAgICAgIGlmICghX2V4cGxvcmVyX2Rhc2hib2FyZF9zZXJ2aWNlLkFMTE9XX0NFTExfUkFOR0VfU0VMRUNUSU9OKSB7CiAgICAgICAgZWxlbWVudC5jbGFzc2VkKFNDU1MubWxIaWRlUmFuZ2VTZWxlY3Rpb24sIHRydWUpOwogICAgICB9IC8vIFRoaXMgZ2V0dGVyIGFsbG93cyB1cyB0byBmZXRjaCB0aGUgY3VycmVudCB2YWx1ZSBpbiBgY2VsbE1vdXNlb3ZlcigpYC4KICAgICAgLy8gT3RoZXJ3aXNlIGl0IHdpbGwganVzdCByZWZlciB0byB0aGUgdmFsdWUgd2hlbiBgY2VsbE1vdXNlb3ZlcigpYCB3YXMgaW5zdGFudGlhdGVkLgoKCiAgICAgIHZhciBnZXRDZWxsTW91c2VvdmVyQWN0aXZlID0gZnVuY3Rpb24gZ2V0Q2VsbE1vdXNlb3ZlckFjdGl2ZSgpIHsKICAgICAgICByZXR1cm4gX3RoaXMzLmNlbGxNb3VzZW92ZXJBY3RpdmU7CiAgICAgIH07CgogICAgICB2YXIgX3RoaXMkcHJvcHMyID0gdGhpcy5wcm9wcywKICAgICAgICAgIGNoYXJ0V2lkdGggPSBfdGhpcyRwcm9wczIuY2hhcnRXaWR0aCwKICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IF90aGlzJHByb3BzMi5maWx0ZXJBY3RpdmUsCiAgICAgICAgICBtYXNrQWxsID0gX3RoaXMkcHJvcHMyLm1hc2tBbGwsCiAgICAgICAgICBUaW1lQnVja2V0cyA9IF90aGlzJHByb3BzMi5UaW1lQnVja2V0cywKICAgICAgICAgIHN3aW1sYW5lQ2VsbENsaWNrID0gX3RoaXMkcHJvcHMyLnN3aW1sYW5lQ2VsbENsaWNrLAogICAgICAgICAgc3dpbWxhbmVEYXRhID0gX3RoaXMkcHJvcHMyLnN3aW1sYW5lRGF0YSwKICAgICAgICAgIHN3aW1sYW5lVHlwZSA9IF90aGlzJHByb3BzMi5zd2ltbGFuZVR5cGUsCiAgICAgICAgICBzZWxlY3Rpb24gPSBfdGhpcyRwcm9wczIuc2VsZWN0aW9uLAogICAgICAgICAgaW50bCA9IF90aGlzJHByb3BzMi5pbnRsOwogICAgICB2YXIgbGFuZXMgPSBzd2ltbGFuZURhdGEubGFuZUxhYmVscywKICAgICAgICAgIHN0YXJ0VGltZSA9IHN3aW1sYW5lRGF0YS5lYXJsaWVzdCwKICAgICAgICAgIGVuZFRpbWUgPSBzd2ltbGFuZURhdGEubGF0ZXN0LAogICAgICAgICAgc3RlcFNlY3MgPSBzd2ltbGFuZURhdGEuaW50ZXJ2YWwsCiAgICAgICAgICBwb2ludHMgPSBzd2ltbGFuZURhdGEucG9pbnRzOwoKICAgICAgZnVuY3Rpb24gY29sb3JTY29yZSh2YWx1ZSkgewogICAgICAgIHJldHVybiAoMCwgX2Fub21hbHlfdXRpbHMuZ2V0U2V2ZXJpdHlDb2xvcikodmFsdWUpOwogICAgICB9CgogICAgICB2YXIgbnVtQnVja2V0cyA9IHBhcnNlSW50KChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvIHN0ZXBTZWNzKTsKICAgICAgdmFyIGNlbGxIZWlnaHQgPSAzMDsKICAgICAgdmFyIGhlaWdodCA9IChsYW5lcy5sZW5ndGggKyAxKSAqIGNlbGxIZWlnaHQgLSAxMDsKICAgICAgdmFyIGxhbmVMYWJlbFdpZHRoID0gMTcwOwogICAgICBlbGVtZW50LnN0eWxlKCdoZWlnaHQnLCAiIi5jb25jYXQoaGVpZ2h0ICsgMjAsICJweCIpKTsKICAgICAgdmFyIHN3aW1sYW5lcyA9IGVsZW1lbnQuc2VsZWN0KCcubWwtc3dpbWxhbmVzJyk7CiAgICAgIHN3aW1sYW5lcy5odG1sKCcnKTsKICAgICAgdmFyIGNlbGxXaWR0aCA9IE1hdGguZmxvb3IoY2hhcnRXaWR0aCAvIG51bUJ1Y2tldHMgKiAxMDApIC8gMTAwOwogICAgICB2YXIgeEF4aXNXaWR0aCA9IGNlbGxXaWR0aCAqIG51bUJ1Y2tldHM7CgogICAgICB2YXIgeEF4aXNTY2FsZSA9IF9kLmRlZmF1bHQudGltZS5zY2FsZSgpLmRvbWFpbihbbmV3IERhdGUoc3RhcnRUaW1lICogMTAwMCksIG5ldyBEYXRlKGVuZFRpbWUgKiAxMDAwKV0pLnJhbmdlKFswLCB4QXhpc1dpZHRoXSk7IC8vIEdldCB0aGUgc2NhbGVkIGRhdGUgZm9ybWF0IHRvIHVzZSBmb3IgeCBheGlzIHRpY2sgbGFiZWxzLgoKCiAgICAgIHZhciB0aW1lQnVja2V0cyA9IG5ldyBUaW1lQnVja2V0cygpOwogICAgICB0aW1lQnVja2V0cy5zZXRJbnRlcnZhbCgiIi5jb25jYXQoc3RlcFNlY3MsICJzIikpOwogICAgICB2YXIgeEF4aXNUaWNrRm9ybWF0ID0gdGltZUJ1Y2tldHMuZ2V0U2NhbGVkRGF0ZUZvcm1hdCgpOwoKICAgICAgZnVuY3Rpb24gY2VsbE1vdXNlT3ZlckZhY3RvcnkodGltZSwgaSkgewogICAgICAgIC8vIERvbid0IHVzZSBhbiBhcnJvdyBmdW5jdGlvbiBoZXJlIGJlY2F1c2Ugd2UgbmVlZCBhY2Nlc3MgdG8gYHRoaXNgLAogICAgICAgIC8vIHdoaWNoIGlzIHdoZXJlIGQzIHN1cHBsaWVzIGEgcmVmZXJlbmNlIHRvIHRoZSBjb3JyZXNwb25kaW5nIERPTSBlbGVtZW50LgogICAgICAgIHJldHVybiBmdW5jdGlvbiAobGFuZSkgewogICAgICAgICAgdmFyIGJ1Y2tldFNjb3JlID0gZ2V0QnVja2V0U2NvcmUobGFuZSwgdGltZSk7CgogICAgICAgICAgaWYgKGJ1Y2tldFNjb3JlICE9PSAwKSB7CiAgICAgICAgICAgIGNlbGxNb3VzZW92ZXIodGhpcywgbGFuZSwgYnVja2V0U2NvcmUsIGksIHRpbWUpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNlbGxNb3VzZW92ZXIodGFyZ2V0LCBsYW5lTGFiZWwsIGJ1Y2tldFNjb3JlLCBpbmRleCwgdGltZSkgewogICAgICAgIGlmIChidWNrZXRTY29yZSA9PT0gdW5kZWZpbmVkIHx8IGdldENlbGxNb3VzZW92ZXJBY3RpdmUoKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBkaXNwbGF5U2NvcmUgPSBidWNrZXRTY29yZSA+IDEgPyBwYXJzZUludChidWNrZXRTY29yZSkgOiAnPCAxJzsgLy8gRGlzcGxheSBkYXRlIHVzaW5nIHNhbWUgZm9ybWF0IGFzIEtpYmFuYSB2aXN1YWxpemF0aW9ucy4KCiAgICAgICAgdmFyIGZvcm1hdHRlZERhdGUgPSAoMCwgX2RhdGVfdXRpbHMuZm9ybWF0SHVtYW5SZWFkYWJsZURhdGVUaW1lKSh0aW1lICogMTAwMCk7CiAgICAgICAgdmFyIHRvb2x0aXBEYXRhID0gW3sKICAgICAgICAgIG5hbWU6IGZvcm1hdHRlZERhdGUKICAgICAgICB9XTsKCiAgICAgICAgaWYgKHN3aW1sYW5lRGF0YS5maWVsZE5hbWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdG9vbHRpcERhdGEucHVzaCh7CiAgICAgICAgICAgIG5hbWU6IHN3aW1sYW5lRGF0YS5maWVsZE5hbWUsCiAgICAgICAgICAgIHZhbHVlOiBsYW5lTGFiZWwsCiAgICAgICAgICAgIHNlcmllc0tleTogbGFuZUxhYmVsLAogICAgICAgICAgICB5QWNjZXNzb3I6ICdmaWVsZE5hbWUnCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRvb2x0aXBEYXRhLnB1c2goewogICAgICAgICAgbmFtZTogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgaWQ6ICd4cGFjay5tbC5leHBsb3Jlci5zd2ltbGFuZS5tYXhBbm9tYWx5U2NvcmVMYWJlbCcsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTWF4IGFub21hbHkgc2NvcmUnCiAgICAgICAgICB9KSwKICAgICAgICAgIHZhbHVlOiBkaXNwbGF5U2NvcmUsCiAgICAgICAgICBjb2xvcjogY29sb3JTY29yZShkaXNwbGF5U2NvcmUpLAogICAgICAgICAgc2VyaWVzS2V5OiBsYW5lTGFiZWwsCiAgICAgICAgICB5QWNjZXNzb3I6ICdhbm9tYWx5X3Njb3JlJwogICAgICAgIH0pOwogICAgICAgIHZhciBvZmZzZXRzID0gdGFyZ2V0LmNsYXNzTmFtZSA9PT0gJ3NsLWNlbGwtaW5uZXInID8gewogICAgICAgICAgeDogNiwKICAgICAgICAgIHk6IDAKICAgICAgICB9IDogewogICAgICAgICAgeDogOCwKICAgICAgICAgIHk6IDEKICAgICAgICB9OwoKICAgICAgICBfY2hhcnRfdG9vbHRpcF9zZXJ2aWNlLm1sQ2hhcnRUb29sdGlwU2VydmljZS5zaG93KHRvb2x0aXBEYXRhLCB0YXJnZXQsIHsKICAgICAgICAgIHg6IHRhcmdldC5vZmZzZXRXaWR0aCArIG9mZnNldHMueCwKICAgICAgICAgIHk6IDYgKyBvZmZzZXRzLnkKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY2VsbE1vdXNlbGVhdmUoKSB7CiAgICAgICAgX2NoYXJ0X3Rvb2x0aXBfc2VydmljZS5tbENoYXJ0VG9vbHRpcFNlcnZpY2UuaGlkZSgpOwogICAgICB9CgogICAgICB2YXIgZDNMYW5lcyA9IHN3aW1sYW5lcy5zZWxlY3RBbGwoJy5sYW5lJykuZGF0YShsYW5lcyk7CiAgICAgIHZhciBkM0xhbmVzRW50ZXIgPSBkM0xhbmVzLmVudGVyKCkuYXBwZW5kKCdkaXYnKS5jbGFzc2VkKCdsYW5lJywgdHJ1ZSk7CiAgICAgIGQzTGFuZXNFbnRlci5hcHBlbmQoJ2RpdicpLmNsYXNzZWQoJ2xhbmUtbGFiZWwnLCB0cnVlKS5zdHlsZSgnd2lkdGgnLCAiIi5jb25jYXQobGFuZUxhYmVsV2lkdGgsICJweCIpKS5odG1sKGZ1bmN0aW9uIChsYWJlbCkgewogICAgICAgIHZhciBzaG93RmlsdGVyQ29udGV4dCA9IGZpbHRlckFjdGl2ZSA9PT0gdHJ1ZSAmJiBsYWJlbCA9PT0gJ092ZXJhbGwnOwoKICAgICAgICBpZiAoc2hvd0ZpbHRlckNvbnRleHQpIHsKICAgICAgICAgIHJldHVybiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWwuZXhwbG9yZXIub3ZlcmFsbFN3aW1sYW5lVW5maWx0ZXJlZExhYmVsJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ3tsYWJlbH0gKHVuZmlsdGVyZWQpJywKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgbGFiZWw6ICgwLCBfc3RyaW5nX3V0aWxzLm1sRXNjYXBlKShsYWJlbCkKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAoMCwgX3N0cmluZ191dGlscy5tbEVzY2FwZSkobGFiZWwpOwogICAgICAgIH0KICAgICAgfSkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChzZWxlY3Rpb24gJiYgdHlwZW9mIHNlbGVjdGlvbi5sYW5lcyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHN3aW1sYW5lQ2VsbENsaWNrKHt9KTsKICAgICAgICB9CiAgICAgIH0pLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICBpZiAoc3dpbWxhbmVEYXRhLmZpZWxkTmFtZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBfZC5kZWZhdWx0LnNlbGVjdCh0aGlzKS5vbignbW91c2VvdmVyJywgZnVuY3Rpb24gKGxhYmVsKSB7CiAgICAgICAgICAgIF9jaGFydF90b29sdGlwX3NlcnZpY2UubWxDaGFydFRvb2x0aXBTZXJ2aWNlLnNob3coW3sKICAgICAgICAgICAgICBza2lwSGVhZGVyOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBuYW1lOiBzd2ltbGFuZURhdGEuZmllbGROYW1lLAogICAgICAgICAgICAgIHZhbHVlOiBsYWJlbAogICAgICAgICAgICB9XSwgX3RoaXM0LCB7CiAgICAgICAgICAgICAgeDogbGFuZUxhYmVsV2lkdGgsCiAgICAgICAgICAgICAgeTogMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX2NoYXJ0X3Rvb2x0aXBfc2VydmljZS5tbENoYXJ0VG9vbHRpcFNlcnZpY2UuaGlkZSgpOwogICAgICAgICAgfSkuYXR0cignYXJpYS1sYWJlbCcsIGZ1bmN0aW9uIChsYWJlbCkgewogICAgICAgICAgICByZXR1cm4gIiIuY29uY2F0KCgwLCBfc3RyaW5nX3V0aWxzLm1sRXNjYXBlKShzd2ltbGFuZURhdGEuZmllbGROYW1lKSwgIjogIikuY29uY2F0KCgwLCBfc3RyaW5nX3V0aWxzLm1sRXNjYXBlKShsYWJlbCkpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdmFyIGNlbGxzQ29udGFpbmVyID0gZDNMYW5lc0VudGVyLmFwcGVuZCgnZGl2JykuY2xhc3NlZCgnY2VsbHMtY29udGFpbmVyJywgdHJ1ZSk7CgogICAgICBmdW5jdGlvbiBnZXRCdWNrZXRTY29yZShsYW5lLCB0aW1lKSB7CiAgICAgICAgdmFyIGJ1Y2tldFNjb3JlID0gMDsKICAgICAgICB2YXIgcG9pbnQgPSBwb2ludHMuZmluZChmdW5jdGlvbiAocCkgewogICAgICAgICAgcmV0dXJuIHAudmFsdWUgPiAwICYmIHAubGFuZUxhYmVsID09PSBsYW5lICYmIHAudGltZSA9PT0gdGltZTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHR5cGVvZiBwb2ludCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIGJ1Y2tldFNjb3JlID0gcG9pbnQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYnVja2V0U2NvcmU7CiAgICAgIH0gLy8gVE9ETyAtIG1hcmsgaWYgem9vbWVkIGluIHRvIGJ1Y2tldCB3aWR0aD8KCgogICAgICB2YXIgdGltZSA9IHN0YXJ0VGltZTsKICAgICAgQXJyYXkobnVtQnVja2V0cyB8fCAwKS5maWxsKG51bGwpLmZvckVhY2goZnVuY3Rpb24gKHYsIGkpIHsKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzCiAgICAgICAgdmFyIGNlbGwgPSBjZWxsc0NvbnRhaW5lci5hcHBlbmQoJ2RpdicpLmNsYXNzZWQoJ3NsLWNlbGwnLCB0cnVlKS5zdHlsZSgnd2lkdGgnLCAiIi5jb25jYXQoY2VsbFdpZHRoLCAicHgiKSkuYXR0cignZGF0YS1sYW5lLWxhYmVsJywgZnVuY3Rpb24gKGxhYmVsKSB7CiAgICAgICAgICByZXR1cm4gKDAsIF9zdHJpbmdfdXRpbHMubWxFc2NhcGUpKGxhYmVsKTsKICAgICAgICB9KS5hdHRyKCdkYXRhLXRpbWUnLCB0aW1lKS5hdHRyKCdkYXRhLWJ1Y2tldC1zY29yZScsIGZ1bmN0aW9uIChsYW5lKSB7CiAgICAgICAgICByZXR1cm4gZ2V0QnVja2V0U2NvcmUobGFuZSwgdGltZSk7CiAgICAgICAgfSkgLy8gdXNlIGEgZmFjdG9yeSBoZXJlIHRvIGJpbmQgdGhlIGB0aW1lYCBhbmQgYGlgIHZhbHVlcwogICAgICAgIC8vIG9mIHRoaXMgaXRlcmF0aW9uIHRvIHRoZSBldmVudC4KICAgICAgICAub24oJ21vdXNlb3ZlcicsIGNlbGxNb3VzZU92ZXJGYWN0b3J5KHRpbWUsIGkpKS5vbignbW91c2VsZWF2ZScsIGNlbGxNb3VzZWxlYXZlKS5lYWNoKGZ1bmN0aW9uIChsYW5lTGFiZWwpIHsKICAgICAgICAgIHRoaXMuX19jbGlja0RhdGFfXyA9IHsKICAgICAgICAgICAgYnVja2V0U2NvcmU6IGdldEJ1Y2tldFNjb3JlKGxhbmVMYWJlbCwgdGltZSksCiAgICAgICAgICAgIGxhbmVMYWJlbDogbGFuZUxhYmVsLAogICAgICAgICAgICBzd2ltbGFuZVR5cGU6IHN3aW1sYW5lVHlwZSwKICAgICAgICAgICAgdGltZTogdGltZQogICAgICAgICAgfTsKICAgICAgICB9KTsgLy8gY2FsbHMgaXRzZWxmIHdpdGggZWFjaCgpIHRvIGdldCBhY2Nlc3MgdG8gbGFuZSAoPSBkMyBkYXRhKQoKICAgICAgICBjZWxsLmFwcGVuZCgnZGl2JykuZWFjaChmdW5jdGlvbiAobGFuZSkgewogICAgICAgICAgdmFyIGVsID0gX2QuZGVmYXVsdC5zZWxlY3QodGhpcyk7CgogICAgICAgICAgdmFyIGNvbG9yID0gJ25vbmUnOwogICAgICAgICAgdmFyIGJ1Y2tldFNjb3JlID0gMDsKICAgICAgICAgIHZhciBwb2ludCA9IHBvaW50cy5maW5kKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgIHJldHVybiBwLnZhbHVlID4gMCAmJiBwLmxhbmVMYWJlbCA9PT0gbGFuZSAmJiBwLnRpbWUgPT09IHRpbWU7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAodHlwZW9mIHBvaW50ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBidWNrZXRTY29yZSA9IHBvaW50LnZhbHVlOwogICAgICAgICAgICBjb2xvciA9IGNvbG9yU2NvcmUoYnVja2V0U2NvcmUpOwogICAgICAgICAgICBlbC5jbGFzc2VkKCdzbC1jZWxsLWlubmVyJywgdHJ1ZSkuc3R5bGUoJ2JhY2tncm91bmQtY29sb3InLCBjb2xvcik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbC5jbGFzc2VkKCdzbC1jZWxsLWlubmVyLWRyYWdzZWxlY3QnLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aW1lICs9IHN0ZXBTZWNzOwogICAgICB9KTsgLy8gWyd4LWF4aXMnXSBpcyBqdXN0IGEgcGxhY2Vob2xkZXIgc28gd2UgaGF2ZSBhbiBhcnJheSBvZiAxLgoKICAgICAgdmFyIGxhbmVUaW1lcyA9IHN3aW1sYW5lcy5zZWxlY3RBbGwoJy50aW1lLXRpY2stbGFiZWxzJykuZGF0YShbJ3gtYXhpcyddKS5lbnRlcigpLmFwcGVuZCgnZGl2JykuY2xhc3NlZCgndGltZS10aWNrLWxhYmVscycsIHRydWUpOyAvLyBoZWlnaHQgb2YgLnRpbWUtdGljay1sYWJlbHMKCiAgICAgIHZhciBzdmdIZWlnaHQgPSAyNTsKICAgICAgdmFyIHN2ZyA9IGxhbmVUaW1lcy5hcHBlbmQoJ3N2ZycpLmF0dHIoJ3dpZHRoJywgY2hhcnRXaWR0aCkuYXR0cignaGVpZ2h0Jywgc3ZnSGVpZ2h0KTsKCiAgICAgIHZhciB4QXhpcyA9IF9kLmRlZmF1bHQuc3ZnLmF4aXMoKS5zY2FsZSh4QXhpc1NjYWxlKS50aWNrcygoMCwgX2NoYXJ0X3V0aWxzLm51bVRpY2tzRm9yRGF0ZUZvcm1hdCkoY2hhcnRXaWR0aCwgeEF4aXNUaWNrRm9ybWF0KSkudGlja0Zvcm1hdChmdW5jdGlvbiAodGljaykgewogICAgICAgIHJldHVybiAoMCwgX21vbWVudC5kZWZhdWx0KSh0aWNrKS5mb3JtYXQoeEF4aXNUaWNrRm9ybWF0KTsKICAgICAgfSk7CgogICAgICB2YXIgZ0F4aXMgPSBzdmcuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAneCBheGlzJykuY2FsbCh4QXhpcyk7IC8vIHJlbW92ZSBvdmVybGFwcGluZyBsYWJlbHMKCiAgICAgIHZhciBvdmVybGFwQ2hlY2sgPSAwOwogICAgICBnQXhpcy5zZWxlY3RBbGwoJ2cudGljaycpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0aWNrID0gX2QuZGVmYXVsdC5zZWxlY3QodGhpcyk7CgogICAgICAgIHZhciB4VHJhbnNmb3JtID0gX2QuZGVmYXVsdC50cmFuc2Zvcm0odGljay5hdHRyKCd0cmFuc2Zvcm0nKSkudHJhbnNsYXRlWzBdOwoKICAgICAgICB2YXIgdGlja1dpZHRoID0gdGljay5zZWxlY3QoJ3RleHQnKS5ub2RlKCkuZ2V0QkJveCgpLndpZHRoOwogICAgICAgIHZhciB4TWluT2Zmc2V0ID0geFRyYW5zZm9ybSAtIHRpY2tXaWR0aCAvIDI7CiAgICAgICAgdmFyIHhNYXhPZmZzZXQgPSB4VHJhbnNmb3JtICsgdGlja1dpZHRoIC8gMjsgLy8gaWYgdGhlIHRpY2sgbGFiZWwgb3ZlcmxhcHMgdGhlIHByZXZpb3VzIGxhYmVsCiAgICAgICAgLy8gKG9yIG92ZXJmbG93cyB0aGUgY2hhcnQgdG8gdGhlIGxlZnQpLCByZW1vdmUgaXQ7CiAgICAgICAgLy8gb3RoZXJ3aXNlIHBpY2sgdGhhdCBsYWJlbCdzIG9mZnNldCBhcyB0aGUgbmV3IG9mZnNldCB0byBjaGVjayBhZ2FpbnN0CgogICAgICAgIGlmICh4TWluT2Zmc2V0IDwgb3ZlcmxhcENoZWNrKSB7CiAgICAgICAgICB0aWNrLnJlbW92ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvdmVybGFwQ2hlY2sgPSB4VHJhbnNmb3JtICsgdGlja1dpZHRoIC8gMjsKICAgICAgICB9IC8vIGlmIHRoZSBsYXN0IHRpY2sgbGFiZWwgb3ZlcmZsb3dzIHRoZSBjaGFydCB0byB0aGUgcmlnaHQsIHJlbW92ZSBpdAoKCiAgICAgICAgaWYgKHhNYXhPZmZzZXQgPiBjaGFydFdpZHRoKSB7CiAgICAgICAgICB0aWNrLnJlbW92ZSgpOwogICAgICAgIH0KICAgICAgfSk7IC8vIENoZWNrIGZvciBzZWxlY3Rpb24gYW5kIHJlc2VsZWN0IHRoZSBjb3JyZXNwb25kaW5nIHN3aW1sYW5lIGNlbGwKICAgICAgLy8gaWYgdGhlIHRpbWUgcmFuZ2UgYW5kIGxhbmUgbGFiZWwgYXJlIHN0aWxsIGluIHZpZXcuCgogICAgICB2YXIgc2VsZWN0aW9uU3RhdGUgPSBzZWxlY3Rpb247CgogICAgICB2YXIgc2VsZWN0ZWRUeXBlID0gX2xvZGFzaC5kZWZhdWx0LmdldChzZWxlY3Rpb25TdGF0ZSwgJ3R5cGUnLCB1bmRlZmluZWQpOwoKICAgICAgdmFyIHNlbGVjdGlvblZpZXdCeUZpZWxkTmFtZSA9IF9sb2Rhc2guZGVmYXVsdC5nZXQoc2VsZWN0aW9uU3RhdGUsICd2aWV3QnlGaWVsZE5hbWUnLCAnJyk7IC8vIElmIGEgc2VsZWN0aW9uIHdhcyBkb25lIGluIHRoZSBvdGhlciBzd2ltbGFuZSwgYWRkIHRoZSAibWFza2VkIiBjbGFzc2VzCiAgICAgIC8vIHRvIGRlLWVtcGhhc2l6ZSB0aGUgc3dpbWxhbmUgY2VsbHMuCgoKICAgICAgaWYgKHN3aW1sYW5lVHlwZSAhPT0gc2VsZWN0ZWRUeXBlICYmIHNlbGVjdGVkVHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZWxlbWVudC5zZWxlY3RBbGwoJy5sYW5lLWxhYmVsJykuY2xhc3NlZCgnbGFuZS1sYWJlbC1tYXNrZWQnLCB0cnVlKTsKICAgICAgICBlbGVtZW50LnNlbGVjdEFsbCgnLnNsLWNlbGwtaW5uZXInKS5jbGFzc2VkKCdzbC1jZWxsLWlubmVyLW1hc2tlZCcsIHRydWUpOwogICAgICB9CgogICAgICB0aGlzLnByb3BzLnN3aW1sYW5lUmVuZGVyRG9uZUxpc3RlbmVyKCk7CgogICAgICBpZiAoKHN3aW1sYW5lVHlwZSAhPT0gc2VsZWN0ZWRUeXBlIHx8IHN3aW1sYW5lRGF0YS5maWVsZE5hbWUgIT09IHVuZGVmaW5lZCAmJiBzd2ltbGFuZURhdGEuZmllbGROYW1lICE9PSBzZWxlY3Rpb25WaWV3QnlGaWVsZE5hbWUpICYmIGZpbHRlckFjdGl2ZSA9PT0gZmFsc2UpIHsKICAgICAgICAvLyBOb3QgdGhpcyBzd2ltbGFuZSB3aGljaCB3YXMgc2VsZWN0ZWQuCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgY2VsbHNUb1NlbGVjdCA9IFtdOwoKICAgICAgdmFyIHNlbGVjdGVkTGFuZXMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHNlbGVjdGlvblN0YXRlLCAnbGFuZXMnLCBbXSk7CgogICAgICB2YXIgc2VsZWN0ZWRUaW1lcyA9IF9sb2Rhc2guZGVmYXVsdC5nZXQoc2VsZWN0aW9uU3RhdGUsICd0aW1lcycsIFtdKTsKCiAgICAgIHZhciBzZWxlY3RlZFRpbWVFeHRlbnQgPSBfZC5kZWZhdWx0LmV4dGVudChzZWxlY3RlZFRpbWVzKTsKCiAgICAgIHNlbGVjdGVkTGFuZXMuZm9yRWFjaChmdW5jdGlvbiAoc2VsZWN0ZWRMYW5lKSB7CiAgICAgICAgaWYgKGxhbmVzLmluZGV4T2Yoc2VsZWN0ZWRMYW5lKSA+IC0xICYmIHNlbGVjdGVkVGltZUV4dGVudFswXSA+PSBzdGFydFRpbWUgJiYgc2VsZWN0ZWRUaW1lRXh0ZW50WzFdIDw9IGVuZFRpbWUpIHsKICAgICAgICAgIC8vIExvY2F0ZSBtYXRjaGluZyBjZWxsIC0gbG9vayBmb3IgZXhhY3QgdGltZSwgb3RoZXJ3aXNlIGNsb3Nlc3QgYmVmb3JlLgogICAgICAgICAgdmFyIHN3aW1sYW5lRWxlbWVudHMgPSBlbGVtZW50LnNlbGVjdCgnLm1sLXN3aW1sYW5lcycpOwogICAgICAgICAgdmFyIGxhbmVDZWxscyA9IHN3aW1sYW5lRWxlbWVudHMuc2VsZWN0QWxsKCJkaXZbZGF0YS1sYW5lLWxhYmVsPVwiIi5jb25jYXQoKDAsIF9zdHJpbmdfdXRpbHMubWxFc2NhcGUpKHNlbGVjdGVkTGFuZSksICJcIl0iKSk7CiAgICAgICAgICBsYW5lQ2VsbHMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjZWxsID0gX2QuZGVmYXVsdC5zZWxlY3QodGhpcyk7CgogICAgICAgICAgICB2YXIgY2VsbFRpbWUgPSBjZWxsLmF0dHIoJ2RhdGEtdGltZScpOwoKICAgICAgICAgICAgaWYgKGNlbGxUaW1lID49IHNlbGVjdGVkVGltZUV4dGVudFswXSAmJiBjZWxsVGltZSA8PSBzZWxlY3RlZFRpbWVFeHRlbnRbMV0pIHsKICAgICAgICAgICAgICBjZWxsc1RvU2VsZWN0LnB1c2goY2VsbC5ub2RlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB2YXIgc2VsZWN0ZWRNYXhCdWNrZXRTY29yZSA9IGNlbGxzVG9TZWxlY3QucmVkdWNlKGZ1bmN0aW9uIChtYXhCdWNrZXRTY29yZSwgY2VsbCkgewogICAgICAgIHJldHVybiBNYXRoLm1heChtYXhCdWNrZXRTY29yZSwgK19kLmRlZmF1bHQuc2VsZWN0KGNlbGwpLmF0dHIoJ2RhdGEtYnVja2V0LXNjb3JlJykgfHwgMCk7CiAgICAgIH0sIDApOwogICAgICB2YXIgc2VsZWN0ZWRDZWxsVGltZXMgPSBjZWxsc1RvU2VsZWN0Lm1hcChmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBfZC5kZWZhdWx0LnNlbGVjdChlKS5ub2RlKCkuX19jbGlja0RhdGFfXy50aW1lOwogICAgICB9KTsKCiAgICAgIGlmIChjZWxsc1RvU2VsZWN0Lmxlbmd0aCA+IDEgfHwgc2VsZWN0ZWRNYXhCdWNrZXRTY29yZSA+IDApIHsKICAgICAgICB0aGlzLmhpZ2hsaWdodFNlbGVjdGlvbihjZWxsc1RvU2VsZWN0LCBzZWxlY3RlZExhbmVzLCBzZWxlY3RlZENlbGxUaW1lcyk7CiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyQWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkQ2VsbFRpbWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0T3ZlcmFsbChzZWxlY3RlZENlbGxUaW1lcyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLm1hc2tJcnJlbGV2YW50U3dpbWxhbmVzKG1hc2tBbGwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInNob3VsZENvbXBvbmVudFVwZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdWxkQ29tcG9uZW50VXBkYXRlKCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRSZWYiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFJlZihjb21wb25lbnROb2RlKSB7CiAgICAgIHRoaXMucm9vdE5vZGUgPSBjb21wb25lbnROb2RlOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgc3dpbWxhbmVUeXBlID0gdGhpcy5wcm9wcy5zd2ltbGFuZVR5cGU7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgY2xhc3NOYW1lOiAibWwtc3dpbWxhbmVzIG1sLXN3aW1sYW5lLSIuY29uY2F0KHN3aW1sYW5lVHlwZSksCiAgICAgICAgcmVmOiB0aGlzLnNldFJlZi5iaW5kKHRoaXMpCiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEV4cGxvcmVyU3dpbWxhbmU7Cn0oX3JlYWN0LmRlZmF1bHQuQ29tcG9uZW50KSwgX2RlZmluZVByb3BlcnR5KF9jbGFzcywgInByb3BUeXBlcyIsIHsKICBjaGFydFdpZHRoOiBfcHJvcFR5cGVzLmRlZmF1bHQubnVtYmVyLmlzUmVxdWlyZWQsCiAgZmlsdGVyQWN0aXZlOiBfcHJvcFR5cGVzLmRlZmF1bHQuYm9vbCwKICBtYXNrQWxsOiBfcHJvcFR5cGVzLmRlZmF1bHQuYm9vbCwKICBUaW1lQnVja2V0czogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICBzd2ltbGFuZUNlbGxDbGljazogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICBzd2ltbGFuZURhdGE6IF9wcm9wVHlwZXMuZGVmYXVsdC5zaGFwZSh7CiAgICBsYW5lTGFiZWxzOiBfcHJvcFR5cGVzLmRlZmF1bHQuYXJyYXkuaXNSZXF1aXJlZAogIH0pLmlzUmVxdWlyZWQsCiAgc3dpbWxhbmVUeXBlOiBfcHJvcFR5cGVzLmRlZmF1bHQuc3RyaW5nLmlzUmVxdWlyZWQsCiAgc2VsZWN0aW9uOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LAogIHN3aW1sYW5lUmVuZGVyRG9uZUxpc3RlbmVyOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkCn0pLCBfdGVtcCkpOwpleHBvcnRzLkV4cGxvcmVyU3dpbWxhbmUgPSBFeHBsb3JlclN3aW1sYW5lOw=="},null]}