{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/management/sections/objects/components/objects_table/objects_table.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/management/sections/objects/components/objects_table/objects_table.js","mtime":1585205039835},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLk9iamVjdHNUYWJsZSA9IGV4cG9ydHMuUE9TU0lCTEVfVFlQRVMgPSB2b2lkIDA7Cgp2YXIgX2Nocm9tZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidWkvY2hyb21lIikpOwoKdmFyIF9maWxlc2F2ZXIgPSByZXF1aXJlKCJAZWxhc3RpYy9maWxlc2F2ZXIiKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJwcm9wLXR5cGVzIikpOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfaGVhZGVyID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL2hlYWRlciIpOwoKdmFyIF9mbHlvdXQgPSByZXF1aXJlKCIuL2NvbXBvbmVudHMvZmx5b3V0Iik7Cgp2YXIgX3JlbGF0aW9uc2hpcHMgPSByZXF1aXJlKCIuL2NvbXBvbmVudHMvcmVsYXRpb25zaGlwcyIpOwoKdmFyIF90YWJsZSA9IHJlcXVpcmUoIi4vY29tcG9uZW50cy90YWJsZSIpOwoKdmFyIF9ub3RpZnkgPSByZXF1aXJlKCJ1aS9ub3RpZnkiKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4uLy4uL2xpYiIpOwoKdmFyIF9leHRyYWN0X2V4cG9ydF9kZXRhaWxzID0gcmVxdWlyZSgiLi4vLi4vbGliL2V4dHJhY3RfZXhwb3J0X2RldGFpbHMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgeyByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsgdmFyIF9hcnIgPSBbXTsgdmFyIF9uID0gdHJ1ZTsgdmFyIF9kID0gZmFsc2U7IHZhciBfZSA9IHVuZGVmaW5lZDsgdHJ5IHsgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgeyBfYXJyLnB1c2goX3MudmFsdWUpOyBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7IH0gfSBjYXRjaCAoZXJyKSB7IF9kID0gdHJ1ZTsgX2UgPSBlcnI7IH0gZmluYWxseSB7IHRyeSB7IGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoX2QpIHRocm93IF9lOyB9IH0gcmV0dXJuIF9hcnI7IH0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBQT1NTSUJMRV9UWVBFUyA9IF9jaHJvbWUuZGVmYXVsdC5nZXRJbmplY3RlZCgnaW1wb3J0QW5kRXhwb3J0YWJsZVR5cGVzJyk7CgpleHBvcnRzLlBPU1NJQkxFX1RZUEVTID0gUE9TU0lCTEVfVFlQRVM7Cgp2YXIgT2JqZWN0c1RhYmxlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhPYmplY3RzVGFibGUsIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBPYmplY3RzVGFibGUocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgT2JqZWN0c1RhYmxlKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihPYmplY3RzVGFibGUpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJmZXRjaENvdW50cyIsIGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHZhciBfcGFyc2VRdWVyeSwgcXVlcnlUZXh0LCB2aXNpYmxlVHlwZXMsIGZpbHRlcmVkVHlwZXMsIGZpbHRlcmVkU2F2ZWRPYmplY3RDb3VudHMsIGV4cG9ydEFsbE9wdGlvbnMsIGV4cG9ydEFsbFNlbGVjdGVkT3B0aW9ucywgc2F2ZWRPYmplY3RDb3VudHM7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9wYXJzZVF1ZXJ5ID0gKDAsIF9saWIucGFyc2VRdWVyeSkoX3RoaXMuc3RhdGUuYWN0aXZlUXVlcnkpLCBxdWVyeVRleHQgPSBfcGFyc2VRdWVyeS5xdWVyeVRleHQsIHZpc2libGVUeXBlcyA9IF9wYXJzZVF1ZXJ5LnZpc2libGVUeXBlczsKICAgICAgICAgICAgICBmaWx0ZXJlZFR5cGVzID0gX3RoaXMuc2F2ZWRPYmplY3RUeXBlcy5maWx0ZXIoZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhdmlzaWJsZVR5cGVzIHx8IHZpc2libGVUeXBlcy5pbmNsdWRlcyh0eXBlKTsKICAgICAgICAgICAgICB9KTsgLy8gVGhlc2UgYXJlIHRoZSBzYXZlZCBvYmplY3RzIHZpc2libGUgaW4gdGhlIHRhYmxlLgoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKCgwLCBfbGliLmdldFNhdmVkT2JqZWN0Q291bnRzKShfdGhpcy5wcm9wcy4kaHR0cCwgZmlsdGVyZWRUeXBlcywgcXVlcnlUZXh0KSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgZmlsdGVyZWRTYXZlZE9iamVjdENvdW50cyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgZXhwb3J0QWxsT3B0aW9ucyA9IFtdOwogICAgICAgICAgICAgIGV4cG9ydEFsbFNlbGVjdGVkT3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgIE9iamVjdC5rZXlzKGZpbHRlcmVkU2F2ZWRPYmplY3RDb3VudHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgICAgICAvLyBBZGQgdGhpcyB0eXBlIGFzIGEgYnVsay1leHBvcnQgb3B0aW9uLgogICAgICAgICAgICAgICAgZXhwb3J0QWxsT3B0aW9ucy5wdXNoKHsKICAgICAgICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICAgICAgICBsYWJlbDogIiIuY29uY2F0KGlkLCAiICgiKS5jb25jYXQoZmlsdGVyZWRTYXZlZE9iamVjdENvdW50c1tpZF0gfHwgMCwgIikiKQogICAgICAgICAgICAgICAgfSk7IC8vIFNlbGVjdCBpdCBieSBkZWZheXVsdC4KCiAgICAgICAgICAgICAgICBleHBvcnRBbGxTZWxlY3RlZE9wdGlvbnNbaWRdID0gdHJ1ZTsKICAgICAgICAgICAgICB9KTsgLy8gRmV0Y2ggYWxsIHRoZSBzYXZlZCBvYmplY3RzIHRoYXQgZXhpc3Qgc28gd2UgY2FuIGFjY3VyYXRlbHkgcG9wdWxhdGUgdGhlIGNvdW50cyB3aXRoaW4KICAgICAgICAgICAgICAvLyB0aGUgdGFibGUgZmlsdGVyIGRyb3Bkb3duLgoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2xpYi5nZXRTYXZlZE9iamVjdENvdW50cykoX3RoaXMucHJvcHMuJGh0dHAsIF90aGlzLnNhdmVkT2JqZWN0VHlwZXMsIHF1ZXJ5VGV4dCkpOwoKICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBzYXZlZE9iamVjdENvdW50cyA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChzdGF0ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgICAgICAgICAgIHNhdmVkT2JqZWN0Q291bnRzOiBzYXZlZE9iamVjdENvdW50cywKICAgICAgICAgICAgICAgICAgZXhwb3J0QWxsT3B0aW9uczogZXhwb3J0QWxsT3B0aW9ucywKICAgICAgICAgICAgICAgICAgZXhwb3J0QWxsU2VsZWN0ZWRPcHRpb25zOiBleHBvcnRBbGxTZWxlY3RlZE9wdGlvbnMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJmZXRjaFNhdmVkT2JqZWN0cyIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGlzU2VhcmNoaW5nOiB0cnVlCiAgICAgIH0sIF90aGlzLmRlYm91bmNlZEZldGNoKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRlYm91bmNlZEZldGNoIiwgKDAsIF9sb2Rhc2guZGVib3VuY2UpKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUsIHF1ZXJ5LCBwYWdlLCBwZXJQYWdlLCBfcGFyc2VRdWVyeTIsIHF1ZXJ5VGV4dCwgdmlzaWJsZVR5cGVzLCBmaW5kT3B0aW9ucywgcmVzcDsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF90aGlzJHN0YXRlID0gX3RoaXMuc3RhdGUsIHF1ZXJ5ID0gX3RoaXMkc3RhdGUuYWN0aXZlUXVlcnksIHBhZ2UgPSBfdGhpcyRzdGF0ZS5wYWdlLCBwZXJQYWdlID0gX3RoaXMkc3RhdGUucGVyUGFnZTsKICAgICAgICAgICAgICBfcGFyc2VRdWVyeTIgPSAoMCwgX2xpYi5wYXJzZVF1ZXJ5KShxdWVyeSksIHF1ZXJ5VGV4dCA9IF9wYXJzZVF1ZXJ5Mi5xdWVyeVRleHQsIHZpc2libGVUeXBlcyA9IF9wYXJzZVF1ZXJ5Mi52aXNpYmxlVHlwZXM7IC8vICJzZWFyY2hGaWVsZHMiIGlzIG1pc3NpbmcgZnJvbSB0aGUgImZpbmRPcHRpb25zIiBidXQgZ2V0cyBpbmplY3RlZCB2aWEgdGhlIEFQSS4KICAgICAgICAgICAgICAvLyBUaGUgQVBJIGV4dHJhY3RzIHRoZSBmaWVsZHMgZnJvbSBlYWNoIHVpRXhwb3J0cy5zYXZlZE9iamVjdHNNYW5hZ2VtZW50ICJkZWZhdWx0U2VhcmNoRmllbGQiIGF0dHJpYnV0ZQoKICAgICAgICAgICAgICBmaW5kT3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgIHNlYXJjaDogcXVlcnlUZXh0ID8gIiIuY29uY2F0KHF1ZXJ5VGV4dCwgIioiKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHBlclBhZ2U6IHBlclBhZ2UsCiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlICsgMSwKICAgICAgICAgICAgICAgIGZpZWxkczogWydpZCddLAogICAgICAgICAgICAgICAgdHlwZTogX3RoaXMuc2F2ZWRPYmplY3RUeXBlcy5maWx0ZXIoZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICF2aXNpYmxlVHlwZXMgfHwgdmlzaWJsZVR5cGVzLmluY2x1ZGVzKHR5cGUpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoZmluZE9wdGlvbnMudHlwZS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICBmaW5kT3B0aW9ucy5zb3J0RmllbGQgPSAndHlwZSc7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDQ7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9saWIuZmluZE9iamVjdHMpKGZpbmRPcHRpb25zKSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgcmVzcCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMTA7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gX2NvbnRleHQyWyJjYXRjaCJdKDQpOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMuX2lzTW91bnRlZCkgewogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICBpc1NlYXJjaGluZzogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkRGFuZ2VyKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUudW5hYmxlRmluZFNhdmVkT2JqZWN0c05vdGlmaWNhdGlvbk1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5hYmxlIGZpbmQgc2F2ZWQgb2JqZWN0cycKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgdGV4dDogIiIuY29uY2F0KF9jb250ZXh0Mi50MCkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICBpZiAoX3RoaXMuX2lzTW91bnRlZCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoX3JlZikgewogICAgICAgICAgICAgICAgdmFyIGFjdGl2ZVF1ZXJ5ID0gX3JlZi5hY3RpdmVRdWVyeTsKCiAgICAgICAgICAgICAgICAvLyBpZ25vcmUgcmVzdWx0cyBmb3Igb2xkIHJlcXVlc3RzCiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlUXVlcnkudGV4dCAhPT0gcXVlcnkudGV4dCkgewogICAgICAgICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgc2F2ZWRPYmplY3RzOiByZXNwLnNhdmVkT2JqZWN0cywKICAgICAgICAgICAgICAgICAgZmlsdGVyZWRJdGVtQ291bnQ6IHJlc3AudG90YWwsCiAgICAgICAgICAgICAgICAgIGlzU2VhcmNoaW5nOiBmYWxzZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCBudWxsLCBbWzQsIDEwXV0pOwogICAgfSwgMzAwKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVmcmVzaERhdGEiLCBmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoUHJvbWlzZS5hbGwoW190aGlzLmZldGNoU2F2ZWRPYmplY3RzKCksIF90aGlzLmZldGNoQ291bnRzKCldKSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2VsZWN0aW9uQ2hhbmdlZCIsIGZ1bmN0aW9uIChzZWxlY3Rpb24pIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHNlbGVjdGVkU2F2ZWRPYmplY3RzOiBzZWxlY3Rpb24KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblF1ZXJ5Q2hhbmdlIiwgZnVuY3Rpb24gKF9yZWYyKSB7CiAgICAgIHZhciBxdWVyeSA9IF9yZWYyLnF1ZXJ5OwoKICAgICAgLy8gVE9ETzogVXNlIGlzU2FtZVF1ZXJ5IHRvIGNvbXBhcmUgbmV3IHF1ZXJ5IHdpdGggc3RhdGUuYWN0aXZlUXVlcnkgdG8gYXZvaWQgcmUtZmV0Y2hpbmcgdGhlCiAgICAgIC8vIHNhbWUgZGF0YSB3ZSBhbHJlYWR5IGhhdmUuCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBhY3RpdmVRdWVyeTogcXVlcnksCiAgICAgICAgcGFnZTogMCwKICAgICAgICAvLyBSZXNldCB0aGlzIG9uIGVhY2ggcXVlcnkgY2hhbmdlCiAgICAgICAgc2VsZWN0ZWRTYXZlZE9iamVjdHM6IFtdCiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy5mZXRjaFNhdmVkT2JqZWN0cygpOwoKICAgICAgICBfdGhpcy5mZXRjaENvdW50cygpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uVGFibGVDaGFuZ2UiLCBmdW5jdGlvbiBfY2FsbGVlNCh0YWJsZSkgewogICAgICB2YXIgX3JlZjMsIHBhZ2UsIHBlclBhZ2U7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfcmVmMyA9IHRhYmxlLnBhZ2UgfHwge30sIHBhZ2UgPSBfcmVmMy5pbmRleCwgcGVyUGFnZSA9IF9yZWYzLnNpemU7CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsCiAgICAgICAgICAgICAgICBwZXJQYWdlOiBwZXJQYWdlLAogICAgICAgICAgICAgICAgc2VsZWN0ZWRTYXZlZE9iamVjdHM6IFtdCiAgICAgICAgICAgICAgfSwgX3RoaXMuZmV0Y2hTYXZlZE9iamVjdHMpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblNob3dSZWxhdGlvbnNoaXBzIiwgZnVuY3Rpb24gKG9iamVjdCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaXNTaG93aW5nUmVsYXRpb25zaGlwczogdHJ1ZSwKICAgICAgICByZWxhdGlvbnNoaXBPYmplY3Q6IG9iamVjdAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uSGlkZVJlbGF0aW9uc2hpcHMiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpc1Nob3dpbmdSZWxhdGlvbnNoaXBzOiBmYWxzZSwKICAgICAgICByZWxhdGlvbnNoaXBPYmplY3Q6IHVuZGVmaW5lZAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uRXhwb3J0IiwgZnVuY3Rpb24gX2NhbGxlZTUoaW5jbHVkZVJlZmVyZW5jZXNEZWVwKSB7CiAgICAgIHZhciBzZWxlY3RlZFNhdmVkT2JqZWN0cywgb2JqZWN0c1RvRXhwb3J0LCBibG9iLCBleHBvcnREZXRhaWxzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBzZWxlY3RlZFNhdmVkT2JqZWN0cyA9IF90aGlzLnN0YXRlLnNlbGVjdGVkU2F2ZWRPYmplY3RzOwogICAgICAgICAgICAgIG9iamVjdHNUb0V4cG9ydCA9IHNlbGVjdGVkU2F2ZWRPYmplY3RzLm1hcChmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpZDogb2JqLmlkLAogICAgICAgICAgICAgICAgICB0eXBlOiBvYmoudHlwZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBfY29udGV4dDUucHJldiA9IDI7CiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA1OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9saWIuZmV0Y2hFeHBvcnRPYmplY3RzKShvYmplY3RzVG9FeHBvcnQsIGluY2x1ZGVSZWZlcmVuY2VzRGVlcCkpOwoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGJsb2IgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDEyOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gODsKICAgICAgICAgICAgICBfY29udGV4dDUudDAgPSBfY29udGV4dDVbImNhdGNoIl0oMik7CgogICAgICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZERhbmdlcih7CiAgICAgICAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmV4cG9ydC5kYW5nZXJOb3RpZmljYXRpb24nLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5hYmxlIHRvIGdlbmVyYXRlIGV4cG9ydCcKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHRocm93IF9jb250ZXh0NS50MDsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgKDAsIF9maWxlc2F2ZXIuc2F2ZUFzKShibG9iLCAnZXhwb3J0Lm5kanNvbicpOwogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCgoMCwgX2V4dHJhY3RfZXhwb3J0X2RldGFpbHMuZXh0cmFjdEV4cG9ydERldGFpbHMpKGJsb2IpKTsKCiAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgZXhwb3J0RGV0YWlscyA9IF9jb250ZXh0NS5zZW50OwoKICAgICAgICAgICAgICBfdGhpcy5zaG93RXhwb3J0U3VjY2Vzc01lc3NhZ2UoZXhwb3J0RGV0YWlscyk7CgogICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgbnVsbCwgW1syLCA4XV0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25FeHBvcnRBbGwiLCBmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMiwgZXhwb3J0QWxsU2VsZWN0ZWRPcHRpb25zLCBpc0luY2x1ZGVSZWZlcmVuY2VzRGVlcENoZWNrZWQsIGFjdGl2ZVF1ZXJ5LCBfcGFyc2VRdWVyeTMsIHF1ZXJ5VGV4dCwgZXhwb3J0VHlwZXMsIGJsb2IsIGV4cG9ydERldGFpbHM7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmFzeW5jKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpcyRzdGF0ZTIgPSBfdGhpcy5zdGF0ZSwgZXhwb3J0QWxsU2VsZWN0ZWRPcHRpb25zID0gX3RoaXMkc3RhdGUyLmV4cG9ydEFsbFNlbGVjdGVkT3B0aW9ucywgaXNJbmNsdWRlUmVmZXJlbmNlc0RlZXBDaGVja2VkID0gX3RoaXMkc3RhdGUyLmlzSW5jbHVkZVJlZmVyZW5jZXNEZWVwQ2hlY2tlZCwgYWN0aXZlUXVlcnkgPSBfdGhpcyRzdGF0ZTIuYWN0aXZlUXVlcnk7CiAgICAgICAgICAgICAgX3BhcnNlUXVlcnkzID0gKDAsIF9saWIucGFyc2VRdWVyeSkoYWN0aXZlUXVlcnkpLCBxdWVyeVRleHQgPSBfcGFyc2VRdWVyeTMucXVlcnlUZXh0OwogICAgICAgICAgICAgIGV4cG9ydFR5cGVzID0gT2JqZWN0LmVudHJpZXMoZXhwb3J0QWxsU2VsZWN0ZWRPcHRpb25zKS5yZWR1Y2UoZnVuY3Rpb24gKGFjY3VtLCBfcmVmNCkgewogICAgICAgICAgICAgICAgdmFyIF9yZWY1ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjQsIDIpLAogICAgICAgICAgICAgICAgICAgIGlkID0gX3JlZjVbMF0sCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSBfcmVmNVsxXTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgYWNjdW0ucHVzaChpZCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGFjY3VtOwogICAgICAgICAgICAgIH0sIFtdKTsKICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDM7CiAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9saWIuZmV0Y2hFeHBvcnRCeVR5cGVBbmRTZWFyY2gpKGV4cG9ydFR5cGVzLCBxdWVyeVRleHQgPyAiIi5jb25jYXQocXVlcnlUZXh0LCAiKiIpIDogdW5kZWZpbmVkLCBpc0luY2x1ZGVSZWZlcmVuY2VzRGVlcENoZWNrZWQpKTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBibG9iID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMzsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDk7CiAgICAgICAgICAgICAgX2NvbnRleHQ2LnQwID0gX2NvbnRleHQ2WyJjYXRjaCJdKDMpOwoKICAgICAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGREYW5nZXIoewogICAgICAgICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5leHBvcnQuZGFuZ2VyTm90aWZpY2F0aW9uJywgewogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VuYWJsZSB0byBnZW5lcmF0ZSBleHBvcnQnCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDYudDA7CgogICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICgwLCBfZmlsZXNhdmVyLnNhdmVBcykoYmxvYiwgJ2V4cG9ydC5uZGpzb24nKTsKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE2OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoKDAsIF9leHRyYWN0X2V4cG9ydF9kZXRhaWxzLmV4dHJhY3RFeHBvcnREZXRhaWxzKShibG9iKSk7CgogICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgIGV4cG9ydERldGFpbHMgPSBfY29udGV4dDYuc2VudDsKCiAgICAgICAgICAgICAgX3RoaXMuc2hvd0V4cG9ydFN1Y2Nlc3NNZXNzYWdlKGV4cG9ydERldGFpbHMpOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpc1Nob3dpbmdFeHBvcnRBbGxPcHRpb25zTW9kYWw6IGZhbHNlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbnVsbCwgbnVsbCwgW1szLCA5XV0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2hvd0V4cG9ydFN1Y2Nlc3NNZXNzYWdlIiwgZnVuY3Rpb24gKGV4cG9ydERldGFpbHMpIHsKICAgICAgaWYgKGV4cG9ydERldGFpbHMgJiYgZXhwb3J0RGV0YWlscy5taXNzaW5nUmVmZXJlbmNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkV2FybmluZyh7CiAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmV4cG9ydC5zdWNjZXNzV2l0aE1pc3NpbmdSZWZzTm90aWZpY2F0aW9uJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1lvdXIgZmlsZSBpcyBkb3dubG9hZGluZyBpbiB0aGUgYmFja2dyb3VuZC4gJyArICdTb21lIHJlbGF0ZWQgb2JqZWN0cyBjb3VsZCBub3QgYmUgZm91bmQuICcgKyAnUGxlYXNlIHNlZSB0aGUgbGFzdCBsaW5lIGluIHRoZSBleHBvcnRlZCBmaWxlIGZvciBhIGxpc3Qgb2YgbWlzc2luZyBvYmplY3RzLicKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkU3VjY2Vzcyh7CiAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmV4cG9ydC5zdWNjZXNzTm90aWZpY2F0aW9uJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1lvdXIgZmlsZSBpcyBkb3dubG9hZGluZyBpbiB0aGUgYmFja2dyb3VuZCcKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImZpbmlzaEltcG9ydCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuaGlkZUltcG9ydEZseW91dCgpOwoKICAgICAgX3RoaXMuZmV0Y2hTYXZlZE9iamVjdHMoKTsKCiAgICAgIF90aGlzLmZldGNoQ291bnRzKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzaG93SW1wb3J0Rmx5b3V0IiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaXNTaG93aW5nSW1wb3J0Rmx5b3V0OiB0cnVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGlkZUltcG9ydEZseW91dCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGlzU2hvd2luZ0ltcG9ydEZseW91dDogZmFsc2UKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkRlbGV0ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGlzU2hvd2luZ0RlbGV0ZUNvbmZpcm1Nb2RhbDogdHJ1ZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImRlbGV0ZSIsIGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICB2YXIgc2F2ZWRPYmplY3RzQ2xpZW50LCBfdGhpcyRzdGF0ZTMsIHNlbGVjdGVkU2F2ZWRPYmplY3RzLCBpc0RlbGV0aW5nLCBpbmRleFBhdHRlcm5zLCBvYmplY3RzLCBkZWxldGVzOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgc2F2ZWRPYmplY3RzQ2xpZW50ID0gX3RoaXMucHJvcHMuc2F2ZWRPYmplY3RzQ2xpZW50OwogICAgICAgICAgICAgIF90aGlzJHN0YXRlMyA9IF90aGlzLnN0YXRlLCBzZWxlY3RlZFNhdmVkT2JqZWN0cyA9IF90aGlzJHN0YXRlMy5zZWxlY3RlZFNhdmVkT2JqZWN0cywgaXNEZWxldGluZyA9IF90aGlzJHN0YXRlMy5pc0RlbGV0aW5nOwoKICAgICAgICAgICAgICBpZiAoIWlzRGVsZXRpbmcpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzRGVsZXRpbmc6IHRydWUKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJucyA9IHNlbGVjdGVkU2F2ZWRPYmplY3RzLmZpbHRlcihmdW5jdGlvbiAob2JqZWN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0LnR5cGUgPT09ICdpbmRleC1wYXR0ZXJuJzsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKCFpbmRleFBhdHRlcm5zLmxlbmd0aCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zLmNsZWFyQ2FjaGUoKSk7CgogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAxMTsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHNhdmVkT2JqZWN0c0NsaWVudC5idWxrR2V0KHNlbGVjdGVkU2F2ZWRPYmplY3RzKSk7CgogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIG9iamVjdHMgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICBkZWxldGVzID0gb2JqZWN0cy5zYXZlZE9iamVjdHMubWFwKGZ1bmN0aW9uIChvYmplY3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzYXZlZE9iamVjdHNDbGllbnQuZGVsZXRlKG9iamVjdC50eXBlLCBvYmplY3QuaWQpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChQcm9taXNlLmFsbChkZWxldGVzKSk7CgogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIC8vIFVuc2V0IHRoaXMKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBzZWxlY3RlZFNhdmVkT2JqZWN0czogW10KICAgICAgICAgICAgICB9KTsgLy8gRmV0Y2hpbmcgYWxsIGRhdGEKCgogICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChfdGhpcy5mZXRjaFNhdmVkT2JqZWN0cygpKTsKCiAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAyMDsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzLmZldGNoQ291bnRzKCkpOwoKICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAvLyBBbGxvdyB0aGUgdXNlciB0byBpbnRlcmFjdCB3aXRoIHRoZSB0YWJsZSBvbmNlIHRoZSBzYXZlZCBvYmplY3RzIGhhdmUgYmVlbiByZS1mZXRjaGVkLgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGlzU2hvd2luZ0RlbGV0ZUNvbmZpcm1Nb2RhbDogZmFsc2UsCiAgICAgICAgICAgICAgICBpc0RlbGV0aW5nOiBmYWxzZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0UmVsYXRpb25zaGlwcyIsIGZ1bmN0aW9uIF9jYWxsZWU4KHR5cGUsIGlkKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKCgwLCBfbGliLmdldFJlbGF0aW9uc2hpcHMpKHR5cGUsIGlkLCBfdGhpcy5zYXZlZE9iamVjdFR5cGVzLCBfdGhpcy5wcm9wcy4kaHR0cCwgX3RoaXMucHJvcHMuYmFzZVBhdGgpKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ4LnNlbnQpOwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjaGFuZ2VJbmNsdWRlUmVmZXJlbmNlc0RlZXAiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChzdGF0ZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpc0luY2x1ZGVSZWZlcmVuY2VzRGVlcENoZWNrZWQ6ICFzdGF0ZS5pc0luY2x1ZGVSZWZlcmVuY2VzRGVlcENoZWNrZWQKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNsb3NlRXhwb3J0QWxsTW9kYWwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpc1Nob3dpbmdFeHBvcnRBbGxPcHRpb25zTW9kYWw6IGZhbHNlCiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMuc2F2ZWRPYmplY3RUeXBlcyA9IFBPU1NJQkxFX1RZUEVTOwogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIHRvdGFsQ291bnQ6IDAsCiAgICAgIHBhZ2U6IDAsCiAgICAgIHBlclBhZ2U6IHByb3BzLnBlclBhZ2VDb25maWcgfHwgNTAsCiAgICAgIHNhdmVkT2JqZWN0czogW10sCiAgICAgIHNhdmVkT2JqZWN0Q291bnRzOiBfdGhpcy5zYXZlZE9iamVjdFR5cGVzLnJlZHVjZShmdW5jdGlvbiAodHlwZVRvQ291bnRNYXAsIHR5cGUpIHsKICAgICAgICB0eXBlVG9Db3VudE1hcFt0eXBlXSA9IDA7CiAgICAgICAgcmV0dXJuIHR5cGVUb0NvdW50TWFwOwogICAgICB9LCB7fSksCiAgICAgIGFjdGl2ZVF1ZXJ5OiBfZXVpLlF1ZXJ5LnBhcnNlKCcnKSwKICAgICAgc2VsZWN0ZWRTYXZlZE9iamVjdHM6IFtdLAogICAgICBpc1Nob3dpbmdJbXBvcnRGbHlvdXQ6IGZhbHNlLAogICAgICBpc1NlYXJjaGluZzogZmFsc2UsCiAgICAgIGZpbHRlcmVkSXRlbUNvdW50OiAwLAogICAgICBpc1Nob3dpbmdSZWxhdGlvbnNoaXBzOiBmYWxzZSwKICAgICAgcmVsYXRpb25zaGlwT2JqZWN0OiB1bmRlZmluZWQsCiAgICAgIGlzU2hvd2luZ0RlbGV0ZUNvbmZpcm1Nb2RhbDogZmFsc2UsCiAgICAgIGlzU2hvd2luZ0V4cG9ydEFsbE9wdGlvbnNNb2RhbDogZmFsc2UsCiAgICAgIGlzRGVsZXRpbmc6IGZhbHNlLAogICAgICBleHBvcnRBbGxPcHRpb25zOiBbXSwKICAgICAgZXhwb3J0QWxsU2VsZWN0ZWRPcHRpb25zOiB7fSwKICAgICAgaXNJbmNsdWRlUmVmZXJlbmNlc0RlZXBDaGVja2VkOiB0cnVlCiAgICB9OwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKE9iamVjdHNUYWJsZSwgW3sKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdGhpcy5faXNNb3VudGVkID0gdHJ1ZTsKICAgICAgdGhpcy5mZXRjaFNhdmVkT2JqZWN0cygpOwogICAgICB0aGlzLmZldGNoQ291bnRzKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFVubW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkgewogICAgICB0aGlzLl9pc01vdW50ZWQgPSBmYWxzZTsKICAgICAgdGhpcy5kZWJvdW5jZWRGZXRjaC5jYW5jZWwoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJGbHlvdXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckZseW91dCgpIHsKICAgICAgaWYgKCF0aGlzLnN0YXRlLmlzU2hvd2luZ0ltcG9ydEZseW91dCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZmx5b3V0LkZseW91dCwgewogICAgICAgIGNsb3NlOiB0aGlzLmhpZGVJbXBvcnRGbHlvdXQsCiAgICAgICAgZG9uZTogdGhpcy5maW5pc2hJbXBvcnQsCiAgICAgICAgc2VydmljZXM6IHRoaXMucHJvcHMuc2VydmljZXMsCiAgICAgICAgaW5kZXhQYXR0ZXJuczogdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zLAogICAgICAgIG5ld0luZGV4UGF0dGVyblVybDogdGhpcy5wcm9wcy5uZXdJbmRleFBhdHRlcm5VcmwsCiAgICAgICAgc2F2ZWRPYmplY3RUeXBlczogdGhpcy5wcm9wcy5zYXZlZE9iamVjdFR5cGVzLAogICAgICAgIGNvbmZpcm1Nb2RhbFByb21pc2U6IHRoaXMucHJvcHMuY29uZmlybU1vZGFsUHJvbWlzZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJSZWxhdGlvbnNoaXBzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJSZWxhdGlvbnNoaXBzKCkgewogICAgICBpZiAoIXRoaXMuc3RhdGUuaXNTaG93aW5nUmVsYXRpb25zaGlwcykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVsYXRpb25zaGlwcy5SZWxhdGlvbnNoaXBzLCB7CiAgICAgICAgc2F2ZWRPYmplY3Q6IHRoaXMuc3RhdGUucmVsYXRpb25zaGlwT2JqZWN0LAogICAgICAgIGdldFJlbGF0aW9uc2hpcHM6IHRoaXMuZ2V0UmVsYXRpb25zaGlwcywKICAgICAgICBjbG9zZTogdGhpcy5vbkhpZGVSZWxhdGlvbnNoaXBzLAogICAgICAgIGdldERhc2hib2FyZFVybDogdGhpcy5wcm9wcy5nZXREYXNoYm9hcmRVcmwsCiAgICAgICAgZ29JbnNwZWN0T2JqZWN0OiB0aGlzLnByb3BzLmdvSW5zcGVjdE9iamVjdCwKICAgICAgICBjYW5Hb0luQXBwOiB0aGlzLnByb3BzLmNhbkdvSW5BcHAKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyRGVsZXRlQ29uZmlybU1vZGFsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJEZWxldGVDb25maXJtTW9kYWwoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHN0YXRlNCA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBpc1Nob3dpbmdEZWxldGVDb25maXJtTW9kYWwgPSBfdGhpcyRzdGF0ZTQuaXNTaG93aW5nRGVsZXRlQ29uZmlybU1vZGFsLAogICAgICAgICAgaXNEZWxldGluZyA9IF90aGlzJHN0YXRlNC5pc0RlbGV0aW5nLAogICAgICAgICAgc2VsZWN0ZWRTYXZlZE9iamVjdHMgPSBfdGhpcyRzdGF0ZTQuc2VsZWN0ZWRTYXZlZE9iamVjdHM7CgogICAgICBpZiAoIWlzU2hvd2luZ0RlbGV0ZUNvbmZpcm1Nb2RhbCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgbW9kYWw7CgogICAgICBpZiAoaXNEZWxldGluZykgewogICAgICAgIC8vIEJsb2NrIHRoZSB1c2VyIGZyb20gaW50ZXJhY3Rpbmcgd2l0aCB0aGUgdGFibGUgd2hpbGUgaXRzIGNvbnRlbnRzIGFyZSBiZWluZyBkZWxldGVkLgogICAgICAgIG1vZGFsID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxvYWRpbmdLaWJhbmEsIHsKICAgICAgICAgIHNpemU6ICJ4bCIKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgb25DYW5jZWwgPSBmdW5jdGlvbiBvbkNhbmNlbCgpIHsKICAgICAgICAgIF90aGlzMi5zZXRTdGF0ZSh7CiAgICAgICAgICAgIGlzU2hvd2luZ0RlbGV0ZUNvbmZpcm1Nb2RhbDogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIHZhciBvbkNvbmZpcm0gPSBmdW5jdGlvbiBvbkNvbmZpcm0oKSB7CiAgICAgICAgICBfdGhpczIuZGVsZXRlKCk7CiAgICAgICAgfTsKCiAgICAgICAgbW9kYWwgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29uZmlybU1vZGFsLCB7CiAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5kZWxldGVTYXZlZE9iamVjdHNDb25maXJtTW9kYWxUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVsZXRlIHNhdmVkIG9iamVjdHMiCiAgICAgICAgICB9KSwKICAgICAgICAgIG9uQ2FuY2VsOiBvbkNhbmNlbCwKICAgICAgICAgIG9uQ29uZmlybTogb25Db25maXJtLAogICAgICAgICAgYnV0dG9uQ29sb3I6ICJkYW5nZXIiLAogICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5kZWxldGVTYXZlZE9iamVjdHNDb25maXJtTW9kYWwuY2FuY2VsQnV0dG9uTGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNhbmNlbCIKICAgICAgICAgIH0pLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IGlzRGVsZXRpbmcgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmRlbGV0ZVNhdmVkT2JqZWN0c0NvbmZpcm1Nb2RhbC5kZWxldGVQcm9jZXNzQnV0dG9uTGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlbGV0aW5nXHUyMDI2IgogICAgICAgICAgfSkgOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmRlbGV0ZVNhdmVkT2JqZWN0c0NvbmZpcm1Nb2RhbC5kZWxldGVCdXR0b25MYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVsZXRlIgogICAgICAgICAgfSksCiAgICAgICAgICBkZWZhdWx0Rm9jdXNlZEJ1dHRvbjogX2V1aS5FVUlfTU9EQUxfQ09ORklSTV9CVVRUT04KICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5kZWxldGVTYXZlZE9iamVjdHNDb25maXJtTW9kYWxEZXNjcmlwdGlvbiIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoaXMgYWN0aW9uIHdpbGwgZGVsZXRlIHRoZSBmb2xsb3dpbmcgc2F2ZWQgb2JqZWN0czoiCiAgICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSW5NZW1vcnlUYWJsZSwgewogICAgICAgICAgaXRlbXM6IHNlbGVjdGVkU2F2ZWRPYmplY3RzLAogICAgICAgICAgY29sdW1uczogW3sKICAgICAgICAgICAgZmllbGQ6ICd0eXBlJywKICAgICAgICAgICAgbmFtZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmRlbGV0ZVNhdmVkT2JqZWN0c0NvbmZpcm1Nb2RhbC50eXBlQ29sdW1uTmFtZScsIHsKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1R5cGUnCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICB3aWR0aDogJzUwcHgnLAogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcih0eXBlLCBvYmplY3QpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRvb2xUaXAsIHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wIiwKICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICgwLCBfbGliLmdldFNhdmVkT2JqZWN0TGFiZWwpKHR5cGUpCiAgICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUljb24sIHsKICAgICAgICAgICAgICAgIHR5cGU6IG9iamVjdC5tZXRhLmljb24gfHwgJ2FwcHMnCiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGZpZWxkOiAnaWQnLAogICAgICAgICAgICBuYW1lOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZGVsZXRlU2F2ZWRPYmplY3RzQ29uZmlybU1vZGFsLmlkQ29sdW1uTmFtZScsIHsKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0lkJwogICAgICAgICAgICB9KQogICAgICAgICAgfSwgewogICAgICAgICAgICBmaWVsZDogJ21ldGEudGl0bGUnLAogICAgICAgICAgICBuYW1lOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZGVsZXRlU2F2ZWRPYmplY3RzQ29uZmlybU1vZGFsLnRpdGxlQ29sdW1uTmFtZScsIHsKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1RpdGxlJwogICAgICAgICAgICB9KQogICAgICAgICAgfV0sCiAgICAgICAgICBwYWdpbmF0aW9uOiB0cnVlLAogICAgICAgICAgc29ydGluZzogZmFsc2UKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpT3ZlcmxheU1hc2ssIG51bGwsIG1vZGFsKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJFeHBvcnRBbGxPcHRpb25zTW9kYWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckV4cG9ydEFsbE9wdGlvbnNNb2RhbCgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgX3RoaXMkc3RhdGU1ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGlzU2hvd2luZ0V4cG9ydEFsbE9wdGlvbnNNb2RhbCA9IF90aGlzJHN0YXRlNS5pc1Nob3dpbmdFeHBvcnRBbGxPcHRpb25zTW9kYWwsCiAgICAgICAgICBmaWx0ZXJlZEl0ZW1Db3VudCA9IF90aGlzJHN0YXRlNS5maWx0ZXJlZEl0ZW1Db3VudCwKICAgICAgICAgIGV4cG9ydEFsbE9wdGlvbnMgPSBfdGhpcyRzdGF0ZTUuZXhwb3J0QWxsT3B0aW9ucywKICAgICAgICAgIGV4cG9ydEFsbFNlbGVjdGVkT3B0aW9ucyA9IF90aGlzJHN0YXRlNS5leHBvcnRBbGxTZWxlY3RlZE9wdGlvbnMsCiAgICAgICAgICBpc0luY2x1ZGVSZWZlcmVuY2VzRGVlcENoZWNrZWQgPSBfdGhpcyRzdGF0ZTUuaXNJbmNsdWRlUmVmZXJlbmNlc0RlZXBDaGVja2VkOwoKICAgICAgaWYgKCFpc1Nob3dpbmdFeHBvcnRBbGxPcHRpb25zTW9kYWwpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlPdmVybGF5TWFzaywgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aU1vZGFsLCB7CiAgICAgICAgb25DbG9zZTogdGhpcy5jbG9zZUV4cG9ydEFsbE1vZGFsCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlNb2RhbEhlYWRlciwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aU1vZGFsSGVhZGVyVGl0bGUsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5leHBvcnRPYmplY3RzQ29uZmlybU1vZGFsVGl0bGUiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXhwb3J0IHtmaWx0ZXJlZEl0ZW1Db3VudCwgcGx1cmFsLCBvbmV7IyBvYmplY3R9IG90aGVyIHsjIG9iamVjdHN9fSIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBmaWx0ZXJlZEl0ZW1Db3VudDogZmlsdGVyZWRJdGVtQ291bnQKICAgICAgICB9CiAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlNb2RhbEJvZHksIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgbGFiZWw6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmV4cG9ydE9iamVjdHNDb25maXJtTW9kYWxEZXNjcmlwdGlvbiIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNlbGVjdCB3aGljaCB0eXBlcyB0byBleHBvcnQiCiAgICAgICAgfSksCiAgICAgICAgbGFiZWxUeXBlOiAibGVnZW5kIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2hlY2tib3hHcm91cCwgewogICAgICAgIG9wdGlvbnM6IGV4cG9ydEFsbE9wdGlvbnMsCiAgICAgICAgaWRUb1NlbGVjdGVkTWFwOiBleHBvcnRBbGxTZWxlY3RlZE9wdGlvbnMsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKG9wdGlvbklkKSB7CiAgICAgICAgICB2YXIgbmV3RXhwb3J0QWxsU2VsZWN0ZWRPcHRpb25zID0gX29iamVjdFNwcmVhZCh7fSwgZXhwb3J0QWxsU2VsZWN0ZWRPcHRpb25zLCB7fSwgX2RlZmluZVByb3BlcnR5KHt9LCBvcHRpb25JZCwgIWV4cG9ydEFsbFNlbGVjdGVkT3B0aW9uc1tvcHRpb25JZF0pKTsKCiAgICAgICAgICBfdGhpczMuc2V0U3RhdGUoewogICAgICAgICAgICBleHBvcnRBbGxTZWxlY3RlZE9wdGlvbnM6IG5ld0V4cG9ydEFsbFNlbGVjdGVkT3B0aW9ucwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTd2l0Y2gsIHsKICAgICAgICBuYW1lOiAiaW5jbHVkZVJlZmVyZW5jZXNEZWVwIiwKICAgICAgICBsYWJlbDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZXhwb3J0T2JqZWN0c0NvbmZpcm1Nb2RhbC5pbmNsdWRlUmVmZXJlbmNlc0RlZXBMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkluY2x1ZGUgcmVsYXRlZCBvYmplY3RzIgogICAgICAgIH0pLAogICAgICAgIGNoZWNrZWQ6IGlzSW5jbHVkZVJlZmVyZW5jZXNEZWVwQ2hlY2tlZCwKICAgICAgICBvbkNoYW5nZTogdGhpcy5jaGFuZ2VJbmNsdWRlUmVmZXJlbmNlc0RlZXAKICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTW9kYWxGb290ZXIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBqdXN0aWZ5Q29udGVudDogImZsZXhFbmQiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25FbXB0eSwgewogICAgICAgIG9uQ2xpY2s6IHRoaXMuY2xvc2VFeHBvcnRBbGxNb2RhbAogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZXhwb3J0T2JqZWN0c0NvbmZpcm1Nb2RhbC5jYW5jZWxCdXR0b25MYWJlbCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDYW5jZWwiCiAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICBmaWxsOiB0cnVlLAogICAgICAgIG9uQ2xpY2s6IHRoaXMub25FeHBvcnRBbGwKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmV4cG9ydE9iamVjdHNDb25maXJtTW9kYWwuZXhwb3J0QWxsQnV0dG9uTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXhwb3J0IGFsbCIKICAgICAgfSkpKSkpKSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgX3RoaXMkc3RhdGU2ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIHNlbGVjdGVkU2F2ZWRPYmplY3RzID0gX3RoaXMkc3RhdGU2LnNlbGVjdGVkU2F2ZWRPYmplY3RzLAogICAgICAgICAgcGFnZSA9IF90aGlzJHN0YXRlNi5wYWdlLAogICAgICAgICAgcGVyUGFnZSA9IF90aGlzJHN0YXRlNi5wZXJQYWdlLAogICAgICAgICAgc2F2ZWRPYmplY3RzID0gX3RoaXMkc3RhdGU2LnNhdmVkT2JqZWN0cywKICAgICAgICAgIGZpbHRlcmVkSXRlbUNvdW50ID0gX3RoaXMkc3RhdGU2LmZpbHRlcmVkSXRlbUNvdW50LAogICAgICAgICAgaXNTZWFyY2hpbmcgPSBfdGhpcyRzdGF0ZTYuaXNTZWFyY2hpbmcsCiAgICAgICAgICBzYXZlZE9iamVjdENvdW50cyA9IF90aGlzJHN0YXRlNi5zYXZlZE9iamVjdENvdW50czsKICAgICAgdmFyIHNlbGVjdGlvbkNvbmZpZyA9IHsKICAgICAgICBvblNlbGVjdGlvbkNoYW5nZTogdGhpcy5vblNlbGVjdGlvbkNoYW5nZWQKICAgICAgfTsKICAgICAgdmFyIGZpbHRlck9wdGlvbnMgPSB0aGlzLnNhdmVkT2JqZWN0VHlwZXMubWFwKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHZhbHVlOiB0eXBlLAogICAgICAgICAgbmFtZTogdHlwZSwKICAgICAgICAgIHZpZXc6ICIiLmNvbmNhdCh0eXBlLCAiICgiKS5jb25jYXQoc2F2ZWRPYmplY3RDb3VudHNbdHlwZV0gfHwgMCwgIikiKQogICAgICAgIH07CiAgICAgIH0pOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhZ2VDb250ZW50LCB7CiAgICAgICAgaG9yaXpvbnRhbFBvc2l0aW9uOiAiY2VudGVyIgogICAgICB9LCB0aGlzLnJlbmRlckZseW91dCgpLCB0aGlzLnJlbmRlclJlbGF0aW9uc2hpcHMoKSwgdGhpcy5yZW5kZXJEZWxldGVDb25maXJtTW9kYWwoKSwgdGhpcy5yZW5kZXJFeHBvcnRBbGxPcHRpb25zTW9kYWwoKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfaGVhZGVyLkhlYWRlciwgewogICAgICAgIG9uRXhwb3J0QWxsOiBmdW5jdGlvbiBvbkV4cG9ydEFsbCgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczQuc2V0U3RhdGUoewogICAgICAgICAgICBpc1Nob3dpbmdFeHBvcnRBbGxPcHRpb25zTW9kYWw6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25JbXBvcnQ6IHRoaXMuc2hvd0ltcG9ydEZseW91dCwKICAgICAgICBvblJlZnJlc2g6IHRoaXMucmVmcmVzaERhdGEsCiAgICAgICAgZmlsdGVyZWRDb3VudDogZmlsdGVyZWRJdGVtQ291bnQKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAieHMiCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF90YWJsZS5UYWJsZSwgewogICAgICAgIGl0ZW1JZDogJ2lkJywKICAgICAgICBzZWxlY3Rpb25Db25maWc6IHNlbGVjdGlvbkNvbmZpZywKICAgICAgICBzZWxlY3RlZFNhdmVkT2JqZWN0czogc2VsZWN0ZWRTYXZlZE9iamVjdHMsCiAgICAgICAgb25RdWVyeUNoYW5nZTogdGhpcy5vblF1ZXJ5Q2hhbmdlLAogICAgICAgIG9uVGFibGVDaGFuZ2U6IHRoaXMub25UYWJsZUNoYW5nZSwKICAgICAgICBmaWx0ZXJPcHRpb25zOiBmaWx0ZXJPcHRpb25zLAogICAgICAgIG9uRXhwb3J0OiB0aGlzLm9uRXhwb3J0LAogICAgICAgIGNhbkRlbGV0ZTogdGhpcy5wcm9wcy51aUNhcGFiaWxpdGllcy5zYXZlZE9iamVjdHNNYW5hZ2VtZW50LmRlbGV0ZSwKICAgICAgICBvbkRlbGV0ZTogdGhpcy5vbkRlbGV0ZSwKICAgICAgICBnb0luc3BlY3RPYmplY3Q6IHRoaXMucHJvcHMuZ29JbnNwZWN0T2JqZWN0LAogICAgICAgIHBhZ2VJbmRleDogcGFnZSwKICAgICAgICBwYWdlU2l6ZTogcGVyUGFnZSwKICAgICAgICBpdGVtczogc2F2ZWRPYmplY3RzLAogICAgICAgIHRvdGFsSXRlbUNvdW50OiBmaWx0ZXJlZEl0ZW1Db3VudCwKICAgICAgICBpc1NlYXJjaGluZzogaXNTZWFyY2hpbmcsCiAgICAgICAgb25TaG93UmVsYXRpb25zaGlwczogdGhpcy5vblNob3dSZWxhdGlvbnNoaXBzLAogICAgICAgIGNhbkdvSW5BcHA6IHRoaXMucHJvcHMuY2FuR29JbkFwcAogICAgICB9KSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gT2JqZWN0c1RhYmxlOwp9KF9yZWFjdC5Db21wb25lbnQpOwoKZXhwb3J0cy5PYmplY3RzVGFibGUgPSBPYmplY3RzVGFibGU7CgpfZGVmaW5lUHJvcGVydHkoT2JqZWN0c1RhYmxlLCAicHJvcFR5cGVzIiwgewogIHNhdmVkT2JqZWN0c0NsaWVudDogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdC5pc1JlcXVpcmVkLAogIGluZGV4UGF0dGVybnM6IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QuaXNSZXF1aXJlZCwKICAkaHR0cDogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICBiYXNlUGF0aDogX3Byb3BUeXBlcy5kZWZhdWx0LnN0cmluZy5pc1JlcXVpcmVkLAogIHBlclBhZ2VDb25maWc6IF9wcm9wVHlwZXMuZGVmYXVsdC5udW1iZXIsCiAgbmV3SW5kZXhQYXR0ZXJuVXJsOiBfcHJvcFR5cGVzLmRlZmF1bHQuc3RyaW5nLmlzUmVxdWlyZWQsCiAgY29uZmlybU1vZGFsUHJvbWlzZTogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICBzZXJ2aWNlczogX3Byb3BUeXBlcy5kZWZhdWx0LmFycmF5LmlzUmVxdWlyZWQsCiAgdWlDYXBhYmlsaXRpZXM6IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QuaXNSZXF1aXJlZCwKICBnb0luc3BlY3RPYmplY3Q6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQsCiAgY2FuR29JbkFwcDogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZAp9KTs="},null]}