{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/ml/public/application/explorer/explorer_charts/explorer_charts_container_service.js","dependencies":[{"path":"x-pack/legacy/plugins/ml/public/application/explorer/explorer_charts/explorer_charts_container_service.js","mtime":1585205045728},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmdldERlZmF1bHRDaGFydHNEYXRhID0gZ2V0RGVmYXVsdENoYXJ0c0RhdGE7CmV4cG9ydHMuYW5vbWFseURhdGFDaGFuZ2UgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIF9leHBsb3Jlcl9jaGFydF9jb25maWdfYnVpbGRlciA9IHJlcXVpcmUoIi4vZXhwbG9yZXJfY2hhcnRfY29uZmlnX2J1aWxkZXIiKTsKCnZhciBfY2hhcnRfdXRpbHMgPSByZXF1aXJlKCIuLi8uLi91dGlsL2NoYXJ0X3V0aWxzIik7Cgp2YXIgX2Fub21hbHlfdXRpbHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vdXRpbC9hbm9tYWx5X3V0aWxzIik7Cgp2YXIgX2pvYl91dGlscyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvbW1vbi91dGlsL2pvYl91dGlscyIpOwoKdmFyIF9yZXN1bHRzX3NlcnZpY2UgPSByZXF1aXJlKCIuLi8uLi9zZXJ2aWNlcy9yZXN1bHRzX3NlcnZpY2UiKTsKCnZhciBfam9iX3NlcnZpY2UgPSByZXF1aXJlKCIuLi8uLi9zZXJ2aWNlcy9qb2Jfc2VydmljZSIpOwoKdmFyIF9sZWdhY3lfdXRpbHMgPSByZXF1aXJlKCIuLi9sZWdhY3lfdXRpbHMiKTsKCnZhciBfZXhwbG9yZXJfZGFzaGJvYXJkX3NlcnZpY2UgPSByZXF1aXJlKCIuLi9leHBsb3Jlcl9kYXNoYm9hcmRfc2VydmljZSIpOwoKdmFyIF9leHBsb3Jlcl9jb25zdGFudHMgPSByZXF1aXJlKCIuLi9leHBsb3Jlcl9jb25zdGFudHMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CgpmdW5jdGlvbiBnZXREZWZhdWx0Q2hhcnRzRGF0YSgpIHsKICByZXR1cm4gewogICAgY2hhcnRzUGVyUm93OiAxLAogICAgc2VyaWVzVG9QbG90OiBbXSwKICAgIC8vIGRlZmF1bHQgdmFsdWVzLCB3aWxsIHVwZGF0ZSBvbiBldmVyeSByZS1yZW5kZXIKICAgIHRvb01hbnlCdWNrZXRzOiBmYWxzZSwKICAgIHRpbWVGaWVsZE5hbWU6ICd0aW1lc3RhbXAnCiAgfTsKfQoKdmFyIENIQVJUX01BWF9QT0lOVFMgPSA1MDA7CnZhciBBTk9NQUxJRVNfTUFYX1JFU1VMVFMgPSA1MDA7CnZhciBNQVhfU0NIRURVTEVEX0VWRU5UUyA9IDEwOyAvLyBNYXggbnVtYmVyIG9mIHNjaGVkdWxlZCBldmVudHMgZGlzcGxheWVkIHBlciBidWNrZXQuCgp2YXIgTUxfVElNRV9GSUVMRF9OQU1FID0gJ3RpbWVzdGFtcCc7CnZhciBVU0VfT1ZFUkFMTF9DSEFSVF9MSU1JVFMgPSBmYWxzZTsKdmFyIE1BWF9DSEFSVFNfUEVSX1JPVyA9IDQ7IC8vIGNhbGxiYWNrKGdldERlZmF1bHRDaGFydHNEYXRhKCkpOwoKdmFyIGFub21hbHlEYXRhQ2hhbmdlID0gZnVuY3Rpb24gYW5vbWFseURhdGFDaGFuZ2UoYW5vbWFseVJlY29yZHMsIGVhcmxpZXN0TXMsIGxhdGVzdE1zKSB7CiAgdmFyIHNldmVyaXR5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiAwOwogIHZhciBkYXRhID0gZ2V0RGVmYXVsdENoYXJ0c0RhdGEoKTsKICB2YXIgZmlsdGVyZWRSZWNvcmRzID0gYW5vbWFseVJlY29yZHMuZmlsdGVyKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgIHJldHVybiBOdW1iZXIocmVjb3JkLnJlY29yZF9zY29yZSkgPj0gc2V2ZXJpdHk7CiAgfSk7CiAgdmFyIGFsbFNlcmllc1JlY29yZHMgPSBwcm9jZXNzUmVjb3Jkc0ZvckRpc3BsYXkoZmlsdGVyZWRSZWNvcmRzKTsgLy8gQ2FsY3VsYXRlIHRoZSBudW1iZXIgb2YgY2hhcnRzIHBlciByb3csIGRlcGVuZGluZyBvbiB0aGUgd2lkdGggYXZhaWxhYmxlLCB0byBhIG1heCBvZiA0LgoKICB2YXIgY2hhcnRzQ29udGFpbmVyV2lkdGggPSAoMCwgX2xlZ2FjeV91dGlscy5nZXRDaGFydENvbnRhaW5lcldpZHRoKSgpOwogIHZhciBjaGFydHNQZXJSb3cgPSBNYXRoLm1pbihNYXRoLm1heChNYXRoLmZsb29yKGNoYXJ0c0NvbnRhaW5lcldpZHRoIC8gNTUwKSwgMSksIE1BWF9DSEFSVFNfUEVSX1JPVyk7CgogIGlmIChhbGxTZXJpZXNSZWNvcmRzLmxlbmd0aCA9PT0gMSkgewogICAgY2hhcnRzUGVyUm93ID0gMTsKICB9CgogIGRhdGEuY2hhcnRzUGVyUm93ID0gY2hhcnRzUGVyUm93OyAvLyBCdWlsZCB0aGUgZGF0YSBjb25maWdzIG9mIHRoZSBhbm9tYWxpZXMgdG8gYmUgZGlzcGxheWVkLgogIC8vIFRPRE8gLSBpbXBsZW1lbnQgcGFnaW5nPwogIC8vIEZvciBub3cganVzdCB0YWtlIGZpcnN0IDYgKG9yIDggaWYgNCBjaGFydHMgcGVyIHJvdykuCgogIHZhciBtYXhTZXJpZXNUb1Bsb3QgPSBNYXRoLm1heChjaGFydHNQZXJSb3cgKiAyLCA2KTsKICB2YXIgcmVjb3Jkc1RvUGxvdCA9IGFsbFNlcmllc1JlY29yZHMuc2xpY2UoMCwgbWF4U2VyaWVzVG9QbG90KTsKICB2YXIgc2VyaWVzQ29uZmlncyA9IHJlY29yZHNUb1Bsb3QubWFwKF9leHBsb3Jlcl9jaGFydF9jb25maWdfYnVpbGRlci5idWlsZENvbmZpZyk7IC8vIENhbGN1bGF0ZSB0aGUgdGltZSByYW5nZSBvZiB0aGUgY2hhcnRzLCB3aGljaCBpcyBhIGZ1bmN0aW9uIG9mIHRoZSBjaGFydCB3aWR0aCBhbmQgbWF4IGpvYiBidWNrZXQgc3Bhbi4KCiAgZGF0YS50b29NYW55QnVja2V0cyA9IGZhbHNlOwogIHZhciBjaGFydFdpZHRoID0gTWF0aC5mbG9vcihjaGFydHNDb250YWluZXJXaWR0aCAvIGNoYXJ0c1BlclJvdyk7CgogIHZhciBfY2FsY3VsYXRlQ2hhcnRSYW5nZSA9IGNhbGN1bGF0ZUNoYXJ0UmFuZ2Uoc2VyaWVzQ29uZmlncywgZWFybGllc3RNcywgbGF0ZXN0TXMsIGNoYXJ0V2lkdGgsIHJlY29yZHNUb1Bsb3QsIGRhdGEudGltZUZpZWxkTmFtZSksCiAgICAgIGNoYXJ0UmFuZ2UgPSBfY2FsY3VsYXRlQ2hhcnRSYW5nZS5jaGFydFJhbmdlLAogICAgICB0b29NYW55QnVja2V0cyA9IF9jYWxjdWxhdGVDaGFydFJhbmdlLnRvb01hbnlCdWNrZXRzOwoKICBkYXRhLnRvb01hbnlCdWNrZXRzID0gdG9vTWFueUJ1Y2tldHM7IC8vIGluaXRpYWxpemUgdGhlIGNoYXJ0cyB3aXRoIGxvYWRpbmcgaW5kaWNhdG9ycwoKICBkYXRhLnNlcmllc1RvUGxvdCA9IHNlcmllc0NvbmZpZ3MubWFwKGZ1bmN0aW9uIChjb25maWcpIHsKICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBjb25maWcsIHsKICAgICAgbG9hZGluZzogdHJ1ZSwKICAgICAgY2hhcnREYXRhOiBudWxsCiAgICB9KTsKICB9KTsKCiAgX2V4cGxvcmVyX2Rhc2hib2FyZF9zZXJ2aWNlLmV4cGxvcmVyU2VydmljZS5zZXRDaGFydHMoX29iamVjdFNwcmVhZCh7fSwgZGF0YSkpOwoKICBpZiAoc2VyaWVzQ29uZmlncy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybjsKICB9IC8vIFF1ZXJ5IDEgLSBsb2FkIHRoZSByYXcgbWV0cmljIGRhdGEuCgoKICBmdW5jdGlvbiBnZXRNZXRyaWNEYXRhKGNvbmZpZywgcmFuZ2UpIHsKICAgIHZhciBqb2JJZCA9IGNvbmZpZy5qb2JJZCwKICAgICAgICBkZXRlY3RvckluZGV4ID0gY29uZmlnLmRldGVjdG9ySW5kZXgsCiAgICAgICAgZW50aXR5RmllbGRzID0gY29uZmlnLmVudGl0eUZpZWxkcywKICAgICAgICBpbnRlcnZhbCA9IGNvbmZpZy5pbnRlcnZhbDsKCiAgICB2YXIgam9iID0gX2pvYl9zZXJ2aWNlLm1sSm9iU2VydmljZS5nZXRKb2Ioam9iSWQpOyAvLyBJZiBzb3VyY2UgZGF0YSBjYW4gYmUgcGxvdHRlZCwgdXNlIHRoYXQsIG90aGVyd2lzZSBtb2RlbCBwbG90IHdpbGwgYmUgYXZhaWxhYmxlLgoKCiAgICB2YXIgdXNlU291cmNlRGF0YSA9ICgwLCBfam9iX3V0aWxzLmlzU291cmNlRGF0YUNoYXJ0YWJsZUZvckRldGVjdG9yKShqb2IsIGRldGVjdG9ySW5kZXgpOwoKICAgIGlmICh1c2VTb3VyY2VEYXRhID09PSB0cnVlKSB7CiAgICAgIHZhciBkYXRhZmVlZFF1ZXJ5ID0gX2xvZGFzaC5kZWZhdWx0LmdldChjb25maWcsICdkYXRhZmVlZENvbmZpZy5xdWVyeScsIG51bGwpOwoKICAgICAgcmV0dXJuIF9yZXN1bHRzX3NlcnZpY2UubWxSZXN1bHRzU2VydmljZS5nZXRNZXRyaWNEYXRhKGNvbmZpZy5kYXRhZmVlZENvbmZpZy5pbmRpY2VzLCBjb25maWcuZW50aXR5RmllbGRzLCBkYXRhZmVlZFF1ZXJ5LCBjb25maWcubWV0cmljRnVuY3Rpb24sIGNvbmZpZy5tZXRyaWNGaWVsZE5hbWUsIGNvbmZpZy50aW1lRmllbGQsIHJhbmdlLm1pbiwgcmFuZ2UubWF4LCBjb25maWcuaW50ZXJ2YWwpLnRvUHJvbWlzZSgpOwogICAgfSBlbHNlIHsKICAgICAgLy8gRXh0cmFjdCB0aGUgcGFydGl0aW9uLCBieSwgb3ZlciBmaWVsZHMgb24gd2hpY2ggdG8gZmlsdGVyLgogICAgICB2YXIgY3JpdGVyaWFGaWVsZHMgPSBbXTsKICAgICAgdmFyIGRldGVjdG9yID0gam9iLmFuYWx5c2lzX2NvbmZpZy5kZXRlY3RvcnNbZGV0ZWN0b3JJbmRleF07CgogICAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmhhcyhkZXRlY3RvciwgJ3BhcnRpdGlvbl9maWVsZF9uYW1lJykpIHsKICAgICAgICB2YXIgcGFydGl0aW9uRW50aXR5ID0gX2xvZGFzaC5kZWZhdWx0LmZpbmQoZW50aXR5RmllbGRzLCB7CiAgICAgICAgICBmaWVsZE5hbWU6IGRldGVjdG9yLnBhcnRpdGlvbl9maWVsZF9uYW1lCiAgICAgICAgfSk7CgogICAgICAgIGlmIChwYXJ0aXRpb25FbnRpdHkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY3JpdGVyaWFGaWVsZHMucHVzaCh7CiAgICAgICAgICAgIGZpZWxkTmFtZTogJ3BhcnRpdGlvbl9maWVsZF9uYW1lJywKICAgICAgICAgICAgZmllbGRWYWx1ZTogcGFydGl0aW9uRW50aXR5LmZpZWxkTmFtZQogICAgICAgICAgfSwgewogICAgICAgICAgICBmaWVsZE5hbWU6ICdwYXJ0aXRpb25fZmllbGRfdmFsdWUnLAogICAgICAgICAgICBmaWVsZFZhbHVlOiBwYXJ0aXRpb25FbnRpdHkuZmllbGRWYWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmhhcyhkZXRlY3RvciwgJ292ZXJfZmllbGRfbmFtZScpKSB7CiAgICAgICAgdmFyIG92ZXJFbnRpdHkgPSBfbG9kYXNoLmRlZmF1bHQuZmluZChlbnRpdHlGaWVsZHMsIHsKICAgICAgICAgIGZpZWxkTmFtZTogZGV0ZWN0b3Iub3Zlcl9maWVsZF9uYW1lCiAgICAgICAgfSk7CgogICAgICAgIGlmIChvdmVyRW50aXR5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNyaXRlcmlhRmllbGRzLnB1c2goewogICAgICAgICAgICBmaWVsZE5hbWU6ICdvdmVyX2ZpZWxkX25hbWUnLAogICAgICAgICAgICBmaWVsZFZhbHVlOiBvdmVyRW50aXR5LmZpZWxkTmFtZQogICAgICAgICAgfSwgewogICAgICAgICAgICBmaWVsZE5hbWU6ICdvdmVyX2ZpZWxkX3ZhbHVlJywKICAgICAgICAgICAgZmllbGRWYWx1ZTogb3ZlckVudGl0eS5maWVsZFZhbHVlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChfbG9kYXNoLmRlZmF1bHQuaGFzKGRldGVjdG9yLCAnYnlfZmllbGRfbmFtZScpKSB7CiAgICAgICAgdmFyIGJ5RW50aXR5ID0gX2xvZGFzaC5kZWZhdWx0LmZpbmQoZW50aXR5RmllbGRzLCB7CiAgICAgICAgICBmaWVsZE5hbWU6IGRldGVjdG9yLmJ5X2ZpZWxkX25hbWUKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGJ5RW50aXR5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNyaXRlcmlhRmllbGRzLnB1c2goewogICAgICAgICAgICBmaWVsZE5hbWU6ICdieV9maWVsZF9uYW1lJywKICAgICAgICAgICAgZmllbGRWYWx1ZTogYnlFbnRpdHkuZmllbGROYW1lCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGZpZWxkTmFtZTogJ2J5X2ZpZWxkX3ZhbHVlJywKICAgICAgICAgICAgZmllbGRWYWx1ZTogYnlFbnRpdHkuZmllbGRWYWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciBvYmogPSB7CiAgICAgICAgICBzdWNjZXNzOiB0cnVlLAogICAgICAgICAgcmVzdWx0czoge30KICAgICAgICB9OwogICAgICAgIHJldHVybiBfcmVzdWx0c19zZXJ2aWNlLm1sUmVzdWx0c1NlcnZpY2UuZ2V0TW9kZWxQbG90T3V0cHV0KGpvYklkLCBkZXRlY3RvckluZGV4LCBjcml0ZXJpYUZpZWxkcywgcmFuZ2UubWluLCByYW5nZS5tYXgsIGludGVydmFsKS50b1Byb21pc2UoKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICAvLyBSZXR1cm4gZGF0YSBpbiBmb3JtYXQgcmVxdWlyZWQgYnkgdGhlIGV4cGxvcmVyIGNoYXJ0cy4KICAgICAgICAgIHZhciByZXN1bHRzID0gcmVzcC5yZXN1bHRzOwogICAgICAgICAgT2JqZWN0LmtleXMocmVzdWx0cykuZm9yRWFjaChmdW5jdGlvbiAodGltZSkgewogICAgICAgICAgICBvYmoucmVzdWx0c1t0aW1lXSA9IHJlc3VsdHNbdGltZV0uYWN0dWFsOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXNvbHZlKG9iaik7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgIHJlamVjdChyZXNwKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSAvLyBRdWVyeSAyIC0gbG9hZCB0aGUgYW5vbWFsaWVzLgogIC8vIENyaXRlcmlhIHRvIHJldHVybiB0aGUgcmVjb3JkcyBmb3IgdGhpcyBzZXJpZXMgYXJlIHRoZSBkZXRlY3Rvcl9pbmRleCBwbHVzCiAgLy8gdGhlIHNwZWNpZmljIGNvbWJpbmF0aW9uIG9mICdlbnRpdHknIGZpZWxkcyBpLmUuIHRoZSBwYXJ0aXRpb24gLyBieSAvIG92ZXIgZmllbGRzLgoKCiAgZnVuY3Rpb24gZ2V0UmVjb3Jkc0ZvckNyaXRlcmlhKGNvbmZpZywgcmFuZ2UpIHsKICAgIHZhciBjcml0ZXJpYSA9IFtdOwogICAgY3JpdGVyaWEucHVzaCh7CiAgICAgIGZpZWxkTmFtZTogJ2RldGVjdG9yX2luZGV4JywKICAgICAgZmllbGRWYWx1ZTogY29uZmlnLmRldGVjdG9ySW5kZXgKICAgIH0pOwogICAgY3JpdGVyaWEgPSBjcml0ZXJpYS5jb25jYXQoY29uZmlnLmVudGl0eUZpZWxkcyk7CiAgICByZXR1cm4gX3Jlc3VsdHNfc2VydmljZS5tbFJlc3VsdHNTZXJ2aWNlLmdldFJlY29yZHNGb3JDcml0ZXJpYShbY29uZmlnLmpvYklkXSwgY3JpdGVyaWEsIDAsIHJhbmdlLm1pbiwgcmFuZ2UubWF4LCBBTk9NQUxJRVNfTUFYX1JFU1VMVFMpLnRvUHJvbWlzZSgpOwogIH0gLy8gUXVlcnkgMyAtIGxvYWQgYW55IHNjaGVkdWxlZCBldmVudHMgZm9yIHRoZSBqb2IuCgoKICBmdW5jdGlvbiBnZXRTY2hlZHVsZWRFdmVudHMoY29uZmlnLCByYW5nZSkgewogICAgcmV0dXJuIF9yZXN1bHRzX3NlcnZpY2UubWxSZXN1bHRzU2VydmljZS5nZXRTY2hlZHVsZWRFdmVudHNCeUJ1Y2tldChbY29uZmlnLmpvYklkXSwgcmFuZ2UubWluLCByYW5nZS5tYXgsIGNvbmZpZy5pbnRlcnZhbCwgMSwgTUFYX1NDSEVEVUxFRF9FVkVOVFMpLnRvUHJvbWlzZSgpOwogIH0gLy8gUXVlcnkgNCAtIGxvYWQgY29udGV4dCBkYXRhIGRpc3RyaWJ1dGlvbgoKCiAgZnVuY3Rpb24gZ2V0RXZlbnREaXN0cmlidXRpb24oY29uZmlnLCByYW5nZSkgewogICAgdmFyIGNoYXJ0VHlwZSA9ICgwLCBfY2hhcnRfdXRpbHMuZ2V0Q2hhcnRUeXBlKShjb25maWcpOwogICAgdmFyIHNwbGl0RmllbGQ7CiAgICB2YXIgZmlsdGVyRmllbGQgPSBudWxsOyAvLyBEZWZpbmUgc3BsaXRGaWVsZCBhbmQgZmlsdGVyRmllbGQgYmFzZWQgb24gY2hhcnRUeXBlCgogICAgaWYgKGNoYXJ0VHlwZSA9PT0gX2V4cGxvcmVyX2NvbnN0YW50cy5DSEFSVF9UWVBFLkVWRU5UX0RJU1RSSUJVVElPTikgewogICAgICBzcGxpdEZpZWxkID0gY29uZmlnLmVudGl0eUZpZWxkcy5maW5kKGZ1bmN0aW9uIChmKSB7CiAgICAgICAgcmV0dXJuIGYuZmllbGRUeXBlID09PSAnYnknOwogICAgICB9KTsKICAgICAgZmlsdGVyRmllbGQgPSBjb25maWcuZW50aXR5RmllbGRzLmZpbmQoZnVuY3Rpb24gKGYpIHsKICAgICAgICByZXR1cm4gZi5maWVsZFR5cGUgPT09ICdwYXJ0aXRpb24nOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoY2hhcnRUeXBlID09PSBfZXhwbG9yZXJfY29uc3RhbnRzLkNIQVJUX1RZUEUuUE9QVUxBVElPTl9ESVNUUklCVVRJT04pIHsKICAgICAgc3BsaXRGaWVsZCA9IGNvbmZpZy5lbnRpdHlGaWVsZHMuZmluZChmdW5jdGlvbiAoZikgewogICAgICAgIHJldHVybiBmLmZpZWxkVHlwZSA9PT0gJ292ZXInOwogICAgICB9KTsKICAgICAgZmlsdGVyRmllbGQgPSBjb25maWcuZW50aXR5RmllbGRzLmZpbmQoZnVuY3Rpb24gKGYpIHsKICAgICAgICByZXR1cm4gZi5maWVsZFR5cGUgPT09ICdwYXJ0aXRpb24nOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgZGF0YWZlZWRRdWVyeSA9IF9sb2Rhc2guZGVmYXVsdC5nZXQoY29uZmlnLCAnZGF0YWZlZWRDb25maWcucXVlcnknLCBudWxsKTsKCiAgICByZXR1cm4gX3Jlc3VsdHNfc2VydmljZS5tbFJlc3VsdHNTZXJ2aWNlLmdldEV2ZW50RGlzdHJpYnV0aW9uRGF0YShjb25maWcuZGF0YWZlZWRDb25maWcuaW5kaWNlcywgc3BsaXRGaWVsZCwgZmlsdGVyRmllbGQsIGRhdGFmZWVkUXVlcnksIGNvbmZpZy5tZXRyaWNGdW5jdGlvbiwgY29uZmlnLm1ldHJpY0ZpZWxkTmFtZSwgY29uZmlnLnRpbWVGaWVsZCwgcmFuZ2UubWluLCByYW5nZS5tYXgsIGNvbmZpZy5pbnRlcnZhbCk7CiAgfSAvLyBmaXJzdCBsb2FkIGFuZCB3YWl0IGZvciByZXF1aXJlZCBkYXRhLAogIC8vIG9ubHkgYWZ0ZXIgdGhhdCB0cmlnZ2VyIGRhdGEgcHJvY2Vzc2luZyBhbmQgcGFnZSByZW5kZXIuCiAgLy8gVE9ETyAtIGlmIHF1ZXJ5IHJldHVybnMgbm8gcmVzdWx0cyBlLmcuIHNvdXJjZSBkYXRhIGhhcyBiZWVuIGRlbGV0ZWQsCiAgLy8gZGlzcGxheSBhIG1lc3NhZ2Ugc2F5aW5nICdObyBkYXRhIGJldHdlZW4gZWFybGllc3QvbGF0ZXN0Jy4KCgogIHZhciBzZXJpZXNQcm9taXNlcyA9IHNlcmllc0NvbmZpZ3MubWFwKGZ1bmN0aW9uIChzZXJpZXNDb25maWcpIHsKICAgIHJldHVybiBQcm9taXNlLmFsbChbZ2V0TWV0cmljRGF0YShzZXJpZXNDb25maWcsIGNoYXJ0UmFuZ2UpLCBnZXRSZWNvcmRzRm9yQ3JpdGVyaWEoc2VyaWVzQ29uZmlnLCBjaGFydFJhbmdlKSwgZ2V0U2NoZWR1bGVkRXZlbnRzKHNlcmllc0NvbmZpZywgY2hhcnRSYW5nZSksIGdldEV2ZW50RGlzdHJpYnV0aW9uKHNlcmllc0NvbmZpZywgY2hhcnRSYW5nZSldKTsKICB9KTsKCiAgZnVuY3Rpb24gcHJvY2Vzc0NoYXJ0RGF0YShyZXNwb25zZSwgc2VyaWVzSW5kZXgpIHsKICAgIHZhciBtZXRyaWNEYXRhID0gcmVzcG9uc2VbMF0ucmVzdWx0czsKICAgIHZhciByZWNvcmRzID0gcmVzcG9uc2VbMV0ucmVjb3JkczsKICAgIHZhciBqb2JJZCA9IHNlcmllc0NvbmZpZ3Nbc2VyaWVzSW5kZXhdLmpvYklkOwogICAgdmFyIHNjaGVkdWxlZEV2ZW50cyA9IHJlc3BvbnNlWzJdLmV2ZW50c1tqb2JJZF07CiAgICB2YXIgZXZlbnREaXN0cmlidXRpb24gPSByZXNwb25zZVszXTsKICAgIHZhciBjaGFydFR5cGUgPSAoMCwgX2NoYXJ0X3V0aWxzLmdldENoYXJ0VHlwZSkoc2VyaWVzQ29uZmlnc1tzZXJpZXNJbmRleF0pOyAvLyBTb3J0IHJlY29yZHMgaW4gYXNjZW5kaW5nIHRpbWUgb3JkZXIgbWF0Y2hpbmcgdXAgd2l0aCBjaGFydCBkYXRhCgogICAgcmVjb3Jkcy5zb3J0KGZ1bmN0aW9uIChyZWNvcmRBLCByZWNvcmRCKSB7CiAgICAgIHJldHVybiByZWNvcmRBW01MX1RJTUVfRklFTERfTkFNRV0gLSByZWNvcmRCW01MX1RJTUVfRklFTERfTkFNRV07CiAgICB9KTsgLy8gUmV0dXJuIGRhdGFzZXQgaW4gZm9ybWF0IHVzZWQgYnkgdGhlIGNoYXJ0LgogICAgLy8gaS5lLiBhcnJheSBvZiBPYmplY3RzIHdpdGgga2V5cyBkYXRlICh0aW1lc3RhbXApLCB2YWx1ZSwKICAgIC8vICAgIHBsdXMgYW5vbWFseVNjb3JlIGZvciBwb2ludHMgd2l0aCBhbm9tYWx5IG1hcmtlcnMuCgogICAgdmFyIGNoYXJ0RGF0YSA9IFtdOwoKICAgIGlmIChtZXRyaWNEYXRhICE9PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKGV2ZW50RGlzdHJpYnV0aW9uLmxlbmd0aCA+IDAgJiYgcmVjb3Jkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGZpbHRlckZpZWxkID0gcmVjb3Jkc1swXS5ieV9maWVsZF92YWx1ZSB8fCByZWNvcmRzWzBdLm92ZXJfZmllbGRfdmFsdWU7CiAgICAgICAgY2hhcnREYXRhID0gZXZlbnREaXN0cmlidXRpb24uZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICByZXR1cm4gZC5lbnRpdHkgIT09IGZpbHRlckZpZWxkOwogICAgICAgIH0pOwoKICAgICAgICBfbG9kYXNoLmRlZmF1bHQubWFwKG1ldHJpY0RhdGEsIGZ1bmN0aW9uICh2YWx1ZSwgdGltZSkgewogICAgICAgICAgLy8gVGhlIGZpbHRlcmluZyBmb3IgcmFyZS9ldmVudF9kaXN0cmlidXRpb24gY2hhcnRzIG5lZWRzIHRvIGJlIGhhbmRsZWQKICAgICAgICAgIC8vIGRpZmZlcmVudGx5IGJlY2F1c2Ugb2YgaG93IHRoZSBzb3VyY2UgZGF0YSBpcyBzdHJ1Y3R1cmVkLgogICAgICAgICAgLy8gRm9yIHJhcmUgY2hhcnQgdmFsdWVzIHdlIGFyZSBvbmx5IGludGVyZXN0ZWQgd2V0aGVyIGEgdmFsdWUgaXMgZWl0aGVyIGAwYCBvciBub3QsCiAgICAgICAgICAvLyBgMGAgYWN0cyBsaWtlIGEgZmxhZyBpbiB0aGUgY2hhcnQgd2hldGhlciB0byBkaXNwbGF5IHRoZSBkb3QvbWFya2VyLgogICAgICAgICAgLy8gQWxsIG90aGVyIGNoYXJ0cyAoc2luZ2xlIG1ldHJpYywgcG9wdWxhdGlvbikgYXJlIG1ldHJpYyBiYXNlZCBhbmQgd2l0aAogICAgICAgICAgLy8gdGhvc2UgYSB2YWx1ZSBvZiBgbnVsbGAgYWN0cyBhcyB0aGUgZmxhZyB0byBoaWRlIGEgZGF0YSBwb2ludC4KICAgICAgICAgIGlmIChjaGFydFR5cGUgPT09IF9leHBsb3Jlcl9jb25zdGFudHMuQ0hBUlRfVFlQRS5FVkVOVF9ESVNUUklCVVRJT04gJiYgdmFsdWUgPiAwIHx8IGNoYXJ0VHlwZSAhPT0gX2V4cGxvcmVyX2NvbnN0YW50cy5DSEFSVF9UWVBFLkVWRU5UX0RJU1RSSUJVVElPTiAmJiB2YWx1ZSAhPT0gbnVsbCkgewogICAgICAgICAgICBjaGFydERhdGEucHVzaCh7CiAgICAgICAgICAgICAgZGF0ZTogK3RpbWUsCiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgIGVudGl0eTogZmlsdGVyRmllbGQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2hhcnREYXRhID0gX2xvZGFzaC5kZWZhdWx0Lm1hcChtZXRyaWNEYXRhLCBmdW5jdGlvbiAodmFsdWUsIHRpbWUpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRhdGU6ICt0aW1lLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gLy8gSXRlcmF0ZSB0aHJvdWdoIHRoZSBhbm9tYWx5IHJlY29yZHMsIGFkZGluZyBhbm9tYWx5U2NvcmUgcHJvcGVydGllcwogICAgLy8gdG8gdGhlIGNoYXJ0RGF0YSBlbnRyaWVzIGZvciBhbm9tYWxvdXMgYnVja2V0cy4KCgogICAgdmFyIGNoYXJ0RGF0YUZvclBvaW50U2VhcmNoID0gZ2V0Q2hhcnREYXRhRm9yUG9pbnRTZWFyY2goY2hhcnREYXRhLCByZWNvcmRzWzBdLCBjaGFydFR5cGUpOwoKICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKHJlY29yZHMsIGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgLy8gTG9vayBmb3IgYSBjaGFydCBwb2ludCB3aXRoIHRoZSBzYW1lIHRpbWUgYXMgdGhlIHJlY29yZC4KICAgICAgLy8gSWYgbm9uZSBmb3VuZCwgaW5zZXJ0IGEgcG9pbnQgZm9yIGFub21hbGllcyBkdWUgdG8gYSBnYXAgaW4gdGhlIGRhdGEuCiAgICAgIHZhciByZWNvcmRUaW1lID0gcmVjb3JkW01MX1RJTUVfRklFTERfTkFNRV07CiAgICAgIHZhciBjaGFydFBvaW50ID0gZmluZENoYXJ0UG9pbnRGb3JUaW1lKGNoYXJ0RGF0YUZvclBvaW50U2VhcmNoLCByZWNvcmRUaW1lKTsKCiAgICAgIGlmIChjaGFydFBvaW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICBjaGFydFBvaW50ID0gewogICAgICAgICAgZGF0ZTogbmV3IERhdGUocmVjb3JkVGltZSksCiAgICAgICAgICB2YWx1ZTogbnVsbAogICAgICAgIH07CiAgICAgICAgY2hhcnREYXRhLnB1c2goY2hhcnRQb2ludCk7CiAgICAgIH0KCiAgICAgIGNoYXJ0UG9pbnQuYW5vbWFseVNjb3JlID0gcmVjb3JkLnJlY29yZF9zY29yZTsKCiAgICAgIGlmIChyZWNvcmQuYWN0dWFsICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBjaGFydFBvaW50LmFjdHVhbCA9IHJlY29yZC5hY3R1YWw7CiAgICAgICAgY2hhcnRQb2ludC50eXBpY2FsID0gcmVjb3JkLnR5cGljYWw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGNhdXNlcyA9IF9sb2Rhc2guZGVmYXVsdC5nZXQocmVjb3JkLCAnY2F1c2VzJywgW10pOwoKICAgICAgICBpZiAoY2F1c2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNoYXJ0UG9pbnQuYnlGaWVsZE5hbWUgPSByZWNvcmQuYnlfZmllbGRfbmFtZTsKICAgICAgICAgIGNoYXJ0UG9pbnQubnVtYmVyT2ZDYXVzZXMgPSBjYXVzZXMubGVuZ3RoOwoKICAgICAgICAgIGlmIChjYXVzZXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIC8vIElmIG9ubHkgYSBzaW5nbGUgY2F1c2UsIGNvcHkgYWN0dWFsIGFuZCB0eXBpY2FsIHZhbHVlcyB0byB0aGUgdG9wIGxldmVsLgogICAgICAgICAgICB2YXIgY2F1c2UgPSBfbG9kYXNoLmRlZmF1bHQuZmlyc3QocmVjb3JkLmNhdXNlcyk7CgogICAgICAgICAgICBjaGFydFBvaW50LmFjdHVhbCA9IGNhdXNlLmFjdHVhbDsKICAgICAgICAgICAgY2hhcnRQb2ludC50eXBpY2FsID0gY2F1c2UudHlwaWNhbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChyZWNvcmQubXVsdGlfYnVja2V0X2ltcGFjdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY2hhcnRQb2ludC5tdWx0aUJ1Y2tldEltcGFjdCA9IHJlY29yZC5tdWx0aV9idWNrZXRfaW1wYWN0OwogICAgICB9CiAgICB9KTsgLy8gQWRkIGEgc2NoZWR1bGVkRXZlbnRzIHByb3BlcnR5IHRvIGFueSBwb2ludHMgaW4gdGhlIGNoYXJ0IGRhdGEgc2V0CiAgICAvLyB3aGljaCBjb3JyZXNwb25kIHRvIHRpbWVzIG9mIHNjaGVkdWxlZCBldmVudHMgZm9yIHRoZSBqb2IuCgoKICAgIGlmIChzY2hlZHVsZWRFdmVudHMgIT09IHVuZGVmaW5lZCkgewogICAgICBfbG9kYXNoLmRlZmF1bHQuZWFjaChzY2hlZHVsZWRFdmVudHMsIGZ1bmN0aW9uIChldmVudHMsIHRpbWUpIHsKICAgICAgICB2YXIgY2hhcnRQb2ludCA9IGZpbmRDaGFydFBvaW50Rm9yVGltZShjaGFydERhdGFGb3JQb2ludFNlYXJjaCwgTnVtYmVyKHRpbWUpKTsKCiAgICAgICAgaWYgKGNoYXJ0UG9pbnQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gTm90ZSBpZiB0aGUgc2NoZWR1bGVkIGV2ZW50IGNvaW5jaWRlcyB3aXRoIGFuIGFic2VuY2Ugb2YgdGhlIHVuZGVybHlpbmcgbWV0cmljIGRhdGEsCiAgICAgICAgICAvLyB3ZSBkb24ndCB3b3JyeSBhYm91dCBwbG90dGluZyB0aGUgZXZlbnQuCiAgICAgICAgICBjaGFydFBvaW50LnNjaGVkdWxlZEV2ZW50cyA9IGV2ZW50czsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBjaGFydERhdGE7CiAgfQoKICBmdW5jdGlvbiBnZXRDaGFydERhdGFGb3JQb2ludFNlYXJjaChjaGFydERhdGEsIHJlY29yZCwgY2hhcnRUeXBlKSB7CiAgICBpZiAoY2hhcnRUeXBlID09PSBfZXhwbG9yZXJfY29uc3RhbnRzLkNIQVJUX1RZUEUuRVZFTlRfRElTVFJJQlVUSU9OIHx8IGNoYXJ0VHlwZSA9PT0gX2V4cGxvcmVyX2NvbnN0YW50cy5DSEFSVF9UWVBFLlBPUFVMQVRJT05fRElTVFJJQlVUSU9OKSB7CiAgICAgIHJldHVybiBjaGFydERhdGEuZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgcmV0dXJuIGQuZW50aXR5ID09PSAocmVjb3JkICYmIChyZWNvcmQuYnlfZmllbGRfdmFsdWUgfHwgcmVjb3JkLm92ZXJfZmllbGRfdmFsdWUpKTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIGNoYXJ0RGF0YTsKICB9CgogIGZ1bmN0aW9uIGZpbmRDaGFydFBvaW50Rm9yVGltZShjaGFydERhdGEsIHRpbWUpIHsKICAgIHJldHVybiBjaGFydERhdGEuZmluZChmdW5jdGlvbiAocG9pbnQpIHsKICAgICAgcmV0dXJuIHBvaW50LmRhdGUgPT09IHRpbWU7CiAgICB9KTsKICB9CgogIFByb21pc2UuYWxsKHNlcmllc1Byb21pc2VzKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgLy8gY2FsY3VsYXRlIGFuIG92ZXJhbGwgbWluL21heCBmb3IgYWxsIHNlcmllcwogICAgdmFyIHByb2Nlc3NlZERhdGEgPSByZXNwb25zZS5tYXAocHJvY2Vzc0NoYXJ0RGF0YSk7CgogICAgdmFyIGFsbERhdGFQb2ludHMgPSBfbG9kYXNoLmRlZmF1bHQucmVkdWNlKHByb2Nlc3NlZERhdGEsIGZ1bmN0aW9uIChkYXRhcG9pbnRzLCBzZXJpZXMpIHsKICAgICAgX2xvZGFzaC5kZWZhdWx0LmVhY2goc2VyaWVzLCBmdW5jdGlvbiAoZCkgewogICAgICAgIHJldHVybiBkYXRhcG9pbnRzLnB1c2goZCk7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGRhdGFwb2ludHM7CiAgICB9LCBbXSk7CgogICAgdmFyIG92ZXJhbGxDaGFydExpbWl0cyA9ICgwLCBfY2hhcnRfdXRpbHMuY2hhcnRMaW1pdHMpKGFsbERhdGFQb2ludHMpOwogICAgZGF0YS5zZXJpZXNUb1Bsb3QgPSByZXNwb25zZS5tYXAoZnVuY3Rpb24gKGQsIGkpIHsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHNlcmllc0NvbmZpZ3NbaV0sIHsKICAgICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgICBjaGFydERhdGE6IHByb2Nlc3NlZERhdGFbaV0sCiAgICAgICAgcGxvdEVhcmxpZXN0OiBjaGFydFJhbmdlLm1pbiwKICAgICAgICBwbG90TGF0ZXN0OiBjaGFydFJhbmdlLm1heCwKICAgICAgICBzZWxlY3RlZEVhcmxpZXN0OiBlYXJsaWVzdE1zLAogICAgICAgIHNlbGVjdGVkTGF0ZXN0OiBsYXRlc3RNcywKICAgICAgICBjaGFydExpbWl0czogVVNFX09WRVJBTExfQ0hBUlRfTElNSVRTID8gb3ZlcmFsbENoYXJ0TGltaXRzIDogKDAsIF9jaGFydF91dGlscy5jaGFydExpbWl0cykocHJvY2Vzc2VkRGF0YVtpXSkKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZXhwbG9yZXJfZGFzaGJvYXJkX3NlcnZpY2UuZXhwbG9yZXJTZXJ2aWNlLnNldENoYXJ0cyhfb2JqZWN0U3ByZWFkKHt9LCBkYXRhKSk7CiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICB9KTsKfTsKCmV4cG9ydHMuYW5vbWFseURhdGFDaGFuZ2UgPSBhbm9tYWx5RGF0YUNoYW5nZTsKCmZ1bmN0aW9uIHByb2Nlc3NSZWNvcmRzRm9yRGlzcGxheShhbm9tYWx5UmVjb3JkcykgewogIC8vIEFnZ3JlZ2F0ZSB0aGUgYW5vbWFseSBkYXRhIGJ5IGRldGVjdG9yLCBhbmQgZW50aXR5IChieS9vdmVyL3BhcnRpdGlvbikuCiAgaWYgKGFub21hbHlSZWNvcmRzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIFtdOwogIH0gLy8gQWdncmVnYXRlIGJ5IGpvYiwgZGV0ZWN0b3IsIGFuZCBhbmFseXNpcyBmaWVsZHMgKHBhcnRpdGlvbiwgYnksIG92ZXIpLgoKCiAgdmFyIGFnZ3JlZ2F0ZWREYXRhID0ge307CgogIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGFub21hbHlSZWNvcmRzLCBmdW5jdGlvbiAocmVjb3JkKSB7CiAgICAvLyBDaGVjayBpZiB3ZSBjYW4gcGxvdCBhIGNoYXJ0IGZvciB0aGlzIHJlY29yZCwgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIHNvdXJjZSBkYXRhCiAgICAvLyBpcyBjaGFydGFibGUsIGFuZCBpZiBtb2RlbCBwbG90IGlzIGVuYWJsZWQgZm9yIHRoZSBqb2IuCiAgICB2YXIgam9iID0gX2pvYl9zZXJ2aWNlLm1sSm9iU2VydmljZS5nZXRKb2IocmVjb3JkLmpvYl9pZCk7CgogICAgdmFyIGlzQ2hhcnRhYmxlID0gKDAsIF9qb2JfdXRpbHMuaXNTb3VyY2VEYXRhQ2hhcnRhYmxlRm9yRGV0ZWN0b3IpKGpvYiwgcmVjb3JkLmRldGVjdG9yX2luZGV4KTsKCiAgICBpZiAoaXNDaGFydGFibGUgPT09IGZhbHNlKSB7CiAgICAgIC8vIENoZWNrIGlmIG1vZGVsIHBsb3QgaXMgZW5hYmxlZCBmb3IgdGhpcyBqb2IuCiAgICAgIC8vIE5lZWQgdG8gY2hlY2sgdGhlIGVudGl0eSBmaWVsZHMgZm9yIHRoZSByZWNvcmQgaW4gY2FzZSB0aGUgbW9kZWwgcGxvdCBjb25maWcgaGFzIGEgdGVybXMgbGlzdC4KICAgICAgdmFyIGVudGl0eUZpZWxkcyA9ICgwLCBfYW5vbWFseV91dGlscy5nZXRFbnRpdHlGaWVsZExpc3QpKHJlY29yZCk7CiAgICAgIGlzQ2hhcnRhYmxlID0gKDAsIF9qb2JfdXRpbHMuaXNNb2RlbFBsb3RFbmFibGVkKShqb2IsIHJlY29yZC5kZXRlY3Rvcl9pbmRleCwgZW50aXR5RmllbGRzKTsKICAgIH0KCiAgICBpZiAoaXNDaGFydGFibGUgPT09IGZhbHNlKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgam9iSWQgPSByZWNvcmQuam9iX2lkOwoKICAgIGlmIChhZ2dyZWdhdGVkRGF0YVtqb2JJZF0gPT09IHVuZGVmaW5lZCkgewogICAgICBhZ2dyZWdhdGVkRGF0YVtqb2JJZF0gPSB7fTsKICAgIH0KCiAgICB2YXIgZGV0ZWN0b3JzRm9ySm9iID0gYWdncmVnYXRlZERhdGFbam9iSWRdOwogICAgdmFyIGRldGVjdG9ySW5kZXggPSByZWNvcmQuZGV0ZWN0b3JfaW5kZXg7CgogICAgaWYgKGRldGVjdG9yc0ZvckpvYltkZXRlY3RvckluZGV4XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGRldGVjdG9yc0ZvckpvYltkZXRlY3RvckluZGV4XSA9IHt9OwogICAgfSAvLyBUT0RPIC0gd29yayBvdXQgaG93IGJlc3QgdG8gZGlzcGxheSByZXN1bHRzIGZyb20gZGV0ZWN0b3JzIHdpdGgganVzdCBhbiBvdmVyIGZpZWxkLgoKCiAgICB2YXIgZmlyc3RGaWVsZE5hbWUgPSByZWNvcmQucGFydGl0aW9uX2ZpZWxkX25hbWUgfHwgcmVjb3JkLmJ5X2ZpZWxkX25hbWUgfHwgcmVjb3JkLm92ZXJfZmllbGRfbmFtZTsKICAgIHZhciBmaXJzdEZpZWxkVmFsdWUgPSByZWNvcmQucGFydGl0aW9uX2ZpZWxkX3ZhbHVlIHx8IHJlY29yZC5ieV9maWVsZF92YWx1ZSB8fCByZWNvcmQub3Zlcl9maWVsZF92YWx1ZTsKCiAgICBpZiAoZmlyc3RGaWVsZE5hbWUgIT09IHVuZGVmaW5lZCkgewogICAgICB2YXIgZ3JvdXBzRm9yRGV0ZWN0b3IgPSBkZXRlY3RvcnNGb3JKb2JbZGV0ZWN0b3JJbmRleF07CgogICAgICBpZiAoZ3JvdXBzRm9yRGV0ZWN0b3JbZmlyc3RGaWVsZE5hbWVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICBncm91cHNGb3JEZXRlY3RvcltmaXJzdEZpZWxkTmFtZV0gPSB7fTsKICAgICAgfQoKICAgICAgdmFyIHZhbHVlc0Zvckdyb3VwID0gZ3JvdXBzRm9yRGV0ZWN0b3JbZmlyc3RGaWVsZE5hbWVdOwoKICAgICAgaWYgKHZhbHVlc0Zvckdyb3VwW2ZpcnN0RmllbGRWYWx1ZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhbHVlc0Zvckdyb3VwW2ZpcnN0RmllbGRWYWx1ZV0gPSB7fTsKICAgICAgfQoKICAgICAgdmFyIGRhdGFGb3JHcm91cFZhbHVlID0gdmFsdWVzRm9yR3JvdXBbZmlyc3RGaWVsZFZhbHVlXTsKICAgICAgdmFyIGlzU2Vjb25kU3BsaXQgPSBmYWxzZTsKCiAgICAgIGlmIChyZWNvcmQucGFydGl0aW9uX2ZpZWxkX25hbWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhciBzcGxpdEZpZWxkTmFtZSA9IHJlY29yZC5vdmVyX2ZpZWxkX25hbWUgfHwgcmVjb3JkLmJ5X2ZpZWxkX25hbWU7CgogICAgICAgIGlmIChzcGxpdEZpZWxkTmFtZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpc1NlY29uZFNwbGl0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChpc1NlY29uZFNwbGl0ID09PSBmYWxzZSkgewogICAgICAgIGlmIChkYXRhRm9yR3JvdXBWYWx1ZS5tYXhTY29yZVJlY29yZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBkYXRhRm9yR3JvdXBWYWx1ZS5tYXhTY29yZSA9IHJlY29yZC5yZWNvcmRfc2NvcmU7CiAgICAgICAgICBkYXRhRm9yR3JvdXBWYWx1ZS5tYXhTY29yZVJlY29yZCA9IHJlY29yZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHJlY29yZC5yZWNvcmRfc2NvcmUgPiBkYXRhRm9yR3JvdXBWYWx1ZS5tYXhTY29yZSkgewogICAgICAgICAgICBkYXRhRm9yR3JvdXBWYWx1ZS5tYXhTY29yZSA9IHJlY29yZC5yZWNvcmRfc2NvcmU7CiAgICAgICAgICAgIGRhdGFGb3JHcm91cFZhbHVlLm1heFNjb3JlUmVjb3JkID0gcmVjb3JkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBBZ2dyZWdhdGUgYW5vdGhlciBsZXZlbCBmb3IgdGhlIG92ZXIgb3IgYnkgZmllbGQuCiAgICAgICAgdmFyIHNlY29uZEZpZWxkTmFtZSA9IHJlY29yZC5vdmVyX2ZpZWxkX25hbWUgfHwgcmVjb3JkLmJ5X2ZpZWxkX25hbWU7CiAgICAgICAgdmFyIHNlY29uZEZpZWxkVmFsdWUgPSByZWNvcmQub3Zlcl9maWVsZF92YWx1ZSB8fCByZWNvcmQuYnlfZmllbGRfdmFsdWU7CgogICAgICAgIGlmIChkYXRhRm9yR3JvdXBWYWx1ZVtzZWNvbmRGaWVsZE5hbWVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGRhdGFGb3JHcm91cFZhbHVlW3NlY29uZEZpZWxkTmFtZV0gPSB7fTsKICAgICAgICB9CgogICAgICAgIHZhciBzcGxpdHNGb3JHcm91cCA9IGRhdGFGb3JHcm91cFZhbHVlW3NlY29uZEZpZWxkTmFtZV07CgogICAgICAgIGlmIChzcGxpdHNGb3JHcm91cFtzZWNvbmRGaWVsZFZhbHVlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBzcGxpdHNGb3JHcm91cFtzZWNvbmRGaWVsZFZhbHVlXSA9IHt9OwogICAgICAgIH0KCiAgICAgICAgdmFyIGRhdGFGb3JTcGxpdFZhbHVlID0gc3BsaXRzRm9yR3JvdXBbc2Vjb25kRmllbGRWYWx1ZV07CgogICAgICAgIGlmIChkYXRhRm9yU3BsaXRWYWx1ZS5tYXhTY29yZVJlY29yZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBkYXRhRm9yU3BsaXRWYWx1ZS5tYXhTY29yZSA9IHJlY29yZC5yZWNvcmRfc2NvcmU7CiAgICAgICAgICBkYXRhRm9yU3BsaXRWYWx1ZS5tYXhTY29yZVJlY29yZCA9IHJlY29yZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHJlY29yZC5yZWNvcmRfc2NvcmUgPiBkYXRhRm9yU3BsaXRWYWx1ZS5tYXhTY29yZSkgewogICAgICAgICAgICBkYXRhRm9yU3BsaXRWYWx1ZS5tYXhTY29yZSA9IHJlY29yZC5yZWNvcmRfc2NvcmU7CiAgICAgICAgICAgIGRhdGFGb3JTcGxpdFZhbHVlLm1heFNjb3JlUmVjb3JkID0gcmVjb3JkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gRGV0ZWN0b3Igd2l0aCBubyBwYXJ0aXRpb24gb3IgYnkgZmllbGQuCiAgICAgIHZhciBkYXRhRm9yRGV0ZWN0b3IgPSBkZXRlY3RvcnNGb3JKb2JbZGV0ZWN0b3JJbmRleF07CgogICAgICBpZiAoZGF0YUZvckRldGVjdG9yLm1heFNjb3JlUmVjb3JkID09PSB1bmRlZmluZWQpIHsKICAgICAgICBkYXRhRm9yRGV0ZWN0b3IubWF4U2NvcmUgPSByZWNvcmQucmVjb3JkX3Njb3JlOwogICAgICAgIGRhdGFGb3JEZXRlY3Rvci5tYXhTY29yZVJlY29yZCA9IHJlY29yZDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocmVjb3JkLnJlY29yZF9zY29yZSA+IGRhdGFGb3JEZXRlY3Rvci5tYXhTY29yZSkgewogICAgICAgICAgZGF0YUZvckRldGVjdG9yLm1heFNjb3JlID0gcmVjb3JkLnJlY29yZF9zY29yZTsKICAgICAgICAgIGRhdGFGb3JEZXRlY3Rvci5tYXhTY29yZVJlY29yZCA9IHJlY29yZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9KTsKCiAgY29uc29sZS5sb2coJ2V4cGxvcmVyIGNoYXJ0cyBhZ2dyZWdhdGVkRGF0YSBpczonLCBhZ2dyZWdhdGVkRGF0YSk7CiAgdmFyIHJlY29yZHNGb3JTZXJpZXMgPSBbXTsgLy8gQ29udmVydCB0byBhbiBhcnJheSBvZiB0aGUgcmVjb3JkcyB3aXRoIHRoZSBoaWdoZXN0IHJlY29yZF9zY29yZSBwZXIgdW5pcXVlIHNlcmllcy4KCiAgX2xvZGFzaC5kZWZhdWx0LmVhY2goYWdncmVnYXRlZERhdGEsIGZ1bmN0aW9uIChkZXRlY3RvcnNGb3JKb2IpIHsKICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGRldGVjdG9yc0ZvckpvYiwgZnVuY3Rpb24gKGdyb3Vwc0ZvckRldGVjdG9yKSB7CiAgICAgIGlmIChncm91cHNGb3JEZXRlY3Rvci5tYXhTY29yZVJlY29yZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRGV0ZWN0b3Igd2l0aCBubyBwYXJ0aXRpb24gLyBieSBmaWVsZC4KICAgICAgICByZWNvcmRzRm9yU2VyaWVzLnB1c2goZ3JvdXBzRm9yRGV0ZWN0b3IubWF4U2NvcmVSZWNvcmQpOwogICAgICB9IGVsc2UgewogICAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGdyb3Vwc0ZvckRldGVjdG9yLCBmdW5jdGlvbiAodmFsdWVzRm9yR3JvdXApIHsKICAgICAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKHZhbHVlc0Zvckdyb3VwLCBmdW5jdGlvbiAoZGF0YUZvckdyb3VwVmFsdWUpIHsKICAgICAgICAgICAgaWYgKGRhdGFGb3JHcm91cFZhbHVlLm1heFNjb3JlUmVjb3JkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICByZWNvcmRzRm9yU2VyaWVzLnB1c2goZGF0YUZvckdyb3VwVmFsdWUubWF4U2NvcmVSZWNvcmQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIFNlY29uZCBsZXZlbCBvZiBhZ2dyZWdhdGlvbiBmb3IgcGFydGl0aW9uIGFuZCBieS9vdmVyLgogICAgICAgICAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKGRhdGFGb3JHcm91cFZhbHVlLCBmdW5jdGlvbiAoc3BsaXRzRm9yR3JvdXApIHsKICAgICAgICAgICAgICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKHNwbGl0c0Zvckdyb3VwLCBmdW5jdGlvbiAoZGF0YUZvclNwbGl0VmFsdWUpIHsKICAgICAgICAgICAgICAgICAgcmVjb3Jkc0ZvclNlcmllcy5wdXNoKGRhdGFGb3JTcGxpdFZhbHVlLm1heFNjb3JlUmVjb3JkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSk7CgogIHJlY29yZHNGb3JTZXJpZXMgPSBfbG9kYXNoLmRlZmF1bHQuc29ydEJ5KHJlY29yZHNGb3JTZXJpZXMsICdyZWNvcmRfc2NvcmUnKS5yZXZlcnNlKCk7CiAgcmV0dXJuIHJlY29yZHNGb3JTZXJpZXM7Cn0KCmZ1bmN0aW9uIGNhbGN1bGF0ZUNoYXJ0UmFuZ2Uoc2VyaWVzQ29uZmlncywgZWFybGllc3RNcywgbGF0ZXN0TXMsIGNoYXJ0V2lkdGgsIHJlY29yZHNUb1Bsb3QsIHRpbWVGaWVsZE5hbWUpIHsKICB2YXIgdG9vTWFueUJ1Y2tldHMgPSBmYWxzZTsgLy8gQ2FsY3VsYXRlIHRoZSB0aW1lIHJhbmdlIGZvciB0aGUgY2hhcnRzLgogIC8vIEZpdCBpbiBhcyBtYW55IHBvaW50cyBpbiB0aGUgYXZhaWxhYmxlIGNvbnRhaW5lciB3aWR0aCBwbG90dGVkIGF0IHRoZSBqb2IgYnVja2V0IHNwYW4uCgogIHZhciBtaWRwb2ludE1zID0gTWF0aC5jZWlsKChlYXJsaWVzdE1zICsgbGF0ZXN0TXMpIC8gMik7CiAgdmFyIG1heEJ1Y2tldFNwYW5NcyA9IE1hdGgubWF4LmFwcGx5KG51bGwsIF9sb2Rhc2guZGVmYXVsdC5wbHVjayhzZXJpZXNDb25maWdzLCAnYnVja2V0U3BhblNlY29uZHMnKSkgKiAxMDAwOwogIHZhciBwb2ludHNUb1Bsb3RGdWxsU2VsZWN0aW9uID0gTWF0aC5jZWlsKChsYXRlc3RNcyAtIGVhcmxpZXN0TXMpIC8gbWF4QnVja2V0U3Bhbk1zKTsgLy8gT3B0aW1hbGx5IHNwYWNlIHBvaW50cyA1cHggYXBhcnQuCgogIHZhciBvcHRpbXVtUG9pbnRTcGFjaW5nID0gNTsKICB2YXIgb3B0aW11bU51bVBvaW50cyA9IGNoYXJ0V2lkdGggLyBvcHRpbXVtUG9pbnRTcGFjaW5nOyAvLyBJbmNyZWFzZSBhY3R1YWwgbnVtYmVyIG9mIHBvaW50cyBpZiB3ZSBjYW4ndCBwbG90IHRoZSBzZWxlY3RlZCByYW5nZQogIC8vIGF0IG9wdGltYWwgcG9pbnQgc3BhY2luZy4KCiAgdmFyIHBsb3RQb2ludHMgPSBNYXRoLm1heChvcHRpbXVtTnVtUG9pbnRzLCBwb2ludHNUb1Bsb3RGdWxsU2VsZWN0aW9uKTsKICB2YXIgaGFsZlBvaW50cyA9IE1hdGguY2VpbChwbG90UG9pbnRzIC8gMik7CiAgdmFyIGNoYXJ0UmFuZ2UgPSB7CiAgICBtaW46IG1pZHBvaW50TXMgLSBoYWxmUG9pbnRzICogbWF4QnVja2V0U3Bhbk1zLAogICAgbWF4OiBtaWRwb2ludE1zICsgaGFsZlBvaW50cyAqIG1heEJ1Y2tldFNwYW5NcwogIH07CgogIGlmIChwbG90UG9pbnRzID4gQ0hBUlRfTUFYX1BPSU5UUykgewogICAgdG9vTWFueUJ1Y2tldHMgPSB0cnVlOyAvLyBGb3IgZWFjaCBzZXJpZXMgYmVpbmcgcGxvdHRlZCwgZGlzcGxheSB0aGUgcmVjb3JkIHdpdGggdGhlIGhpZ2hlc3Qgc2NvcmUgaWYgcG9zc2libGUuCgogICAgdmFyIG1heFRpbWVTcGFuID0gbWF4QnVja2V0U3Bhbk1zICogQ0hBUlRfTUFYX1BPSU5UUzsKICAgIHZhciBtaW5NcyA9IHJlY29yZHNUb1Bsb3RbMF1bdGltZUZpZWxkTmFtZV07CiAgICB2YXIgbWF4TXMgPSByZWNvcmRzVG9QbG90WzBdW3RpbWVGaWVsZE5hbWVdOwoKICAgIF9sb2Rhc2guZGVmYXVsdC5lYWNoKHJlY29yZHNUb1Bsb3QsIGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgdmFyIGRpZmZNcyA9IG1heE1zIC0gbWluTXM7CgogICAgICBpZiAoZGlmZk1zIDwgbWF4VGltZVNwYW4pIHsKICAgICAgICB2YXIgcmVjb3JkVGltZSA9IHJlY29yZFt0aW1lRmllbGROYW1lXTsKCiAgICAgICAgaWYgKHJlY29yZFRpbWUgPCBtaW5NcykgewogICAgICAgICAgaWYgKG1heE1zIC0gcmVjb3JkVGltZSA8PSBtYXhUaW1lU3BhbikgewogICAgICAgICAgICBtaW5NcyA9IHJlY29yZFRpbWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocmVjb3JkVGltZSA+IG1heE1zKSB7CiAgICAgICAgICBpZiAocmVjb3JkVGltZSAtIG1pbk1zIDw9IG1heFRpbWVTcGFuKSB7CiAgICAgICAgICAgIG1heE1zID0gcmVjb3JkVGltZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIGlmIChtYXhNcyAtIG1pbk1zIDwgbWF4VGltZVNwYW4pIHsKICAgICAgLy8gRXhwYW5kIG91dCB0byBjb3ZlciBhcyBtdWNoIGFzIHRoZSByZXF1ZXN0ZWQgdGltZSBzcGFuIGFzIHBvc3NpYmxlLgogICAgICBtaW5NcyA9IE1hdGgubWF4KGVhcmxpZXN0TXMsIG1pbk1zIC0gbWF4VGltZVNwYW4pOwogICAgICBtYXhNcyA9IE1hdGgubWluKGxhdGVzdE1zLCBtYXhNcyArIG1heFRpbWVTcGFuKTsKICAgIH0KCiAgICBjaGFydFJhbmdlID0gewogICAgICBtaW46IG1pbk1zLAogICAgICBtYXg6IG1heE1zCiAgICB9OwogIH0KCiAgcmV0dXJuIHsKICAgIGNoYXJ0UmFuZ2U6IGNoYXJ0UmFuZ2UsCiAgICB0b29NYW55QnVja2V0czogdG9vTWFueUJ1Y2tldHMKICB9Owp9"},null]}