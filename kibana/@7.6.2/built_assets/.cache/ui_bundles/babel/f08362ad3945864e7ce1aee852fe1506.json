{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/core/public/application/application_service.js","dependencies":[{"path":"src/core/public/application/application_service.js","mtime":1585205038712},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkFwcGxpY2F0aW9uU2VydmljZSA9IHZvaWQgMDsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9yeGpzID0gcmVxdWlyZSgicnhqcyIpOwoKdmFyIF9vcGVyYXRvcnMgPSByZXF1aXJlKCJyeGpzL29wZXJhdG9ycyIpOwoKdmFyIF9oaXN0b3J5ID0gcmVxdWlyZSgiaGlzdG9yeSIpOwoKdmFyIF91aSA9IHJlcXVpcmUoIi4vdWkiKTsKCnZhciBfY2FwYWJpbGl0aWVzID0gcmVxdWlyZSgiLi9jYXBhYmlsaXRpZXMiKTsKCnZhciBfdHlwZXMgPSByZXF1aXJlKCIuL3R5cGVzIik7Cgp2YXIgX2FwcGxpY2F0aW9uX2xlYXZlID0gcmVxdWlyZSgiLi9hcHBsaWNhdGlvbl9sZWF2ZSIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsKICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKCiAgdmFyIHRhcmdldCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpOwoKICB2YXIga2V5LCBpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHNvdXJjZVN5bWJvbEtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7CgogICAgZm9yIChpID0gMDsgaSA8IHNvdXJjZVN5bWJvbEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAga2V5ID0gc291cmNlU3ltYm9sS2V5c1tpXTsKICAgICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoc291cmNlLCBrZXkpKSBjb250aW51ZTsKICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHsKICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKICB2YXIgdGFyZ2V0ID0ge307CiAgdmFyIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOwogIHZhciBrZXksIGk7CgogIGZvciAoaSA9IDA7IGkgPCBzb3VyY2VLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICBrZXkgPSBzb3VyY2VLZXlzW2ldOwogICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9IC8vIE1vdW50IGZ1bmN0aW9ucyB3aXRoIHR3byBhcmd1bWVudHMgYXJlIGFzc3VtZWQgdG8gZXhwZWN0IGRlcHJlY2F0ZWQgYGNvbnRleHRgIG9iamVjdC4KCgp2YXIgaXNBcHBNb3VudERlcHJlY2F0ZWQgPSBmdW5jdGlvbiBpc0FwcE1vdW50RGVwcmVjYXRlZChtb3VudCkgewogIHJldHVybiBtb3VudC5sZW5ndGggPT09IDI7Cn07CgpmdW5jdGlvbiBmaWx0ZXJBdmFpbGFibGUobSwgY2FwYWJpbGl0aWVzKSB7CiAgcmV0dXJuIG5ldyBNYXAoX3RvQ29uc3VtYWJsZUFycmF5KG0pLmZpbHRlcihmdW5jdGlvbiAoX3JlZikgewogICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMSksCiAgICAgICAgaWQgPSBfcmVmMlswXTsKCiAgICByZXR1cm4gY2FwYWJpbGl0aWVzLm5hdkxpbmtzW2lkXSA9PT0gdW5kZWZpbmVkIHx8IGNhcGFiaWxpdGllcy5uYXZMaW5rc1tpZF0gPT09IHRydWU7CiAgfSkpOwp9Cgp2YXIgZmluZE1vdW50ZXIgPSBmdW5jdGlvbiBmaW5kTW91bnRlcihtb3VudGVycywgYXBwUm91dGUpIHsKICByZXR1cm4gX3RvQ29uc3VtYWJsZUFycmF5KG1vdW50ZXJzKS5maW5kKGZ1bmN0aW9uIChfcmVmMykgewogICAgdmFyIF9yZWY0ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjMsIDIpLAogICAgICAgIG1vdW50ZXIgPSBfcmVmNFsxXTsKCiAgICByZXR1cm4gbW91bnRlci5hcHBSb3V0ZSA9PT0gYXBwUm91dGU7CiAgfSk7Cn07Cgp2YXIgZ2V0QXBwVXJsID0gZnVuY3Rpb24gZ2V0QXBwVXJsKG1vdW50ZXJzLCBhcHBJZCkgewogIHZhciBfcmVmNSwgX21vdW50ZXJzJGdldDsKCiAgdmFyIHBhdGggPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICcnOwogIHJldHVybiAiLyIuY29uY2F0KChfcmVmNSA9IChfbW91bnRlcnMkZ2V0ID0gbW91bnRlcnMuZ2V0KGFwcElkKSkgPT09IG51bGwgfHwgX21vdW50ZXJzJGdldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX21vdW50ZXJzJGdldC5hcHBSb3V0ZSkgIT09IG51bGwgJiYgX3JlZjUgIT09IHZvaWQgMCA/IF9yZWY1IDogIi9hcHAvIi5jb25jYXQoYXBwSWQpLCAiLyIpLmNvbmNhdChwYXRoKS5yZXBsYWNlKC9cL3syLH0vZywgJy8nKSAvLyBSZW1vdmUgZHVwbGljYXRlIHNsYXNoZXMKICAucmVwbGFjZSgvXC8kLywgJycpOwp9OyAvLyBSZW1vdmUgdHJhaWxpbmcgc2xhc2gKCgp2YXIgYWxsQXBwbGljYXRpb25zRmlsdGVyID0gJ19fQUxMX18nOwovKioKICogU2VydmljZSB0aGF0IGlzIHJlc3BvbnNpYmxlIGZvciByZWdpc3RlcmluZyBuZXcgYXBwbGljYXRpb25zLgogKiBAaW50ZXJuYWwKICovCgp2YXIgQXBwbGljYXRpb25TZXJ2aWNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gQXBwbGljYXRpb25TZXJ2aWNlKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXBwbGljYXRpb25TZXJ2aWNlKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImFwcHMiLCBuZXcgTWFwKCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibW91bnRlcnMiLCBuZXcgTWFwKCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY2FwYWJpbGl0aWVzIiwgbmV3IF9jYXBhYmlsaXRpZXMuQ2FwYWJpbGl0aWVzU2VydmljZSgpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImFwcExlYXZlSGFuZGxlcnMiLCBuZXcgTWFwKCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY3VycmVudEFwcElkJCIsIG5ldyBfcnhqcy5CZWhhdmlvclN1YmplY3QodW5kZWZpbmVkKSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJzdGF0dXNVcGRhdGVycyQiLCBuZXcgX3J4anMuQmVoYXZpb3JTdWJqZWN0KG5ldyBNYXAoKSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic3Vic2NyaXB0aW9ucyIsIFtdKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInN0b3AkIiwgbmV3IF9yeGpzLlN1YmplY3QoKSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJyZWdpc3RyYXRpb25DbG9zZWQiLCBmYWxzZSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJoaXN0b3J5Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIm1vdW50Q29udGV4dCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJuYXZpZ2F0ZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJzZXRBcHBMZWF2ZUhhbmRsZXIiLCBmdW5jdGlvbiAoYXBwSWQsIGhhbmRsZXIpIHsKICAgICAgX3RoaXMuYXBwTGVhdmVIYW5kbGVycy5zZXQoYXBwSWQsIGhhbmRsZXIpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJvbkJlZm9yZVVubG9hZCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICB2YXIgY3VycmVudEFwcElkID0gX3RoaXMuY3VycmVudEFwcElkJC52YWx1ZTsKCiAgICAgIGlmIChjdXJyZW50QXBwSWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGFjdGlvbiA9ICgwLCBfYXBwbGljYXRpb25fbGVhdmUuZ2V0TGVhdmVBY3Rpb24pKF90aGlzLmFwcExlYXZlSGFuZGxlcnMuZ2V0KGN1cnJlbnRBcHBJZCkpOwoKICAgICAgaWYgKCgwLCBfYXBwbGljYXRpb25fbGVhdmUuaXNDb25maXJtQWN0aW9uKShhY3Rpb24pKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gc29tZSBicm93c2VycyBhY2NlcHQgYSBzdHJpbmcgcmV0dXJuIHZhbHVlIGJlaW5nIHRoZSBtZXNzYWdlIGRpc3BsYXllZAoKICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9IGFjdGlvbi50ZXh0OwogICAgICB9CiAgICB9KTsKICB9CgogIF9jcmVhdGVDbGFzcyhBcHBsaWNhdGlvblNlcnZpY2UsIFt7CiAgICBrZXk6ICJzZXR1cCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0dXAoX3JlZjYpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IF9yZWY2LmNvbnRleHQsCiAgICAgICAgICBiYXNlUGF0aCA9IF9yZWY2Lmh0dHAuYmFzZVBhdGgsCiAgICAgICAgICBpbmplY3RlZE1ldGFkYXRhID0gX3JlZjYuaW5qZWN0ZWRNZXRhZGF0YSwKICAgICAgICAgIF9yZWY2JHJlZGlyZWN0VG8gPSBfcmVmNi5yZWRpcmVjdFRvLAogICAgICAgICAgcmVkaXJlY3RUbyA9IF9yZWY2JHJlZGlyZWN0VG8gPT09IHZvaWQgMCA/IGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcGF0aDsKICAgICAgfSA6IF9yZWY2JHJlZGlyZWN0VG8sCiAgICAgICAgICBoaXN0b3J5ID0gX3JlZjYuaGlzdG9yeTsKICAgICAgdmFyIGJhc2VuYW1lID0gYmFzZVBhdGguZ2V0KCk7IC8vIE9ubHkgc2V0dXAgaGlzdG9yeSBpZiB3ZSdyZSBub3QgaW4gbGVnYWN5IG1vZGUKCiAgICAgIGlmICghaW5qZWN0ZWRNZXRhZGF0YS5nZXRMZWdhY3lNb2RlKCkpIHsKICAgICAgICB0aGlzLmhpc3RvcnkgPSBoaXN0b3J5IHx8ICgwLCBfaGlzdG9yeS5jcmVhdGVCcm93c2VySGlzdG9yeSkoewogICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lCiAgICAgICAgfSk7CiAgICAgIH0gLy8gSWYgd2UgZG8gbm90IGhhdmUgaGlzdG9yeSBhdmFpbGFibGUsIHVzZSByZWRpcmVjdFRvIHRvIGRvIGEgZnVsbCBwYWdlIHJlZnJlc2guCgoKICAgICAgdGhpcy5uYXZpZ2F0ZSA9IGZ1bmN0aW9uICh1cmwsIHN0YXRlKSB7CiAgICAgICAgcmV0dXJuICgvLyBiYXNlUGF0aCBub3QgbmVlZGVkIGhlcmUgYmVjYXVzZSBgaGlzdG9yeWAgaXMgY29uZmlndXJlZCB3aXRoIGJhc2VuYW1lCiAgICAgICAgICBfdGhpczIuaGlzdG9yeSA/IF90aGlzMi5oaXN0b3J5LnB1c2godXJsLCBzdGF0ZSkgOiByZWRpcmVjdFRvKGJhc2VQYXRoLnByZXBlbmQodXJsKSkKICAgICAgICApOwogICAgICB9OwoKICAgICAgdGhpcy5tb3VudENvbnRleHQgPSBjb250ZXh0LmNyZWF0ZUNvbnRleHRDb250YWluZXIoKTsKCiAgICAgIHZhciByZWdpc3RlclN0YXR1c1VwZGF0ZXIgPSBmdW5jdGlvbiByZWdpc3RlclN0YXR1c1VwZGF0ZXIoYXBwbGljYXRpb24sIHVwZGF0ZXIkKSB7CiAgICAgICAgdmFyIHVwZGF0ZXJJZCA9IFN5bWJvbCgpOwogICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSB1cGRhdGVyJC5zdWJzY3JpYmUoZnVuY3Rpb24gKHVwZGF0ZXIpIHsKICAgICAgICAgIHZhciBuZXh0VmFsdWUgPSBuZXcgTWFwKF90aGlzMi5zdGF0dXNVcGRhdGVycyQuZ2V0VmFsdWUoKSk7CiAgICAgICAgICBuZXh0VmFsdWUuc2V0KHVwZGF0ZXJJZCwgewogICAgICAgICAgICBhcHBsaWNhdGlvbjogYXBwbGljYXRpb24sCiAgICAgICAgICAgIHVwZGF0ZXI6IHVwZGF0ZXIKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzMi5zdGF0dXNVcGRhdGVycyQubmV4dChuZXh0VmFsdWUpOwogICAgICAgIH0pOwoKICAgICAgICBfdGhpczIuc3Vic2NyaXB0aW9ucy5wdXNoKHN1YnNjcmlwdGlvbik7CiAgICAgIH07CgogICAgICByZXR1cm4gewogICAgICAgIHJlZ2lzdGVyTW91bnRDb250ZXh0OiB0aGlzLm1vdW50Q29udGV4dC5yZWdpc3RlckNvbnRleHQsCiAgICAgICAgcmVnaXN0ZXI6IGZ1bmN0aW9uIHJlZ2lzdGVyKHBsdWdpbiwgYXBwKSB7CiAgICAgICAgICB2YXIgX2FwcCRzdGF0dXMsIF9hcHAkbmF2TGlua1N0YXR1czsKCiAgICAgICAgICBhcHAgPSBfb2JqZWN0U3ByZWFkKHsKICAgICAgICAgICAgYXBwUm91dGU6ICIvYXBwLyIuY29uY2F0KGFwcC5pZCkKICAgICAgICAgIH0sIGFwcCk7CgogICAgICAgICAgaWYgKF90aGlzMi5yZWdpc3RyYXRpb25DbG9zZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBcHBsaWNhdGlvbnMgY2Fubm90IGJlIHJlZ2lzdGVyZWQgYWZ0ZXIgXCJzZXR1cFwiIik7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMi5hcHBzLmhhcyhhcHAuaWQpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQW4gYXBwbGljYXRpb24gaXMgYWxyZWFkeSByZWdpc3RlcmVkIHdpdGggdGhlIGlkIFwiIi5jb25jYXQoYXBwLmlkLCAiXCIiKSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGZpbmRNb3VudGVyKF90aGlzMi5tb3VudGVycywgYXBwLmFwcFJvdXRlKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFuIGFwcGxpY2F0aW9uIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCB3aXRoIHRoZSBhcHBSb3V0ZSBcIiIuY29uY2F0KGFwcC5hcHBSb3V0ZSwgIlwiIikpOwogICAgICAgICAgfSBlbHNlIGlmIChiYXNlbmFtZSAmJiBhcHAuYXBwUm91dGUuc3RhcnRzV2l0aChiYXNlbmFtZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgcmVnaXN0ZXIgYW4gYXBwbGljYXRpb24gcm91dGUgdGhhdCBpbmNsdWRlcyBIVFRQIGJhc2UgcGF0aCcpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBoYW5kbGVyOwoKICAgICAgICAgIGlmIChpc0FwcE1vdW50RGVwcmVjYXRlZChhcHAubW91bnQpKSB7CiAgICAgICAgICAgIGhhbmRsZXIgPSBfdGhpczIubW91bnRDb250ZXh0LmNyZWF0ZUhhbmRsZXIocGx1Z2luLCBhcHAubW91bnQpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQoKICAgICAgICAgICAgY29uc29sZS53YXJuKCJBcHAgWyIuY29uY2F0KGFwcC5pZCwgIl0gaXMgdXNpbmcgZGVwcmVjYXRlZCBtb3VudCBjb250ZXh0LiBVc2UgY29yZS5nZXRTdGFydFNlcnZpY2VzKCkgaW5zdGVhZC4iKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBoYW5kbGVyID0gYXBwLm1vdW50OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBtb3VudCA9IGZ1bmN0aW9uIG1vdW50KHBhcmFtcykgewogICAgICAgICAgICB2YXIgdW5tb3VudDsKICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBtb3VudCQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChoYW5kbGVyKHBhcmFtcykpOwoKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHVubW91bnQgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICAgICAgICBfdGhpczIuY3VycmVudEFwcElkJC5uZXh0KGFwcC5pZCk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHVubW91bnQpOwoKICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIF9hcHAgPSBhcHAsCiAgICAgICAgICAgICAgdXBkYXRlciQgPSBfYXBwLnVwZGF0ZXIkLAogICAgICAgICAgICAgIGFwcFByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF9hcHAsIFsidXBkYXRlciQiXSk7CgogICAgICAgICAgX3RoaXMyLmFwcHMuc2V0KGFwcC5pZCwgX29iamVjdFNwcmVhZCh7fSwgYXBwUHJvcHMsIHsKICAgICAgICAgICAgc3RhdHVzOiAoX2FwcCRzdGF0dXMgPSBhcHAuc3RhdHVzKSAhPT0gbnVsbCAmJiBfYXBwJHN0YXR1cyAhPT0gdm9pZCAwID8gX2FwcCRzdGF0dXMgOiBfdHlwZXMuQXBwU3RhdHVzLmFjY2Vzc2libGUsCiAgICAgICAgICAgIG5hdkxpbmtTdGF0dXM6IChfYXBwJG5hdkxpbmtTdGF0dXMgPSBhcHAubmF2TGlua1N0YXR1cykgIT09IG51bGwgJiYgX2FwcCRuYXZMaW5rU3RhdHVzICE9PSB2b2lkIDAgPyBfYXBwJG5hdkxpbmtTdGF0dXMgOiBfdHlwZXMuQXBwTmF2TGlua1N0YXR1cy5kZWZhdWx0LAogICAgICAgICAgICBsZWdhY3k6IGZhbHNlCiAgICAgICAgICB9KSk7CgogICAgICAgICAgaWYgKHVwZGF0ZXIkKSB7CiAgICAgICAgICAgIHJlZ2lzdGVyU3RhdHVzVXBkYXRlcihhcHAuaWQsIHVwZGF0ZXIkKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczIubW91bnRlcnMuc2V0KGFwcC5pZCwgewogICAgICAgICAgICBhcHBSb3V0ZTogYXBwLmFwcFJvdXRlLAogICAgICAgICAgICBhcHBCYXNlUGF0aDogYmFzZVBhdGgucHJlcGVuZChhcHAuYXBwUm91dGUpLAogICAgICAgICAgICBtb3VudDogbW91bnQsCiAgICAgICAgICAgIHVubW91bnRCZWZvcmVNb3VudGluZzogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcmVnaXN0ZXJMZWdhY3lBcHA6IGZ1bmN0aW9uIHJlZ2lzdGVyTGVnYWN5QXBwKGFwcCkgewogICAgICAgICAgdmFyIF9hcHAkc3RhdHVzMiwgX2FwcCRuYXZMaW5rU3RhdHVzMjsKCiAgICAgICAgICB2YXIgYXBwUm91dGUgPSAiL2FwcC8iLmNvbmNhdChhcHAuaWQuc3BsaXQoJzonKVswXSk7CgogICAgICAgICAgaWYgKF90aGlzMi5yZWdpc3RyYXRpb25DbG9zZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcHBsaWNhdGlvbnMgY2Fubm90IGJlIHJlZ2lzdGVyZWQgYWZ0ZXIgInNldHVwIicpOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczIuYXBwcy5oYXMoYXBwLmlkKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFuIGFwcGxpY2F0aW9uIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCB3aXRoIHRoZSBpZCBcIiIuY29uY2F0KGFwcC5pZCwgIlwiIikpOwogICAgICAgICAgfSBlbHNlIGlmIChiYXNlbmFtZSAmJiBhcHBSb3V0ZS5zdGFydHNXaXRoKGJhc2VuYW1lKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCByZWdpc3RlciBhbiBhcHBsaWNhdGlvbiByb3V0ZSB0aGF0IGluY2x1ZGVzIEhUVFAgYmFzZSBwYXRoJyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGFwcEJhc2VQYXRoID0gYmFzZVBhdGgucHJlcGVuZChhcHBSb3V0ZSk7CgogICAgICAgICAgdmFyIG1vdW50ID0gZnVuY3Rpb24gbW91bnQoKSB7CiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdFRvKGFwcEJhc2VQYXRoKTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIHVwZGF0ZXIkID0gYXBwLnVwZGF0ZXIkLAogICAgICAgICAgICAgIGFwcFByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKGFwcCwgWyJ1cGRhdGVyJCJdKTsKCiAgICAgICAgICBfdGhpczIuYXBwcy5zZXQoYXBwLmlkLCBfb2JqZWN0U3ByZWFkKHt9LCBhcHBQcm9wcywgewogICAgICAgICAgICBzdGF0dXM6IChfYXBwJHN0YXR1czIgPSBhcHAuc3RhdHVzKSAhPT0gbnVsbCAmJiBfYXBwJHN0YXR1czIgIT09IHZvaWQgMCA/IF9hcHAkc3RhdHVzMiA6IF90eXBlcy5BcHBTdGF0dXMuYWNjZXNzaWJsZSwKICAgICAgICAgICAgbmF2TGlua1N0YXR1czogKF9hcHAkbmF2TGlua1N0YXR1czIgPSBhcHAubmF2TGlua1N0YXR1cykgIT09IG51bGwgJiYgX2FwcCRuYXZMaW5rU3RhdHVzMiAhPT0gdm9pZCAwID8gX2FwcCRuYXZMaW5rU3RhdHVzMiA6IF90eXBlcy5BcHBOYXZMaW5rU3RhdHVzLmRlZmF1bHQsCiAgICAgICAgICAgIGxlZ2FjeTogdHJ1ZQogICAgICAgICAgfSkpOwoKICAgICAgICAgIGlmICh1cGRhdGVyJCkgewogICAgICAgICAgICByZWdpc3RlclN0YXR1c1VwZGF0ZXIoYXBwLmlkLCB1cGRhdGVyJCk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyLm1vdW50ZXJzLnNldChhcHAuaWQsIHsKICAgICAgICAgICAgYXBwUm91dGU6IGFwcFJvdXRlLAogICAgICAgICAgICBhcHBCYXNlUGF0aDogYXBwQmFzZVBhdGgsCiAgICAgICAgICAgIG1vdW50OiBtb3VudCwKICAgICAgICAgICAgdW5tb3VudEJlZm9yZU1vdW50aW5nOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHJlZ2lzdGVyQXBwVXBkYXRlcjogZnVuY3Rpb24gcmVnaXN0ZXJBcHBVcGRhdGVyKGFwcFVwZGF0ZXIkKSB7CiAgICAgICAgICByZXR1cm4gcmVnaXN0ZXJTdGF0dXNVcGRhdGVyKGFsbEFwcGxpY2F0aW9uc0ZpbHRlciwgYXBwVXBkYXRlciQpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzdGFydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3RhcnQoX3JlZjcpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgaHR0cCwgb3ZlcmxheXMsIF9yZWY4LCBjYXBhYmlsaXRpZXMsIGF2YWlsYWJsZU1vdW50ZXJzLCBhdmFpbGFibGVBcHBzLCBhcHBsaWNhdGlvbnMkOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBzdGFydCQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaHR0cCA9IF9yZWY3Lmh0dHAsIG92ZXJsYXlzID0gX3JlZjcub3ZlcmxheXM7CgogICAgICAgICAgICAgIGlmICh0aGlzLm1vdW50Q29udGV4dCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FwcGxpY2F0aW9uU2VydmljZSNzZXR1cCgpIG11c3QgYmUgaW52b2tlZCBiZWZvcmUgc3RhcnQuJyk7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgdGhpcy5yZWdpc3RyYXRpb25DbG9zZWQgPSB0cnVlOwogICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLm9uQmVmb3JlVW5sb2FkKTsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDc7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh0aGlzLmNhcGFiaWxpdGllcy5zdGFydCh7CiAgICAgICAgICAgICAgICBhcHBJZHM6IF90b0NvbnN1bWFibGVBcnJheSh0aGlzLm1vdW50ZXJzLmtleXMoKSksCiAgICAgICAgICAgICAgICBodHRwOiBodHRwCiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIF9yZWY4ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgY2FwYWJpbGl0aWVzID0gX3JlZjguY2FwYWJpbGl0aWVzOwogICAgICAgICAgICAgIGF2YWlsYWJsZU1vdW50ZXJzID0gZmlsdGVyQXZhaWxhYmxlKHRoaXMubW91bnRlcnMsIGNhcGFiaWxpdGllcyk7CiAgICAgICAgICAgICAgYXZhaWxhYmxlQXBwcyA9IGZpbHRlckF2YWlsYWJsZSh0aGlzLmFwcHMsIGNhcGFiaWxpdGllcyk7CiAgICAgICAgICAgICAgYXBwbGljYXRpb25zJCA9IG5ldyBfcnhqcy5CZWhhdmlvclN1YmplY3QoYXZhaWxhYmxlQXBwcyk7CiAgICAgICAgICAgICAgdGhpcy5zdGF0dXNVcGRhdGVycyQucGlwZSgoMCwgX29wZXJhdG9ycy5tYXApKGZ1bmN0aW9uIChzdGF0dXNVcGRhdGVycykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXAoX3RvQ29uc3VtYWJsZUFycmF5KGF2YWlsYWJsZUFwcHMpLm1hcChmdW5jdGlvbiAoX3JlZjkpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxMCA9IF9zbGljZWRUb0FycmF5KF9yZWY5LCAyKSwKICAgICAgICAgICAgICAgICAgICAgIGlkID0gX3JlZjEwWzBdLAogICAgICAgICAgICAgICAgICAgICAgYXBwID0gX3JlZjEwWzFdOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIFtpZCwgdXBkYXRlU3RhdHVzKGFwcCwgX3RvQ29uc3VtYWJsZUFycmF5KHN0YXR1c1VwZGF0ZXJzLnZhbHVlcygpKSldOwogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIH0pKS5zdWJzY3JpYmUoZnVuY3Rpb24gKGFwcHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhcHBsaWNhdGlvbnMkLm5leHQoYXBwcyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9ucyQ6IGFwcGxpY2F0aW9ucyQsCiAgICAgICAgICAgICAgICBjYXBhYmlsaXRpZXM6IGNhcGFiaWxpdGllcywKICAgICAgICAgICAgICAgIGN1cnJlbnRBcHBJZCQ6IHRoaXMuY3VycmVudEFwcElkJC5waXBlKCgwLCBfb3BlcmF0b3JzLnRha2VVbnRpbCkodGhpcy5zdG9wJCkpLAogICAgICAgICAgICAgICAgcmVnaXN0ZXJNb3VudENvbnRleHQ6IHRoaXMubW91bnRDb250ZXh0LnJlZ2lzdGVyQ29udGV4dCwKICAgICAgICAgICAgICAgIGdldFVybEZvckFwcDogZnVuY3Rpb24gZ2V0VXJsRm9yQXBwKGFwcElkKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTEgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9LAogICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IF9yZWYxMS5wYXRoOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAuYmFzZVBhdGgucHJlcGVuZChnZXRBcHBVcmwoYXZhaWxhYmxlTW91bnRlcnMsIGFwcElkLCBwYXRoKSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbmF2aWdhdGVUb0FwcDogZnVuY3Rpb24gbmF2aWdhdGVUb0FwcChhcHBJZCkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlZjEyLAogICAgICAgICAgICAgICAgICAgICAgcGF0aCwKICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLAogICAgICAgICAgICAgICAgICAgICAgYXBwLAogICAgICAgICAgICAgICAgICAgICAgX2FyZ3MyID0gYXJndW1lbnRzOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBuYXZpZ2F0ZVRvQXBwJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVmMTIgPSBfYXJnczIubGVuZ3RoID4gMSAmJiBfYXJnczJbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMlsxXSA6IHt9LCBwYXRoID0gX3JlZjEyLnBhdGgsIHN0YXRlID0gX3JlZjEyLnN0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgIGFwcCA9IGFwcGxpY2F0aW9ucyQudmFsdWUuZ2V0KGFwcElkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoYXBwICYmIGFwcC5zdGF0dXMgIT09IF90eXBlcy5BcHBTdGF0dXMuYWNjZXNzaWJsZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUcnlpbmcgdG8gbmF2aWdhdGUgdG8gYW4gaW5hY2Nlc3NpYmxlIGFwcGxpY2F0aW9uOiAiLmNvbmNhdChhcHBJZCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKF90aGlzMy5zaG91bGROYXZpZ2F0ZShvdmVybGF5cykpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQyLnNlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMy5hcHBMZWF2ZUhhbmRsZXJzLmRlbGV0ZShfdGhpczMuY3VycmVudEFwcElkJC52YWx1ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMy5uYXZpZ2F0ZShnZXRBcHBVcmwoYXZhaWxhYmxlTW91bnRlcnMsIGFwcElkLCBwYXRoKSwgc3RhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczMuY3VycmVudEFwcElkJC5uZXh0KGFwcElkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXRDb21wb25lbnQ6IGZ1bmN0aW9uIGdldENvbXBvbmVudCgpIHsKICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpczMuaGlzdG9yeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfdWkuQXBwUm91dGVyLCB7CiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeTogX3RoaXMzLmhpc3RvcnksCiAgICAgICAgICAgICAgICAgICAgbW91bnRlcnM6IGF2YWlsYWJsZU1vdW50ZXJzLAogICAgICAgICAgICAgICAgICAgIHNldEFwcExlYXZlSGFuZGxlcjogX3RoaXMzLnNldEFwcExlYXZlSGFuZGxlcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzaG91bGROYXZpZ2F0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdWxkTmF2aWdhdGUob3ZlcmxheXMpIHsKICAgICAgdmFyIGN1cnJlbnRBcHBJZCwgYWN0aW9uLCBjb25maXJtZWQ7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUuYXN5bmMoZnVuY3Rpb24gc2hvdWxkTmF2aWdhdGUkKF9jb250ZXh0NCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGN1cnJlbnRBcHBJZCA9IHRoaXMuY3VycmVudEFwcElkJC52YWx1ZTsKCiAgICAgICAgICAgICAgaWYgKCEoY3VycmVudEFwcElkID09PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBhY3Rpb24gPSAoMCwgX2FwcGxpY2F0aW9uX2xlYXZlLmdldExlYXZlQWN0aW9uKSh0aGlzLmFwcExlYXZlSGFuZGxlcnMuZ2V0KGN1cnJlbnRBcHBJZCkpOwoKICAgICAgICAgICAgICBpZiAoISgwLCBfYXBwbGljYXRpb25fbGVhdmUuaXNDb25maXJtQWN0aW9uKShhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDc7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChvdmVybGF5cy5vcGVuQ29uZmlybShhY3Rpb24udGV4dCwgewogICAgICAgICAgICAgICAgdGl0bGU6IGFjdGlvbi50aXRsZSwKICAgICAgICAgICAgICAgICdkYXRhLXRlc3Qtc3Viaic6ICdhcHBMZWF2ZUNvbmZpcm1Nb2RhbCcKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgY29uZmlybWVkID0gX2NvbnRleHQ0LnNlbnQ7CgogICAgICAgICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBmYWxzZSk7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBudWxsLCB0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzdG9wIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wKCkgewogICAgICB0aGlzLnN0b3AkLm5leHQoKTsKICAgICAgdGhpcy5jdXJyZW50QXBwSWQkLmNvbXBsZXRlKCk7CiAgICAgIHRoaXMuc3RhdHVzVXBkYXRlcnMkLmNvbXBsZXRlKCk7CiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChzdWIpIHsKICAgICAgICByZXR1cm4gc3ViLnVuc3Vic2NyaWJlKCk7CiAgICAgIH0pOwogICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy5vbkJlZm9yZVVubG9hZCk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQXBwbGljYXRpb25TZXJ2aWNlOwp9KCk7CgpleHBvcnRzLkFwcGxpY2F0aW9uU2VydmljZSA9IEFwcGxpY2F0aW9uU2VydmljZTsKCnZhciB1cGRhdGVTdGF0dXMgPSBmdW5jdGlvbiB1cGRhdGVTdGF0dXMoYXBwLCBzdGF0dXNVcGRhdGVycykgewogIHZhciBjaGFuZ2VzID0ge307CiAgc3RhdHVzVXBkYXRlcnMuZm9yRWFjaChmdW5jdGlvbiAod3JhcHBlcikgewogICAgaWYgKHdyYXBwZXIuYXBwbGljYXRpb24gIT09IGFsbEFwcGxpY2F0aW9uc0ZpbHRlciAmJiB3cmFwcGVyLmFwcGxpY2F0aW9uICE9PSBhcHAuaWQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBmaWVsZHMgPSB3cmFwcGVyLnVwZGF0ZXIoYXBwKTsKCiAgICBpZiAoZmllbGRzKSB7CiAgICAgIHZhciBfY2hhbmdlcyRzdGF0dXMsIF9maWVsZHMkc3RhdHVzLCBfY2hhbmdlcyRuYXZMaW5rU3RhdHUsIF9maWVsZHMkbmF2TGlua1N0YXR1czsKCiAgICAgIGNoYW5nZXMgPSBfb2JqZWN0U3ByZWFkKHt9LCBjaGFuZ2VzLCB7fSwgZmllbGRzLCB7CiAgICAgICAgLy8gc3RhdHVzIGFuZCBuYXZMaW5rU3RhdHVzIGVudW1zIGFyZSBvcmRlcmVkIGJ5IHJldmVyc2VkIHByaW9yaXR5CiAgICAgICAgLy8gaWYgbXVsdGlwbGUgdXBkYXRlcnMgd2FudHMgdG8gY2hhbmdlIHRoZXNlIGZpZWxkcywgd2Ugd2lsbCBhbHdheXMgZm9sbG93IHRoZSBwcmlvcml0eSBvcmRlci4KICAgICAgICBzdGF0dXM6IE1hdGgubWF4KChfY2hhbmdlcyRzdGF0dXMgPSBjaGFuZ2VzLnN0YXR1cykgIT09IG51bGwgJiYgX2NoYW5nZXMkc3RhdHVzICE9PSB2b2lkIDAgPyBfY2hhbmdlcyRzdGF0dXMgOiAwLCAoX2ZpZWxkcyRzdGF0dXMgPSBmaWVsZHMuc3RhdHVzKSAhPT0gbnVsbCAmJiBfZmllbGRzJHN0YXR1cyAhPT0gdm9pZCAwID8gX2ZpZWxkcyRzdGF0dXMgOiAwKSwKICAgICAgICBuYXZMaW5rU3RhdHVzOiBNYXRoLm1heCgoX2NoYW5nZXMkbmF2TGlua1N0YXR1ID0gY2hhbmdlcy5uYXZMaW5rU3RhdHVzKSAhPT0gbnVsbCAmJiBfY2hhbmdlcyRuYXZMaW5rU3RhdHUgIT09IHZvaWQgMCA/IF9jaGFuZ2VzJG5hdkxpbmtTdGF0dSA6IDAsIChfZmllbGRzJG5hdkxpbmtTdGF0dXMgPSBmaWVsZHMubmF2TGlua1N0YXR1cykgIT09IG51bGwgJiYgX2ZpZWxkcyRuYXZMaW5rU3RhdHVzICE9PSB2b2lkIDAgPyBfZmllbGRzJG5hdkxpbmtTdGF0dXMgOiAwKQogICAgICB9KTsKICAgIH0KICB9KTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgYXBwLCB7fSwgY2hhbmdlcyk7Cn07"},null]}