{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/spaces/public/management/edit_space/customize_space/customize_space_avatar.js","dependencies":[{"path":"x-pack/legacy/plugins/spaces/public/management/edit_space/customize_space/customize_space_avatar.js","mtime":1585205048335},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1585205104179},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1585205115915},{"path":"node_modules/babel-loader/lib/index.js","mtime":1585205080825}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuQ3VzdG9taXplU3BhY2VBdmF0YXIgPSB2b2lkIDA7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfZGF0YXVybCA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvbW1vbi9saWIvZGF0YXVybCIpOwoKdmFyIF9zcGFjZV9hdmF0YXIgPSByZXF1aXJlKCIuLi8uLi8uLi9zcGFjZV9hdmF0YXIiKTsKCnZhciBfY29tbW9uID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9zcGFjZXMvY29tbW9uIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgX3R5cGVvZjIoU3ltYm9sLml0ZXJhdG9yKSA9PT0gInN5bWJvbCIpIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfSBlbHNlIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9CgogIHJldHVybiBfdHlwZW9mKG9iaik7Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgewogIHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7CiAgdmFyIF9hcnIgPSBbXTsKICB2YXIgX24gPSB0cnVlOwogIHZhciBfZCA9IGZhbHNlOwogIHZhciBfZSA9IHVuZGVmaW5lZDsKCiAgdHJ5IHsKICAgIGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgX2Fyci5wdXNoKF9zLnZhbHVlKTsKCiAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsKICAgIH0KICB9IGNhdGNoIChlcnIpIHsKICAgIF9kID0gdHJ1ZTsKICAgIF9lID0gZXJyOwogIH0gZmluYWxseSB7CiAgICB0cnkgewogICAgICBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSAhPSBudWxsKSBfaVsicmV0dXJuIl0oKTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmIChfZCkgdGhyb3cgX2U7CiAgICB9CiAgfQoKICByZXR1cm4gX2FycjsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogIH0KfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICByZXR1cm4gQ29uc3RydWN0b3I7Cn0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CiAgICByZXR1cm4gY2FsbDsKICB9CgogIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOwp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIEN1c3RvbWl6ZVNwYWNlQXZhdGFyVUkgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKEN1c3RvbWl6ZVNwYWNlQXZhdGFyVUksIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBDdXN0b21pemVTcGFjZUF2YXRhclVJKHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEN1c3RvbWl6ZVNwYWNlQXZhdGFyVUkpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEN1c3RvbWl6ZVNwYWNlQXZhdGFyVUkpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJpbml0aWFsc1JlZiIsIG51bGwpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZUltYWdlVXBsb2FkIiwgZnVuY3Rpb24gKGltZ1VybCkgewogICAgICB2YXIgdGhpc0luc3RhbmNlID0gX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyk7CgogICAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2UoKTsKICAgICAgaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgTUFYX0lNQUdFX1NJWkUgPSA2NDsKICAgICAgICB2YXIgaW1nRGlteCA9IGltYWdlLndpZHRoOwogICAgICAgIHZhciBpbWdEaW15ID0gaW1hZ2UuaGVpZ2h0OwoKICAgICAgICBpZiAoaW1nRGlteCA8PSBNQVhfSU1BR0VfU0laRSAmJiBpbWdEaW15IDw9IE1BWF9JTUFHRV9TSVpFKSB7CiAgICAgICAgICB0aGlzSW5zdGFuY2Uuc3RvcmVJbWFnZUNoYW5nZXMoaW1nVXJsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGltYWdlQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICB2YXIgY2FudmFzQ29udGV4dCA9IGltYWdlQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CgogICAgICAgICAgaWYgKGltZ0RpbXggPj0gaW1nRGlteSkgewogICAgICAgICAgICBpbWFnZUNhbnZhcy53aWR0aCA9IE1BWF9JTUFHRV9TSVpFOwogICAgICAgICAgICBpbWFnZUNhbnZhcy5oZWlnaHQgPSBNYXRoLmZsb29yKGltZ0RpbXkgKiBNQVhfSU1BR0VfU0laRSAvIGltZ0RpbXgpOwoKICAgICAgICAgICAgaWYgKGNhbnZhc0NvbnRleHQpIHsKICAgICAgICAgICAgICBjYW52YXNDb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgaW1hZ2VDYW52YXMud2lkdGgsIGltYWdlQ2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgICAgdmFyIHJlc2l6ZWRJbWFnZVVybCA9IGltYWdlQ2FudmFzLnRvRGF0YVVSTCgpOwogICAgICAgICAgICAgIHRoaXNJbnN0YW5jZS5zdG9yZUltYWdlQ2hhbmdlcyhyZXNpemVkSW1hZ2VVcmwpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpbWFnZUNhbnZhcy5oZWlnaHQgPSBNQVhfSU1BR0VfU0laRTsKICAgICAgICAgICAgaW1hZ2VDYW52YXMud2lkdGggPSBNYXRoLmZsb29yKGltZ0RpbXggKiBNQVhfSU1BR0VfU0laRSAvIGltZ0RpbXkpOwoKICAgICAgICAgICAgaWYgKGNhbnZhc0NvbnRleHQpIHsKICAgICAgICAgICAgICBjYW52YXNDb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgaW1hZ2VDYW52YXMud2lkdGgsIGltYWdlQ2FudmFzLmhlaWdodCk7CgogICAgICAgICAgICAgIHZhciBfcmVzaXplZEltYWdlVXJsID0gaW1hZ2VDYW52YXMudG9EYXRhVVJMKCk7CgogICAgICAgICAgICAgIHRoaXNJbnN0YW5jZS5zdG9yZUltYWdlQ2hhbmdlcyhfcmVzaXplZEltYWdlVXJsKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgZmFsc2UpOwogICAgICBpbWFnZS5zcmMgPSBpbWdVcmw7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZpbGVVcGxvYWQiLCBmdW5jdGlvbiAoZmlsZXMpIHsKICAgICAgdmFyIF9maWxlcyA9IF9zbGljZWRUb0FycmF5KGZpbGVzLCAxKSwKICAgICAgICAgIGZpbGUgPSBfZmlsZXNbMF07CgogICAgICBpZiAoX2RhdGF1cmwuaW1hZ2VUeXBlcy5pbmRleE9mKGZpbGUudHlwZSkgPiAtMSkgewogICAgICAgICgwLCBfZGF0YXVybC5lbmNvZGUpKGZpbGUpLnRoZW4oZnVuY3Rpb24gKGRhdGF1cmwpIHsKICAgICAgICAgIHJldHVybiBfdGhpcy5oYW5kbGVJbWFnZVVwbG9hZChkYXRhdXJsKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW5pdGlhbHNJbnB1dFJlZiIsIGZ1bmN0aW9uIChyZWYpIHsKICAgICAgaWYgKHJlZikgewogICAgICAgIF90aGlzLmluaXRpYWxzUmVmID0gcmVmOwoKICAgICAgICBfdGhpcy5pbml0aWFsc1JlZi5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIF90aGlzLm9uSW5pdGlhbHNGb2N1cyk7CgogICAgICAgIF90aGlzLmluaXRpYWxzUmVmLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBfdGhpcy5vbkluaXRpYWxzQmx1cik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKF90aGlzLmluaXRpYWxzUmVmKSB7CiAgICAgICAgICBfdGhpcy5pbml0aWFsc1JlZi5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIF90aGlzLm9uSW5pdGlhbHNGb2N1cyk7CgogICAgICAgICAgX3RoaXMuaW5pdGlhbHNSZWYucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIF90aGlzLm9uSW5pdGlhbHNCbHVyKTsKCiAgICAgICAgICBfdGhpcy5pbml0aWFsc1JlZiA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkluaXRpYWxzRm9jdXMiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpbml0aWFsc0hhc0ZvY3VzOiB0cnVlLAogICAgICAgIHBlbmRpbmdJbml0aWFsczogKDAsIF9zcGFjZV9hdmF0YXIuZ2V0U3BhY2VJbml0aWFscykoX3RoaXMucHJvcHMuc3BhY2UpCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Jbml0aWFsc0JsdXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpbml0aWFsc0hhc0ZvY3VzOiBmYWxzZSwKICAgICAgICBwZW5kaW5nSW5pdGlhbHM6IG51bGwKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkluaXRpYWxzQ2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIGluaXRpYWxzID0gKGUudGFyZ2V0LnZhbHVlIHx8ICcnKS5zdWJzdHJpbmcoMCwgX2NvbW1vbi5NQVhfU1BBQ0VfSU5JVElBTFMpOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHBlbmRpbmdJbml0aWFsczogaW5pdGlhbHMKICAgICAgfSk7CgogICAgICBfdGhpcy5wcm9wcy5vbkNoYW5nZShfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5wcm9wcy5zcGFjZSwgewogICAgICAgIGluaXRpYWxzOiBpbml0aWFscwogICAgICB9KSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkNvbG9yQ2hhbmdlIiwgZnVuY3Rpb24gKGNvbG9yKSB7CiAgICAgIF90aGlzLnByb3BzLm9uQ2hhbmdlKF9vYmplY3RTcHJlYWQoe30sIF90aGlzLnByb3BzLnNwYWNlLCB7CiAgICAgICAgY29sb3I6IGNvbG9yCiAgICAgIH0pKTsKICAgIH0pOwoKICAgIF90aGlzLnN0YXRlID0gewogICAgICBpbml0aWFsc0hhc0ZvY3VzOiBmYWxzZQogICAgfTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhDdXN0b21pemVTcGFjZUF2YXRhclVJLCBbewogICAga2V5OiAic3RvcmVJbWFnZUNoYW5nZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN0b3JlSW1hZ2VDaGFuZ2VzKGltYWdlVXJsKSB7CiAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5wcm9wcy5zcGFjZSwgewogICAgICAgIGltYWdlVXJsOiBpbWFnZVVybAogICAgICB9KSk7CiAgICB9IC8vCiAgICAvLyBpbWFnZXMgYmVsb3cgNjR4NjQgcGl4ZWxzIGFyZSBsZWZ0IHVudG91Y2hlZAogICAgLy8gaW1hZ2VzIGFib3ZlIHRoYXQgdGhyZXNob2xkIGFyZSByZXNpemVkCiAgICAvLwoKICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgIHNwYWNlID0gX3RoaXMkcHJvcHMuc3BhY2UsCiAgICAgICAgICBpbnRsID0gX3RoaXMkcHJvcHMuaW50bDsKICAgICAgdmFyIF90aGlzJHN0YXRlID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGluaXRpYWxzSGFzRm9jdXMgPSBfdGhpcyRzdGF0ZS5pbml0aWFsc0hhc0ZvY3VzLAogICAgICAgICAgcGVuZGluZ0luaXRpYWxzID0gX3RoaXMkc3RhdGUucGVuZGluZ0luaXRpYWxzOwogICAgICB2YXIgc3BhY2VDb2xvciA9ICgwLCBfc3BhY2VfYXZhdGFyLmdldFNwYWNlQ29sb3IpKHNwYWNlKTsKICAgICAgdmFyIGlzSW52YWxpZFNwYWNlQ29sb3IgPSAhKDAsIF9ldWkuaXNWYWxpZEhleCkoc3BhY2VDb2xvcikgJiYgc3BhY2VDb2xvciAhPT0gJyc7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJmb3JtIiwgewogICAgICAgIG9uU3VibWl0OiBmdW5jdGlvbiBvblN1Ym1pdCgpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgbGFiZWw6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ3hwYWNrLnNwYWNlcy5tYW5hZ2VtZW50LmN1c3RvbWl6ZVNwYWNlQXZhdGFyLmluaXRpYWxJdGVtc0Zvcm1Sb3dMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0luaXRpYWxzICgyIG1heCknCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkVGV4dCwgewogICAgICAgIGlucHV0UmVmOiB0aGlzLmluaXRpYWxzSW5wdXRSZWYsCiAgICAgICAgbmFtZTogInNwYWNlSW5pdGlhbHMiIC8vIGFsbG93cyBpbnB1dCB0byBiZSBjbGVhcmVkIG9yIG90aGVyd2lzZSBpbnZhbGlkYXRlZCB3aGlsZSB1c2VyIGlzIGVkaXRpbmcgdGhlIGluaXRpYWxzLAogICAgICAgIC8vIHdpdGhvdXQgZGVmYXVsdGluZyB0byB0aGUgZGVyaXZlZCBpbml0aWFscyBwcm92aWRlZCBieSBgZ2V0U3BhY2VJbml0aWFsc2AKICAgICAgICAsCiAgICAgICAgdmFsdWU6IGluaXRpYWxzSGFzRm9jdXMgPyBwZW5kaW5nSW5pdGlhbHMgfHwgJycgOiAoMCwgX3NwYWNlX2F2YXRhci5nZXRTcGFjZUluaXRpYWxzKShzcGFjZSksCiAgICAgICAgb25DaGFuZ2U6IHRoaXMub25Jbml0aWFsc0NoYW5nZSwKICAgICAgICBkaXNhYmxlZDogdGhpcy5wcm9wcy5zcGFjZS5pbWFnZVVybCAmJiB0aGlzLnByb3BzLnNwYWNlLmltYWdlVXJsICE9PSAnJyA/IHRydWUgOiBmYWxzZQogICAgICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgbGFiZWw6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ3hwYWNrLnNwYWNlcy5tYW5hZ2VtZW50LmN1c3RvbWl6ZVNwYWNlQXZhdGFyLmNvbG9yRm9ybVJvd0xhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ29sb3InCiAgICAgICAgfSksCiAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWRTcGFjZUNvbG9yCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDb2xvclBpY2tlciwgewogICAgICAgIGNvbG9yOiBzcGFjZUNvbG9yLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uQ29sb3JDaGFuZ2UsCiAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWRTcGFjZUNvbG9yCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSwgdGhpcy5maWxlUGlja2VyT3JJbWFnZSgpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVJbWFnZVVybCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlSW1hZ2VVcmwoKSB7CiAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5wcm9wcy5zcGFjZSwgewogICAgICAgIGltYWdlVXJsOiAnJwogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZmlsZVBpY2tlck9ySW1hZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbGVQaWNrZXJPckltYWdlKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBpbnRsID0gdGhpcy5wcm9wcy5pbnRsOwoKICAgICAgaWYgKCF0aGlzLnByb3BzLnNwYWNlLmltYWdlVXJsKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgICBsYWJlbDogaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgICAgaWQ6ICd4cGFjay5zcGFjZXMubWFuYWdlbWVudC5jdXN0b21pemVTcGFjZUF2YXRhci5pbWFnZVVybCcsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ3VzdG9tIGltYWdlJwogICAgICAgICAgfSkKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmlsZVBpY2tlciwgewogICAgICAgICAgZGlzcGxheTogImRlZmF1bHQiLAogICAgICAgICAgaW5pdGlhbFByb21wdFRleHQ6IGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiAneHBhY2suc3BhY2VzLm1hbmFnZW1lbnQuY3VzdG9taXplU3BhY2VBdmF0YXIuc2VsZWN0SW1hZ2VVcmwnLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NlbGVjdCBpbWFnZSBmaWxlJwogICAgICAgICAgfSksCiAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkZpbGVVcGxvYWQsCiAgICAgICAgICBhY2NlcHQ6IF9kYXRhdXJsLmltYWdlVHlwZXMKICAgICAgICB9KSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogdHJ1ZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpczIucmVtb3ZlSW1hZ2VVcmwoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgICBpY29uVHlwZTogInRyYXNoIgogICAgICAgIH0sIGludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ3hwYWNrLnNwYWNlcy5tYW5hZ2VtZW50LmN1c3RvbWl6ZVNwYWNlQXZhdGFyLnJlbW92ZUltYWdlJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUmVtb3ZlIGN1c3RvbSBpbWFnZScKICAgICAgICB9KSkpOwogICAgICB9CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQ3VzdG9taXplU3BhY2VBdmF0YXJVSTsKfShfcmVhY3QuQ29tcG9uZW50KTsKCnZhciBDdXN0b21pemVTcGFjZUF2YXRhciA9ICgwLCBfcmVhY3QyLmluamVjdEkxOG4pKEN1c3RvbWl6ZVNwYWNlQXZhdGFyVUkpOwpleHBvcnRzLkN1c3RvbWl6ZVNwYWNlQXZhdGFyID0gQ3VzdG9taXplU3BhY2VBdmF0YXI7"},null]}