/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
var __kbnBundles__=typeof __kbnBundles__==="object"?__kbnBundles__:{};__kbnBundles__["plugin/security"]=function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var executeModules=data[2];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}deferredModules.push.apply(deferredModules,executeModules||[]);return checkDeferredModules()}function checkDeferredModules(){var result;for(var i=0;i<deferredModules.length;i++){var deferredModule=deferredModules[i];var fulfilled=true;for(var j=1;j<deferredModule.length;j++){var depId=deferredModule[j];if(installedChunks[depId]!==0)fulfilled=false}if(fulfilled){deferredModules.splice(i--,1);result=__webpack_require__(__webpack_require__.s=deferredModule[0])}}return result}var installedModules={};var installedChunks={36:0,24:0,29:0,32:0,39:0};var deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.e=function requireEnsure(){return Promise.resolve()};__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="__REPLACE_WITH_PUBLIC_PATH__";var jsonpArray=window["webpackJsonp"]=window["webpackJsonp"]||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push([6977,0]);return checkDeferredModules()}({0:function(module,exports){module.exports=__kbnSharedDeps__.React},1:function(module,exports){module.exports=__kbnSharedDeps__.ElasticEui},17:function(module,exports){module.exports=vendors_3},18:function(module,exports){module.exports=__kbnSharedDeps__.ElasticEuiLightTheme},2:function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},26:function(module,exports){module.exports=vendors_2},34:function(module,exports){module.exports=vendors_0},36:function(module,exports){module.exports=vendors_1},4:function(module,exports){module.exports=__kbnSharedDeps__.KbnI18nReact},50:function(module,exports){module.exports=__kbnSharedDeps__.ElasticEuiDarkTheme},6977:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"SecurityPluginSetup",{enumerable:true,get:function get(){return _plugin.SecurityPluginSetup}});Object.defineProperty(exports,"SecurityPluginStart",{enumerable:true,get:function get(){return _plugin.SecurityPluginStart}});Object.defineProperty(exports,"SessionInfo",{enumerable:true,get:function get(){return _types.SessionInfo}});Object.defineProperty(exports,"AuthenticatedUser",{enumerable:true,get:function get(){return _model.AuthenticatedUser}});exports.plugin=void 0;var _plugin=__webpack_require__(6978);var _types=__webpack_require__(6994);var _model=__webpack_require__(1389);var plugin=function plugin(){return new _plugin.SecurityPlugin};exports.plugin=plugin},6978:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SecurityPlugin=void 0;var _session=__webpack_require__(6979);var _licensing=__webpack_require__(6987);var _nav_control=__webpack_require__(6989);var _authentication=__webpack_require__(6992);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var SecurityPlugin=function(){function SecurityPlugin(){_classCallCheck(this,SecurityPlugin);_defineProperty(this,"sessionTimeout",void 0);_defineProperty(this,"navControlService",void 0);_defineProperty(this,"securityLicenseService",void 0)}_createClass(SecurityPlugin,[{key:"setup",value:function setup(core,_ref){var licensing=_ref.licensing;var http=core.http,notifications=core.notifications,injectedMetadata=core.injectedMetadata;var anonymousPaths=http.anonymousPaths;anonymousPaths.register("/login");anonymousPaths.register("/logout");anonymousPaths.register("/logged_out");var tenant=injectedMetadata.getInjectedVar("session.tenant","");var logoutUrl=injectedMetadata.getInjectedVar("logoutUrl");var sessionExpired=new _session.SessionExpired(logoutUrl,tenant);http.intercept(new _session.UnauthorizedResponseHttpInterceptor(sessionExpired,anonymousPaths));this.sessionTimeout=new _session.SessionTimeout(notifications,sessionExpired,http,tenant);http.intercept(new _session.SessionTimeoutHttpInterceptor(this.sessionTimeout,anonymousPaths));this.navControlService=new _nav_control.SecurityNavControlService;this.securityLicenseService=new _licensing.SecurityLicenseService;var _this$securityLicense=this.securityLicenseService.setup({license$:licensing.license$}),license=_this$securityLicense.license;var authc=(new _authentication.AuthenticationService).setup({http:core.http});this.navControlService.setup({securityLicense:license,authc:authc});return{authc:authc,sessionTimeout:this.sessionTimeout}}},{key:"start",value:function start(core){this.sessionTimeout.start();this.navControlService.start({core:core})}},{key:"stop",value:function stop(){this.sessionTimeout.stop();this.navControlService.stop();this.securityLicenseService.stop()}}]);return SecurityPlugin}();exports.SecurityPlugin=SecurityPlugin},6979:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"SessionExpired",{enumerable:true,get:function get(){return _session_expired.SessionExpired}});Object.defineProperty(exports,"SessionTimeout",{enumerable:true,get:function get(){return _session_timeout.SessionTimeout}});Object.defineProperty(exports,"ISessionTimeout",{enumerable:true,get:function get(){return _session_timeout.ISessionTimeout}});Object.defineProperty(exports,"SessionTimeoutHttpInterceptor",{enumerable:true,get:function get(){return _session_timeout_http_interceptor.SessionTimeoutHttpInterceptor}});Object.defineProperty(exports,"UnauthorizedResponseHttpInterceptor",{enumerable:true,get:function get(){return _unauthorized_response_http_interceptor.UnauthorizedResponseHttpInterceptor}});var _session_expired=__webpack_require__(6980);var _session_timeout=__webpack_require__(6981);var _session_timeout_http_interceptor=__webpack_require__(6985);var _unauthorized_response_http_interceptor=__webpack_require__(6986)},6980:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SessionExpired=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var getNextParameter=function getNextParameter(){var _window=window,location=_window.location;var next=encodeURIComponent("".concat(location.pathname).concat(location.search).concat(location.hash));return"&next=".concat(next)};var getProviderParameter=function getProviderParameter(tenant){var key="".concat(tenant,"/session_provider");var providerName=sessionStorage.getItem(key);return providerName?"&provider=".concat(encodeURIComponent(providerName)):""};var SessionExpired=function(){function SessionExpired(logoutUrl,tenant){_classCallCheck(this,SessionExpired);this.logoutUrl=logoutUrl;this.tenant=tenant}_createClass(SessionExpired,[{key:"logout",value:function logout(){var next=getNextParameter();var provider=getProviderParameter(this.tenant);window.location.assign("".concat(this.logoutUrl,"?msg=SESSION_EXPIRED").concat(next).concat(provider))}}]);return SessionExpired}();exports.SessionExpired=SessionExpired},6981:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SessionTimeout=void 0;var _broadcastChannel=__webpack_require__(7920);var _session_idle_timeout_warning=__webpack_require__(6983);var _session_lifespan_warning=__webpack_require__(6984);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var GRACE_PERIOD_MS=5*1e3;var WARNING_MS=60*1e3;var SESSION_CHECK_MS=1e3;var SESSION_ROUTE="/internal/security/session";var SessionTimeout=function(){function SessionTimeout(notifications,sessionExpired,http,tenant){var _this=this;_classCallCheck(this,SessionTimeout);this.notifications=notifications;this.sessionExpired=sessionExpired;this.http=http;this.tenant=tenant;_defineProperty(this,"channel",void 0);_defineProperty(this,"sessionInfo",void 0);_defineProperty(this,"fetchTimer",void 0);_defineProperty(this,"warningTimer",void 0);_defineProperty(this,"expirationTimer",void 0);_defineProperty(this,"warningToast",void 0);_defineProperty(this,"fetchSessionInfoAndResetTimers",(function _callee(){var extend,method,headers,result,_args=arguments;return regeneratorRuntime.async((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:extend=_args.length>0&&_args[0]!==undefined?_args[0]:false;method=extend?"POST":"GET";headers=extend?{}:{"kbn-system-api":"true"};_context.prev=3;_context.next=6;return regeneratorRuntime.awrap(_this.http.fetch(SESSION_ROUTE,{method:method,headers:headers}));case 6:result=_context.sent;_this.handleSessionInfoAndResetTimers(result);if(_this.channel){_this.channel.postMessage(result)}_context.next=13;break;case 11:_context.prev=11;_context.t0=_context["catch"](3);case 13:case"end":return _context.stop()}}}),null,null,[[3,11]])}));_defineProperty(this,"handleSessionInfoAndResetTimers",(function(sessionInfo){_this.sessionInfo=sessionInfo;var key="".concat(_this.tenant,"/session_provider");sessionStorage.setItem(key,sessionInfo.provider);var _this$getTimeout=_this.getTimeout(),timeout=_this$getTimeout.timeout,isLifespanTimeout=_this$getTimeout.isLifespanTimeout;if(timeout==null){return}_this.cleanup();var timeoutVal=timeout-WARNING_MS-GRACE_PERIOD_MS-SESSION_CHECK_MS;if(timeoutVal>0&&!isLifespanTimeout){_this.fetchTimer=window.setTimeout(_this.fetchSessionInfoAndResetTimers,timeoutVal)}_this.warningTimer=window.setTimeout(_this.showWarning,Math.max(timeout-WARNING_MS-GRACE_PERIOD_MS,0));_this.expirationTimer=window.setTimeout((function(){return _this.sessionExpired.logout()}),Math.max(timeout-GRACE_PERIOD_MS,0))}));_defineProperty(this,"cleanup",(function(){if(_this.fetchTimer){window.clearTimeout(_this.fetchTimer)}if(_this.warningTimer){window.clearTimeout(_this.warningTimer)}if(_this.expirationTimer){window.clearTimeout(_this.expirationTimer)}if(_this.warningToast){_this.notifications.toasts.remove(_this.warningToast);_this.warningToast=undefined}}));_defineProperty(this,"getTimeout",(function(){var timeout=null;var isLifespanTimeout=false;if(_this.sessionInfo){var _this$sessionInfo=_this.sessionInfo,now=_this$sessionInfo.now,idleTimeoutExpiration=_this$sessionInfo.idleTimeoutExpiration,lifespanExpiration=_this$sessionInfo.lifespanExpiration;if(idleTimeoutExpiration){timeout=idleTimeoutExpiration-now}if(lifespanExpiration&&(idleTimeoutExpiration===null||lifespanExpiration<=idleTimeoutExpiration)){timeout=lifespanExpiration-now;isLifespanTimeout=true}}return{timeout:timeout,isLifespanTimeout:isLifespanTimeout}}));_defineProperty(this,"showWarning",(function(){var _this$getTimeout2=_this.getTimeout(),timeout=_this$getTimeout2.timeout,isLifespanTimeout=_this$getTimeout2.isLifespanTimeout;var toastLifeTimeMs=Math.min(timeout-GRACE_PERIOD_MS,WARNING_MS);var toast;if(!isLifespanTimeout){var refresh=function refresh(){return _this.fetchSessionInfoAndResetTimers(true)};toast=(0,_session_idle_timeout_warning.createToast)(toastLifeTimeMs,refresh)}else{toast=(0,_session_lifespan_warning.createToast)(toastLifeTimeMs)}_this.warningToast=_this.notifications.toasts.add(toast)}))}_createClass(SessionTimeout,[{key:"start",value:function start(){if(this.http.anonymousPaths.isAnonymous(window.location.pathname)){return}var name="".concat(this.tenant,"/session_timeout");this.channel=new _broadcastChannel.BroadcastChannel(name,{webWorkerSupport:false});this.channel.onmessage=this.handleSessionInfoAndResetTimers;return this.fetchSessionInfoAndResetTimers()}},{key:"stop",value:function stop(){if(this.channel){this.channel.close()}this.cleanup()}},{key:"extend",value:function extend(url){if(url.endsWith(SESSION_ROUTE)){return}var _this$getTimeout3=this.getTimeout(),isLifespanTimeout=_this$getTimeout3.isLifespanTimeout;if(this.warningToast&&!isLifespanTimeout){return this.fetchSessionInfoAndResetTimers()}}}]);return SessionTimeout}();exports.SessionTimeout=SessionTimeout},6983:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createToast=exports.SessionIdleTimeoutWarning=void 0;var _react=_interopRequireDefault(__webpack_require__(0));var _i18n=__webpack_require__(2);var _eui=__webpack_require__(1);var _react2=__webpack_require__(4);var _public=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SessionIdleTimeoutWarning=function SessionIdleTimeoutWarning(props){return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_eui.EuiProgress,{size:"xs",color:"danger",position:"absolute"}),_react.default.createElement("p",null,_react.default.createElement(_react2.FormattedMessage,{id:"xpack.security.components.sessionIdleTimeoutWarning.message",defaultMessage:"You will be logged out {timeout} due to inactivity. Click OK to resume.",values:{timeout:_react.default.createElement(_react2.FormattedRelative,{value:props.timeout,units:"second",updateInterval:1e3})}})),_react.default.createElement("div",{className:"eui-textRight"},_react.default.createElement(_eui.EuiButton,{size:"s",color:"warning",onClick:props.onRefreshSession,"data-test-subj":"refreshSessionButton"},_react.default.createElement(_react2.FormattedMessage,{id:"xpack.security.components.sessionIdleTimeoutWarning.okButtonText",defaultMessage:"OK"}))))};exports.SessionIdleTimeoutWarning=SessionIdleTimeoutWarning;var createToast=function createToast(toastLifeTimeMs,onRefreshSession){var timeout=toastLifeTimeMs+Date.now();return{color:"warning",text:(0,_public.toMountPoint)(_react.default.createElement(SessionIdleTimeoutWarning,{onRefreshSession:onRefreshSession,timeout:timeout})),title:_i18n.i18n.translate("xpack.security.components.sessionIdleTimeoutWarning.title",{defaultMessage:"Warning"}),iconType:"clock",toastLifeTimeMs:toastLifeTimeMs}};exports.createToast=createToast},6984:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createToast=exports.SessionLifespanWarning=void 0;var _react=_interopRequireDefault(__webpack_require__(0));var _i18n=__webpack_require__(2);var _react2=__webpack_require__(4);var _eui=__webpack_require__(1);var _public=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SessionLifespanWarning=function SessionLifespanWarning(props){return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_eui.EuiProgress,{size:"xs",color:"danger",position:"absolute"}),_react.default.createElement("p",null,_react.default.createElement(_react2.FormattedMessage,{id:"xpack.security.components.sessionLifespanWarning.message",defaultMessage:"Your session will reach the maximum time limit {timeout}. You will need to log in again.",values:{timeout:_react.default.createElement(_react2.FormattedRelative,{value:props.timeout,units:"second",updateInterval:1e3})}})))};exports.SessionLifespanWarning=SessionLifespanWarning;var createToast=function createToast(toastLifeTimeMs){var timeout=toastLifeTimeMs+Date.now();return{color:"danger",text:(0,_public.toMountPoint)(_react.default.createElement(SessionLifespanWarning,{timeout:timeout})),title:_i18n.i18n.translate("xpack.security.components.sessionLifespanWarning.title",{defaultMessage:"Warning"}),iconType:"alert",toastLifeTimeMs:toastLifeTimeMs}};exports.createToast=createToast},6985:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SessionTimeoutHttpInterceptor=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var isSystemAPIRequest=function isSystemAPIRequest(request){return request.headers.has("kbn-system-api")};var SessionTimeoutHttpInterceptor=function(){function SessionTimeoutHttpInterceptor(sessionTimeout,anonymousPaths){_classCallCheck(this,SessionTimeoutHttpInterceptor);this.sessionTimeout=sessionTimeout;this.anonymousPaths=anonymousPaths}_createClass(SessionTimeoutHttpInterceptor,[{key:"response",value:function response(httpResponse){if(this.anonymousPaths.isAnonymous(window.location.pathname)){return}if(isSystemAPIRequest(httpResponse.request)){return}this.sessionTimeout.extend(httpResponse.request.url)}},{key:"responseError",value:function responseError(httpErrorResponse){if(this.anonymousPaths.isAnonymous(window.location.pathname)){return}if(isSystemAPIRequest(httpErrorResponse.request)){return}var response=httpErrorResponse.response;if(!response){return}this.sessionTimeout.extend(httpErrorResponse.request.url)}}]);return SessionTimeoutHttpInterceptor}();exports.SessionTimeoutHttpInterceptor=SessionTimeoutHttpInterceptor},6986:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.UnauthorizedResponseHttpInterceptor=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var UnauthorizedResponseHttpInterceptor=function(){function UnauthorizedResponseHttpInterceptor(sessionExpired,anonymousPaths){_classCallCheck(this,UnauthorizedResponseHttpInterceptor);this.sessionExpired=sessionExpired;this.anonymousPaths=anonymousPaths}_createClass(UnauthorizedResponseHttpInterceptor,[{key:"responseError",value:function responseError(httpErrorResponse,controller){if(this.anonymousPaths.isAnonymous(window.location.pathname)){return}if(httpErrorResponse.request.credentials==="omit"){return}var response=httpErrorResponse.response;if(!response){return}if(response.status===401){this.sessionExpired.logout();controller.halt()}}}]);return UnauthorizedResponseHttpInterceptor}();exports.UnauthorizedResponseHttpInterceptor=UnauthorizedResponseHttpInterceptor},6987:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"SecurityLicenseService",{enumerable:true,get:function get(){return _license_service.SecurityLicenseService}});Object.defineProperty(exports,"SecurityLicense",{enumerable:true,get:function get(){return _license_service.SecurityLicense}});var _license_service=__webpack_require__(6988)},6988:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}Object.defineProperty(exports,"__esModule",{value:true});exports.SecurityLicenseService=void 0;var _operators=__webpack_require__(47);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var SecurityLicenseService=function(){function SecurityLicenseService(){_classCallCheck(this,SecurityLicenseService);_defineProperty(this,"licenseSubscription",void 0)}_createClass(SecurityLicenseService,[{key:"setup",value:function setup(_ref){var _this=this;var license$=_ref.license$;var rawLicense;this.licenseSubscription=license$.subscribe((function(nextRawLicense){rawLicense=nextRawLicense}));return{license:Object.freeze({isEnabled:function isEnabled(){return _this.isSecurityEnabledFromRawLicense(rawLicense)},getFeatures:function getFeatures(){return _this.calculateFeaturesFromRawLicense(rawLicense)},features$:license$.pipe((0,_operators.map)((function(nextRawLicense){return _this.calculateFeaturesFromRawLicense(nextRawLicense)})))})}}},{key:"stop",value:function stop(){if(this.licenseSubscription){this.licenseSubscription.unsubscribe();this.licenseSubscription=undefined}}},{key:"isSecurityEnabledFromRawLicense",value:function isSecurityEnabledFromRawLicense(rawLicense){if(!rawLicense){return false}var securityFeature=rawLicense.getFeature("security");return securityFeature!==undefined&&securityFeature.isAvailable&&securityFeature.isEnabled}},{key:"calculateFeaturesFromRawLicense",value:function calculateFeaturesFromRawLicense(rawLicense){if(!(rawLicense===null||rawLicense===void 0?void 0:rawLicense.isAvailable)){return{showLogin:true,allowLogin:false,showLinks:false,showRoleMappingsManagement:false,allowRoleDocumentLevelSecurity:false,allowRoleFieldLevelSecurity:false,allowRbac:false,layout:rawLicense!==undefined&&!(rawLicense===null||rawLicense===void 0?void 0:rawLicense.isAvailable)?"error-xpack-unavailable":"error-es-unavailable"}}if(!this.isSecurityEnabledFromRawLicense(rawLicense)){return{showLogin:false,allowLogin:false,showLinks:false,showRoleMappingsManagement:false,allowRoleDocumentLevelSecurity:false,allowRoleFieldLevelSecurity:false,allowRbac:false,linksMessage:"Access is denied because Security is disabled in Elasticsearch."}}var showRoleMappingsManagement=rawLicense.hasAtLeast("gold");var isLicensePlatinumOrBetter=rawLicense.hasAtLeast("platinum");return{showLogin:true,allowLogin:true,showLinks:true,showRoleMappingsManagement:showRoleMappingsManagement,allowRoleDocumentLevelSecurity:isLicensePlatinumOrBetter,allowRoleFieldLevelSecurity:isLicensePlatinumOrBetter,allowRbac:true}}}]);return SecurityLicenseService}();exports.SecurityLicenseService=SecurityLicenseService},6989:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"SecurityNavControlService",{enumerable:true,get:function get(){return _nav_control_service.SecurityNavControlService}});var _nav_control_service=__webpack_require__(6990)},6990:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SecurityNavControlService=void 0;var _reactDom=_interopRequireDefault(__webpack_require__(9));var _react=_interopRequireDefault(__webpack_require__(0));var _nav_control_component=__webpack_require__(6991);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var SecurityNavControlService=function(){function SecurityNavControlService(){_classCallCheck(this,SecurityNavControlService);_defineProperty(this,"securityLicense",void 0);_defineProperty(this,"authc",void 0);_defineProperty(this,"navControlRegistered",void 0);_defineProperty(this,"securityFeaturesSubscription",void 0)}_createClass(SecurityNavControlService,[{key:"setup",value:function setup(_ref){var securityLicense=_ref.securityLicense,authc=_ref.authc;this.securityLicense=securityLicense;this.authc=authc}},{key:"start",value:function start(_ref2){var _this=this;var core=_ref2.core;this.securityFeaturesSubscription=this.securityLicense.features$.subscribe((function(_ref3){var showLinks=_ref3.showLinks;var isAnonymousPath=core.http.anonymousPaths.isAnonymous(window.location.pathname);var shouldRegisterNavControl=!isAnonymousPath&&showLinks&&!_this.navControlRegistered;if(shouldRegisterNavControl){_this.registerSecurityNavControl(core)}}))}},{key:"stop",value:function stop(){if(this.securityFeaturesSubscription){this.securityFeaturesSubscription.unsubscribe();this.securityFeaturesSubscription=undefined}this.navControlRegistered=false}},{key:"registerSecurityNavControl",value:function registerSecurityNavControl(core){var currentUserPromise=this.authc.getCurrentUser();core.chrome.navControls.registerRight({order:2e3,mount:function mount(el){var I18nContext=core.i18n.Context;var logoutUrl=core.injectedMetadata.getInjectedVar("logoutUrl");var props={user:currentUserPromise,editProfileUrl:core.http.basePath.prepend("/app/kibana#/account"),logoutUrl:logoutUrl};_reactDom.default.render(_react.default.createElement(I18nContext,null,_react.default.createElement(_nav_control_component.SecurityNavControl,props)),el);return function(){return _reactDom.default.unmountComponentAtNode(el)}}});this.navControlRegistered=true}}]);return SecurityNavControlService}();exports.SecurityNavControlService=SecurityNavControlService},6991:function(module,exports,__webpack_require__){"use strict";function _typeof2(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof2=function _typeof2(obj){return typeof obj}}else{_typeof2=function _typeof2(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof2(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports.SecurityNavControl=void 0;var _i18n=__webpack_require__(2);var _react=__webpack_require__(4);var _react2=_interopRequireWildcard(__webpack_require__(0));var _eui=__webpack_require__(1);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}function _typeof(obj){if(typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"){_typeof=function _typeof(obj){return _typeof2(obj)}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var SecurityNavControl=function(_Component){_inherits(SecurityNavControl,_Component);function SecurityNavControl(props){var _this;_classCallCheck(this,SecurityNavControl);_this=_possibleConstructorReturn(this,_getPrototypeOf(SecurityNavControl).call(this,props));_defineProperty(_assertThisInitialized(_this),"onMenuButtonClick",(function(){if(!_this.state.authenticatedUser){return}_this.setState({isOpen:!_this.state.isOpen})}));_defineProperty(_assertThisInitialized(_this),"closeMenu",(function(){_this.setState({isOpen:false})}));_this.state={isOpen:false,authenticatedUser:null};props.user.then((function(authenticatedUser){_this.setState({authenticatedUser:authenticatedUser})}));return _this}_createClass(SecurityNavControl,[{key:"render",value:function render(){var _this$props=this.props,editProfileUrl=_this$props.editProfileUrl,logoutUrl=_this$props.logoutUrl;var authenticatedUser=this.state.authenticatedUser;var name=authenticatedUser&&(authenticatedUser.full_name||authenticatedUser.username)||"";var buttonContents=authenticatedUser?_react2.default.createElement(_eui.EuiAvatar,{name:name,size:"s"}):_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"m"});var button=_react2.default.createElement(_eui.EuiHeaderSectionItemButton,{"aria-controls":"headerUserMenu","aria-expanded":this.state.isOpen,"aria-haspopup":"true","aria-label":_i18n.i18n.translate("xpack.security.navControlComponent.accountMenuAriaLabel",{defaultMessage:"Account menu"}),onClick:this.onMenuButtonClick,"data-test-subj":"userMenuButton"},buttonContents);return _react2.default.createElement(_eui.EuiPopover,{id:"headerUserMenu",ownFocus:true,button:button,isOpen:this.state.isOpen,anchorPosition:"downRight",repositionOnScroll:true,closePopover:this.closeMenu,panelPaddingSize:"none"},_react2.default.createElement("div",{style:{width:320},"data-test-subj":"userMenu"},_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"m",className:"euiHeaderProfile",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiAvatar,{name:name,size:"xl"})),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",{className:"eui-textBreakWord"},name)),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiLink,{href:editProfileUrl,"data-test-subj":"profileLink"},_react2.default.createElement(_react.FormattedMessage,{id:"xpack.security.navControlComponent.editProfileLinkText",defaultMessage:"Edit profile"}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiLink,{href:logoutUrl,"data-test-subj":"logoutLink"},_react2.default.createElement(_react.FormattedMessage,{id:"xpack.security.navControlComponent.logoutLinkText",defaultMessage:"Log out"}))))))))))}}]);return SecurityNavControl}(_react2.Component);exports.SecurityNavControl=SecurityNavControl},6992:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"AuthenticationService",{enumerable:true,get:function get(){return _authentication_service.AuthenticationService}});Object.defineProperty(exports,"AuthenticationServiceSetup",{enumerable:true,get:function get(){return _authentication_service.AuthenticationServiceSetup}});var _authentication_service=__webpack_require__(6993)},6993:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AuthenticationService=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var AuthenticationService=function(){function AuthenticationService(){_classCallCheck(this,AuthenticationService)}_createClass(AuthenticationService,[{key:"setup",value:function setup(_ref){var http=_ref.http;return{getCurrentUser:function getCurrentUser(){return regeneratorRuntime.async((function getCurrentUser$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return regeneratorRuntime.awrap(http.get("/internal/security/me",{headers:{"kbn-system-api":true}}));case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}}))}}}}]);return AuthenticationService}();exports.AuthenticationService=AuthenticationService},6994:function(module,exports,__webpack_require__){"use strict"},7920:function(module,exports,__webpack_require__){module.exports=__webpack_require__(34)(1893)},9:function(module,exports){module.exports=__kbnSharedDeps__.ReactDom}})["plugin"];